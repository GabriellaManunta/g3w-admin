!function umd(root,factory){"object"==typeof module&&"object"==typeof exports?module.exports=factory():"function"==typeof define&&define.amd?define([],factory):root.httpVueLoader=factory()}(this,(function factory(){"use strict";let scopeIndex=0;class Component{constructor(name){this.name=name,this.template=null,this.script=null,this.styles=[],this._scopeId=""}getHead(){return document.head||document.getElementsByTagName("head")[0]}getScopeId(){return""===this._scopeId&&(this._scopeId="data-s-"+(scopeIndex++).toString(36),this.template.getRootElt().setAttribute(this._scopeId,"")),this._scopeId}async load(url){const text=await httpVueLoader.httpRequest(url);this.baseURI=url.substr(0,url.lastIndexOf("/")+1);const doc=document.implementation.createHTMLDocument("");doc.body.innerHTML=(this.baseURI?'<base href="'+this.baseURI+'">':"")+text;for(let it=doc.body.firstChild;it;it=it.nextSibling)switch(it.nodeName){case"TEMPLATE":this.template=new TemplateContext(this,it);break;case"SCRIPT":this.script=new ScriptContext(this,it);break;case"STYLE":this.styles.push(new StyleContext(this,it))}return this}_normalizeSection(ctx){let p;return p=null!==ctx&&ctx.elt.hasAttribute("src")?httpVueLoader.httpRequest(ctx.elt.getAttribute("src")).then((function(content){return ctx.elt.removeAttribute("src"),content})):Promise.resolve(null),p.then(content=>{if(null!==ctx&&ctx.elt.hasAttribute("lang")){const lang=ctx.elt.getAttribute("lang").toLowerCase();return ctx.elt.removeAttribute("lang"),(httpVueLoader.langProcessor[lang]||identity).call(this,null===content?ctx.getContent():content)}return content}).then((function(content){null!==content&&ctx.setContent(content)}))}async normalize(){return await Promise.all(Array.prototype.concat(this._normalizeSection(this.template),this._normalizeSection(this.script),this.styles.map(this._normalizeSection))),this}async compile(){return await Promise.all(Array.prototype.concat(this.template&&this.template.compile(),this.script&&this.script.compile(),this.styles.map((function(style){return style.compile()})))),this}}class StyleContext{constructor(c,el){this.component=c,this.elt=el}withBase(cb){let base;if(this.component.baseURI){base=document.createElement("base"),base.href=this.component.baseURI;const head=this.component.getHead();head.insertBefore(base,head.firstChild)}cb.call(this),base&&this.component.getHead().removeChild(base)}scopeStyles(el,name){try{process(el,name)}catch(ex){if(ex instanceof DOMException&&ex.code===DOMException.INVALID_ACCESS_ERR)return el.sheet.disabled=!0,void el.addEventListener("load",(function onStyleLoaded(){el.removeEventListener("load",onStyleLoaded),setTimeout((function(){process(el,name),el.sheet.disabled=!1}))}));throw ex}}compile(){const scoped=this.elt.hasAttribute("scoped");if(!scoped||null!==this.template)return scoped&&this.elt.removeAttribute("scoped"),this.withBase((function(){this.component.getHead().appendChild(this.elt)})),scoped&&this.scopeStyles(this.elt,"["+this.component.getScopeId()+"]"),Promise.resolve()}getContent(){return this.elt.textContent}setContent(content){this.withBase((function(){this.elt.textContent=content}))}}class ScriptContext{constructor(c,el){this.component=c,this.elt=el,this.module={exports:{}}}getContent(){return this.elt.textContent}setContent(content){this.elt.textContent=content}compile(module){try{Function("exports","require","httpVueLoader","module",this.getContent()).call(this.module.exports,this.module.exports,childURL=>httpVueLoader.require(resolveURL(this.component.baseURI,childURL)),(childURL,childName)=>httpVueLoader(resolveURL(this.component.baseURI,childURL),childName),this.module)}catch(ex){if(!("lineNumber"in ex))return Promise.reject(ex);const vueFile=responseText.replace(/\r?\n/g,"\n");throw new ex.constructor(ex.message,url,vueFile.substr(0,vueFile.indexOf(script)).split("\n").length+ex.lineNumber-1)}return Promise.resolve(this.module.exports).then((httpVueLoader.scriptExportsHandler||identity).bind(this)).then(exports=>{this.module.exports=exports})}}class TemplateContext{constructor(component,elt){this.component=component,this.elt=elt}getContent(){return this.elt.innerHTML}setContent(content){this.elt.innerHTML=content}getRootElt(){let el=this.elt.content||this.elt;if("firstElementChild"in el)return el.firstElementChild;for(el=tplElt.firstChild;null!==el;el=el.nextSibling)if(el.nodeType===Node.ELEMENT_NODE)return el;return null}compile(){return Promise.resolve()}}function identity(value){return value}function parseComponentURL(url){const comp=url.match(/(.*?)([^/]+?)\/?(\.vue)?(\?.*|#.*|$)/);return{name:comp[2],url:comp[1]+comp[2]+(void 0===comp[3]?"/index.vue":comp[3])+comp[4]}}function resolveURL(baseURL,url){return"./"===url.substr(0,2)||"../"===url.substr(0,3)?baseURL+url:url}function process(styleElt,scopeName){const sheet=styleElt.sheet,rules=sheet.cssRules;for(let i=0;i<rules.length;++i){const rule=rules[i];if(1!==rule.type)continue;const scoped=[];rule.selectorText.split(/\s*,\s*/).forEach((function(sel){scoped.push(scopeName+" "+sel);const segments=sel.match(/([^ :]+)(.+)?/);scoped.push(segments[1]+scopeName+(segments[2]||""))}));const scopedRule=scoped.join(",")+rule.cssText.substr(rule.selectorText.length);sheet.deleteRule(i),sheet.insertRule(scopedRule,i)}}function httpVueLoader(url,name){const comp=parseComponentURL(url);return httpVueLoader.load(comp.url,name)}return httpVueLoader.load=function(url,name){return async function(){const c=await(await(await new Component(name).load(url)).normalize()).compile(),exports=null!==c.script?c.script.module.exports:{};return null!==c.template&&(exports.template=c.template.getContent()),void 0===c.name&&void 0!==c.name&&(exports.name=c.name),exports._baseURI=c.baseURI,exports}},httpVueLoader.register=function(Vue,url){const c=parseComponentURL(url);Vue.component(c.name,httpVueLoader.load(c.url))},httpVueLoader.install=function(Vue){Vue.mixin({beforeCreate:function(){const components=this.$options.components;for(let name in components)if("string"==typeof components[name]&&"url:"===components[name].substr(0,4)){const c=parseComponentURL(components[name].substr(4)),componentURL="_baseURI"in this.$options?resolveURL(this.$options._baseURI,c.url):c.url;components[name]=isNaN(name)?httpVueLoader.load(componentURL,name):Vue.component(c.name,httpVueLoader.load(componentURL,c.name))}}})},httpVueLoader.require=function(moduleName){return window[moduleName]},httpVueLoader.httpRequest=function(url){return fetch(url).then(response=>{if(response.status>=200&&response.status<300)return response.text();throw new Error(response.status)})},httpVueLoader}));