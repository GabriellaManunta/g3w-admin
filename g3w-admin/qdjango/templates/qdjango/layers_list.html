{% extends "base.html" %}
{% load i18n %}
{% load g3wadmin_tags %}
{% load guardian_tags %}
{% load svg_icon %}
{% load staticfiles %}
{% load qdjango_tags %}

{% block custom_js_links_page %}
<script src="{% static "qdjango/js/widget.js" %}"></script>
<script>
    $('#tree').treeview({data:{{ layers_tree|safe }}});
    ga.ui.initNolegendLayerCheckBox();
    ga.ui.initDownloadLayerCheckBox();
    ga.ui.initDownloadLayerXlsCheckBox();
    ga.ui.initDownloadLayerGpxCheckBox();
    ga.ui.initDownloadLayerCsvCheckBox();
    ga.ui.initExternalLayerCheckBox();

    // on check of every download
    $(document).on('ifChanged', '[name="check_every_download"]', function(e){
        var state = e.target.checked ? 'check' : 'uncheck';
        $('[data-widget-type="downloadLayer"]').iCheck(state);
    });
    $(document).on('ifChanged', '[name="check_every_download_xls"]', function(e){
        var state = e.target.checked ? 'check' : 'uncheck';
        $('[data-widget-type="downloadLayerxls"]').iCheck(state);
    });
    $(document).on('ifChanged', '[name="check_every_download_gpx"]', function(e){
        var state = e.target.checked ? 'check' : 'uncheck';
        $('[data-widget-type="downloadLayergpx"]').iCheck(state);
    });

    // add expression svg
    ga.ui.expression_svg = '<svg id="expressioniconsvg" height="20" width="20" viewBox="0 0 32 32"\n' +
        '     xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >\n' +
        '  <image x="0" y="0" height="122%" width="122%"  ' +
        ' xlink:href="{% static 'svg/mIconExpression_orange.svg' %}" />'
</script>
{% endblock %}

{% block page_header %}
<h1>
{% trans 'QGIS Project Layers' %}
    <small></small>
</h1>
{% endblock %}

{% block main_content %}
{% get_obj_perms user for project as "userPrj_perms" %}
<div class="row">
    <div class="col-md-12 col-xs-12">
        <div class="box">
            <div class="box-header">
                <h3 class="box-title">{% trans 'Project' %} {{ project.title }}</h3>
            </div>
            <div class="box-body">
                <h4>
                    {% if "view_project" in userPrj_perms %}
                    <a href="{% url 'group-project-map' group.slug 'qdjango' project.pk %}" data-toggle="tooltip" data-placement="top" title="{% trans 'Show map' %}" target="_blank"><i class="ion ion-map"></i> {% trans 'Show map' %}</a>  |
                    {% endif %}
                    {% if "view_project" in userPrj_perms %}
                    <a href="#" data-toggle="tooltip" data-placement="top" title="{% trans 'Show detail' %}" data-widget-type="detailItem" data-detail-url="{% url 'qdjango-project-detail' group.slug project.slug %}" ><i class="ion ion-eye"></i> {% trans 'Show detail' %}</a> |
                    {% endif %}
                    {% if "change_project" in userPrj_perms %}
                    <a href="{% url 'qdjango-project-update' group.slug project.slug %}" data-toggle="tooltip" data-placement="top" title="{% trans 'Edit' %}" ><i class="ion ion-edit"></i>{% trans 'Edit' %}</a>
                    {% endif %}
                </h4>
            </div>
            <div class="box-body">
                {{ project.description|safe }}
            </div>
        </div>
    </div>
</div>

<div class="box">
    <div class="box-body">
        <div class="nav-tabs-custom">
            <ul class="nav nav-tabs">
              <li class="active"><a href="#tab_layers_data" data-toggle="tab"><i class="fa fa-file"></i> {% trans 'Data' %}</a></li>
              <li><a href="#tab_layers_structure" data-toggle="tab"><i class="fa fa-list-alt"></i> {% trans 'Structure' %}</a></li>

            </ul>
            <div class="tab-content">
              <div class="tab-pane active" id="tab_layers_data">
                <table id="layers_table" class="table table-hover table-striped" data-widget-type="dataTable">
                    <thead>
                        <tr>
                            <th style="min-width:160px; max-width: 160px;">Actions</th>
                            {% if "change_project" in userPrj_perms %}
                            <th style="width:40px">{% trans 'No legend' %}</th>
                            {% if 'shp' in SETTINGS.G3WADMIN_VECTOR_LAYER_DOWNLOAD_FORMATS %}
                            <th style="width:100px"><input type="checkbox" name="check_every_download" />{% trans 'Download as shp' %}</th>
                            {% endif %}
                            {% if 'xls' in SETTINGS.G3WADMIN_VECTOR_LAYER_DOWNLOAD_FORMATS %}
                            <th style="width:100px"><input type="checkbox" name="check_every_download_xls" />{% trans 'Download as xls' %}</th>
                            {% endif %}
                            {% if 'csv' in SETTINGS.G3WADMIN_VECTOR_LAYER_DOWNLOAD_FORMATS %}
                            <th style="width:100px"><input type="checkbox" name="check_every_download_csv" />{% trans 'Download as csv' %}</th>
                            {% endif %}
                            {% if 'gpx' in SETTINGS.G3WADMIN_VECTOR_LAYER_DOWNLOAD_FORMATS %}
                            <th style="width:100px"><input type="checkbox" name="check_every_download_gpx" />{% trans 'Download as gpx' %}</th>
                            {% endif %}
                            <th style="width:100px">{% trans 'WMS External' %}</th>
                            {% endif %}
                            <th style="width: 40px">{% trans 'Type' %}</th>
                            <th style="width: 40px">WFS</th>
                            <th>{%  trans 'Name' %}</th>
                            <th>{%  trans 'Label' %}</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for object in object_list %}
                        <tr id="qdjango_project_layer_{{ object.slug }}">
                            <td>
                                {% g3wadmin_layer_actions object 'qdjango' user as actions %}
                                {% for action in actions %}
                                    {{ action }}
                                {% endfor %}
                                {% if object.layer_type in type_layer_for_widget %}
                                <span class="col-xs-2 icon">
                                    <a href="#" data-toggle="tooltip" data-placement="top" title="{% trans 'Manage alphanumeric visualization and editing constraints' %}" data-widget-type="singlelayerConstraintsList" data-singlelayerconstraints-layer-pk="{{ object.pk }}" data-singlelayerconstraints-list-url="{% url 'qdjango-constraint-api-filter-by-layer-id' object.pk %}" ><i class="fa fa-filter"></i></a>
                                </span>
                                {% endif %}
                                {% if object.layer_type in type_layer_for_widget %}
                                <span class="col-xs-2 icon">
                                    <a href="#" data-toggle="tooltip" data-placement="top" title="{% trans 'Widgets list' %}" data-widget-type="detailItemDataTable" data-detail-url="{% url 'qdjango-project-layer-widgets' group.slug object.project.slug object.slug %}" ><i class="ion ion-gear-b"></i></a>
                                </span>
                                <span class="label label-info col-xs-2">
                                    {{ object.getWidgetsNumber }}
                                </span>
                                {% endif %}
                            </td>
                            {% if "change_project" in userPrj_perms %}
                            <td>
                                <input type="checkbox" data-widget-type="noLegendLayer" data-ajax-url="{% url 'qdjango-project-layers-data-editing' project.group.slug project.slug object.pk %}" name="no_legend_{{ object.pk }}" {% if object.exclude_from_legend %}checked="checked"{% endif %}>
                            </td>
                            {% if 'shp' in SETTINGS.G3WADMIN_VECTOR_LAYER_DOWNLOAD_FORMATS %}
                            <td>
                                {% if object.layer_type in type_layer_for_download %}
                                <input type="checkbox" data-widget-type="downloadLayer" data-ajax-url="{% url 'qdjango-project-layers-data-editing' project.group.slug project.slug object.pk %}" name="download_{{ object.pk }}" {% if object.download %}checked="checked"{% endif %}>
                                {% endif %}
                            </td>
                            {% endif %}
                            {% if 'xls' in SETTINGS.G3WADMIN_VECTOR_LAYER_DOWNLOAD_FORMATS %}
                            <td>
                                {% if object.layer_type in type_layer_for_download %}
                                <input type="checkbox" data-widget-type="downloadLayerxls" data-ajax-url="{% url 'qdjango-project-layers-data-editing' project.group.slug project.slug object.pk %}" name="download_xls_{{ object.pk }}" {% if object.download_xls %}checked="checked"{% endif %}>
                                {% endif %}
                            </td>
                            {% endif %}
                            {% if 'csv' in SETTINGS.G3WADMIN_VECTOR_LAYER_DOWNLOAD_FORMATS%}
                            <td>
                                {% if object.layer_type in type_layer_for_download %}
                                <input type="checkbox" data-widget-type="downloadLayercsv" data-ajax-url="{% url 'qdjango-project-layers-data-editing' project.group.slug project.slug object.pk %}" name="download_csv_{{ object.pk }}" {% if object.download_csv %}checked="checked"{% endif %}>
                                {% endif %}
                            </td>
                            {% endif %}
                            {% if 'gpx' in SETTINGS.G3WADMIN_VECTOR_LAYER_DOWNLOAD_FORMATS%}
                            <td>
                                {% if object.layer_type in type_layer_for_download and object|is_geom_type_gpx_compatible %}
                                <input type="checkbox" data-widget-type="downloadLayergpx" data-ajax-url="{% url 'qdjango-project-layers-data-editing' project.group.slug project.slug object.pk %}" name="download_gpx_{{ object.pk }}" {% if object.download_gpx %}checked="checked"{% endif %}>
                                {% endif %}
                            </td>
                            {% endif %}
                            <td>
                                {% if object|can_set_external %}
                                <input type="checkbox" data-widget-type="externalLayer" data-ajax-url="{% url 'qdjango-project-layers-data-editing' project.group.slug project.slug object.pk %}" name="external_{{ object.pk }}" {% if object.external %}checked="checked"{% endif %}>
                                {% endif %}
                            </td>
                            {% endif %}
                            <td>
                                {% include 'qdjango/include/layer_icon.html' %}
                            </td>

                            <td>
                                {% if object.wfscapabilities %}
                                <span class="fa fa-check-circle" style="color: orange"></span>
                                {% endif %}
                            </td>
                            <td>{{ object.origname }}</td>
                            <td>{{ object.title }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
              </div><!-- /.tab-pane -->
              <div class="tab-pane" id="tab_layers_structure">
                <div id="tree"></div>
              </div><!-- /.tab-pane -->

            </div><!-- /.tab-content -->
          </div>






    </div>
</div>
{% endblock %}