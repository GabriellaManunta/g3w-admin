(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
var apptitle = "G3W Client";

var plugins = {
};

var tools = {
  tools:  []
};

var mapcontrols = ['zoom','zoombox','query'];
//var mapcontrols = ['zoom','zoombox','zoomtoextent','query'];

var i18n = {
  resources: require('./locales/app.js')
};

var client =  {
  debug:  true,
  local:  false
};

var server =  {
  urls:  {
    ows:  '/ows',
    api:  '/api',
    config:  '/api/config',
    staticurl:  '',
  }
};

/*var templates =  {
  app:  require('../templates/app.html'),
  sidebar:  require('../templates/sidebar.html'),
  floatbar:  require('../templates/floatbar.html'),
};*/

module.exports = {
  apptitle: apptitle,
  client: client,
  server: server,
  plugins:  plugins,
  tools:  tools,
  map: {
    controls: mapcontrols
  },
  i18n: i18n
};

},{"./locales/app.js":2}],2:[function(require,module,exports){
var translations = {
    "it": {
        "translation": {
            "component": "Componente Generico",
            "search": "Ricerca",
            "catalog": "Catalogo dati",
            "baselayers": "Basi",
            "tools": "Strumenti",
            "tree": "Dati",
            "legend": "Legenda",
            "street_search": "Cerca indirizzo"
        }
    }
};

module.exports = translations;

},{}],3:[function(require,module,exports){
var i18ninit = require('sdk').core.i18n.init;
var ApplicationService = require('sdk/sdk').core.ApplicationService;
var ApplicationTemplate = require('./template/js/template');

// SETTO LA VARIABILE GLOBALE g3wsdk, COME SE AVESSI USATO sdk.js
window.g3wsdk = require('sdk');

var config = require('./config/config.js');

function createApplicationConfig() {  
  return {
    apptitle: config.apptitle || '',
    debug: config.client.debug || false,
    group: config.group,
    urls: config.server.urls,
    resourcesurl: config.server.urls.staticurl,
    projects: config.group.projects,
    initproject: config.group.initproject,
    baselayers: config.group.baselayers,
    crs: config.group.crs,
    proj4: config.group.proj4,
    minscale: config.group.minscale,
    maxscale: config.group.maxscale,
    // richiesto da ProjectService
    getWmsUrl: function(project){
      return config.server.urls.ows+'/'+config.group.id+'/'+project.type+'/'+project.id;
    },
    // richiesto da ProjectsRegistry
    getProjectConfigUrl: function(project){
      return config.server.urls.config+'/'+config.group.id+'/'+project.type+'/'+project.id;
    },
    plugins: config.group.plugins,
    tools: config.tools,
    views: config.views || {},
    map: config.map
  };
};

// questa è la configurazione base del template che conterrà tutti gli
// elementi previsti dal template. Nella definizione sono tutti oggetti vuoti
// Sarà l'applicazione a scegliere di riempire gli elementi
function createTemplateConfig(){
  var CatalogComponent = require('sdk').gui.vue.CatalogComponent;
  var SearchComponent = require('sdk').gui.vue.SearchComponent;
  var ToolsComponent = require('sdk').gui.vue.ToolsComponent;
  var MapComponent = require('sdk').gui.vue.MapComponent;
  
  return {
    title: config.apptitle,
    placeholders: {
      navbar: {
        components: []
      },
      sidebar: {
        components: [
          new SearchComponent({
            id: 'search',
            openOnStart: false,
            dataIcon: "fa fa-search"
          }),
          new CatalogComponent({
            id: 'catalog',
            openOnStart: true,
            dataIcon: "fa fa-database"
          }),
          new ToolsComponent({
            id: 'tools',
            openOnStart: false,
            dataIcon: "fa fa-gear"
          })
        ]
      },
      content: { // placeholder del contenuto (view content) inizialmente Vista Secondaria (nascosta)
        components: []
      }, 
      floatbar:{
        components: []
      }
    },
    viewport: {
      map: new MapComponent({
        id: 'map'
      }),
      contentx: null
    }
  };
}

function obtainInitConfig(){
  var d = $.Deferred();
  if (window.initConfig) {
    return d.resolve(window.initConfig);
  }
  // altrimenti devo aspettare che local.initconfig.js abbia caricato l'initconfig
  else{
    $(document).on('initconfigReady',function(e,initconfig){
      return d.resolve(initconfig);
    })
  }
  return d.promise();
}

ApplicationService.on('ready',function(){
  //istanzio l'appication template passando la configurazione del template e l'applicationService che fornisce API del progetto
  var templateConfig = createTemplateConfig();
  //istanzio l'application Template
  applicationTemplate = new ApplicationTemplate(templateConfig, this);
  //inizializzo e faccio partire con ilmetodo init
  applicationTemplate.init();
});

bootstrap = function(){
  i18ninit(config.i18n);

  obtainInitConfig()
  .then(function(initConfig){
    config.server.urls.staticurl = initConfig.staticurl;
    config.group = initConfig.group;
    
      var applicationConfig = createApplicationConfig();
      ApplicationService.init(applicationConfig);
  })
}();



},{"./config/config.js":1,"./template/js/template":15,"sdk":78,"sdk/sdk":78}],4:[function(require,module,exports){
module.exports = "<div class=\"wrapper\">\n  <header class=\"main-header\">\n    <!-- Logo -->\n    <!-- Header Navbar: style can be found in header.less -->\n    <nav class=\"navbar navbar-static-top\" role=\"navigation\">\n      <!-- Toggle button on navbar only for mobile -->\n      <a v-if=\"isMobile()\" href=\"#\" class=\"sidebar-toggle\" data-toggle=\"offcanvas\" role=\"button\">\n        <span class=\"sr-only\">Expand</span>\n      </a>\n      <div class=\"navbar-custom-menu\">\n        <ul class=\"nav navbar-nav\">\n        </ul>\n      </div>\n    </nav>\n  </header>\n  <!-- Left side column. contains the logo and sidebar -->\n  <sidebar></sidebar>\n  <!-- Content Wrapper. Contains page content -->\n  <div class=\"content-wrapper\" style=\"background-color:white\">\n    <viewport></viewport>\n  </div>\n  <!-- /.content-wrapper -->\n  <!-- Control Sidebar -->\n  <floatbar></floatbar>\n  <!-- /.control-sidebar -->\n  <!-- Add the sidebar's background. This div must be placed\n       immediately after the control sidebar -->\n  <div class=\"control-sidebar-bg\"></div>\n</div>\n";

},{}],5:[function(require,module,exports){
module.exports = "<aside class=\"control-sidebar control-sidebar-light\" >\n  <a v-show=\"panelsinstack\" href=\"#\" class=\"floatbar-aside-toggle\" data-toggle=\"control-sidebar\" role=\"button\">\n    <span class=\"sr-only\">Expand</span>\n  </a>\n  <div v-show=\"panelsinstack\" class=\"g3w-sidebarpanel\">\n    <div class=\"row\">\n      <div class=\"col-xs-12 col-sm-12 col-md-12\">\n        <button class=\"glyphicon glyphicon-remove pull-right close-panel-button\" @click=\"closePanel\"></button>\n      </div>\n    </div>\n    <div>\n      <h4 class=\"g3w-floatbarpanel-name\">{{ panelname }}</h2>\n    </div>\n    <div id=\"g3w-floatbarpanel-placeholder\" class=\"g3w-floatbarpanel-placeholder\"></div>\n  </div>\n</aside>\n";

},{}],6:[function(require,module,exports){
module.exports = "<li class=\"treeview\" :class=\"{'active': openOnStart}\">\n  <a href=\"#\">\n    <i :class=\"dataIcon\"></i>\n    <span class=\"treeview-label\">{{dataLabel | t}}</span>\n    <i v-if=\"(dataType === 'inline')\" class=\"fa fa-angle-left pull-right\"></i>\n  </a>\n  <ul v-if=\"(dataType === 'inline')\" class=\"treeview-menu\">\n    <div id=\"g3w-sidebarcomponent-placeholder\" class=\"g3w-sidebarpanel-placeholder\"></div>\n  </ul>\n</li>\n";

},{}],7:[function(require,module,exports){
module.exports = "<aside class=\"main-sidebar\">\n  <!-- sidebar: style can be found in sidebar.less -->\n  <!-- Sidebar toggle button-->\n  <!-- Toggle button on the left side of main sidebar only if not mobile -->\n  <a v-if=\"!isMobile()\" href=\"#\" class=\"sidebar-aside-toggle\" data-toggle=\"offcanvas\" role=\"button\">\n    <span class=\"sr-only\">Expand</span>\n  </a>\n\t<section class=\"sidebar\">\n    <div v-show=\"panelsinstack\" class=\"g3w-sidebarpanel\">\n      <div class=\"row\">\n        <div class=\"col-xs-12 col-sm-12 col-md-12\">\n          <button class=\"glyphicon glyphicon-remove pull-right close-panel-button\" @click=\"closePanel\"></button></div>\n      </div>\n      <div>\n        <h4>{{ panelname }}</h2>\n      </div>\n      <div id=\"g3w-sidebarpanel-placeholder\" class=\"g3w-sidebarpanel-placeholder\"></div>\n    </div>\n\t  <ul id=\"g3w-sidebarcomponents\" v-show=\"componentsinstack\" class=\"sidebar-menu\">\n\t    <!--<sidebar-item data-icon=\"fa fa-search\" data-label=\"search\" data-type=\"inline\">\n        <g3w-search></g3w-search>\n      </sidebar-item>\n      <sidebar-item open-on-start=\"true\" data-icon=\"fa fa-database\" data-label=\"catalog\" data-type=\"inline\">\n        <g3w-catalog></g3w-catalog>\n      </sidebar-item>\n      <sidebar-item data-icon=\"fa fa-gears\" data-label=\"tools\" data-type=\"inline\">\n        <g3w-tools></g3w-tools>\n      </sidebar-item>-->\n\t  </ul>\n\t</section>\n\t<!-- /.sidebar -->\n</aside>\n";

},{}],8:[function(require,module,exports){
module.exports = "<div>\n  <div v-if=\"primary\">\n  </div>\n</div>\n\n";

},{}],9:[function(require,module,exports){
module.exports = "<div>\n  <div id=\"g3w-map-view\"></div>\n  <div id=\"g3w-contenx-view\"></div>\n</div>\n";

},{}],10:[function(require,module,exports){
var layout = require('./layout');
var AppUI = Vue.extend({
  template: require('../html/app.html'),
  ready: function(){
    /* start to render LayoutManager layout */
    layout.loading(false);
    layout.setup();
    $("body").toggleClass("fixed");
    layout.layout.fixSidebar();
    //Fix the problem with right sidebar and layout boxed
    layout.pushMenu.expandOnHover();
    layout.layout.activate();
    layout.controlSidebar._fix($(".control-sidebar-bg"));
    layout.controlSidebar._fix($(".control-sidebar"));
    var controlsidebarEl = layout.options.controlSidebarOptions.selector;
    function setFloatBarMaxHeight(){
      $(controlsidebarEl).css('max-height',$(window).innerHeight());
      $('.g3w-sidebarpanel').height($(window).innerHeight()-$('.main-header').innerHeight());
    }
    setFloatBarMaxHeight();
    function setModalHeight(){
      $('#g3w-modal-overlay').height($(window).innerHeight());
    }
    $(window).resize(function() {
      setFloatBarMaxHeight();
      setModalHeight();
    });
   },
   methods: {
      closePanel: function(){
        sidebarService.closePanel();
      },
      isMobile: function(){return isMobile.any}
    },
});

module.exports = AppUI;

},{"../html/app.html":4,"./layout":13}],11:[function(require,module,exports){
var inherit = require('sdk/core/utils/utils').inherit;
var G3WObject = require('sdk/core/g3wobject');

function BarStack(){
  this._panels = [];
  this.state = {
    panels: []
  };
}
inherit(BarStack,G3WObject);

var proto = BarStack.prototype;

proto.push = function(panel, parent){
  var self = this;
  var id = panel.getId();
  _.forEach(self.state.panels, function(panel) {
    if (panel.id == id) {
      console.log('esiste g')
      self._panels[panel.position].unmount();
      self._panels[panel.position] = panel;
    };
  });
  panel.mount(parent)
  .then(function(){
    var position = self._panels.push(panel) - 1;
    self.state.panels.push({
        id: panel.getId(),
        title: panel.getTitle(),
        position: position
    });
  });
};

proto.pop = function(){
  // qui potremo chiedere al pannello se può essere chiuso...
  var self = this;
  var panel = this._panels.slice(-1)[0];
  panel.unmount()
  .then(function(){
    self.state.panels.pop();
    self._panels.pop();
  });
};

module.exports = BarStack;

},{"sdk/core/g3wobject":19,"sdk/core/utils/utils":40}],12:[function(require,module,exports){
var t = require('sdk/core/i18n/i18n.service').t;
var Stack = require('./barstack.js');
var GUI = require('sdk/gui/gui');

function FloatbarService(){
  this.stack = new Stack();
  
  this.init = function(layout){
    this.layout = layout;
    this.closable = true;
    this.sidebarEl = $(this.layout.options.controlSidebarOptions.selector);
    this._zindex = this.sidebarEl.css("z-index");
    this._modalOverlay = null;
    this._modal = false;
  };
  
  this.showPanel = function(panel,options){
    var options = options || {};
    var modal = options.modal || false;
    this.closable = options.closable || true;
    this.stack.push(panel,"#g3w-floatbarpanel-placeholder");
    this.layout.floatBar.open(this.sidebarEl,true);
    if (modal){
      this._modal = true;
      GUI.setModal();
      this.sidebarEl.css("z-index",5000);
      this.sidebarEl.css("padding-top","0px");
      $('.control-sidebar-bg').css("z-index",4999);
      $('.control-sidebar-bg').toggleClass('control-sidebar-bg-shadow');
    }
    
  };
  
  this.closePanel = function(){
    var panel = this.stack.pop();
    if (panel){
      if (_.hasIn(panel,"$destroy")){
        panel.$destroy();
      }
    };
    if (!this.stack.length) {
      if (this._modal){
        GUI.setModal(false);
        this.layout.floatBar.close(this.sidebarEl,true);
        $('.control-sidebar-bg').toggleClass('control-sidebar-bg-shadow');
        this.sidebarEl.css("z-index","");
        this.sidebarEl.css("padding-top","50px");
        $('.control-sidebar-bg').css("z-index","");
        this._modal = false;
      }
      else {
        this.layout.floatBar.close(this.sidebarEl,true);
      }
    }
  };
  
  this.hidePanel = function(){
    this.layout.floatBar.close(this.sidebarEl,true);
  };
}

var floatbarService = new FloatbarService();

var FloatbarComponent = Vue.extend({
    template: require('../html/floatbar.html'),
    data: function() {
    	return {
        stack: floatbarService.stack.state,
      };
    },
    computed: {
      // quanti pannelli sono attivi nello stack
      panelsinstack: function(){
        return this.stack.panels.length>0;
      },
      panelname: function(){
        var name = "";
        if (this.stack.panels.length){
          name = this.stack.panels.slice(-1)[0].name;
        }
        return name;
      },
      closable: function() {
        return floatbarService.closable;
      }
    },
    watch: {
      // TODO: Brutto, ma è l'unico (per ora) modo flessibile che ho trovato per implementare il concetto di stack... 
      "stack.panels": function(){
        var children = $("#g3w-floatbarpanel-placeholder").children();
        _.forEach(children,function(child,index){
          if (index == children.length-1){
            $(child).show();
          }
          else {
            $(child).hide();
          }
        })
      }
    },
    methods: {
      closePanel: function(){
        floatbarService.closePanel();
      }
    }
});

module.exports = {
  FloatbarService: floatbarService,
  FloatbarComponent: FloatbarComponent
}

},{"../html/floatbar.html":5,"./barstack.js":11,"sdk/core/i18n/i18n.service":22,"sdk/gui/gui":54}],13:[function(require,module,exports){
//Make sure jQuery has been loaded before app.js
if (typeof jQuery === "undefined") {
  throw new Error("LayoutManager requires jQuery");
}

$.LayoutManager = {};

/* --------------------
 * - LayoutManager Options -
 * --------------------
 * Modify these options to suit your implementation
 */
$.LayoutManager.options = {
  //Add slimscroll to navbar menus
  //This requires you to load the slimscroll plugin
  //in every page before app.js
  navbarMenuSlimscroll: true,
  navbarMenuSlimscrollWidth: "0px", //The width of the scroll bar
  navbarMenuHeight: "200px", //The height of the inner menu
  //General animation speed for JS animated elements such as box collapse/expand and
  //sidebar treeview slide up/down. This options accepts an integer as milliseconds,
  //'fast', 'normal', or 'slow'
  animationSpeed:'fast',
  //Sidebar push menu toggle button selector
  sidebarToggleSelector: "[data-toggle='offcanvas']",
  //Activate sidebar push menu
  sidebarPushMenu: true,
  //Activate sidebar slimscroll if the fixed layout is set (requires SlimScroll Plugin)
  sidebarSlimScroll: false,
  //Enable sidebar expand on hover effect for sidebar mini
  //This option is forced to true if both the fixed layout and sidebar mini
  //are used together
  sidebarExpandOnHover: false,
  //BoxRefresh Plugin
  enableBoxRefresh: true,
  //Bootstrap.js tooltip
  enableBSToppltip: true,
  BSTooltipSelector: "[data-toggle='tooltip']",
  //Enable Fast Click. Fastclick.js creates a more
  //native touch experience with touch devices. If you
  //choose to enable the plugin, make sure you load the script
  //before LayoutManager's app.js
  enableFastclick: true,
  //Control Sidebar Options
  enableControlSidebar: true,
  controlSidebarOptions: {
    //Which button should trigger the open/close event
    toggleBtnSelector: "[data-toggle='control-sidebar']",
    //The sidebar selector
    selector: ".control-sidebar",
    //Enable slide over content
    slide: true
  },
  //Box Widget Plugin. Enable this plugin
  //to allow boxes to be collapsed and/or removed
  enableBoxWidget: true,
  //Box Widget plugin options
  boxWidgetOptions: {
    boxWidgetIcons: {
      //Collapse icon
      collapse: 'fa-minus',
      //Open icon
      open: 'fa-plus',
      //Remove icon
      remove: 'fa-times'
    },
    boxWidgetSelectors: {
      //Remove button selector
      remove: '[data-widget="remove"]',
      //Collapse button selector
      collapse: '[data-widget="collapse"]'
    }
  },
  //Direct Chat plugin options
  directChat: {
    //Enable direct chat by default
    enable: true,
    //The button to open and close the chat contacts pane
    contactToggleSelector: '[data-widget="chat-pane-toggle"]'
  },
  //Define the set of colors to use globally around the website
  colors: {
    lightBlue: "#3c8dbc",
    red: "#f56954",
    green: "#00a65a",
    aqua: "#00c0ef",
    yellow: "#f39c12",
    blue: "#0073b7",
    navy: "#001F3F",
    teal: "#39CCCC",
    olive: "#3D9970",
    lime: "#01FF70",
    orange: "#FF851B",
    fuchsia: "#F012BE",
    purple: "#8E24AA",
    maroon: "#D81B60",
    black: "#222222",
    gray: "#d2d6de"
  },
  //The standard screen sizes that bootstrap uses.
  //If you change these in the variables.less file, change
  //them here too.
  screenSizes: {
    xs: 480,
    sm: 768,
    md: 992,
    lg: 1200
  }
};


/* ----------------------------------
 * - Initialize the LayoutManager Object -
 * ----------------------------------
 * All LayoutManager functions are implemented below.
 */
$.LayoutManager._init = function() {
  'use strict';
  /* Layout
   * ======
   * Fixes the layout height in case min-height fails.
   *
   * @type Object
   * @usage $.LayoutManager.layout.activate()
   *        $.LayoutManager.layout.fix()
   *        $.LayoutManager.layout.fixSidebar()
   */
  $.LayoutManager.layout = {
    activate: function () {
      var _this = this;
      _this.fix();
      _this.fixSidebar();
      $(window, ".wrapper").resize(function () {
        _this.fix();
        _this.fixSidebar();
      });
    },
    fix: function () {
      //Get window height and the wrapper height
      var neg = $('.main-header').outerHeight() + $('.main-footer').outerHeight();
      var window_height = $(window).height();
      var sidebar_height = $(".sidebar").height();
      //Set the min-height of the content and sidebar based on the
      //the height of the document.
      if ($("body").hasClass("fixed")) {
        $(".content-wrapper, .right-side").css('min-height', window_height - $('.main-footer').outerHeight());
        $(".content-wrapper, .right-side").css('height', window_height - $('.main-footer').outerHeight());
      } else {
        var postSetWidth;
        if (window_height >= sidebar_height) {
          $(".content-wrapper, .right-side").css('min-height', window_height - neg);
          postSetWidth = window_height - neg;
        } else {
          $(".content-wrapper, .right-side").css('min-height', sidebar_height);
          postSetWidth = sidebar_height;
        }
        //Fix for the control sidebar height
        var controlSidebar = $($.LayoutManager.options.controlSidebarOptions.selector);
        if (typeof controlSidebar !== "undefined") {
          if (controlSidebar.height() > postSetWidth)
            $(".content-wrapper, .right-side").css('min-height', controlSidebar.height());
        }

      }
    },
    fixSidebar: function () {
      //Make sure the body tag has the .fixed class
      if (!$("body").hasClass("fixed")) {
        if (typeof $.fn.slimScroll != 'undefined') {
          $(".sidebar").slimScroll({destroy: true}).height("auto");
        }
        return;
      } else if (typeof $.fn.slimScroll == 'undefined' && window.console) {
        window.console.error("Error: the fixed layout requires the slimscroll plugin!");
      }
      //Enable slimscroll for fixed layout
      if ($.LayoutManager.options.sidebarSlimScroll) {
        if (typeof $.fn.slimScroll != 'undefined') {
          //Destroy if it exists
          $(".sidebar").slimScroll({destroy: true}).height("auto");
          //Add slimscroll
          $(".sidebar").slimscroll({
            height: ($(window).height() - $(".main-header").height()) + "px",
            color: "rgba(255,255,255,0.7)",
            size: "3px"
          });
        }
      }
      else {
         $(".sidebar").css({'height': ($(window).height() - $(".main-header").height()) + "px"})
      }
    }
  };

  /* PushMenu()
   * ==========
   * Adds the push menu functionality to the sidebar.
   *
   * @type Function
   * @usage: $.LayoutManager.pushMenu("[data-toggle='offcanvas']")
   */
  $.LayoutManager.pushMenu = {
    activate: function (toggleBtn) {
      //Get the screen sizes
      var screenSizes = $.LayoutManager.options.screenSizes;

      //Enable sidebar toggle
      $(toggleBtn).on('click', function (e) {
        e.preventDefault();

        //Enable sidebar push menu
        if ($(window).width() > (screenSizes.sm - 1)) {
          if ($("body").hasClass('sidebar-collapse')) {
            $("body").removeClass('sidebar-collapse').trigger('expanded.pushMenu');
          } else {
            $("body").addClass('sidebar-collapse').trigger('collapsed.pushMenu');
          }
        }
        //Handle sidebar push menu for small screens
        else {
          if ($("body").hasClass('sidebar-open')) {
            $("body").removeClass('sidebar-open').removeClass('sidebar-collapse').trigger('collapsed.pushMenu');
          } else {
            $("body").addClass('sidebar-open').trigger('expanded.pushMenu');
          }
        }
      });

      $(".content-wrapper").click(function () {
        //Enable hide menu when clicking on the content-wrapper on small screens
        if ($(window).width() <= (screenSizes.sm - 1) && $("body").hasClass("sidebar-open")) {
          $("body").removeClass('sidebar-open');
        }
      });

      //Enable expand on hover for sidebar mini
      if ($.LayoutManager.options.sidebarExpandOnHover || ($('body').hasClass('fixed') && $('body').hasClass('sidebar-mini'))) {
        this.expandOnHover();
      }
    },
    expandOnHover: function () {
      var _this = this;
      var screenWidth = $.LayoutManager.options.screenSizes.sm - 1;
      //Expand sidebar on hover
      $('.main-sidebar').hover(function () {
        if ($('body').hasClass('sidebar-mini') && $("body").hasClass('sidebar-collapse') && $(window).width() > screenWidth) {
          _this.expand();
        }
      }, function () {
        if ($('body').hasClass('sidebar-mini') && $('body').hasClass('sidebar-expanded-on-hover') && $(window).width() > screenWidth) {
          _this.collapse();
        }
      });
    },
    expand: function () {
      $("body").removeClass('sidebar-collapse').addClass('sidebar-expanded-on-hover');
    },
    collapse: function () {
      if ($('body').hasClass('sidebar-expanded-on-hover')) {
        $('body').removeClass('sidebar-expanded-on-hover').addClass('sidebar-collapse');
      }
    }
  };

  /* Tree()
   * ======
   * Converts the sidebar into a multilevel
   * tree view menu.
   *
   * @type Function
   * @Usage: $.LayoutManager.tree('.sidebar')
   */
  $.LayoutManager.tree = function (menu) {
    var _this = this;
    var animationSpeed = $.LayoutManager.options.animationSpeed;
    //click event //
    $(document).on('click', menu + ' li a', function (e) {

      //Get the clicked link and the next element
      var $this = $(this);
      //is the content of the "accordion" ul //
      var checkElement = $this.next();

      //Check if the next element is a menu and is visible
      if ((checkElement.is('.treeview-menu')) && (checkElement.is(':visible'))) {
        //Close the menu
        checkElement.slideUp(animationSpeed, function () {
          checkElement.parent("li.treeview").removeClass("active");
          checkElement.removeClass('menu-open');
          //Fix the layout in case the sidebar stretches over the height of the window
          //_this.layout.fix();
        });

      }
      //If the menu is not visible
      else if ((checkElement.is('.treeview-menu')) && (!checkElement.is(':visible'))) {
        //Get the parent menu
        var parent = $this.parents('ul').first();
        var parent_li = $this.parent("li");
        var li_siblings = parent_li.siblings();
        var parent_find_active;
        var sidebar_content_height = parent.height() - parent.find('li.header').outerHeight();
        var treeviewHeight = parent_li.outerHeight();
        li_siblings.not('.header').each(function(index, el) {
                treeviewHeight+=$(el).find('a').outerHeight();
        });
        var section_height = (sidebar_content_height - treeviewHeight);
        checkElement.css({
          'height': section_height + 'px',
          'max-height':section_height + 'px',
          'overflow-y': 'auto'
        });
        //Close all open menus within the parent
        var ul = parent.find('ul.treeview-menu:visible').slideUp(animationSpeed);
        //Remove the menu-open class from the parent
        ul.removeClass('menu-open');
        //Get the parent li
        //Open the target menu and add the menu-open class
        checkElement.slideDown(animationSpeed, function () {
          //Add the class active to the parent li
          checkElement.addClass('menu-open');
          parent_find_active = parent.find('li.treeview.active');
          parent_find_active.removeClass('active');
          parent_li.addClass('active');
          //Fix the layout in case the sidebar stretches over the height of the window
          _this.layout.fix();
        });
      }
      //if this isn't a link, prevent the page from being redirected
      if (checkElement.is('.treeview-menu')) {
        e.preventDefault();
      }
    });
  };

  /* ControlSidebar
   * ==============
   * Adds functionality to the right sidebar
   *
   * @type Object
   * @usage $.LayoutManager.controlSidebar.activate(options)
   */
  $.LayoutManager.floatBar = $.LayoutManager.controlSidebar = {
    //instantiate the object
    activate: function () {
      //Get the object
      var _this = this;
      //Update options
      var o = $.LayoutManager.options.controlSidebarOptions;
      //Get the sidebar
      var sidebar = $(o.selector);
      //The toggle button
      var btn = $(o.toggleBtnSelector);

      //Listen to the click event
      btn.on('click', function (e) {
        e.preventDefault();
        //If the sidebar is not open
        if (!sidebar.hasClass('control-sidebar-open') && !$('body').hasClass('control-sidebar-open')) {
          //Open the sidebar
          _this.open(sidebar, o.slide);
        } else {
          _this.close(sidebar, o.slide);
        }
      });

      //If the body has a boxed layout, fix the sidebar bg position
      var bg = $(".control-sidebar-bg");
      _this._fix(bg);

      //If the body has a fixed layout, make the control sidebar fixed
      if ($('body').hasClass('fixed')) {
        _this._fixForFixed(sidebar);
      } else {
        //If the content height is less than the sidebar's height, force max height
        if ($('.content-wrapper, .right-side').height() < sidebar.height()) {
          _this._fixForContent(sidebar);
        }
      }
    },
    //Open the control sidebar
    open: function (sidebar, slide) {
      //Slide over content
      if (slide) {
        sidebar.addClass('control-sidebar-open');
      } else {
        //Push the content by adding the open class to the body instead
        //of the sidebar itself
        $('body').addClass('control-sidebar-open');
      }
    },
    //Close the control sidebar
    close: function (sidebar, slide) {
      if (slide) {
        sidebar.removeClass('control-sidebar-open');
      } else {
        $('body').removeClass('control-sidebar-open');
      }
    },
    _fix: function (sidebar) {
      var _this = this;
      if ($("body").hasClass('layout-boxed')) {
        sidebar.css('position', 'absolute');
        sidebar.height($(".wrapper").height());
        $(window).resize(function () {
          _this._fix(sidebar);
        });
      } else {
        sidebar.css({
          'position': 'fixed',
          'height': 'auto'
        });
      }
    },
    _fixForFixed: function (sidebar) {
      sidebar.css({
        'position': 'fixed',
        'max-height': '100%',
        'overflow': 'auto',
        'padding-bottom': '50px'
      });
    },
    _fixForContent: function (sidebar) {
      $(".content-wrapper, .right-side").css('min-height', sidebar.height());
    }
  };

  /* BoxWidget
   * =========
   * BoxWidget is a plugin to handle collapsing and
   * removing boxes from the screen.
   *
   * @type Object
   * @usage $.LayoutManager.boxWidget.activate()
   *        Set all your options in the main $.LayoutManager.options object
   */
  $.LayoutManager.boxWidget = {
    selectors: $.LayoutManager.options.boxWidgetOptions.boxWidgetSelectors,
    icons: $.LayoutManager.options.boxWidgetOptions.boxWidgetIcons,
    animationSpeed: $.LayoutManager.options.animationSpeed,
    activate: function (_box) {
      var _this = this;
      if (!_box) {
        _box = document; // activate all boxes per default
      }
      //Listen for collapse event triggers
      $(_box).on('click', _this.selectors.collapse, function (e) {
        e.preventDefault();
        _this.collapse($(this));
      });

      //Listen for remove event triggers
      $(_box).on('click', _this.selectors.remove, function (e) {
        e.preventDefault();
        _this.remove($(this));
      });
    },
    collapse: function (element) {
      var _this = this;
      //Find the box parent
      var box = element.parents(".box").first();
      //Find the body and the footer
      var box_content = box.find("> .box-body, > .box-footer, > form  >.box-body, > form > .box-footer");
      if (!box.hasClass("collapsed-box")) {
        //Convert minus into plus
        element.children(":first")
                .removeClass(_this.icons.collapse)
                .addClass(_this.icons.open);
        //Hide the content
        box_content.slideUp(_this.animationSpeed, function () {
          box.addClass("collapsed-box");
        });
      } else {
        //Convert plus into minus
        element.children(":first")
                .removeClass(_this.icons.open)
                .addClass(_this.icons.collapse);
        //Show the content
        box_content.slideDown(_this.animationSpeed, function () {
          box.removeClass("collapsed-box");
        });
      }
    },
    remove: function (element) {
      //Find the box parent
      var box = element.parents(".box").first();
      box.slideUp(this.animationSpeed);
    }
  };
  
  return $.LayoutManager;
};

/* ------------------
 * - Custom Plugins -
 * ------------------
 * All custom plugins are defined below.
 */

/*
 * BOX REFRESH BUTTON
 * ------------------
 * This is a custom plugin to use with the component BOX. It allows you to add
 * a refresh button to the box. It converts the box's state to a loading state.
 *
 * @type plugin
 * @usage $("#box-widget").boxRefresh( options );
 */
$.LayoutManager.addRefreshButton = function () {
  "use strict";

  $.fn.boxRefresh = function (options) {

    // Render options
    var settings = $.extend({
      //Refresh button selector
      trigger: ".refresh-btn",
      //File source to be loaded (e.g: ajax/src.php)
      source: "",
      //Callbacks
      onLoadStart: function (box) {
        return box;
      }, //Right after the button has been clicked
      onLoadDone: function (box) {
        return box;
      } //When the source has been loaded

    }, options);

    //The overlay
    var overlay = $('<div class="overlay"><div class="fa fa-refresh fa-spin"></div></div>');

    return this.each(function () {
      //if a source is specified
      if (settings.source === "") {
        if (window.console) {
          window.console.log("Please specify a source first - boxRefresh()");
        }
        return;
      }
      //the box
      var box = $(this);
      //the button
      var rBtn = box.find(settings.trigger).first();

      //On trigger click
      rBtn.on('click', function (e) {
        e.preventDefault();
        //Add loading overlay
        start(box);

        //Perform ajax call
        box.find(".box-body").load(settings.source, function () {
          done(box);
        });
      });
    });

    function start(box) {
      //Add overlay and loading img
      box.append(overlay);

      settings.onLoadStart.call(box);
    }

    function done(box) {
      //Remove overlay and loading img
      box.find(overlay).remove();

      settings.onLoadDone.call(box);
    }

  };
  return $.LayoutManager;
};

/*
 * EXPLICIT BOX ACTIVATION
 * -----------------------
 * This is a custom plugin to use with the component BOX. It allows you to activate
 * a box inserted in the DOM after the app.js was loaded.
 *
 * @type plugin
 * @usage $("#box-widget").activateBox();
 */
$.LayoutManager.activateBox = function () {
  'use strict';

  $.fn.activateBox = function () {
    $.LayoutManager.boxWidget.activate(this);
  };
  
  return $.LayoutManager;
};

/*
 * TODO LIST CUSTOM PLUGIN
 * -----------------------
 * This plugin depends on iCheck plugin for checkbox and radio inputs
 *
 * @type plugin
 * @usage $("#todo-widget").todolist( options );
 */

$.LayoutManager.listCustomPlugin = function () {

	  'use strict';

	  $.fn.todolist = function (options) {
	    // Render options
	    var settings = $.extend({
	      //When the user checks the input
	      onCheck: function (ele) {
	        return ele;
	      },
	      //When the user unchecks the input
	      onUncheck: function (ele) {
	        return ele;
	      }
	    }, options);

	    return this.each(function () {

	      if (typeof $.fn.iCheck != 'undefined') {
	        $('input', this).on('ifChecked', function () {
	          var ele = $(this).parents("li").first();
	          ele.toggleClass("done");
	          settings.onCheck.call(ele);
	        });

	        $('input', this).on('ifUnchecked', function () {
	          var ele = $(this).parents("li").first();
	          ele.toggleClass("done");
	          settings.onUncheck.call(ele);
	        });
	      } else {
	        $('input', this).on('change', function () {
	          var ele = $(this).parents("li").first();
	          ele.toggleClass("done");
	          if ($('input', ele).is(":checked")) {
	            settings.onCheck.call(ele);
	          } else {
	            settings.onUncheck.call(ele);
	          }
	        });
	      }
	    });
	  };
	  return $.LayoutManager;
	};
	
	/* ------------------
	 * - Implementation -
	 * ------------------
	 * The next block of code implements LayoutManager's
	 * functions and plugins as specified by the
	 * options above.
	 */
	$.LayoutManager.setup = function ()
	{
	  "use strict";

	  //Fix for IE page transitions
	  $("body").removeClass("hold-transition");

	  //Extend options if external options exist
	  if (typeof LayoutManagerOptions !== "undefined") {
	    $.extend(true,
	            $.LayoutManager.options,
	            LayoutManagerOptions);
	  }

	  //Easy access to options
	  var o = $.LayoutManager.options;

	  //Set up the object
	  $.LayoutManager._init();

	  //Activate the layout maker
	  $.LayoutManager.layout.activate();

	  //Enable sidebar tree view controls
	  $.LayoutManager.tree('.sidebar');

	  //Enable control sidebar
	  if (o.enableControlSidebar) {
	    $.LayoutManager.controlSidebar.activate();
	  }

	  //Add slimscroll to navbar dropdown
	  if (o.navbarMenuSlimscroll && typeof $.fn.slimscroll != 'undefined') {
	    $(".navbar .menu").slimscroll({
	      height: o.navbarMenuHeight,
	      alwaysVisible: false,
	      size: o.navbarMenuSlimscrollWidth
	    }).css("width", "100%");
	  }

	  //Activate sidebar push menu
	  if (o.sidebarPushMenu) {
	    $.LayoutManager.pushMenu.activate(o.sidebarToggleSelector);
	  }

	  //Activate Bootstrap tooltip
	  if (o.enableBSToppltip) {
	    $('body').tooltip({
	      selector: o.BSTooltipSelector
	    });
	  }

	  //Activate box widget
	  if (o.enableBoxWidget) {
	    $.LayoutManager.boxWidget.activate();
	  }

	  //Activate fast click
	  if (o.enableFastclick && typeof FastClick != 'undefined') {
	    FastClick.attach(document.body);
	  }

	  //Activate direct chat widget
	  if (o.directChat.enable) {
	    $(document).on('click', o.directChat.contactToggleSelector, function () {
	      var box = $(this).parents('.direct-chat').first();
	      box.toggleClass('direct-chat-contacts-open');
	    });
	  }

	  /*
	   * INITIALIZE BUTTON TOGGLE
	   * ------------------------
	   */
	  $('.btn-group[data-toggle="btn-toggle"]').each(function () {
	    var group = $(this);
	    $(this).find(".btn").on('click', function (e) {
	      group.find(".btn.active").removeClass("active");
	      $(this).addClass("active");
	      e.preventDefault();
	    });

	  });
	  
	  return $.LayoutManager
	  	.addRefreshButton()
	  	.activateBox()
	  	.listCustomPlugin();
	};

$.LayoutManager.loading = function(start){
  var start = _.isBoolean(start) ? start : true;
  if (start) {
    $('body').append('<div id="loadspinner" class="loading"></div>');
  }
  else {
    $('#loadspinner').remove();
  }
}

module.exports = $.LayoutManager;

},{}],14:[function(require,module,exports){
var t = require('sdk/core/i18n/i18n.service').t;
var Stack = require('./barstack.js');

//sidebar item che non è altro che un li della sidebar dove sarà possobile impostare
//titolo tipo di icona etc .. customizzata per ogni componente

var SidebarItem = Vue.extend({
  template: require('../html/sidebar-item.html'),
  data: function() {
    return {
        main: true,
        component: null,
        active: false,
        dataType: 'inline',
        dataLabel: 'component',
        dataIcon: null,
        openOnStart: true
      };
  }
});

function SidebarService(){
  this.stack = new Stack();
  this.state = {
    components: []
  };
  
  this.init = function(layout){
    this.layout = layout;
  };
  
  this.addComponent = function(component){
    //aggiungo componente
    this.state.components.push(component);
    //faccio montare il sedebar-item che contiene al suo interno il placeholder del componente vero e proprio
    //in questo modo il componente non si dovrà occupare di costruire anche l'elemento li della sidebar
    //ma conterrà solo il contenuto
    var sidebarItem = new SidebarItem().$mount().$appendTo('#g3w-sidebarcomponents');
    //setto le parti della sidebar-item che cambiano da componente a componente (da rivedere)
    sidebarItem.dataLabel = component.title || sidebarItem.dataLabel;
    sidebarItem.openOnStart = (component.openOnStart === undefined) ? sidebarItem.openOnStart : component.openOnStart;
    sidebarItem.dataIcon = component.dataIcon || sidebarItem.dataIcon;
    //monto il componete nella sidebar
    component.mount("#g3w-sidebarcomponent-placeholder");
    if (_.has(component, 'initService')) {
      component.initService();
    };
  };
  
  this.removeComponent = function(){
    //da vedere
  };

  this.showPanel = function(panel){
    var parent = "#g3w-sidebarpanel-placeholder";
    this.stack.push(panel, parent);
  };

  this.closePanel = function(){
    var panel = this.stack.pop();
  };
}

var sidebarService = new SidebarService();

var SidebarComponent = Vue.extend({
    template: require('../html/sidebar.html'),
    data: function() {
    	return {
        components: sidebarService.state.components,
        panels: sidebarService.stack.state.panels,
        bOpen: true,
    		bPageMode: false,
    		header: t('main navigation'),
        };
    },
    computed: {
      // quanti pannelli sono attivi nello stack
      panelsinstack: function(){
        return this.panels.length>0;
      },
      componentsinstack: function(){
        return this.components.length>0;
      },
      componentname: function(){
        var name = "";
        if (this.components.length){
          name = this.components.slice(-1)[0].getName();
        }
        return name;
      },
      panelname: function(){
        var name = "";
        if (this.panels.length){
          name = this.panels.slice(-1)[0].name;
        }
        return name;
      }
    },
    methods: {
      closePanel: function(){
        sidebarService.closePanel();
      },
      isMobile: function(){
        return isMobile.any
      }
    },
    ready: function(){
    }
});

module.exports = {
  SidebarService: sidebarService,
  SidebarComponent: SidebarComponent
}

},{"../html/sidebar-item.html":6,"../html/sidebar.html":7,"./barstack.js":11,"sdk/core/i18n/i18n.service":22}],15:[function(require,module,exports){
var t = require('sdk/core/i18n/i18n.service').t;
require('sdk/gui/vue/vue.directives');
var ComponentsRegistry = require('sdk/gui/componentsregistry');
var GUI = require('sdk/gui/gui');
// temporaneo per far funzionare le cose
var config = {
    client:{}
};

var sidebar = require('./sidebar');
var floatbar = require('./floatbar');
var ViewportService = require('./viewport');
var AppUI = require('./applicationui');
var layout = require('./layout');

// forse da trovare un posto migliore per attivare lo spinner iniziale...
layout.loading();

var ApplicationTemplate = function(templateConfig, ApplicationService) {
  self = this;
  this.templateConfig = templateConfig;
  this.ApplicationService = ApplicationService;
  
  this.init = function() {
    var config = ApplicationService.getConfig();
    if (config.debug){
      Vue.config.debug = true;
    }
    this._setupInterface();
    this._setupLayout();
  };
  
  this._setupLayout = function(){  
    Vue.filter('t', function (value) {
      return t(value);
    });

    var SidebarComponent = require('./sidebar').SidebarComponent;
    var FloatbarComponent = require('./floatbar').FloatbarComponent;
    var AppUI = require('./applicationui');

    Vue.component('sidebar', SidebarComponent);
    Vue.component('floatbar', FloatbarComponent);
    Vue.component('app', AppUI);

    //inizializza l'applicazione Vue
    var template = this;  
    var app = new Vue({
      el: 'body',
      ready: function(){
        $(document).localize();
        self._buildTemplate();
      }
    });
  }
  
  this._buildTemplate = function() {
    var self = this;
    var placeholdersConfig = this.templateConfig.placeholders;
    _.forEach(placeholdersConfig, function(components, placeholder){
      // per ogni placeholder ci possono essere più componenti ciclo e aggiungo
     _.forEach(components.components, function(component){
        self._addComponent(placeholder, component);
      });
    });
    var mapComponent = this.templateConfig.viewport.map;
    ViewportService.init(mapComponent,null);
    GUI.ready();
  };
  
  this._addComponent = function(placeholder, component) {
    if (ApplicationTemplate.PLACEHOLDERS.indexOf(placeholder) > -1){
      var placeholderService = ApplicationTemplate.PlaceholdersServices[placeholder];
      if (placeholderService) {
        placeholderService.addComponent(component);
        ComponentsRegistry.addComponent(component);
      }
    }
  };
  
  this._removeComponent = function(plceholder,componentId) {
    ComponentsRegistry.removeComponent(component);
  };

  this._showSidebar = function() {
    //codice qui
  };
  this._hideSidebar = function() {
    //codice qui
  };
  
  this._addToolsGroup = function(groupName) {
  };
  
  this._removeToolsGroup = function(groupName) {
  };
  
  this._addTools = function(group,tools) {
  };
  
  this._removeTool = function(toolId) {
  };
  
  this._setupInterface = function() {
    /* DEFINIZIONE INTERFACCIA PUBBLICA */
    
    /* Metodi comuni a tutti i template */
    
    GUI.addComponent = _.bind(this._addComponent, this);
    GUI.removeComponent = _.bind(this._removeComponent, this);
    
    /* Metodi da definire (tramite binding) */
    GUI.getResourcesUrl = _.bind(function() {
      return this.ApplicationService.config.resourcesurl;
    },this);

    GUI.showForm = function() {};
    GUI.closeForm = function() {};
    GUI.showList = function() {};
    GUI.closeList = function() {};
    GUI.showTable = function() {};
    GUI.closeTable = function() {};

    //temporaneo show panel
    GUI.showPanel = _.bind(sidebar.SidebarService.showPanel, sidebar.SidebarService);
    GUI.closePanel = _.bind(sidebar.SidebarService.closePanel, sidebar.SidebarService);
    /* ------------------ */

    toastr.options.positionClass = 'toast-top-center';
    toastr.options.preventDuplicates = true;
    // proxy della libreria toastr
    GUI.notify = toastr;
    // proxy della libreria bootbox
    GUI.dialog = bootbox;
    /* spinner */
    GUI.showSpinner = function() {};
    GUI.hideSpinner = function() {};
    /* end spinner*/

    /* fine metodi comuni */
    
    /* Metodi specifici del template */
    
    GUI.showFloatbar = function() {};
    GUI.hideFloatbar = function() {};
    
    GUI.showSidebar = _.bind(this._showSidebar, this);
    GUI.hideSidebar = _.bind(this._hideSidebar, this);
    
    GUI.addToolsGroup = _.bind(this._addToolsGroup,this);
    GUI.removeToolsGroup = _.bind(this._removeToolsGroup,this);
    GUI.addTool = _.bind(this._addTools,this);
    GUI.removeTool = _.bind(this._removeTool,this);
    
    /* fine metodi specifici */
    
    /* FINE DEFINIZIONE INTERFACCIA PUBBLICA */
  };
  
};

ApplicationTemplate.PLACEHOLDERS = [
  'navbar',
  'sidebar',
  'map',
  'content',
  'floatbar'
];

ApplicationTemplate.PlaceholdersServices = {
  navbar: null,
  sidebar: sidebar.SidebarService,
  map: null,
  content: null,
  floatbar: sidebar.FloatbarService,
};

module.exports =  ApplicationTemplate;


},{"./applicationui":10,"./floatbar":12,"./layout":13,"./sidebar":14,"./viewport":16,"sdk/core/i18n/i18n.service":22,"sdk/gui/componentsregistry":53,"sdk/gui/gui":54,"sdk/gui/vue/vue.directives":77}],16:[function(require,module,exports){
var inherit = require('core/utils/utils').inherit;
var base = require('core/utils/utils').base;
var merge = require('core/utils/utils').merge;
var G3WObject = require('core/g3wobject');

var View = Vue.extend({
  template: require('../html/view.html'),
  replace: false,
  data: function(){
    return {
      primary: false,
      width: 3,
      visible: false
    }
  }
});

var ViewportComponent = Vue.component('viewport',{
  template: require('../html/viewport.html'),
  components: {
    map: View,
    content: View
  }
})

var ViewportService = function(){  
  this.state = {
    primaryView: 'map'
  };
  
  this.views = {
    map: null,
    contenx: null
  }

  this.init = function(mapComponent, contentxComponent) {
    var mapView = new View({
      el: '#g3w-map-view'
    });
    this.views['map'] = mapView;
    
    var contentxView = new View({
      el: '#g3w-contenx-view'
    });
    this.views['contentx'] = contentxView;
    
    this.setPrimaryView('map');

    // monto la mappa
    mapComponent.mount('#g3w-contenx-view');
    // monto il contentx
    //contentxComponent.mount(#g3w-contenx-view);
  }
  
  this.setPrimaryView = function(viewName) {
    this.state.primaryView = viewName;
    _.forEach(this.view,function(view){
      view.primary = false;
    })
    this.views[viewName].primary = true;
  };
  
  this.showSecondaryView = function(widthClass) {
    if ([2,3].indexOf(widthClass) > -1) {
      // 1/2 o 1/3
    }
  };
  
  this.getContentView = function() {
    return this.state,views['contentx'].component;
  }
};
inherit(ViewportService, G3WObject);

module.exports = new ViewportService;

},{"../html/view.html":8,"../html/viewport.html":9,"core/g3wobject":19,"core/utils/utils":40}],17:[function(require,module,exports){
var inherit = require('core/utils/utils').inherit;
var base = require('core/utils/utils').base;
var G3WObject = require('core/g3wobject');
var reject = require('core/utils/utils').reject;

function ApiService(){
  this._config = null;
  this._baseUrl = null;
  this._apiUrls = {};
  
  this.init = function(config) {
    this._config = config;
    this._baseUrl = config.urls.api;
    this._apiEndpoints = config.urls.apiEndpoints;
  };
  
  var howManyAreLoading = 0;
  this._incrementLoaders = function(){
    if (howManyAreLoading == 0){
      this.emit('apiquerystart');
    }
    howManyAreLoading += 1;
  };
  
  this._decrementLoaders = function(){
    howManyAreLoading -= 1;
    if (howManyAreLoading == 0){
      this.emit('apiqueryend');
    }
  };
  
  this.get = function(api,options) {
    var self = this;
    var apiEndPoint = this._apiEndpoints[api];
    if (apiEndPoint) {
      var completeUrl = this._baseUrl + '/' + apiEndPoint;
      if (options.request) {
         completeUrl = completeUrl + '/' + options.request;
      }
      var params = options.params || {};
      
      self.emit(api+'querystart');
      this._incrementLoaders();
      return $.get(completeUrl,params)
      .done(function(response){
        self.emit(api+'queryend',response);
        return response;
      })
      .fail(function(e){
        self.emit(api+'queryfail',e);
        return e;
      })
      .always(function(){
        self._decrementLoaders();
      });
    }
    else {
      return reject();
    }
  };
  
  base(this);
}
inherit(ApiService,G3WObject);

module.exports = new ApiService;

},{"core/g3wobject":19,"core/utils/utils":40}],18:[function(require,module,exports){
var inherit = require('core/utils/utils').inherit;
var base = require('core/utils/utils').base;
var G3WObject = require('core/g3wobject');
var ApiService = require('core/apiservice');
var ProjectsRegistry = require('core/project/projectsregistry');
var PluginsRegistry = require('core/plugin/pluginsregistry');

var ApplicationService = function(){
  this.secret = "### G3W Client Application Service ###";
  var self = this;
  this.initialized = false;
  this._modalOverlay = null;
  this.config = {};

  // chiama il costruttore di G3WObject (che in questo momento non fa niente)
  base(this);
  
  this.init = function(config){
    this._config = config;
    this._bootstrap();
  };
  
  this.getConfig = function() {
    return this._config;
  };
  
  this._bootstrap = function(){
    var self = this;
    if (!this.initialized){
      //inizializza la configurazione dei servizi. Ognungo cercherà dal config quello di cui avrà bisogno
      //una volta finita la configurazione emetto l'evento ready. A questo punto potrò avviare l'istanza Vue globale
      $.when(
        ApiService.init(this._config),
        ProjectsRegistry.init(this._config),
        PluginsRegistry.init({
          plusingBaseUrl: this._config.urls.staticurl,
          pluginsConfigs: this._config.plugins
        })
      ).then(function(){
        self.emit('ready');
        this.initialized = true;
      });
    };
  };
};
inherit(ApplicationService,G3WObject);

module.exports = new ApplicationService;

},{"core/apiservice":17,"core/g3wobject":19,"core/plugin/pluginsregistry":32,"core/project/projectsregistry":34,"core/utils/utils":40}],19:[function(require,module,exports){
var inherit = require('core/utils/utils').inherit;
var noop = require('core/utils/utils').noop;

/**
 * Un oggetto base in grado di gestire eventuali setter e relativa catena di listeners.
 * @constructor
 */
var G3WObject = function(){
  if (this.setters){
    this._setupListenersChain(this.setters);
  }
};
inherit(G3WObject,EventEmitter);

var proto = G3WObject.prototype;

/**
 * Inserisce un listener dopo che è stato eseguito il setter
 * @param {string} setter - Il nome del metodo su cui si cuole registrare una funzione listener
 * @param {function} listener - Una funzione listener (solo sincrona)
 */
proto.onafter = function(setter,listener){
  return this._onsetter('after',setter,listener,false);
};

// un listener può registrarsi in modo da essere eseguito PRIMA dell'esecuzione del metodo setter. Può ritornare true/false per
// votare a favore o meno dell'esecuzione del setter. Se non ritorna nulla o undefined, non viene considerato votante
/**
 * Inserisce un listener prima che venga eseguito il setter. Se ritorna false il setter non viene eseguito
 * @param {string} setter - Il nome del metodo su cui si cuole registrare una funzione listener
 * @param {function} listener - Una funzione listener, a cui viene passato una funzione "next" come ultimo parametro, da usare nel caso di listener asincroni
 */
proto.onbefore = function(setter,listener){
  return this._onsetter('before',setter,listener,false);
};

/**
 * Inserisce un listener prima che venga eseguito il setter. Al listener viene passato una funzione "next" come ultimo parametro, da chiamare con parametro true/false per far proseguire o meno il setter
 * @param {string} setter - Il nome del metodo su cui si cuole registrare una funzione listener
 * @param {function} listener - Una funzione listener, a cui 
 */
proto.onbeforeasync = function(setter,listener){
  return this._onsetter('before',setter,listener,true);
};

proto.un = function(setter,key){
  _.forEach(this.settersListeners,function(settersListeners,when){
    _.forEach(settersListeners[setter],function(setterListener){
      if(setterListener.key == key){
        delete setterListener;
      }
    })
  })
};

proto._onsetter = function(when,setter,listener,async){ /*when=before|after, type=sync|async*/
  var settersListeners = this.settersListeners[when];
  var listenerKey = ""+Math.floor(Math.random()*1000000)+""+Date.now();
  /*if ((when == 'before') && !async){
    listener = this._makeChainable(listener);
  }*/
  settersListeners[setter].push({
    key: listenerKey,
    fnc: listener,
    async: async
  });
  return listenerKey;
  //return this.generateUnListener(setter,listenerKey);
};

// trasformo un listener sincrono in modo da poter essere usato nella catena di listeners (richiamando next col valore di ritorno del listener)
/*proto._makeChainable = function(listener){
  var self = this
  return function(){
    var args = Array.prototype.slice.call(arguments);
    // rimuovo next dai parametri prima di chiamare il listener
    var next = args.pop();
    var canSet = listener.apply(self,arguments);
    var _canSet = true;
    if (_.isBoolean(canSet)){
      _canSet = canSet;
    }
    next(canSet);
  }
};*/

proto._setupListenersChain = function(setters){
  // inizializza tutti i metodi definiti nell'oggetto "setters" della classe figlia.
  var self = this;
  this.settersListeners = {
    after:{},
    before:{}
  };
  // per ogni setter viene definito l'array dei listeners e fiene sostituito il metodo originale con la funzioni che gestisce la coda di listeners
  _.forEach(setters,function(setterOption,setter){
    var setterFnc = noop;
    var setterFallback = noop;
    if (_.isFunction(setterOption)){
      setterFnc = setterOption
    }
    else {
      setterFnc = setterOption.fnc;
      setterFallback = setterOption.fallback || noop;
    }
    self.settersListeners.after[setter] = [];
    self.settersListeners.before[setter] = [];
    // setter sostituito
    self[setter] = function(){
      var args = arguments;
      // eseguo i listener registrati per il before
      var deferred = $.Deferred();
      var returnVal = null;
      var counter = 0;
      var canSet = true;
      
      // richiamata alla fine della catena di listeners
      function done(){
        if(canSet){
          // eseguo la funzione
          returnVal = setterFnc.apply(self,args);
          // e risolvo la promessa (eventualmente utilizzata da chi ha invocato il setter
          deferred.resolve(returnVal);
          
          var afterListeners = self.settersListeners.after[setter];
          _.forEach(afterListeners,function(listener, key){
            listener.fnc.apply(self,args);
          })
        }
        else {
          // se non posso proseguire 
          // chiamo l'eventuale funzione di fallback
          setterFallback.apply(self,args);
          // e rigetto la promessa
          deferred.reject();
        }
      };
      
      function complete(){
        // eseguo la funzione
        returnVal = setterFnc.apply(self,args);
        // e risolvo la promessa (eventualmente utilizzata da chi ha invocato il setter
        deferred.resolve(returnVal);
        
        var afterListeners = self.settersListeners.after[setter];
        _.forEach(afterListeners,function(listener, key){
          listener.fnc.apply(self,args);
        })
      }
      
      function abort(){
          // se non posso proseguire ...
          // chiamo l'eventuale funzione di fallback
          setterFallback.apply(self,args);
          // e rigetto la promessa
          deferred.reject();
      }
      
      var beforeListeners = this.settersListeners['before'][setter];
      // contatore dei listener che verrà decrementato ad ogni chiamata a next()
      counter = 0;
      
      // funzione passata come ultimo parametro ai listeners, che ***SE SONO STATI AGGIUNTI COME ASINCRONI la DEVONO*** richiamare per poter proseguire la catena
      function next(bool){
        var cont = true;
        if (_.isBoolean(bool)){
          cont = bool;
        }
        var _args = Array.prototype.slice.call(args);
        // se la catena è stata bloccata o se siamo arrivati alla fine dei beforelisteners
        if (cont === false || (counter == beforeListeners.length)){
          if(cont === false)
            abort.apply(self,args);
          else{
            completed = complete.apply(self,args);
            if(_.isUndefined(completed) || completed === true){
              self.emitEvent('set:'+setter,args);
            }
          }
        }
        else {
          if (cont){
            var listenerFnc = beforeListeners[counter].fnc;
            if (beforeListeners[counter].async){
              // aggiungo next come ulitmo parametro
              _args.push(next);
              counter += 1;
              listenerFnc.apply(self,_args)
            }
            else {
              var _cont = listenerFnc.apply(self,_args);
              counter += 1;
              next(_cont);
            }
          }
        }
      }
      
      next();
      return deferred.promise();
    }
  })
};

/*
proto.generateUnListener = function(settersListeners,setter,listenerKey){
  var self = this;
  return function(){
    settersListeners[setter][listenerKey] = null;
    delete settersListeners[setter][listenerKey];
  }
};
*/

module.exports = G3WObject;

},{"core/utils/utils":40}],20:[function(require,module,exports){
var geom = {
  distance: function(c1,c2){
    return Math.sqrt(geom.squaredDistance(c1,c2));
  },
  squaredDistance: function(c1,c2){
    var x1 = c1[0];
    var y1 = c1[1];
    var x2 = c2[0];
    var y2 = c2[1];
    var dx = x2 - x1;
    var dy = y2 - y1;
    return dx * dx + dy * dy;
  },
  closestOnSegment: function(coordinate, segment) {
    var x0 = coordinate[0];
    var y0 = coordinate[1];
    var start = segment[0];
    var end = segment[1];
    var x1 = start[0];
    var y1 = start[1];
    var x2 = end[0];
    var y2 = end[1];
    var dx = x2 - x1;
    var dy = y2 - y1;
    var along = (dx === 0 && dy === 0) ? 0 :
        ((dx * (x0 - x1)) + (dy * (y0 - y1))) / ((dx * dx + dy * dy) || 0);
    var x, y;
    if (along <= 0) {
      x = x1;
      y = y1;
    } else if (along >= 1) {
      x = x2;
      y = y2;
    } else {
      x = x1 + along * dx;
      y = y1 + along * dy;
    }
    return [x, y];
  }
}

module.exports = geom;

},{}],21:[function(require,module,exports){
var Geometry = {};

Geometry.GeometryTypes = {
  POINT: "Point",
  MULTIPOINT: "MultiPoint",
  LINESTRING: "Line", // per seguire la definizione di QGis.GeometryType, che definisce Line invece di Linestring.
  MULTILINESTRING: "MultiLine",
  POLYGON: "Polygon",
  MULTIPOLYGON: "MultiPolygon",
  GEOMETRYCOLLECTION: "GeometryCollection"
};

Geometry.SupportedGeometryTypes = [
  Geometry.GeometryTypes.POINT,
  Geometry.GeometryTypes.MULTIPOINT,
  Geometry.GeometryTypes.LINESTRING,
  Geometry.GeometryTypes.MULTILINESTRING,
  Geometry.GeometryTypes.POLYGON,
  Geometry.GeometryTypes.MULTIPOLYGON
]

module.exports = Geometry;

},{}],22:[function(require,module,exports){
function init(config) {
  i18next
  .use(i18nextXHRBackend)
  .init({ 
      lng: 'it',
      ns: 'app',
      fallbackLng: 'it',
      resources: config.resources
  });
  
  jqueryI18next.init(i18next, $, {
    tName: 't', // --> appends $.t = i18next.t
    i18nName: 'i18n', // --> appends $.i18n = i18next
    handleName: 'localize', // --> appends $(selector).localize(opts);
    selectorAttr: 'data-i18n', // selector for translating elements
    targetAttr: 'data-i18n-target', // element attribute to grab target element to translate (if diffrent then itself)
    optionsAttr: 'data-i18n-options', // element attribute that contains options, will load/set if useOptionsAttr = true
    useOptionsAttr: false, // see optionsAttr
    parseDefaultValueFromContent: true // parses default values from content ele.val or ele.text
  });
}
    
var t = function(text){
    var trad = i18next.t(text);
    return trad;
};
    
module.exports = {
  init: init,
  t: t
}

},{}],23:[function(require,module,exports){
var PickCoordinatesEventType = {
  PICKED: 'picked'
};

var PickCoordinatesEvent = function(type, coordinate) {
  this.type = type;
  this.coordinate = coordinate;
};

var PickCoordinatesInteraction = function(options) {
  this.previousCursor_ = null;
  
  ol.interaction.Pointer.call(this, {
    handleDownEvent: PickCoordinatesInteraction.handleDownEvent_,
    handleUpEvent: PickCoordinatesInteraction.handleUpEvent_,
    handleMoveEvent: PickCoordinatesInteraction.handleMoveEvent_,
  });
};
ol.inherits(PickCoordinatesInteraction, ol.interaction.Pointer);

PickCoordinatesInteraction.handleDownEvent_ = function(event) {
  return true;
};

PickCoordinatesInteraction.handleUpEvent_ = function(event) {
  this.dispatchEvent(
          new PickCoordinatesEvent(
              PickCoordinatesEventType.PICKED,
              event.coordinate));
  return true;
};

PickCoordinatesInteraction.handleMoveEvent_ = function(event) {
  var elem = event.map.getTargetElement();
  elem.style.cursor =  'pointer';
};

PickCoordinatesInteraction.prototype.shouldStopEvent = function(){
  return false;
};

PickCoordinatesInteraction.prototype.setMap = function(map){
  if (!map) {
    var elem = this.getMap().getTargetElement();
    elem.style.cursor = '';
  }
  ol.interaction.Pointer.prototype.setMap.call(this,map);
};

module.exports = PickCoordinatesInteraction;

},{}],24:[function(require,module,exports){
var PickFeatureEventType = {
  PICKED: 'picked'
};

var PickFeatureEvent = function(type, coordinate, feature) {
  this.type = type;
  this.feature = feature;
  this.coordinate = coordinate;
};



var PickFeatureInteraction = function(options) {
  ol.interaction.Pointer.call(this, {
    handleDownEvent: PickFeatureInteraction.handleDownEvent_,
    handleUpEvent: PickFeatureInteraction.handleUpEvent_,
    handleMoveEvent: PickFeatureInteraction.handleMoveEvent_,
  });
  
  this.features_ = options.features || null;
  
  this.layers_ = options.layers || null;
  
  this.pickedFeature_ = null;
  
  var self = this;
  this.layerFilter_ = function(layer) {
    return _.includes(self.layers_, layer);
  };
};
ol.inherits(PickFeatureInteraction, ol.interaction.Pointer);

PickFeatureInteraction.handleDownEvent_ = function(event) {
  this.pickedFeature_ = this.featuresAtPixel_(event.pixel, event.map);
  return true;
};

PickFeatureInteraction.handleUpEvent_ = function(event) {
  if(this.pickedFeature_){
    this.dispatchEvent(
            new PickFeatureEvent(
                PickFeatureEventType.PICKED,
                event.coordinate,
                this.pickedFeature_));
  }
  return true;
};

PickFeatureInteraction.handleMoveEvent_ = function(event) {
  var elem = event.map.getTargetElement();
  var intersectingFeature = this.featuresAtPixel_(event.pixel, event.map);

  if (intersectingFeature) {
    elem.style.cursor =  'pointer';
  } else {
    elem.style.cursor = '';
  }
};

PickFeatureInteraction.prototype.featuresAtPixel_ = function(pixel, map) {
  var found = null;

  var intersectingFeature = map.forEachFeatureAtPixel(pixel,
      function(feature) {
        if (this.features_) {
          if (this.features_.indexOf(feature) > -1){
            return feature
          }
          else{
            return null;
          }
        }
        return feature;
      },this,this.layerFilter_);
  
  if(intersectingFeature){
    found = intersectingFeature;
  }
  return found;
};

PickFeatureInteraction.prototype.shouldStopEvent = function(){
  return false;
};

PickFeatureInteraction.prototype.setMap = function(map){
  if (!map) {
    var elem = this.getMap().getTargetElement();
    elem.style.cursor = '';
  }
  ol.interaction.Pointer.prototype.setMap.call(this,map);
};

module.exports = PickFeatureInteraction;

},{}],25:[function(require,module,exports){
var inherit = require('core/utils/utils').inherit;
var base = require('core/utils/utils').base;
var G3WObject = require('core/g3wobject');
var GeometryTypes = require('core/geometry/geometry').GeometryTypes;

var CAPABILITIES = {
  QUERY: 1,
  EDIT: 2
};

var EDITOPS = {
  INSERT: 1,
  UPDATE: 2,
  DELETE: 4
};

LayerState = {};

LayerState.ServerTypes = {
  OGC: "OGC",
  QGIS: "QGIS",
  Mapserver: "Mapserver",
  Geoserver: "Geoserver",
  ArcGIS: "ArcGIS"
};

LayerState.getGeometryType = function(layerState) {
  return layerState.geometrytype;
};

LayerState.getAttributes = function(layerState) {
  var attributes = [];
  if (layerState.attributes) {
    attributes = _.map(layerState.attributes,function(attribute) {
      return attribute.name;
    })
  }
  return attributes;
};

LayerState.isQueryable = function(layerState){
  var queryEnabled = false;
  var queryableForCababilities = (layerState.capabilities && (layerState.capabilities && CAPABILITIES.QUERY)) ? true : false;
  if (queryableForCababilities) {
    // è interrogabile se visibile e non disabilitato (per scala) oppure se interrogabile comunque (forzato dalla proprietà infowhennotvisible)
    var queryEnabled = (layerState.visible && !layerState.disabled) || (layerState.infowhennotvisible && (layerState.infowhennotvisible === true));
  }
  return queryEnabled;
};

LayerState.getQueryLayerName = function(layerState) {
  var queryLayerName;
  if (layerState.infolayer && layerState.infolayer != '') {
    queryLayerName = layerState.infolayer;
  }
  else {
    queryLayerName = layerState.name;
  }
  return queryLayerName;
};

LayerState.getServerType = function(layerState) {
  if (layerState.servertype && layerState.servertype != '') {
    return layerState.servertype;
  }
  else {
    return LayerState.ServerTypes.QGIS;
  }
};

LayerState.isExternalWMS = function(layerState) {
  return (layerState.source && layerState.source.url);
};

LayerState.getWMSLayerName = function(layerState) {
  var layerName = layerState.name;
  if (layerState.source && layerState.source.layers){
    layerName = layerState.source.layers
  };
  return layerName;
};

LayerState.getOriginURL = function(layerState) {
  var url;
  if (layerState.source && layerState.source.type == 'wms' && layerState.source.url){
    url = layerState.source.url
  };
  return url;
};

module.exports = LayerState;

},{"core/g3wobject":19,"core/geometry/geometry":21,"core/utils/utils":40}],26:[function(require,module,exports){
var inherit = require('core/utils/utils').inherit;
var truefnc = require('core/utils/utils').truefnc;
var resolve = require('core/utils/utils').resolve;
var reject = require('core/utils/utils').reject;
var G3WObject = require('core/g3wobject');

function VectorLayer(config){
  var config = config || {};
  this.geometrytype = config.geometrytype || null;
  this.format = config.format || null;
  this.crs = config.crs  || null;
  this.id = config.id || null;
  this.name = config.name || "";
  this.pk = config.pk || "id"; // TODO: il GeoJSON setta l'id della feature da sé, e nasconde il campo PK dalle properties. In altri formati va verificato, e casomai usare feature.setId()
  
  this._olSource = new ol.source.Vector({
    features: new ol.Collection()
  });
  this._olLayer = new ol.layer.Vector({
    name: this.name,
    source: this._olSource
  });
  
  /*
   * Array di oggetti:
   * {
   *  name: Nome dell'attributo,
   *  type: integer | float | string | boolean | date | time | datetime,
   *  input: {
   *    label: Nome del campo di input,
   *    type: select | check | radio | coordspicker | boxpicker | layerpicker | fielddepend,
   *    options: {
   *      Le opzioni per lo spcifico tipo di input (es. "values" per la lista di valori di select, check e radio)
   *    }
   *  }
   * }
  */
  this._PKinAttributes = false;
  this._featuresFilter = null;
  this._fields = null
  this.lazyRelations = true;
  this._relations = null;
}
inherit(VectorLayer,G3WObject);
module.exports = VectorLayer;

var proto = VectorLayer.prototype;

proto.setData = function(featuresData){
  var self = this;
  var features;
  if (this.format) {
    switch (this.format){
      case "GeoJSON":
        var geojson = new ol.format.GeoJSON({
          defaultDataProjection: this.crs,
          geometryName: "geometry"
        });
        features = geojson.readFeatures(featuresData);
        break;
    }
    
    if (features && features.length) {
      if (!_.isNull(this._featuresFilter)){
        var features = _.map(features,function(feature){
          return self._featuresFilter(feature);
        });
      }
      
      var alreadyLoadedIds = this.getFeatureIds();
      var featuresToLoad = _.filter(features,function(feature){
        return !_.includes(alreadyLoadedIds,feature.getId());
      })
      
      this._olSource.addFeatures(featuresToLoad);
      
      // verifico, prendendo la prima feature, se la PK è presente o meno tra gli attributi
      var attributes = this.getSource().getFeatures()[0].getProperties();
      this._PKinAttributes = _.get(attributes,this.pk) ? true : false;
    }
  }
  else {
    console.log("VectorLayer format not defined");
  }
};

proto.setFeatureData = function(oldfid,fid,geometry,attributes){
  var feature = this.getFeatureById(oldfid);
  if (fid){
    feature.setId(fid);
  }
  
  if (geometry){
    feature.setGeometry(geometry);
  }
  
  if (attributes){
    var oldAttributes = feature.getProperties();
    var newAttributes =_.assign(oldAttributes,attributes);
    feature.setProperties(newAttributes);
  }
  
  return feature;
};

proto.addFeatures = function(features){
  this.getSource().addFeatures(features);
};

proto.setFeaturesFilter = function(featuresFilter){
  this._featuresFilter = featuresFilter;
};

proto.setFields = function(fields){
  this._fields = fields;
};

proto.setPkField = function(){
  var self = this;
  var pkfieldSet = false;
  _.forEach(this._fields,function(field){
    if (field.name == self.pk ){
      pkfieldSet = true;
    }
  });
  
  if (!pkfieldSet){
    this._fields
  }
};

proto.getFeatures = function(){
  return this.getSource().getFeatures();
};

proto.getFeatureIds = function(){
  var featureIds = _.map(this.getSource().getFeatures(),function(feature){
    return feature.getId();
  })
  return featureIds
};

proto.getFields = function(){
  return _.cloneDeep(this._fields);
};

proto.getFieldsNames = function(){
  return _.map(this._fields,function(field){
    return field.name;
  });
};

proto.getFieldsWithAttributes = function(obj){
  var self = this;
  /*var fields = _.cloneDeep(_.filter(this._fields,function(field){
    return ((field.name != self.pk) && field.editable);
  }));*/
  var fields = _.cloneDeep(this._fields);
  
  var feature, attributes;
  
  // il metodo accetta sia feature che fid
  if (obj instanceof ol.Feature){
    feature = obj;
  }
  else if (obj){
    feature = this.getFeatureById(obj);
  }
  if (feature){
    attributes = feature.getProperties();
  }
  
  _.forEach(fields,function(field){
    if (feature){
      if (!this._PKinAttributes && field.name == self.pk){
        field.value = feature.getId();
      }
      else{
        field.value = attributes[field.name];
      }
    }
    else{
      field.value = null;
    }
  });
  return fields;
};

proto.setRelations = function(relations){
  _.forEach(relations,function(relation,relationKey){
    relation.name = relationKey;
  });
  this._relations = relations;
};

proto.getRelations = function(){
  return this._relations;
};

proto.hasRelations = function(){
  return !_.isNull(this._relations);
};

proto.getRelationsNames = function(){
  return _.keys(this._relations);
};

proto.getRelationsFksKeys = function(){
  var fks = [];
  _.forEach(this._relations,function(relation){
    fks.push(relation.fk);
  })
  return fks;
};

proto.getRelationFieldsNames = function(relation){
  var relationFields = this._relations[relation];
  if (relationFields){
    return _.map(relationFields,function(field){
      return field.name;
    });
  }
  return null;
};

// ottengo le relazioni a partire dal fid di una feature esistente
proto.getRelationsWithAttributes = function(fid){
  var relations = _.cloneDeep(this._relations);
  var self = this;
  if (!fid || !this.getFeatureById(fid)){
    _.forEach(relations,function(relation,relationKey){
        // inizialmente setto a null i valori
      _.forEach(relation.fields,function(field){
        field.value = null;
      })
    });
    return resolve(relations);
  }
  else {
    if (this.lazyRelations){
      var deferred = $.Deferred();
      var attributes = this.getFeatureById(fid).getProperties();
      var fks = {};
      _.forEach(relations,function(relation,relationKey){
        var url = relation.url;
        var keyVals = [];
        _.forEach(relation.fk,function(fkKey){
          fks[fkKey] = attributes[fkKey];
        });
      })
      
      this.getRelationsWithAttributesFromFks(fks)
      .then(function(relationsResponse){
        deferred.resolve(relationsResponse);
      })
      .fail(function(){
        deferred.reject();
      });
      return deferred.promise();
    }
  }
};

// ottengo le relazioni valorizzate a partire da un oggetto con le chiavi FK come keys e i loro valori come values
proto.getRelationsWithAttributesFromFks = function(fks){
  var self = this;
  var relations = _.cloneDeep(this._relations);
  var relationsRequests = [];

  _.forEach(relations,function(relation,relationKey){
    var url = relation.url;
    var keyVals = [];
    _.forEach(relation.fk,function(fkKey){
      var fkValue = fks[fkKey];
      keyVals.push(fkKey+"="+fkValue);
    });
    var fkParams = _.join(keyVals,"&");
    url += "?"+fkParams;
    relationsRequests.push($.get(url)
      .then(function(relationAttributes){
        _.forEach(relation.fields,function(field){
          field.value = relationAttributes[0][field.name];
        });
      })
    )
  })
  
  return $.when.apply(this,relationsRequests)
  .then(function(){
    return relations;
  });
}

proto.setStyle = function(style){
  this._olLayer.setStyle(style);
};

proto.getLayer = function(){
  return this._olLayer;
};

proto.getSource = function(){
  return this._olLayer.getSource();
};

proto.getFeatureById = function(id){
  return this._olLayer.getSource().getFeatureById(id);
};

proto.clear = function(){
  this.getSource().clear();
};

proto.addToMap = function(map){
  map.addLayer(this._olLayer);
};

// data una feature verifico se ha tra gli attributi i valori delle FK delle (eventuali) relazioni
proto.featureHasRelationsFksWithValues = function(feature){
  var attributes = feature.getProperties();
  var fksKeys = this.getRelationsFksKeys();
  return _.every(fksKeys,function(fkKey){
    var value = attributes[fkKey];
    return (!_.isNil(value) && value != '');
  })
};

// data una feature popolo un oggetto con chiavi/valori delle FK delle (eventuali) relazione
proto.getRelationsFksWithValuesForFeature = function(feature){
  var attributes = feature.getProperties();
  var fks = {};
  var fksKeys = this.getRelationsFksKeys();
  _.forEach(fksKeys,function(fkKey){
    fks[fkKey] = attributes[fkKey];
  })
  return fks;
};

},{"core/g3wobject":19,"core/utils/utils":40}],27:[function(require,module,exports){
var inherit = require('core/utils/utils').inherit;
var base = require('core/utils/utils').base;
var LayerState = require('core/layer/layerstate');
var MapLayer = require('core/map/maplayer');
var RasterLayers = require('g3w-ol3/src/layers/rasters');

function WMSLayer(options,extraParams){
  var self = this;
  this.LAYERTYPE = {
    LAYER: 'layer',
    MULTILAYER: 'multilayer'
  };

  this.extraParams = extraParams
  this.layers = [];
  
  base(this,options);
}
inherit(WMSLayer,MapLayer)
var proto = WMSLayer.prototype;

proto.getOLLayer = function(){
  var olLayer = this._olLayer;
  if (!olLayer){
    olLayer = this._olLayer = this._makeOlLayer();
  }
  return olLayer;
};

proto.getSource = function(){
  return this.getOLLayer().getSource();
};

proto.getInfoFormat = function() {
  return 'application/vnd.ogc.gml';
};

proto.getGetFeatureInfoUrl = function(coordinate,resolution,epsg,params){
  return this.getOLLayer().getSource().getGetFeatureInfoUrl(coordinate,resolution,epsg,params);
};

proto.getLayerConfigs = function(){
  return this.layers;
};

proto.addLayer = function(layerConfig){
  this.layers.push(layerConfig);
};

proto.toggleLayer = function(layer){
  _.forEach(this.layers,function(_layer){
    if (_layer.id == layer.id){
      _layer.visible = layer.visible;
    }
  });
  this._updateLayers();
};
  
proto.update = function(mapState,extraParams){
  this._updateLayers(mapState,extraParams);
};

proto.isVisible = function(){
  return this._getVisibleLayers().length > 0;
};

proto.getQueryUrl = function(){
  var layer = this.layers[0];
  if (layer.infourl && layer.infourl != '') {
    return layer.infourl;
  }
  return this.config.url;
};

proto.getQueryLayers = function(){ 
  var layer = this.layers[0];
  var queryLayers = [];
  _.forEach(this.layers,function(layer){
    if (LayerState.isQueryable(layer)) {
      queryLayers.push({
        layerName: LayerState.getWMSLayerName(layer),
        queryLayerName: LayerState.getQueryLayerName(layer),
        geometryType: LayerState.getGeometryType(layer),
        attributes: LayerState.getAttributes(layer)
      });
    }
  });
  return queryLayers;
};

proto._makeOlLayer = function(){
  var self = this;
  var wmsConfig = {
    url: this.config.url,
    id: this.config.id
  };
  
  var representativeLayer = this.layers[0]; //BRUTTO, DEVO PRENDERE UN LAYER A CASO (IL PRIMO) PER VEDERE SE PUNTA AD UN SOURCE DIVERSO (dovrebbe accadere solo per i layer singoli, WMS esterni)
  
  if (representativeLayer.source && representativeLayer.source.type == 'wms' && representativeLayer.source.url){
    wmsConfig.url = representativeLayer.source.url;
  };
  
  var olLayer = new RasterLayers.WMSLayer(wmsConfig,this.extraParams);
  
  olLayer.getSource().on('imageloadstart', function() {
        self.emit("loadstart");
      });
  olLayer.getSource().on('imageloadend', function() {
      self.emit("loadend");
  });
  
  return olLayer
};

proto._getVisibleLayers = function(mapState){
  var self = this;
  var visibleLayers = [];
  _.forEach(this.layers,function(layer){
    var resolutionBasedVisibility = layer.maxresolution ? (layer.maxresolution && layer.maxresolution > mapState.resolution) : true;
    if (layer.visible && resolutionBasedVisibility) {
      visibleLayers.push(layer);
    }    
  })
  return visibleLayers;
};

proto.checkLayerDisabled = function(layer,resolution) {
  var disabled = layer.disabled || false;
  if (layer.maxresolution){
    disabled = layer.maxresolution < resolution;
  }
  if (layer.minresolution){
    layer.disabled = disabled && (layer.minresolution > resolution);
  }
  layer.disabled = disabled;
};

proto.checkLayersDisabled = function(resolution){
  var self = this;
  _.forEach(this.layers,function(layer){
    self.checkLayerDisabled(layer,resolution);
  });
};

proto._updateLayers = function(mapState,extraParams){
  this.checkLayersDisabled(mapState.resolution);
  var visibleLayers = this._getVisibleLayers(mapState);
  if (visibleLayers.length > 0) {
    var params = {
      LAYERS: _.join(_.map(visibleLayers,function(layer){
        return LayerState.getWMSLayerName(layer);
      }),',')
    };
    if (extraParams) {
      params = _.assign(params,extraParams);
    }
    this._olLayer.setVisible(true);
    this._olLayer.getSource().updateParams(params);
  }
  else {
    this._olLayer.setVisible(false);
  }
};

module.exports = WMSLayer;

},{"core/layer/layerstate":25,"core/map/maplayer":28,"core/utils/utils":40,"g3w-ol3/src/layers/rasters":49}],28:[function(require,module,exports){
var inherit = require('core/utils/utils').inherit;
var base = require('core/utils/utils').base;
var G3WObject = require('core/g3wobject');


function MapLayer(config){
  this.config = config || {};
  this.id = config.id;
  
  this._olLayer = null;
  
  base(this);
}
inherit(MapLayer,G3WObject);

var proto = MapLayer.prototype;

proto.getId = function(){
  return this.id;
};

module.exports = MapLayer;

},{"core/g3wobject":19,"core/utils/utils":40}],29:[function(require,module,exports){
var inherit = require('core/utils/utils').inherit;
var base = require('core/utils/utils').base;
var G3WObject = require('core/g3wobject');
var Geometry = require('core/geometry/geometry');
var ProjectsRegistry = require('core/project/projectsregistry');


//var GUI = require('gui/gui'); // QUESTO NON CI DEVE ESSERE!!!

function MapQueryService() {
  base(this);
  this.init = function(map){
    this.map = map;
  }
  
  this.queryPoint = function(coordinates,mapLayers) {
    var self = this;
    var d = $.Deferred();
    var urlsForLayers = {};
    _.forEach(mapLayers,function(mapLayer){
      var url = mapLayer.getQueryUrl();
      var urlHash = url.hashCode().toString();
      if (_.keys(urlsForLayers).indexOf(urlHash) == -1) {
        urlsForLayers[urlHash] = {
          url: url,
          mapLayers: []
        };
      }
      urlsForLayers[urlHash].mapLayers.push(mapLayer);
    })
    
    var queryUrlsForLayers = [];
    _.forEach(urlsForLayers,function(urlForLayers){
      var firstLayer = urlForLayers.mapLayers[0];
      var _getFeatureInfoUrl = self.getGetFeatureInfoUrl(firstLayer,coordinates);
      var queryBase = _getFeatureInfoUrl.split('?')[0];
      var queryString = _getFeatureInfoUrl.split('?')[1];
      var queryParams = {};
      _.forEach(queryString.split('&'),function(queryStringPair){
        var queryPair = queryStringPair.split('=');
        var key = queryPair[0];
        var value = queryPair[1];
        queryParams[key] = value;
      });
      
      var layerNames = [];
      var queryLayers = [];
      _.forEach(urlForLayers.mapLayers,function(mapLayer){
        //var mapLayerLayersNames = mapLayer.getLayer().getSource().getParams()['LAYERS'];
        //layerNames = _.concat(layerNames,mapLayerLayersNames);
        var mapLayerQueryLayers = mapLayer.getQueryLayers();
        
        if (mapLayerQueryLayers.length) {
          queryLayers = _.concat(queryLayers,mapLayerQueryLayers);
        }
      })
      
      if (queryLayers.length) {
        delete queryParams['STYLES'];
      
        queryParams['LAYERS'] = _.map(queryLayers,'queryLayerName');
        queryParams['QUERY_LAYERS'] = _.map(queryLayers,'queryLayerName');
        queryParams['FEATURE_COUNT'] = 1000;
        
        var getFeatureInfoUrl = queryBase;
        var newQueryPairs = [];
        _.forEach(queryParams,function(value,key){
          newQueryPairs.push(key+'='+value);
        });
        getFeatureInfoUrl = queryBase+'?'+newQueryPairs.join('&')
        
        queryUrlsForLayers.push({
          url: getFeatureInfoUrl,
          queryLayers: queryLayers
        });
      }
    })
    
    var featuresForLayerNames = {};
    if (queryUrlsForLayers.length > 0) {
      _.forEach(queryUrlsForLayers,function(queryUrlForLayers){
        var url = queryUrlForLayers.url;
        var queryLayers = queryUrlForLayers.queryLayers;

        $.get(url).
        then(function(response){
          var jsonresponse;
          var x2js = new X2JS();
          try {
            if (_.isString(response)) {
              jsonresponse = x2js.xml_str2json(response);
            }
            else {
              jsonresponse = x2js.xml2json(response);
            }
          }
          catch (e) {
            d.reject(e);
          }
          var rootNode = _.keys(jsonresponse)[0];
          var parser, data;
          switch (rootNode) {
            case 'FeatureCollection':
              parser = self._parseLayerFeatureCollection;
              data = jsonresponse;
              break;
            case "msGMLOutput":
              parser = self._parseLayermsGMLOutput;
              data = response;
              break;
          }
          var nfeatures = 0
          _.forEach(queryLayers,function(queryLayer){
            var features = parser.call(self,queryLayer,data)
            nfeatures += features.length;
            featuresForLayerNames[queryLayer.layerName] = features;
          })
          d.resolve(coordinates,nfeatures,featuresForLayerNames);
        })
        .fail(function(e){
          d.reject(e);
        })
      });
    }
    else {
      d.resolve(coordinates,0,featuresForLayerNames);
    }
    
    return d.promise();
  };
  
  // Brutto ma per ora unica soluzione trovata per dividere per layer i risultati di un doc xml wfs.FeatureCollection. OL3 li parserizza tutti insieme...
  this._parseLayerFeatureCollection = function(queryLayer,data){
    var features = [];
    var layerName = queryLayer.queryLayerName;
    var layerData = _.cloneDeep(data);
    layerData.FeatureCollection.featureMember = [];
    
    var featureMembers = data.FeatureCollection.featureMember;
    _.forEach(featureMembers,function(featureMember){
      var isLayerMember = _.get(featureMember,layerName)

      if (isLayerMember) {
        layerData.FeatureCollection.featureMember.push(featureMember);
      }
    });
    
    var x2js = new X2JS();
    var layerFeatureCollectionXML = x2js.json2xml_str(layerData);
    var parser = new ol.format.WMSGetFeatureInfo();
    return parser.readFeatures(layerFeatureCollectionXML);
  };
  
  // mentre con i risultati in msGLMOutput (da Mapserver) il parser può essere istruito per parserizzare in base ad un layer di filtro
  this._parseLayermsGMLOutput = function(queryLayer,data){
    var parser = new ol.format.WMSGetFeatureInfo({
      layers: [queryLayer.queryLayerName]
    });
    return parser.readFeatures(data);
  };
  
  this.queryRect = function(rect,layerId) {
    
  };
  
  this._query = function(rect,layerId) {
    var Project = ProjectsRegistry.getCurrentProject();
    var layers;
    if (layerId) {
      layers = [Project.getLayer(layerId)];
    }
    else {
      layers = Project.getLayers();
    }
  };
  
  this.getGetFeatureInfoUrl = function(mapLayer,coordinate){
    //var parser = new ol.format.WMSGetFeatureInfo();
    var resolution = this.map.getView().getResolution();
    var epsg = this.map.getView().getProjection().getCode();
    var params = {
      QUERY_LAYERS: _.map(mapLayer.getQueryLayers(),'queryLayerName'),
      INFO_FORMAT: mapLayer.getInfoFormat(),
      // PARAMETRI DI TOLLERANZA PER QGIS SERVER
      FI_POINT_TOLERANCE: 10,
      FI_LINE_TOLERANCE: 10,
      FI_POLYGON_TOLERANCE: 10      
    }
    var url = mapLayer.getGetFeatureInfoUrl(coordinate,resolution,epsg,params);
    return url;
  };
}
inherit(MapQueryService,G3WObject);

module.exports = new MapQueryService;

},{"core/g3wobject":19,"core/geometry/geometry":21,"core/project/projectsregistry":34,"core/utils/utils":40}],30:[function(require,module,exports){
var inherit = require('core/utils/utils').inherit;
var base = require('core/utils/utils').base;
var G3WObject = require('core/g3wobject');

function MapsRegistry() {
  base(this);
  
  this._mapsServices = {
  };
  
  this.addMap = function(mapService) {
    this._registerMapService(mapService);
  };
  
  this._registerMapService = function(mapService) {
    var mapService = this._mapsServices[mapService.id]
    if (_.isUndefined(mapService)) {
      this._mapsServices[mapService.id] = mapService;
    }
  };
} 
inherit(MapsRegistry,G3WObject);

module.exports = MapsRegistry;

},{"core/g3wobject":19,"core/utils/utils":40}],31:[function(require,module,exports){
var inherit = require('core/utils/utils').inherit;
var G3WObject = require('core/g3wobject');

function Plugin(options){
  this.name = name;
  this.tools = [];
}
inherit(Plugin,G3WObject);

var proto = Plugin.prototype;

proto.load = function() {
  var d = $.Deferred();
  var url = 'lib/plugins/'+this.name;
  $script(url,function(){
    d.resolve();
  });
  return d.promise();
}

proto.providesTools = function(){
  return this.tools.length > 0;
};

proto.getTools = function(){
  return this.tools;
};

proto.getActions = function(tool){
  return tool.actions;
};

module.exports = Plugin;

},{"core/g3wobject":19,"core/utils/utils":40}],32:[function(require,module,exports){
var base = require('core/utils/utils').base;
var inherit = require('core/utils/utils').inherit;
var G3WObject = require('core/g3wobject');

//var Plugin = require('./plugin');
//var ToolsService = require('core/plugin/toolsservice');

function PluginsRegistry(){
  var self = this;
  this.config = null;
  // un domani questo sarà dinamico
  this._plugins = {};
  this.state = {
    toolsproviders: []
  };
  
  this.setters = {
    setToolsProvider: function(plugin) {
      self.state.toolsproviders.push(plugin);
    },
    registerPlugin: function(plugin){
      if (!self._plugins[plugin.name]) {
        self._plugins[plugin.name] = plugin;
        console.log("Registrato plugin "+plugin.name)
      }
    }
  }
  
  base(this);
  
  this.init = function(options){
    var self = this;
    this.pluginsBaseUrl = options.plusingBaseUrl
    this.pluginsConfigs = options.pluginsConfigs;
    _.forEach(this.pluginsConfigs,function(pluginConfig,name){
      self._setup(name,pluginConfig);
    })
  };
  
  this._setup = function(name,pluginConfig) {
    var self = this;
    if (pluginConfig){
      var url = this.pluginsBaseUrl+'/plugins/'+name+'.js';
      $script(url);
    }
  };
  
  this.activate = function(plugin) {
    var tools = plugin.getTools();
    if (tools.length) {
      ToolsService.registerToolsProvider(plugin);
    }
  };
};

inherit(PluginsRegistry,G3WObject);

module.exports = new PluginsRegistry

},{"core/g3wobject":19,"core/utils/utils":40}],33:[function(require,module,exports){
var inherit = require('core/utils/utils').inherit;
var base = require('core/utils//utils').base;
var G3WObject = require('core/g3wobject');
var ApplicationService = require('core/applicationservice');

function Project(projectConfig) {
  var self = this;
  
  /* struttura oggetto 'project'
  {
    id,
    type,
    gid,
    name,
    crs,
    extent,
    layerstree,
    widgets
  }
  */
  this.state = projectConfig;
  
  this._layers = {};
  function traverse(obj){
    _.forIn(obj, function (layer, key) {
        //verifica che il valore dell'id non sia nullo
        if (!_.isNil(layer.id)) {
            self._layers[layer.id] = layer;
        }
        if (!_.isNil(layer.nodes)) {
            traverse(layer.nodes);
        }
    });
  }
  traverse(projectConfig.layerstree);
  
  /*var eventType = 'projectset';
  if (doswitch && doswitch === true) {
    eventType = 'projectswitch';
  }
  this.emit(eventType);*/
  
  this.setters = {
    setLayersVisible: function(layers,visible){
      _.forEach(layers,function(layer){
        self._layers[layer.id].visible = visible;
      })
    },
    setBaseLayer: function(id){
      _.forEach(self.state.baseLayers,function(baseLayer){
        baseLayer.visible = (baseLayer.id == id);
      })
    }
  };

  base(this);
}
inherit(Project,G3WObject);

var proto = Project.prototype;

proto.getLayer = function(id){
  return this._layers[id];
};

proto.getLayers = function(){
  return this._layers;
};

proto.getLayerById = function(id) {
  var layer = null;
  _.forEach(this.getLayers(),function(_layer){
    if (_layer.id == id){
      layer = _layer;
    }
  });
  return layer;
};

proto.getLayerByName = function(name) {
  var layer = null;
  _.forEach(this.getLayers(),function(_layer){
    if (_layer.name == name){
      layer = _layer;
    }
  });
  return layer;
};

proto.getQueryableLayers = function(){
  var queryableLayers = [];
  _.forEach(this.getLayers(),function(layer){
    if (LayerState.isQueryable(layer)){
      queryableLayers.push(layer);
    }
  });
  return queryableLayers;
};

proto.getLayerAttributes = function(id){
  return this._layers[id].attributes;
};

proto.getLayerAttributeLabel = function(id,name){
  var label = '';
  _.forEach(this._layers[id].attributes,function(attribute){
    if (attribute.name == name){
      label = attribute.label;
    }
  })
  return label;
};

proto.toggleLayer = function(layer,visible){
  var visible = visible || !layer.visible;
  this.setLayersVisible([layer],visible);
};

proto.toggleLayers = function(layers,visible){
  this.setLayersVisible(layers,visible);
};

proto.setGetWmsUrl = function(getWmsUrlFnc){
  this._getWmsUrlFnc = getWmsUrlFnc;
};

proto.getWmsUrl = function(){
  return this._getWmsUrlFnc(this.state);
};

proto.getLegendUrl = function(layer){
  var url = this.getWmsUrl();
  sep = (url.indexOf('?') > -1) ? '&' : '?';
  return this.getWmsUrl()+sep+'SERVICE=WMS&VERSION=1.3.0&REQUEST=GetLegendGraphic&SLD_VERSION=1.1.0&FORMAT=image/png&TRANSPARENT=true&ITEMFONTCOLOR=white&LAYERTITLE=False&ITEMFONTSIZE=10&LAYER='+layer.name;
};

module.exports = Project;

},{"core/applicationservice":18,"core/g3wobject":19,"core/utils//utils":40,"core/utils/utils":40}],34:[function(require,module,exports){
var inherit = require('core/utils/utils').inherit;
var base = require('core/utils/utils').base;
var resolve = require('core/utils/utils').resolve;
var reject = require('core/utils/utils').reject;
var G3WObject = require('core/g3wobject');
var Project = require('core/project/project');


/* service
Funzione costruttore contentente tre proprieta':
    setup: metodo di inizializzazione
    getLayersState: ritorna l'oggetto LayersState
    getLayersTree: ritorna l'array layersTree dall'oggetto LayersState
*/

// Public interface
function ProjectsRegistry(){
  var self = this;
  this.config = null;
  this.initialized = false;
  this.projectType = null;
  
  this.setters = {
    setCurrentProject: function(project){
      this.state.currentProject = project;
    }
  };
  
  this.state = {
    baseLayers: {},
    minScale: null,
    maxscale: null,
    currentProject: null
  };
  
  // tutte le configurazioni di base dei progetti, ma di cui non è detto che sia ancora disponibile l'istanza (lazy loading)
  this._pendingProjects = [];
  this._projects = {};
  
  base(this);
}
inherit(ProjectsRegistry, G3WObject);

var proto = ProjectsRegistry.prototype;

proto.init = function(config){
  var self = this;
  if (!this.initialized){
    this.initialized = true;
    this.config = config;
    //aggiunto tipo progetto
    this.projectType = this.config.group.overviewproject.type;
    this.setupState();
    return this.getProject(config.initproject)
    .then(function(project){
      self.setCurrentProject(project);
    });
  }
};
  
proto.setupState = function(){
  var self = this;
  
  self.state.baseLayers = self.config.baselayers;
  self.state.minScale = self.config.minscale;
  self.state.maxScale = self.config.maxscale;
  self.state.crs = self.config.crs;
  self.state.proj4 = self.config.proj4;
  self.config.projects.forEach(function(project){
    project.baselayers = self.config.baselayers;
    project.minscale = self.config.minscale;
    project.maxscale = self.config.maxscale;
    project.crs = self.config.crs;
    project.proj4 = self.config.proj4;
    self._pendingProjects.push(project);
  })
  //this.state.projects = config.group.projects;
};

proto.getProjectType = function() {
  return this.projectType;
};

proto.getPendingProjects = function() {
  return this._pendingProjects();
};

proto.getCurrentProject = function(){
  return this.state.currentProject;
};

// ottengo il progetto dal suo gid; ritorna una promise nel caso non fosse stato ancora scaricato il config completo (e quindi non sia ancora istanziato Project)
proto.getProject = function(projectGid){
  var self = this;
  var d = $.Deferred();
  var pendingProject = false;
  var project = null;
  this._pendingProjects.forEach(function(_pendingProject){
    if (_pendingProject.gid == projectGid) {
      pendingProject = _pendingProject;
      project = self._projects[projectGid];
    }
  })
  if (!pendingProject) {
    return reject("Project doesn't exist");
  }

  if (project){
    return d.resolve(project);
  }
  else{
    return this._getProjectFullConfig(pendingProject)
    .then(function(projectFullConfig){
      var projectConfig = _.merge(pendingProject,projectFullConfig);
      self._buildProjectTree(projectConfig);
      var project = new Project(projectConfig);
      project.setGetWmsUrl(self.config.getWmsUrl); // BRUTTO MA PER ORA SI TIENE COSI'
      self._projects[projectConfig.gid] = project;
      return d.resolve(project);
    });
  }
  
  return d.promise();
};
  
//ritorna una promises
proto._getProjectFullConfig = function(projectBaseConfig){
  var self = this;
  var deferred = $.Deferred();
  var url = this.config.getProjectConfigUrl(projectBaseConfig);
  $.get(url).done(function(projectFullConfig){
      deferred.resolve(projectFullConfig);
  })
  return deferred.promise();
};

proto._buildProjectTree = function(project){
  var layers = _.keyBy(project.layers,'id');
  var layersTree = _.cloneDeep(project.layerstree);
  
  function traverse(obj){
    _.forIn(obj, function (layer, key) {
      //verifica che il nodo sia un layer e non un folder
      if (!_.isNil(layer.id)) {
          var fulllayer = _.merge(layer,layers[layer.id]);
          obj[parseInt(key)] = fulllayer;
          var a =1;
      }
      if (!_.isNil(layer.nodes)){
        // aggiungo proprietà title per l'albero
        layer.title = layer.name;
        traverse(layer.nodes);
      }
    });
  }
  traverse(layersTree);
  project.layerstree = layersTree;
};

module.exports = new ProjectsRegistry();

},{"core/g3wobject":19,"core/project/project":33,"core/utils/utils":40}],35:[function(require,module,exports){
var ProjectTypes = {
  QDJANGO: 'qdjango',
  OGR: 'ogr'
};

module.exports = ProjectTypes;
},{}],36:[function(require,module,exports){
var inherit = require('core/utils/utils').inherit;
var base = require('core/utils/utils').base;
var Base64 = require('core/utils/utils').Base64;
var G3WObject = require('core/g3wobject');

var RouterService = function(){
  var self = this;
  this._route = '';
  this.setters = {
    setRoute: function(path){
      this._route = path;
    }
  }
  
  History.Adapter.bind(window,'statechange',function(){ // Note: We are using statechange instead of popstate
      var state = History.getState(); // Note: We are using History.getState() instead of event.state
      var hash = state.hash;
      self.setRouteFromHash(hash);
  });
  
  base(this);
};
inherit(RouterService,G3WObject);

var proto = RouterService.prototype;

proto.initRoute = function(){
  var firstHash = window.location.search;
  this.setRouteFromHash(firstHash);
}

proto.goto = function(path){
  var pathb64 = Base64.encode(path);
  History.pushState({path:path},null,'?p='+pathb64);
  //this.setRoute(path);
};

proto.setRouteFromHash = function(hash) {
  var pathb64 = this.getQueryParams(hash)['p'];
  var path = pathb64 ? Base64.decode(pathb64) : '';
  this.setRoute(path);
}

proto.slicePath = function(path){
  return path.split('?')[0].split('/');
};
  
proto.sliceFirst = function(path){
  var pathAndQuery = path.split('?');
  var queryString = pathAndQuery[1];
  var pathArr = pathAndQuery[0].split('/')
  var firstPath = pathArr[0];
  path = pathArr.slice(1).join('/');
  path = [path,queryString].join('?')
  return [firstPath,path];
};
  
proto.getQueryParams = function(path){
  var queryParams = {};
  try {
    var queryString = path.split('?')[1];
    var queryPairs = queryString.split('&');
    var queryParams = {};
    _.forEach(queryPairs,function(queryPair){
      var pair = queryPair.split('=');
      var key = pair[0];
      var value = pair[1];
      queryParams[key] = value;
    });
  }
  catch (e) {}
  return queryParams;
};

proto.getQueryString = function(path){
  return path.split('?')[1];
};
  
proto.makeQueryString = function(queryParams){};

module.exports = new RouterService;

},{"core/g3wobject":19,"core/utils/utils":40}],37:[function(require,module,exports){
var inherit = require('core/utils/utils').inherit;
var base = require('core/utils/utils').base;
var G3WObject = require('core/g3wobject');
var resolve = require('core/utils/utils').resolve;
var ProjectsRegistry = require('core/project/projectsregistry');


// FILTRI
var Filters = {
  eq: '=',
  gt: '>',
  gte: '>=',
  lt: '<',
  lte: '=<',
  LIKE: 'LIKE',
  ILIKE: 'ILIKE',
  AND: 'AND',
  OR: 'OR',
  NOT: '!='
};

function QueryQGISWMSProvider() {

  self = this;
  //funzione che fa la richiesta vera e propria al server qgis
  this.submitGetFeatureInfo = function(options) {

    var url = options.url || '';
    var querylayer = options.querylayer || null;
    var filter = options.filter || null;
    var bbox = options.bbox || ProjectsRegistry.getCurrentProject().state.extent.join(',');
    var simpleWmsSearchMaxResults = null;
    var crs = options.crs || '4326;'
    return $.get( url, {
        'SERVICE': 'WMS',
        'VERSION': '1.3.0',
        'REQUEST': 'GetFeatureInfo',
        'LAYERS': querylayer,
        'QUERY_LAYERS': querylayer,
        'FEATURE_COUNT': simpleWmsSearchMaxResults ||  50,
        'INFO_FORMAT': 'text/xml',
        'CRS': 'EPSG:'+ crs,
        'FILTER': filter,
        // Temporary fix for https://hub.qgis.org/issues/8656 (fixed in QGIS master)
        'BBOX': bbox // QUI CI VA IL BBOX DELLA MAPPA
      }
    );
   };

  //funzione che fa la ricerca
  this.doSearch = function(queryFilterObject) {

    var url = queryFilterObject.url;
    var querylayer = queryFilterObject.querylayer;
    var filterObject = queryFilterObject.filterObject;
    var crs = queryFilterObject.crs;
    //creo il filtro
    var filter = this.createFilter(filterObject, querylayer);
    //eseguo la richiesta e restituisco come risposta la promise del $.get
    var response = this.submitGetFeatureInfo({
      url: url,
      crs: crs,
      filter: filter,
      querylayer: querylayer
    });
    return response;
  };

  this.createFilter = function(filterObject, querylayer) {

    /////inserisco il nome del layer (typename) ///
    var filter = [];
    function createSingleFilter(booleanObject) {
      var filterElements = [];
      var filterElement = '';
      var valueExtra = "";
      var valueQuotes = "";
      var rootFilter;
      _.forEach(booleanObject, function(v, k, obj) {
        //creo il filtro root che sarà AND OR
        rootFilter = Filters[k];
        //qui c'è array degli elementi di un booleano
        _.forEach(v, function(input){
          //scorro su oggetto
          _.forEach(input, function(v, k, obj) {
          //verifico se il valore dell'oggetto è array e quindi è altro oggetto padre booleano
            if (_.isArray(v)) {
              filterElement = createSingleFilter(obj);
            } else { // è un oggetto operatore
              if (k == 'LIKE' || k == 'ILIKE') {
                valueExtra = "%";
              };
              filterOp = Filters[k];
              _.forEach(input, function(v, k, obj) {
                _.forEach(v, function(v, k, obj) {
                  //verifico se il valore non è un numero e quindi aggiungo singolo apice
                  if(isNaN(v)) {
                    valueQuotes = "'";
                  } else {
                    valueQuotes = "";
                  };
                  filterElement = "\"" + k + "\" "+ filterOp +" " + valueQuotes + valueExtra + v + valueExtra + valueQuotes;
                });
              });
            };
            filterElements.push(filterElement);
          });
        });
        rootFilter = filterElements.join(" "+ rootFilter + " ");
      });
      return rootFilter;
    };
    //assegno il filtro creato
    filter = querylayer + ":" + createSingleFilter(filterObject);
    return filter;
  };

};

inherit(QueryQGISWMSProvider, G3WObject);

module.exports =  new QueryQGISWMSProvider();

},{"core/g3wobject":19,"core/project/projectsregistry":34,"core/utils/utils":40}],38:[function(require,module,exports){
var inherit = require('core/utils/utils').inherit;
var base = require('core/utils/utils').base;
var G3WObject = require('core/g3wobject');
var resolve = require('core/utils/utils').resolve;
//definisco il filtro ol3
var ol3OGCFilter = ol.format.ogc.filter;

//oggetto che viene passato per effetturare il la search
var ol3GetFeatureRequestObject = {
  srsName: 'EPSG:',
  featureNS: '',
  featurePrefix: '',
  featureTypes: [],
  outputFormat: 'application/json',
  filter: null // esempio filtro composto ol3OGCFilter.and(ol3OGCFilter.bbox('the_geom', [1, 2, 3, 4], 'urn:ogc:def:crs:EPSG::4326'),ol3OGCFilter.like('name', 'New*'))
};

// FILTRI OL3
var ol3Filters = {
  eq: ol3OGCFilter.equalTo,
  gt: ol3OGCFilter.greaterThan,
  gte: ol3OGCFilter.greaterThanOrEqualTo,
  lt: ol3OGCFilter.lessThan,
  lte: ol3OGCFilter.lessThanOrEqualTo,
  like: ol3OGCFilter.like,
  ilike: "",
  bbox: ol3OGCFilter.bbox,
  AND: ol3OGCFilter.and,
  OR: ol3OGCFilter.or,
  NOT: ol3OGCFilter.not
};


// CREATO UN FILTRO DI ESEMPIO PER VERIFICARE LA CORRETTEZZA DELLA FUNZIONE CREAZIONE FILTRO
var testFilter = {
  'AND':
    [
      {
        eq:
          {
            gid : 10
          }
      },
      {
        'OR':
          [
            {
              eq: {
                pippo : 'lallo'
              }
            },
            {
              gt: {
                id : 5
              }
            }

          ]
      }
   ]
}
//////////////

///FILTRI CUSTOM
var standardFilterTemplates = function() {
  var common = {
    propertyName:
          "<PropertyName>" +
            "[PROP]" +
          "</PropertyName>",
    literal:
          "<Literal>" +
            "[VALUE]" +
          "</Literal>"
  };
  return {
    eq: "<PropertyIsEqualTo>" +
            common.propertyName +
            common.literal +
        "</PropertyIsEqualTo>",
    gt: "<PropertyIsGreaterThan>" +
            common.propertyName +
            common.literal +
         "</PropertyIsGreaterThan>",
    gte:"",
    lt: "",
    lte: "",
    like: "",
    ilike: "",
    AND: "<And>[AND]</And>",
    OR: "<Or>[OR]</Or>",
  }
}();

/////
var qgisFilterTemplates = {
  // codice qui
};

var mapserverFilterTemplates = {
  // codice qui
};

var geoserverFilterTemplates = {
  // codice qui
};

function QueryWFSProvider(){
  var self = this;
  var d = $.Deferred();
  var results = {
    headers:[],
    values:[]
  };

  this.doSearch = function(queryFilterObject){
    var ogcservertype = queryFilterObject.servertype;
    var url = queryFilterObject.url;
    var querylayer = queryFilterObject.querylayer;
    var filterObject = queryFilterObject.filterObject;
    var crs = queryFilterObject.crs;
    //setto il srs
    ol3GetFeatureRequestObject.srsName+=crs || '4326';
    var response, filter;
    switch (ogcservertype) {
      case 'OGC':
        filter = this.createStandardFilter(filterObject, querylayer);
        response = this.standardSearch(url, filter);
        return resolve(response)
        break;
      case 'qgis':
        filter = this.createQgisFilter(filterObject);
        response = this.qgisSearch(querylayer, url, filter);
        return resolve(response)
        break;
      case 'mapserver':
        filter = this.createMapserverFilter(filterObject);
        response = this.mapserverSearch(querylayer, url, filter);
        return resolve(response)
        break;
      case 'geoserver':
        filter = this.createGeoserverFilter(filterObject);
        response = this.geoserverSearch(querylayer, url, filter);
        return resolve(response)
        break;
      default:
        return false
    }
  };

  this.standardSearch = function(url, filter){
    console.log(filter)
  };
  this.createStandardFilter = function(filterObject, querylayer) {
    /////inserisco il nome del layer (typename) ///
    ol3GetFeatureRequestObject.featureTypes.push(querylayer);
    var filter = [];
    function createSingleFilter(booleanObject) {
      var filterElements = [];
      var filterElement = '';
      var rootFilter;
      _.forEach(booleanObject, function(v, k, obj) {
        //creo il filtro root che sarà AND OR
        rootFilter = ol3Filters[k];
        //qui c'è array degli elementi di un booleano
        _.forEach(v, function(input){
          //scorro su oggetto operatore
          _.forEach(input, function(v, k, obj) {
          //è un array e quindi è altro oggetto padre booleano
            if (_.isArray(v)) {
              filterElement = createSingleFilter(obj);
            } else {
              filterElement = ol3Filters[k];
              _.forEach(input, function(v, k, obj) {
                _.forEach(v, function(v, k, obj) {
                  filterElement = filterElement(k, v);
                });
              });
            };
            filterElements.push(filterElement);
          });
        });
        //verifico che ci siano almeno due condizione nel filtro AND. Nel caso di una sola condizione (esempio : un solo input)
        //estraggo solo l'elemento filtro altrimenti da errore -- DA VERIFICARE SE CAMBIARLO
        if (filterElements.length > 1) {
          rootFilter = rootFilter.apply(this, filterElements);
        } else {
          rootFilter = filterElements[0];
        };
      });
      return rootFilter;
    };
    //assegno il filtro creato
    ol3GetFeatureRequestObject.filter = createSingleFilter(filterObject);
    //creo il filtro utilizzando ol3
    filter = new ol.format.WFS().writeGetFeature(ol3GetFeatureRequestObject);
    return filter;
  };

  this.qgisSearch = function(urls, filter){
    $.get(searchUrl).then(function(result){
      self.emit("searchdone",result);
    });
    return d.promise();
  };
  this.createQGisFilter = function(filterObject) {
    var filter;
    return filter
  };
  this.mapserverSearch = function(querylayer, url, filter){
    return d.promise();
  };
  this.createMapserverFilter = function(filterObject) {
    var filter;
    return filter
  };
  this.geoserverSearch = function(querylayer, url, filter){
    return d.promise();
  };
  this.createGeoserverFilter = function(filterObject) {
    var filter;
    return filter
  };
  base(this);
}
inherit(QueryWFSProvider,G3WObject);

module.exports =  new QueryWFSProvider()


},{"core/g3wobject":19,"core/utils/utils":40}],39:[function(require,module,exports){
var inherit = require('core/utils/utils').inherit;
var base = require('core/utils/utils').base;
var G3WObject = require('core/g3wobject');
var ProjectsRegistry = require('core/project/projectsregistry');
var QueryWFSProvider = require('./queryWFSProvider');
var QueryQGISWMSProvider = require('./queryQGISWMSProvider');

var Provider = {
  'QGIS': QueryQGISWMSProvider,
  'OGC': QueryWFSProvider
};

function SearchQueryService(){
  var self = this;
  this.url = "";
  this.filterObject = {};
  this.queryFilterObject = {};

  this.setFilterObject = function(filterObject){
    this.filterObject = filterObject;
  };

  this.getFilterObject = function() {
    return this.filterObject;
  };
  //dato l'oggetto filter restituito dal server ricostruisco la struttura del filterObject
  //interpretato da queryWMSProvider
  this.createQueryFilterFromConfig = function(filter) {

    var queryFilter = {};
    var attribute;
    var operator;
    var field;
    var operatorObject = {};
    var booleanObject = {};
    //funzione che costruisce l'oggetto operatore es. {'=':{'nomecampo':null}}
    function createOperatorObject(obj) {
      //rinizializzo a oggetto vuoto
      evalObject = {};
      //verifico che l'oggetto passato non sia a sua volta un oggetto 'BOOLEANO'
      _.forEach(obj, function(v,k) {
        if (_.isArray(v)) {
          return createBooleanObject(k,v);
        };
      });
      field = obj.attribute;
      operator = obj.op;
      evalObject[operator] = {};
      evalObject[operator][field] = null;
      return evalObject;
    };
    //functione che costruisce oggetti BOOLEANI caso AND OR contenente array di oggetti fornit dalla funzione createOperatorObject
    function createBooleanObject(booleanOperator, operations) {
      booleanObject = {};
      booleanObject[booleanOperator] = [];
      _.forEach(operations, function(operation){
        booleanObject[booleanOperator].push(createOperatorObject(operation));
      })
      return booleanObject;
    };
    /*
    // vado a creare l'oggetto filtro principale. Questo è un oggetto che contiene l'operatore booleano come root (chiave)
    // come valore un array di oggetti operatori che contengono il tipo di operatore come chiave e come valore un oggetto contenete
    // nome campo e valore passato
    */
    _.forEach(filter, function(v,k,obj) {
      queryFilter = createBooleanObject(k,v);
    });
    return queryFilter;
  };

  this.createQueryFilterObject = function(layerId, filterObject){
    var layerInfo = this.getLayerInfoUrlFromProjectConfig(layerId);
    return {
      type: 'standard',
      url: layerInfo.url,
      querylayer: layerInfo.name,
      servertype: layerInfo.servertype,
      crs: layerInfo.crs,
      filterObject : filterObject
    };
  };

  this.getLayerInfoUrlFromProjectConfig = function(layerId) {
    var layerFilterInfo = {};
    var Project = ProjectsRegistry.getCurrentProject();
    var layerInfo = Project.getLayerById(layerId);
    if (layerInfo) {
      layerFilterInfo.name = layerInfo.name;
      layerFilterInfo.crs = layerInfo.crs;
      layerFilterInfo.servertype = layerInfo.servertype;
      if (layerInfo.source && layerInfo.source.url){
        layerFilterInfo.url = layerInfo.source.url;
      } else {
        layerFilterInfo.url = Project.getWmsUrl();
      };
    };
    return layerFilterInfo;
  };

  this.doQuerySearch = function(queryFilterObject) {
    var provider = Provider[queryFilterObject.servertype];
    provider.doSearch(queryFilterObject)
    .then(function(result){
      console.log(result);
      self.emit("searchresults", result)
    });
  };
  base(this);
}
inherit(SearchQueryService,G3WObject);

module.exports =  new SearchQueryService


},{"./queryQGISWMSProvider":37,"./queryWFSProvider":38,"core/g3wobject":19,"core/project/projectsregistry":34,"core/utils/utils":40}],40:[function(require,module,exports){

/**
 * Decimal adjustment of a number.
 *
 * @param {String}  type  The type of adjustment.
 * @param {Number}  value The number.
 * @param {Integer} exp   The exponent (the 10 logarithm of the adjustment base).
 * @returns {Number} The adjusted value.
 */
function decimalAdjust(type, value, exp) {
  // If the exp is undefined or zero...
  if (typeof exp === 'undefined' || +exp === 0) {
    return Math[type](value);
  }
  value = +value;
  exp = +exp;
  // If the value is not a number or the exp is not an integer...
  if (isNaN(value) || !(typeof exp === 'number' && exp % 1 === 0)) {
    return NaN;
  }
  // Shift
  value = value.toString().split('e');
  value = Math[type](+(value[0] + 'e' + (value[1] ? (+value[1] - exp) : -exp)));
  // Shift back
  value = value.toString().split('e');
  return +(value[0] + 'e' + (value[1] ? (+value[1] + exp) : exp));
}

// Decimal round
if (!Math.round10) {
  Math.round10 = function(value, exp) {
    return decimalAdjust('round', value, exp);
  };
}
// Decimal floor
if (!Math.floor10) {
  Math.floor10 = function(value, exp) {
    return decimalAdjust('floor', value, exp);
  };
}
// Decimal ceil
if (!Math.ceil10) {
  Math.ceil10 = function(value, exp) {
    return decimalAdjust('ceil', value, exp);
  };
}

String.prototype.hashCode = function() {
  var hash = 0, i, chr, len;
  if (this.length === 0) return hash;
  for (i = 0, len = this.length; i < len; i++) {
    chr   = this.charCodeAt(i);
    hash  = ((hash << 5) - hash) + chr;
    hash |= 0;
  }
  return hash;
};

var Base64 = {_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){var t="";var n,r,i,s,o,u,a;var f=0;e=Base64._utf8_encode(e);while(f<e.length){n=e.charCodeAt(f++);r=e.charCodeAt(f++);i=e.charCodeAt(f++);s=n>>2;o=(n&3)<<4|r>>4;u=(r&15)<<2|i>>6;a=i&63;if(isNaN(r)){u=a=64}else if(isNaN(i)){a=64}t=t+this._keyStr.charAt(s)+this._keyStr.charAt(o)+this._keyStr.charAt(u)+this._keyStr.charAt(a)}return t},decode:function(e){var t="";var n,r,i;var s,o,u,a;var f=0;e=e.replace(/[^A-Za-z0-9+/=]/g,"");while(f<e.length){s=this._keyStr.indexOf(e.charAt(f++));o=this._keyStr.indexOf(e.charAt(f++));u=this._keyStr.indexOf(e.charAt(f++));a=this._keyStr.indexOf(e.charAt(f++));n=s<<2|o>>4;r=(o&15)<<4|u>>2;i=(u&3)<<6|a;t=t+String.fromCharCode(n);if(u!=64){t=t+String.fromCharCode(r)}if(a!=64){t=t+String.fromCharCode(i)}}t=Base64._utf8_decode(t);return t},_utf8_encode:function(e){e=e.replace(/rn/g,"n");var t="";for(var n=0;n<e.length;n++){var r=e.charCodeAt(n);if(r<128){t+=String.fromCharCode(r)}else if(r>127&&r<2048){t+=String.fromCharCode(r>>6|192);t+=String.fromCharCode(r&63|128)}else{t+=String.fromCharCode(r>>12|224);t+=String.fromCharCode(r>>6&63|128);t+=String.fromCharCode(r&63|128)}}return t},_utf8_decode:function(e){var t="";var n=0;var r=c1=c2=0;while(n<e.length){r=e.charCodeAt(n);if(r<128){t+=String.fromCharCode(r);n++}else if(r>191&&r<224){c2=e.charCodeAt(n+1);t+=String.fromCharCode((r&31)<<6|c2&63);n+=2}else{c2=e.charCodeAt(n+1);c3=e.charCodeAt(n+2);t+=String.fromCharCode((r&15)<<12|(c2&63)<<6|c3&63);n+=3}}return t}};


var utils = {
  mixin: function mixin(destination, source) {
      return utils.merge(destination.prototype, source);
  },
  
  mixininstance: function mixininstance(destination,source){
      var sourceInstance = new source;
      utils.merge(destination, sourceInstance);
      utils.merge(destination.prototype, source.prototype);
  },


  merge: function merge(destination, source) {
      var key;

      for (key in source) {
          if (utils.hasOwn(source, key)) {
              destination[key] = source[key];
          }
      }
  },

  hasOwn: function hasOwn(object, key) {
      return Object.prototype.hasOwnProperty.call(object, key);
  },
  
  inherit:function(childCtor, parentCtor) {
    function tempCtor() {};
    tempCtor.prototype = parentCtor.prototype;
    childCtor.superClass_ = parentCtor.prototype;
    childCtor.prototype = new tempCtor();
    childCtor.prototype.constructor = childCtor;
  },
  
  base: function(me, opt_methodName, var_args) {
    var caller = arguments.callee.caller;
    if (caller.superClass_) {
      // This is a constructor. Call the superclass constructor.
      return caller.superClass_.constructor.apply(
          me, Array.prototype.slice.call(arguments, 1));
    }

    var args = Array.prototype.slice.call(arguments, 2);
    var foundCaller = false;
    for (var ctor = me.constructor;
         ctor; ctor = ctor.superClass_ && ctor.superClass_.constructor) {
      if (ctor.prototype[opt_methodName] === caller) {
        foundCaller = true;
      } else if (foundCaller) {
        return ctor.prototype[opt_methodName].apply(me, args);
      }
    }

    // If we did not find the caller in the prototype chain,
    // then one of two things happened:
    // 1) The caller is an instance method.
    // 2) This method was not called by the right caller.
    if (me[opt_methodName] === caller) {
      return me.constructor.prototype[opt_methodName].apply(me, args);
    } else {
      throw Error(
          'base called from a method of one name ' +
          'to a method of a different name');
    }
  },
  
  noop: function(){},
  
  truefnc: function(){return true},
  
  falsefnc: function(){return true},
  
  resolve: function(value){
    var deferred = $.Deferred();
    deferred.resolve(value);
    return deferred.promise();
  },
  
  reject: function(value){
    var deferred = $.Deferred();
    deferred.reject(value);
    return deferred.promise();
  },
  
  Base64: Base64
};

module.exports = utils;

},{}],41:[function(require,module,exports){
var Control = function(options){
  var name = options.name || "?";
  this.name = name.split(' ').join('-').toLowerCase();
  this.id = this.name+'_'+(Math.floor(Math.random() * 1000000));
  
  if (!options.element) {
    var className = "ol-"+this.name.split(' ').join('-').toLowerCase();
    var tipLabel = options.tipLabel || this.name;
    var label = options.label || "?";
    
    options.element = $('<div class="'+className+' ol-unselectable ol-control"><button type="button" title="'+tipLabel+'">'+label+'</button></div>')[0];
  }
  
  var buttonClickHandler = options.buttonClickHandler || Control.prototype._handleClick.bind(this);
  
  $(options.element).on('click',buttonClickHandler);
  
  ol.control.Control.call(this,options);
  
  this._postRender();
}
ol.inherits(Control, ol.control.Control);


var proto = Control.prototype;

proto._handleClick = function(){
  var self = this;
  var map = this.getMap();
  
  var resetControl = null;
  // remove all the other, eventually toggled, interactioncontrols
  var controls = map.getControls();
  controls.forEach(function(control){
    if(control.id && control.toggle && (control.id != self.id)) {
      control.toggle(false);
      if (control.name == 'reset') {
        resetControl = control;
      }
    }
  });
  if (!self._toggled && resetControl) {
    resetControl.toggle(true);
  }
};

proto._postRender = function(){};

module.exports = Control;

},{}],42:[function(require,module,exports){
var Control = require('./control');

var InteractionControl = function(options){
  this._toggled = this._toggled || false;
  this._interaction = options.interaction || null;
  this._autountoggle = options.autountoggle || false;
  
  options.buttonClickHandler = InteractionControl.prototype._handleClick.bind(this);
  
  Control.call(this,options);
};
ol.inherits(InteractionControl, Control);

var proto = InteractionControl.prototype;

proto.toggle = function(toggle){
  var toggle = toggle !== undefined ? toggle : !this._toggled
  this._toggled = toggle;
  var map = this.getMap();
  var controlButton = $(this.element).find('button').first();
  
  if (toggle) {
    if (this._interaction) {
      map.addInteraction(this._interaction);
    }
    controlButton.addClass('g3w-ol-toggled');
  }
  else {
    if (this._interaction) {
      map.removeInteraction(this._interaction);
    }
    controlButton.removeClass('g3w-ol-toggled');
  }
}

proto._handleClick = function(e){
  this.toggle();
  Control.prototype._handleClick.call(this,e);
};

module.exports = InteractionControl;

},{"./control":41}],43:[function(require,module,exports){
var utils = require('../utils');
var InteractionControl = require('./interactioncontrol');

var PickCoordinatesInteraction = require('../interactions/pickcoordinatesinteraction');

var QueryControl = function(options){
  var self = this;
  var _options = {
    name: "querylayer",
    tipLabel: "Query layer",
    label: "\uea0f",
    interaction: new PickCoordinatesInteraction
  };
  
  options = utils.merge(options,_options);
  
  InteractionControl.call(this,options);
  
  this._interaction.on('picked',function(e){
    self.dispatchEvent({
      type: 'picked',
      coordinates: e.coordinate
    });
    if (self._autountoggle) {
      self.toggle();
    }
  });
}
ol.inherits(QueryControl, InteractionControl);

module.exports = QueryControl;

},{"../interactions/pickcoordinatesinteraction":47,"../utils":51,"./interactioncontrol":42}],44:[function(require,module,exports){
var utils = require('../utils');
var InteractionControl = require('./interactioncontrol');

var ResetControl = function(options){
  var self = this;
  this._toggled = true;
  this._startCoordinate = null;
  var _options = {
      name: "reset",
      tipLabel: "Pan",
      label: "\ue901",
    };
  
  options = utils.merge(options,_options);
  
  InteractionControl.call(this,options);
}
ol.inherits(ResetControl, InteractionControl);
module.exports = ResetControl;

var proto = ResetControl.prototype;

proto._postRender = function(){
  this.toggle(true);
};

},{"../utils":51,"./interactioncontrol":42}],45:[function(require,module,exports){
var utils = require('../utils');
var InteractionControl = require('./interactioncontrol');

var ZoomBoxControl = function(options){
  var self = this;
  this._startCoordinate = null;
  var _options = {
      name: "zoombox",
      tipLabel: "Zoom to box",
      label: "\ue900",
      interaction: new ol.interaction.DragBox
    };
  
  options = utils.merge(options,_options);
  
  InteractionControl.call(this,options);
  
  this._interaction.on('boxstart',function(e){
    self._startCoordinate = e.coordinate;
  });
  
  this._interaction.on('boxend',function(e){
    var start_coordinate = self._startCoordinate;
    var end_coordinate = e.coordinate;
    var extent = ol.extent.boundingExtent([start_coordinate,end_coordinate]);
    self.dispatchEvent({
      type: 'zoomend',
      extent: extent
    });
    self._startCoordinate = null;
    if (self._autountoggle) {
      self.toggle();
    }
  })
}
ol.inherits(ZoomBoxControl, InteractionControl);
module.exports = ZoomBoxControl;

},{"../utils":51,"./interactioncontrol":42}],46:[function(require,module,exports){
var utils = require('./utils');
var maphelpers = require('./map/maphelpers');

(function (name, root, factory) {
  if (typeof define === 'function' && define.amd) {
    define(factory);
  }
  else if (typeof exports === 'object') {
    module.exports = factory();
  }
  else {
    root[name] = factory();
  }
})('g3wol3', this, function () {
  'use strict';
  
  var helpers = utils.merge({},maphelpers);
  
  return {
    helpers: helpers
  }
});

},{"./map/maphelpers":50,"./utils":51}],47:[function(require,module,exports){
arguments[4][23][0].apply(exports,arguments)
},{"dup":23}],48:[function(require,module,exports){
var BaseLayers = {};

BaseLayers.OSM = new ol.layer.Tile({
  source: new ol.source.OSM({
    attributions: [
      new ol.Attribution({
        html: 'All maps &copy; ' +
            '<a href="http://www.openstreetmap.org/">OpenStreetMap</a>'
      }),
      ol.source.OSM.ATTRIBUTION
    ],
    url: 'http://{a-c}.tile.openstreetmap.org/{z}/{x}/{y}.png',
    crossOrigin: null
  }),
  id: 'osm',
  title: 'OSM',
  basemap: true
});

BaseLayers.BING = {};

BaseLayers.BING.Road = new ol.layer.Tile({
  name:'Road',
  visible: false,
  preload: Infinity,
  source: new ol.source.BingMaps({
    key: 'Am_mASnUA-jtW3O3MxIYmOOPLOvL39dwMvRnyoHxfKf_EPNYgfWM9imqGETWKGVn',
    imagerySet: 'Road'
      // use maxZoom 19 to see stretched tiles instead of the BingMaps
      // "no photos at this zoom level" tiles
      // maxZoom: 19
  }),
  basemap: true
});

BaseLayers.BING.AerialWithLabels = new ol.layer.Tile({
  name: 'AerialWithLabels',
  visible: true,
  preload: Infinity,
  source: new ol.source.BingMaps({
    key: 'Am_mASnUA-jtW3O3MxIYmOOPLOvL39dwMvRnyoHxfKf_EPNYgfWM9imqGETWKGVn',
    imagerySet: 'AerialWithLabels'
      // use maxZoom 19 to see stretched tiles instead of the BingMaps
      // "no photos at this zoom level" tiles
      // maxZoom: 19
  }),
  basemap: true
});

BaseLayers.BING.Aerial = new ol.layer.Tile({
  name: 'Aerial',
  visible: false,
  preload: Infinity,
  source: new ol.source.BingMaps({
    key: 'Am_mASnUA-jtW3O3MxIYmOOPLOvL39dwMvRnyoHxfKf_EPNYgfWM9imqGETWKGVn',
    imagerySet: 'Aerial'
      // use maxZoom 19 to see stretched tiles instead of the BingMaps
      // "no photos at this zoom level" tiles
      // maxZoom: 19
  }),
  basemap: true
});

module.exports = BaseLayers;

},{}],49:[function(require,module,exports){
var utils = require('../utils');
var RasterLayers = {};

RasterLayers.TiledWMSLayer = function(layerObj,extraParams){
  var options = {
    layerObj: layerObj,
    extraParams: extraParams || {},
    tiled: true
  }
  return RasterLayers._WMSLayer(options);
};

RasterLayers.WMSLayer = function(layerObj,extraParams){
  var options = {
    layerObj: layerObj,
    extraParams: extraParams || {}
  }
  return RasterLayers._WMSLayer(options);
};

RasterLayers._WMSLayer = function(options){
  var layerObj = options.layerObj;
  var extraParams = options.extraParams;
  var tiled = options.tiled || false;
  
  var params = {
    LAYERS: layerObj.layers || '',
    VERSION: '1.3.0',
    TRANSPARENT: true,
    SLD_VERSION: '1.1.0'
  };
  
  params = utils.merge(params,extraParams);
  
  var sourceOptions = {
    url: layerObj.url,
    params: params,
    ratio: 1
  };
  
  var imageOptions = {
    id: layerObj.id,
    name: layerObj.name,
    opacity: layerObj.opacity || 1.0,
    visible:layerObj.visible,
    maxResolution: layerObj.maxResolution
  }
  
  var imageClass;
  var source;
  if (tiled) {
    source = new ol.source.TileWMS(sourceOptions);
    imageClass = ol.layer.Tile;
    //imageOptions.extent = [1134867,3873002,2505964,5596944];
  }
  else {
    source = new ol.source.ImageWMS(sourceOptions)
    imageClass = ol.layer.Image;
  }
  
  imageOptions.source = source;
  
  var layer = new imageClass(imageOptions);
  
  return layer;
};

/*RasterLayers.TiledWMSLayer = function(layerObj){
  var layer = new ol.layer.Tile({
    name: layerObj.name,
    opacity: 1.0,
    source: new ol.source.TileWMS({
      url: layerObj.url,
      params: {
        LAYERS: layerObj.layers || '',
        VERSION: '1.3.0',
        TRANSPARENT: true
      }
    }),
    visible: layerObj.visible
  });
  
  return layer;
};*/

module.exports = RasterLayers;


},{"../utils":51}],50:[function(require,module,exports){
BaseLayers = require('../layers/bases');

var MapHelpers = {
  createViewer: function(opts){
    return new _Viewer(opts);
  }
};

var _Viewer = function(opts){
  var controls = ol.control.defaults({
    attributionOptions: {
      collapsible: false
    },
    zoom: false,
    attribution: false
  });//.extend([new ol.control.Zoom()]);
  
  var interactions = ol.interaction.defaults()
    .extend([
      new ol.interaction.DragRotate()
    ]);
  interactions.removeAt(1) // rimuovo douclickzoom
  
  var view;
  if (opts.view instanceof ol.View) {
    view = opts.view;
  }
  else {
    view = new ol.View(opts.view);
  }
  var options = {
    controls: controls,
    interactions: interactions,
    ol3Logo: false,
    view: view,
    keyboardEventTarget: document
  };
  if (opts.id){
    options.target = opts.id;
  }
  var map  = new ol.Map(options);
  this.map = map;
};

_Viewer.prototype.destroy = function(){
  if (this.map) {
    this.map.dispose();
    this.map = null
  }
};

_Viewer.prototype.getView = function() {
  return this.map.getView();
}

_Viewer.prototype.updateMap = function(mapObject){};

_Viewer.prototype.updateView = function(){};

_Viewer.prototype.getMap = function(){
  return this.map;
};

_Viewer.prototype.setTarget = function(id){
  this.map.setTarget(id);
};

_Viewer.prototype.goTo = function(coordinates, zoom){
  var options = options || {};
  var animate = options.animate || true;
  var view = this.map.getView();
  
  if (animate) {
    var pan = ol.animation.pan({
      duration: 500,
      source: view.getCenter()
    });
    var zoom = ol.animation.zoom({
      duration: 500,
      resolution: view.getResolution()
    });
    this.map.beforeRender(pan,zoom);
  }
  
  view.setCenter(coordinates);
  view.setZoom(zoom);
};

_Viewer.prototype.goToRes = function(coordinates, resolution){
  var options = options || {};
  var animate = options.animate || true;
  var view = this.map.getView();
  
  if (animate) {
    var pan = ol.animation.pan({
      duration: 500,
      source: view.getCenter()
    });
    var zoom = ol.animation.zoom({
      duration: 500,
      resolution: view.getResolution()
    });
    this.map.beforeRender(pan,zoom);
  }

  view.setCenter(coordinates);
  view.setResolution(resolution);
};

_Viewer.prototype.fit = function(geometry, options){
  var view = this.map.getView();
  
  var options = options || {};
  var animate = options.animate || true;
  
  if (animate) {
    var pan = ol.animation.pan({
      duration: 500,
      source: view.getCenter()
    });
    var zoom = ol.animation.zoom({
      duration: 500,
      resolution: view.getResolution()
    });
    this.map.beforeRender(pan,zoom);
  }
  
  if (options.animate) {
    delete options.animate; // non lo passo al metodo di OL3 perché è un'opzione interna
  }
  options.constrainResolution = options.constrainResolution || false;
  
  view.fit(geometry,this.map.getSize(),options);
};

_Viewer.prototype.getZoom = function(){
  var view = this.map.getView();
  return view.getZoom();
};

_Viewer.prototype.getResolution = function(){
  var view = this.map.getView();
  return view.getResolution();
};

_Viewer.prototype.getCenter = function(){
  var view = this.map.getView();
  return view.getCenter();
};

_Viewer.prototype.getBBOX = function(){
  return this.map.getView().calculateExtent(this.map.getSize());
};

_Viewer.prototype.getLayerByName = function(layerName) {
  var layers = this.map.getLayers();
  var length = layers.getLength();
  for (var i = 0; i < length; i++) {
    if (layerName === layers.item(i).get('name')) {
      return layers.item(i);
    }
  }
  return null;
};

_Viewer.prototype.removeLayerByName = function(layerName){
  var layer = this.getLayerByName(layerName);
  if (layer){
    this.map.removeLayer(layer);
    delete layer;
  }
};

_Viewer.prototype.getActiveLayers = function(){
  var activelayers = [];
  this.map.getLayers().forEach(function(layer) {
    var props = layer.getProperties();
    if (props.basemap != true && props.visible){
       activelayers.push(layer);
    }
  });
  
  return activelayers;
};

_Viewer.prototype.removeLayers = function(){
  this.map.getLayers().clear();
};

_Viewer.prototype.getLayersNoBase = function(){
  var layers = [];
  this.map.getLayers().forEach(function(layer) {
    var props = layer.getProperties();
    if (props.basemap != true){
      layers.push(layer);
    }
  });
  
  return layers;
};

_Viewer.prototype.addBaseLayer = function(type){
  var layer;
  type ? layer = BaseLayers[type]:  layer = BaseLayers.BING.Aerial;
  this.map.addLayer(layer);
};

_Viewer.prototype.changeBaseLayer = function(layerName){
  var baseLayer = this.getLayerByName(layername);
  var layers = this.map.getLayers();
  layers.insertAt(0, baseLayer);
};

module.exports = MapHelpers;

},{"../layers/bases":48}],51:[function(require,module,exports){
var utils = {
  merge: function(obj1,obj2){
    var obj3 = {};
    for (var attrname in obj1) { obj3[attrname] = obj1[attrname]; }
    for (var attrname in obj2) { obj3[attrname] = obj2[attrname]; }
    return obj3;
  }
}

module.exports = utils;

},{}],52:[function(require,module,exports){
var inherit = require('core/utils/utils').inherit;
var G3WObject = require('core/g3wobject');

var Component = function(options) {
  var options = options || {};
  this.id = options.id || Math.random() * 1000;
  this.title = options.title || '';
  this.internalComponent = null;
};
inherit(Component,G3WObject);

var proto = Component.prototype;

proto.getId = function(){
  return self.id;
};

proto.getName = function() {
  return self.name;
};

proto.getTitle = function(){
  return self.title;
};

/* HOOKS */

/* 
 * Il metodo permette al componente di montarsi nel DOM
 * parentEl: elemento DOM padre, su cui inserirsi; 
 * ritorna una promise, risolta nel momento in cui sarà terminato il montaggio
*/
proto.mount = function(parent){};

/*
 * Metodo richiamato quando si vuole rimuovere il componente.
 * Ritorna una promessa che sarà risolta nel momento in cui il componente avrà completato la propria rimozione (ed eventuale rilascio di risorse dipendenti)
*/
proto.unmount = function(){};

/* 
 * Metodo (opzionale) che offre l'opportunità di ricalcolare proprietà dipendenti dalle dimensioni del padre
 * parentHeight: nuova altezza del parent
 * parentWidth: nuova larghezza del parent
 * richiamato ogni volta che il parent subisce un ridimensionamento
*/
proto.onResize = function(parentWidth,parentHeight){};


module.exports = Component;

},{"core/g3wobject":19,"core/utils/utils":40}],53:[function(require,module,exports){
var G3WObject = require('core/g3wobject');
var inherit = require('core/utils/utils').inherit;
var base = require('core/utils/utils').base;

function ComponentsRegistry() {
  this.components = {};
  
  this.addComponent = function(component) {
    var id = component.getId();
    if (!this.components[id]) {
      this.components[id] = component;
    }
  }; 
  
  this.getComponent = function(id) {
    return this.components[id];
  };
  
  this.removeComponent = function(id) {
    var component = this._components[id];
    if (component) {
      if (_.isFunction(component.destroy)) {
        component.destroy();
      }
      delete component;
      this._components[id] = null;
    }
  };
}
inherit(ComponentsRegistry,G3WObject);

module.exports = new ComponentsRegistry;

},{"core/g3wobject":19,"core/utils/utils":40}],54:[function(require,module,exports){
noop = require('core/utils/utils').noop;
var inherit = require('core/utils/utils').inherit;
var G3WObject = require('core/g3wobject');
var ComponentsRegistry = require('gui/componentsregistry');

// rappresenta l'interfaccia globale dell'API della GUI. 
// metodi devono essere implementati (definiti) dall'applicazione ospite
// l'app ospite dovrebbe chiamare anche la funzione GUI.ready() quando la UI è pronta
function GUI(){
  // url delle risorse (immagini, ecc.)
  this.getResourcesUrl = noop;
  // show a Vue form
  this.showForm = noop;
  this.closeForm = noop;
  
  // mostra una lista di oggetti (es. lista di risultati)
  this.showListing = noop;
  this.closeListing = noop;
  this.hideListing = noop;

  /* panel */
  this.showPanel = noop;
  this.hidePanel = noop;

  //metodi componente
  this.addComponent = noop;
  this.removeComponent = noop;
  this.getComponent = function(id) {
    return ComponentsRegistry.getComponent(id);
  };
  //fine metodi componente

  this.ready = function(){
    this.emit('guiready');
  };
  
  this.guiResized = function(){
    this.emit('guiresized');
  };

  /* spinner */
  this.showSpinner = noop; // per mostrare un'icona spinner che notifica un caricamento dati in corso
  this.hideSpinner = noop;
  
  this.notify = noop;
  this.dialog = noop;
}

inherit(GUI,G3WObject);

module.exports = new GUI;

},{"core/g3wobject":19,"core/utils/utils":40,"gui/componentsregistry":53}],55:[function(require,module,exports){
module.exports = "<div>\n  Lista di oggetti\n</div>\n";

},{}],56:[function(require,module,exports){
var resolve = require('core/utils/utils').resolve;
var reject = require('core/utils/utils').reject;
var GUI = require('gui/gui');
//var MapService = require('core/map/mapservice');

var ListPanelComponent = Vue.extend({
  template: require('./listpanel.html'),
  methods: {
    exec: function(cbk){
      var relations = this.state.relations || null;
      cbk(this.state.fields,relations);
      GUI.closeForm();
    }
  }
});


function ListPanel(options){
  // proprietà necessarie. In futuro le mettermo in una classe Panel da cui deriveranno tutti i pannelli che vogliono essere mostrati nella sidebar
  this.panelComponent = null;
  this.options =  options || {};
  this.id = options.id || null; // id del form
  this.name = options.name || null; // nome del form
  
  this.state = {
    list: options.list || []
  }
  
  this._listPanelComponent = options.listPanelComponent || ListPanelComponent;
}

var proto = ListPanel.prototype;

// viene richiamato dalla toolbar quando il plugin chiede di mostrare un proprio pannello nella GUI (GUI.showPanel)
proto.onShow = function(container){
  var panel = this._setupPanel();
  this._mountPanel(panel,container);
  return resolve(true);
};

// richiamato quando la GUI chiede di chiudere il pannello. Se ritorna false il pannello non viene chiuso
proto.onClose = function(){
  this.panelComponent.$destroy(true);
  this.panelComponent = null;
  return resolve(true);
};

proto._setupPanel = function(){
  var panel = this.panelComponent = new this._listPanelComponent({
    panel: this
  });
  panel.state = this.state;
  return panel
};

proto._mountPanel = function(panel,container){
  panel.$mount().$appendTo(container);
};

module.exports = {
  ListPanelComponent: ListPanelComponent,
  ListPanel: ListPanel
}

},{"./listpanel.html":55,"core/utils/utils":40,"gui/gui":54}],57:[function(require,module,exports){
var inherit = require('core/utils/utils').inherit;
var base = require('core/utils/utils').base;
var G3WObject = require('core/g3wobject');
var GUI = require('gui/gui');
var ApplicationService = require('core/applicationservice');
var ProjectsRegistry = require('core/project/projectsregistry');
var ProjectTypes = require('core/project/projecttypes');
var GeometryTypes = require('core/geometry/geometry').GeometryTypes;
var ol3helpers = require('g3w-ol3/src/g3w.ol3').helpers;
var ResetControl = require('g3w-ol3/src/controls/resetcontrol');
var QueryControl = require('g3w-ol3/src/controls/querycontrol');
var ZoomBoxControl = require('g3w-ol3/src/controls/zoomboxcontrol');
var PickCoordinatesInteraction = require('g3w-ol3/src/interactions/pickcoordinatesinteraction');
var WMSLayer = require('core/layer/wmslayer');
var MapQueryService = require('core/map/mapqueryservice');

//var GUI = require('gui/gui'); // QUESTO NON CI DEVE ESSERE!!!

var PickToleranceParams = {};
PickToleranceParams[ProjectTypes.QDJANGO] = {};
PickToleranceParams[ProjectTypes.QDJANGO][GeometryTypes.POINT] = "FI_POINT_TOLERANCE";
PickToleranceParams[ProjectTypes.QDJANGO][GeometryTypes.LINESTRING] = "FI_LINE_TOLERANCE";
PickToleranceParams[ProjectTypes.QDJANGO][GeometryTypes.POLYGON] = "FI_POLYGON_TOLERANCE";

var PickToleranceValues = {}
PickToleranceValues[GeometryTypes.POINT] = 5;
PickToleranceValues[GeometryTypes.LINESTRING] = 5;
PickToleranceValues[GeometryTypes.POLYGON] = 5;

function MapService(project){
  var self = this;
  this.config;
  this.viewer;
  this.mapLayers = {};
  this.mapBaseLayers = {};
  this.layersAssociation = {};
  this.layersExtraParams = {};
  this.state = {
      bbox: [],
      resolution: null,
      center: null,
      loading: false
  };
  this.config = ApplicationService.getConfig().map;
  
  this._howManyAreLoading = 0;
  this._incrementLoaders = function(){
    if (this._howManyAreLoading == 0){
      this.emit('loadstart');
    }
    this._howManyAreLoading += 1;
  };
  
  this._decrementLoaders = function(){
    this._howManyAreLoading -= 1;
    if (this._howManyAreLoading == 0){
      this.emit('loadend');
    }
  };
  
  this._interactionsStack = [];
  
  if(!_.isNil(project)) {
    this.project = project;
  }
  else {
    this.project = ProjectsRegistry.getCurrentProject();
  }
  
  
  this.setters = {
    setMapView: function(bbox,resolution,center){
      this.state.bbox = bbox;
      this.state.resolution = resolution;
      this.state.center = center;
      this.updateMapLayers(this.mapLayers);
    },
    setupViewer: function(){
      //$script("http://epsg.io/"+ProjectService.state.project.crs+".js");
      proj4.defs("EPSG:"+self.project.state.crs,this.project.state.proj4);
      if (self.viewer) {
        self.viewer.destroy();
        self.viewer = null;
      }
      self._setupViewer();
      self.setupControls();
      self.setupLayers();
      self.emit('viewerset');
    }
  };
  
  this._setupViewer = function(){
    var extent = this.project.state.extent;
    var projection = new ol.proj.Projection({
      code: "EPSG:"+this.project.state.crs,
      extent: extent
    });
    
    /*var constrain_extent;
    if (this.config.constraintextent) {
      var extent = this.config.constraintextent;
      var dx = extent[2]-extent[0];
      var dy = extent[3]-extent[1];
      var dx4 = dx/4;
      var dy4 = dy/4;
      var bbox_xmin = extent[0] + dx4;
      var bbox_xmax = extent[2] - dx4;
      var bbox_ymin = extent[1] + dy4;
      var bbox_ymax = extent[3] - dy4;
      
      constrain_extent = [bbox_xmin,bbox_ymin,bbox_xmax,bbox_ymax];
    }*/
    
    this.viewer = ol3helpers.createViewer({
      view: {
        projection: projection,
        /*center: this.config.initcenter || ol.extent.getCenter(extent),
        zoom: this.config.initzoom || 0,
        extent: this.config.constraintextent || extent,
        minZoom: this.config.minzoom || 0, // default di OL3 3.16.0
        maxZoom: this.config.maxzoom || 28 // default di OL3 3.16.0*/
        center: ol.extent.getCenter(extent),
        zoom: 0,
        extent: extent,
        minZoom: 0, // default di OL3 3.16.0
        maxZoom: 28 // default di OL3 3.16.0
      }
    });
    
    this.viewer.map.on('moveend',function(e){
      self._setMapView();
    });
    
    MapQueryService.init(this.viewer.map);
    
    this.emit('ready');
  };
  
  this.project.on('projectset',function(){
    self.setupViewer();
  });
  
  this.project.on('projectswitch',function(){
    self.setupLayers();
  });
  
  this.project.onafter('setLayersVisible',function(layers){
    var mapLayers = _.map(layers,function(layer){
      return self.getMapLayerForLayer(layer);
    })
    self.updateMapLayers(mapLayers);
  });
  
  this.project.onafter('setBaseLayer',function(){
    self.updateMapLayers(self.mapBaseLayers);
  });
  
  base(this);
  
  this.setupViewer();
};

inherit(MapService,G3WObject);

var proto = MapService.prototype;

// rende questo mapservice slave di un altro MapService
proto.slaveOf = function(mapService, sameLayers){
  // se impostare i layer iniziali uguali a quelli del mapService master
  var sameLayers = sameLayers || false;
};

proto.setLayersExtraParams = function(params,update){
  this.layersExtraParams = _.assign(this.layersExtraParams,params);
  this.emit('extraParamsSet',params,update);
};

proto.getMap = function() {
  return this.viewer.map;
};

proto.getViewerElement = function(){
  return this.viewer.map.getTargetElement();
};

proto.getViewport = function(){
  return this.viewer.map.getViewport();
};

proto.setupControls = function(){
  var self = this;
  var map = self.viewer.map;
  if (this.config && this.config.controls) {
    _.forEach(this.config.controls,function(controlType){
      var control;
      switch (controlType) {
        case 'reset':
          if (!isMobile.any) {
            control = new ResetControl();
          }
          break;
        case 'zoom':
          control = new ol.control.Zoom({
            zoomInLabel: "\ue98a",
            zoomOutLabel: "\ue98b"
          });
          break;
        case 'zoombox': 
          if (!isMobile.any) {
            control = new ZoomBoxControl();
            control.on('zoomend',function(e){
              self.viewer.fit(e.extent);
            })
          }
          break;
        case 'zoomtoextent':
          control = new ol.control.ZoomToExtent({
            label:  "\ue98c",
            extent: self.config.constraintextent
          });
          break;
        case 'query':
          control = new QueryControl();
          control.on('picked',function(e){
            var coordinates = e.coordinates;

            MapQueryService.queryPoint(coordinates,self.mapLayers)
            .then(function(coordinates,nfeatures,featuresForLayerNames){
              var featuresForLayers = [];
              _.forEach(featuresForLayerNames,function(features,layerName){
                var layer = this.project.layers[layerName];
                featuresForLayers.push({
                  layer: layer,
                  features: features
                })
              })
              
              self.emit('mapqueryend',featuresForLayers,nfeatures,coordinates,self.state.resolution);
            })
          });
          break;
      }
      
      if (control) {
        self.addControl(control);
      }
    });
  }
};

proto.addControl = function(control){
  this.viewer.map.addControl(control);
};

proto.setupBaseLayers = function(){
  var self = this;
  if (!this.project.state.baselayers){
    return;
  }
  var self = this;
  this.mapBaseLayers = {};
  
  var initBaseLayer = ProjectsRegistry.config.initbaselayer;
  var baseLayersArray = this.project.state.baselayers;
  
  _.forEach(baseLayersArray,function(baseLayer){
    var visible = true;
    if (self.project.state.initbaselayer) {
      visible = baseLayer.id == (self.project.state.initbaselayer);
    }
    if (baseLayer.fixed) {
      visible = baseLayer.fixed;
    }
    baseLayer.visible = visible;
  })
  
  baseLayersArray.forEach(function(layer){     
    var config = {
      url: this.project.getWmsUrl(),
      id: layer.id,
      tiled: true
    };
    
    var mapLayer = new WMSLayer(config);
    self.registerListeners(mapLayer);
    
    mapLayer.addLayer(layer);
    self.mapBaseLayers[layer.id] = mapLayer;
  });
  
  _.forEach(_.values(this.mapBaseLayers).reverse(),function(mapLayer){
    self.viewer.map.addLayer(mapLayer.getOLLayer());
    mapLayer.update(self.state);
  })
};

proto.setupLayers = function(){
  var self = this;
  this.viewer.removeLayers();
  this.setupBaseLayers();
  
  this.mapLayers = {};
  this.layersAssociation = {};
  var layersArray = this.traverseLayersTree(this.project.state.layerstree);
  // prendo solo i layer veri e non i folder
  var leafLayersArray = _.filter(layersArray,function(layer){
    return !_.get(layer,'nodes');
  });
  var multiLayers = _.groupBy(leafLayersArray,function(layer){
    return layer.multilayer;
  });
  _.forEach(multiLayers,function(layers,id){
    var layerId = 'layer_'+id
    var mapLayer = _.get(self.mapLayers,layerId);
    var tiled = layers[0].tiled // BRUTTO, da sistemare quando riorganizzeremo i metalayer (da far diventare multilayer). Per ora posso configurare tiled solo i layer singoli
    var config = {
      url: self.project.getWmsUrl(),
      id: layerId,
      tiled: tiled
    };
    mapLayer = self.mapLayers[layerId] = new WMSLayer(config,self.layersExtraParams);
    self.registerListeners(mapLayer);
    
    layers.forEach(function(layer){
      mapLayer.addLayer(layer);
      self.layersAssociation[layer.id] = layerId;
    });
  })
  
  _.forEach(_.values(this.mapLayers).reverse(),function(mapLayer){
    self.viewer.map.addLayer(mapLayer.getOLLayer());
    mapLayer.update(self.state,self.layersExtraParams);
  })
};

proto.updateMapLayers = function(mapLayers) {
  var self = this;
  _.forEach(_.values(mapLayers),function(mapLayer){
    mapLayer.update(self.state,self.layersExtraParams);
  })
};

proto.getMapLayerForLayer = function(layer){
  return this.mapLayers['layer_'+layer.multilayer];
};

proto.traverseLayersTree = function(layersTree){
  var self = this;
  var layersArray = [];
  function traverse(obj){
    _.forIn(obj, function (val, key) {
        if (!_.isNil(val.id)) {
            layersArray.unshift(val);
        }
        if (!_.isNil(val.nodes)) {
            traverse(val.nodes);
        }
    });
  }
  traverse(layersTree);
  return layersArray;
};

proto.registerListeners = function(mapLayer){
  var self = this;
  mapLayer.on('loadstart',function(){
    self._incrementLoaders();
  });
  mapLayer.on('loadend',function(){
    self._decrementLoaders(false);
  });
  
  this.on('extraParamsSet',function(extraParams,update){
    if (update) {
      mapLayer.update(this.state,extraParams);
    }
  })
};

proto.showViewer = function(elId){
  var self = this;
  this.viewer.setTarget(elId);
  var map = this.viewer.map;
  GUI.on('guiready',function(){
    self._setMapView();
  });
};


// per creare una pila di ol.interaction in cui l'ultimo che si aggiunge disattiva temporaemente i precedenti (per poi togliersi di mezzo con popInteraction!)
// Usato ad es. da pickfeaturetool e getfeatureinfo
proto.pushInteraction = function(interaction){
  if (this._interactionsStack.length){
    var prevInteraction = this._interactionsStack.slice(-1)[0];
    if (_.isArray(prevInteraction)){
      _.forEach(prevInteraction,function(interaction){
        interaction.setActive(false);
      })
    }
    else{
      prevInteraction.setActive(false);
    };
  }
  
  this.viewer.map.addInteraction(interaction);
  interaction.setActive(true);
  this._interactionsStack.push(interaction)
};

proto.popInteraction = function(){
  var interaction = this._interactionsStack.pop();
  this.viewer.map.removeInteraction(interaction);
  
  if (this._interactionsStack.length){
    var prevInteraction = this._interactionsStack.slice(-1)[0];
    if (_.isArray(prevInteraction)){
      _.forEach(prevInteraction,function(interaction){
        interaction.setActive(true);
      })
    }
    else{
      prevInteraction.setActive(true);
    };
  }
};

proto.goTo = function(coordinates,zoom){
  var zoom = zoom || 6;
  this.viewer.goTo(coordinates,zoom);
};

proto.goToWGS84 = function(coordinates,zoom){
  var coordinates = ol.proj.transform(coordinates,'EPSG:4326','EPSG:'+this.project.state.crs);
  this.goTo(coordinates,zoom);
};

proto.extentToWGS84 = function(extent){
  return ol.proj.transformExtent(extent,'EPSG:'+this.project.state.crs,'EPSG:4326');
};

proto.getFeatureInfo = function(layerId){
  var self = this;
  var deferred = $.Deferred();
  this._pickInteraction = new PickCoordinatesInteraction();
  //this.viewer.map.addInteraction(this._pickInteraction);
  //this._pickInteraction.setActive(true);
  this.pushInteraction(this._pickInteraction);
  this._pickInteraction.on('picked',function(e){
    self._completeGetFeatureInfo(layerId,e.coordinate,deferred);
  })
  return deferred.promise();
};

proto._completeGetFeatureInfo = function(layerId,coordinate,deferred){
  var self = this;
  var projectType = this.project.state.type;
  
  var mapLayer = this.mapLayers[this.layersAssociation[layerId]];
  var resolution = self.viewer.getResolution();
  var epsg = self.viewer.map.getView().getProjection().getCode();
  var params = {
    QUERY_LAYERS: Project.getLayer(layerId).name,
    INFO_FORMAT: "text/xml"
  }
  
  if (projectType == ProjectTypes.QDJANGO){
    var toleranceParams = PickToleranceParams[projectType];
    if (toleranceParams){
      var geometrytype = this.project.getLayer(layerId).geometrytype;
      params[toleranceParams[geometrytype]] = PickToleranceValues[geometrytype];
    }
  }
  
  var getFeatureInfoUrl = mapLayer.getSource().getGetFeatureInfoUrl(coordinate,resolution,epsg,params);
  $.get(getFeatureInfoUrl)
  .then(function(data){
    var x2js = new X2JS();
    var jsonData = x2js.xml2json(data);
    if (jsonData.GetFeatureInfoResponse.Layer.Feature){
      var attributes = jsonData.GetFeatureInfoResponse.Layer.Feature.Attribute;
      var attributesObj = {};
      _.forEach(attributes,function(attribute){
        attributesObj[attribute._name] = attribute._value; // X2JS aggiunge "_" come prefisso degli attributi
      })
      
      deferred.resolve(attributesObj);
    }
    deferred.reject();;
  })
  .fail(function(){
    deferred.reject();
  })
  .always(function(){
    //self.viewer.map.removeInteraction(self._pickInteraction);
    self.popInteraction();
    self._pickInteraction = null;
  })
};

proto.highlightGeometry = function(geometryObj,options){    
  var geometry;
  if (geometryObj instanceof ol.geom.Geometry){
    geometry = geometryObj;
  }
  else {
    format = new ol.format.GeoJSON;
    geometry = format.readGeometry(geometryObj);
  }
  
  if (options.zoom) {
    this.viewer.fit(geometry);
  }
  
  var duration = options.duration || 4000;
  
  if (options.fromWGS84) {
    geometry.transform('EPSG:4326','EPSG:'+this.project.project.crs);
  }
  
  var feature = new ol.Feature({
    geometry: geometry
  });
  var source = new ol.source.Vector();
  source.addFeatures([feature]);
  var layer = new ol.layer.Vector({
    source: source,
    style: function(feature){
      var styles = [];
      var geometryType = feature.getGeometry().getType();
      if (geometryType == 'LineString') {
        var style = new ol.style.Style({
          stroke: new ol.style.Stroke({
            color: 'rgb(255,255,0)',
            width: 4
          })
        })
        styles.push(style);
      }
      else if (geometryType == 'Point'){
        var style = new ol.style.Style({
          image: new ol.style.Circle({
            radius: 6,
            fill: new ol.style.Fill({
              color: 'rgb(255,255,0)',
            })
          }),
          zIndex: Infinity
        });
        styles.push(style);
      }
      
      return styles;
    }
  })
  layer.setMap(this.viewer.map);
  
  setTimeout(function(){
    layer.setMap(null);
  },duration);
};

proto.refreshMap = function(){
  _.forEach(this.mapLayers,function(wmsLayer){
    wmsLayer.getLayer().getSource().updateParams({"time": Date.now()});
  })
};

proto._setMapView = function(){
  var bbox = this.viewer.getBBOX();
  var resolution = this.viewer.getResolution();
  var center = this.viewer.getCenter();
  this.setMapView(bbox,resolution,center);
};

module.exports = MapService

},{"core/applicationservice":18,"core/g3wobject":19,"core/geometry/geometry":21,"core/layer/wmslayer":27,"core/map/mapqueryservice":29,"core/project/projectsregistry":34,"core/project/projecttypes":35,"core/utils/utils":40,"g3w-ol3/src/controls/querycontrol":43,"g3w-ol3/src/controls/resetcontrol":44,"g3w-ol3/src/controls/zoomboxcontrol":45,"g3w-ol3/src/g3w.ol3":46,"g3w-ol3/src/interactions/pickcoordinatesinteraction":47,"gui/gui":54}],58:[function(require,module,exports){
module.exports = "<div id=\"map\" style=\"width:100%;height:100%\">\n</div>\n";

},{}],59:[function(require,module,exports){
var inherit = require('core/utils/utils').inherit;
var base = require('core/utils/utils').base;
var merge = require('core/utils/utils').merge;
var t = require('core/i18n/i18n.service').t;
var resolve = require('core/utils/utils').resolve;
var GUI = require('gui/gui');   
var Component = require('gui/vue/component');
var RouterService = require('core/router');
var ol3helpers = require('g3w-ol3/src/g3w.ol3').helpers;
var MapsRegistry = require('core/map/mapsregistry');
var MapService = require('../mapservice');

function mainHeight(){
  //return $(window).innerHeight()-$(".navbar").innerHeight();
  //return $(window).innerHeight();
  var topHeight = $(".navbar").innerHeight();
  var bottomHeight = 0;
  
  if ($(".bottombar").is(":visible")) {
    bottomHeight = $(".bottombar").innerHeight()
  }
  return $(window).innerHeight() - topHeight - bottomHeight;
}

/* map resize calculations */
function setMapDivHeight(map){
  var height = mainHeight();
  $("#map").height(height);
  map.updateSize();
}

function setMapDivWidth(map){
  var offset = $(".main-sidebar").offset().left;
  var width = $(".main-sidebar").innerWidth();
  var sideBarSpace = width + offset;
  $("#map").width($(window).innerWidth() - sideBarSpace);
  map.updateSize();
}

var vueComponentOptions = {
  template: require('./map.html'),
  ready: function(){
    var self = this;
    
    var mapService = this.$options.mapService;
    
    mapService.showViewer(this.$el.id);
    
    // questo serve per quando viene cambiato progetto/vista cartografica, in cui viene ricreato il viewer (e quindi la mappa)
    mapService.onafter('setupViewer',function(){
      mapService.showViewer(self.$el.id);
    });
    
    GUI.on('guiready',function(){
      setMapDivHeight(mapService.getMap());
      
      $('.main-sidebar').on('webkitTransitionEnd transitionend msTransitionEnd oTransitionEnd', function () {
          $(this).trigger('trans-end');
          setMapDivWidth(mapService.getMap());
      });
      
      var drawing = false;
      var resizeFired = false;
      
      GUI.on('guiresized',function(){
        resizeFired = true;
        drawResize();
      });
      
      $(window).resize(function() {
        // set resizedFired to true and execute drawResize if it's not already running
        if (drawing === false) {
            resizeFired = true;
            drawResize();
        }
      });

      function drawResize() {
        var height;
        // render friendly resize loop
        if (resizeFired === true) {
            resizeFired = false;
            drawing = true;
            setMapDivHeight(mapService.getMap());
            setMapDivWidth(mapService.getMap());
            requestAnimationFrame(drawResize);
        } else {
            drawing = false;
        }
      }
      
    })
  }
}

var InternalComponent = Vue.extend(vueComponentOptions);

Vue.component('g3w-map', vueComponentOptions);

function MapComponent(options){
  base(this,options);
  this.id = "map-component";
  this.title = "Catalogo dati";
  this.mapService = new MapService;
  merge(this, options);
  this.internalComponent = new InternalComponent({
    mapService: this.mapService
  });
}
inherit(MapComponent, Component);

var proto = MapComponent.prototype;

module.exports =  MapComponent;

},{"../mapservice":57,"./map.html":58,"core/i18n/i18n.service":22,"core/map/mapsregistry":30,"core/router":36,"core/utils/utils":40,"g3w-ol3/src/g3w.ol3":46,"gui/gui":54,"gui/vue/component":76}],60:[function(require,module,exports){
var localize = require('core/i18n/i18n.service').t;
var inherit = require('core/utils/utils').inherit;
var resolvedValue = require('core/utils/utils').resolve;
var G3WObject = require('core/g3wobject');

var Panel = function(options) {
  self = this;
  var options = options || {};
  self.id = options.id || null;
  self.title = options.title || '';
};

inherit(Panel, G3WObject);

var proto = Panel.prototype;

proto.getId = function(){
  return self.id;
};

proto.getTitle = function(){
  return self.title;
};

/* HOOKS */

/*
 * Il metodo permette al pannello di montarsi nel DOM
 * parent: elemento DOM padre, su cui inserirsi;
 * ritorna una promise, risolta nel momento in cui sarà terminato il montaggio
*/

// SONO DUE TIPOLOGIE DI MONTAGGIO CON IL QUALE IL PANNELLO
// CHE VERRA' MONTATO AL VOLO CON IL METODO MOUNT A SECONDA DEL TIPO DI PANNELLO RICHIESTO

// richiamato quando la GUI chiede di chiudere il pannello. Se ritorna false il pannello non viene chiuso

proto.mount = function(parent) {
  var panel = this.InternalPanel;
  panel.$mount().$appendTo(parent);
  localize();
  return resolvedValue(true);
};

/*
 * Metodo richiamato quando si vuole rimuovere il panello.
 * Ritorna una promessa che sarà risolta nel momento in cui il pannello avrà completato la propria rimozione (ed eventuale rilascio di risorse dipendenti)
*/
proto.unmount = function(){
  var panel = this.InternalPanel;
  var deferred = $.Deferred();
  panel.$destroy(true);
  deferred.resolve();
  return deferred.promise();
};

/*
 * Metodo (opzionale) che offre l'opportunità di ricalcolare proprietà dipendenti dalle dimensioni del padre
 * parentHeight: nuova altezza del parent
 * parentWidth: nuova larghezza del parent
 * richiamato ogni volta che il parent subisce un ridimensionamento
*/
proto.onResize = function(parentWidth,parentHeight){};


module.exports = Panel;

},{"core/g3wobject":19,"core/i18n/i18n.service":22,"core/utils/utils":40}],61:[function(require,module,exports){
var inherit = require('core/utils/utils').inherit;
var GUI = require('gui/gui');
var ProjectsRegistry = require('core/project/projectsregistry');
var G3WObject = require('core/g3wobject');
var SearchPanel = require('gui/search/vue/panel/searchpanel');

function SearchesService(){
  var self = this;
  this.init = function(searchesObject) {
    var searches = searchesObject || ProjectsRegistry.getCurrentProject().state.search;
    this.state.searches = searches;
  };

  this.state = {
    searches: []
  };

  this.showSearchPanel = function(panelConfig) {
    panel = new SearchPanel();// creo panello search
    panel.init(panelConfig);//inizializzo pannello serach
    GUI.showPanel(panel);
    return panel;
  };

  this.cleanSearchPanels = function() {
    this.state.panels = {};
  };

  this.stop = function(){
    var deferred = $.Deferred();
    deferred.resolve();
    return deferred.promise();
  };
};

// Make the public service en Event Emitter
inherit(SearchesService, G3WObject);

module.exports = new SearchesService();

},{"core/g3wobject":19,"core/project/projectsregistry":34,"core/utils/utils":40,"gui/gui":54,"gui/search/vue/panel/searchpanel":63}],62:[function(require,module,exports){
module.exports = "<div class=\"g3w-search-panel form-group\">\n  <form id=\"g3w-search-form\">\n    <template v-for=\"forminput in forminputs\">\n       <template v-if=\"forminput.input.type == 'numberfield'\" class=\"numeric\">\n         <label for=\"{{ forminput.id }} \">{{ forminput.label }}</label>\n         <input type=\"number\" v-model=\"formInputValues[$index].value\" class=\"form-control\" id=\"{{ forminput.id }}\">\n       </template>\n      <template v-if=\"forminput.input.type == 'textfield'\" class=\"text\">\n         <label for=\"{{ forminput.id }}\">{{ forminput.label }}</label>\n         <input type=\"text\" v-model=\"formInputValues[$index].value\" class=\"form-control\" id=\"{{ forminput.id }}\">\n       </template>\n    </template>\n    <button class=\"btn btn-primary\" @click=\"doSearch($event)\" data-i18n=\"dosearch\">Search</button>\n  </form>\n</div>\n";

},{}],63:[function(require,module,exports){
var inherit = require('core/utils/utils').inherit;
var localize = require('core/i18n/i18n.service').t;
var resolve = require('core/utils/utils').resolve;
var GUI = require('gui/gui');
var SearchQueryService = require('core/search/searchqueryservice');
var ListPanel = require('gui/listpanel').ListPanel;
var Panel = require('gui/panel');
var SearchResultPanelComponent = require('gui/search/vue/results/resultpanel');
var ProjectsRegistry = require('core/project/projectsregistry');

//componente vue pannello search
var SearchPanelComponet = Vue.extend({
  template: require('./searchpanel.html'),
  data: function() {
    return {
      forminputs: [],
      filterObject: {},
      formInputValues : []
    }
  },
  methods: {
    doSearch: function(event) {
      event.preventDefault();
      //al momento molto farragginoso ma da rivedere
      //per associazione valore input
      this.filterObject = fillFilterInputsWithValues(this.filterObject, this.formInputValues);
      SearchQueryService.doQuerySearch(this.filterObject);
    }
  }
});

//funzione che associa i valori dell'inputs form al relativo oggetto "operazionde del filtro"

function fillFilterInputsWithValues (filterObject, formInputValues, globalIndex) {
  //funzione conversione da valore restituito dall'input (sempre stringa) al vero tipo di valore
  function convertInputValueToInputType(type, value) {
    switch(type) {
      case 'numberfield':
           value = parseInt(value);
           break;
      default:
           break;
    }
    return value;
  }
  //ciclo sull'oggetto filtro che ha come chiave root 'AND' o 'OR'
  _.forEach(filterObject.filterObject, function(v,k) {
    //scorro attraverso l'array di elementi operazionali da confrontare
    _.forEach(v, function(input, idx) {
      //elemento operazionale {'=':{}}
      _.forEach(input, function(v, k, obj) {
        //vado a leggere l'oggetto attributo
        if (_.isArray(v)) {
          //richiama la funzione ricorsivamente .. andrà bene ?
          fillFilterInputsWithValues(input, formInputValues, idx);
        } else {
          _.forEach(v, function(v, k, obj) {
            //considero l'index globale in modo che inputs di operazioni booleane interne
            //vengono considerate
            index = (globalIndex) ? globalIndex + idx : idx;
            obj[k] = convertInputValueToInputType(formInputValues[index].type, formInputValues[index].value);
          });
        };
      });
    });
  });
  return filterObject;
};

//costruttore del pannello e del suo componente vue
function SearchPanel() {
  self = this;
  this.config = {};
  this.filter = {};
  this.id = null;
  this.querylayerid = null;
  this.InternalPanel = new SearchPanelComponet();
  //funzione inizializzazione
  this.init = function(config) {
    this.config = config || {};
    this.name = this.config.name || this.name;
    this.id = this.config.id || this.id;
    this.filter = this.config.options.filter || this.filter;
    this.querylayerid = this.config.options.querylayerid || this.querylayerid;
    //vado a riempire gli input del form del pannello
    this.fillInputsFormFromFilter();
    //creo e assegno l'oggetto filtro
    var filterObjFromConfig = SearchQueryService.createQueryFilterFromConfig(this.filter);
    //alla fine creo l'ggetto finale del filtro da passare poi al provider QGISWMS o WFS etc.. che contiene sia
    //il filtro che url, il nome del layer il tipo di server etc ..
    this.InternalPanel.filterObject = SearchQueryService.createQueryFilterObject(this.querylayerid, filterObjFromConfig);
  };

  //funzione che popola gli inputs che ci saranno nel form del pannello ricerca
  //oltre costruire un oggetto che legherà i valori degli inputs del form con gli oggetti
  //'operazionali' del filtro
  this.fillInputsFormFromFilter = function() {
    var id = 0;
    var formValue;
    _.forEach(this.filter,function(v,k,obj) {
      _.forEach(v, function(input){
        //sempre nuovo oggetto
        formValue = {};
        //inserisco l'id all'input
        input.id = id
        //aggiungo il tipo al valore per fare conversione da stringa a tipo input
        formValue.type = input.input.type;
        ////TEMPORANEO !!! DEVO PRENDERE IL VERO VALORE DI DEFAULT
        formValue.value = null;
        //popolo gli inputs:

        // valori
        self.InternalPanel.formInputValues.push(formValue);
        //input
        self.InternalPanel.forminputs.push(input);
        id+=1;
      });
    });
  };
};

inherit(SearchPanel, Panel);

//search query
SearchQueryService.on("searchresults",function(results){
  var listPanel = new ListPanel({
    name: "Risultati ricerca",
    id: 'nominatim_results',
    list: results,
    listPanelComponent: SearchResultPanelComponent
  });
  GUI.showListing(listPanel);
});

module.exports = SearchPanel;

},{"./searchpanel.html":62,"core/i18n/i18n.service":22,"core/project/projectsregistry":34,"core/search/searchqueryservice":39,"core/utils/utils":40,"gui/gui":54,"gui/listpanel":56,"gui/panel":60,"gui/search/vue/results/resultpanel":65}],64:[function(require,module,exports){
module.exports = "<div id=\"search-results\">\n  <table style=\"width:100px;\" id=\"search-results-table\">\n    <thead>\n      <tr>\n        <th v-for=\"header in state.list.headers\"  style=\"cursor:pointer\">{{ header }}</th>\n      </tr>\n    </thead>\n    <tbody>\n      <tr v-for=\"values in state.list.values\" style=\"cursor:pointer\">\n        <td v-for=\"value in values\">\n          {{ value }}\n        </td>\n      </tr>\n    </tbody>\n  </table>\n</div>\n";

},{}],65:[function(require,module,exports){
var SearchResultPanelComponent = Vue.extend({
  template: require('./resultpanel.html'),
  methods: {},
  created: function(){
    $("#search-results-table").footable({
      calculateWidthOverride: function(){
        return {
          width: $('#search-results').width()
        }
      }
    });
  }
});

module.exports = SearchResultPanelComponent;

},{"./resultpanel.html":64}],66:[function(require,module,exports){
module.exports = "<div id=\"g3w-search\" class=\"g3w-search g3w-tools\">\n  <ul>\n    <li v-for=\"search in searches.search\">\n      <div style=\"margin-bottom: 5px;\"class=\"search-header tool-header\" @click=\"showSearchPanel(search)\">\n        <span style=\"\">{{ search.name }}</span>\n      </div>\n    </li>\n  </ul>\n</div>\n\n";

},{}],67:[function(require,module,exports){
var inherit = require('core/utils/utils').inherit;
var base = require('core/utils/utils').base;
var merge = require('core/utils/utils').merge;
var t = require('core/i18n/i18n.service').t;
var resolve = require('core/utils/utils').resolve;
var Component = require('gui/vue/component');
var GUI = require('gui/gui');
var ProjectsRegistry = require('core/project/projectsregistry');
var G3WObject = require('core/g3wobject');
var SearchPanel = require('gui/search/vue/panel/searchpanel');
var ProjectsRegistry = require('core/project/projectsregistry');
var SearchesService = require('gui/search/searchesservice');

var vueComponentOptions = {
   template: require('./search.html'),
   data: function() {
    	return {
    	  searches: ProjectsRegistry.getCurrentProject().state
    	};
   },
   methods: {
    showSearchPanel: function(search) {
        var panel = SearchesService.showSearchPanel(search);
    }
  }
};

// se lo voglio istanziare manualmente
var InternalComponent = Vue.extend(vueComponentOptions);
// se lo voglio usare come componente come elemento html
//Vue.component('g3w-search',vueComponentOptions);

/* COMPONENTI FIGLI */
/* FINE COMPONENTI FIGLI */

/* INTERFACCIA PUBBLICA */
function SearchComponent(options){
  base(this,options);
  this.id = "search-component";
  this.title = "search";
  this.internalComponent = new InternalComponent;
  merge(this, options);
  this.initService = function() {
    //inizializzo il servizio
    SearchesService.init();
  };
};

inherit(SearchComponent, Component);


module.exports = SearchComponent;

},{"./search.html":66,"core/g3wobject":19,"core/i18n/i18n.service":22,"core/project/projectsregistry":34,"core/utils/utils":40,"gui/gui":54,"gui/search/searchesservice":61,"gui/search/vue/panel/searchpanel":63,"gui/vue/component":76}],68:[function(require,module,exports){
var inherit = require('core/utils/utils').inherit;
var G3WObject = require('core/g3wobject');

function ToolsService(){
  var self = this;
  this.config = null;
  this._actions = {};
  this.state = {
    tools: []
  };
  
  this.init = function(config){
    this.config = config;
    this.setState();
  };
  
  this.setState = function(){
    this._mergeTools(this.config.tools);
  };
  
  this.registerToolsProvider = function(plugin){
    self._mergeTools(plugin.getTools());
    self._addActions(plugin);
  }
  
  this.fireAction = function(actionid){
    var plugin = this._actions[actionid];
    var method = this._actionMethod(actionid);
    plugin[method]();
  };
  
  this._actionMethod = function(actionid){
    var namespace = actionid.split(":");
    return namespace.pop();
  };
  
  this._mergeTools = function(tools){
    self.state.tools = _.concat(self.state.tools,tools);
  };
  
  this._addActions = function(plugin){
    _.forEach(plugin.getTools(),function(tool){
      _.forEach(plugin.getActions(tool),function(action){
        self._actions[action.id] = plugin;
      })
    })
  };
};

// Make the public service en Event Emitter
inherit(ToolsService,G3WObject);

module.exports = ToolsService

},{"core/g3wobject":19,"core/utils/utils":40}],69:[function(require,module,exports){
module.exports = "<div class=\"g3w-tools\">\n  <ul>\n    <li v-for=\"tool in tools\">\n      <div data-toggle=\"collapse\" data-target=\"#iternet-tools\" class=\"tool-header\">\n        <span style=\"\">{{ tool.name }}</span>\n      </div>\n      <div id=\"iternet-tools\" class=\"tool-box collapse\">\n        <template v-for=\"action in tool.actions\">\n          <i class=\"glyphicon glyphicon-cog\"></i>\n          <span @click=\"fireAction(action.id)\">{{ action.name }}</span>\n        </template>\n      </div>\n    </li>\n  </ul>\n</div>\n";

},{}],70:[function(require,module,exports){
var t = require('core/i18n/i18n.service').t;
var inherit = require('core/utils/utils').inherit;
var base = require('core/utils/utils').base;
var merge = require('core/utils/utils').merge;
var Component = require('gui/vue/component');

var ToolsService = require('gui/tools/toolsservice');

var InternalComponent = Vue.extend({
    template: require('./tools.html'),
    data: function() {
      return {
        //tools: ToolsService.state.tools
      }
    },
    methods: {
      fireAction: function(actionid){
        //ToolsService.fireAction(actionid);
      }
    }
});

function ToolsComponent(options){
  base(this,options);
  this.id = "tools-component";
  this.title = "tools";
  this.toolsService = new ToolsService();
  merge(this, options);
  this.internalComponent = new InternalComponent({
    toolsService: this.toolsService
  });
}

inherit(ToolsComponent, Component);

module.exports = ToolsComponent;

},{"./tools.html":69,"core/i18n/i18n.service":22,"core/utils/utils":40,"gui/tools/toolsservice":68,"gui/vue/component":76}],71:[function(require,module,exports){
module.exports = "<!-- item template -->\n<div id=\"catalog\" class=\"tabbable-panel catalog\">\n  <div class=\"tabbable-line\">\n    <ul class=\"nav nav-tabs\" role=\"tablist\">\n      <li role=\"presentation\" class=\"active\"><a href=\"#tree\" aria-controls=\"tree\" role=\"tab\" data-toggle=\"tab\" data-i18n=\"tree\">Data</a></li>\n      <li v-if=\"hasBaseLayers\" role=\"presentation\"><a href=\"#baselayers\" aria-controls=\"baselayers\" role=\"tab\" data-toggle=\"tab\" data-i18n=\"baselayers\">Layer Base</a></li>\n      <li role=\"presentation\"><a href=\"#legend\" aria-controls=\"legend\" role=\"tab\" data-toggle=\"tab\" data-i18n=\"legend\">Legenda</a></li>\n    </ul>\n    <div  class=\"tab-content\">\n      <div role=\"tabpanel\" class=\"tab-pane active tree\" id=\"tree\">\n        <ul class=\"tree-root\">\n          <tristate-tree v-if=\"!isHidden\" :layerstree=\"layerstree\" class=\"item\" v-for=\"layerstree in layerstree\">\n          </tristate-tree>\n        </ul>\n      </div>\n      <div v-if=\"hasBaseLayers\" role=\"tabpanel\" class=\"tab-pane baselayers\" id=\"baselayers\">\n        <form>\n          <ul>\n            <li v-if=\"!baselayer.fixed\" v-for=\"baselayer in baselayers\">\n              <div class=\"radio\">\n                <label><input type=\"radio\" name=\"baselayer\" v-checked=\"baselayer.visible\" @click=\"setBaseLayer(baselayer.id)\">{{ baselayer.title }}</label>\n              </div>\n            </li>\n          </ul>\n        </form>\n      </div>\n      <legend :layerstree=\"layerstree\"></legend>\n    </div>\n  </div>\n</div>\n";

},{}],72:[function(require,module,exports){
var inherit = require('core/utils/utils').inherit;
var base = require('core/utils/utils').base;
var merge = require('core/utils/utils').merge;
var t = require('core/i18n/i18n.service').t;
var resolve = require('core/utils/utils').resolve;
var Component = require('gui/vue/component');
var GUI = require('gui/gui');
var ProjectsRegistry = require('core/project/projectsregistry');

var vueComponentOptions = {
  template: require('./catalog.html'),
  data: function() {
    return {
      project: ProjectsRegistry.getCurrentProject()
    }
  },
  computed: {
    layerstree: function(){
      return this.project.state.layerstree;
    },
    baselayers: function(){
      return this.project.state.baselayers;
    },
    hasBaseLayers: function(){
      return this.project.state.baselayers.length>0;
    }
  },
  methods: {
    setBaseLayer: function(id) {
      this.project.setBaseLayer(id);
    }
  },
  ready: function() {
    var self = this;
    this.$on('treenodetoogled',function(node){
      self.project.toggleLayer(node);
    });

    this.$on('treenodestoogled',function(nodes,parentChecked){
      self.project.toggleLayers(nodes,parentChecked);
    });
  }
}

// se lo voglio istanziare manualmente
var InternalComponent = Vue.extend(vueComponentOptions);

// se lo voglio usare come componente come elemento html
Vue.component('g3w-catalog', vueComponentOptions);


/* COMPONENTI FIGLI */

// tree component


Vue.component('tristate-tree', {
  template: require('./tristate-tree.html'),
  props: {
    layerstree: [],
    //eredito il numero di childs dal parent
    n_parentChilds : 0,
    checked: false
  },
  data: function () {
    return {
      expanded: this.layerstree.expanded,
      parentChecked: false,
      //proprieta che serve per fare confronto per il tristate
      n_childs: this.layerstree.nodes ? this.layerstree.nodes.length : 0
    }
  },
  watch: {
      'checked': function (val){
        this.layerstree.visible = val;
      }
  },
  computed: {
    isFolder: function () {
      var isFolder = this.n_childs ? true : false;
      if (isFolder) {
        var _visibleChilds = 0;
        _.forEach(this.layerstree.nodes,function(layer){
          if (layer.visible){
            _visibleChilds += 1;
          }
        });
        this.n_parentChilds = this.n_childs - _visibleChilds;
      }
      return isFolder
    },
    isHidden: function() {
      return this.layerstree.hidden && (this.layerstree.hidden === true);
    }
  },
  methods: {
    toggle: function (checkAllLayers) {
      var checkAll = checkAllLayers == 'true' ? true : false;
      if (this.isFolder && !checkAll) {
        this.layerstree.expanded = !this.layerstree.expanded;
      }
      else if (checkAll){
        if (this.parentChecked && !this.n_parentChilds){
          this.parentChecked = false;
        } else if (this.parentChecked && this.n_parentChilds) {
          this.parentChecked = true;
        }
        else {
          this.parentChecked = !this.parentChecked;
        }
        this.$dispatch('treenodestoogled',this.layerstree.nodes,this.parentChecked);
      }
      else {
        this.$dispatch('treenodetoogled',this.layerstree);
      }
    },
    triClass: function () {
      if (!this.n_parentChilds) {
        return 'fa-check-square-o';
      } else if ((this.n_parentChilds > 0) && (this.n_parentChilds < this.n_childs)) {
        return 'fa-square';
      } else {
        return 'fa-square-o';
      }
    }
  }
})

Vue.component('legend',{
    template: require('./legend.html'),
    props: ['layerstree'],
    data: function() {
      return {
        //data qui
      }
    },
    computed: {
      visiblelayers: function(){
        var _visiblelayers = [];
        var layerstree = this.layerstree;
        function traverse(obj){
        _.forIn(obj, function (layer, key) {
              //verifica che il valore dell'id non sia nullo
              if (!_.isNil(layer.id) && layer.visible) {
                  _visiblelayers.push(layer);
              }
              if (!_.isNil(layer.nodes)) {
                  traverse(layer.nodes);
              }
          });
        }
        traverse(layerstree);
        return _visiblelayers;
      }
    },
    watch: {
      'layerstree': {
        handler: function(val, old){
          //codice qui
        },
        deep: true
      }
    },
    ready: function() {
      //codice qui
    }
});

Vue.component('legend-item',{
  template: require('./legend_item.html'),
  props: ['layer'],
  computed: {
    legendurl: function(){
      // in attesa di risolvere lo schianto di QGSI Server...
      //return "http://localhost/cgi-bin/qgis_mapserv.fcgi?map=/home/giohappy/Scrivania/Dev/G3W/g3w-client/test/progetto/test.qgs&SERVICE=WMS&VERSION=1.3.0&REQUEST=GetLegendGraphic&FORMAT=image/png&LAYERTITLE=False&ITEMFONTSIZE=10&LAYER="+this.layer.name;
      return ProjectsRegistry.getCurrentProject().getLegendUrl(this.layer);
    }
  },
  methods: {
    // esempio utilizzo del servizio GUI
    openform: function(){
      //GUI.notify.success("Apro un form");
      //GUI.showForm();
    }
  }
});

/* FINE COMPONENTI FIGLI */

/* INTERFACCIA PUBBLICA */
function CatalogComponent(options){
  this.id = "catalog-component";
  this.title = "catalog";
  this.internalComponent = new InternalComponent;
  //mergio opzioni con proprità di default del componente
  merge(this, options);
}

inherit(CatalogComponent, Component);

module.exports = CatalogComponent;

},{"./catalog.html":71,"./legend.html":73,"./legend_item.html":74,"./tristate-tree.html":75,"core/i18n/i18n.service":22,"core/project/projectsregistry":34,"core/utils/utils":40,"gui/gui":54,"gui/vue/component":76}],73:[function(require,module,exports){
module.exports = "<div role=\"tabpanel\" class=\"tab-pane\" id=\"legend\">\n  <legend-item :layer=\"layer\" v-for=\"layer in visiblelayers\"></legend-item>\n</div>\n";

},{}],74:[function(require,module,exports){
module.exports = "<div @click=\"openform()\">{{ layer.title }}</div>\n<div><img :src=\"legendurl\"></div>\n";

},{}],75:[function(require,module,exports){
module.exports = "<li class=\"tree-item\">\n  <span :class=\"{bold: isFolder, 'fa-chevron-down': layerstree.expanded, 'fa-chevron-right': !layerstree.expanded}\" @click=\"toggle\" v-if=\"isFolder\" class=\"fa\"></span>\n  <span v-if=\"isFolder\" @click=\"toggle('true')\" :class=\"[triClass()]\" class=\"fa\"></span>\n  <span v-else @click=\"toggle\" :class=\"[layerstree.visible  ? 'fa-check-square-o': 'fa-square-o',layerstree.disabled  ? 'disabled': '']\" class=\"fa\" style=\"cursor:default\"></span>\n  <span :class=\"{bold: isFolder, disabled: layerstree.disabled}\" @click=\"toggle\">{{layerstree.title}}</span>\n  <ul v-show=\"layerstree.expanded\" v-if=\"isFolder\">\n    <tristate-tree :n_parent-childs.sync=\"n_parentChilds\" :layerstree=\"layerstree\" :checked=\"parentChecked\" v-for=\"layerstree in layerstree.nodes\">\n    </tristate-tree>\n  </ul>\n</li>\n\n\n\n\n";

},{}],76:[function(require,module,exports){
var inherit = require('core/utils/utils').inherit;
var base = require('core/utils/utils').base;
var resolve = require('core/utils/utils').resolve;
var reject = require('core/utils/utils').reject;
var BaseComponent = require('gui/component');

var Component = function(options) {
  base(this,options);
};

inherit(Component, BaseComponent);

var proto = Component.prototype;

// viene richiamato dalla toolbar quando il plugin chiede di mostrare un proprio pannello nella GUI (GUI.showPanel)
proto.mount = function(parent){
  this.internalComponent.$mount(parent);
  return resolve(true);
};

// richiamato quando la GUI chiede di chiudere il pannello. Se ritorna false il pannello non viene chiuso
proto.unmount = function(){
  this.internalComponent.$destroy(true);
  this.internalComponent = null;
  return resolve();
};

module.exports = Component;

},{"core/utils/utils":40,"gui/component":52}],77:[function(require,module,exports){
Vue.directive("disabled",function(value){
    if (value){
      this.el.setAttribute('disabled','disabled');
    }
    else {
      this.el.removeAttribute('disabled');
    }
  }
);

Vue.directive("checked",function(value){
    if (value){
      this.el.setAttribute('checked','checked');
    }
    else {
      this.el.removeAttribute('checked');
    }
  }
);

Vue.directive("selected-first",function(value){
    if (value==0){
      this.el.setAttribute('selected','');
    }
    else {
      this.el.removeAttribute('selected');
    }
  }
);

},{}],78:[function(require,module,exports){
var g3w = g3w || {};

g3w.core = {
   G3WObject: require('core/g3wobject'),
   utils: require('core/utils/utils'),
   ApplicationService: require('core/applicationservice'),
   ApiService: require('core/apiservice'),
   Router: require('core/router'),
   ProjectsRegistry: require('core/project/projectsregistry'),
   Project: require('core/project/project'),
   MapQueryService: require('core/map/mapqueryservice'),
   MapLayer: require('core/map/maplayer'),
   LayerState: require('core/layer/layerstate'),
   VectorLayer: require('core/layer/vectorlayer'),
   WmsLayer: require('core/layer/wmslayer'),
   Geometry: require('core/geometry/geometry'),
   geom: require('core/geometry/geom'),
   PickCoordinatesInteraction: require('core/interactions/pickcoordinatesinteraction'),
   PickFeatureInteraction: require('core/interactions/pickfeatureinteraction'),
   i18n: require('core/i18n/i18n.service'),
   Plugin: require('core/plugin/plugin'),
   PluginsRegistry: require('core/plugin/pluginsregistry')
};

g3w.gui = {
  gui: require('gui/gui'),
  vue: {
    //GeocodingComponent: require('gui/vue/geocoding/geocoding'),
    SearchComponent: require('gui/search/vue/search'),
    CatalogComponent: require('gui/vue/catalog/catalog'),
    MapComponent: require('gui/map/vue/map'),
    ToolsComponent: require('gui/tools/vue/tools')
  }
};

module.exports = {
  core: g3w.core,
  gui: g3w.gui
};

},{"core/apiservice":17,"core/applicationservice":18,"core/g3wobject":19,"core/geometry/geom":20,"core/geometry/geometry":21,"core/i18n/i18n.service":22,"core/interactions/pickcoordinatesinteraction":23,"core/interactions/pickfeatureinteraction":24,"core/layer/layerstate":25,"core/layer/vectorlayer":26,"core/layer/wmslayer":27,"core/map/maplayer":28,"core/map/mapqueryservice":29,"core/plugin/plugin":31,"core/plugin/pluginsregistry":32,"core/project/project":33,"core/project/projectsregistry":34,"core/router":36,"core/utils/utils":40,"gui/gui":54,"gui/map/vue/map":59,"gui/search/vue/search":67,"gui/tools/vue/tools":70,"gui/vue/catalog/catalog":72}]},{},[3])


//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvYXBwL2NvbmZpZy9jb25maWcuanMiLCJzcmMvYXBwL2NvbmZpZy9sb2NhbGVzL2FwcC5qcyIsInNyYy9hcHAvaW5kZXguanMiLCJzcmMvYXBwL3RlbXBsYXRlL2h0bWwvYXBwLmh0bWwiLCJzcmMvYXBwL3RlbXBsYXRlL2h0bWwvZmxvYXRiYXIuaHRtbCIsInNyYy9hcHAvdGVtcGxhdGUvaHRtbC9zaWRlYmFyLWl0ZW0uaHRtbCIsInNyYy9hcHAvdGVtcGxhdGUvaHRtbC9zaWRlYmFyLmh0bWwiLCJzcmMvYXBwL3RlbXBsYXRlL2h0bWwvdmlldy5odG1sIiwic3JjL2FwcC90ZW1wbGF0ZS9odG1sL3ZpZXdwb3J0Lmh0bWwiLCJzcmMvYXBwL3RlbXBsYXRlL2pzL2FwcGxpY2F0aW9udWkuanMiLCJzcmMvYXBwL3RlbXBsYXRlL2pzL2JhcnN0YWNrLmpzIiwic3JjL2FwcC90ZW1wbGF0ZS9qcy9mbG9hdGJhci5qcyIsInNyYy9hcHAvdGVtcGxhdGUvanMvbGF5b3V0LmpzIiwic3JjL2FwcC90ZW1wbGF0ZS9qcy9zaWRlYmFyLmpzIiwic3JjL2FwcC90ZW1wbGF0ZS9qcy90ZW1wbGF0ZS5qcyIsInNyYy9hcHAvdGVtcGxhdGUvanMvdmlld3BvcnQuanMiLCJzcmMvbGlicy9zZGsvY29yZS9hcGlzZXJ2aWNlLmpzIiwic3JjL2xpYnMvc2RrL2NvcmUvYXBwbGljYXRpb25zZXJ2aWNlLmpzIiwic3JjL2xpYnMvc2RrL2NvcmUvZzN3b2JqZWN0LmpzIiwic3JjL2xpYnMvc2RrL2NvcmUvZ2VvbWV0cnkvZ2VvbS5qcyIsInNyYy9saWJzL3Nkay9jb3JlL2dlb21ldHJ5L2dlb21ldHJ5LmpzIiwic3JjL2xpYnMvc2RrL2NvcmUvaTE4bi9pMThuLnNlcnZpY2UuanMiLCJzcmMvbGlicy9zZGsvY29yZS9pbnRlcmFjdGlvbnMvcGlja2Nvb3JkaW5hdGVzaW50ZXJhY3Rpb24uanMiLCJzcmMvbGlicy9zZGsvY29yZS9pbnRlcmFjdGlvbnMvcGlja2ZlYXR1cmVpbnRlcmFjdGlvbi5qcyIsInNyYy9saWJzL3Nkay9jb3JlL2xheWVyL2xheWVyc3RhdGUuanMiLCJzcmMvbGlicy9zZGsvY29yZS9sYXllci92ZWN0b3JsYXllci5qcyIsInNyYy9saWJzL3Nkay9jb3JlL2xheWVyL3dtc2xheWVyLmpzIiwic3JjL2xpYnMvc2RrL2NvcmUvbWFwL21hcGxheWVyLmpzIiwic3JjL2xpYnMvc2RrL2NvcmUvbWFwL21hcHF1ZXJ5c2VydmljZS5qcyIsInNyYy9saWJzL3Nkay9jb3JlL21hcC9tYXBzcmVnaXN0cnkuanMiLCJzcmMvbGlicy9zZGsvY29yZS9wbHVnaW4vcGx1Z2luLmpzIiwic3JjL2xpYnMvc2RrL2NvcmUvcGx1Z2luL3BsdWdpbnNyZWdpc3RyeS5qcyIsInNyYy9saWJzL3Nkay9jb3JlL3Byb2plY3QvcHJvamVjdC5qcyIsInNyYy9saWJzL3Nkay9jb3JlL3Byb2plY3QvcHJvamVjdHNyZWdpc3RyeS5qcyIsInNyYy9saWJzL3Nkay9jb3JlL3Byb2plY3QvcHJvamVjdHR5cGVzLmpzIiwic3JjL2xpYnMvc2RrL2NvcmUvcm91dGVyLmpzIiwic3JjL2xpYnMvc2RrL2NvcmUvc2VhcmNoL3F1ZXJ5UUdJU1dNU1Byb3ZpZGVyLmpzIiwic3JjL2xpYnMvc2RrL2NvcmUvc2VhcmNoL3F1ZXJ5V0ZTUHJvdmlkZXIuanMiLCJzcmMvbGlicy9zZGsvY29yZS9zZWFyY2gvc2VhcmNocXVlcnlzZXJ2aWNlLmpzIiwic3JjL2xpYnMvc2RrL2NvcmUvdXRpbHMvdXRpbHMuanMiLCJzcmMvbGlicy9zZGsvZzN3LW9sMy9zcmMvY29udHJvbHMvY29udHJvbC5qcyIsInNyYy9saWJzL3Nkay9nM3ctb2wzL3NyYy9jb250cm9scy9pbnRlcmFjdGlvbmNvbnRyb2wuanMiLCJzcmMvbGlicy9zZGsvZzN3LW9sMy9zcmMvY29udHJvbHMvcXVlcnljb250cm9sLmpzIiwic3JjL2xpYnMvc2RrL2czdy1vbDMvc3JjL2NvbnRyb2xzL3Jlc2V0Y29udHJvbC5qcyIsInNyYy9saWJzL3Nkay9nM3ctb2wzL3NyYy9jb250cm9scy96b29tYm94Y29udHJvbC5qcyIsInNyYy9saWJzL3Nkay9nM3ctb2wzL3NyYy9nM3cub2wzLmpzIiwic3JjL2xpYnMvc2RrL2czdy1vbDMvc3JjL2xheWVycy9iYXNlcy5qcyIsInNyYy9saWJzL3Nkay9nM3ctb2wzL3NyYy9sYXllcnMvcmFzdGVycy5qcyIsInNyYy9saWJzL3Nkay9nM3ctb2wzL3NyYy9tYXAvbWFwaGVscGVycy5qcyIsInNyYy9saWJzL3Nkay9nM3ctb2wzL3NyYy91dGlscy5qcyIsInNyYy9saWJzL3Nkay9ndWkvY29tcG9uZW50LmpzIiwic3JjL2xpYnMvc2RrL2d1aS9jb21wb25lbnRzcmVnaXN0cnkuanMiLCJzcmMvbGlicy9zZGsvZ3VpL2d1aS5qcyIsInNyYy9saWJzL3Nkay9ndWkvbGlzdHBhbmVsLmh0bWwiLCJzcmMvbGlicy9zZGsvZ3VpL2xpc3RwYW5lbC5qcyIsInNyYy9saWJzL3Nkay9ndWkvbWFwL21hcHNlcnZpY2UuanMiLCJzcmMvbGlicy9zZGsvZ3VpL21hcC92dWUvbWFwLmh0bWwiLCJzcmMvbGlicy9zZGsvZ3VpL21hcC92dWUvbWFwLmpzIiwic3JjL2xpYnMvc2RrL2d1aS9wYW5lbC5qcyIsInNyYy9saWJzL3Nkay9ndWkvc2VhcmNoL3NlYXJjaGVzc2VydmljZS5qcyIsInNyYy9saWJzL3Nkay9ndWkvc2VhcmNoL3Z1ZS9wYW5lbC9zZWFyY2hwYW5lbC5odG1sIiwic3JjL2xpYnMvc2RrL2d1aS9zZWFyY2gvdnVlL3BhbmVsL3NlYXJjaHBhbmVsLmpzIiwic3JjL2xpYnMvc2RrL2d1aS9zZWFyY2gvdnVlL3Jlc3VsdHMvcmVzdWx0cGFuZWwuaHRtbCIsInNyYy9saWJzL3Nkay9ndWkvc2VhcmNoL3Z1ZS9yZXN1bHRzL3Jlc3VsdHBhbmVsLmpzIiwic3JjL2xpYnMvc2RrL2d1aS9zZWFyY2gvdnVlL3NlYXJjaC5odG1sIiwic3JjL2xpYnMvc2RrL2d1aS9zZWFyY2gvdnVlL3NlYXJjaC5qcyIsInNyYy9saWJzL3Nkay9ndWkvdG9vbHMvdG9vbHNzZXJ2aWNlLmpzIiwic3JjL2xpYnMvc2RrL2d1aS90b29scy92dWUvdG9vbHMuaHRtbCIsInNyYy9saWJzL3Nkay9ndWkvdG9vbHMvdnVlL3Rvb2xzLmpzIiwic3JjL2xpYnMvc2RrL2d1aS92dWUvY2F0YWxvZy9jYXRhbG9nLmh0bWwiLCJzcmMvbGlicy9zZGsvZ3VpL3Z1ZS9jYXRhbG9nL2NhdGFsb2cuanMiLCJzcmMvbGlicy9zZGsvZ3VpL3Z1ZS9jYXRhbG9nL2xlZ2VuZC5odG1sIiwic3JjL2xpYnMvc2RrL2d1aS92dWUvY2F0YWxvZy9sZWdlbmRfaXRlbS5odG1sIiwic3JjL2xpYnMvc2RrL2d1aS92dWUvY2F0YWxvZy90cmlzdGF0ZS10cmVlLmh0bWwiLCJzcmMvbGlicy9zZGsvZ3VpL3Z1ZS9jb21wb25lbnQuanMiLCJzcmMvbGlicy9zZGsvZ3VpL3Z1ZS92dWUuZGlyZWN0aXZlcy5qcyIsInNyYy9saWJzL3Nkay9zZGsuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUNBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDL0NBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDaEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM3SEE7QUFDQTs7QUNEQTtBQUNBOztBQ0RBO0FBQ0E7O0FDREE7QUFDQTs7QUNEQTtBQUNBOztBQ0RBO0FBQ0E7O0FDREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNyQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM5Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDL0dBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3Z2QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNuSEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ25MQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMzRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbEVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2hEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3ROQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMxQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN0QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMvQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2xEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzlGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzNGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2pWQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3RLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3RCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNuTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDeEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2pDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzFEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDeklBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDaEtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNMQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNqRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzFIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3JPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNsSEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3JKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2pEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDekNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDL0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDekJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDckNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7QUN0QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNoRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdkZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdE5BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDVkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2xEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDaENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ25EQTtBQUNBOztBQ0RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQy9EQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDL2pCQTtBQUNBOztBQ0RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2xIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNsRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdkNBO0FBQ0E7O0FDREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdklBO0FBQ0E7O0FDREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDZkE7QUFDQTs7QUNEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3BEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDckRBO0FBQ0E7O0FDREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDcENBO0FBQ0E7O0FDREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDek1BO0FBQ0E7O0FDREE7QUFDQTs7QUNEQTtBQUNBOztBQ0RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDNUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM3QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiYnVpbGQuanMiLCJzb3VyY2VSb290IjoiL3NvdXJjZS8iLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsInZhciBhcHB0aXRsZSA9IFwiRzNXIENsaWVudFwiO1xuXG52YXIgcGx1Z2lucyA9IHtcbn07XG5cbnZhciB0b29scyA9IHtcbiAgdG9vbHM6ICBbXVxufTtcblxudmFyIG1hcGNvbnRyb2xzID0gWyd6b29tJywnem9vbWJveCcsJ3F1ZXJ5J107XG4vL3ZhciBtYXBjb250cm9scyA9IFsnem9vbScsJ3pvb21ib3gnLCd6b29tdG9leHRlbnQnLCdxdWVyeSddO1xuXG52YXIgaTE4biA9IHtcbiAgcmVzb3VyY2VzOiByZXF1aXJlKCcuL2xvY2FsZXMvYXBwLmpzJylcbn07XG5cbnZhciBjbGllbnQgPSAge1xuICBkZWJ1ZzogIHRydWUsXG4gIGxvY2FsOiAgZmFsc2Vcbn07XG5cbnZhciBzZXJ2ZXIgPSAge1xuICB1cmxzOiAge1xuICAgIG93czogICcvb3dzJyxcbiAgICBhcGk6ICAnL2FwaScsXG4gICAgY29uZmlnOiAgJy9hcGkvY29uZmlnJyxcbiAgICBzdGF0aWN1cmw6ICAnJyxcbiAgfVxufTtcblxuLyp2YXIgdGVtcGxhdGVzID0gIHtcbiAgYXBwOiAgcmVxdWlyZSgnLi4vdGVtcGxhdGVzL2FwcC5odG1sJyksXG4gIHNpZGViYXI6ICByZXF1aXJlKCcuLi90ZW1wbGF0ZXMvc2lkZWJhci5odG1sJyksXG4gIGZsb2F0YmFyOiAgcmVxdWlyZSgnLi4vdGVtcGxhdGVzL2Zsb2F0YmFyLmh0bWwnKSxcbn07Ki9cblxubW9kdWxlLmV4cG9ydHMgPSB7XG4gIGFwcHRpdGxlOiBhcHB0aXRsZSxcbiAgY2xpZW50OiBjbGllbnQsXG4gIHNlcnZlcjogc2VydmVyLFxuICBwbHVnaW5zOiAgcGx1Z2lucyxcbiAgdG9vbHM6ICB0b29scyxcbiAgbWFwOiB7XG4gICAgY29udHJvbHM6IG1hcGNvbnRyb2xzXG4gIH0sXG4gIGkxOG46IGkxOG5cbn07XG4iLCJ2YXIgdHJhbnNsYXRpb25zID0ge1xuICAgIFwiaXRcIjoge1xuICAgICAgICBcInRyYW5zbGF0aW9uXCI6IHtcbiAgICAgICAgICAgIFwiY29tcG9uZW50XCI6IFwiQ29tcG9uZW50ZSBHZW5lcmljb1wiLFxuICAgICAgICAgICAgXCJzZWFyY2hcIjogXCJSaWNlcmNhXCIsXG4gICAgICAgICAgICBcImNhdGFsb2dcIjogXCJDYXRhbG9nbyBkYXRpXCIsXG4gICAgICAgICAgICBcImJhc2VsYXllcnNcIjogXCJCYXNpXCIsXG4gICAgICAgICAgICBcInRvb2xzXCI6IFwiU3RydW1lbnRpXCIsXG4gICAgICAgICAgICBcInRyZWVcIjogXCJEYXRpXCIsXG4gICAgICAgICAgICBcImxlZ2VuZFwiOiBcIkxlZ2VuZGFcIixcbiAgICAgICAgICAgIFwic3RyZWV0X3NlYXJjaFwiOiBcIkNlcmNhIGluZGlyaXp6b1wiXG4gICAgICAgIH1cbiAgICB9XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IHRyYW5zbGF0aW9ucztcbiIsInZhciBpMThuaW5pdCA9IHJlcXVpcmUoJ3NkaycpLmNvcmUuaTE4bi5pbml0O1xudmFyIEFwcGxpY2F0aW9uU2VydmljZSA9IHJlcXVpcmUoJ3Nkay9zZGsnKS5jb3JlLkFwcGxpY2F0aW9uU2VydmljZTtcbnZhciBBcHBsaWNhdGlvblRlbXBsYXRlID0gcmVxdWlyZSgnLi90ZW1wbGF0ZS9qcy90ZW1wbGF0ZScpO1xuXG4vLyBTRVRUTyBMQSBWQVJJQUJJTEUgR0xPQkFMRSBnM3dzZGssIENPTUUgU0UgQVZFU1NJIFVTQVRPIHNkay5qc1xud2luZG93Lmczd3NkayA9IHJlcXVpcmUoJ3NkaycpO1xuXG52YXIgY29uZmlnID0gcmVxdWlyZSgnLi9jb25maWcvY29uZmlnLmpzJyk7XG5cbmZ1bmN0aW9uIGNyZWF0ZUFwcGxpY2F0aW9uQ29uZmlnKCkgeyAgXG4gIHJldHVybiB7XG4gICAgYXBwdGl0bGU6IGNvbmZpZy5hcHB0aXRsZSB8fCAnJyxcbiAgICBkZWJ1ZzogY29uZmlnLmNsaWVudC5kZWJ1ZyB8fCBmYWxzZSxcbiAgICBncm91cDogY29uZmlnLmdyb3VwLFxuICAgIHVybHM6IGNvbmZpZy5zZXJ2ZXIudXJscyxcbiAgICByZXNvdXJjZXN1cmw6IGNvbmZpZy5zZXJ2ZXIudXJscy5zdGF0aWN1cmwsXG4gICAgcHJvamVjdHM6IGNvbmZpZy5ncm91cC5wcm9qZWN0cyxcbiAgICBpbml0cHJvamVjdDogY29uZmlnLmdyb3VwLmluaXRwcm9qZWN0LFxuICAgIGJhc2VsYXllcnM6IGNvbmZpZy5ncm91cC5iYXNlbGF5ZXJzLFxuICAgIGNyczogY29uZmlnLmdyb3VwLmNycyxcbiAgICBwcm9qNDogY29uZmlnLmdyb3VwLnByb2o0LFxuICAgIG1pbnNjYWxlOiBjb25maWcuZ3JvdXAubWluc2NhbGUsXG4gICAgbWF4c2NhbGU6IGNvbmZpZy5ncm91cC5tYXhzY2FsZSxcbiAgICAvLyByaWNoaWVzdG8gZGEgUHJvamVjdFNlcnZpY2VcbiAgICBnZXRXbXNVcmw6IGZ1bmN0aW9uKHByb2plY3Qpe1xuICAgICAgcmV0dXJuIGNvbmZpZy5zZXJ2ZXIudXJscy5vd3MrJy8nK2NvbmZpZy5ncm91cC5pZCsnLycrcHJvamVjdC50eXBlKycvJytwcm9qZWN0LmlkO1xuICAgIH0sXG4gICAgLy8gcmljaGllc3RvIGRhIFByb2plY3RzUmVnaXN0cnlcbiAgICBnZXRQcm9qZWN0Q29uZmlnVXJsOiBmdW5jdGlvbihwcm9qZWN0KXtcbiAgICAgIHJldHVybiBjb25maWcuc2VydmVyLnVybHMuY29uZmlnKycvJytjb25maWcuZ3JvdXAuaWQrJy8nK3Byb2plY3QudHlwZSsnLycrcHJvamVjdC5pZDtcbiAgICB9LFxuICAgIHBsdWdpbnM6IGNvbmZpZy5ncm91cC5wbHVnaW5zLFxuICAgIHRvb2xzOiBjb25maWcudG9vbHMsXG4gICAgdmlld3M6IGNvbmZpZy52aWV3cyB8fCB7fSxcbiAgICBtYXA6IGNvbmZpZy5tYXBcbiAgfTtcbn07XG5cbi8vIHF1ZXN0YSDDqCBsYSBjb25maWd1cmF6aW9uZSBiYXNlIGRlbCB0ZW1wbGF0ZSBjaGUgY29udGVycsOgIHR1dHRpIGdsaVxuLy8gZWxlbWVudGkgcHJldmlzdGkgZGFsIHRlbXBsYXRlLiBOZWxsYSBkZWZpbml6aW9uZSBzb25vIHR1dHRpIG9nZ2V0dGkgdnVvdGlcbi8vIFNhcsOgIGwnYXBwbGljYXppb25lIGEgc2NlZ2xpZXJlIGRpIHJpZW1waXJlIGdsaSBlbGVtZW50aVxuZnVuY3Rpb24gY3JlYXRlVGVtcGxhdGVDb25maWcoKXtcbiAgdmFyIENhdGFsb2dDb21wb25lbnQgPSByZXF1aXJlKCdzZGsnKS5ndWkudnVlLkNhdGFsb2dDb21wb25lbnQ7XG4gIHZhciBTZWFyY2hDb21wb25lbnQgPSByZXF1aXJlKCdzZGsnKS5ndWkudnVlLlNlYXJjaENvbXBvbmVudDtcbiAgdmFyIFRvb2xzQ29tcG9uZW50ID0gcmVxdWlyZSgnc2RrJykuZ3VpLnZ1ZS5Ub29sc0NvbXBvbmVudDtcbiAgdmFyIE1hcENvbXBvbmVudCA9IHJlcXVpcmUoJ3NkaycpLmd1aS52dWUuTWFwQ29tcG9uZW50O1xuICBcbiAgcmV0dXJuIHtcbiAgICB0aXRsZTogY29uZmlnLmFwcHRpdGxlLFxuICAgIHBsYWNlaG9sZGVyczoge1xuICAgICAgbmF2YmFyOiB7XG4gICAgICAgIGNvbXBvbmVudHM6IFtdXG4gICAgICB9LFxuICAgICAgc2lkZWJhcjoge1xuICAgICAgICBjb21wb25lbnRzOiBbXG4gICAgICAgICAgbmV3IFNlYXJjaENvbXBvbmVudCh7XG4gICAgICAgICAgICBpZDogJ3NlYXJjaCcsXG4gICAgICAgICAgICBvcGVuT25TdGFydDogZmFsc2UsXG4gICAgICAgICAgICBkYXRhSWNvbjogXCJmYSBmYS1zZWFyY2hcIlxuICAgICAgICAgIH0pLFxuICAgICAgICAgIG5ldyBDYXRhbG9nQ29tcG9uZW50KHtcbiAgICAgICAgICAgIGlkOiAnY2F0YWxvZycsXG4gICAgICAgICAgICBvcGVuT25TdGFydDogdHJ1ZSxcbiAgICAgICAgICAgIGRhdGFJY29uOiBcImZhIGZhLWRhdGFiYXNlXCJcbiAgICAgICAgICB9KSxcbiAgICAgICAgICBuZXcgVG9vbHNDb21wb25lbnQoe1xuICAgICAgICAgICAgaWQ6ICd0b29scycsXG4gICAgICAgICAgICBvcGVuT25TdGFydDogZmFsc2UsXG4gICAgICAgICAgICBkYXRhSWNvbjogXCJmYSBmYS1nZWFyXCJcbiAgICAgICAgICB9KVxuICAgICAgICBdXG4gICAgICB9LFxuICAgICAgY29udGVudDogeyAvLyBwbGFjZWhvbGRlciBkZWwgY29udGVudXRvICh2aWV3IGNvbnRlbnQpIGluaXppYWxtZW50ZSBWaXN0YSBTZWNvbmRhcmlhIChuYXNjb3N0YSlcbiAgICAgICAgY29tcG9uZW50czogW11cbiAgICAgIH0sIFxuICAgICAgZmxvYXRiYXI6e1xuICAgICAgICBjb21wb25lbnRzOiBbXVxuICAgICAgfVxuICAgIH0sXG4gICAgdmlld3BvcnQ6IHtcbiAgICAgIG1hcDogbmV3IE1hcENvbXBvbmVudCh7XG4gICAgICAgIGlkOiAnbWFwJ1xuICAgICAgfSksXG4gICAgICBjb250ZW50eDogbnVsbFxuICAgIH1cbiAgfTtcbn1cblxuZnVuY3Rpb24gb2J0YWluSW5pdENvbmZpZygpe1xuICB2YXIgZCA9ICQuRGVmZXJyZWQoKTtcbiAgaWYgKHdpbmRvdy5pbml0Q29uZmlnKSB7XG4gICAgcmV0dXJuIGQucmVzb2x2ZSh3aW5kb3cuaW5pdENvbmZpZyk7XG4gIH1cbiAgLy8gYWx0cmltZW50aSBkZXZvIGFzcGV0dGFyZSBjaGUgbG9jYWwuaW5pdGNvbmZpZy5qcyBhYmJpYSBjYXJpY2F0byBsJ2luaXRjb25maWdcbiAgZWxzZXtcbiAgICAkKGRvY3VtZW50KS5vbignaW5pdGNvbmZpZ1JlYWR5JyxmdW5jdGlvbihlLGluaXRjb25maWcpe1xuICAgICAgcmV0dXJuIGQucmVzb2x2ZShpbml0Y29uZmlnKTtcbiAgICB9KVxuICB9XG4gIHJldHVybiBkLnByb21pc2UoKTtcbn1cblxuQXBwbGljYXRpb25TZXJ2aWNlLm9uKCdyZWFkeScsZnVuY3Rpb24oKXtcbiAgLy9pc3RhbnppbyBsJ2FwcGljYXRpb24gdGVtcGxhdGUgcGFzc2FuZG8gbGEgY29uZmlndXJhemlvbmUgZGVsIHRlbXBsYXRlIGUgbCdhcHBsaWNhdGlvblNlcnZpY2UgY2hlIGZvcm5pc2NlIEFQSSBkZWwgcHJvZ2V0dG9cbiAgdmFyIHRlbXBsYXRlQ29uZmlnID0gY3JlYXRlVGVtcGxhdGVDb25maWcoKTtcbiAgLy9pc3RhbnppbyBsJ2FwcGxpY2F0aW9uIFRlbXBsYXRlXG4gIGFwcGxpY2F0aW9uVGVtcGxhdGUgPSBuZXcgQXBwbGljYXRpb25UZW1wbGF0ZSh0ZW1wbGF0ZUNvbmZpZywgdGhpcyk7XG4gIC8vaW5pemlhbGl6em8gZSBmYWNjaW8gcGFydGlyZSBjb24gaWxtZXRvZG8gaW5pdFxuICBhcHBsaWNhdGlvblRlbXBsYXRlLmluaXQoKTtcbn0pO1xuXG5ib290c3RyYXAgPSBmdW5jdGlvbigpe1xuICBpMThuaW5pdChjb25maWcuaTE4bik7XG5cbiAgb2J0YWluSW5pdENvbmZpZygpXG4gIC50aGVuKGZ1bmN0aW9uKGluaXRDb25maWcpe1xuICAgIGNvbmZpZy5zZXJ2ZXIudXJscy5zdGF0aWN1cmwgPSBpbml0Q29uZmlnLnN0YXRpY3VybDtcbiAgICBjb25maWcuZ3JvdXAgPSBpbml0Q29uZmlnLmdyb3VwO1xuICAgIFxuICAgICAgdmFyIGFwcGxpY2F0aW9uQ29uZmlnID0gY3JlYXRlQXBwbGljYXRpb25Db25maWcoKTtcbiAgICAgIEFwcGxpY2F0aW9uU2VydmljZS5pbml0KGFwcGxpY2F0aW9uQ29uZmlnKTtcbiAgfSlcbn0oKTtcblxuXG4iLCJtb2R1bGUuZXhwb3J0cyA9IFwiPGRpdiBjbGFzcz1cXFwid3JhcHBlclxcXCI+XFxuICA8aGVhZGVyIGNsYXNzPVxcXCJtYWluLWhlYWRlclxcXCI+XFxuICAgIDwhLS0gTG9nbyAtLT5cXG4gICAgPCEtLSBIZWFkZXIgTmF2YmFyOiBzdHlsZSBjYW4gYmUgZm91bmQgaW4gaGVhZGVyLmxlc3MgLS0+XFxuICAgIDxuYXYgY2xhc3M9XFxcIm5hdmJhciBuYXZiYXItc3RhdGljLXRvcFxcXCIgcm9sZT1cXFwibmF2aWdhdGlvblxcXCI+XFxuICAgICAgPCEtLSBUb2dnbGUgYnV0dG9uIG9uIG5hdmJhciBvbmx5IGZvciBtb2JpbGUgLS0+XFxuICAgICAgPGEgdi1pZj1cXFwiaXNNb2JpbGUoKVxcXCIgaHJlZj1cXFwiI1xcXCIgY2xhc3M9XFxcInNpZGViYXItdG9nZ2xlXFxcIiBkYXRhLXRvZ2dsZT1cXFwib2ZmY2FudmFzXFxcIiByb2xlPVxcXCJidXR0b25cXFwiPlxcbiAgICAgICAgPHNwYW4gY2xhc3M9XFxcInNyLW9ubHlcXFwiPkV4cGFuZDwvc3Bhbj5cXG4gICAgICA8L2E+XFxuICAgICAgPGRpdiBjbGFzcz1cXFwibmF2YmFyLWN1c3RvbS1tZW51XFxcIj5cXG4gICAgICAgIDx1bCBjbGFzcz1cXFwibmF2IG5hdmJhci1uYXZcXFwiPlxcbiAgICAgICAgPC91bD5cXG4gICAgICA8L2Rpdj5cXG4gICAgPC9uYXY+XFxuICA8L2hlYWRlcj5cXG4gIDwhLS0gTGVmdCBzaWRlIGNvbHVtbi4gY29udGFpbnMgdGhlIGxvZ28gYW5kIHNpZGViYXIgLS0+XFxuICA8c2lkZWJhcj48L3NpZGViYXI+XFxuICA8IS0tIENvbnRlbnQgV3JhcHBlci4gQ29udGFpbnMgcGFnZSBjb250ZW50IC0tPlxcbiAgPGRpdiBjbGFzcz1cXFwiY29udGVudC13cmFwcGVyXFxcIiBzdHlsZT1cXFwiYmFja2dyb3VuZC1jb2xvcjp3aGl0ZVxcXCI+XFxuICAgIDx2aWV3cG9ydD48L3ZpZXdwb3J0PlxcbiAgPC9kaXY+XFxuICA8IS0tIC8uY29udGVudC13cmFwcGVyIC0tPlxcbiAgPCEtLSBDb250cm9sIFNpZGViYXIgLS0+XFxuICA8ZmxvYXRiYXI+PC9mbG9hdGJhcj5cXG4gIDwhLS0gLy5jb250cm9sLXNpZGViYXIgLS0+XFxuICA8IS0tIEFkZCB0aGUgc2lkZWJhcidzIGJhY2tncm91bmQuIFRoaXMgZGl2IG11c3QgYmUgcGxhY2VkXFxuICAgICAgIGltbWVkaWF0ZWx5IGFmdGVyIHRoZSBjb250cm9sIHNpZGViYXIgLS0+XFxuICA8ZGl2IGNsYXNzPVxcXCJjb250cm9sLXNpZGViYXItYmdcXFwiPjwvZGl2PlxcbjwvZGl2PlxcblwiO1xuIiwibW9kdWxlLmV4cG9ydHMgPSBcIjxhc2lkZSBjbGFzcz1cXFwiY29udHJvbC1zaWRlYmFyIGNvbnRyb2wtc2lkZWJhci1saWdodFxcXCIgPlxcbiAgPGEgdi1zaG93PVxcXCJwYW5lbHNpbnN0YWNrXFxcIiBocmVmPVxcXCIjXFxcIiBjbGFzcz1cXFwiZmxvYXRiYXItYXNpZGUtdG9nZ2xlXFxcIiBkYXRhLXRvZ2dsZT1cXFwiY29udHJvbC1zaWRlYmFyXFxcIiByb2xlPVxcXCJidXR0b25cXFwiPlxcbiAgICA8c3BhbiBjbGFzcz1cXFwic3Itb25seVxcXCI+RXhwYW5kPC9zcGFuPlxcbiAgPC9hPlxcbiAgPGRpdiB2LXNob3c9XFxcInBhbmVsc2luc3RhY2tcXFwiIGNsYXNzPVxcXCJnM3ctc2lkZWJhcnBhbmVsXFxcIj5cXG4gICAgPGRpdiBjbGFzcz1cXFwicm93XFxcIj5cXG4gICAgICA8ZGl2IGNsYXNzPVxcXCJjb2wteHMtMTIgY29sLXNtLTEyIGNvbC1tZC0xMlxcXCI+XFxuICAgICAgICA8YnV0dG9uIGNsYXNzPVxcXCJnbHlwaGljb24gZ2x5cGhpY29uLXJlbW92ZSBwdWxsLXJpZ2h0IGNsb3NlLXBhbmVsLWJ1dHRvblxcXCIgQGNsaWNrPVxcXCJjbG9zZVBhbmVsXFxcIj48L2J1dHRvbj5cXG4gICAgICA8L2Rpdj5cXG4gICAgPC9kaXY+XFxuICAgIDxkaXY+XFxuICAgICAgPGg0IGNsYXNzPVxcXCJnM3ctZmxvYXRiYXJwYW5lbC1uYW1lXFxcIj57eyBwYW5lbG5hbWUgfX08L2gyPlxcbiAgICA8L2Rpdj5cXG4gICAgPGRpdiBpZD1cXFwiZzN3LWZsb2F0YmFycGFuZWwtcGxhY2Vob2xkZXJcXFwiIGNsYXNzPVxcXCJnM3ctZmxvYXRiYXJwYW5lbC1wbGFjZWhvbGRlclxcXCI+PC9kaXY+XFxuICA8L2Rpdj5cXG48L2FzaWRlPlxcblwiO1xuIiwibW9kdWxlLmV4cG9ydHMgPSBcIjxsaSBjbGFzcz1cXFwidHJlZXZpZXdcXFwiIDpjbGFzcz1cXFwieydhY3RpdmUnOiBvcGVuT25TdGFydH1cXFwiPlxcbiAgPGEgaHJlZj1cXFwiI1xcXCI+XFxuICAgIDxpIDpjbGFzcz1cXFwiZGF0YUljb25cXFwiPjwvaT5cXG4gICAgPHNwYW4gY2xhc3M9XFxcInRyZWV2aWV3LWxhYmVsXFxcIj57e2RhdGFMYWJlbCB8IHR9fTwvc3Bhbj5cXG4gICAgPGkgdi1pZj1cXFwiKGRhdGFUeXBlID09PSAnaW5saW5lJylcXFwiIGNsYXNzPVxcXCJmYSBmYS1hbmdsZS1sZWZ0IHB1bGwtcmlnaHRcXFwiPjwvaT5cXG4gIDwvYT5cXG4gIDx1bCB2LWlmPVxcXCIoZGF0YVR5cGUgPT09ICdpbmxpbmUnKVxcXCIgY2xhc3M9XFxcInRyZWV2aWV3LW1lbnVcXFwiPlxcbiAgICA8ZGl2IGlkPVxcXCJnM3ctc2lkZWJhcmNvbXBvbmVudC1wbGFjZWhvbGRlclxcXCIgY2xhc3M9XFxcImczdy1zaWRlYmFycGFuZWwtcGxhY2Vob2xkZXJcXFwiPjwvZGl2PlxcbiAgPC91bD5cXG48L2xpPlxcblwiO1xuIiwibW9kdWxlLmV4cG9ydHMgPSBcIjxhc2lkZSBjbGFzcz1cXFwibWFpbi1zaWRlYmFyXFxcIj5cXG4gIDwhLS0gc2lkZWJhcjogc3R5bGUgY2FuIGJlIGZvdW5kIGluIHNpZGViYXIubGVzcyAtLT5cXG4gIDwhLS0gU2lkZWJhciB0b2dnbGUgYnV0dG9uLS0+XFxuICA8IS0tIFRvZ2dsZSBidXR0b24gb24gdGhlIGxlZnQgc2lkZSBvZiBtYWluIHNpZGViYXIgb25seSBpZiBub3QgbW9iaWxlIC0tPlxcbiAgPGEgdi1pZj1cXFwiIWlzTW9iaWxlKClcXFwiIGhyZWY9XFxcIiNcXFwiIGNsYXNzPVxcXCJzaWRlYmFyLWFzaWRlLXRvZ2dsZVxcXCIgZGF0YS10b2dnbGU9XFxcIm9mZmNhbnZhc1xcXCIgcm9sZT1cXFwiYnV0dG9uXFxcIj5cXG4gICAgPHNwYW4gY2xhc3M9XFxcInNyLW9ubHlcXFwiPkV4cGFuZDwvc3Bhbj5cXG4gIDwvYT5cXG5cXHQ8c2VjdGlvbiBjbGFzcz1cXFwic2lkZWJhclxcXCI+XFxuICAgIDxkaXYgdi1zaG93PVxcXCJwYW5lbHNpbnN0YWNrXFxcIiBjbGFzcz1cXFwiZzN3LXNpZGViYXJwYW5lbFxcXCI+XFxuICAgICAgPGRpdiBjbGFzcz1cXFwicm93XFxcIj5cXG4gICAgICAgIDxkaXYgY2xhc3M9XFxcImNvbC14cy0xMiBjb2wtc20tMTIgY29sLW1kLTEyXFxcIj5cXG4gICAgICAgICAgPGJ1dHRvbiBjbGFzcz1cXFwiZ2x5cGhpY29uIGdseXBoaWNvbi1yZW1vdmUgcHVsbC1yaWdodCBjbG9zZS1wYW5lbC1idXR0b25cXFwiIEBjbGljaz1cXFwiY2xvc2VQYW5lbFxcXCI+PC9idXR0b24+PC9kaXY+XFxuICAgICAgPC9kaXY+XFxuICAgICAgPGRpdj5cXG4gICAgICAgIDxoND57eyBwYW5lbG5hbWUgfX08L2gyPlxcbiAgICAgIDwvZGl2PlxcbiAgICAgIDxkaXYgaWQ9XFxcImczdy1zaWRlYmFycGFuZWwtcGxhY2Vob2xkZXJcXFwiIGNsYXNzPVxcXCJnM3ctc2lkZWJhcnBhbmVsLXBsYWNlaG9sZGVyXFxcIj48L2Rpdj5cXG4gICAgPC9kaXY+XFxuXFx0ICA8dWwgaWQ9XFxcImczdy1zaWRlYmFyY29tcG9uZW50c1xcXCIgdi1zaG93PVxcXCJjb21wb25lbnRzaW5zdGFja1xcXCIgY2xhc3M9XFxcInNpZGViYXItbWVudVxcXCI+XFxuXFx0ICAgIDwhLS08c2lkZWJhci1pdGVtIGRhdGEtaWNvbj1cXFwiZmEgZmEtc2VhcmNoXFxcIiBkYXRhLWxhYmVsPVxcXCJzZWFyY2hcXFwiIGRhdGEtdHlwZT1cXFwiaW5saW5lXFxcIj5cXG4gICAgICAgIDxnM3ctc2VhcmNoPjwvZzN3LXNlYXJjaD5cXG4gICAgICA8L3NpZGViYXItaXRlbT5cXG4gICAgICA8c2lkZWJhci1pdGVtIG9wZW4tb24tc3RhcnQ9XFxcInRydWVcXFwiIGRhdGEtaWNvbj1cXFwiZmEgZmEtZGF0YWJhc2VcXFwiIGRhdGEtbGFiZWw9XFxcImNhdGFsb2dcXFwiIGRhdGEtdHlwZT1cXFwiaW5saW5lXFxcIj5cXG4gICAgICAgIDxnM3ctY2F0YWxvZz48L2czdy1jYXRhbG9nPlxcbiAgICAgIDwvc2lkZWJhci1pdGVtPlxcbiAgICAgIDxzaWRlYmFyLWl0ZW0gZGF0YS1pY29uPVxcXCJmYSBmYS1nZWFyc1xcXCIgZGF0YS1sYWJlbD1cXFwidG9vbHNcXFwiIGRhdGEtdHlwZT1cXFwiaW5saW5lXFxcIj5cXG4gICAgICAgIDxnM3ctdG9vbHM+PC9nM3ctdG9vbHM+XFxuICAgICAgPC9zaWRlYmFyLWl0ZW0+LS0+XFxuXFx0ICA8L3VsPlxcblxcdDwvc2VjdGlvbj5cXG5cXHQ8IS0tIC8uc2lkZWJhciAtLT5cXG48L2FzaWRlPlxcblwiO1xuIiwibW9kdWxlLmV4cG9ydHMgPSBcIjxkaXY+XFxuICA8ZGl2IHYtaWY9XFxcInByaW1hcnlcXFwiPlxcbiAgPC9kaXY+XFxuPC9kaXY+XFxuXFxuXCI7XG4iLCJtb2R1bGUuZXhwb3J0cyA9IFwiPGRpdj5cXG4gIDxkaXYgaWQ9XFxcImczdy1tYXAtdmlld1xcXCI+PC9kaXY+XFxuICA8ZGl2IGlkPVxcXCJnM3ctY29udGVueC12aWV3XFxcIj48L2Rpdj5cXG48L2Rpdj5cXG5cIjtcbiIsInZhciBsYXlvdXQgPSByZXF1aXJlKCcuL2xheW91dCcpO1xudmFyIEFwcFVJID0gVnVlLmV4dGVuZCh7XG4gIHRlbXBsYXRlOiByZXF1aXJlKCcuLi9odG1sL2FwcC5odG1sJyksXG4gIHJlYWR5OiBmdW5jdGlvbigpe1xuICAgIC8qIHN0YXJ0IHRvIHJlbmRlciBMYXlvdXRNYW5hZ2VyIGxheW91dCAqL1xuICAgIGxheW91dC5sb2FkaW5nKGZhbHNlKTtcbiAgICBsYXlvdXQuc2V0dXAoKTtcbiAgICAkKFwiYm9keVwiKS50b2dnbGVDbGFzcyhcImZpeGVkXCIpO1xuICAgIGxheW91dC5sYXlvdXQuZml4U2lkZWJhcigpO1xuICAgIC8vRml4IHRoZSBwcm9ibGVtIHdpdGggcmlnaHQgc2lkZWJhciBhbmQgbGF5b3V0IGJveGVkXG4gICAgbGF5b3V0LnB1c2hNZW51LmV4cGFuZE9uSG92ZXIoKTtcbiAgICBsYXlvdXQubGF5b3V0LmFjdGl2YXRlKCk7XG4gICAgbGF5b3V0LmNvbnRyb2xTaWRlYmFyLl9maXgoJChcIi5jb250cm9sLXNpZGViYXItYmdcIikpO1xuICAgIGxheW91dC5jb250cm9sU2lkZWJhci5fZml4KCQoXCIuY29udHJvbC1zaWRlYmFyXCIpKTtcbiAgICB2YXIgY29udHJvbHNpZGViYXJFbCA9IGxheW91dC5vcHRpb25zLmNvbnRyb2xTaWRlYmFyT3B0aW9ucy5zZWxlY3RvcjtcbiAgICBmdW5jdGlvbiBzZXRGbG9hdEJhck1heEhlaWdodCgpe1xuICAgICAgJChjb250cm9sc2lkZWJhckVsKS5jc3MoJ21heC1oZWlnaHQnLCQod2luZG93KS5pbm5lckhlaWdodCgpKTtcbiAgICAgICQoJy5nM3ctc2lkZWJhcnBhbmVsJykuaGVpZ2h0KCQod2luZG93KS5pbm5lckhlaWdodCgpLSQoJy5tYWluLWhlYWRlcicpLmlubmVySGVpZ2h0KCkpO1xuICAgIH1cbiAgICBzZXRGbG9hdEJhck1heEhlaWdodCgpO1xuICAgIGZ1bmN0aW9uIHNldE1vZGFsSGVpZ2h0KCl7XG4gICAgICAkKCcjZzN3LW1vZGFsLW92ZXJsYXknKS5oZWlnaHQoJCh3aW5kb3cpLmlubmVySGVpZ2h0KCkpO1xuICAgIH1cbiAgICAkKHdpbmRvdykucmVzaXplKGZ1bmN0aW9uKCkge1xuICAgICAgc2V0RmxvYXRCYXJNYXhIZWlnaHQoKTtcbiAgICAgIHNldE1vZGFsSGVpZ2h0KCk7XG4gICAgfSk7XG4gICB9LFxuICAgbWV0aG9kczoge1xuICAgICAgY2xvc2VQYW5lbDogZnVuY3Rpb24oKXtcbiAgICAgICAgc2lkZWJhclNlcnZpY2UuY2xvc2VQYW5lbCgpO1xuICAgICAgfSxcbiAgICAgIGlzTW9iaWxlOiBmdW5jdGlvbigpe3JldHVybiBpc01vYmlsZS5hbnl9XG4gICAgfSxcbn0pO1xuXG5tb2R1bGUuZXhwb3J0cyA9IEFwcFVJO1xuIiwidmFyIGluaGVyaXQgPSByZXF1aXJlKCdzZGsvY29yZS91dGlscy91dGlscycpLmluaGVyaXQ7XG52YXIgRzNXT2JqZWN0ID0gcmVxdWlyZSgnc2RrL2NvcmUvZzN3b2JqZWN0Jyk7XG5cbmZ1bmN0aW9uIEJhclN0YWNrKCl7XG4gIHRoaXMuX3BhbmVscyA9IFtdO1xuICB0aGlzLnN0YXRlID0ge1xuICAgIHBhbmVsczogW11cbiAgfTtcbn1cbmluaGVyaXQoQmFyU3RhY2ssRzNXT2JqZWN0KTtcblxudmFyIHByb3RvID0gQmFyU3RhY2sucHJvdG90eXBlO1xuXG5wcm90by5wdXNoID0gZnVuY3Rpb24ocGFuZWwsIHBhcmVudCl7XG4gIHZhciBzZWxmID0gdGhpcztcbiAgdmFyIGlkID0gcGFuZWwuZ2V0SWQoKTtcbiAgXy5mb3JFYWNoKHNlbGYuc3RhdGUucGFuZWxzLCBmdW5jdGlvbihwYW5lbCkge1xuICAgIGlmIChwYW5lbC5pZCA9PSBpZCkge1xuICAgICAgY29uc29sZS5sb2coJ2VzaXN0ZSBnJylcbiAgICAgIHNlbGYuX3BhbmVsc1twYW5lbC5wb3NpdGlvbl0udW5tb3VudCgpO1xuICAgICAgc2VsZi5fcGFuZWxzW3BhbmVsLnBvc2l0aW9uXSA9IHBhbmVsO1xuICAgIH07XG4gIH0pO1xuICBwYW5lbC5tb3VudChwYXJlbnQpXG4gIC50aGVuKGZ1bmN0aW9uKCl7XG4gICAgdmFyIHBvc2l0aW9uID0gc2VsZi5fcGFuZWxzLnB1c2gocGFuZWwpIC0gMTtcbiAgICBzZWxmLnN0YXRlLnBhbmVscy5wdXNoKHtcbiAgICAgICAgaWQ6IHBhbmVsLmdldElkKCksXG4gICAgICAgIHRpdGxlOiBwYW5lbC5nZXRUaXRsZSgpLFxuICAgICAgICBwb3NpdGlvbjogcG9zaXRpb25cbiAgICB9KTtcbiAgfSk7XG59O1xuXG5wcm90by5wb3AgPSBmdW5jdGlvbigpe1xuICAvLyBxdWkgcG90cmVtbyBjaGllZGVyZSBhbCBwYW5uZWxsbyBzZSBwdcOyIGVzc2VyZSBjaGl1c28uLi5cbiAgdmFyIHNlbGYgPSB0aGlzO1xuICB2YXIgcGFuZWwgPSB0aGlzLl9wYW5lbHMuc2xpY2UoLTEpWzBdO1xuICBwYW5lbC51bm1vdW50KClcbiAgLnRoZW4oZnVuY3Rpb24oKXtcbiAgICBzZWxmLnN0YXRlLnBhbmVscy5wb3AoKTtcbiAgICBzZWxmLl9wYW5lbHMucG9wKCk7XG4gIH0pO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBCYXJTdGFjaztcbiIsInZhciB0ID0gcmVxdWlyZSgnc2RrL2NvcmUvaTE4bi9pMThuLnNlcnZpY2UnKS50O1xudmFyIFN0YWNrID0gcmVxdWlyZSgnLi9iYXJzdGFjay5qcycpO1xudmFyIEdVSSA9IHJlcXVpcmUoJ3Nkay9ndWkvZ3VpJyk7XG5cbmZ1bmN0aW9uIEZsb2F0YmFyU2VydmljZSgpe1xuICB0aGlzLnN0YWNrID0gbmV3IFN0YWNrKCk7XG4gIFxuICB0aGlzLmluaXQgPSBmdW5jdGlvbihsYXlvdXQpe1xuICAgIHRoaXMubGF5b3V0ID0gbGF5b3V0O1xuICAgIHRoaXMuY2xvc2FibGUgPSB0cnVlO1xuICAgIHRoaXMuc2lkZWJhckVsID0gJCh0aGlzLmxheW91dC5vcHRpb25zLmNvbnRyb2xTaWRlYmFyT3B0aW9ucy5zZWxlY3Rvcik7XG4gICAgdGhpcy5femluZGV4ID0gdGhpcy5zaWRlYmFyRWwuY3NzKFwiei1pbmRleFwiKTtcbiAgICB0aGlzLl9tb2RhbE92ZXJsYXkgPSBudWxsO1xuICAgIHRoaXMuX21vZGFsID0gZmFsc2U7XG4gIH07XG4gIFxuICB0aGlzLnNob3dQYW5lbCA9IGZ1bmN0aW9uKHBhbmVsLG9wdGlvbnMpe1xuICAgIHZhciBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcbiAgICB2YXIgbW9kYWwgPSBvcHRpb25zLm1vZGFsIHx8IGZhbHNlO1xuICAgIHRoaXMuY2xvc2FibGUgPSBvcHRpb25zLmNsb3NhYmxlIHx8IHRydWU7XG4gICAgdGhpcy5zdGFjay5wdXNoKHBhbmVsLFwiI2czdy1mbG9hdGJhcnBhbmVsLXBsYWNlaG9sZGVyXCIpO1xuICAgIHRoaXMubGF5b3V0LmZsb2F0QmFyLm9wZW4odGhpcy5zaWRlYmFyRWwsdHJ1ZSk7XG4gICAgaWYgKG1vZGFsKXtcbiAgICAgIHRoaXMuX21vZGFsID0gdHJ1ZTtcbiAgICAgIEdVSS5zZXRNb2RhbCgpO1xuICAgICAgdGhpcy5zaWRlYmFyRWwuY3NzKFwiei1pbmRleFwiLDUwMDApO1xuICAgICAgdGhpcy5zaWRlYmFyRWwuY3NzKFwicGFkZGluZy10b3BcIixcIjBweFwiKTtcbiAgICAgICQoJy5jb250cm9sLXNpZGViYXItYmcnKS5jc3MoXCJ6LWluZGV4XCIsNDk5OSk7XG4gICAgICAkKCcuY29udHJvbC1zaWRlYmFyLWJnJykudG9nZ2xlQ2xhc3MoJ2NvbnRyb2wtc2lkZWJhci1iZy1zaGFkb3cnKTtcbiAgICB9XG4gICAgXG4gIH07XG4gIFxuICB0aGlzLmNsb3NlUGFuZWwgPSBmdW5jdGlvbigpe1xuICAgIHZhciBwYW5lbCA9IHRoaXMuc3RhY2sucG9wKCk7XG4gICAgaWYgKHBhbmVsKXtcbiAgICAgIGlmIChfLmhhc0luKHBhbmVsLFwiJGRlc3Ryb3lcIikpe1xuICAgICAgICBwYW5lbC4kZGVzdHJveSgpO1xuICAgICAgfVxuICAgIH07XG4gICAgaWYgKCF0aGlzLnN0YWNrLmxlbmd0aCkge1xuICAgICAgaWYgKHRoaXMuX21vZGFsKXtcbiAgICAgICAgR1VJLnNldE1vZGFsKGZhbHNlKTtcbiAgICAgICAgdGhpcy5sYXlvdXQuZmxvYXRCYXIuY2xvc2UodGhpcy5zaWRlYmFyRWwsdHJ1ZSk7XG4gICAgICAgICQoJy5jb250cm9sLXNpZGViYXItYmcnKS50b2dnbGVDbGFzcygnY29udHJvbC1zaWRlYmFyLWJnLXNoYWRvdycpO1xuICAgICAgICB0aGlzLnNpZGViYXJFbC5jc3MoXCJ6LWluZGV4XCIsXCJcIik7XG4gICAgICAgIHRoaXMuc2lkZWJhckVsLmNzcyhcInBhZGRpbmctdG9wXCIsXCI1MHB4XCIpO1xuICAgICAgICAkKCcuY29udHJvbC1zaWRlYmFyLWJnJykuY3NzKFwiei1pbmRleFwiLFwiXCIpO1xuICAgICAgICB0aGlzLl9tb2RhbCA9IGZhbHNlO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIHRoaXMubGF5b3V0LmZsb2F0QmFyLmNsb3NlKHRoaXMuc2lkZWJhckVsLHRydWUpO1xuICAgICAgfVxuICAgIH1cbiAgfTtcbiAgXG4gIHRoaXMuaGlkZVBhbmVsID0gZnVuY3Rpb24oKXtcbiAgICB0aGlzLmxheW91dC5mbG9hdEJhci5jbG9zZSh0aGlzLnNpZGViYXJFbCx0cnVlKTtcbiAgfTtcbn1cblxudmFyIGZsb2F0YmFyU2VydmljZSA9IG5ldyBGbG9hdGJhclNlcnZpY2UoKTtcblxudmFyIEZsb2F0YmFyQ29tcG9uZW50ID0gVnVlLmV4dGVuZCh7XG4gICAgdGVtcGxhdGU6IHJlcXVpcmUoJy4uL2h0bWwvZmxvYXRiYXIuaHRtbCcpLFxuICAgIGRhdGE6IGZ1bmN0aW9uKCkge1xuICAgIFx0cmV0dXJuIHtcbiAgICAgICAgc3RhY2s6IGZsb2F0YmFyU2VydmljZS5zdGFjay5zdGF0ZSxcbiAgICAgIH07XG4gICAgfSxcbiAgICBjb21wdXRlZDoge1xuICAgICAgLy8gcXVhbnRpIHBhbm5lbGxpIHNvbm8gYXR0aXZpIG5lbGxvIHN0YWNrXG4gICAgICBwYW5lbHNpbnN0YWNrOiBmdW5jdGlvbigpe1xuICAgICAgICByZXR1cm4gdGhpcy5zdGFjay5wYW5lbHMubGVuZ3RoPjA7XG4gICAgICB9LFxuICAgICAgcGFuZWxuYW1lOiBmdW5jdGlvbigpe1xuICAgICAgICB2YXIgbmFtZSA9IFwiXCI7XG4gICAgICAgIGlmICh0aGlzLnN0YWNrLnBhbmVscy5sZW5ndGgpe1xuICAgICAgICAgIG5hbWUgPSB0aGlzLnN0YWNrLnBhbmVscy5zbGljZSgtMSlbMF0ubmFtZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbmFtZTtcbiAgICAgIH0sXG4gICAgICBjbG9zYWJsZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiBmbG9hdGJhclNlcnZpY2UuY2xvc2FibGU7XG4gICAgICB9XG4gICAgfSxcbiAgICB3YXRjaDoge1xuICAgICAgLy8gVE9ETzogQnJ1dHRvLCBtYSDDqCBsJ3VuaWNvIChwZXIgb3JhKSBtb2RvIGZsZXNzaWJpbGUgY2hlIGhvIHRyb3ZhdG8gcGVyIGltcGxlbWVudGFyZSBpbCBjb25jZXR0byBkaSBzdGFjay4uLiBcbiAgICAgIFwic3RhY2sucGFuZWxzXCI6IGZ1bmN0aW9uKCl7XG4gICAgICAgIHZhciBjaGlsZHJlbiA9ICQoXCIjZzN3LWZsb2F0YmFycGFuZWwtcGxhY2Vob2xkZXJcIikuY2hpbGRyZW4oKTtcbiAgICAgICAgXy5mb3JFYWNoKGNoaWxkcmVuLGZ1bmN0aW9uKGNoaWxkLGluZGV4KXtcbiAgICAgICAgICBpZiAoaW5kZXggPT0gY2hpbGRyZW4ubGVuZ3RoLTEpe1xuICAgICAgICAgICAgJChjaGlsZCkuc2hvdygpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICQoY2hpbGQpLmhpZGUoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgICB9XG4gICAgfSxcbiAgICBtZXRob2RzOiB7XG4gICAgICBjbG9zZVBhbmVsOiBmdW5jdGlvbigpe1xuICAgICAgICBmbG9hdGJhclNlcnZpY2UuY2xvc2VQYW5lbCgpO1xuICAgICAgfVxuICAgIH1cbn0pO1xuXG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgRmxvYXRiYXJTZXJ2aWNlOiBmbG9hdGJhclNlcnZpY2UsXG4gIEZsb2F0YmFyQ29tcG9uZW50OiBGbG9hdGJhckNvbXBvbmVudFxufVxuIiwiLy9NYWtlIHN1cmUgalF1ZXJ5IGhhcyBiZWVuIGxvYWRlZCBiZWZvcmUgYXBwLmpzXG5pZiAodHlwZW9mIGpRdWVyeSA9PT0gXCJ1bmRlZmluZWRcIikge1xuICB0aHJvdyBuZXcgRXJyb3IoXCJMYXlvdXRNYW5hZ2VyIHJlcXVpcmVzIGpRdWVyeVwiKTtcbn1cblxuJC5MYXlvdXRNYW5hZ2VyID0ge307XG5cbi8qIC0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gKiAtIExheW91dE1hbmFnZXIgT3B0aW9ucyAtXG4gKiAtLS0tLS0tLS0tLS0tLS0tLS0tLVxuICogTW9kaWZ5IHRoZXNlIG9wdGlvbnMgdG8gc3VpdCB5b3VyIGltcGxlbWVudGF0aW9uXG4gKi9cbiQuTGF5b3V0TWFuYWdlci5vcHRpb25zID0ge1xuICAvL0FkZCBzbGltc2Nyb2xsIHRvIG5hdmJhciBtZW51c1xuICAvL1RoaXMgcmVxdWlyZXMgeW91IHRvIGxvYWQgdGhlIHNsaW1zY3JvbGwgcGx1Z2luXG4gIC8vaW4gZXZlcnkgcGFnZSBiZWZvcmUgYXBwLmpzXG4gIG5hdmJhck1lbnVTbGltc2Nyb2xsOiB0cnVlLFxuICBuYXZiYXJNZW51U2xpbXNjcm9sbFdpZHRoOiBcIjBweFwiLCAvL1RoZSB3aWR0aCBvZiB0aGUgc2Nyb2xsIGJhclxuICBuYXZiYXJNZW51SGVpZ2h0OiBcIjIwMHB4XCIsIC8vVGhlIGhlaWdodCBvZiB0aGUgaW5uZXIgbWVudVxuICAvL0dlbmVyYWwgYW5pbWF0aW9uIHNwZWVkIGZvciBKUyBhbmltYXRlZCBlbGVtZW50cyBzdWNoIGFzIGJveCBjb2xsYXBzZS9leHBhbmQgYW5kXG4gIC8vc2lkZWJhciB0cmVldmlldyBzbGlkZSB1cC9kb3duLiBUaGlzIG9wdGlvbnMgYWNjZXB0cyBhbiBpbnRlZ2VyIGFzIG1pbGxpc2Vjb25kcyxcbiAgLy8nZmFzdCcsICdub3JtYWwnLCBvciAnc2xvdydcbiAgYW5pbWF0aW9uU3BlZWQ6J2Zhc3QnLFxuICAvL1NpZGViYXIgcHVzaCBtZW51IHRvZ2dsZSBidXR0b24gc2VsZWN0b3JcbiAgc2lkZWJhclRvZ2dsZVNlbGVjdG9yOiBcIltkYXRhLXRvZ2dsZT0nb2ZmY2FudmFzJ11cIixcbiAgLy9BY3RpdmF0ZSBzaWRlYmFyIHB1c2ggbWVudVxuICBzaWRlYmFyUHVzaE1lbnU6IHRydWUsXG4gIC8vQWN0aXZhdGUgc2lkZWJhciBzbGltc2Nyb2xsIGlmIHRoZSBmaXhlZCBsYXlvdXQgaXMgc2V0IChyZXF1aXJlcyBTbGltU2Nyb2xsIFBsdWdpbilcbiAgc2lkZWJhclNsaW1TY3JvbGw6IGZhbHNlLFxuICAvL0VuYWJsZSBzaWRlYmFyIGV4cGFuZCBvbiBob3ZlciBlZmZlY3QgZm9yIHNpZGViYXIgbWluaVxuICAvL1RoaXMgb3B0aW9uIGlzIGZvcmNlZCB0byB0cnVlIGlmIGJvdGggdGhlIGZpeGVkIGxheW91dCBhbmQgc2lkZWJhciBtaW5pXG4gIC8vYXJlIHVzZWQgdG9nZXRoZXJcbiAgc2lkZWJhckV4cGFuZE9uSG92ZXI6IGZhbHNlLFxuICAvL0JveFJlZnJlc2ggUGx1Z2luXG4gIGVuYWJsZUJveFJlZnJlc2g6IHRydWUsXG4gIC8vQm9vdHN0cmFwLmpzIHRvb2x0aXBcbiAgZW5hYmxlQlNUb3BwbHRpcDogdHJ1ZSxcbiAgQlNUb29sdGlwU2VsZWN0b3I6IFwiW2RhdGEtdG9nZ2xlPSd0b29sdGlwJ11cIixcbiAgLy9FbmFibGUgRmFzdCBDbGljay4gRmFzdGNsaWNrLmpzIGNyZWF0ZXMgYSBtb3JlXG4gIC8vbmF0aXZlIHRvdWNoIGV4cGVyaWVuY2Ugd2l0aCB0b3VjaCBkZXZpY2VzLiBJZiB5b3VcbiAgLy9jaG9vc2UgdG8gZW5hYmxlIHRoZSBwbHVnaW4sIG1ha2Ugc3VyZSB5b3UgbG9hZCB0aGUgc2NyaXB0XG4gIC8vYmVmb3JlIExheW91dE1hbmFnZXIncyBhcHAuanNcbiAgZW5hYmxlRmFzdGNsaWNrOiB0cnVlLFxuICAvL0NvbnRyb2wgU2lkZWJhciBPcHRpb25zXG4gIGVuYWJsZUNvbnRyb2xTaWRlYmFyOiB0cnVlLFxuICBjb250cm9sU2lkZWJhck9wdGlvbnM6IHtcbiAgICAvL1doaWNoIGJ1dHRvbiBzaG91bGQgdHJpZ2dlciB0aGUgb3Blbi9jbG9zZSBldmVudFxuICAgIHRvZ2dsZUJ0blNlbGVjdG9yOiBcIltkYXRhLXRvZ2dsZT0nY29udHJvbC1zaWRlYmFyJ11cIixcbiAgICAvL1RoZSBzaWRlYmFyIHNlbGVjdG9yXG4gICAgc2VsZWN0b3I6IFwiLmNvbnRyb2wtc2lkZWJhclwiLFxuICAgIC8vRW5hYmxlIHNsaWRlIG92ZXIgY29udGVudFxuICAgIHNsaWRlOiB0cnVlXG4gIH0sXG4gIC8vQm94IFdpZGdldCBQbHVnaW4uIEVuYWJsZSB0aGlzIHBsdWdpblxuICAvL3RvIGFsbG93IGJveGVzIHRvIGJlIGNvbGxhcHNlZCBhbmQvb3IgcmVtb3ZlZFxuICBlbmFibGVCb3hXaWRnZXQ6IHRydWUsXG4gIC8vQm94IFdpZGdldCBwbHVnaW4gb3B0aW9uc1xuICBib3hXaWRnZXRPcHRpb25zOiB7XG4gICAgYm94V2lkZ2V0SWNvbnM6IHtcbiAgICAgIC8vQ29sbGFwc2UgaWNvblxuICAgICAgY29sbGFwc2U6ICdmYS1taW51cycsXG4gICAgICAvL09wZW4gaWNvblxuICAgICAgb3BlbjogJ2ZhLXBsdXMnLFxuICAgICAgLy9SZW1vdmUgaWNvblxuICAgICAgcmVtb3ZlOiAnZmEtdGltZXMnXG4gICAgfSxcbiAgICBib3hXaWRnZXRTZWxlY3RvcnM6IHtcbiAgICAgIC8vUmVtb3ZlIGJ1dHRvbiBzZWxlY3RvclxuICAgICAgcmVtb3ZlOiAnW2RhdGEtd2lkZ2V0PVwicmVtb3ZlXCJdJyxcbiAgICAgIC8vQ29sbGFwc2UgYnV0dG9uIHNlbGVjdG9yXG4gICAgICBjb2xsYXBzZTogJ1tkYXRhLXdpZGdldD1cImNvbGxhcHNlXCJdJ1xuICAgIH1cbiAgfSxcbiAgLy9EaXJlY3QgQ2hhdCBwbHVnaW4gb3B0aW9uc1xuICBkaXJlY3RDaGF0OiB7XG4gICAgLy9FbmFibGUgZGlyZWN0IGNoYXQgYnkgZGVmYXVsdFxuICAgIGVuYWJsZTogdHJ1ZSxcbiAgICAvL1RoZSBidXR0b24gdG8gb3BlbiBhbmQgY2xvc2UgdGhlIGNoYXQgY29udGFjdHMgcGFuZVxuICAgIGNvbnRhY3RUb2dnbGVTZWxlY3RvcjogJ1tkYXRhLXdpZGdldD1cImNoYXQtcGFuZS10b2dnbGVcIl0nXG4gIH0sXG4gIC8vRGVmaW5lIHRoZSBzZXQgb2YgY29sb3JzIHRvIHVzZSBnbG9iYWxseSBhcm91bmQgdGhlIHdlYnNpdGVcbiAgY29sb3JzOiB7XG4gICAgbGlnaHRCbHVlOiBcIiMzYzhkYmNcIixcbiAgICByZWQ6IFwiI2Y1Njk1NFwiLFxuICAgIGdyZWVuOiBcIiMwMGE2NWFcIixcbiAgICBhcXVhOiBcIiMwMGMwZWZcIixcbiAgICB5ZWxsb3c6IFwiI2YzOWMxMlwiLFxuICAgIGJsdWU6IFwiIzAwNzNiN1wiLFxuICAgIG5hdnk6IFwiIzAwMUYzRlwiLFxuICAgIHRlYWw6IFwiIzM5Q0NDQ1wiLFxuICAgIG9saXZlOiBcIiMzRDk5NzBcIixcbiAgICBsaW1lOiBcIiMwMUZGNzBcIixcbiAgICBvcmFuZ2U6IFwiI0ZGODUxQlwiLFxuICAgIGZ1Y2hzaWE6IFwiI0YwMTJCRVwiLFxuICAgIHB1cnBsZTogXCIjOEUyNEFBXCIsXG4gICAgbWFyb29uOiBcIiNEODFCNjBcIixcbiAgICBibGFjazogXCIjMjIyMjIyXCIsXG4gICAgZ3JheTogXCIjZDJkNmRlXCJcbiAgfSxcbiAgLy9UaGUgc3RhbmRhcmQgc2NyZWVuIHNpemVzIHRoYXQgYm9vdHN0cmFwIHVzZXMuXG4gIC8vSWYgeW91IGNoYW5nZSB0aGVzZSBpbiB0aGUgdmFyaWFibGVzLmxlc3MgZmlsZSwgY2hhbmdlXG4gIC8vdGhlbSBoZXJlIHRvby5cbiAgc2NyZWVuU2l6ZXM6IHtcbiAgICB4czogNDgwLFxuICAgIHNtOiA3NjgsXG4gICAgbWQ6IDk5MixcbiAgICBsZzogMTIwMFxuICB9XG59O1xuXG5cbi8qIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAqIC0gSW5pdGlhbGl6ZSB0aGUgTGF5b3V0TWFuYWdlciBPYmplY3QgLVxuICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICogQWxsIExheW91dE1hbmFnZXIgZnVuY3Rpb25zIGFyZSBpbXBsZW1lbnRlZCBiZWxvdy5cbiAqL1xuJC5MYXlvdXRNYW5hZ2VyLl9pbml0ID0gZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgLyogTGF5b3V0XG4gICAqID09PT09PVxuICAgKiBGaXhlcyB0aGUgbGF5b3V0IGhlaWdodCBpbiBjYXNlIG1pbi1oZWlnaHQgZmFpbHMuXG4gICAqXG4gICAqIEB0eXBlIE9iamVjdFxuICAgKiBAdXNhZ2UgJC5MYXlvdXRNYW5hZ2VyLmxheW91dC5hY3RpdmF0ZSgpXG4gICAqICAgICAgICAkLkxheW91dE1hbmFnZXIubGF5b3V0LmZpeCgpXG4gICAqICAgICAgICAkLkxheW91dE1hbmFnZXIubGF5b3V0LmZpeFNpZGViYXIoKVxuICAgKi9cbiAgJC5MYXlvdXRNYW5hZ2VyLmxheW91dCA9IHtcbiAgICBhY3RpdmF0ZTogZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgIF90aGlzLmZpeCgpO1xuICAgICAgX3RoaXMuZml4U2lkZWJhcigpO1xuICAgICAgJCh3aW5kb3csIFwiLndyYXBwZXJcIikucmVzaXplKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgX3RoaXMuZml4KCk7XG4gICAgICAgIF90aGlzLmZpeFNpZGViYXIoKTtcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgZml4OiBmdW5jdGlvbiAoKSB7XG4gICAgICAvL0dldCB3aW5kb3cgaGVpZ2h0IGFuZCB0aGUgd3JhcHBlciBoZWlnaHRcbiAgICAgIHZhciBuZWcgPSAkKCcubWFpbi1oZWFkZXInKS5vdXRlckhlaWdodCgpICsgJCgnLm1haW4tZm9vdGVyJykub3V0ZXJIZWlnaHQoKTtcbiAgICAgIHZhciB3aW5kb3dfaGVpZ2h0ID0gJCh3aW5kb3cpLmhlaWdodCgpO1xuICAgICAgdmFyIHNpZGViYXJfaGVpZ2h0ID0gJChcIi5zaWRlYmFyXCIpLmhlaWdodCgpO1xuICAgICAgLy9TZXQgdGhlIG1pbi1oZWlnaHQgb2YgdGhlIGNvbnRlbnQgYW5kIHNpZGViYXIgYmFzZWQgb24gdGhlXG4gICAgICAvL3RoZSBoZWlnaHQgb2YgdGhlIGRvY3VtZW50LlxuICAgICAgaWYgKCQoXCJib2R5XCIpLmhhc0NsYXNzKFwiZml4ZWRcIikpIHtcbiAgICAgICAgJChcIi5jb250ZW50LXdyYXBwZXIsIC5yaWdodC1zaWRlXCIpLmNzcygnbWluLWhlaWdodCcsIHdpbmRvd19oZWlnaHQgLSAkKCcubWFpbi1mb290ZXInKS5vdXRlckhlaWdodCgpKTtcbiAgICAgICAgJChcIi5jb250ZW50LXdyYXBwZXIsIC5yaWdodC1zaWRlXCIpLmNzcygnaGVpZ2h0Jywgd2luZG93X2hlaWdodCAtICQoJy5tYWluLWZvb3RlcicpLm91dGVySGVpZ2h0KCkpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFyIHBvc3RTZXRXaWR0aDtcbiAgICAgICAgaWYgKHdpbmRvd19oZWlnaHQgPj0gc2lkZWJhcl9oZWlnaHQpIHtcbiAgICAgICAgICAkKFwiLmNvbnRlbnQtd3JhcHBlciwgLnJpZ2h0LXNpZGVcIikuY3NzKCdtaW4taGVpZ2h0Jywgd2luZG93X2hlaWdodCAtIG5lZyk7XG4gICAgICAgICAgcG9zdFNldFdpZHRoID0gd2luZG93X2hlaWdodCAtIG5lZztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAkKFwiLmNvbnRlbnQtd3JhcHBlciwgLnJpZ2h0LXNpZGVcIikuY3NzKCdtaW4taGVpZ2h0Jywgc2lkZWJhcl9oZWlnaHQpO1xuICAgICAgICAgIHBvc3RTZXRXaWR0aCA9IHNpZGViYXJfaGVpZ2h0O1xuICAgICAgICB9XG4gICAgICAgIC8vRml4IGZvciB0aGUgY29udHJvbCBzaWRlYmFyIGhlaWdodFxuICAgICAgICB2YXIgY29udHJvbFNpZGViYXIgPSAkKCQuTGF5b3V0TWFuYWdlci5vcHRpb25zLmNvbnRyb2xTaWRlYmFyT3B0aW9ucy5zZWxlY3Rvcik7XG4gICAgICAgIGlmICh0eXBlb2YgY29udHJvbFNpZGViYXIgIT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgICAgICBpZiAoY29udHJvbFNpZGViYXIuaGVpZ2h0KCkgPiBwb3N0U2V0V2lkdGgpXG4gICAgICAgICAgICAkKFwiLmNvbnRlbnQtd3JhcHBlciwgLnJpZ2h0LXNpZGVcIikuY3NzKCdtaW4taGVpZ2h0JywgY29udHJvbFNpZGViYXIuaGVpZ2h0KCkpO1xuICAgICAgICB9XG5cbiAgICAgIH1cbiAgICB9LFxuICAgIGZpeFNpZGViYXI6IGZ1bmN0aW9uICgpIHtcbiAgICAgIC8vTWFrZSBzdXJlIHRoZSBib2R5IHRhZyBoYXMgdGhlIC5maXhlZCBjbGFzc1xuICAgICAgaWYgKCEkKFwiYm9keVwiKS5oYXNDbGFzcyhcImZpeGVkXCIpKSB7XG4gICAgICAgIGlmICh0eXBlb2YgJC5mbi5zbGltU2Nyb2xsICE9ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgJChcIi5zaWRlYmFyXCIpLnNsaW1TY3JvbGwoe2Rlc3Ryb3k6IHRydWV9KS5oZWlnaHQoXCJhdXRvXCIpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybjtcbiAgICAgIH0gZWxzZSBpZiAodHlwZW9mICQuZm4uc2xpbVNjcm9sbCA9PSAndW5kZWZpbmVkJyAmJiB3aW5kb3cuY29uc29sZSkge1xuICAgICAgICB3aW5kb3cuY29uc29sZS5lcnJvcihcIkVycm9yOiB0aGUgZml4ZWQgbGF5b3V0IHJlcXVpcmVzIHRoZSBzbGltc2Nyb2xsIHBsdWdpbiFcIik7XG4gICAgICB9XG4gICAgICAvL0VuYWJsZSBzbGltc2Nyb2xsIGZvciBmaXhlZCBsYXlvdXRcbiAgICAgIGlmICgkLkxheW91dE1hbmFnZXIub3B0aW9ucy5zaWRlYmFyU2xpbVNjcm9sbCkge1xuICAgICAgICBpZiAodHlwZW9mICQuZm4uc2xpbVNjcm9sbCAhPSAndW5kZWZpbmVkJykge1xuICAgICAgICAgIC8vRGVzdHJveSBpZiBpdCBleGlzdHNcbiAgICAgICAgICAkKFwiLnNpZGViYXJcIikuc2xpbVNjcm9sbCh7ZGVzdHJveTogdHJ1ZX0pLmhlaWdodChcImF1dG9cIik7XG4gICAgICAgICAgLy9BZGQgc2xpbXNjcm9sbFxuICAgICAgICAgICQoXCIuc2lkZWJhclwiKS5zbGltc2Nyb2xsKHtcbiAgICAgICAgICAgIGhlaWdodDogKCQod2luZG93KS5oZWlnaHQoKSAtICQoXCIubWFpbi1oZWFkZXJcIikuaGVpZ2h0KCkpICsgXCJweFwiLFxuICAgICAgICAgICAgY29sb3I6IFwicmdiYSgyNTUsMjU1LDI1NSwwLjcpXCIsXG4gICAgICAgICAgICBzaXplOiBcIjNweFwiXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICAgJChcIi5zaWRlYmFyXCIpLmNzcyh7J2hlaWdodCc6ICgkKHdpbmRvdykuaGVpZ2h0KCkgLSAkKFwiLm1haW4taGVhZGVyXCIpLmhlaWdodCgpKSArIFwicHhcIn0pXG4gICAgICB9XG4gICAgfVxuICB9O1xuXG4gIC8qIFB1c2hNZW51KClcbiAgICogPT09PT09PT09PVxuICAgKiBBZGRzIHRoZSBwdXNoIG1lbnUgZnVuY3Rpb25hbGl0eSB0byB0aGUgc2lkZWJhci5cbiAgICpcbiAgICogQHR5cGUgRnVuY3Rpb25cbiAgICogQHVzYWdlOiAkLkxheW91dE1hbmFnZXIucHVzaE1lbnUoXCJbZGF0YS10b2dnbGU9J29mZmNhbnZhcyddXCIpXG4gICAqL1xuICAkLkxheW91dE1hbmFnZXIucHVzaE1lbnUgPSB7XG4gICAgYWN0aXZhdGU6IGZ1bmN0aW9uICh0b2dnbGVCdG4pIHtcbiAgICAgIC8vR2V0IHRoZSBzY3JlZW4gc2l6ZXNcbiAgICAgIHZhciBzY3JlZW5TaXplcyA9ICQuTGF5b3V0TWFuYWdlci5vcHRpb25zLnNjcmVlblNpemVzO1xuXG4gICAgICAvL0VuYWJsZSBzaWRlYmFyIHRvZ2dsZVxuICAgICAgJCh0b2dnbGVCdG4pLm9uKCdjbGljaycsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgICAvL0VuYWJsZSBzaWRlYmFyIHB1c2ggbWVudVxuICAgICAgICBpZiAoJCh3aW5kb3cpLndpZHRoKCkgPiAoc2NyZWVuU2l6ZXMuc20gLSAxKSkge1xuICAgICAgICAgIGlmICgkKFwiYm9keVwiKS5oYXNDbGFzcygnc2lkZWJhci1jb2xsYXBzZScpKSB7XG4gICAgICAgICAgICAkKFwiYm9keVwiKS5yZW1vdmVDbGFzcygnc2lkZWJhci1jb2xsYXBzZScpLnRyaWdnZXIoJ2V4cGFuZGVkLnB1c2hNZW51Jyk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICQoXCJib2R5XCIpLmFkZENsYXNzKCdzaWRlYmFyLWNvbGxhcHNlJykudHJpZ2dlcignY29sbGFwc2VkLnB1c2hNZW51Jyk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vSGFuZGxlIHNpZGViYXIgcHVzaCBtZW51IGZvciBzbWFsbCBzY3JlZW5zXG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgIGlmICgkKFwiYm9keVwiKS5oYXNDbGFzcygnc2lkZWJhci1vcGVuJykpIHtcbiAgICAgICAgICAgICQoXCJib2R5XCIpLnJlbW92ZUNsYXNzKCdzaWRlYmFyLW9wZW4nKS5yZW1vdmVDbGFzcygnc2lkZWJhci1jb2xsYXBzZScpLnRyaWdnZXIoJ2NvbGxhcHNlZC5wdXNoTWVudScpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAkKFwiYm9keVwiKS5hZGRDbGFzcygnc2lkZWJhci1vcGVuJykudHJpZ2dlcignZXhwYW5kZWQucHVzaE1lbnUnKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICAkKFwiLmNvbnRlbnQtd3JhcHBlclwiKS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgICAgIC8vRW5hYmxlIGhpZGUgbWVudSB3aGVuIGNsaWNraW5nIG9uIHRoZSBjb250ZW50LXdyYXBwZXIgb24gc21hbGwgc2NyZWVuc1xuICAgICAgICBpZiAoJCh3aW5kb3cpLndpZHRoKCkgPD0gKHNjcmVlblNpemVzLnNtIC0gMSkgJiYgJChcImJvZHlcIikuaGFzQ2xhc3MoXCJzaWRlYmFyLW9wZW5cIikpIHtcbiAgICAgICAgICAkKFwiYm9keVwiKS5yZW1vdmVDbGFzcygnc2lkZWJhci1vcGVuJyk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICAvL0VuYWJsZSBleHBhbmQgb24gaG92ZXIgZm9yIHNpZGViYXIgbWluaVxuICAgICAgaWYgKCQuTGF5b3V0TWFuYWdlci5vcHRpb25zLnNpZGViYXJFeHBhbmRPbkhvdmVyIHx8ICgkKCdib2R5JykuaGFzQ2xhc3MoJ2ZpeGVkJykgJiYgJCgnYm9keScpLmhhc0NsYXNzKCdzaWRlYmFyLW1pbmknKSkpIHtcbiAgICAgICAgdGhpcy5leHBhbmRPbkhvdmVyKCk7XG4gICAgICB9XG4gICAgfSxcbiAgICBleHBhbmRPbkhvdmVyOiBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgdmFyIHNjcmVlbldpZHRoID0gJC5MYXlvdXRNYW5hZ2VyLm9wdGlvbnMuc2NyZWVuU2l6ZXMuc20gLSAxO1xuICAgICAgLy9FeHBhbmQgc2lkZWJhciBvbiBob3ZlclxuICAgICAgJCgnLm1haW4tc2lkZWJhcicpLmhvdmVyKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKCQoJ2JvZHknKS5oYXNDbGFzcygnc2lkZWJhci1taW5pJykgJiYgJChcImJvZHlcIikuaGFzQ2xhc3MoJ3NpZGViYXItY29sbGFwc2UnKSAmJiAkKHdpbmRvdykud2lkdGgoKSA+IHNjcmVlbldpZHRoKSB7XG4gICAgICAgICAgX3RoaXMuZXhwYW5kKCk7XG4gICAgICAgIH1cbiAgICAgIH0sIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKCQoJ2JvZHknKS5oYXNDbGFzcygnc2lkZWJhci1taW5pJykgJiYgJCgnYm9keScpLmhhc0NsYXNzKCdzaWRlYmFyLWV4cGFuZGVkLW9uLWhvdmVyJykgJiYgJCh3aW5kb3cpLndpZHRoKCkgPiBzY3JlZW5XaWR0aCkge1xuICAgICAgICAgIF90aGlzLmNvbGxhcHNlKCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0sXG4gICAgZXhwYW5kOiBmdW5jdGlvbiAoKSB7XG4gICAgICAkKFwiYm9keVwiKS5yZW1vdmVDbGFzcygnc2lkZWJhci1jb2xsYXBzZScpLmFkZENsYXNzKCdzaWRlYmFyLWV4cGFuZGVkLW9uLWhvdmVyJyk7XG4gICAgfSxcbiAgICBjb2xsYXBzZTogZnVuY3Rpb24gKCkge1xuICAgICAgaWYgKCQoJ2JvZHknKS5oYXNDbGFzcygnc2lkZWJhci1leHBhbmRlZC1vbi1ob3ZlcicpKSB7XG4gICAgICAgICQoJ2JvZHknKS5yZW1vdmVDbGFzcygnc2lkZWJhci1leHBhbmRlZC1vbi1ob3ZlcicpLmFkZENsYXNzKCdzaWRlYmFyLWNvbGxhcHNlJyk7XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG4gIC8qIFRyZWUoKVxuICAgKiA9PT09PT1cbiAgICogQ29udmVydHMgdGhlIHNpZGViYXIgaW50byBhIG11bHRpbGV2ZWxcbiAgICogdHJlZSB2aWV3IG1lbnUuXG4gICAqXG4gICAqIEB0eXBlIEZ1bmN0aW9uXG4gICAqIEBVc2FnZTogJC5MYXlvdXRNYW5hZ2VyLnRyZWUoJy5zaWRlYmFyJylcbiAgICovXG4gICQuTGF5b3V0TWFuYWdlci50cmVlID0gZnVuY3Rpb24gKG1lbnUpIHtcbiAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgIHZhciBhbmltYXRpb25TcGVlZCA9ICQuTGF5b3V0TWFuYWdlci5vcHRpb25zLmFuaW1hdGlvblNwZWVkO1xuICAgIC8vY2xpY2sgZXZlbnQgLy9cbiAgICAkKGRvY3VtZW50KS5vbignY2xpY2snLCBtZW51ICsgJyBsaSBhJywgZnVuY3Rpb24gKGUpIHtcblxuICAgICAgLy9HZXQgdGhlIGNsaWNrZWQgbGluayBhbmQgdGhlIG5leHQgZWxlbWVudFxuICAgICAgdmFyICR0aGlzID0gJCh0aGlzKTtcbiAgICAgIC8vaXMgdGhlIGNvbnRlbnQgb2YgdGhlIFwiYWNjb3JkaW9uXCIgdWwgLy9cbiAgICAgIHZhciBjaGVja0VsZW1lbnQgPSAkdGhpcy5uZXh0KCk7XG5cbiAgICAgIC8vQ2hlY2sgaWYgdGhlIG5leHQgZWxlbWVudCBpcyBhIG1lbnUgYW5kIGlzIHZpc2libGVcbiAgICAgIGlmICgoY2hlY2tFbGVtZW50LmlzKCcudHJlZXZpZXctbWVudScpKSAmJiAoY2hlY2tFbGVtZW50LmlzKCc6dmlzaWJsZScpKSkge1xuICAgICAgICAvL0Nsb3NlIHRoZSBtZW51XG4gICAgICAgIGNoZWNrRWxlbWVudC5zbGlkZVVwKGFuaW1hdGlvblNwZWVkLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgY2hlY2tFbGVtZW50LnBhcmVudChcImxpLnRyZWV2aWV3XCIpLnJlbW92ZUNsYXNzKFwiYWN0aXZlXCIpO1xuICAgICAgICAgIGNoZWNrRWxlbWVudC5yZW1vdmVDbGFzcygnbWVudS1vcGVuJyk7XG4gICAgICAgICAgLy9GaXggdGhlIGxheW91dCBpbiBjYXNlIHRoZSBzaWRlYmFyIHN0cmV0Y2hlcyBvdmVyIHRoZSBoZWlnaHQgb2YgdGhlIHdpbmRvd1xuICAgICAgICAgIC8vX3RoaXMubGF5b3V0LmZpeCgpO1xuICAgICAgICB9KTtcblxuICAgICAgfVxuICAgICAgLy9JZiB0aGUgbWVudSBpcyBub3QgdmlzaWJsZVxuICAgICAgZWxzZSBpZiAoKGNoZWNrRWxlbWVudC5pcygnLnRyZWV2aWV3LW1lbnUnKSkgJiYgKCFjaGVja0VsZW1lbnQuaXMoJzp2aXNpYmxlJykpKSB7XG4gICAgICAgIC8vR2V0IHRoZSBwYXJlbnQgbWVudVxuICAgICAgICB2YXIgcGFyZW50ID0gJHRoaXMucGFyZW50cygndWwnKS5maXJzdCgpO1xuICAgICAgICB2YXIgcGFyZW50X2xpID0gJHRoaXMucGFyZW50KFwibGlcIik7XG4gICAgICAgIHZhciBsaV9zaWJsaW5ncyA9IHBhcmVudF9saS5zaWJsaW5ncygpO1xuICAgICAgICB2YXIgcGFyZW50X2ZpbmRfYWN0aXZlO1xuICAgICAgICB2YXIgc2lkZWJhcl9jb250ZW50X2hlaWdodCA9IHBhcmVudC5oZWlnaHQoKSAtIHBhcmVudC5maW5kKCdsaS5oZWFkZXInKS5vdXRlckhlaWdodCgpO1xuICAgICAgICB2YXIgdHJlZXZpZXdIZWlnaHQgPSBwYXJlbnRfbGkub3V0ZXJIZWlnaHQoKTtcbiAgICAgICAgbGlfc2libGluZ3Mubm90KCcuaGVhZGVyJykuZWFjaChmdW5jdGlvbihpbmRleCwgZWwpIHtcbiAgICAgICAgICAgICAgICB0cmVldmlld0hlaWdodCs9JChlbCkuZmluZCgnYScpLm91dGVySGVpZ2h0KCk7XG4gICAgICAgIH0pO1xuICAgICAgICB2YXIgc2VjdGlvbl9oZWlnaHQgPSAoc2lkZWJhcl9jb250ZW50X2hlaWdodCAtIHRyZWV2aWV3SGVpZ2h0KTtcbiAgICAgICAgY2hlY2tFbGVtZW50LmNzcyh7XG4gICAgICAgICAgJ2hlaWdodCc6IHNlY3Rpb25faGVpZ2h0ICsgJ3B4JyxcbiAgICAgICAgICAnbWF4LWhlaWdodCc6c2VjdGlvbl9oZWlnaHQgKyAncHgnLFxuICAgICAgICAgICdvdmVyZmxvdy15JzogJ2F1dG8nXG4gICAgICAgIH0pO1xuICAgICAgICAvL0Nsb3NlIGFsbCBvcGVuIG1lbnVzIHdpdGhpbiB0aGUgcGFyZW50XG4gICAgICAgIHZhciB1bCA9IHBhcmVudC5maW5kKCd1bC50cmVldmlldy1tZW51OnZpc2libGUnKS5zbGlkZVVwKGFuaW1hdGlvblNwZWVkKTtcbiAgICAgICAgLy9SZW1vdmUgdGhlIG1lbnUtb3BlbiBjbGFzcyBmcm9tIHRoZSBwYXJlbnRcbiAgICAgICAgdWwucmVtb3ZlQ2xhc3MoJ21lbnUtb3BlbicpO1xuICAgICAgICAvL0dldCB0aGUgcGFyZW50IGxpXG4gICAgICAgIC8vT3BlbiB0aGUgdGFyZ2V0IG1lbnUgYW5kIGFkZCB0aGUgbWVudS1vcGVuIGNsYXNzXG4gICAgICAgIGNoZWNrRWxlbWVudC5zbGlkZURvd24oYW5pbWF0aW9uU3BlZWQsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAvL0FkZCB0aGUgY2xhc3MgYWN0aXZlIHRvIHRoZSBwYXJlbnQgbGlcbiAgICAgICAgICBjaGVja0VsZW1lbnQuYWRkQ2xhc3MoJ21lbnUtb3BlbicpO1xuICAgICAgICAgIHBhcmVudF9maW5kX2FjdGl2ZSA9IHBhcmVudC5maW5kKCdsaS50cmVldmlldy5hY3RpdmUnKTtcbiAgICAgICAgICBwYXJlbnRfZmluZF9hY3RpdmUucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpO1xuICAgICAgICAgIHBhcmVudF9saS5hZGRDbGFzcygnYWN0aXZlJyk7XG4gICAgICAgICAgLy9GaXggdGhlIGxheW91dCBpbiBjYXNlIHRoZSBzaWRlYmFyIHN0cmV0Y2hlcyBvdmVyIHRoZSBoZWlnaHQgb2YgdGhlIHdpbmRvd1xuICAgICAgICAgIF90aGlzLmxheW91dC5maXgoKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICAvL2lmIHRoaXMgaXNuJ3QgYSBsaW5rLCBwcmV2ZW50IHRoZSBwYWdlIGZyb20gYmVpbmcgcmVkaXJlY3RlZFxuICAgICAgaWYgKGNoZWNrRWxlbWVudC5pcygnLnRyZWV2aWV3LW1lbnUnKSkge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH07XG5cbiAgLyogQ29udHJvbFNpZGViYXJcbiAgICogPT09PT09PT09PT09PT1cbiAgICogQWRkcyBmdW5jdGlvbmFsaXR5IHRvIHRoZSByaWdodCBzaWRlYmFyXG4gICAqXG4gICAqIEB0eXBlIE9iamVjdFxuICAgKiBAdXNhZ2UgJC5MYXlvdXRNYW5hZ2VyLmNvbnRyb2xTaWRlYmFyLmFjdGl2YXRlKG9wdGlvbnMpXG4gICAqL1xuICAkLkxheW91dE1hbmFnZXIuZmxvYXRCYXIgPSAkLkxheW91dE1hbmFnZXIuY29udHJvbFNpZGViYXIgPSB7XG4gICAgLy9pbnN0YW50aWF0ZSB0aGUgb2JqZWN0XG4gICAgYWN0aXZhdGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgIC8vR2V0IHRoZSBvYmplY3RcbiAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAvL1VwZGF0ZSBvcHRpb25zXG4gICAgICB2YXIgbyA9ICQuTGF5b3V0TWFuYWdlci5vcHRpb25zLmNvbnRyb2xTaWRlYmFyT3B0aW9ucztcbiAgICAgIC8vR2V0IHRoZSBzaWRlYmFyXG4gICAgICB2YXIgc2lkZWJhciA9ICQoby5zZWxlY3Rvcik7XG4gICAgICAvL1RoZSB0b2dnbGUgYnV0dG9uXG4gICAgICB2YXIgYnRuID0gJChvLnRvZ2dsZUJ0blNlbGVjdG9yKTtcblxuICAgICAgLy9MaXN0ZW4gdG8gdGhlIGNsaWNrIGV2ZW50XG4gICAgICBidG4ub24oJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAvL0lmIHRoZSBzaWRlYmFyIGlzIG5vdCBvcGVuXG4gICAgICAgIGlmICghc2lkZWJhci5oYXNDbGFzcygnY29udHJvbC1zaWRlYmFyLW9wZW4nKSAmJiAhJCgnYm9keScpLmhhc0NsYXNzKCdjb250cm9sLXNpZGViYXItb3BlbicpKSB7XG4gICAgICAgICAgLy9PcGVuIHRoZSBzaWRlYmFyXG4gICAgICAgICAgX3RoaXMub3BlbihzaWRlYmFyLCBvLnNsaWRlKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBfdGhpcy5jbG9zZShzaWRlYmFyLCBvLnNsaWRlKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIC8vSWYgdGhlIGJvZHkgaGFzIGEgYm94ZWQgbGF5b3V0LCBmaXggdGhlIHNpZGViYXIgYmcgcG9zaXRpb25cbiAgICAgIHZhciBiZyA9ICQoXCIuY29udHJvbC1zaWRlYmFyLWJnXCIpO1xuICAgICAgX3RoaXMuX2ZpeChiZyk7XG5cbiAgICAgIC8vSWYgdGhlIGJvZHkgaGFzIGEgZml4ZWQgbGF5b3V0LCBtYWtlIHRoZSBjb250cm9sIHNpZGViYXIgZml4ZWRcbiAgICAgIGlmICgkKCdib2R5JykuaGFzQ2xhc3MoJ2ZpeGVkJykpIHtcbiAgICAgICAgX3RoaXMuX2ZpeEZvckZpeGVkKHNpZGViYXIpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy9JZiB0aGUgY29udGVudCBoZWlnaHQgaXMgbGVzcyB0aGFuIHRoZSBzaWRlYmFyJ3MgaGVpZ2h0LCBmb3JjZSBtYXggaGVpZ2h0XG4gICAgICAgIGlmICgkKCcuY29udGVudC13cmFwcGVyLCAucmlnaHQtc2lkZScpLmhlaWdodCgpIDwgc2lkZWJhci5oZWlnaHQoKSkge1xuICAgICAgICAgIF90aGlzLl9maXhGb3JDb250ZW50KHNpZGViYXIpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSxcbiAgICAvL09wZW4gdGhlIGNvbnRyb2wgc2lkZWJhclxuICAgIG9wZW46IGZ1bmN0aW9uIChzaWRlYmFyLCBzbGlkZSkge1xuICAgICAgLy9TbGlkZSBvdmVyIGNvbnRlbnRcbiAgICAgIGlmIChzbGlkZSkge1xuICAgICAgICBzaWRlYmFyLmFkZENsYXNzKCdjb250cm9sLXNpZGViYXItb3BlbicpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy9QdXNoIHRoZSBjb250ZW50IGJ5IGFkZGluZyB0aGUgb3BlbiBjbGFzcyB0byB0aGUgYm9keSBpbnN0ZWFkXG4gICAgICAgIC8vb2YgdGhlIHNpZGViYXIgaXRzZWxmXG4gICAgICAgICQoJ2JvZHknKS5hZGRDbGFzcygnY29udHJvbC1zaWRlYmFyLW9wZW4nKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIC8vQ2xvc2UgdGhlIGNvbnRyb2wgc2lkZWJhclxuICAgIGNsb3NlOiBmdW5jdGlvbiAoc2lkZWJhciwgc2xpZGUpIHtcbiAgICAgIGlmIChzbGlkZSkge1xuICAgICAgICBzaWRlYmFyLnJlbW92ZUNsYXNzKCdjb250cm9sLXNpZGViYXItb3BlbicpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgJCgnYm9keScpLnJlbW92ZUNsYXNzKCdjb250cm9sLXNpZGViYXItb3BlbicpO1xuICAgICAgfVxuICAgIH0sXG4gICAgX2ZpeDogZnVuY3Rpb24gKHNpZGViYXIpIHtcbiAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICBpZiAoJChcImJvZHlcIikuaGFzQ2xhc3MoJ2xheW91dC1ib3hlZCcpKSB7XG4gICAgICAgIHNpZGViYXIuY3NzKCdwb3NpdGlvbicsICdhYnNvbHV0ZScpO1xuICAgICAgICBzaWRlYmFyLmhlaWdodCgkKFwiLndyYXBwZXJcIikuaGVpZ2h0KCkpO1xuICAgICAgICAkKHdpbmRvdykucmVzaXplKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBfdGhpcy5fZml4KHNpZGViYXIpO1xuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHNpZGViYXIuY3NzKHtcbiAgICAgICAgICAncG9zaXRpb24nOiAnZml4ZWQnLFxuICAgICAgICAgICdoZWlnaHQnOiAnYXV0bydcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSxcbiAgICBfZml4Rm9yRml4ZWQ6IGZ1bmN0aW9uIChzaWRlYmFyKSB7XG4gICAgICBzaWRlYmFyLmNzcyh7XG4gICAgICAgICdwb3NpdGlvbic6ICdmaXhlZCcsXG4gICAgICAgICdtYXgtaGVpZ2h0JzogJzEwMCUnLFxuICAgICAgICAnb3ZlcmZsb3cnOiAnYXV0bycsXG4gICAgICAgICdwYWRkaW5nLWJvdHRvbSc6ICc1MHB4J1xuICAgICAgfSk7XG4gICAgfSxcbiAgICBfZml4Rm9yQ29udGVudDogZnVuY3Rpb24gKHNpZGViYXIpIHtcbiAgICAgICQoXCIuY29udGVudC13cmFwcGVyLCAucmlnaHQtc2lkZVwiKS5jc3MoJ21pbi1oZWlnaHQnLCBzaWRlYmFyLmhlaWdodCgpKTtcbiAgICB9XG4gIH07XG5cbiAgLyogQm94V2lkZ2V0XG4gICAqID09PT09PT09PVxuICAgKiBCb3hXaWRnZXQgaXMgYSBwbHVnaW4gdG8gaGFuZGxlIGNvbGxhcHNpbmcgYW5kXG4gICAqIHJlbW92aW5nIGJveGVzIGZyb20gdGhlIHNjcmVlbi5cbiAgICpcbiAgICogQHR5cGUgT2JqZWN0XG4gICAqIEB1c2FnZSAkLkxheW91dE1hbmFnZXIuYm94V2lkZ2V0LmFjdGl2YXRlKClcbiAgICogICAgICAgIFNldCBhbGwgeW91ciBvcHRpb25zIGluIHRoZSBtYWluICQuTGF5b3V0TWFuYWdlci5vcHRpb25zIG9iamVjdFxuICAgKi9cbiAgJC5MYXlvdXRNYW5hZ2VyLmJveFdpZGdldCA9IHtcbiAgICBzZWxlY3RvcnM6ICQuTGF5b3V0TWFuYWdlci5vcHRpb25zLmJveFdpZGdldE9wdGlvbnMuYm94V2lkZ2V0U2VsZWN0b3JzLFxuICAgIGljb25zOiAkLkxheW91dE1hbmFnZXIub3B0aW9ucy5ib3hXaWRnZXRPcHRpb25zLmJveFdpZGdldEljb25zLFxuICAgIGFuaW1hdGlvblNwZWVkOiAkLkxheW91dE1hbmFnZXIub3B0aW9ucy5hbmltYXRpb25TcGVlZCxcbiAgICBhY3RpdmF0ZTogZnVuY3Rpb24gKF9ib3gpIHtcbiAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICBpZiAoIV9ib3gpIHtcbiAgICAgICAgX2JveCA9IGRvY3VtZW50OyAvLyBhY3RpdmF0ZSBhbGwgYm94ZXMgcGVyIGRlZmF1bHRcbiAgICAgIH1cbiAgICAgIC8vTGlzdGVuIGZvciBjb2xsYXBzZSBldmVudCB0cmlnZ2Vyc1xuICAgICAgJChfYm94KS5vbignY2xpY2snLCBfdGhpcy5zZWxlY3RvcnMuY29sbGFwc2UsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgX3RoaXMuY29sbGFwc2UoJCh0aGlzKSk7XG4gICAgICB9KTtcblxuICAgICAgLy9MaXN0ZW4gZm9yIHJlbW92ZSBldmVudCB0cmlnZ2Vyc1xuICAgICAgJChfYm94KS5vbignY2xpY2snLCBfdGhpcy5zZWxlY3RvcnMucmVtb3ZlLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIF90aGlzLnJlbW92ZSgkKHRoaXMpKTtcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgY29sbGFwc2U6IGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgLy9GaW5kIHRoZSBib3ggcGFyZW50XG4gICAgICB2YXIgYm94ID0gZWxlbWVudC5wYXJlbnRzKFwiLmJveFwiKS5maXJzdCgpO1xuICAgICAgLy9GaW5kIHRoZSBib2R5IGFuZCB0aGUgZm9vdGVyXG4gICAgICB2YXIgYm94X2NvbnRlbnQgPSBib3guZmluZChcIj4gLmJveC1ib2R5LCA+IC5ib3gtZm9vdGVyLCA+IGZvcm0gID4uYm94LWJvZHksID4gZm9ybSA+IC5ib3gtZm9vdGVyXCIpO1xuICAgICAgaWYgKCFib3guaGFzQ2xhc3MoXCJjb2xsYXBzZWQtYm94XCIpKSB7XG4gICAgICAgIC8vQ29udmVydCBtaW51cyBpbnRvIHBsdXNcbiAgICAgICAgZWxlbWVudC5jaGlsZHJlbihcIjpmaXJzdFwiKVxuICAgICAgICAgICAgICAgIC5yZW1vdmVDbGFzcyhfdGhpcy5pY29ucy5jb2xsYXBzZSlcbiAgICAgICAgICAgICAgICAuYWRkQ2xhc3MoX3RoaXMuaWNvbnMub3Blbik7XG4gICAgICAgIC8vSGlkZSB0aGUgY29udGVudFxuICAgICAgICBib3hfY29udGVudC5zbGlkZVVwKF90aGlzLmFuaW1hdGlvblNwZWVkLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgYm94LmFkZENsYXNzKFwiY29sbGFwc2VkLWJveFwiKTtcbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvL0NvbnZlcnQgcGx1cyBpbnRvIG1pbnVzXG4gICAgICAgIGVsZW1lbnQuY2hpbGRyZW4oXCI6Zmlyc3RcIilcbiAgICAgICAgICAgICAgICAucmVtb3ZlQ2xhc3MoX3RoaXMuaWNvbnMub3BlbilcbiAgICAgICAgICAgICAgICAuYWRkQ2xhc3MoX3RoaXMuaWNvbnMuY29sbGFwc2UpO1xuICAgICAgICAvL1Nob3cgdGhlIGNvbnRlbnRcbiAgICAgICAgYm94X2NvbnRlbnQuc2xpZGVEb3duKF90aGlzLmFuaW1hdGlvblNwZWVkLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgYm94LnJlbW92ZUNsYXNzKFwiY29sbGFwc2VkLWJveFwiKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSxcbiAgICByZW1vdmU6IGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICAvL0ZpbmQgdGhlIGJveCBwYXJlbnRcbiAgICAgIHZhciBib3ggPSBlbGVtZW50LnBhcmVudHMoXCIuYm94XCIpLmZpcnN0KCk7XG4gICAgICBib3guc2xpZGVVcCh0aGlzLmFuaW1hdGlvblNwZWVkKTtcbiAgICB9XG4gIH07XG4gIFxuICByZXR1cm4gJC5MYXlvdXRNYW5hZ2VyO1xufTtcblxuLyogLS0tLS0tLS0tLS0tLS0tLS0tXG4gKiAtIEN1c3RvbSBQbHVnaW5zIC1cbiAqIC0tLS0tLS0tLS0tLS0tLS0tLVxuICogQWxsIGN1c3RvbSBwbHVnaW5zIGFyZSBkZWZpbmVkIGJlbG93LlxuICovXG5cbi8qXG4gKiBCT1ggUkVGUkVTSCBCVVRUT05cbiAqIC0tLS0tLS0tLS0tLS0tLS0tLVxuICogVGhpcyBpcyBhIGN1c3RvbSBwbHVnaW4gdG8gdXNlIHdpdGggdGhlIGNvbXBvbmVudCBCT1guIEl0IGFsbG93cyB5b3UgdG8gYWRkXG4gKiBhIHJlZnJlc2ggYnV0dG9uIHRvIHRoZSBib3guIEl0IGNvbnZlcnRzIHRoZSBib3gncyBzdGF0ZSB0byBhIGxvYWRpbmcgc3RhdGUuXG4gKlxuICogQHR5cGUgcGx1Z2luXG4gKiBAdXNhZ2UgJChcIiNib3gtd2lkZ2V0XCIpLmJveFJlZnJlc2goIG9wdGlvbnMgKTtcbiAqL1xuJC5MYXlvdXRNYW5hZ2VyLmFkZFJlZnJlc2hCdXR0b24gPSBmdW5jdGlvbiAoKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gICQuZm4uYm94UmVmcmVzaCA9IGZ1bmN0aW9uIChvcHRpb25zKSB7XG5cbiAgICAvLyBSZW5kZXIgb3B0aW9uc1xuICAgIHZhciBzZXR0aW5ncyA9ICQuZXh0ZW5kKHtcbiAgICAgIC8vUmVmcmVzaCBidXR0b24gc2VsZWN0b3JcbiAgICAgIHRyaWdnZXI6IFwiLnJlZnJlc2gtYnRuXCIsXG4gICAgICAvL0ZpbGUgc291cmNlIHRvIGJlIGxvYWRlZCAoZS5nOiBhamF4L3NyYy5waHApXG4gICAgICBzb3VyY2U6IFwiXCIsXG4gICAgICAvL0NhbGxiYWNrc1xuICAgICAgb25Mb2FkU3RhcnQ6IGZ1bmN0aW9uIChib3gpIHtcbiAgICAgICAgcmV0dXJuIGJveDtcbiAgICAgIH0sIC8vUmlnaHQgYWZ0ZXIgdGhlIGJ1dHRvbiBoYXMgYmVlbiBjbGlja2VkXG4gICAgICBvbkxvYWREb25lOiBmdW5jdGlvbiAoYm94KSB7XG4gICAgICAgIHJldHVybiBib3g7XG4gICAgICB9IC8vV2hlbiB0aGUgc291cmNlIGhhcyBiZWVuIGxvYWRlZFxuXG4gICAgfSwgb3B0aW9ucyk7XG5cbiAgICAvL1RoZSBvdmVybGF5XG4gICAgdmFyIG92ZXJsYXkgPSAkKCc8ZGl2IGNsYXNzPVwib3ZlcmxheVwiPjxkaXYgY2xhc3M9XCJmYSBmYS1yZWZyZXNoIGZhLXNwaW5cIj48L2Rpdj48L2Rpdj4nKTtcblxuICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24gKCkge1xuICAgICAgLy9pZiBhIHNvdXJjZSBpcyBzcGVjaWZpZWRcbiAgICAgIGlmIChzZXR0aW5ncy5zb3VyY2UgPT09IFwiXCIpIHtcbiAgICAgICAgaWYgKHdpbmRvdy5jb25zb2xlKSB7XG4gICAgICAgICAgd2luZG93LmNvbnNvbGUubG9nKFwiUGxlYXNlIHNwZWNpZnkgYSBzb3VyY2UgZmlyc3QgLSBib3hSZWZyZXNoKClcIik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgLy90aGUgYm94XG4gICAgICB2YXIgYm94ID0gJCh0aGlzKTtcbiAgICAgIC8vdGhlIGJ1dHRvblxuICAgICAgdmFyIHJCdG4gPSBib3guZmluZChzZXR0aW5ncy50cmlnZ2VyKS5maXJzdCgpO1xuXG4gICAgICAvL09uIHRyaWdnZXIgY2xpY2tcbiAgICAgIHJCdG4ub24oJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAvL0FkZCBsb2FkaW5nIG92ZXJsYXlcbiAgICAgICAgc3RhcnQoYm94KTtcblxuICAgICAgICAvL1BlcmZvcm0gYWpheCBjYWxsXG4gICAgICAgIGJveC5maW5kKFwiLmJveC1ib2R5XCIpLmxvYWQoc2V0dGluZ3Muc291cmNlLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgZG9uZShib3gpO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZnVuY3Rpb24gc3RhcnQoYm94KSB7XG4gICAgICAvL0FkZCBvdmVybGF5IGFuZCBsb2FkaW5nIGltZ1xuICAgICAgYm94LmFwcGVuZChvdmVybGF5KTtcblxuICAgICAgc2V0dGluZ3Mub25Mb2FkU3RhcnQuY2FsbChib3gpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGRvbmUoYm94KSB7XG4gICAgICAvL1JlbW92ZSBvdmVybGF5IGFuZCBsb2FkaW5nIGltZ1xuICAgICAgYm94LmZpbmQob3ZlcmxheSkucmVtb3ZlKCk7XG5cbiAgICAgIHNldHRpbmdzLm9uTG9hZERvbmUuY2FsbChib3gpO1xuICAgIH1cblxuICB9O1xuICByZXR1cm4gJC5MYXlvdXRNYW5hZ2VyO1xufTtcblxuLypcbiAqIEVYUExJQ0lUIEJPWCBBQ1RJVkFUSU9OXG4gKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICogVGhpcyBpcyBhIGN1c3RvbSBwbHVnaW4gdG8gdXNlIHdpdGggdGhlIGNvbXBvbmVudCBCT1guIEl0IGFsbG93cyB5b3UgdG8gYWN0aXZhdGVcbiAqIGEgYm94IGluc2VydGVkIGluIHRoZSBET00gYWZ0ZXIgdGhlIGFwcC5qcyB3YXMgbG9hZGVkLlxuICpcbiAqIEB0eXBlIHBsdWdpblxuICogQHVzYWdlICQoXCIjYm94LXdpZGdldFwiKS5hY3RpdmF0ZUJveCgpO1xuICovXG4kLkxheW91dE1hbmFnZXIuYWN0aXZhdGVCb3ggPSBmdW5jdGlvbiAoKSB7XG4gICd1c2Ugc3RyaWN0JztcblxuICAkLmZuLmFjdGl2YXRlQm94ID0gZnVuY3Rpb24gKCkge1xuICAgICQuTGF5b3V0TWFuYWdlci5ib3hXaWRnZXQuYWN0aXZhdGUodGhpcyk7XG4gIH07XG4gIFxuICByZXR1cm4gJC5MYXlvdXRNYW5hZ2VyO1xufTtcblxuLypcbiAqIFRPRE8gTElTVCBDVVNUT00gUExVR0lOXG4gKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICogVGhpcyBwbHVnaW4gZGVwZW5kcyBvbiBpQ2hlY2sgcGx1Z2luIGZvciBjaGVja2JveCBhbmQgcmFkaW8gaW5wdXRzXG4gKlxuICogQHR5cGUgcGx1Z2luXG4gKiBAdXNhZ2UgJChcIiN0b2RvLXdpZGdldFwiKS50b2RvbGlzdCggb3B0aW9ucyApO1xuICovXG5cbiQuTGF5b3V0TWFuYWdlci5saXN0Q3VzdG9tUGx1Z2luID0gZnVuY3Rpb24gKCkge1xuXG5cdCAgJ3VzZSBzdHJpY3QnO1xuXG5cdCAgJC5mbi50b2RvbGlzdCA9IGZ1bmN0aW9uIChvcHRpb25zKSB7XG5cdCAgICAvLyBSZW5kZXIgb3B0aW9uc1xuXHQgICAgdmFyIHNldHRpbmdzID0gJC5leHRlbmQoe1xuXHQgICAgICAvL1doZW4gdGhlIHVzZXIgY2hlY2tzIHRoZSBpbnB1dFxuXHQgICAgICBvbkNoZWNrOiBmdW5jdGlvbiAoZWxlKSB7XG5cdCAgICAgICAgcmV0dXJuIGVsZTtcblx0ICAgICAgfSxcblx0ICAgICAgLy9XaGVuIHRoZSB1c2VyIHVuY2hlY2tzIHRoZSBpbnB1dFxuXHQgICAgICBvblVuY2hlY2s6IGZ1bmN0aW9uIChlbGUpIHtcblx0ICAgICAgICByZXR1cm4gZWxlO1xuXHQgICAgICB9XG5cdCAgICB9LCBvcHRpb25zKTtcblxuXHQgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7XG5cblx0ICAgICAgaWYgKHR5cGVvZiAkLmZuLmlDaGVjayAhPSAndW5kZWZpbmVkJykge1xuXHQgICAgICAgICQoJ2lucHV0JywgdGhpcykub24oJ2lmQ2hlY2tlZCcsIGZ1bmN0aW9uICgpIHtcblx0ICAgICAgICAgIHZhciBlbGUgPSAkKHRoaXMpLnBhcmVudHMoXCJsaVwiKS5maXJzdCgpO1xuXHQgICAgICAgICAgZWxlLnRvZ2dsZUNsYXNzKFwiZG9uZVwiKTtcblx0ICAgICAgICAgIHNldHRpbmdzLm9uQ2hlY2suY2FsbChlbGUpO1xuXHQgICAgICAgIH0pO1xuXG5cdCAgICAgICAgJCgnaW5wdXQnLCB0aGlzKS5vbignaWZVbmNoZWNrZWQnLCBmdW5jdGlvbiAoKSB7XG5cdCAgICAgICAgICB2YXIgZWxlID0gJCh0aGlzKS5wYXJlbnRzKFwibGlcIikuZmlyc3QoKTtcblx0ICAgICAgICAgIGVsZS50b2dnbGVDbGFzcyhcImRvbmVcIik7XG5cdCAgICAgICAgICBzZXR0aW5ncy5vblVuY2hlY2suY2FsbChlbGUpO1xuXHQgICAgICAgIH0pO1xuXHQgICAgICB9IGVsc2Uge1xuXHQgICAgICAgICQoJ2lucHV0JywgdGhpcykub24oJ2NoYW5nZScsIGZ1bmN0aW9uICgpIHtcblx0ICAgICAgICAgIHZhciBlbGUgPSAkKHRoaXMpLnBhcmVudHMoXCJsaVwiKS5maXJzdCgpO1xuXHQgICAgICAgICAgZWxlLnRvZ2dsZUNsYXNzKFwiZG9uZVwiKTtcblx0ICAgICAgICAgIGlmICgkKCdpbnB1dCcsIGVsZSkuaXMoXCI6Y2hlY2tlZFwiKSkge1xuXHQgICAgICAgICAgICBzZXR0aW5ncy5vbkNoZWNrLmNhbGwoZWxlKTtcblx0ICAgICAgICAgIH0gZWxzZSB7XG5cdCAgICAgICAgICAgIHNldHRpbmdzLm9uVW5jaGVjay5jYWxsKGVsZSk7XG5cdCAgICAgICAgICB9XG5cdCAgICAgICAgfSk7XG5cdCAgICAgIH1cblx0ICAgIH0pO1xuXHQgIH07XG5cdCAgcmV0dXJuICQuTGF5b3V0TWFuYWdlcjtcblx0fTtcblx0XG5cdC8qIC0tLS0tLS0tLS0tLS0tLS0tLVxuXHQgKiAtIEltcGxlbWVudGF0aW9uIC1cblx0ICogLS0tLS0tLS0tLS0tLS0tLS0tXG5cdCAqIFRoZSBuZXh0IGJsb2NrIG9mIGNvZGUgaW1wbGVtZW50cyBMYXlvdXRNYW5hZ2VyJ3Ncblx0ICogZnVuY3Rpb25zIGFuZCBwbHVnaW5zIGFzIHNwZWNpZmllZCBieSB0aGVcblx0ICogb3B0aW9ucyBhYm92ZS5cblx0ICovXG5cdCQuTGF5b3V0TWFuYWdlci5zZXR1cCA9IGZ1bmN0aW9uICgpXG5cdHtcblx0ICBcInVzZSBzdHJpY3RcIjtcblxuXHQgIC8vRml4IGZvciBJRSBwYWdlIHRyYW5zaXRpb25zXG5cdCAgJChcImJvZHlcIikucmVtb3ZlQ2xhc3MoXCJob2xkLXRyYW5zaXRpb25cIik7XG5cblx0ICAvL0V4dGVuZCBvcHRpb25zIGlmIGV4dGVybmFsIG9wdGlvbnMgZXhpc3Rcblx0ICBpZiAodHlwZW9mIExheW91dE1hbmFnZXJPcHRpb25zICE9PSBcInVuZGVmaW5lZFwiKSB7XG5cdCAgICAkLmV4dGVuZCh0cnVlLFxuXHQgICAgICAgICAgICAkLkxheW91dE1hbmFnZXIub3B0aW9ucyxcblx0ICAgICAgICAgICAgTGF5b3V0TWFuYWdlck9wdGlvbnMpO1xuXHQgIH1cblxuXHQgIC8vRWFzeSBhY2Nlc3MgdG8gb3B0aW9uc1xuXHQgIHZhciBvID0gJC5MYXlvdXRNYW5hZ2VyLm9wdGlvbnM7XG5cblx0ICAvL1NldCB1cCB0aGUgb2JqZWN0XG5cdCAgJC5MYXlvdXRNYW5hZ2VyLl9pbml0KCk7XG5cblx0ICAvL0FjdGl2YXRlIHRoZSBsYXlvdXQgbWFrZXJcblx0ICAkLkxheW91dE1hbmFnZXIubGF5b3V0LmFjdGl2YXRlKCk7XG5cblx0ICAvL0VuYWJsZSBzaWRlYmFyIHRyZWUgdmlldyBjb250cm9sc1xuXHQgICQuTGF5b3V0TWFuYWdlci50cmVlKCcuc2lkZWJhcicpO1xuXG5cdCAgLy9FbmFibGUgY29udHJvbCBzaWRlYmFyXG5cdCAgaWYgKG8uZW5hYmxlQ29udHJvbFNpZGViYXIpIHtcblx0ICAgICQuTGF5b3V0TWFuYWdlci5jb250cm9sU2lkZWJhci5hY3RpdmF0ZSgpO1xuXHQgIH1cblxuXHQgIC8vQWRkIHNsaW1zY3JvbGwgdG8gbmF2YmFyIGRyb3Bkb3duXG5cdCAgaWYgKG8ubmF2YmFyTWVudVNsaW1zY3JvbGwgJiYgdHlwZW9mICQuZm4uc2xpbXNjcm9sbCAhPSAndW5kZWZpbmVkJykge1xuXHQgICAgJChcIi5uYXZiYXIgLm1lbnVcIikuc2xpbXNjcm9sbCh7XG5cdCAgICAgIGhlaWdodDogby5uYXZiYXJNZW51SGVpZ2h0LFxuXHQgICAgICBhbHdheXNWaXNpYmxlOiBmYWxzZSxcblx0ICAgICAgc2l6ZTogby5uYXZiYXJNZW51U2xpbXNjcm9sbFdpZHRoXG5cdCAgICB9KS5jc3MoXCJ3aWR0aFwiLCBcIjEwMCVcIik7XG5cdCAgfVxuXG5cdCAgLy9BY3RpdmF0ZSBzaWRlYmFyIHB1c2ggbWVudVxuXHQgIGlmIChvLnNpZGViYXJQdXNoTWVudSkge1xuXHQgICAgJC5MYXlvdXRNYW5hZ2VyLnB1c2hNZW51LmFjdGl2YXRlKG8uc2lkZWJhclRvZ2dsZVNlbGVjdG9yKTtcblx0ICB9XG5cblx0ICAvL0FjdGl2YXRlIEJvb3RzdHJhcCB0b29sdGlwXG5cdCAgaWYgKG8uZW5hYmxlQlNUb3BwbHRpcCkge1xuXHQgICAgJCgnYm9keScpLnRvb2x0aXAoe1xuXHQgICAgICBzZWxlY3Rvcjogby5CU1Rvb2x0aXBTZWxlY3RvclxuXHQgICAgfSk7XG5cdCAgfVxuXG5cdCAgLy9BY3RpdmF0ZSBib3ggd2lkZ2V0XG5cdCAgaWYgKG8uZW5hYmxlQm94V2lkZ2V0KSB7XG5cdCAgICAkLkxheW91dE1hbmFnZXIuYm94V2lkZ2V0LmFjdGl2YXRlKCk7XG5cdCAgfVxuXG5cdCAgLy9BY3RpdmF0ZSBmYXN0IGNsaWNrXG5cdCAgaWYgKG8uZW5hYmxlRmFzdGNsaWNrICYmIHR5cGVvZiBGYXN0Q2xpY2sgIT0gJ3VuZGVmaW5lZCcpIHtcblx0ICAgIEZhc3RDbGljay5hdHRhY2goZG9jdW1lbnQuYm9keSk7XG5cdCAgfVxuXG5cdCAgLy9BY3RpdmF0ZSBkaXJlY3QgY2hhdCB3aWRnZXRcblx0ICBpZiAoby5kaXJlY3RDaGF0LmVuYWJsZSkge1xuXHQgICAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgby5kaXJlY3RDaGF0LmNvbnRhY3RUb2dnbGVTZWxlY3RvciwgZnVuY3Rpb24gKCkge1xuXHQgICAgICB2YXIgYm94ID0gJCh0aGlzKS5wYXJlbnRzKCcuZGlyZWN0LWNoYXQnKS5maXJzdCgpO1xuXHQgICAgICBib3gudG9nZ2xlQ2xhc3MoJ2RpcmVjdC1jaGF0LWNvbnRhY3RzLW9wZW4nKTtcblx0ICAgIH0pO1xuXHQgIH1cblxuXHQgIC8qXG5cdCAgICogSU5JVElBTElaRSBCVVRUT04gVE9HR0xFXG5cdCAgICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cdCAgICovXG5cdCAgJCgnLmJ0bi1ncm91cFtkYXRhLXRvZ2dsZT1cImJ0bi10b2dnbGVcIl0nKS5lYWNoKGZ1bmN0aW9uICgpIHtcblx0ICAgIHZhciBncm91cCA9ICQodGhpcyk7XG5cdCAgICAkKHRoaXMpLmZpbmQoXCIuYnRuXCIpLm9uKCdjbGljaycsIGZ1bmN0aW9uIChlKSB7XG5cdCAgICAgIGdyb3VwLmZpbmQoXCIuYnRuLmFjdGl2ZVwiKS5yZW1vdmVDbGFzcyhcImFjdGl2ZVwiKTtcblx0ICAgICAgJCh0aGlzKS5hZGRDbGFzcyhcImFjdGl2ZVwiKTtcblx0ICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHQgICAgfSk7XG5cblx0ICB9KTtcblx0ICBcblx0ICByZXR1cm4gJC5MYXlvdXRNYW5hZ2VyXG5cdCAgXHQuYWRkUmVmcmVzaEJ1dHRvbigpXG5cdCAgXHQuYWN0aXZhdGVCb3goKVxuXHQgIFx0Lmxpc3RDdXN0b21QbHVnaW4oKTtcblx0fTtcblxuJC5MYXlvdXRNYW5hZ2VyLmxvYWRpbmcgPSBmdW5jdGlvbihzdGFydCl7XG4gIHZhciBzdGFydCA9IF8uaXNCb29sZWFuKHN0YXJ0KSA/IHN0YXJ0IDogdHJ1ZTtcbiAgaWYgKHN0YXJ0KSB7XG4gICAgJCgnYm9keScpLmFwcGVuZCgnPGRpdiBpZD1cImxvYWRzcGlubmVyXCIgY2xhc3M9XCJsb2FkaW5nXCI+PC9kaXY+Jyk7XG4gIH1cbiAgZWxzZSB7XG4gICAgJCgnI2xvYWRzcGlubmVyJykucmVtb3ZlKCk7XG4gIH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSAkLkxheW91dE1hbmFnZXI7XG4iLCJ2YXIgdCA9IHJlcXVpcmUoJ3Nkay9jb3JlL2kxOG4vaTE4bi5zZXJ2aWNlJykudDtcbnZhciBTdGFjayA9IHJlcXVpcmUoJy4vYmFyc3RhY2suanMnKTtcblxuLy9zaWRlYmFyIGl0ZW0gY2hlIG5vbiDDqCBhbHRybyBjaGUgdW4gbGkgZGVsbGEgc2lkZWJhciBkb3ZlIHNhcsOgIHBvc3NvYmlsZSBpbXBvc3RhcmVcbi8vdGl0b2xvIHRpcG8gZGkgaWNvbmEgZXRjIC4uIGN1c3RvbWl6emF0YSBwZXIgb2duaSBjb21wb25lbnRlXG5cbnZhciBTaWRlYmFySXRlbSA9IFZ1ZS5leHRlbmQoe1xuICB0ZW1wbGF0ZTogcmVxdWlyZSgnLi4vaHRtbC9zaWRlYmFyLWl0ZW0uaHRtbCcpLFxuICBkYXRhOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4ge1xuICAgICAgICBtYWluOiB0cnVlLFxuICAgICAgICBjb21wb25lbnQ6IG51bGwsXG4gICAgICAgIGFjdGl2ZTogZmFsc2UsXG4gICAgICAgIGRhdGFUeXBlOiAnaW5saW5lJyxcbiAgICAgICAgZGF0YUxhYmVsOiAnY29tcG9uZW50JyxcbiAgICAgICAgZGF0YUljb246IG51bGwsXG4gICAgICAgIG9wZW5PblN0YXJ0OiB0cnVlXG4gICAgICB9O1xuICB9XG59KTtcblxuZnVuY3Rpb24gU2lkZWJhclNlcnZpY2UoKXtcbiAgdGhpcy5zdGFjayA9IG5ldyBTdGFjaygpO1xuICB0aGlzLnN0YXRlID0ge1xuICAgIGNvbXBvbmVudHM6IFtdXG4gIH07XG4gIFxuICB0aGlzLmluaXQgPSBmdW5jdGlvbihsYXlvdXQpe1xuICAgIHRoaXMubGF5b3V0ID0gbGF5b3V0O1xuICB9O1xuICBcbiAgdGhpcy5hZGRDb21wb25lbnQgPSBmdW5jdGlvbihjb21wb25lbnQpe1xuICAgIC8vYWdnaXVuZ28gY29tcG9uZW50ZVxuICAgIHRoaXMuc3RhdGUuY29tcG9uZW50cy5wdXNoKGNvbXBvbmVudCk7XG4gICAgLy9mYWNjaW8gbW9udGFyZSBpbCBzZWRlYmFyLWl0ZW0gY2hlIGNvbnRpZW5lIGFsIHN1byBpbnRlcm5vIGlsIHBsYWNlaG9sZGVyIGRlbCBjb21wb25lbnRlIHZlcm8gZSBwcm9wcmlvXG4gICAgLy9pbiBxdWVzdG8gbW9kbyBpbCBjb21wb25lbnRlIG5vbiBzaSBkb3Zyw6Agb2NjdXBhcmUgZGkgY29zdHJ1aXJlIGFuY2hlIGwnZWxlbWVudG8gbGkgZGVsbGEgc2lkZWJhclxuICAgIC8vbWEgY29udGVycsOgIHNvbG8gaWwgY29udGVudXRvXG4gICAgdmFyIHNpZGViYXJJdGVtID0gbmV3IFNpZGViYXJJdGVtKCkuJG1vdW50KCkuJGFwcGVuZFRvKCcjZzN3LXNpZGViYXJjb21wb25lbnRzJyk7XG4gICAgLy9zZXR0byBsZSBwYXJ0aSBkZWxsYSBzaWRlYmFyLWl0ZW0gY2hlIGNhbWJpYW5vIGRhIGNvbXBvbmVudGUgYSBjb21wb25lbnRlIChkYSByaXZlZGVyZSlcbiAgICBzaWRlYmFySXRlbS5kYXRhTGFiZWwgPSBjb21wb25lbnQudGl0bGUgfHwgc2lkZWJhckl0ZW0uZGF0YUxhYmVsO1xuICAgIHNpZGViYXJJdGVtLm9wZW5PblN0YXJ0ID0gKGNvbXBvbmVudC5vcGVuT25TdGFydCA9PT0gdW5kZWZpbmVkKSA/IHNpZGViYXJJdGVtLm9wZW5PblN0YXJ0IDogY29tcG9uZW50Lm9wZW5PblN0YXJ0O1xuICAgIHNpZGViYXJJdGVtLmRhdGFJY29uID0gY29tcG9uZW50LmRhdGFJY29uIHx8IHNpZGViYXJJdGVtLmRhdGFJY29uO1xuICAgIC8vbW9udG8gaWwgY29tcG9uZXRlIG5lbGxhIHNpZGViYXJcbiAgICBjb21wb25lbnQubW91bnQoXCIjZzN3LXNpZGViYXJjb21wb25lbnQtcGxhY2Vob2xkZXJcIik7XG4gICAgaWYgKF8uaGFzKGNvbXBvbmVudCwgJ2luaXRTZXJ2aWNlJykpIHtcbiAgICAgIGNvbXBvbmVudC5pbml0U2VydmljZSgpO1xuICAgIH07XG4gIH07XG4gIFxuICB0aGlzLnJlbW92ZUNvbXBvbmVudCA9IGZ1bmN0aW9uKCl7XG4gICAgLy9kYSB2ZWRlcmVcbiAgfTtcblxuICB0aGlzLnNob3dQYW5lbCA9IGZ1bmN0aW9uKHBhbmVsKXtcbiAgICB2YXIgcGFyZW50ID0gXCIjZzN3LXNpZGViYXJwYW5lbC1wbGFjZWhvbGRlclwiO1xuICAgIHRoaXMuc3RhY2sucHVzaChwYW5lbCwgcGFyZW50KTtcbiAgfTtcblxuICB0aGlzLmNsb3NlUGFuZWwgPSBmdW5jdGlvbigpe1xuICAgIHZhciBwYW5lbCA9IHRoaXMuc3RhY2sucG9wKCk7XG4gIH07XG59XG5cbnZhciBzaWRlYmFyU2VydmljZSA9IG5ldyBTaWRlYmFyU2VydmljZSgpO1xuXG52YXIgU2lkZWJhckNvbXBvbmVudCA9IFZ1ZS5leHRlbmQoe1xuICAgIHRlbXBsYXRlOiByZXF1aXJlKCcuLi9odG1sL3NpZGViYXIuaHRtbCcpLFxuICAgIGRhdGE6IGZ1bmN0aW9uKCkge1xuICAgIFx0cmV0dXJuIHtcbiAgICAgICAgY29tcG9uZW50czogc2lkZWJhclNlcnZpY2Uuc3RhdGUuY29tcG9uZW50cyxcbiAgICAgICAgcGFuZWxzOiBzaWRlYmFyU2VydmljZS5zdGFjay5zdGF0ZS5wYW5lbHMsXG4gICAgICAgIGJPcGVuOiB0cnVlLFxuICAgIFx0XHRiUGFnZU1vZGU6IGZhbHNlLFxuICAgIFx0XHRoZWFkZXI6IHQoJ21haW4gbmF2aWdhdGlvbicpLFxuICAgICAgICB9O1xuICAgIH0sXG4gICAgY29tcHV0ZWQ6IHtcbiAgICAgIC8vIHF1YW50aSBwYW5uZWxsaSBzb25vIGF0dGl2aSBuZWxsbyBzdGFja1xuICAgICAgcGFuZWxzaW5zdGFjazogZnVuY3Rpb24oKXtcbiAgICAgICAgcmV0dXJuIHRoaXMucGFuZWxzLmxlbmd0aD4wO1xuICAgICAgfSxcbiAgICAgIGNvbXBvbmVudHNpbnN0YWNrOiBmdW5jdGlvbigpe1xuICAgICAgICByZXR1cm4gdGhpcy5jb21wb25lbnRzLmxlbmd0aD4wO1xuICAgICAgfSxcbiAgICAgIGNvbXBvbmVudG5hbWU6IGZ1bmN0aW9uKCl7XG4gICAgICAgIHZhciBuYW1lID0gXCJcIjtcbiAgICAgICAgaWYgKHRoaXMuY29tcG9uZW50cy5sZW5ndGgpe1xuICAgICAgICAgIG5hbWUgPSB0aGlzLmNvbXBvbmVudHMuc2xpY2UoLTEpWzBdLmdldE5hbWUoKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbmFtZTtcbiAgICAgIH0sXG4gICAgICBwYW5lbG5hbWU6IGZ1bmN0aW9uKCl7XG4gICAgICAgIHZhciBuYW1lID0gXCJcIjtcbiAgICAgICAgaWYgKHRoaXMucGFuZWxzLmxlbmd0aCl7XG4gICAgICAgICAgbmFtZSA9IHRoaXMucGFuZWxzLnNsaWNlKC0xKVswXS5uYW1lO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuYW1lO1xuICAgICAgfVxuICAgIH0sXG4gICAgbWV0aG9kczoge1xuICAgICAgY2xvc2VQYW5lbDogZnVuY3Rpb24oKXtcbiAgICAgICAgc2lkZWJhclNlcnZpY2UuY2xvc2VQYW5lbCgpO1xuICAgICAgfSxcbiAgICAgIGlzTW9iaWxlOiBmdW5jdGlvbigpe1xuICAgICAgICByZXR1cm4gaXNNb2JpbGUuYW55XG4gICAgICB9XG4gICAgfSxcbiAgICByZWFkeTogZnVuY3Rpb24oKXtcbiAgICB9XG59KTtcblxubW9kdWxlLmV4cG9ydHMgPSB7XG4gIFNpZGViYXJTZXJ2aWNlOiBzaWRlYmFyU2VydmljZSxcbiAgU2lkZWJhckNvbXBvbmVudDogU2lkZWJhckNvbXBvbmVudFxufVxuIiwidmFyIHQgPSByZXF1aXJlKCdzZGsvY29yZS9pMThuL2kxOG4uc2VydmljZScpLnQ7XG5yZXF1aXJlKCdzZGsvZ3VpL3Z1ZS92dWUuZGlyZWN0aXZlcycpO1xudmFyIENvbXBvbmVudHNSZWdpc3RyeSA9IHJlcXVpcmUoJ3Nkay9ndWkvY29tcG9uZW50c3JlZ2lzdHJ5Jyk7XG52YXIgR1VJID0gcmVxdWlyZSgnc2RrL2d1aS9ndWknKTtcbi8vIHRlbXBvcmFuZW8gcGVyIGZhciBmdW56aW9uYXJlIGxlIGNvc2VcbnZhciBjb25maWcgPSB7XG4gICAgY2xpZW50Ont9XG59O1xuXG52YXIgc2lkZWJhciA9IHJlcXVpcmUoJy4vc2lkZWJhcicpO1xudmFyIGZsb2F0YmFyID0gcmVxdWlyZSgnLi9mbG9hdGJhcicpO1xudmFyIFZpZXdwb3J0U2VydmljZSA9IHJlcXVpcmUoJy4vdmlld3BvcnQnKTtcbnZhciBBcHBVSSA9IHJlcXVpcmUoJy4vYXBwbGljYXRpb251aScpO1xudmFyIGxheW91dCA9IHJlcXVpcmUoJy4vbGF5b3V0Jyk7XG5cbi8vIGZvcnNlIGRhIHRyb3ZhcmUgdW4gcG9zdG8gbWlnbGlvcmUgcGVyIGF0dGl2YXJlIGxvIHNwaW5uZXIgaW5pemlhbGUuLi5cbmxheW91dC5sb2FkaW5nKCk7XG5cbnZhciBBcHBsaWNhdGlvblRlbXBsYXRlID0gZnVuY3Rpb24odGVtcGxhdGVDb25maWcsIEFwcGxpY2F0aW9uU2VydmljZSkge1xuICBzZWxmID0gdGhpcztcbiAgdGhpcy50ZW1wbGF0ZUNvbmZpZyA9IHRlbXBsYXRlQ29uZmlnO1xuICB0aGlzLkFwcGxpY2F0aW9uU2VydmljZSA9IEFwcGxpY2F0aW9uU2VydmljZTtcbiAgXG4gIHRoaXMuaW5pdCA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBjb25maWcgPSBBcHBsaWNhdGlvblNlcnZpY2UuZ2V0Q29uZmlnKCk7XG4gICAgaWYgKGNvbmZpZy5kZWJ1Zyl7XG4gICAgICBWdWUuY29uZmlnLmRlYnVnID0gdHJ1ZTtcbiAgICB9XG4gICAgdGhpcy5fc2V0dXBJbnRlcmZhY2UoKTtcbiAgICB0aGlzLl9zZXR1cExheW91dCgpO1xuICB9O1xuICBcbiAgdGhpcy5fc2V0dXBMYXlvdXQgPSBmdW5jdGlvbigpeyAgXG4gICAgVnVlLmZpbHRlcigndCcsIGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgcmV0dXJuIHQodmFsdWUpO1xuICAgIH0pO1xuXG4gICAgdmFyIFNpZGViYXJDb21wb25lbnQgPSByZXF1aXJlKCcuL3NpZGViYXInKS5TaWRlYmFyQ29tcG9uZW50O1xuICAgIHZhciBGbG9hdGJhckNvbXBvbmVudCA9IHJlcXVpcmUoJy4vZmxvYXRiYXInKS5GbG9hdGJhckNvbXBvbmVudDtcbiAgICB2YXIgQXBwVUkgPSByZXF1aXJlKCcuL2FwcGxpY2F0aW9udWknKTtcblxuICAgIFZ1ZS5jb21wb25lbnQoJ3NpZGViYXInLCBTaWRlYmFyQ29tcG9uZW50KTtcbiAgICBWdWUuY29tcG9uZW50KCdmbG9hdGJhcicsIEZsb2F0YmFyQ29tcG9uZW50KTtcbiAgICBWdWUuY29tcG9uZW50KCdhcHAnLCBBcHBVSSk7XG5cbiAgICAvL2luaXppYWxpenphIGwnYXBwbGljYXppb25lIFZ1ZVxuICAgIHZhciB0ZW1wbGF0ZSA9IHRoaXM7ICBcbiAgICB2YXIgYXBwID0gbmV3IFZ1ZSh7XG4gICAgICBlbDogJ2JvZHknLFxuICAgICAgcmVhZHk6IGZ1bmN0aW9uKCl7XG4gICAgICAgICQoZG9jdW1lbnQpLmxvY2FsaXplKCk7XG4gICAgICAgIHNlbGYuX2J1aWxkVGVtcGxhdGUoKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuICBcbiAgdGhpcy5fYnVpbGRUZW1wbGF0ZSA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICB2YXIgcGxhY2Vob2xkZXJzQ29uZmlnID0gdGhpcy50ZW1wbGF0ZUNvbmZpZy5wbGFjZWhvbGRlcnM7XG4gICAgXy5mb3JFYWNoKHBsYWNlaG9sZGVyc0NvbmZpZywgZnVuY3Rpb24oY29tcG9uZW50cywgcGxhY2Vob2xkZXIpe1xuICAgICAgLy8gcGVyIG9nbmkgcGxhY2Vob2xkZXIgY2kgcG9zc29ubyBlc3NlcmUgcGnDuSBjb21wb25lbnRpIGNpY2xvIGUgYWdnaXVuZ29cbiAgICAgXy5mb3JFYWNoKGNvbXBvbmVudHMuY29tcG9uZW50cywgZnVuY3Rpb24oY29tcG9uZW50KXtcbiAgICAgICAgc2VsZi5fYWRkQ29tcG9uZW50KHBsYWNlaG9sZGVyLCBjb21wb25lbnQpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gICAgdmFyIG1hcENvbXBvbmVudCA9IHRoaXMudGVtcGxhdGVDb25maWcudmlld3BvcnQubWFwO1xuICAgIFZpZXdwb3J0U2VydmljZS5pbml0KG1hcENvbXBvbmVudCxudWxsKTtcbiAgICBHVUkucmVhZHkoKTtcbiAgfTtcbiAgXG4gIHRoaXMuX2FkZENvbXBvbmVudCA9IGZ1bmN0aW9uKHBsYWNlaG9sZGVyLCBjb21wb25lbnQpIHtcbiAgICBpZiAoQXBwbGljYXRpb25UZW1wbGF0ZS5QTEFDRUhPTERFUlMuaW5kZXhPZihwbGFjZWhvbGRlcikgPiAtMSl7XG4gICAgICB2YXIgcGxhY2Vob2xkZXJTZXJ2aWNlID0gQXBwbGljYXRpb25UZW1wbGF0ZS5QbGFjZWhvbGRlcnNTZXJ2aWNlc1twbGFjZWhvbGRlcl07XG4gICAgICBpZiAocGxhY2Vob2xkZXJTZXJ2aWNlKSB7XG4gICAgICAgIHBsYWNlaG9sZGVyU2VydmljZS5hZGRDb21wb25lbnQoY29tcG9uZW50KTtcbiAgICAgICAgQ29tcG9uZW50c1JlZ2lzdHJ5LmFkZENvbXBvbmVudChjb21wb25lbnQpO1xuICAgICAgfVxuICAgIH1cbiAgfTtcbiAgXG4gIHRoaXMuX3JlbW92ZUNvbXBvbmVudCA9IGZ1bmN0aW9uKHBsY2Vob2xkZXIsY29tcG9uZW50SWQpIHtcbiAgICBDb21wb25lbnRzUmVnaXN0cnkucmVtb3ZlQ29tcG9uZW50KGNvbXBvbmVudCk7XG4gIH07XG5cbiAgdGhpcy5fc2hvd1NpZGViYXIgPSBmdW5jdGlvbigpIHtcbiAgICAvL2NvZGljZSBxdWlcbiAgfTtcbiAgdGhpcy5faGlkZVNpZGViYXIgPSBmdW5jdGlvbigpIHtcbiAgICAvL2NvZGljZSBxdWlcbiAgfTtcbiAgXG4gIHRoaXMuX2FkZFRvb2xzR3JvdXAgPSBmdW5jdGlvbihncm91cE5hbWUpIHtcbiAgfTtcbiAgXG4gIHRoaXMuX3JlbW92ZVRvb2xzR3JvdXAgPSBmdW5jdGlvbihncm91cE5hbWUpIHtcbiAgfTtcbiAgXG4gIHRoaXMuX2FkZFRvb2xzID0gZnVuY3Rpb24oZ3JvdXAsdG9vbHMpIHtcbiAgfTtcbiAgXG4gIHRoaXMuX3JlbW92ZVRvb2wgPSBmdW5jdGlvbih0b29sSWQpIHtcbiAgfTtcbiAgXG4gIHRoaXMuX3NldHVwSW50ZXJmYWNlID0gZnVuY3Rpb24oKSB7XG4gICAgLyogREVGSU5JWklPTkUgSU5URVJGQUNDSUEgUFVCQkxJQ0EgKi9cbiAgICBcbiAgICAvKiBNZXRvZGkgY29tdW5pIGEgdHV0dGkgaSB0ZW1wbGF0ZSAqL1xuICAgIFxuICAgIEdVSS5hZGRDb21wb25lbnQgPSBfLmJpbmQodGhpcy5fYWRkQ29tcG9uZW50LCB0aGlzKTtcbiAgICBHVUkucmVtb3ZlQ29tcG9uZW50ID0gXy5iaW5kKHRoaXMuX3JlbW92ZUNvbXBvbmVudCwgdGhpcyk7XG4gICAgXG4gICAgLyogTWV0b2RpIGRhIGRlZmluaXJlICh0cmFtaXRlIGJpbmRpbmcpICovXG4gICAgR1VJLmdldFJlc291cmNlc1VybCA9IF8uYmluZChmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiB0aGlzLkFwcGxpY2F0aW9uU2VydmljZS5jb25maWcucmVzb3VyY2VzdXJsO1xuICAgIH0sdGhpcyk7XG5cbiAgICBHVUkuc2hvd0Zvcm0gPSBmdW5jdGlvbigpIHt9O1xuICAgIEdVSS5jbG9zZUZvcm0gPSBmdW5jdGlvbigpIHt9O1xuICAgIEdVSS5zaG93TGlzdCA9IGZ1bmN0aW9uKCkge307XG4gICAgR1VJLmNsb3NlTGlzdCA9IGZ1bmN0aW9uKCkge307XG4gICAgR1VJLnNob3dUYWJsZSA9IGZ1bmN0aW9uKCkge307XG4gICAgR1VJLmNsb3NlVGFibGUgPSBmdW5jdGlvbigpIHt9O1xuXG4gICAgLy90ZW1wb3JhbmVvIHNob3cgcGFuZWxcbiAgICBHVUkuc2hvd1BhbmVsID0gXy5iaW5kKHNpZGViYXIuU2lkZWJhclNlcnZpY2Uuc2hvd1BhbmVsLCBzaWRlYmFyLlNpZGViYXJTZXJ2aWNlKTtcbiAgICBHVUkuY2xvc2VQYW5lbCA9IF8uYmluZChzaWRlYmFyLlNpZGViYXJTZXJ2aWNlLmNsb3NlUGFuZWwsIHNpZGViYXIuU2lkZWJhclNlcnZpY2UpO1xuICAgIC8qIC0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG4gICAgdG9hc3RyLm9wdGlvbnMucG9zaXRpb25DbGFzcyA9ICd0b2FzdC10b3AtY2VudGVyJztcbiAgICB0b2FzdHIub3B0aW9ucy5wcmV2ZW50RHVwbGljYXRlcyA9IHRydWU7XG4gICAgLy8gcHJveHkgZGVsbGEgbGlicmVyaWEgdG9hc3RyXG4gICAgR1VJLm5vdGlmeSA9IHRvYXN0cjtcbiAgICAvLyBwcm94eSBkZWxsYSBsaWJyZXJpYSBib290Ym94XG4gICAgR1VJLmRpYWxvZyA9IGJvb3Rib3g7XG4gICAgLyogc3Bpbm5lciAqL1xuICAgIEdVSS5zaG93U3Bpbm5lciA9IGZ1bmN0aW9uKCkge307XG4gICAgR1VJLmhpZGVTcGlubmVyID0gZnVuY3Rpb24oKSB7fTtcbiAgICAvKiBlbmQgc3Bpbm5lciovXG5cbiAgICAvKiBmaW5lIG1ldG9kaSBjb211bmkgKi9cbiAgICBcbiAgICAvKiBNZXRvZGkgc3BlY2lmaWNpIGRlbCB0ZW1wbGF0ZSAqL1xuICAgIFxuICAgIEdVSS5zaG93RmxvYXRiYXIgPSBmdW5jdGlvbigpIHt9O1xuICAgIEdVSS5oaWRlRmxvYXRiYXIgPSBmdW5jdGlvbigpIHt9O1xuICAgIFxuICAgIEdVSS5zaG93U2lkZWJhciA9IF8uYmluZCh0aGlzLl9zaG93U2lkZWJhciwgdGhpcyk7XG4gICAgR1VJLmhpZGVTaWRlYmFyID0gXy5iaW5kKHRoaXMuX2hpZGVTaWRlYmFyLCB0aGlzKTtcbiAgICBcbiAgICBHVUkuYWRkVG9vbHNHcm91cCA9IF8uYmluZCh0aGlzLl9hZGRUb29sc0dyb3VwLHRoaXMpO1xuICAgIEdVSS5yZW1vdmVUb29sc0dyb3VwID0gXy5iaW5kKHRoaXMuX3JlbW92ZVRvb2xzR3JvdXAsdGhpcyk7XG4gICAgR1VJLmFkZFRvb2wgPSBfLmJpbmQodGhpcy5fYWRkVG9vbHMsdGhpcyk7XG4gICAgR1VJLnJlbW92ZVRvb2wgPSBfLmJpbmQodGhpcy5fcmVtb3ZlVG9vbCx0aGlzKTtcbiAgICBcbiAgICAvKiBmaW5lIG1ldG9kaSBzcGVjaWZpY2kgKi9cbiAgICBcbiAgICAvKiBGSU5FIERFRklOSVpJT05FIElOVEVSRkFDQ0lBIFBVQkJMSUNBICovXG4gIH07XG4gIFxufTtcblxuQXBwbGljYXRpb25UZW1wbGF0ZS5QTEFDRUhPTERFUlMgPSBbXG4gICduYXZiYXInLFxuICAnc2lkZWJhcicsXG4gICdtYXAnLFxuICAnY29udGVudCcsXG4gICdmbG9hdGJhcidcbl07XG5cbkFwcGxpY2F0aW9uVGVtcGxhdGUuUGxhY2Vob2xkZXJzU2VydmljZXMgPSB7XG4gIG5hdmJhcjogbnVsbCxcbiAgc2lkZWJhcjogc2lkZWJhci5TaWRlYmFyU2VydmljZSxcbiAgbWFwOiBudWxsLFxuICBjb250ZW50OiBudWxsLFxuICBmbG9hdGJhcjogc2lkZWJhci5GbG9hdGJhclNlcnZpY2UsXG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9ICBBcHBsaWNhdGlvblRlbXBsYXRlO1xuXG4iLCJ2YXIgaW5oZXJpdCA9IHJlcXVpcmUoJ2NvcmUvdXRpbHMvdXRpbHMnKS5pbmhlcml0O1xudmFyIGJhc2UgPSByZXF1aXJlKCdjb3JlL3V0aWxzL3V0aWxzJykuYmFzZTtcbnZhciBtZXJnZSA9IHJlcXVpcmUoJ2NvcmUvdXRpbHMvdXRpbHMnKS5tZXJnZTtcbnZhciBHM1dPYmplY3QgPSByZXF1aXJlKCdjb3JlL2czd29iamVjdCcpO1xuXG52YXIgVmlldyA9IFZ1ZS5leHRlbmQoe1xuICB0ZW1wbGF0ZTogcmVxdWlyZSgnLi4vaHRtbC92aWV3Lmh0bWwnKSxcbiAgcmVwbGFjZTogZmFsc2UsXG4gIGRhdGE6IGZ1bmN0aW9uKCl7XG4gICAgcmV0dXJuIHtcbiAgICAgIHByaW1hcnk6IGZhbHNlLFxuICAgICAgd2lkdGg6IDMsXG4gICAgICB2aXNpYmxlOiBmYWxzZVxuICAgIH1cbiAgfVxufSk7XG5cbnZhciBWaWV3cG9ydENvbXBvbmVudCA9IFZ1ZS5jb21wb25lbnQoJ3ZpZXdwb3J0Jyx7XG4gIHRlbXBsYXRlOiByZXF1aXJlKCcuLi9odG1sL3ZpZXdwb3J0Lmh0bWwnKSxcbiAgY29tcG9uZW50czoge1xuICAgIG1hcDogVmlldyxcbiAgICBjb250ZW50OiBWaWV3XG4gIH1cbn0pXG5cbnZhciBWaWV3cG9ydFNlcnZpY2UgPSBmdW5jdGlvbigpeyAgXG4gIHRoaXMuc3RhdGUgPSB7XG4gICAgcHJpbWFyeVZpZXc6ICdtYXAnXG4gIH07XG4gIFxuICB0aGlzLnZpZXdzID0ge1xuICAgIG1hcDogbnVsbCxcbiAgICBjb250ZW54OiBudWxsXG4gIH1cblxuICB0aGlzLmluaXQgPSBmdW5jdGlvbihtYXBDb21wb25lbnQsIGNvbnRlbnR4Q29tcG9uZW50KSB7XG4gICAgdmFyIG1hcFZpZXcgPSBuZXcgVmlldyh7XG4gICAgICBlbDogJyNnM3ctbWFwLXZpZXcnXG4gICAgfSk7XG4gICAgdGhpcy52aWV3c1snbWFwJ10gPSBtYXBWaWV3O1xuICAgIFxuICAgIHZhciBjb250ZW50eFZpZXcgPSBuZXcgVmlldyh7XG4gICAgICBlbDogJyNnM3ctY29udGVueC12aWV3J1xuICAgIH0pO1xuICAgIHRoaXMudmlld3NbJ2NvbnRlbnR4J10gPSBjb250ZW50eFZpZXc7XG4gICAgXG4gICAgdGhpcy5zZXRQcmltYXJ5VmlldygnbWFwJyk7XG5cbiAgICAvLyBtb250byBsYSBtYXBwYVxuICAgIG1hcENvbXBvbmVudC5tb3VudCgnI2czdy1jb250ZW54LXZpZXcnKTtcbiAgICAvLyBtb250byBpbCBjb250ZW50eFxuICAgIC8vY29udGVudHhDb21wb25lbnQubW91bnQoI2czdy1jb250ZW54LXZpZXcpO1xuICB9XG4gIFxuICB0aGlzLnNldFByaW1hcnlWaWV3ID0gZnVuY3Rpb24odmlld05hbWUpIHtcbiAgICB0aGlzLnN0YXRlLnByaW1hcnlWaWV3ID0gdmlld05hbWU7XG4gICAgXy5mb3JFYWNoKHRoaXMudmlldyxmdW5jdGlvbih2aWV3KXtcbiAgICAgIHZpZXcucHJpbWFyeSA9IGZhbHNlO1xuICAgIH0pXG4gICAgdGhpcy52aWV3c1t2aWV3TmFtZV0ucHJpbWFyeSA9IHRydWU7XG4gIH07XG4gIFxuICB0aGlzLnNob3dTZWNvbmRhcnlWaWV3ID0gZnVuY3Rpb24od2lkdGhDbGFzcykge1xuICAgIGlmIChbMiwzXS5pbmRleE9mKHdpZHRoQ2xhc3MpID4gLTEpIHtcbiAgICAgIC8vIDEvMiBvIDEvM1xuICAgIH1cbiAgfTtcbiAgXG4gIHRoaXMuZ2V0Q29udGVudFZpZXcgPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5zdGF0ZSx2aWV3c1snY29udGVudHgnXS5jb21wb25lbnQ7XG4gIH1cbn07XG5pbmhlcml0KFZpZXdwb3J0U2VydmljZSwgRzNXT2JqZWN0KTtcblxubW9kdWxlLmV4cG9ydHMgPSBuZXcgVmlld3BvcnRTZXJ2aWNlO1xuIiwidmFyIGluaGVyaXQgPSByZXF1aXJlKCdjb3JlL3V0aWxzL3V0aWxzJykuaW5oZXJpdDtcbnZhciBiYXNlID0gcmVxdWlyZSgnY29yZS91dGlscy91dGlscycpLmJhc2U7XG52YXIgRzNXT2JqZWN0ID0gcmVxdWlyZSgnY29yZS9nM3dvYmplY3QnKTtcbnZhciByZWplY3QgPSByZXF1aXJlKCdjb3JlL3V0aWxzL3V0aWxzJykucmVqZWN0O1xuXG5mdW5jdGlvbiBBcGlTZXJ2aWNlKCl7XG4gIHRoaXMuX2NvbmZpZyA9IG51bGw7XG4gIHRoaXMuX2Jhc2VVcmwgPSBudWxsO1xuICB0aGlzLl9hcGlVcmxzID0ge307XG4gIFxuICB0aGlzLmluaXQgPSBmdW5jdGlvbihjb25maWcpIHtcbiAgICB0aGlzLl9jb25maWcgPSBjb25maWc7XG4gICAgdGhpcy5fYmFzZVVybCA9IGNvbmZpZy51cmxzLmFwaTtcbiAgICB0aGlzLl9hcGlFbmRwb2ludHMgPSBjb25maWcudXJscy5hcGlFbmRwb2ludHM7XG4gIH07XG4gIFxuICB2YXIgaG93TWFueUFyZUxvYWRpbmcgPSAwO1xuICB0aGlzLl9pbmNyZW1lbnRMb2FkZXJzID0gZnVuY3Rpb24oKXtcbiAgICBpZiAoaG93TWFueUFyZUxvYWRpbmcgPT0gMCl7XG4gICAgICB0aGlzLmVtaXQoJ2FwaXF1ZXJ5c3RhcnQnKTtcbiAgICB9XG4gICAgaG93TWFueUFyZUxvYWRpbmcgKz0gMTtcbiAgfTtcbiAgXG4gIHRoaXMuX2RlY3JlbWVudExvYWRlcnMgPSBmdW5jdGlvbigpe1xuICAgIGhvd01hbnlBcmVMb2FkaW5nIC09IDE7XG4gICAgaWYgKGhvd01hbnlBcmVMb2FkaW5nID09IDApe1xuICAgICAgdGhpcy5lbWl0KCdhcGlxdWVyeWVuZCcpO1xuICAgIH1cbiAgfTtcbiAgXG4gIHRoaXMuZ2V0ID0gZnVuY3Rpb24oYXBpLG9wdGlvbnMpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgdmFyIGFwaUVuZFBvaW50ID0gdGhpcy5fYXBpRW5kcG9pbnRzW2FwaV07XG4gICAgaWYgKGFwaUVuZFBvaW50KSB7XG4gICAgICB2YXIgY29tcGxldGVVcmwgPSB0aGlzLl9iYXNlVXJsICsgJy8nICsgYXBpRW5kUG9pbnQ7XG4gICAgICBpZiAob3B0aW9ucy5yZXF1ZXN0KSB7XG4gICAgICAgICBjb21wbGV0ZVVybCA9IGNvbXBsZXRlVXJsICsgJy8nICsgb3B0aW9ucy5yZXF1ZXN0O1xuICAgICAgfVxuICAgICAgdmFyIHBhcmFtcyA9IG9wdGlvbnMucGFyYW1zIHx8IHt9O1xuICAgICAgXG4gICAgICBzZWxmLmVtaXQoYXBpKydxdWVyeXN0YXJ0Jyk7XG4gICAgICB0aGlzLl9pbmNyZW1lbnRMb2FkZXJzKCk7XG4gICAgICByZXR1cm4gJC5nZXQoY29tcGxldGVVcmwscGFyYW1zKVxuICAgICAgLmRvbmUoZnVuY3Rpb24ocmVzcG9uc2Upe1xuICAgICAgICBzZWxmLmVtaXQoYXBpKydxdWVyeWVuZCcscmVzcG9uc2UpO1xuICAgICAgICByZXR1cm4gcmVzcG9uc2U7XG4gICAgICB9KVxuICAgICAgLmZhaWwoZnVuY3Rpb24oZSl7XG4gICAgICAgIHNlbGYuZW1pdChhcGkrJ3F1ZXJ5ZmFpbCcsZSk7XG4gICAgICAgIHJldHVybiBlO1xuICAgICAgfSlcbiAgICAgIC5hbHdheXMoZnVuY3Rpb24oKXtcbiAgICAgICAgc2VsZi5fZGVjcmVtZW50TG9hZGVycygpO1xuICAgICAgfSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgcmV0dXJuIHJlamVjdCgpO1xuICAgIH1cbiAgfTtcbiAgXG4gIGJhc2UodGhpcyk7XG59XG5pbmhlcml0KEFwaVNlcnZpY2UsRzNXT2JqZWN0KTtcblxubW9kdWxlLmV4cG9ydHMgPSBuZXcgQXBpU2VydmljZTtcbiIsInZhciBpbmhlcml0ID0gcmVxdWlyZSgnY29yZS91dGlscy91dGlscycpLmluaGVyaXQ7XG52YXIgYmFzZSA9IHJlcXVpcmUoJ2NvcmUvdXRpbHMvdXRpbHMnKS5iYXNlO1xudmFyIEczV09iamVjdCA9IHJlcXVpcmUoJ2NvcmUvZzN3b2JqZWN0Jyk7XG52YXIgQXBpU2VydmljZSA9IHJlcXVpcmUoJ2NvcmUvYXBpc2VydmljZScpO1xudmFyIFByb2plY3RzUmVnaXN0cnkgPSByZXF1aXJlKCdjb3JlL3Byb2plY3QvcHJvamVjdHNyZWdpc3RyeScpO1xudmFyIFBsdWdpbnNSZWdpc3RyeSA9IHJlcXVpcmUoJ2NvcmUvcGx1Z2luL3BsdWdpbnNyZWdpc3RyeScpO1xuXG52YXIgQXBwbGljYXRpb25TZXJ2aWNlID0gZnVuY3Rpb24oKXtcbiAgdGhpcy5zZWNyZXQgPSBcIiMjIyBHM1cgQ2xpZW50IEFwcGxpY2F0aW9uIFNlcnZpY2UgIyMjXCI7XG4gIHZhciBzZWxmID0gdGhpcztcbiAgdGhpcy5pbml0aWFsaXplZCA9IGZhbHNlO1xuICB0aGlzLl9tb2RhbE92ZXJsYXkgPSBudWxsO1xuICB0aGlzLmNvbmZpZyA9IHt9O1xuXG4gIC8vIGNoaWFtYSBpbCBjb3N0cnV0dG9yZSBkaSBHM1dPYmplY3QgKGNoZSBpbiBxdWVzdG8gbW9tZW50byBub24gZmEgbmllbnRlKVxuICBiYXNlKHRoaXMpO1xuICBcbiAgdGhpcy5pbml0ID0gZnVuY3Rpb24oY29uZmlnKXtcbiAgICB0aGlzLl9jb25maWcgPSBjb25maWc7XG4gICAgdGhpcy5fYm9vdHN0cmFwKCk7XG4gIH07XG4gIFxuICB0aGlzLmdldENvbmZpZyA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLl9jb25maWc7XG4gIH07XG4gIFxuICB0aGlzLl9ib290c3RyYXAgPSBmdW5jdGlvbigpe1xuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICBpZiAoIXRoaXMuaW5pdGlhbGl6ZWQpe1xuICAgICAgLy9pbml6aWFsaXp6YSBsYSBjb25maWd1cmF6aW9uZSBkZWkgc2Vydml6aS4gT2dudW5nbyBjZXJjaGVyw6AgZGFsIGNvbmZpZyBxdWVsbG8gZGkgY3VpIGF2csOgIGJpc29nbm9cbiAgICAgIC8vdW5hIHZvbHRhIGZpbml0YSBsYSBjb25maWd1cmF6aW9uZSBlbWV0dG8gbCdldmVudG8gcmVhZHkuIEEgcXVlc3RvIHB1bnRvIHBvdHLDsiBhdnZpYXJlIGwnaXN0YW56YSBWdWUgZ2xvYmFsZVxuICAgICAgJC53aGVuKFxuICAgICAgICBBcGlTZXJ2aWNlLmluaXQodGhpcy5fY29uZmlnKSxcbiAgICAgICAgUHJvamVjdHNSZWdpc3RyeS5pbml0KHRoaXMuX2NvbmZpZyksXG4gICAgICAgIFBsdWdpbnNSZWdpc3RyeS5pbml0KHtcbiAgICAgICAgICBwbHVzaW5nQmFzZVVybDogdGhpcy5fY29uZmlnLnVybHMuc3RhdGljdXJsLFxuICAgICAgICAgIHBsdWdpbnNDb25maWdzOiB0aGlzLl9jb25maWcucGx1Z2luc1xuICAgICAgICB9KVxuICAgICAgKS50aGVuKGZ1bmN0aW9uKCl7XG4gICAgICAgIHNlbGYuZW1pdCgncmVhZHknKTtcbiAgICAgICAgdGhpcy5pbml0aWFsaXplZCA9IHRydWU7XG4gICAgICB9KTtcbiAgICB9O1xuICB9O1xufTtcbmluaGVyaXQoQXBwbGljYXRpb25TZXJ2aWNlLEczV09iamVjdCk7XG5cbm1vZHVsZS5leHBvcnRzID0gbmV3IEFwcGxpY2F0aW9uU2VydmljZTtcbiIsInZhciBpbmhlcml0ID0gcmVxdWlyZSgnY29yZS91dGlscy91dGlscycpLmluaGVyaXQ7XG52YXIgbm9vcCA9IHJlcXVpcmUoJ2NvcmUvdXRpbHMvdXRpbHMnKS5ub29wO1xuXG4vKipcbiAqIFVuIG9nZ2V0dG8gYmFzZSBpbiBncmFkbyBkaSBnZXN0aXJlIGV2ZW50dWFsaSBzZXR0ZXIgZSByZWxhdGl2YSBjYXRlbmEgZGkgbGlzdGVuZXJzLlxuICogQGNvbnN0cnVjdG9yXG4gKi9cbnZhciBHM1dPYmplY3QgPSBmdW5jdGlvbigpe1xuICBpZiAodGhpcy5zZXR0ZXJzKXtcbiAgICB0aGlzLl9zZXR1cExpc3RlbmVyc0NoYWluKHRoaXMuc2V0dGVycyk7XG4gIH1cbn07XG5pbmhlcml0KEczV09iamVjdCxFdmVudEVtaXR0ZXIpO1xuXG52YXIgcHJvdG8gPSBHM1dPYmplY3QucHJvdG90eXBlO1xuXG4vKipcbiAqIEluc2VyaXNjZSB1biBsaXN0ZW5lciBkb3BvIGNoZSDDqCBzdGF0byBlc2VndWl0byBpbCBzZXR0ZXJcbiAqIEBwYXJhbSB7c3RyaW5nfSBzZXR0ZXIgLSBJbCBub21lIGRlbCBtZXRvZG8gc3UgY3VpIHNpIGN1b2xlIHJlZ2lzdHJhcmUgdW5hIGZ1bnppb25lIGxpc3RlbmVyXG4gKiBAcGFyYW0ge2Z1bmN0aW9ufSBsaXN0ZW5lciAtIFVuYSBmdW56aW9uZSBsaXN0ZW5lciAoc29sbyBzaW5jcm9uYSlcbiAqL1xucHJvdG8ub25hZnRlciA9IGZ1bmN0aW9uKHNldHRlcixsaXN0ZW5lcil7XG4gIHJldHVybiB0aGlzLl9vbnNldHRlcignYWZ0ZXInLHNldHRlcixsaXN0ZW5lcixmYWxzZSk7XG59O1xuXG4vLyB1biBsaXN0ZW5lciBwdcOyIHJlZ2lzdHJhcnNpIGluIG1vZG8gZGEgZXNzZXJlIGVzZWd1aXRvIFBSSU1BIGRlbGwnZXNlY3V6aW9uZSBkZWwgbWV0b2RvIHNldHRlci4gUHXDsiByaXRvcm5hcmUgdHJ1ZS9mYWxzZSBwZXJcbi8vIHZvdGFyZSBhIGZhdm9yZSBvIG1lbm8gZGVsbCdlc2VjdXppb25lIGRlbCBzZXR0ZXIuIFNlIG5vbiByaXRvcm5hIG51bGxhIG8gdW5kZWZpbmVkLCBub24gdmllbmUgY29uc2lkZXJhdG8gdm90YW50ZVxuLyoqXG4gKiBJbnNlcmlzY2UgdW4gbGlzdGVuZXIgcHJpbWEgY2hlIHZlbmdhIGVzZWd1aXRvIGlsIHNldHRlci4gU2Ugcml0b3JuYSBmYWxzZSBpbCBzZXR0ZXIgbm9uIHZpZW5lIGVzZWd1aXRvXG4gKiBAcGFyYW0ge3N0cmluZ30gc2V0dGVyIC0gSWwgbm9tZSBkZWwgbWV0b2RvIHN1IGN1aSBzaSBjdW9sZSByZWdpc3RyYXJlIHVuYSBmdW56aW9uZSBsaXN0ZW5lclxuICogQHBhcmFtIHtmdW5jdGlvbn0gbGlzdGVuZXIgLSBVbmEgZnVuemlvbmUgbGlzdGVuZXIsIGEgY3VpIHZpZW5lIHBhc3NhdG8gdW5hIGZ1bnppb25lIFwibmV4dFwiIGNvbWUgdWx0aW1vIHBhcmFtZXRybywgZGEgdXNhcmUgbmVsIGNhc28gZGkgbGlzdGVuZXIgYXNpbmNyb25pXG4gKi9cbnByb3RvLm9uYmVmb3JlID0gZnVuY3Rpb24oc2V0dGVyLGxpc3RlbmVyKXtcbiAgcmV0dXJuIHRoaXMuX29uc2V0dGVyKCdiZWZvcmUnLHNldHRlcixsaXN0ZW5lcixmYWxzZSk7XG59O1xuXG4vKipcbiAqIEluc2VyaXNjZSB1biBsaXN0ZW5lciBwcmltYSBjaGUgdmVuZ2EgZXNlZ3VpdG8gaWwgc2V0dGVyLiBBbCBsaXN0ZW5lciB2aWVuZSBwYXNzYXRvIHVuYSBmdW56aW9uZSBcIm5leHRcIiBjb21lIHVsdGltbyBwYXJhbWV0cm8sIGRhIGNoaWFtYXJlIGNvbiBwYXJhbWV0cm8gdHJ1ZS9mYWxzZSBwZXIgZmFyIHByb3NlZ3VpcmUgbyBtZW5vIGlsIHNldHRlclxuICogQHBhcmFtIHtzdHJpbmd9IHNldHRlciAtIElsIG5vbWUgZGVsIG1ldG9kbyBzdSBjdWkgc2kgY3VvbGUgcmVnaXN0cmFyZSB1bmEgZnVuemlvbmUgbGlzdGVuZXJcbiAqIEBwYXJhbSB7ZnVuY3Rpb259IGxpc3RlbmVyIC0gVW5hIGZ1bnppb25lIGxpc3RlbmVyLCBhIGN1aSBcbiAqL1xucHJvdG8ub25iZWZvcmVhc3luYyA9IGZ1bmN0aW9uKHNldHRlcixsaXN0ZW5lcil7XG4gIHJldHVybiB0aGlzLl9vbnNldHRlcignYmVmb3JlJyxzZXR0ZXIsbGlzdGVuZXIsdHJ1ZSk7XG59O1xuXG5wcm90by51biA9IGZ1bmN0aW9uKHNldHRlcixrZXkpe1xuICBfLmZvckVhY2godGhpcy5zZXR0ZXJzTGlzdGVuZXJzLGZ1bmN0aW9uKHNldHRlcnNMaXN0ZW5lcnMsd2hlbil7XG4gICAgXy5mb3JFYWNoKHNldHRlcnNMaXN0ZW5lcnNbc2V0dGVyXSxmdW5jdGlvbihzZXR0ZXJMaXN0ZW5lcil7XG4gICAgICBpZihzZXR0ZXJMaXN0ZW5lci5rZXkgPT0ga2V5KXtcbiAgICAgICAgZGVsZXRlIHNldHRlckxpc3RlbmVyO1xuICAgICAgfVxuICAgIH0pXG4gIH0pXG59O1xuXG5wcm90by5fb25zZXR0ZXIgPSBmdW5jdGlvbih3aGVuLHNldHRlcixsaXN0ZW5lcixhc3luYyl7IC8qd2hlbj1iZWZvcmV8YWZ0ZXIsIHR5cGU9c3luY3xhc3luYyovXG4gIHZhciBzZXR0ZXJzTGlzdGVuZXJzID0gdGhpcy5zZXR0ZXJzTGlzdGVuZXJzW3doZW5dO1xuICB2YXIgbGlzdGVuZXJLZXkgPSBcIlwiK01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSoxMDAwMDAwKStcIlwiK0RhdGUubm93KCk7XG4gIC8qaWYgKCh3aGVuID09ICdiZWZvcmUnKSAmJiAhYXN5bmMpe1xuICAgIGxpc3RlbmVyID0gdGhpcy5fbWFrZUNoYWluYWJsZShsaXN0ZW5lcik7XG4gIH0qL1xuICBzZXR0ZXJzTGlzdGVuZXJzW3NldHRlcl0ucHVzaCh7XG4gICAga2V5OiBsaXN0ZW5lcktleSxcbiAgICBmbmM6IGxpc3RlbmVyLFxuICAgIGFzeW5jOiBhc3luY1xuICB9KTtcbiAgcmV0dXJuIGxpc3RlbmVyS2V5O1xuICAvL3JldHVybiB0aGlzLmdlbmVyYXRlVW5MaXN0ZW5lcihzZXR0ZXIsbGlzdGVuZXJLZXkpO1xufTtcblxuLy8gdHJhc2Zvcm1vIHVuIGxpc3RlbmVyIHNpbmNyb25vIGluIG1vZG8gZGEgcG90ZXIgZXNzZXJlIHVzYXRvIG5lbGxhIGNhdGVuYSBkaSBsaXN0ZW5lcnMgKHJpY2hpYW1hbmRvIG5leHQgY29sIHZhbG9yZSBkaSByaXRvcm5vIGRlbCBsaXN0ZW5lcilcbi8qcHJvdG8uX21ha2VDaGFpbmFibGUgPSBmdW5jdGlvbihsaXN0ZW5lcil7XG4gIHZhciBzZWxmID0gdGhpc1xuICByZXR1cm4gZnVuY3Rpb24oKXtcbiAgICB2YXIgYXJncyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cyk7XG4gICAgLy8gcmltdW92byBuZXh0IGRhaSBwYXJhbWV0cmkgcHJpbWEgZGkgY2hpYW1hcmUgaWwgbGlzdGVuZXJcbiAgICB2YXIgbmV4dCA9IGFyZ3MucG9wKCk7XG4gICAgdmFyIGNhblNldCA9IGxpc3RlbmVyLmFwcGx5KHNlbGYsYXJndW1lbnRzKTtcbiAgICB2YXIgX2NhblNldCA9IHRydWU7XG4gICAgaWYgKF8uaXNCb29sZWFuKGNhblNldCkpe1xuICAgICAgX2NhblNldCA9IGNhblNldDtcbiAgICB9XG4gICAgbmV4dChjYW5TZXQpO1xuICB9XG59OyovXG5cbnByb3RvLl9zZXR1cExpc3RlbmVyc0NoYWluID0gZnVuY3Rpb24oc2V0dGVycyl7XG4gIC8vIGluaXppYWxpenphIHR1dHRpIGkgbWV0b2RpIGRlZmluaXRpIG5lbGwnb2dnZXR0byBcInNldHRlcnNcIiBkZWxsYSBjbGFzc2UgZmlnbGlhLlxuICB2YXIgc2VsZiA9IHRoaXM7XG4gIHRoaXMuc2V0dGVyc0xpc3RlbmVycyA9IHtcbiAgICBhZnRlcjp7fSxcbiAgICBiZWZvcmU6e31cbiAgfTtcbiAgLy8gcGVyIG9nbmkgc2V0dGVyIHZpZW5lIGRlZmluaXRvIGwnYXJyYXkgZGVpIGxpc3RlbmVycyBlIGZpZW5lIHNvc3RpdHVpdG8gaWwgbWV0b2RvIG9yaWdpbmFsZSBjb24gbGEgZnVuemlvbmkgY2hlIGdlc3Rpc2NlIGxhIGNvZGEgZGkgbGlzdGVuZXJzXG4gIF8uZm9yRWFjaChzZXR0ZXJzLGZ1bmN0aW9uKHNldHRlck9wdGlvbixzZXR0ZXIpe1xuICAgIHZhciBzZXR0ZXJGbmMgPSBub29wO1xuICAgIHZhciBzZXR0ZXJGYWxsYmFjayA9IG5vb3A7XG4gICAgaWYgKF8uaXNGdW5jdGlvbihzZXR0ZXJPcHRpb24pKXtcbiAgICAgIHNldHRlckZuYyA9IHNldHRlck9wdGlvblxuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIHNldHRlckZuYyA9IHNldHRlck9wdGlvbi5mbmM7XG4gICAgICBzZXR0ZXJGYWxsYmFjayA9IHNldHRlck9wdGlvbi5mYWxsYmFjayB8fCBub29wO1xuICAgIH1cbiAgICBzZWxmLnNldHRlcnNMaXN0ZW5lcnMuYWZ0ZXJbc2V0dGVyXSA9IFtdO1xuICAgIHNlbGYuc2V0dGVyc0xpc3RlbmVycy5iZWZvcmVbc2V0dGVyXSA9IFtdO1xuICAgIC8vIHNldHRlciBzb3N0aXR1aXRvXG4gICAgc2VsZltzZXR0ZXJdID0gZnVuY3Rpb24oKXtcbiAgICAgIHZhciBhcmdzID0gYXJndW1lbnRzO1xuICAgICAgLy8gZXNlZ3VvIGkgbGlzdGVuZXIgcmVnaXN0cmF0aSBwZXIgaWwgYmVmb3JlXG4gICAgICB2YXIgZGVmZXJyZWQgPSAkLkRlZmVycmVkKCk7XG4gICAgICB2YXIgcmV0dXJuVmFsID0gbnVsbDtcbiAgICAgIHZhciBjb3VudGVyID0gMDtcbiAgICAgIHZhciBjYW5TZXQgPSB0cnVlO1xuICAgICAgXG4gICAgICAvLyByaWNoaWFtYXRhIGFsbGEgZmluZSBkZWxsYSBjYXRlbmEgZGkgbGlzdGVuZXJzXG4gICAgICBmdW5jdGlvbiBkb25lKCl7XG4gICAgICAgIGlmKGNhblNldCl7XG4gICAgICAgICAgLy8gZXNlZ3VvIGxhIGZ1bnppb25lXG4gICAgICAgICAgcmV0dXJuVmFsID0gc2V0dGVyRm5jLmFwcGx5KHNlbGYsYXJncyk7XG4gICAgICAgICAgLy8gZSByaXNvbHZvIGxhIHByb21lc3NhIChldmVudHVhbG1lbnRlIHV0aWxpenphdGEgZGEgY2hpIGhhIGludm9jYXRvIGlsIHNldHRlclxuICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmV0dXJuVmFsKTtcbiAgICAgICAgICBcbiAgICAgICAgICB2YXIgYWZ0ZXJMaXN0ZW5lcnMgPSBzZWxmLnNldHRlcnNMaXN0ZW5lcnMuYWZ0ZXJbc2V0dGVyXTtcbiAgICAgICAgICBfLmZvckVhY2goYWZ0ZXJMaXN0ZW5lcnMsZnVuY3Rpb24obGlzdGVuZXIsIGtleSl7XG4gICAgICAgICAgICBsaXN0ZW5lci5mbmMuYXBwbHkoc2VsZixhcmdzKTtcbiAgICAgICAgICB9KVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgIC8vIHNlIG5vbiBwb3NzbyBwcm9zZWd1aXJlIFxuICAgICAgICAgIC8vIGNoaWFtbyBsJ2V2ZW50dWFsZSBmdW56aW9uZSBkaSBmYWxsYmFja1xuICAgICAgICAgIHNldHRlckZhbGxiYWNrLmFwcGx5KHNlbGYsYXJncyk7XG4gICAgICAgICAgLy8gZSByaWdldHRvIGxhIHByb21lc3NhXG4gICAgICAgICAgZGVmZXJyZWQucmVqZWN0KCk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICBcbiAgICAgIGZ1bmN0aW9uIGNvbXBsZXRlKCl7XG4gICAgICAgIC8vIGVzZWd1byBsYSBmdW56aW9uZVxuICAgICAgICByZXR1cm5WYWwgPSBzZXR0ZXJGbmMuYXBwbHkoc2VsZixhcmdzKTtcbiAgICAgICAgLy8gZSByaXNvbHZvIGxhIHByb21lc3NhIChldmVudHVhbG1lbnRlIHV0aWxpenphdGEgZGEgY2hpIGhhIGludm9jYXRvIGlsIHNldHRlclxuICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJldHVyblZhbCk7XG4gICAgICAgIFxuICAgICAgICB2YXIgYWZ0ZXJMaXN0ZW5lcnMgPSBzZWxmLnNldHRlcnNMaXN0ZW5lcnMuYWZ0ZXJbc2V0dGVyXTtcbiAgICAgICAgXy5mb3JFYWNoKGFmdGVyTGlzdGVuZXJzLGZ1bmN0aW9uKGxpc3RlbmVyLCBrZXkpe1xuICAgICAgICAgIGxpc3RlbmVyLmZuYy5hcHBseShzZWxmLGFyZ3MpO1xuICAgICAgICB9KVxuICAgICAgfVxuICAgICAgXG4gICAgICBmdW5jdGlvbiBhYm9ydCgpe1xuICAgICAgICAgIC8vIHNlIG5vbiBwb3NzbyBwcm9zZWd1aXJlIC4uLlxuICAgICAgICAgIC8vIGNoaWFtbyBsJ2V2ZW50dWFsZSBmdW56aW9uZSBkaSBmYWxsYmFja1xuICAgICAgICAgIHNldHRlckZhbGxiYWNrLmFwcGx5KHNlbGYsYXJncyk7XG4gICAgICAgICAgLy8gZSByaWdldHRvIGxhIHByb21lc3NhXG4gICAgICAgICAgZGVmZXJyZWQucmVqZWN0KCk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIHZhciBiZWZvcmVMaXN0ZW5lcnMgPSB0aGlzLnNldHRlcnNMaXN0ZW5lcnNbJ2JlZm9yZSddW3NldHRlcl07XG4gICAgICAvLyBjb250YXRvcmUgZGVpIGxpc3RlbmVyIGNoZSB2ZXJyw6AgZGVjcmVtZW50YXRvIGFkIG9nbmkgY2hpYW1hdGEgYSBuZXh0KClcbiAgICAgIGNvdW50ZXIgPSAwO1xuICAgICAgXG4gICAgICAvLyBmdW56aW9uZSBwYXNzYXRhIGNvbWUgdWx0aW1vIHBhcmFtZXRybyBhaSBsaXN0ZW5lcnMsIGNoZSAqKipTRSBTT05PIFNUQVRJIEFHR0lVTlRJIENPTUUgQVNJTkNST05JIGxhIERFVk9OTyoqKiByaWNoaWFtYXJlIHBlciBwb3RlciBwcm9zZWd1aXJlIGxhIGNhdGVuYVxuICAgICAgZnVuY3Rpb24gbmV4dChib29sKXtcbiAgICAgICAgdmFyIGNvbnQgPSB0cnVlO1xuICAgICAgICBpZiAoXy5pc0Jvb2xlYW4oYm9vbCkpe1xuICAgICAgICAgIGNvbnQgPSBib29sO1xuICAgICAgICB9XG4gICAgICAgIHZhciBfYXJncyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3MpO1xuICAgICAgICAvLyBzZSBsYSBjYXRlbmEgw6ggc3RhdGEgYmxvY2NhdGEgbyBzZSBzaWFtbyBhcnJpdmF0aSBhbGxhIGZpbmUgZGVpIGJlZm9yZWxpc3RlbmVyc1xuICAgICAgICBpZiAoY29udCA9PT0gZmFsc2UgfHwgKGNvdW50ZXIgPT0gYmVmb3JlTGlzdGVuZXJzLmxlbmd0aCkpe1xuICAgICAgICAgIGlmKGNvbnQgPT09IGZhbHNlKVxuICAgICAgICAgICAgYWJvcnQuYXBwbHkoc2VsZixhcmdzKTtcbiAgICAgICAgICBlbHNle1xuICAgICAgICAgICAgY29tcGxldGVkID0gY29tcGxldGUuYXBwbHkoc2VsZixhcmdzKTtcbiAgICAgICAgICAgIGlmKF8uaXNVbmRlZmluZWQoY29tcGxldGVkKSB8fCBjb21wbGV0ZWQgPT09IHRydWUpe1xuICAgICAgICAgICAgICBzZWxmLmVtaXRFdmVudCgnc2V0Oicrc2V0dGVyLGFyZ3MpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICBpZiAoY29udCl7XG4gICAgICAgICAgICB2YXIgbGlzdGVuZXJGbmMgPSBiZWZvcmVMaXN0ZW5lcnNbY291bnRlcl0uZm5jO1xuICAgICAgICAgICAgaWYgKGJlZm9yZUxpc3RlbmVyc1tjb3VudGVyXS5hc3luYyl7XG4gICAgICAgICAgICAgIC8vIGFnZ2l1bmdvIG5leHQgY29tZSB1bGl0bW8gcGFyYW1ldHJvXG4gICAgICAgICAgICAgIF9hcmdzLnB1c2gobmV4dCk7XG4gICAgICAgICAgICAgIGNvdW50ZXIgKz0gMTtcbiAgICAgICAgICAgICAgbGlzdGVuZXJGbmMuYXBwbHkoc2VsZixfYXJncylcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICB2YXIgX2NvbnQgPSBsaXN0ZW5lckZuYy5hcHBseShzZWxmLF9hcmdzKTtcbiAgICAgICAgICAgICAgY291bnRlciArPSAxO1xuICAgICAgICAgICAgICBuZXh0KF9jb250KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIFxuICAgICAgbmV4dCgpO1xuICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2UoKTtcbiAgICB9XG4gIH0pXG59O1xuXG4vKlxucHJvdG8uZ2VuZXJhdGVVbkxpc3RlbmVyID0gZnVuY3Rpb24oc2V0dGVyc0xpc3RlbmVycyxzZXR0ZXIsbGlzdGVuZXJLZXkpe1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIHJldHVybiBmdW5jdGlvbigpe1xuICAgIHNldHRlcnNMaXN0ZW5lcnNbc2V0dGVyXVtsaXN0ZW5lcktleV0gPSBudWxsO1xuICAgIGRlbGV0ZSBzZXR0ZXJzTGlzdGVuZXJzW3NldHRlcl1bbGlzdGVuZXJLZXldO1xuICB9XG59O1xuKi9cblxubW9kdWxlLmV4cG9ydHMgPSBHM1dPYmplY3Q7XG4iLCJ2YXIgZ2VvbSA9IHtcbiAgZGlzdGFuY2U6IGZ1bmN0aW9uKGMxLGMyKXtcbiAgICByZXR1cm4gTWF0aC5zcXJ0KGdlb20uc3F1YXJlZERpc3RhbmNlKGMxLGMyKSk7XG4gIH0sXG4gIHNxdWFyZWREaXN0YW5jZTogZnVuY3Rpb24oYzEsYzIpe1xuICAgIHZhciB4MSA9IGMxWzBdO1xuICAgIHZhciB5MSA9IGMxWzFdO1xuICAgIHZhciB4MiA9IGMyWzBdO1xuICAgIHZhciB5MiA9IGMyWzFdO1xuICAgIHZhciBkeCA9IHgyIC0geDE7XG4gICAgdmFyIGR5ID0geTIgLSB5MTtcbiAgICByZXR1cm4gZHggKiBkeCArIGR5ICogZHk7XG4gIH0sXG4gIGNsb3Nlc3RPblNlZ21lbnQ6IGZ1bmN0aW9uKGNvb3JkaW5hdGUsIHNlZ21lbnQpIHtcbiAgICB2YXIgeDAgPSBjb29yZGluYXRlWzBdO1xuICAgIHZhciB5MCA9IGNvb3JkaW5hdGVbMV07XG4gICAgdmFyIHN0YXJ0ID0gc2VnbWVudFswXTtcbiAgICB2YXIgZW5kID0gc2VnbWVudFsxXTtcbiAgICB2YXIgeDEgPSBzdGFydFswXTtcbiAgICB2YXIgeTEgPSBzdGFydFsxXTtcbiAgICB2YXIgeDIgPSBlbmRbMF07XG4gICAgdmFyIHkyID0gZW5kWzFdO1xuICAgIHZhciBkeCA9IHgyIC0geDE7XG4gICAgdmFyIGR5ID0geTIgLSB5MTtcbiAgICB2YXIgYWxvbmcgPSAoZHggPT09IDAgJiYgZHkgPT09IDApID8gMCA6XG4gICAgICAgICgoZHggKiAoeDAgLSB4MSkpICsgKGR5ICogKHkwIC0geTEpKSkgLyAoKGR4ICogZHggKyBkeSAqIGR5KSB8fCAwKTtcbiAgICB2YXIgeCwgeTtcbiAgICBpZiAoYWxvbmcgPD0gMCkge1xuICAgICAgeCA9IHgxO1xuICAgICAgeSA9IHkxO1xuICAgIH0gZWxzZSBpZiAoYWxvbmcgPj0gMSkge1xuICAgICAgeCA9IHgyO1xuICAgICAgeSA9IHkyO1xuICAgIH0gZWxzZSB7XG4gICAgICB4ID0geDEgKyBhbG9uZyAqIGR4O1xuICAgICAgeSA9IHkxICsgYWxvbmcgKiBkeTtcbiAgICB9XG4gICAgcmV0dXJuIFt4LCB5XTtcbiAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IGdlb207XG4iLCJ2YXIgR2VvbWV0cnkgPSB7fTtcblxuR2VvbWV0cnkuR2VvbWV0cnlUeXBlcyA9IHtcbiAgUE9JTlQ6IFwiUG9pbnRcIixcbiAgTVVMVElQT0lOVDogXCJNdWx0aVBvaW50XCIsXG4gIExJTkVTVFJJTkc6IFwiTGluZVwiLCAvLyBwZXIgc2VndWlyZSBsYSBkZWZpbml6aW9uZSBkaSBRR2lzLkdlb21ldHJ5VHlwZSwgY2hlIGRlZmluaXNjZSBMaW5lIGludmVjZSBkaSBMaW5lc3RyaW5nLlxuICBNVUxUSUxJTkVTVFJJTkc6IFwiTXVsdGlMaW5lXCIsXG4gIFBPTFlHT046IFwiUG9seWdvblwiLFxuICBNVUxUSVBPTFlHT046IFwiTXVsdGlQb2x5Z29uXCIsXG4gIEdFT01FVFJZQ09MTEVDVElPTjogXCJHZW9tZXRyeUNvbGxlY3Rpb25cIlxufTtcblxuR2VvbWV0cnkuU3VwcG9ydGVkR2VvbWV0cnlUeXBlcyA9IFtcbiAgR2VvbWV0cnkuR2VvbWV0cnlUeXBlcy5QT0lOVCxcbiAgR2VvbWV0cnkuR2VvbWV0cnlUeXBlcy5NVUxUSVBPSU5ULFxuICBHZW9tZXRyeS5HZW9tZXRyeVR5cGVzLkxJTkVTVFJJTkcsXG4gIEdlb21ldHJ5Lkdlb21ldHJ5VHlwZXMuTVVMVElMSU5FU1RSSU5HLFxuICBHZW9tZXRyeS5HZW9tZXRyeVR5cGVzLlBPTFlHT04sXG4gIEdlb21ldHJ5Lkdlb21ldHJ5VHlwZXMuTVVMVElQT0xZR09OXG5dXG5cbm1vZHVsZS5leHBvcnRzID0gR2VvbWV0cnk7XG4iLCJmdW5jdGlvbiBpbml0KGNvbmZpZykge1xuICBpMThuZXh0XG4gIC51c2UoaTE4bmV4dFhIUkJhY2tlbmQpXG4gIC5pbml0KHsgXG4gICAgICBsbmc6ICdpdCcsXG4gICAgICBuczogJ2FwcCcsXG4gICAgICBmYWxsYmFja0xuZzogJ2l0JyxcbiAgICAgIHJlc291cmNlczogY29uZmlnLnJlc291cmNlc1xuICB9KTtcbiAgXG4gIGpxdWVyeUkxOG5leHQuaW5pdChpMThuZXh0LCAkLCB7XG4gICAgdE5hbWU6ICd0JywgLy8gLS0+IGFwcGVuZHMgJC50ID0gaTE4bmV4dC50XG4gICAgaTE4bk5hbWU6ICdpMThuJywgLy8gLS0+IGFwcGVuZHMgJC5pMThuID0gaTE4bmV4dFxuICAgIGhhbmRsZU5hbWU6ICdsb2NhbGl6ZScsIC8vIC0tPiBhcHBlbmRzICQoc2VsZWN0b3IpLmxvY2FsaXplKG9wdHMpO1xuICAgIHNlbGVjdG9yQXR0cjogJ2RhdGEtaTE4bicsIC8vIHNlbGVjdG9yIGZvciB0cmFuc2xhdGluZyBlbGVtZW50c1xuICAgIHRhcmdldEF0dHI6ICdkYXRhLWkxOG4tdGFyZ2V0JywgLy8gZWxlbWVudCBhdHRyaWJ1dGUgdG8gZ3JhYiB0YXJnZXQgZWxlbWVudCB0byB0cmFuc2xhdGUgKGlmIGRpZmZyZW50IHRoZW4gaXRzZWxmKVxuICAgIG9wdGlvbnNBdHRyOiAnZGF0YS1pMThuLW9wdGlvbnMnLCAvLyBlbGVtZW50IGF0dHJpYnV0ZSB0aGF0IGNvbnRhaW5zIG9wdGlvbnMsIHdpbGwgbG9hZC9zZXQgaWYgdXNlT3B0aW9uc0F0dHIgPSB0cnVlXG4gICAgdXNlT3B0aW9uc0F0dHI6IGZhbHNlLCAvLyBzZWUgb3B0aW9uc0F0dHJcbiAgICBwYXJzZURlZmF1bHRWYWx1ZUZyb21Db250ZW50OiB0cnVlIC8vIHBhcnNlcyBkZWZhdWx0IHZhbHVlcyBmcm9tIGNvbnRlbnQgZWxlLnZhbCBvciBlbGUudGV4dFxuICB9KTtcbn1cbiAgICBcbnZhciB0ID0gZnVuY3Rpb24odGV4dCl7XG4gICAgdmFyIHRyYWQgPSBpMThuZXh0LnQodGV4dCk7XG4gICAgcmV0dXJuIHRyYWQ7XG59O1xuICAgIFxubW9kdWxlLmV4cG9ydHMgPSB7XG4gIGluaXQ6IGluaXQsXG4gIHQ6IHRcbn1cbiIsInZhciBQaWNrQ29vcmRpbmF0ZXNFdmVudFR5cGUgPSB7XG4gIFBJQ0tFRDogJ3BpY2tlZCdcbn07XG5cbnZhciBQaWNrQ29vcmRpbmF0ZXNFdmVudCA9IGZ1bmN0aW9uKHR5cGUsIGNvb3JkaW5hdGUpIHtcbiAgdGhpcy50eXBlID0gdHlwZTtcbiAgdGhpcy5jb29yZGluYXRlID0gY29vcmRpbmF0ZTtcbn07XG5cbnZhciBQaWNrQ29vcmRpbmF0ZXNJbnRlcmFjdGlvbiA9IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgdGhpcy5wcmV2aW91c0N1cnNvcl8gPSBudWxsO1xuICBcbiAgb2wuaW50ZXJhY3Rpb24uUG9pbnRlci5jYWxsKHRoaXMsIHtcbiAgICBoYW5kbGVEb3duRXZlbnQ6IFBpY2tDb29yZGluYXRlc0ludGVyYWN0aW9uLmhhbmRsZURvd25FdmVudF8sXG4gICAgaGFuZGxlVXBFdmVudDogUGlja0Nvb3JkaW5hdGVzSW50ZXJhY3Rpb24uaGFuZGxlVXBFdmVudF8sXG4gICAgaGFuZGxlTW92ZUV2ZW50OiBQaWNrQ29vcmRpbmF0ZXNJbnRlcmFjdGlvbi5oYW5kbGVNb3ZlRXZlbnRfLFxuICB9KTtcbn07XG5vbC5pbmhlcml0cyhQaWNrQ29vcmRpbmF0ZXNJbnRlcmFjdGlvbiwgb2wuaW50ZXJhY3Rpb24uUG9pbnRlcik7XG5cblBpY2tDb29yZGluYXRlc0ludGVyYWN0aW9uLmhhbmRsZURvd25FdmVudF8gPSBmdW5jdGlvbihldmVudCkge1xuICByZXR1cm4gdHJ1ZTtcbn07XG5cblBpY2tDb29yZGluYXRlc0ludGVyYWN0aW9uLmhhbmRsZVVwRXZlbnRfID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgdGhpcy5kaXNwYXRjaEV2ZW50KFxuICAgICAgICAgIG5ldyBQaWNrQ29vcmRpbmF0ZXNFdmVudChcbiAgICAgICAgICAgICAgUGlja0Nvb3JkaW5hdGVzRXZlbnRUeXBlLlBJQ0tFRCxcbiAgICAgICAgICAgICAgZXZlbnQuY29vcmRpbmF0ZSkpO1xuICByZXR1cm4gdHJ1ZTtcbn07XG5cblBpY2tDb29yZGluYXRlc0ludGVyYWN0aW9uLmhhbmRsZU1vdmVFdmVudF8gPSBmdW5jdGlvbihldmVudCkge1xuICB2YXIgZWxlbSA9IGV2ZW50Lm1hcC5nZXRUYXJnZXRFbGVtZW50KCk7XG4gIGVsZW0uc3R5bGUuY3Vyc29yID0gICdwb2ludGVyJztcbn07XG5cblBpY2tDb29yZGluYXRlc0ludGVyYWN0aW9uLnByb3RvdHlwZS5zaG91bGRTdG9wRXZlbnQgPSBmdW5jdGlvbigpe1xuICByZXR1cm4gZmFsc2U7XG59O1xuXG5QaWNrQ29vcmRpbmF0ZXNJbnRlcmFjdGlvbi5wcm90b3R5cGUuc2V0TWFwID0gZnVuY3Rpb24obWFwKXtcbiAgaWYgKCFtYXApIHtcbiAgICB2YXIgZWxlbSA9IHRoaXMuZ2V0TWFwKCkuZ2V0VGFyZ2V0RWxlbWVudCgpO1xuICAgIGVsZW0uc3R5bGUuY3Vyc29yID0gJyc7XG4gIH1cbiAgb2wuaW50ZXJhY3Rpb24uUG9pbnRlci5wcm90b3R5cGUuc2V0TWFwLmNhbGwodGhpcyxtYXApO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBQaWNrQ29vcmRpbmF0ZXNJbnRlcmFjdGlvbjtcbiIsInZhciBQaWNrRmVhdHVyZUV2ZW50VHlwZSA9IHtcbiAgUElDS0VEOiAncGlja2VkJ1xufTtcblxudmFyIFBpY2tGZWF0dXJlRXZlbnQgPSBmdW5jdGlvbih0eXBlLCBjb29yZGluYXRlLCBmZWF0dXJlKSB7XG4gIHRoaXMudHlwZSA9IHR5cGU7XG4gIHRoaXMuZmVhdHVyZSA9IGZlYXR1cmU7XG4gIHRoaXMuY29vcmRpbmF0ZSA9IGNvb3JkaW5hdGU7XG59O1xuXG5cblxudmFyIFBpY2tGZWF0dXJlSW50ZXJhY3Rpb24gPSBmdW5jdGlvbihvcHRpb25zKSB7XG4gIG9sLmludGVyYWN0aW9uLlBvaW50ZXIuY2FsbCh0aGlzLCB7XG4gICAgaGFuZGxlRG93bkV2ZW50OiBQaWNrRmVhdHVyZUludGVyYWN0aW9uLmhhbmRsZURvd25FdmVudF8sXG4gICAgaGFuZGxlVXBFdmVudDogUGlja0ZlYXR1cmVJbnRlcmFjdGlvbi5oYW5kbGVVcEV2ZW50XyxcbiAgICBoYW5kbGVNb3ZlRXZlbnQ6IFBpY2tGZWF0dXJlSW50ZXJhY3Rpb24uaGFuZGxlTW92ZUV2ZW50XyxcbiAgfSk7XG4gIFxuICB0aGlzLmZlYXR1cmVzXyA9IG9wdGlvbnMuZmVhdHVyZXMgfHwgbnVsbDtcbiAgXG4gIHRoaXMubGF5ZXJzXyA9IG9wdGlvbnMubGF5ZXJzIHx8IG51bGw7XG4gIFxuICB0aGlzLnBpY2tlZEZlYXR1cmVfID0gbnVsbDtcbiAgXG4gIHZhciBzZWxmID0gdGhpcztcbiAgdGhpcy5sYXllckZpbHRlcl8gPSBmdW5jdGlvbihsYXllcikge1xuICAgIHJldHVybiBfLmluY2x1ZGVzKHNlbGYubGF5ZXJzXywgbGF5ZXIpO1xuICB9O1xufTtcbm9sLmluaGVyaXRzKFBpY2tGZWF0dXJlSW50ZXJhY3Rpb24sIG9sLmludGVyYWN0aW9uLlBvaW50ZXIpO1xuXG5QaWNrRmVhdHVyZUludGVyYWN0aW9uLmhhbmRsZURvd25FdmVudF8gPSBmdW5jdGlvbihldmVudCkge1xuICB0aGlzLnBpY2tlZEZlYXR1cmVfID0gdGhpcy5mZWF0dXJlc0F0UGl4ZWxfKGV2ZW50LnBpeGVsLCBldmVudC5tYXApO1xuICByZXR1cm4gdHJ1ZTtcbn07XG5cblBpY2tGZWF0dXJlSW50ZXJhY3Rpb24uaGFuZGxlVXBFdmVudF8gPSBmdW5jdGlvbihldmVudCkge1xuICBpZih0aGlzLnBpY2tlZEZlYXR1cmVfKXtcbiAgICB0aGlzLmRpc3BhdGNoRXZlbnQoXG4gICAgICAgICAgICBuZXcgUGlja0ZlYXR1cmVFdmVudChcbiAgICAgICAgICAgICAgICBQaWNrRmVhdHVyZUV2ZW50VHlwZS5QSUNLRUQsXG4gICAgICAgICAgICAgICAgZXZlbnQuY29vcmRpbmF0ZSxcbiAgICAgICAgICAgICAgICB0aGlzLnBpY2tlZEZlYXR1cmVfKSk7XG4gIH1cbiAgcmV0dXJuIHRydWU7XG59O1xuXG5QaWNrRmVhdHVyZUludGVyYWN0aW9uLmhhbmRsZU1vdmVFdmVudF8gPSBmdW5jdGlvbihldmVudCkge1xuICB2YXIgZWxlbSA9IGV2ZW50Lm1hcC5nZXRUYXJnZXRFbGVtZW50KCk7XG4gIHZhciBpbnRlcnNlY3RpbmdGZWF0dXJlID0gdGhpcy5mZWF0dXJlc0F0UGl4ZWxfKGV2ZW50LnBpeGVsLCBldmVudC5tYXApO1xuXG4gIGlmIChpbnRlcnNlY3RpbmdGZWF0dXJlKSB7XG4gICAgZWxlbS5zdHlsZS5jdXJzb3IgPSAgJ3BvaW50ZXInO1xuICB9IGVsc2Uge1xuICAgIGVsZW0uc3R5bGUuY3Vyc29yID0gJyc7XG4gIH1cbn07XG5cblBpY2tGZWF0dXJlSW50ZXJhY3Rpb24ucHJvdG90eXBlLmZlYXR1cmVzQXRQaXhlbF8gPSBmdW5jdGlvbihwaXhlbCwgbWFwKSB7XG4gIHZhciBmb3VuZCA9IG51bGw7XG5cbiAgdmFyIGludGVyc2VjdGluZ0ZlYXR1cmUgPSBtYXAuZm9yRWFjaEZlYXR1cmVBdFBpeGVsKHBpeGVsLFxuICAgICAgZnVuY3Rpb24oZmVhdHVyZSkge1xuICAgICAgICBpZiAodGhpcy5mZWF0dXJlc18pIHtcbiAgICAgICAgICBpZiAodGhpcy5mZWF0dXJlc18uaW5kZXhPZihmZWF0dXJlKSA+IC0xKXtcbiAgICAgICAgICAgIHJldHVybiBmZWF0dXJlXG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2V7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZlYXR1cmU7XG4gICAgICB9LHRoaXMsdGhpcy5sYXllckZpbHRlcl8pO1xuICBcbiAgaWYoaW50ZXJzZWN0aW5nRmVhdHVyZSl7XG4gICAgZm91bmQgPSBpbnRlcnNlY3RpbmdGZWF0dXJlO1xuICB9XG4gIHJldHVybiBmb3VuZDtcbn07XG5cblBpY2tGZWF0dXJlSW50ZXJhY3Rpb24ucHJvdG90eXBlLnNob3VsZFN0b3BFdmVudCA9IGZ1bmN0aW9uKCl7XG4gIHJldHVybiBmYWxzZTtcbn07XG5cblBpY2tGZWF0dXJlSW50ZXJhY3Rpb24ucHJvdG90eXBlLnNldE1hcCA9IGZ1bmN0aW9uKG1hcCl7XG4gIGlmICghbWFwKSB7XG4gICAgdmFyIGVsZW0gPSB0aGlzLmdldE1hcCgpLmdldFRhcmdldEVsZW1lbnQoKTtcbiAgICBlbGVtLnN0eWxlLmN1cnNvciA9ICcnO1xuICB9XG4gIG9sLmludGVyYWN0aW9uLlBvaW50ZXIucHJvdG90eXBlLnNldE1hcC5jYWxsKHRoaXMsbWFwKTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gUGlja0ZlYXR1cmVJbnRlcmFjdGlvbjtcbiIsInZhciBpbmhlcml0ID0gcmVxdWlyZSgnY29yZS91dGlscy91dGlscycpLmluaGVyaXQ7XG52YXIgYmFzZSA9IHJlcXVpcmUoJ2NvcmUvdXRpbHMvdXRpbHMnKS5iYXNlO1xudmFyIEczV09iamVjdCA9IHJlcXVpcmUoJ2NvcmUvZzN3b2JqZWN0Jyk7XG52YXIgR2VvbWV0cnlUeXBlcyA9IHJlcXVpcmUoJ2NvcmUvZ2VvbWV0cnkvZ2VvbWV0cnknKS5HZW9tZXRyeVR5cGVzO1xuXG52YXIgQ0FQQUJJTElUSUVTID0ge1xuICBRVUVSWTogMSxcbiAgRURJVDogMlxufTtcblxudmFyIEVESVRPUFMgPSB7XG4gIElOU0VSVDogMSxcbiAgVVBEQVRFOiAyLFxuICBERUxFVEU6IDRcbn07XG5cbkxheWVyU3RhdGUgPSB7fTtcblxuTGF5ZXJTdGF0ZS5TZXJ2ZXJUeXBlcyA9IHtcbiAgT0dDOiBcIk9HQ1wiLFxuICBRR0lTOiBcIlFHSVNcIixcbiAgTWFwc2VydmVyOiBcIk1hcHNlcnZlclwiLFxuICBHZW9zZXJ2ZXI6IFwiR2Vvc2VydmVyXCIsXG4gIEFyY0dJUzogXCJBcmNHSVNcIlxufTtcblxuTGF5ZXJTdGF0ZS5nZXRHZW9tZXRyeVR5cGUgPSBmdW5jdGlvbihsYXllclN0YXRlKSB7XG4gIHJldHVybiBsYXllclN0YXRlLmdlb21ldHJ5dHlwZTtcbn07XG5cbkxheWVyU3RhdGUuZ2V0QXR0cmlidXRlcyA9IGZ1bmN0aW9uKGxheWVyU3RhdGUpIHtcbiAgdmFyIGF0dHJpYnV0ZXMgPSBbXTtcbiAgaWYgKGxheWVyU3RhdGUuYXR0cmlidXRlcykge1xuICAgIGF0dHJpYnV0ZXMgPSBfLm1hcChsYXllclN0YXRlLmF0dHJpYnV0ZXMsZnVuY3Rpb24oYXR0cmlidXRlKSB7XG4gICAgICByZXR1cm4gYXR0cmlidXRlLm5hbWU7XG4gICAgfSlcbiAgfVxuICByZXR1cm4gYXR0cmlidXRlcztcbn07XG5cbkxheWVyU3RhdGUuaXNRdWVyeWFibGUgPSBmdW5jdGlvbihsYXllclN0YXRlKXtcbiAgdmFyIHF1ZXJ5RW5hYmxlZCA9IGZhbHNlO1xuICB2YXIgcXVlcnlhYmxlRm9yQ2FiYWJpbGl0aWVzID0gKGxheWVyU3RhdGUuY2FwYWJpbGl0aWVzICYmIChsYXllclN0YXRlLmNhcGFiaWxpdGllcyAmJiBDQVBBQklMSVRJRVMuUVVFUlkpKSA/IHRydWUgOiBmYWxzZTtcbiAgaWYgKHF1ZXJ5YWJsZUZvckNhYmFiaWxpdGllcykge1xuICAgIC8vIMOoIGludGVycm9nYWJpbGUgc2UgdmlzaWJpbGUgZSBub24gZGlzYWJpbGl0YXRvIChwZXIgc2NhbGEpIG9wcHVyZSBzZSBpbnRlcnJvZ2FiaWxlIGNvbXVucXVlIChmb3J6YXRvIGRhbGxhIHByb3ByaWV0w6AgaW5mb3doZW5ub3R2aXNpYmxlKVxuICAgIHZhciBxdWVyeUVuYWJsZWQgPSAobGF5ZXJTdGF0ZS52aXNpYmxlICYmICFsYXllclN0YXRlLmRpc2FibGVkKSB8fCAobGF5ZXJTdGF0ZS5pbmZvd2hlbm5vdHZpc2libGUgJiYgKGxheWVyU3RhdGUuaW5mb3doZW5ub3R2aXNpYmxlID09PSB0cnVlKSk7XG4gIH1cbiAgcmV0dXJuIHF1ZXJ5RW5hYmxlZDtcbn07XG5cbkxheWVyU3RhdGUuZ2V0UXVlcnlMYXllck5hbWUgPSBmdW5jdGlvbihsYXllclN0YXRlKSB7XG4gIHZhciBxdWVyeUxheWVyTmFtZTtcbiAgaWYgKGxheWVyU3RhdGUuaW5mb2xheWVyICYmIGxheWVyU3RhdGUuaW5mb2xheWVyICE9ICcnKSB7XG4gICAgcXVlcnlMYXllck5hbWUgPSBsYXllclN0YXRlLmluZm9sYXllcjtcbiAgfVxuICBlbHNlIHtcbiAgICBxdWVyeUxheWVyTmFtZSA9IGxheWVyU3RhdGUubmFtZTtcbiAgfVxuICByZXR1cm4gcXVlcnlMYXllck5hbWU7XG59O1xuXG5MYXllclN0YXRlLmdldFNlcnZlclR5cGUgPSBmdW5jdGlvbihsYXllclN0YXRlKSB7XG4gIGlmIChsYXllclN0YXRlLnNlcnZlcnR5cGUgJiYgbGF5ZXJTdGF0ZS5zZXJ2ZXJ0eXBlICE9ICcnKSB7XG4gICAgcmV0dXJuIGxheWVyU3RhdGUuc2VydmVydHlwZTtcbiAgfVxuICBlbHNlIHtcbiAgICByZXR1cm4gTGF5ZXJTdGF0ZS5TZXJ2ZXJUeXBlcy5RR0lTO1xuICB9XG59O1xuXG5MYXllclN0YXRlLmlzRXh0ZXJuYWxXTVMgPSBmdW5jdGlvbihsYXllclN0YXRlKSB7XG4gIHJldHVybiAobGF5ZXJTdGF0ZS5zb3VyY2UgJiYgbGF5ZXJTdGF0ZS5zb3VyY2UudXJsKTtcbn07XG5cbkxheWVyU3RhdGUuZ2V0V01TTGF5ZXJOYW1lID0gZnVuY3Rpb24obGF5ZXJTdGF0ZSkge1xuICB2YXIgbGF5ZXJOYW1lID0gbGF5ZXJTdGF0ZS5uYW1lO1xuICBpZiAobGF5ZXJTdGF0ZS5zb3VyY2UgJiYgbGF5ZXJTdGF0ZS5zb3VyY2UubGF5ZXJzKXtcbiAgICBsYXllck5hbWUgPSBsYXllclN0YXRlLnNvdXJjZS5sYXllcnNcbiAgfTtcbiAgcmV0dXJuIGxheWVyTmFtZTtcbn07XG5cbkxheWVyU3RhdGUuZ2V0T3JpZ2luVVJMID0gZnVuY3Rpb24obGF5ZXJTdGF0ZSkge1xuICB2YXIgdXJsO1xuICBpZiAobGF5ZXJTdGF0ZS5zb3VyY2UgJiYgbGF5ZXJTdGF0ZS5zb3VyY2UudHlwZSA9PSAnd21zJyAmJiBsYXllclN0YXRlLnNvdXJjZS51cmwpe1xuICAgIHVybCA9IGxheWVyU3RhdGUuc291cmNlLnVybFxuICB9O1xuICByZXR1cm4gdXJsO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBMYXllclN0YXRlO1xuIiwidmFyIGluaGVyaXQgPSByZXF1aXJlKCdjb3JlL3V0aWxzL3V0aWxzJykuaW5oZXJpdDtcbnZhciB0cnVlZm5jID0gcmVxdWlyZSgnY29yZS91dGlscy91dGlscycpLnRydWVmbmM7XG52YXIgcmVzb2x2ZSA9IHJlcXVpcmUoJ2NvcmUvdXRpbHMvdXRpbHMnKS5yZXNvbHZlO1xudmFyIHJlamVjdCA9IHJlcXVpcmUoJ2NvcmUvdXRpbHMvdXRpbHMnKS5yZWplY3Q7XG52YXIgRzNXT2JqZWN0ID0gcmVxdWlyZSgnY29yZS9nM3dvYmplY3QnKTtcblxuZnVuY3Rpb24gVmVjdG9yTGF5ZXIoY29uZmlnKXtcbiAgdmFyIGNvbmZpZyA9IGNvbmZpZyB8fCB7fTtcbiAgdGhpcy5nZW9tZXRyeXR5cGUgPSBjb25maWcuZ2VvbWV0cnl0eXBlIHx8IG51bGw7XG4gIHRoaXMuZm9ybWF0ID0gY29uZmlnLmZvcm1hdCB8fCBudWxsO1xuICB0aGlzLmNycyA9IGNvbmZpZy5jcnMgIHx8IG51bGw7XG4gIHRoaXMuaWQgPSBjb25maWcuaWQgfHwgbnVsbDtcbiAgdGhpcy5uYW1lID0gY29uZmlnLm5hbWUgfHwgXCJcIjtcbiAgdGhpcy5wayA9IGNvbmZpZy5wayB8fCBcImlkXCI7IC8vIFRPRE86IGlsIEdlb0pTT04gc2V0dGEgbCdpZCBkZWxsYSBmZWF0dXJlIGRhIHPDqSwgZSBuYXNjb25kZSBpbCBjYW1wbyBQSyBkYWxsZSBwcm9wZXJ0aWVzLiBJbiBhbHRyaSBmb3JtYXRpIHZhIHZlcmlmaWNhdG8sIGUgY2Fzb21haSB1c2FyZSBmZWF0dXJlLnNldElkKClcbiAgXG4gIHRoaXMuX29sU291cmNlID0gbmV3IG9sLnNvdXJjZS5WZWN0b3Ioe1xuICAgIGZlYXR1cmVzOiBuZXcgb2wuQ29sbGVjdGlvbigpXG4gIH0pO1xuICB0aGlzLl9vbExheWVyID0gbmV3IG9sLmxheWVyLlZlY3Rvcih7XG4gICAgbmFtZTogdGhpcy5uYW1lLFxuICAgIHNvdXJjZTogdGhpcy5fb2xTb3VyY2VcbiAgfSk7XG4gIFxuICAvKlxuICAgKiBBcnJheSBkaSBvZ2dldHRpOlxuICAgKiB7XG4gICAqICBuYW1lOiBOb21lIGRlbGwnYXR0cmlidXRvLFxuICAgKiAgdHlwZTogaW50ZWdlciB8IGZsb2F0IHwgc3RyaW5nIHwgYm9vbGVhbiB8IGRhdGUgfCB0aW1lIHwgZGF0ZXRpbWUsXG4gICAqICBpbnB1dDoge1xuICAgKiAgICBsYWJlbDogTm9tZSBkZWwgY2FtcG8gZGkgaW5wdXQsXG4gICAqICAgIHR5cGU6IHNlbGVjdCB8IGNoZWNrIHwgcmFkaW8gfCBjb29yZHNwaWNrZXIgfCBib3hwaWNrZXIgfCBsYXllcnBpY2tlciB8IGZpZWxkZGVwZW5kLFxuICAgKiAgICBvcHRpb25zOiB7XG4gICAqICAgICAgTGUgb3B6aW9uaSBwZXIgbG8gc3BjaWZpY28gdGlwbyBkaSBpbnB1dCAoZXMuIFwidmFsdWVzXCIgcGVyIGxhIGxpc3RhIGRpIHZhbG9yaSBkaSBzZWxlY3QsIGNoZWNrIGUgcmFkaW8pXG4gICAqICAgIH1cbiAgICogIH1cbiAgICogfVxuICAqL1xuICB0aGlzLl9QS2luQXR0cmlidXRlcyA9IGZhbHNlO1xuICB0aGlzLl9mZWF0dXJlc0ZpbHRlciA9IG51bGw7XG4gIHRoaXMuX2ZpZWxkcyA9IG51bGxcbiAgdGhpcy5sYXp5UmVsYXRpb25zID0gdHJ1ZTtcbiAgdGhpcy5fcmVsYXRpb25zID0gbnVsbDtcbn1cbmluaGVyaXQoVmVjdG9yTGF5ZXIsRzNXT2JqZWN0KTtcbm1vZHVsZS5leHBvcnRzID0gVmVjdG9yTGF5ZXI7XG5cbnZhciBwcm90byA9IFZlY3RvckxheWVyLnByb3RvdHlwZTtcblxucHJvdG8uc2V0RGF0YSA9IGZ1bmN0aW9uKGZlYXR1cmVzRGF0YSl7XG4gIHZhciBzZWxmID0gdGhpcztcbiAgdmFyIGZlYXR1cmVzO1xuICBpZiAodGhpcy5mb3JtYXQpIHtcbiAgICBzd2l0Y2ggKHRoaXMuZm9ybWF0KXtcbiAgICAgIGNhc2UgXCJHZW9KU09OXCI6XG4gICAgICAgIHZhciBnZW9qc29uID0gbmV3IG9sLmZvcm1hdC5HZW9KU09OKHtcbiAgICAgICAgICBkZWZhdWx0RGF0YVByb2plY3Rpb246IHRoaXMuY3JzLFxuICAgICAgICAgIGdlb21ldHJ5TmFtZTogXCJnZW9tZXRyeVwiXG4gICAgICAgIH0pO1xuICAgICAgICBmZWF0dXJlcyA9IGdlb2pzb24ucmVhZEZlYXR1cmVzKGZlYXR1cmVzRGF0YSk7XG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgICBcbiAgICBpZiAoZmVhdHVyZXMgJiYgZmVhdHVyZXMubGVuZ3RoKSB7XG4gICAgICBpZiAoIV8uaXNOdWxsKHRoaXMuX2ZlYXR1cmVzRmlsdGVyKSl7XG4gICAgICAgIHZhciBmZWF0dXJlcyA9IF8ubWFwKGZlYXR1cmVzLGZ1bmN0aW9uKGZlYXR1cmUpe1xuICAgICAgICAgIHJldHVybiBzZWxmLl9mZWF0dXJlc0ZpbHRlcihmZWF0dXJlKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIHZhciBhbHJlYWR5TG9hZGVkSWRzID0gdGhpcy5nZXRGZWF0dXJlSWRzKCk7XG4gICAgICB2YXIgZmVhdHVyZXNUb0xvYWQgPSBfLmZpbHRlcihmZWF0dXJlcyxmdW5jdGlvbihmZWF0dXJlKXtcbiAgICAgICAgcmV0dXJuICFfLmluY2x1ZGVzKGFscmVhZHlMb2FkZWRJZHMsZmVhdHVyZS5nZXRJZCgpKTtcbiAgICAgIH0pXG4gICAgICBcbiAgICAgIHRoaXMuX29sU291cmNlLmFkZEZlYXR1cmVzKGZlYXR1cmVzVG9Mb2FkKTtcbiAgICAgIFxuICAgICAgLy8gdmVyaWZpY28sIHByZW5kZW5kbyBsYSBwcmltYSBmZWF0dXJlLCBzZSBsYSBQSyDDqCBwcmVzZW50ZSBvIG1lbm8gdHJhIGdsaSBhdHRyaWJ1dGlcbiAgICAgIHZhciBhdHRyaWJ1dGVzID0gdGhpcy5nZXRTb3VyY2UoKS5nZXRGZWF0dXJlcygpWzBdLmdldFByb3BlcnRpZXMoKTtcbiAgICAgIHRoaXMuX1BLaW5BdHRyaWJ1dGVzID0gXy5nZXQoYXR0cmlidXRlcyx0aGlzLnBrKSA/IHRydWUgOiBmYWxzZTtcbiAgICB9XG4gIH1cbiAgZWxzZSB7XG4gICAgY29uc29sZS5sb2coXCJWZWN0b3JMYXllciBmb3JtYXQgbm90IGRlZmluZWRcIik7XG4gIH1cbn07XG5cbnByb3RvLnNldEZlYXR1cmVEYXRhID0gZnVuY3Rpb24ob2xkZmlkLGZpZCxnZW9tZXRyeSxhdHRyaWJ1dGVzKXtcbiAgdmFyIGZlYXR1cmUgPSB0aGlzLmdldEZlYXR1cmVCeUlkKG9sZGZpZCk7XG4gIGlmIChmaWQpe1xuICAgIGZlYXR1cmUuc2V0SWQoZmlkKTtcbiAgfVxuICBcbiAgaWYgKGdlb21ldHJ5KXtcbiAgICBmZWF0dXJlLnNldEdlb21ldHJ5KGdlb21ldHJ5KTtcbiAgfVxuICBcbiAgaWYgKGF0dHJpYnV0ZXMpe1xuICAgIHZhciBvbGRBdHRyaWJ1dGVzID0gZmVhdHVyZS5nZXRQcm9wZXJ0aWVzKCk7XG4gICAgdmFyIG5ld0F0dHJpYnV0ZXMgPV8uYXNzaWduKG9sZEF0dHJpYnV0ZXMsYXR0cmlidXRlcyk7XG4gICAgZmVhdHVyZS5zZXRQcm9wZXJ0aWVzKG5ld0F0dHJpYnV0ZXMpO1xuICB9XG4gIFxuICByZXR1cm4gZmVhdHVyZTtcbn07XG5cbnByb3RvLmFkZEZlYXR1cmVzID0gZnVuY3Rpb24oZmVhdHVyZXMpe1xuICB0aGlzLmdldFNvdXJjZSgpLmFkZEZlYXR1cmVzKGZlYXR1cmVzKTtcbn07XG5cbnByb3RvLnNldEZlYXR1cmVzRmlsdGVyID0gZnVuY3Rpb24oZmVhdHVyZXNGaWx0ZXIpe1xuICB0aGlzLl9mZWF0dXJlc0ZpbHRlciA9IGZlYXR1cmVzRmlsdGVyO1xufTtcblxucHJvdG8uc2V0RmllbGRzID0gZnVuY3Rpb24oZmllbGRzKXtcbiAgdGhpcy5fZmllbGRzID0gZmllbGRzO1xufTtcblxucHJvdG8uc2V0UGtGaWVsZCA9IGZ1bmN0aW9uKCl7XG4gIHZhciBzZWxmID0gdGhpcztcbiAgdmFyIHBrZmllbGRTZXQgPSBmYWxzZTtcbiAgXy5mb3JFYWNoKHRoaXMuX2ZpZWxkcyxmdW5jdGlvbihmaWVsZCl7XG4gICAgaWYgKGZpZWxkLm5hbWUgPT0gc2VsZi5wayApe1xuICAgICAgcGtmaWVsZFNldCA9IHRydWU7XG4gICAgfVxuICB9KTtcbiAgXG4gIGlmICghcGtmaWVsZFNldCl7XG4gICAgdGhpcy5fZmllbGRzXG4gIH1cbn07XG5cbnByb3RvLmdldEZlYXR1cmVzID0gZnVuY3Rpb24oKXtcbiAgcmV0dXJuIHRoaXMuZ2V0U291cmNlKCkuZ2V0RmVhdHVyZXMoKTtcbn07XG5cbnByb3RvLmdldEZlYXR1cmVJZHMgPSBmdW5jdGlvbigpe1xuICB2YXIgZmVhdHVyZUlkcyA9IF8ubWFwKHRoaXMuZ2V0U291cmNlKCkuZ2V0RmVhdHVyZXMoKSxmdW5jdGlvbihmZWF0dXJlKXtcbiAgICByZXR1cm4gZmVhdHVyZS5nZXRJZCgpO1xuICB9KVxuICByZXR1cm4gZmVhdHVyZUlkc1xufTtcblxucHJvdG8uZ2V0RmllbGRzID0gZnVuY3Rpb24oKXtcbiAgcmV0dXJuIF8uY2xvbmVEZWVwKHRoaXMuX2ZpZWxkcyk7XG59O1xuXG5wcm90by5nZXRGaWVsZHNOYW1lcyA9IGZ1bmN0aW9uKCl7XG4gIHJldHVybiBfLm1hcCh0aGlzLl9maWVsZHMsZnVuY3Rpb24oZmllbGQpe1xuICAgIHJldHVybiBmaWVsZC5uYW1lO1xuICB9KTtcbn07XG5cbnByb3RvLmdldEZpZWxkc1dpdGhBdHRyaWJ1dGVzID0gZnVuY3Rpb24ob2JqKXtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICAvKnZhciBmaWVsZHMgPSBfLmNsb25lRGVlcChfLmZpbHRlcih0aGlzLl9maWVsZHMsZnVuY3Rpb24oZmllbGQpe1xuICAgIHJldHVybiAoKGZpZWxkLm5hbWUgIT0gc2VsZi5waykgJiYgZmllbGQuZWRpdGFibGUpO1xuICB9KSk7Ki9cbiAgdmFyIGZpZWxkcyA9IF8uY2xvbmVEZWVwKHRoaXMuX2ZpZWxkcyk7XG4gIFxuICB2YXIgZmVhdHVyZSwgYXR0cmlidXRlcztcbiAgXG4gIC8vIGlsIG1ldG9kbyBhY2NldHRhIHNpYSBmZWF0dXJlIGNoZSBmaWRcbiAgaWYgKG9iaiBpbnN0YW5jZW9mIG9sLkZlYXR1cmUpe1xuICAgIGZlYXR1cmUgPSBvYmo7XG4gIH1cbiAgZWxzZSBpZiAob2JqKXtcbiAgICBmZWF0dXJlID0gdGhpcy5nZXRGZWF0dXJlQnlJZChvYmopO1xuICB9XG4gIGlmIChmZWF0dXJlKXtcbiAgICBhdHRyaWJ1dGVzID0gZmVhdHVyZS5nZXRQcm9wZXJ0aWVzKCk7XG4gIH1cbiAgXG4gIF8uZm9yRWFjaChmaWVsZHMsZnVuY3Rpb24oZmllbGQpe1xuICAgIGlmIChmZWF0dXJlKXtcbiAgICAgIGlmICghdGhpcy5fUEtpbkF0dHJpYnV0ZXMgJiYgZmllbGQubmFtZSA9PSBzZWxmLnBrKXtcbiAgICAgICAgZmllbGQudmFsdWUgPSBmZWF0dXJlLmdldElkKCk7XG4gICAgICB9XG4gICAgICBlbHNle1xuICAgICAgICBmaWVsZC52YWx1ZSA9IGF0dHJpYnV0ZXNbZmllbGQubmFtZV07XG4gICAgICB9XG4gICAgfVxuICAgIGVsc2V7XG4gICAgICBmaWVsZC52YWx1ZSA9IG51bGw7XG4gICAgfVxuICB9KTtcbiAgcmV0dXJuIGZpZWxkcztcbn07XG5cbnByb3RvLnNldFJlbGF0aW9ucyA9IGZ1bmN0aW9uKHJlbGF0aW9ucyl7XG4gIF8uZm9yRWFjaChyZWxhdGlvbnMsZnVuY3Rpb24ocmVsYXRpb24scmVsYXRpb25LZXkpe1xuICAgIHJlbGF0aW9uLm5hbWUgPSByZWxhdGlvbktleTtcbiAgfSk7XG4gIHRoaXMuX3JlbGF0aW9ucyA9IHJlbGF0aW9ucztcbn07XG5cbnByb3RvLmdldFJlbGF0aW9ucyA9IGZ1bmN0aW9uKCl7XG4gIHJldHVybiB0aGlzLl9yZWxhdGlvbnM7XG59O1xuXG5wcm90by5oYXNSZWxhdGlvbnMgPSBmdW5jdGlvbigpe1xuICByZXR1cm4gIV8uaXNOdWxsKHRoaXMuX3JlbGF0aW9ucyk7XG59O1xuXG5wcm90by5nZXRSZWxhdGlvbnNOYW1lcyA9IGZ1bmN0aW9uKCl7XG4gIHJldHVybiBfLmtleXModGhpcy5fcmVsYXRpb25zKTtcbn07XG5cbnByb3RvLmdldFJlbGF0aW9uc0Zrc0tleXMgPSBmdW5jdGlvbigpe1xuICB2YXIgZmtzID0gW107XG4gIF8uZm9yRWFjaCh0aGlzLl9yZWxhdGlvbnMsZnVuY3Rpb24ocmVsYXRpb24pe1xuICAgIGZrcy5wdXNoKHJlbGF0aW9uLmZrKTtcbiAgfSlcbiAgcmV0dXJuIGZrcztcbn07XG5cbnByb3RvLmdldFJlbGF0aW9uRmllbGRzTmFtZXMgPSBmdW5jdGlvbihyZWxhdGlvbil7XG4gIHZhciByZWxhdGlvbkZpZWxkcyA9IHRoaXMuX3JlbGF0aW9uc1tyZWxhdGlvbl07XG4gIGlmIChyZWxhdGlvbkZpZWxkcyl7XG4gICAgcmV0dXJuIF8ubWFwKHJlbGF0aW9uRmllbGRzLGZ1bmN0aW9uKGZpZWxkKXtcbiAgICAgIHJldHVybiBmaWVsZC5uYW1lO1xuICAgIH0pO1xuICB9XG4gIHJldHVybiBudWxsO1xufTtcblxuLy8gb3R0ZW5nbyBsZSByZWxhemlvbmkgYSBwYXJ0aXJlIGRhbCBmaWQgZGkgdW5hIGZlYXR1cmUgZXNpc3RlbnRlXG5wcm90by5nZXRSZWxhdGlvbnNXaXRoQXR0cmlidXRlcyA9IGZ1bmN0aW9uKGZpZCl7XG4gIHZhciByZWxhdGlvbnMgPSBfLmNsb25lRGVlcCh0aGlzLl9yZWxhdGlvbnMpO1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIGlmICghZmlkIHx8ICF0aGlzLmdldEZlYXR1cmVCeUlkKGZpZCkpe1xuICAgIF8uZm9yRWFjaChyZWxhdGlvbnMsZnVuY3Rpb24ocmVsYXRpb24scmVsYXRpb25LZXkpe1xuICAgICAgICAvLyBpbml6aWFsbWVudGUgc2V0dG8gYSBudWxsIGkgdmFsb3JpXG4gICAgICBfLmZvckVhY2gocmVsYXRpb24uZmllbGRzLGZ1bmN0aW9uKGZpZWxkKXtcbiAgICAgICAgZmllbGQudmFsdWUgPSBudWxsO1xuICAgICAgfSlcbiAgICB9KTtcbiAgICByZXR1cm4gcmVzb2x2ZShyZWxhdGlvbnMpO1xuICB9XG4gIGVsc2Uge1xuICAgIGlmICh0aGlzLmxhenlSZWxhdGlvbnMpe1xuICAgICAgdmFyIGRlZmVycmVkID0gJC5EZWZlcnJlZCgpO1xuICAgICAgdmFyIGF0dHJpYnV0ZXMgPSB0aGlzLmdldEZlYXR1cmVCeUlkKGZpZCkuZ2V0UHJvcGVydGllcygpO1xuICAgICAgdmFyIGZrcyA9IHt9O1xuICAgICAgXy5mb3JFYWNoKHJlbGF0aW9ucyxmdW5jdGlvbihyZWxhdGlvbixyZWxhdGlvbktleSl7XG4gICAgICAgIHZhciB1cmwgPSByZWxhdGlvbi51cmw7XG4gICAgICAgIHZhciBrZXlWYWxzID0gW107XG4gICAgICAgIF8uZm9yRWFjaChyZWxhdGlvbi5mayxmdW5jdGlvbihma0tleSl7XG4gICAgICAgICAgZmtzW2ZrS2V5XSA9IGF0dHJpYnV0ZXNbZmtLZXldO1xuICAgICAgICB9KTtcbiAgICAgIH0pXG4gICAgICBcbiAgICAgIHRoaXMuZ2V0UmVsYXRpb25zV2l0aEF0dHJpYnV0ZXNGcm9tRmtzKGZrcylcbiAgICAgIC50aGVuKGZ1bmN0aW9uKHJlbGF0aW9uc1Jlc3BvbnNlKXtcbiAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZWxhdGlvbnNSZXNwb25zZSk7XG4gICAgICB9KVxuICAgICAgLmZhaWwoZnVuY3Rpb24oKXtcbiAgICAgICAgZGVmZXJyZWQucmVqZWN0KCk7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlKCk7XG4gICAgfVxuICB9XG59O1xuXG4vLyBvdHRlbmdvIGxlIHJlbGF6aW9uaSB2YWxvcml6emF0ZSBhIHBhcnRpcmUgZGEgdW4gb2dnZXR0byBjb24gbGUgY2hpYXZpIEZLIGNvbWUga2V5cyBlIGkgbG9ybyB2YWxvcmkgY29tZSB2YWx1ZXNcbnByb3RvLmdldFJlbGF0aW9uc1dpdGhBdHRyaWJ1dGVzRnJvbUZrcyA9IGZ1bmN0aW9uKGZrcyl7XG4gIHZhciBzZWxmID0gdGhpcztcbiAgdmFyIHJlbGF0aW9ucyA9IF8uY2xvbmVEZWVwKHRoaXMuX3JlbGF0aW9ucyk7XG4gIHZhciByZWxhdGlvbnNSZXF1ZXN0cyA9IFtdO1xuXG4gIF8uZm9yRWFjaChyZWxhdGlvbnMsZnVuY3Rpb24ocmVsYXRpb24scmVsYXRpb25LZXkpe1xuICAgIHZhciB1cmwgPSByZWxhdGlvbi51cmw7XG4gICAgdmFyIGtleVZhbHMgPSBbXTtcbiAgICBfLmZvckVhY2gocmVsYXRpb24uZmssZnVuY3Rpb24oZmtLZXkpe1xuICAgICAgdmFyIGZrVmFsdWUgPSBma3NbZmtLZXldO1xuICAgICAga2V5VmFscy5wdXNoKGZrS2V5K1wiPVwiK2ZrVmFsdWUpO1xuICAgIH0pO1xuICAgIHZhciBma1BhcmFtcyA9IF8uam9pbihrZXlWYWxzLFwiJlwiKTtcbiAgICB1cmwgKz0gXCI/XCIrZmtQYXJhbXM7XG4gICAgcmVsYXRpb25zUmVxdWVzdHMucHVzaCgkLmdldCh1cmwpXG4gICAgICAudGhlbihmdW5jdGlvbihyZWxhdGlvbkF0dHJpYnV0ZXMpe1xuICAgICAgICBfLmZvckVhY2gocmVsYXRpb24uZmllbGRzLGZ1bmN0aW9uKGZpZWxkKXtcbiAgICAgICAgICBmaWVsZC52YWx1ZSA9IHJlbGF0aW9uQXR0cmlidXRlc1swXVtmaWVsZC5uYW1lXTtcbiAgICAgICAgfSk7XG4gICAgICB9KVxuICAgIClcbiAgfSlcbiAgXG4gIHJldHVybiAkLndoZW4uYXBwbHkodGhpcyxyZWxhdGlvbnNSZXF1ZXN0cylcbiAgLnRoZW4oZnVuY3Rpb24oKXtcbiAgICByZXR1cm4gcmVsYXRpb25zO1xuICB9KTtcbn1cblxucHJvdG8uc2V0U3R5bGUgPSBmdW5jdGlvbihzdHlsZSl7XG4gIHRoaXMuX29sTGF5ZXIuc2V0U3R5bGUoc3R5bGUpO1xufTtcblxucHJvdG8uZ2V0TGF5ZXIgPSBmdW5jdGlvbigpe1xuICByZXR1cm4gdGhpcy5fb2xMYXllcjtcbn07XG5cbnByb3RvLmdldFNvdXJjZSA9IGZ1bmN0aW9uKCl7XG4gIHJldHVybiB0aGlzLl9vbExheWVyLmdldFNvdXJjZSgpO1xufTtcblxucHJvdG8uZ2V0RmVhdHVyZUJ5SWQgPSBmdW5jdGlvbihpZCl7XG4gIHJldHVybiB0aGlzLl9vbExheWVyLmdldFNvdXJjZSgpLmdldEZlYXR1cmVCeUlkKGlkKTtcbn07XG5cbnByb3RvLmNsZWFyID0gZnVuY3Rpb24oKXtcbiAgdGhpcy5nZXRTb3VyY2UoKS5jbGVhcigpO1xufTtcblxucHJvdG8uYWRkVG9NYXAgPSBmdW5jdGlvbihtYXApe1xuICBtYXAuYWRkTGF5ZXIodGhpcy5fb2xMYXllcik7XG59O1xuXG4vLyBkYXRhIHVuYSBmZWF0dXJlIHZlcmlmaWNvIHNlIGhhIHRyYSBnbGkgYXR0cmlidXRpIGkgdmFsb3JpIGRlbGxlIEZLIGRlbGxlIChldmVudHVhbGkpIHJlbGF6aW9uaVxucHJvdG8uZmVhdHVyZUhhc1JlbGF0aW9uc0Zrc1dpdGhWYWx1ZXMgPSBmdW5jdGlvbihmZWF0dXJlKXtcbiAgdmFyIGF0dHJpYnV0ZXMgPSBmZWF0dXJlLmdldFByb3BlcnRpZXMoKTtcbiAgdmFyIGZrc0tleXMgPSB0aGlzLmdldFJlbGF0aW9uc0Zrc0tleXMoKTtcbiAgcmV0dXJuIF8uZXZlcnkoZmtzS2V5cyxmdW5jdGlvbihma0tleSl7XG4gICAgdmFyIHZhbHVlID0gYXR0cmlidXRlc1tma0tleV07XG4gICAgcmV0dXJuICghXy5pc05pbCh2YWx1ZSkgJiYgdmFsdWUgIT0gJycpO1xuICB9KVxufTtcblxuLy8gZGF0YSB1bmEgZmVhdHVyZSBwb3BvbG8gdW4gb2dnZXR0byBjb24gY2hpYXZpL3ZhbG9yaSBkZWxsZSBGSyBkZWxsZSAoZXZlbnR1YWxpKSByZWxhemlvbmVcbnByb3RvLmdldFJlbGF0aW9uc0Zrc1dpdGhWYWx1ZXNGb3JGZWF0dXJlID0gZnVuY3Rpb24oZmVhdHVyZSl7XG4gIHZhciBhdHRyaWJ1dGVzID0gZmVhdHVyZS5nZXRQcm9wZXJ0aWVzKCk7XG4gIHZhciBma3MgPSB7fTtcbiAgdmFyIGZrc0tleXMgPSB0aGlzLmdldFJlbGF0aW9uc0Zrc0tleXMoKTtcbiAgXy5mb3JFYWNoKGZrc0tleXMsZnVuY3Rpb24oZmtLZXkpe1xuICAgIGZrc1tma0tleV0gPSBhdHRyaWJ1dGVzW2ZrS2V5XTtcbiAgfSlcbiAgcmV0dXJuIGZrcztcbn07XG4iLCJ2YXIgaW5oZXJpdCA9IHJlcXVpcmUoJ2NvcmUvdXRpbHMvdXRpbHMnKS5pbmhlcml0O1xudmFyIGJhc2UgPSByZXF1aXJlKCdjb3JlL3V0aWxzL3V0aWxzJykuYmFzZTtcbnZhciBMYXllclN0YXRlID0gcmVxdWlyZSgnY29yZS9sYXllci9sYXllcnN0YXRlJyk7XG52YXIgTWFwTGF5ZXIgPSByZXF1aXJlKCdjb3JlL21hcC9tYXBsYXllcicpO1xudmFyIFJhc3RlckxheWVycyA9IHJlcXVpcmUoJ2czdy1vbDMvc3JjL2xheWVycy9yYXN0ZXJzJyk7XG5cbmZ1bmN0aW9uIFdNU0xheWVyKG9wdGlvbnMsZXh0cmFQYXJhbXMpe1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIHRoaXMuTEFZRVJUWVBFID0ge1xuICAgIExBWUVSOiAnbGF5ZXInLFxuICAgIE1VTFRJTEFZRVI6ICdtdWx0aWxheWVyJ1xuICB9O1xuXG4gIHRoaXMuZXh0cmFQYXJhbXMgPSBleHRyYVBhcmFtc1xuICB0aGlzLmxheWVycyA9IFtdO1xuICBcbiAgYmFzZSh0aGlzLG9wdGlvbnMpO1xufVxuaW5oZXJpdChXTVNMYXllcixNYXBMYXllcilcbnZhciBwcm90byA9IFdNU0xheWVyLnByb3RvdHlwZTtcblxucHJvdG8uZ2V0T0xMYXllciA9IGZ1bmN0aW9uKCl7XG4gIHZhciBvbExheWVyID0gdGhpcy5fb2xMYXllcjtcbiAgaWYgKCFvbExheWVyKXtcbiAgICBvbExheWVyID0gdGhpcy5fb2xMYXllciA9IHRoaXMuX21ha2VPbExheWVyKCk7XG4gIH1cbiAgcmV0dXJuIG9sTGF5ZXI7XG59O1xuXG5wcm90by5nZXRTb3VyY2UgPSBmdW5jdGlvbigpe1xuICByZXR1cm4gdGhpcy5nZXRPTExheWVyKCkuZ2V0U291cmNlKCk7XG59O1xuXG5wcm90by5nZXRJbmZvRm9ybWF0ID0gZnVuY3Rpb24oKSB7XG4gIHJldHVybiAnYXBwbGljYXRpb24vdm5kLm9nYy5nbWwnO1xufTtcblxucHJvdG8uZ2V0R2V0RmVhdHVyZUluZm9VcmwgPSBmdW5jdGlvbihjb29yZGluYXRlLHJlc29sdXRpb24sZXBzZyxwYXJhbXMpe1xuICByZXR1cm4gdGhpcy5nZXRPTExheWVyKCkuZ2V0U291cmNlKCkuZ2V0R2V0RmVhdHVyZUluZm9VcmwoY29vcmRpbmF0ZSxyZXNvbHV0aW9uLGVwc2cscGFyYW1zKTtcbn07XG5cbnByb3RvLmdldExheWVyQ29uZmlncyA9IGZ1bmN0aW9uKCl7XG4gIHJldHVybiB0aGlzLmxheWVycztcbn07XG5cbnByb3RvLmFkZExheWVyID0gZnVuY3Rpb24obGF5ZXJDb25maWcpe1xuICB0aGlzLmxheWVycy5wdXNoKGxheWVyQ29uZmlnKTtcbn07XG5cbnByb3RvLnRvZ2dsZUxheWVyID0gZnVuY3Rpb24obGF5ZXIpe1xuICBfLmZvckVhY2godGhpcy5sYXllcnMsZnVuY3Rpb24oX2xheWVyKXtcbiAgICBpZiAoX2xheWVyLmlkID09IGxheWVyLmlkKXtcbiAgICAgIF9sYXllci52aXNpYmxlID0gbGF5ZXIudmlzaWJsZTtcbiAgICB9XG4gIH0pO1xuICB0aGlzLl91cGRhdGVMYXllcnMoKTtcbn07XG4gIFxucHJvdG8udXBkYXRlID0gZnVuY3Rpb24obWFwU3RhdGUsZXh0cmFQYXJhbXMpe1xuICB0aGlzLl91cGRhdGVMYXllcnMobWFwU3RhdGUsZXh0cmFQYXJhbXMpO1xufTtcblxucHJvdG8uaXNWaXNpYmxlID0gZnVuY3Rpb24oKXtcbiAgcmV0dXJuIHRoaXMuX2dldFZpc2libGVMYXllcnMoKS5sZW5ndGggPiAwO1xufTtcblxucHJvdG8uZ2V0UXVlcnlVcmwgPSBmdW5jdGlvbigpe1xuICB2YXIgbGF5ZXIgPSB0aGlzLmxheWVyc1swXTtcbiAgaWYgKGxheWVyLmluZm91cmwgJiYgbGF5ZXIuaW5mb3VybCAhPSAnJykge1xuICAgIHJldHVybiBsYXllci5pbmZvdXJsO1xuICB9XG4gIHJldHVybiB0aGlzLmNvbmZpZy51cmw7XG59O1xuXG5wcm90by5nZXRRdWVyeUxheWVycyA9IGZ1bmN0aW9uKCl7IFxuICB2YXIgbGF5ZXIgPSB0aGlzLmxheWVyc1swXTtcbiAgdmFyIHF1ZXJ5TGF5ZXJzID0gW107XG4gIF8uZm9yRWFjaCh0aGlzLmxheWVycyxmdW5jdGlvbihsYXllcil7XG4gICAgaWYgKExheWVyU3RhdGUuaXNRdWVyeWFibGUobGF5ZXIpKSB7XG4gICAgICBxdWVyeUxheWVycy5wdXNoKHtcbiAgICAgICAgbGF5ZXJOYW1lOiBMYXllclN0YXRlLmdldFdNU0xheWVyTmFtZShsYXllciksXG4gICAgICAgIHF1ZXJ5TGF5ZXJOYW1lOiBMYXllclN0YXRlLmdldFF1ZXJ5TGF5ZXJOYW1lKGxheWVyKSxcbiAgICAgICAgZ2VvbWV0cnlUeXBlOiBMYXllclN0YXRlLmdldEdlb21ldHJ5VHlwZShsYXllciksXG4gICAgICAgIGF0dHJpYnV0ZXM6IExheWVyU3RhdGUuZ2V0QXR0cmlidXRlcyhsYXllcilcbiAgICAgIH0pO1xuICAgIH1cbiAgfSk7XG4gIHJldHVybiBxdWVyeUxheWVycztcbn07XG5cbnByb3RvLl9tYWtlT2xMYXllciA9IGZ1bmN0aW9uKCl7XG4gIHZhciBzZWxmID0gdGhpcztcbiAgdmFyIHdtc0NvbmZpZyA9IHtcbiAgICB1cmw6IHRoaXMuY29uZmlnLnVybCxcbiAgICBpZDogdGhpcy5jb25maWcuaWRcbiAgfTtcbiAgXG4gIHZhciByZXByZXNlbnRhdGl2ZUxheWVyID0gdGhpcy5sYXllcnNbMF07IC8vQlJVVFRPLCBERVZPIFBSRU5ERVJFIFVOIExBWUVSIEEgQ0FTTyAoSUwgUFJJTU8pIFBFUiBWRURFUkUgU0UgUFVOVEEgQUQgVU4gU09VUkNFIERJVkVSU08gKGRvdnJlYmJlIGFjY2FkZXJlIHNvbG8gcGVyIGkgbGF5ZXIgc2luZ29saSwgV01TIGVzdGVybmkpXG4gIFxuICBpZiAocmVwcmVzZW50YXRpdmVMYXllci5zb3VyY2UgJiYgcmVwcmVzZW50YXRpdmVMYXllci5zb3VyY2UudHlwZSA9PSAnd21zJyAmJiByZXByZXNlbnRhdGl2ZUxheWVyLnNvdXJjZS51cmwpe1xuICAgIHdtc0NvbmZpZy51cmwgPSByZXByZXNlbnRhdGl2ZUxheWVyLnNvdXJjZS51cmw7XG4gIH07XG4gIFxuICB2YXIgb2xMYXllciA9IG5ldyBSYXN0ZXJMYXllcnMuV01TTGF5ZXIod21zQ29uZmlnLHRoaXMuZXh0cmFQYXJhbXMpO1xuICBcbiAgb2xMYXllci5nZXRTb3VyY2UoKS5vbignaW1hZ2Vsb2Fkc3RhcnQnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgc2VsZi5lbWl0KFwibG9hZHN0YXJ0XCIpO1xuICAgICAgfSk7XG4gIG9sTGF5ZXIuZ2V0U291cmNlKCkub24oJ2ltYWdlbG9hZGVuZCcsIGZ1bmN0aW9uKCkge1xuICAgICAgc2VsZi5lbWl0KFwibG9hZGVuZFwiKTtcbiAgfSk7XG4gIFxuICByZXR1cm4gb2xMYXllclxufTtcblxucHJvdG8uX2dldFZpc2libGVMYXllcnMgPSBmdW5jdGlvbihtYXBTdGF0ZSl7XG4gIHZhciBzZWxmID0gdGhpcztcbiAgdmFyIHZpc2libGVMYXllcnMgPSBbXTtcbiAgXy5mb3JFYWNoKHRoaXMubGF5ZXJzLGZ1bmN0aW9uKGxheWVyKXtcbiAgICB2YXIgcmVzb2x1dGlvbkJhc2VkVmlzaWJpbGl0eSA9IGxheWVyLm1heHJlc29sdXRpb24gPyAobGF5ZXIubWF4cmVzb2x1dGlvbiAmJiBsYXllci5tYXhyZXNvbHV0aW9uID4gbWFwU3RhdGUucmVzb2x1dGlvbikgOiB0cnVlO1xuICAgIGlmIChsYXllci52aXNpYmxlICYmIHJlc29sdXRpb25CYXNlZFZpc2liaWxpdHkpIHtcbiAgICAgIHZpc2libGVMYXllcnMucHVzaChsYXllcik7XG4gICAgfSAgICBcbiAgfSlcbiAgcmV0dXJuIHZpc2libGVMYXllcnM7XG59O1xuXG5wcm90by5jaGVja0xheWVyRGlzYWJsZWQgPSBmdW5jdGlvbihsYXllcixyZXNvbHV0aW9uKSB7XG4gIHZhciBkaXNhYmxlZCA9IGxheWVyLmRpc2FibGVkIHx8IGZhbHNlO1xuICBpZiAobGF5ZXIubWF4cmVzb2x1dGlvbil7XG4gICAgZGlzYWJsZWQgPSBsYXllci5tYXhyZXNvbHV0aW9uIDwgcmVzb2x1dGlvbjtcbiAgfVxuICBpZiAobGF5ZXIubWlucmVzb2x1dGlvbil7XG4gICAgbGF5ZXIuZGlzYWJsZWQgPSBkaXNhYmxlZCAmJiAobGF5ZXIubWlucmVzb2x1dGlvbiA+IHJlc29sdXRpb24pO1xuICB9XG4gIGxheWVyLmRpc2FibGVkID0gZGlzYWJsZWQ7XG59O1xuXG5wcm90by5jaGVja0xheWVyc0Rpc2FibGVkID0gZnVuY3Rpb24ocmVzb2x1dGlvbil7XG4gIHZhciBzZWxmID0gdGhpcztcbiAgXy5mb3JFYWNoKHRoaXMubGF5ZXJzLGZ1bmN0aW9uKGxheWVyKXtcbiAgICBzZWxmLmNoZWNrTGF5ZXJEaXNhYmxlZChsYXllcixyZXNvbHV0aW9uKTtcbiAgfSk7XG59O1xuXG5wcm90by5fdXBkYXRlTGF5ZXJzID0gZnVuY3Rpb24obWFwU3RhdGUsZXh0cmFQYXJhbXMpe1xuICB0aGlzLmNoZWNrTGF5ZXJzRGlzYWJsZWQobWFwU3RhdGUucmVzb2x1dGlvbik7XG4gIHZhciB2aXNpYmxlTGF5ZXJzID0gdGhpcy5fZ2V0VmlzaWJsZUxheWVycyhtYXBTdGF0ZSk7XG4gIGlmICh2aXNpYmxlTGF5ZXJzLmxlbmd0aCA+IDApIHtcbiAgICB2YXIgcGFyYW1zID0ge1xuICAgICAgTEFZRVJTOiBfLmpvaW4oXy5tYXAodmlzaWJsZUxheWVycyxmdW5jdGlvbihsYXllcil7XG4gICAgICAgIHJldHVybiBMYXllclN0YXRlLmdldFdNU0xheWVyTmFtZShsYXllcik7XG4gICAgICB9KSwnLCcpXG4gICAgfTtcbiAgICBpZiAoZXh0cmFQYXJhbXMpIHtcbiAgICAgIHBhcmFtcyA9IF8uYXNzaWduKHBhcmFtcyxleHRyYVBhcmFtcyk7XG4gICAgfVxuICAgIHRoaXMuX29sTGF5ZXIuc2V0VmlzaWJsZSh0cnVlKTtcbiAgICB0aGlzLl9vbExheWVyLmdldFNvdXJjZSgpLnVwZGF0ZVBhcmFtcyhwYXJhbXMpO1xuICB9XG4gIGVsc2Uge1xuICAgIHRoaXMuX29sTGF5ZXIuc2V0VmlzaWJsZShmYWxzZSk7XG4gIH1cbn07XG5cbm1vZHVsZS5leHBvcnRzID0gV01TTGF5ZXI7XG4iLCJ2YXIgaW5oZXJpdCA9IHJlcXVpcmUoJ2NvcmUvdXRpbHMvdXRpbHMnKS5pbmhlcml0O1xudmFyIGJhc2UgPSByZXF1aXJlKCdjb3JlL3V0aWxzL3V0aWxzJykuYmFzZTtcbnZhciBHM1dPYmplY3QgPSByZXF1aXJlKCdjb3JlL2czd29iamVjdCcpO1xuXG5cbmZ1bmN0aW9uIE1hcExheWVyKGNvbmZpZyl7XG4gIHRoaXMuY29uZmlnID0gY29uZmlnIHx8IHt9O1xuICB0aGlzLmlkID0gY29uZmlnLmlkO1xuICBcbiAgdGhpcy5fb2xMYXllciA9IG51bGw7XG4gIFxuICBiYXNlKHRoaXMpO1xufVxuaW5oZXJpdChNYXBMYXllcixHM1dPYmplY3QpO1xuXG52YXIgcHJvdG8gPSBNYXBMYXllci5wcm90b3R5cGU7XG5cbnByb3RvLmdldElkID0gZnVuY3Rpb24oKXtcbiAgcmV0dXJuIHRoaXMuaWQ7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IE1hcExheWVyO1xuIiwidmFyIGluaGVyaXQgPSByZXF1aXJlKCdjb3JlL3V0aWxzL3V0aWxzJykuaW5oZXJpdDtcbnZhciBiYXNlID0gcmVxdWlyZSgnY29yZS91dGlscy91dGlscycpLmJhc2U7XG52YXIgRzNXT2JqZWN0ID0gcmVxdWlyZSgnY29yZS9nM3dvYmplY3QnKTtcbnZhciBHZW9tZXRyeSA9IHJlcXVpcmUoJ2NvcmUvZ2VvbWV0cnkvZ2VvbWV0cnknKTtcbnZhciBQcm9qZWN0c1JlZ2lzdHJ5ID0gcmVxdWlyZSgnY29yZS9wcm9qZWN0L3Byb2plY3RzcmVnaXN0cnknKTtcblxuXG4vL3ZhciBHVUkgPSByZXF1aXJlKCdndWkvZ3VpJyk7IC8vIFFVRVNUTyBOT04gQ0kgREVWRSBFU1NFUkUhISFcblxuZnVuY3Rpb24gTWFwUXVlcnlTZXJ2aWNlKCkge1xuICBiYXNlKHRoaXMpO1xuICB0aGlzLmluaXQgPSBmdW5jdGlvbihtYXApe1xuICAgIHRoaXMubWFwID0gbWFwO1xuICB9XG4gIFxuICB0aGlzLnF1ZXJ5UG9pbnQgPSBmdW5jdGlvbihjb29yZGluYXRlcyxtYXBMYXllcnMpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgdmFyIGQgPSAkLkRlZmVycmVkKCk7XG4gICAgdmFyIHVybHNGb3JMYXllcnMgPSB7fTtcbiAgICBfLmZvckVhY2gobWFwTGF5ZXJzLGZ1bmN0aW9uKG1hcExheWVyKXtcbiAgICAgIHZhciB1cmwgPSBtYXBMYXllci5nZXRRdWVyeVVybCgpO1xuICAgICAgdmFyIHVybEhhc2ggPSB1cmwuaGFzaENvZGUoKS50b1N0cmluZygpO1xuICAgICAgaWYgKF8ua2V5cyh1cmxzRm9yTGF5ZXJzKS5pbmRleE9mKHVybEhhc2gpID09IC0xKSB7XG4gICAgICAgIHVybHNGb3JMYXllcnNbdXJsSGFzaF0gPSB7XG4gICAgICAgICAgdXJsOiB1cmwsXG4gICAgICAgICAgbWFwTGF5ZXJzOiBbXVxuICAgICAgICB9O1xuICAgICAgfVxuICAgICAgdXJsc0ZvckxheWVyc1t1cmxIYXNoXS5tYXBMYXllcnMucHVzaChtYXBMYXllcik7XG4gICAgfSlcbiAgICBcbiAgICB2YXIgcXVlcnlVcmxzRm9yTGF5ZXJzID0gW107XG4gICAgXy5mb3JFYWNoKHVybHNGb3JMYXllcnMsZnVuY3Rpb24odXJsRm9yTGF5ZXJzKXtcbiAgICAgIHZhciBmaXJzdExheWVyID0gdXJsRm9yTGF5ZXJzLm1hcExheWVyc1swXTtcbiAgICAgIHZhciBfZ2V0RmVhdHVyZUluZm9VcmwgPSBzZWxmLmdldEdldEZlYXR1cmVJbmZvVXJsKGZpcnN0TGF5ZXIsY29vcmRpbmF0ZXMpO1xuICAgICAgdmFyIHF1ZXJ5QmFzZSA9IF9nZXRGZWF0dXJlSW5mb1VybC5zcGxpdCgnPycpWzBdO1xuICAgICAgdmFyIHF1ZXJ5U3RyaW5nID0gX2dldEZlYXR1cmVJbmZvVXJsLnNwbGl0KCc/JylbMV07XG4gICAgICB2YXIgcXVlcnlQYXJhbXMgPSB7fTtcbiAgICAgIF8uZm9yRWFjaChxdWVyeVN0cmluZy5zcGxpdCgnJicpLGZ1bmN0aW9uKHF1ZXJ5U3RyaW5nUGFpcil7XG4gICAgICAgIHZhciBxdWVyeVBhaXIgPSBxdWVyeVN0cmluZ1BhaXIuc3BsaXQoJz0nKTtcbiAgICAgICAgdmFyIGtleSA9IHF1ZXJ5UGFpclswXTtcbiAgICAgICAgdmFyIHZhbHVlID0gcXVlcnlQYWlyWzFdO1xuICAgICAgICBxdWVyeVBhcmFtc1trZXldID0gdmFsdWU7XG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgdmFyIGxheWVyTmFtZXMgPSBbXTtcbiAgICAgIHZhciBxdWVyeUxheWVycyA9IFtdO1xuICAgICAgXy5mb3JFYWNoKHVybEZvckxheWVycy5tYXBMYXllcnMsZnVuY3Rpb24obWFwTGF5ZXIpe1xuICAgICAgICAvL3ZhciBtYXBMYXllckxheWVyc05hbWVzID0gbWFwTGF5ZXIuZ2V0TGF5ZXIoKS5nZXRTb3VyY2UoKS5nZXRQYXJhbXMoKVsnTEFZRVJTJ107XG4gICAgICAgIC8vbGF5ZXJOYW1lcyA9IF8uY29uY2F0KGxheWVyTmFtZXMsbWFwTGF5ZXJMYXllcnNOYW1lcyk7XG4gICAgICAgIHZhciBtYXBMYXllclF1ZXJ5TGF5ZXJzID0gbWFwTGF5ZXIuZ2V0UXVlcnlMYXllcnMoKTtcbiAgICAgICAgXG4gICAgICAgIGlmIChtYXBMYXllclF1ZXJ5TGF5ZXJzLmxlbmd0aCkge1xuICAgICAgICAgIHF1ZXJ5TGF5ZXJzID0gXy5jb25jYXQocXVlcnlMYXllcnMsbWFwTGF5ZXJRdWVyeUxheWVycyk7XG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgICBcbiAgICAgIGlmIChxdWVyeUxheWVycy5sZW5ndGgpIHtcbiAgICAgICAgZGVsZXRlIHF1ZXJ5UGFyYW1zWydTVFlMRVMnXTtcbiAgICAgIFxuICAgICAgICBxdWVyeVBhcmFtc1snTEFZRVJTJ10gPSBfLm1hcChxdWVyeUxheWVycywncXVlcnlMYXllck5hbWUnKTtcbiAgICAgICAgcXVlcnlQYXJhbXNbJ1FVRVJZX0xBWUVSUyddID0gXy5tYXAocXVlcnlMYXllcnMsJ3F1ZXJ5TGF5ZXJOYW1lJyk7XG4gICAgICAgIHF1ZXJ5UGFyYW1zWydGRUFUVVJFX0NPVU5UJ10gPSAxMDAwO1xuICAgICAgICBcbiAgICAgICAgdmFyIGdldEZlYXR1cmVJbmZvVXJsID0gcXVlcnlCYXNlO1xuICAgICAgICB2YXIgbmV3UXVlcnlQYWlycyA9IFtdO1xuICAgICAgICBfLmZvckVhY2gocXVlcnlQYXJhbXMsZnVuY3Rpb24odmFsdWUsa2V5KXtcbiAgICAgICAgICBuZXdRdWVyeVBhaXJzLnB1c2goa2V5Kyc9Jyt2YWx1ZSk7XG4gICAgICAgIH0pO1xuICAgICAgICBnZXRGZWF0dXJlSW5mb1VybCA9IHF1ZXJ5QmFzZSsnPycrbmV3UXVlcnlQYWlycy5qb2luKCcmJylcbiAgICAgICAgXG4gICAgICAgIHF1ZXJ5VXJsc0ZvckxheWVycy5wdXNoKHtcbiAgICAgICAgICB1cmw6IGdldEZlYXR1cmVJbmZvVXJsLFxuICAgICAgICAgIHF1ZXJ5TGF5ZXJzOiBxdWVyeUxheWVyc1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9KVxuICAgIFxuICAgIHZhciBmZWF0dXJlc0ZvckxheWVyTmFtZXMgPSB7fTtcbiAgICBpZiAocXVlcnlVcmxzRm9yTGF5ZXJzLmxlbmd0aCA+IDApIHtcbiAgICAgIF8uZm9yRWFjaChxdWVyeVVybHNGb3JMYXllcnMsZnVuY3Rpb24ocXVlcnlVcmxGb3JMYXllcnMpe1xuICAgICAgICB2YXIgdXJsID0gcXVlcnlVcmxGb3JMYXllcnMudXJsO1xuICAgICAgICB2YXIgcXVlcnlMYXllcnMgPSBxdWVyeVVybEZvckxheWVycy5xdWVyeUxheWVycztcblxuICAgICAgICAkLmdldCh1cmwpLlxuICAgICAgICB0aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKXtcbiAgICAgICAgICB2YXIganNvbnJlc3BvbnNlO1xuICAgICAgICAgIHZhciB4MmpzID0gbmV3IFgySlMoKTtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgaWYgKF8uaXNTdHJpbmcocmVzcG9uc2UpKSB7XG4gICAgICAgICAgICAgIGpzb25yZXNwb25zZSA9IHgyanMueG1sX3N0cjJqc29uKHJlc3BvbnNlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICBqc29ucmVzcG9uc2UgPSB4MmpzLnhtbDJqc29uKHJlc3BvbnNlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIGQucmVqZWN0KGUpO1xuICAgICAgICAgIH1cbiAgICAgICAgICB2YXIgcm9vdE5vZGUgPSBfLmtleXMoanNvbnJlc3BvbnNlKVswXTtcbiAgICAgICAgICB2YXIgcGFyc2VyLCBkYXRhO1xuICAgICAgICAgIHN3aXRjaCAocm9vdE5vZGUpIHtcbiAgICAgICAgICAgIGNhc2UgJ0ZlYXR1cmVDb2xsZWN0aW9uJzpcbiAgICAgICAgICAgICAgcGFyc2VyID0gc2VsZi5fcGFyc2VMYXllckZlYXR1cmVDb2xsZWN0aW9uO1xuICAgICAgICAgICAgICBkYXRhID0ganNvbnJlc3BvbnNlO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJtc0dNTE91dHB1dFwiOlxuICAgICAgICAgICAgICBwYXJzZXIgPSBzZWxmLl9wYXJzZUxheWVybXNHTUxPdXRwdXQ7XG4gICAgICAgICAgICAgIGRhdGEgPSByZXNwb25zZTtcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuICAgICAgICAgIHZhciBuZmVhdHVyZXMgPSAwXG4gICAgICAgICAgXy5mb3JFYWNoKHF1ZXJ5TGF5ZXJzLGZ1bmN0aW9uKHF1ZXJ5TGF5ZXIpe1xuICAgICAgICAgICAgdmFyIGZlYXR1cmVzID0gcGFyc2VyLmNhbGwoc2VsZixxdWVyeUxheWVyLGRhdGEpXG4gICAgICAgICAgICBuZmVhdHVyZXMgKz0gZmVhdHVyZXMubGVuZ3RoO1xuICAgICAgICAgICAgZmVhdHVyZXNGb3JMYXllck5hbWVzW3F1ZXJ5TGF5ZXIubGF5ZXJOYW1lXSA9IGZlYXR1cmVzO1xuICAgICAgICAgIH0pXG4gICAgICAgICAgZC5yZXNvbHZlKGNvb3JkaW5hdGVzLG5mZWF0dXJlcyxmZWF0dXJlc0ZvckxheWVyTmFtZXMpO1xuICAgICAgICB9KVxuICAgICAgICAuZmFpbChmdW5jdGlvbihlKXtcbiAgICAgICAgICBkLnJlamVjdChlKTtcbiAgICAgICAgfSlcbiAgICAgIH0pO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIGQucmVzb2x2ZShjb29yZGluYXRlcywwLGZlYXR1cmVzRm9yTGF5ZXJOYW1lcyk7XG4gICAgfVxuICAgIFxuICAgIHJldHVybiBkLnByb21pc2UoKTtcbiAgfTtcbiAgXG4gIC8vIEJydXR0byBtYSBwZXIgb3JhIHVuaWNhIHNvbHV6aW9uZSB0cm92YXRhIHBlciBkaXZpZGVyZSBwZXIgbGF5ZXIgaSByaXN1bHRhdGkgZGkgdW4gZG9jIHhtbCB3ZnMuRmVhdHVyZUNvbGxlY3Rpb24uIE9MMyBsaSBwYXJzZXJpenphIHR1dHRpIGluc2llbWUuLi5cbiAgdGhpcy5fcGFyc2VMYXllckZlYXR1cmVDb2xsZWN0aW9uID0gZnVuY3Rpb24ocXVlcnlMYXllcixkYXRhKXtcbiAgICB2YXIgZmVhdHVyZXMgPSBbXTtcbiAgICB2YXIgbGF5ZXJOYW1lID0gcXVlcnlMYXllci5xdWVyeUxheWVyTmFtZTtcbiAgICB2YXIgbGF5ZXJEYXRhID0gXy5jbG9uZURlZXAoZGF0YSk7XG4gICAgbGF5ZXJEYXRhLkZlYXR1cmVDb2xsZWN0aW9uLmZlYXR1cmVNZW1iZXIgPSBbXTtcbiAgICBcbiAgICB2YXIgZmVhdHVyZU1lbWJlcnMgPSBkYXRhLkZlYXR1cmVDb2xsZWN0aW9uLmZlYXR1cmVNZW1iZXI7XG4gICAgXy5mb3JFYWNoKGZlYXR1cmVNZW1iZXJzLGZ1bmN0aW9uKGZlYXR1cmVNZW1iZXIpe1xuICAgICAgdmFyIGlzTGF5ZXJNZW1iZXIgPSBfLmdldChmZWF0dXJlTWVtYmVyLGxheWVyTmFtZSlcblxuICAgICAgaWYgKGlzTGF5ZXJNZW1iZXIpIHtcbiAgICAgICAgbGF5ZXJEYXRhLkZlYXR1cmVDb2xsZWN0aW9uLmZlYXR1cmVNZW1iZXIucHVzaChmZWF0dXJlTWVtYmVyKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICBcbiAgICB2YXIgeDJqcyA9IG5ldyBYMkpTKCk7XG4gICAgdmFyIGxheWVyRmVhdHVyZUNvbGxlY3Rpb25YTUwgPSB4MmpzLmpzb24yeG1sX3N0cihsYXllckRhdGEpO1xuICAgIHZhciBwYXJzZXIgPSBuZXcgb2wuZm9ybWF0LldNU0dldEZlYXR1cmVJbmZvKCk7XG4gICAgcmV0dXJuIHBhcnNlci5yZWFkRmVhdHVyZXMobGF5ZXJGZWF0dXJlQ29sbGVjdGlvblhNTCk7XG4gIH07XG4gIFxuICAvLyBtZW50cmUgY29uIGkgcmlzdWx0YXRpIGluIG1zR0xNT3V0cHV0IChkYSBNYXBzZXJ2ZXIpIGlsIHBhcnNlciBwdcOyIGVzc2VyZSBpc3RydWl0byBwZXIgcGFyc2VyaXp6YXJlIGluIGJhc2UgYWQgdW4gbGF5ZXIgZGkgZmlsdHJvXG4gIHRoaXMuX3BhcnNlTGF5ZXJtc0dNTE91dHB1dCA9IGZ1bmN0aW9uKHF1ZXJ5TGF5ZXIsZGF0YSl7XG4gICAgdmFyIHBhcnNlciA9IG5ldyBvbC5mb3JtYXQuV01TR2V0RmVhdHVyZUluZm8oe1xuICAgICAgbGF5ZXJzOiBbcXVlcnlMYXllci5xdWVyeUxheWVyTmFtZV1cbiAgICB9KTtcbiAgICByZXR1cm4gcGFyc2VyLnJlYWRGZWF0dXJlcyhkYXRhKTtcbiAgfTtcbiAgXG4gIHRoaXMucXVlcnlSZWN0ID0gZnVuY3Rpb24ocmVjdCxsYXllcklkKSB7XG4gICAgXG4gIH07XG4gIFxuICB0aGlzLl9xdWVyeSA9IGZ1bmN0aW9uKHJlY3QsbGF5ZXJJZCkge1xuICAgIHZhciBQcm9qZWN0ID0gUHJvamVjdHNSZWdpc3RyeS5nZXRDdXJyZW50UHJvamVjdCgpO1xuICAgIHZhciBsYXllcnM7XG4gICAgaWYgKGxheWVySWQpIHtcbiAgICAgIGxheWVycyA9IFtQcm9qZWN0LmdldExheWVyKGxheWVySWQpXTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICBsYXllcnMgPSBQcm9qZWN0LmdldExheWVycygpO1xuICAgIH1cbiAgfTtcbiAgXG4gIHRoaXMuZ2V0R2V0RmVhdHVyZUluZm9VcmwgPSBmdW5jdGlvbihtYXBMYXllcixjb29yZGluYXRlKXtcbiAgICAvL3ZhciBwYXJzZXIgPSBuZXcgb2wuZm9ybWF0LldNU0dldEZlYXR1cmVJbmZvKCk7XG4gICAgdmFyIHJlc29sdXRpb24gPSB0aGlzLm1hcC5nZXRWaWV3KCkuZ2V0UmVzb2x1dGlvbigpO1xuICAgIHZhciBlcHNnID0gdGhpcy5tYXAuZ2V0VmlldygpLmdldFByb2plY3Rpb24oKS5nZXRDb2RlKCk7XG4gICAgdmFyIHBhcmFtcyA9IHtcbiAgICAgIFFVRVJZX0xBWUVSUzogXy5tYXAobWFwTGF5ZXIuZ2V0UXVlcnlMYXllcnMoKSwncXVlcnlMYXllck5hbWUnKSxcbiAgICAgIElORk9fRk9STUFUOiBtYXBMYXllci5nZXRJbmZvRm9ybWF0KCksXG4gICAgICAvLyBQQVJBTUVUUkkgREkgVE9MTEVSQU5aQSBQRVIgUUdJUyBTRVJWRVJcbiAgICAgIEZJX1BPSU5UX1RPTEVSQU5DRTogMTAsXG4gICAgICBGSV9MSU5FX1RPTEVSQU5DRTogMTAsXG4gICAgICBGSV9QT0xZR09OX1RPTEVSQU5DRTogMTAgICAgICBcbiAgICB9XG4gICAgdmFyIHVybCA9IG1hcExheWVyLmdldEdldEZlYXR1cmVJbmZvVXJsKGNvb3JkaW5hdGUscmVzb2x1dGlvbixlcHNnLHBhcmFtcyk7XG4gICAgcmV0dXJuIHVybDtcbiAgfTtcbn1cbmluaGVyaXQoTWFwUXVlcnlTZXJ2aWNlLEczV09iamVjdCk7XG5cbm1vZHVsZS5leHBvcnRzID0gbmV3IE1hcFF1ZXJ5U2VydmljZTtcbiIsInZhciBpbmhlcml0ID0gcmVxdWlyZSgnY29yZS91dGlscy91dGlscycpLmluaGVyaXQ7XG52YXIgYmFzZSA9IHJlcXVpcmUoJ2NvcmUvdXRpbHMvdXRpbHMnKS5iYXNlO1xudmFyIEczV09iamVjdCA9IHJlcXVpcmUoJ2NvcmUvZzN3b2JqZWN0Jyk7XG5cbmZ1bmN0aW9uIE1hcHNSZWdpc3RyeSgpIHtcbiAgYmFzZSh0aGlzKTtcbiAgXG4gIHRoaXMuX21hcHNTZXJ2aWNlcyA9IHtcbiAgfTtcbiAgXG4gIHRoaXMuYWRkTWFwID0gZnVuY3Rpb24obWFwU2VydmljZSkge1xuICAgIHRoaXMuX3JlZ2lzdGVyTWFwU2VydmljZShtYXBTZXJ2aWNlKTtcbiAgfTtcbiAgXG4gIHRoaXMuX3JlZ2lzdGVyTWFwU2VydmljZSA9IGZ1bmN0aW9uKG1hcFNlcnZpY2UpIHtcbiAgICB2YXIgbWFwU2VydmljZSA9IHRoaXMuX21hcHNTZXJ2aWNlc1ttYXBTZXJ2aWNlLmlkXVxuICAgIGlmIChfLmlzVW5kZWZpbmVkKG1hcFNlcnZpY2UpKSB7XG4gICAgICB0aGlzLl9tYXBzU2VydmljZXNbbWFwU2VydmljZS5pZF0gPSBtYXBTZXJ2aWNlO1xuICAgIH1cbiAgfTtcbn0gXG5pbmhlcml0KE1hcHNSZWdpc3RyeSxHM1dPYmplY3QpO1xuXG5tb2R1bGUuZXhwb3J0cyA9IE1hcHNSZWdpc3RyeTtcbiIsInZhciBpbmhlcml0ID0gcmVxdWlyZSgnY29yZS91dGlscy91dGlscycpLmluaGVyaXQ7XG52YXIgRzNXT2JqZWN0ID0gcmVxdWlyZSgnY29yZS9nM3dvYmplY3QnKTtcblxuZnVuY3Rpb24gUGx1Z2luKG9wdGlvbnMpe1xuICB0aGlzLm5hbWUgPSBuYW1lO1xuICB0aGlzLnRvb2xzID0gW107XG59XG5pbmhlcml0KFBsdWdpbixHM1dPYmplY3QpO1xuXG52YXIgcHJvdG8gPSBQbHVnaW4ucHJvdG90eXBlO1xuXG5wcm90by5sb2FkID0gZnVuY3Rpb24oKSB7XG4gIHZhciBkID0gJC5EZWZlcnJlZCgpO1xuICB2YXIgdXJsID0gJ2xpYi9wbHVnaW5zLycrdGhpcy5uYW1lO1xuICAkc2NyaXB0KHVybCxmdW5jdGlvbigpe1xuICAgIGQucmVzb2x2ZSgpO1xuICB9KTtcbiAgcmV0dXJuIGQucHJvbWlzZSgpO1xufVxuXG5wcm90by5wcm92aWRlc1Rvb2xzID0gZnVuY3Rpb24oKXtcbiAgcmV0dXJuIHRoaXMudG9vbHMubGVuZ3RoID4gMDtcbn07XG5cbnByb3RvLmdldFRvb2xzID0gZnVuY3Rpb24oKXtcbiAgcmV0dXJuIHRoaXMudG9vbHM7XG59O1xuXG5wcm90by5nZXRBY3Rpb25zID0gZnVuY3Rpb24odG9vbCl7XG4gIHJldHVybiB0b29sLmFjdGlvbnM7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFBsdWdpbjtcbiIsInZhciBiYXNlID0gcmVxdWlyZSgnY29yZS91dGlscy91dGlscycpLmJhc2U7XG52YXIgaW5oZXJpdCA9IHJlcXVpcmUoJ2NvcmUvdXRpbHMvdXRpbHMnKS5pbmhlcml0O1xudmFyIEczV09iamVjdCA9IHJlcXVpcmUoJ2NvcmUvZzN3b2JqZWN0Jyk7XG5cbi8vdmFyIFBsdWdpbiA9IHJlcXVpcmUoJy4vcGx1Z2luJyk7XG4vL3ZhciBUb29sc1NlcnZpY2UgPSByZXF1aXJlKCdjb3JlL3BsdWdpbi90b29sc3NlcnZpY2UnKTtcblxuZnVuY3Rpb24gUGx1Z2luc1JlZ2lzdHJ5KCl7XG4gIHZhciBzZWxmID0gdGhpcztcbiAgdGhpcy5jb25maWcgPSBudWxsO1xuICAvLyB1biBkb21hbmkgcXVlc3RvIHNhcsOgIGRpbmFtaWNvXG4gIHRoaXMuX3BsdWdpbnMgPSB7fTtcbiAgdGhpcy5zdGF0ZSA9IHtcbiAgICB0b29sc3Byb3ZpZGVyczogW11cbiAgfTtcbiAgXG4gIHRoaXMuc2V0dGVycyA9IHtcbiAgICBzZXRUb29sc1Byb3ZpZGVyOiBmdW5jdGlvbihwbHVnaW4pIHtcbiAgICAgIHNlbGYuc3RhdGUudG9vbHNwcm92aWRlcnMucHVzaChwbHVnaW4pO1xuICAgIH0sXG4gICAgcmVnaXN0ZXJQbHVnaW46IGZ1bmN0aW9uKHBsdWdpbil7XG4gICAgICBpZiAoIXNlbGYuX3BsdWdpbnNbcGx1Z2luLm5hbWVdKSB7XG4gICAgICAgIHNlbGYuX3BsdWdpbnNbcGx1Z2luLm5hbWVdID0gcGx1Z2luO1xuICAgICAgICBjb25zb2xlLmxvZyhcIlJlZ2lzdHJhdG8gcGx1Z2luIFwiK3BsdWdpbi5uYW1lKVxuICAgICAgfVxuICAgIH1cbiAgfVxuICBcbiAgYmFzZSh0aGlzKTtcbiAgXG4gIHRoaXMuaW5pdCA9IGZ1bmN0aW9uKG9wdGlvbnMpe1xuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICB0aGlzLnBsdWdpbnNCYXNlVXJsID0gb3B0aW9ucy5wbHVzaW5nQmFzZVVybFxuICAgIHRoaXMucGx1Z2luc0NvbmZpZ3MgPSBvcHRpb25zLnBsdWdpbnNDb25maWdzO1xuICAgIF8uZm9yRWFjaCh0aGlzLnBsdWdpbnNDb25maWdzLGZ1bmN0aW9uKHBsdWdpbkNvbmZpZyxuYW1lKXtcbiAgICAgIHNlbGYuX3NldHVwKG5hbWUscGx1Z2luQ29uZmlnKTtcbiAgICB9KVxuICB9O1xuICBcbiAgdGhpcy5fc2V0dXAgPSBmdW5jdGlvbihuYW1lLHBsdWdpbkNvbmZpZykge1xuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICBpZiAocGx1Z2luQ29uZmlnKXtcbiAgICAgIHZhciB1cmwgPSB0aGlzLnBsdWdpbnNCYXNlVXJsKycvcGx1Z2lucy8nK25hbWUrJy5qcyc7XG4gICAgICAkc2NyaXB0KHVybCk7XG4gICAgfVxuICB9O1xuICBcbiAgdGhpcy5hY3RpdmF0ZSA9IGZ1bmN0aW9uKHBsdWdpbikge1xuICAgIHZhciB0b29scyA9IHBsdWdpbi5nZXRUb29scygpO1xuICAgIGlmICh0b29scy5sZW5ndGgpIHtcbiAgICAgIFRvb2xzU2VydmljZS5yZWdpc3RlclRvb2xzUHJvdmlkZXIocGx1Z2luKTtcbiAgICB9XG4gIH07XG59O1xuXG5pbmhlcml0KFBsdWdpbnNSZWdpc3RyeSxHM1dPYmplY3QpO1xuXG5tb2R1bGUuZXhwb3J0cyA9IG5ldyBQbHVnaW5zUmVnaXN0cnlcbiIsInZhciBpbmhlcml0ID0gcmVxdWlyZSgnY29yZS91dGlscy91dGlscycpLmluaGVyaXQ7XG52YXIgYmFzZSA9IHJlcXVpcmUoJ2NvcmUvdXRpbHMvL3V0aWxzJykuYmFzZTtcbnZhciBHM1dPYmplY3QgPSByZXF1aXJlKCdjb3JlL2czd29iamVjdCcpO1xudmFyIEFwcGxpY2F0aW9uU2VydmljZSA9IHJlcXVpcmUoJ2NvcmUvYXBwbGljYXRpb25zZXJ2aWNlJyk7XG5cbmZ1bmN0aW9uIFByb2plY3QocHJvamVjdENvbmZpZykge1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIFxuICAvKiBzdHJ1dHR1cmEgb2dnZXR0byAncHJvamVjdCdcbiAge1xuICAgIGlkLFxuICAgIHR5cGUsXG4gICAgZ2lkLFxuICAgIG5hbWUsXG4gICAgY3JzLFxuICAgIGV4dGVudCxcbiAgICBsYXllcnN0cmVlLFxuICAgIHdpZGdldHNcbiAgfVxuICAqL1xuICB0aGlzLnN0YXRlID0gcHJvamVjdENvbmZpZztcbiAgXG4gIHRoaXMuX2xheWVycyA9IHt9O1xuICBmdW5jdGlvbiB0cmF2ZXJzZShvYmope1xuICAgIF8uZm9ySW4ob2JqLCBmdW5jdGlvbiAobGF5ZXIsIGtleSkge1xuICAgICAgICAvL3ZlcmlmaWNhIGNoZSBpbCB2YWxvcmUgZGVsbCdpZCBub24gc2lhIG51bGxvXG4gICAgICAgIGlmICghXy5pc05pbChsYXllci5pZCkpIHtcbiAgICAgICAgICAgIHNlbGYuX2xheWVyc1tsYXllci5pZF0gPSBsYXllcjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIV8uaXNOaWwobGF5ZXIubm9kZXMpKSB7XG4gICAgICAgICAgICB0cmF2ZXJzZShsYXllci5ub2Rlcyk7XG4gICAgICAgIH1cbiAgICB9KTtcbiAgfVxuICB0cmF2ZXJzZShwcm9qZWN0Q29uZmlnLmxheWVyc3RyZWUpO1xuICBcbiAgLyp2YXIgZXZlbnRUeXBlID0gJ3Byb2plY3RzZXQnO1xuICBpZiAoZG9zd2l0Y2ggJiYgZG9zd2l0Y2ggPT09IHRydWUpIHtcbiAgICBldmVudFR5cGUgPSAncHJvamVjdHN3aXRjaCc7XG4gIH1cbiAgdGhpcy5lbWl0KGV2ZW50VHlwZSk7Ki9cbiAgXG4gIHRoaXMuc2V0dGVycyA9IHtcbiAgICBzZXRMYXllcnNWaXNpYmxlOiBmdW5jdGlvbihsYXllcnMsdmlzaWJsZSl7XG4gICAgICBfLmZvckVhY2gobGF5ZXJzLGZ1bmN0aW9uKGxheWVyKXtcbiAgICAgICAgc2VsZi5fbGF5ZXJzW2xheWVyLmlkXS52aXNpYmxlID0gdmlzaWJsZTtcbiAgICAgIH0pXG4gICAgfSxcbiAgICBzZXRCYXNlTGF5ZXI6IGZ1bmN0aW9uKGlkKXtcbiAgICAgIF8uZm9yRWFjaChzZWxmLnN0YXRlLmJhc2VMYXllcnMsZnVuY3Rpb24oYmFzZUxheWVyKXtcbiAgICAgICAgYmFzZUxheWVyLnZpc2libGUgPSAoYmFzZUxheWVyLmlkID09IGlkKTtcbiAgICAgIH0pXG4gICAgfVxuICB9O1xuXG4gIGJhc2UodGhpcyk7XG59XG5pbmhlcml0KFByb2plY3QsRzNXT2JqZWN0KTtcblxudmFyIHByb3RvID0gUHJvamVjdC5wcm90b3R5cGU7XG5cbnByb3RvLmdldExheWVyID0gZnVuY3Rpb24oaWQpe1xuICByZXR1cm4gdGhpcy5fbGF5ZXJzW2lkXTtcbn07XG5cbnByb3RvLmdldExheWVycyA9IGZ1bmN0aW9uKCl7XG4gIHJldHVybiB0aGlzLl9sYXllcnM7XG59O1xuXG5wcm90by5nZXRMYXllckJ5SWQgPSBmdW5jdGlvbihpZCkge1xuICB2YXIgbGF5ZXIgPSBudWxsO1xuICBfLmZvckVhY2godGhpcy5nZXRMYXllcnMoKSxmdW5jdGlvbihfbGF5ZXIpe1xuICAgIGlmIChfbGF5ZXIuaWQgPT0gaWQpe1xuICAgICAgbGF5ZXIgPSBfbGF5ZXI7XG4gICAgfVxuICB9KTtcbiAgcmV0dXJuIGxheWVyO1xufTtcblxucHJvdG8uZ2V0TGF5ZXJCeU5hbWUgPSBmdW5jdGlvbihuYW1lKSB7XG4gIHZhciBsYXllciA9IG51bGw7XG4gIF8uZm9yRWFjaCh0aGlzLmdldExheWVycygpLGZ1bmN0aW9uKF9sYXllcil7XG4gICAgaWYgKF9sYXllci5uYW1lID09IG5hbWUpe1xuICAgICAgbGF5ZXIgPSBfbGF5ZXI7XG4gICAgfVxuICB9KTtcbiAgcmV0dXJuIGxheWVyO1xufTtcblxucHJvdG8uZ2V0UXVlcnlhYmxlTGF5ZXJzID0gZnVuY3Rpb24oKXtcbiAgdmFyIHF1ZXJ5YWJsZUxheWVycyA9IFtdO1xuICBfLmZvckVhY2godGhpcy5nZXRMYXllcnMoKSxmdW5jdGlvbihsYXllcil7XG4gICAgaWYgKExheWVyU3RhdGUuaXNRdWVyeWFibGUobGF5ZXIpKXtcbiAgICAgIHF1ZXJ5YWJsZUxheWVycy5wdXNoKGxheWVyKTtcbiAgICB9XG4gIH0pO1xuICByZXR1cm4gcXVlcnlhYmxlTGF5ZXJzO1xufTtcblxucHJvdG8uZ2V0TGF5ZXJBdHRyaWJ1dGVzID0gZnVuY3Rpb24oaWQpe1xuICByZXR1cm4gdGhpcy5fbGF5ZXJzW2lkXS5hdHRyaWJ1dGVzO1xufTtcblxucHJvdG8uZ2V0TGF5ZXJBdHRyaWJ1dGVMYWJlbCA9IGZ1bmN0aW9uKGlkLG5hbWUpe1xuICB2YXIgbGFiZWwgPSAnJztcbiAgXy5mb3JFYWNoKHRoaXMuX2xheWVyc1tpZF0uYXR0cmlidXRlcyxmdW5jdGlvbihhdHRyaWJ1dGUpe1xuICAgIGlmIChhdHRyaWJ1dGUubmFtZSA9PSBuYW1lKXtcbiAgICAgIGxhYmVsID0gYXR0cmlidXRlLmxhYmVsO1xuICAgIH1cbiAgfSlcbiAgcmV0dXJuIGxhYmVsO1xufTtcblxucHJvdG8udG9nZ2xlTGF5ZXIgPSBmdW5jdGlvbihsYXllcix2aXNpYmxlKXtcbiAgdmFyIHZpc2libGUgPSB2aXNpYmxlIHx8ICFsYXllci52aXNpYmxlO1xuICB0aGlzLnNldExheWVyc1Zpc2libGUoW2xheWVyXSx2aXNpYmxlKTtcbn07XG5cbnByb3RvLnRvZ2dsZUxheWVycyA9IGZ1bmN0aW9uKGxheWVycyx2aXNpYmxlKXtcbiAgdGhpcy5zZXRMYXllcnNWaXNpYmxlKGxheWVycyx2aXNpYmxlKTtcbn07XG5cbnByb3RvLnNldEdldFdtc1VybCA9IGZ1bmN0aW9uKGdldFdtc1VybEZuYyl7XG4gIHRoaXMuX2dldFdtc1VybEZuYyA9IGdldFdtc1VybEZuYztcbn07XG5cbnByb3RvLmdldFdtc1VybCA9IGZ1bmN0aW9uKCl7XG4gIHJldHVybiB0aGlzLl9nZXRXbXNVcmxGbmModGhpcy5zdGF0ZSk7XG59O1xuXG5wcm90by5nZXRMZWdlbmRVcmwgPSBmdW5jdGlvbihsYXllcil7XG4gIHZhciB1cmwgPSB0aGlzLmdldFdtc1VybCgpO1xuICBzZXAgPSAodXJsLmluZGV4T2YoJz8nKSA+IC0xKSA/ICcmJyA6ICc/JztcbiAgcmV0dXJuIHRoaXMuZ2V0V21zVXJsKCkrc2VwKydTRVJWSUNFPVdNUyZWRVJTSU9OPTEuMy4wJlJFUVVFU1Q9R2V0TGVnZW5kR3JhcGhpYyZTTERfVkVSU0lPTj0xLjEuMCZGT1JNQVQ9aW1hZ2UvcG5nJlRSQU5TUEFSRU5UPXRydWUmSVRFTUZPTlRDT0xPUj13aGl0ZSZMQVlFUlRJVExFPUZhbHNlJklURU1GT05UU0laRT0xMCZMQVlFUj0nK2xheWVyLm5hbWU7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFByb2plY3Q7XG4iLCJ2YXIgaW5oZXJpdCA9IHJlcXVpcmUoJ2NvcmUvdXRpbHMvdXRpbHMnKS5pbmhlcml0O1xudmFyIGJhc2UgPSByZXF1aXJlKCdjb3JlL3V0aWxzL3V0aWxzJykuYmFzZTtcbnZhciByZXNvbHZlID0gcmVxdWlyZSgnY29yZS91dGlscy91dGlscycpLnJlc29sdmU7XG52YXIgcmVqZWN0ID0gcmVxdWlyZSgnY29yZS91dGlscy91dGlscycpLnJlamVjdDtcbnZhciBHM1dPYmplY3QgPSByZXF1aXJlKCdjb3JlL2czd29iamVjdCcpO1xudmFyIFByb2plY3QgPSByZXF1aXJlKCdjb3JlL3Byb2plY3QvcHJvamVjdCcpO1xuXG5cbi8qIHNlcnZpY2VcbkZ1bnppb25lIGNvc3RydXR0b3JlIGNvbnRlbnRlbnRlIHRyZSBwcm9wcmlldGEnOlxuICAgIHNldHVwOiBtZXRvZG8gZGkgaW5pemlhbGl6emF6aW9uZVxuICAgIGdldExheWVyc1N0YXRlOiByaXRvcm5hIGwnb2dnZXR0byBMYXllcnNTdGF0ZVxuICAgIGdldExheWVyc1RyZWU6IHJpdG9ybmEgbCdhcnJheSBsYXllcnNUcmVlIGRhbGwnb2dnZXR0byBMYXllcnNTdGF0ZVxuKi9cblxuLy8gUHVibGljIGludGVyZmFjZVxuZnVuY3Rpb24gUHJvamVjdHNSZWdpc3RyeSgpe1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIHRoaXMuY29uZmlnID0gbnVsbDtcbiAgdGhpcy5pbml0aWFsaXplZCA9IGZhbHNlO1xuICB0aGlzLnByb2plY3RUeXBlID0gbnVsbDtcbiAgXG4gIHRoaXMuc2V0dGVycyA9IHtcbiAgICBzZXRDdXJyZW50UHJvamVjdDogZnVuY3Rpb24ocHJvamVjdCl7XG4gICAgICB0aGlzLnN0YXRlLmN1cnJlbnRQcm9qZWN0ID0gcHJvamVjdDtcbiAgICB9XG4gIH07XG4gIFxuICB0aGlzLnN0YXRlID0ge1xuICAgIGJhc2VMYXllcnM6IHt9LFxuICAgIG1pblNjYWxlOiBudWxsLFxuICAgIG1heHNjYWxlOiBudWxsLFxuICAgIGN1cnJlbnRQcm9qZWN0OiBudWxsXG4gIH07XG4gIFxuICAvLyB0dXR0ZSBsZSBjb25maWd1cmF6aW9uaSBkaSBiYXNlIGRlaSBwcm9nZXR0aSwgbWEgZGkgY3VpIG5vbiDDqCBkZXR0byBjaGUgc2lhIGFuY29yYSBkaXNwb25pYmlsZSBsJ2lzdGFuemEgKGxhenkgbG9hZGluZylcbiAgdGhpcy5fcGVuZGluZ1Byb2plY3RzID0gW107XG4gIHRoaXMuX3Byb2plY3RzID0ge307XG4gIFxuICBiYXNlKHRoaXMpO1xufVxuaW5oZXJpdChQcm9qZWN0c1JlZ2lzdHJ5LCBHM1dPYmplY3QpO1xuXG52YXIgcHJvdG8gPSBQcm9qZWN0c1JlZ2lzdHJ5LnByb3RvdHlwZTtcblxucHJvdG8uaW5pdCA9IGZ1bmN0aW9uKGNvbmZpZyl7XG4gIHZhciBzZWxmID0gdGhpcztcbiAgaWYgKCF0aGlzLmluaXRpYWxpemVkKXtcbiAgICB0aGlzLmluaXRpYWxpemVkID0gdHJ1ZTtcbiAgICB0aGlzLmNvbmZpZyA9IGNvbmZpZztcbiAgICAvL2FnZ2l1bnRvIHRpcG8gcHJvZ2V0dG9cbiAgICB0aGlzLnByb2plY3RUeXBlID0gdGhpcy5jb25maWcuZ3JvdXAub3ZlcnZpZXdwcm9qZWN0LnR5cGU7XG4gICAgdGhpcy5zZXR1cFN0YXRlKCk7XG4gICAgcmV0dXJuIHRoaXMuZ2V0UHJvamVjdChjb25maWcuaW5pdHByb2plY3QpXG4gICAgLnRoZW4oZnVuY3Rpb24ocHJvamVjdCl7XG4gICAgICBzZWxmLnNldEN1cnJlbnRQcm9qZWN0KHByb2plY3QpO1xuICAgIH0pO1xuICB9XG59O1xuICBcbnByb3RvLnNldHVwU3RhdGUgPSBmdW5jdGlvbigpe1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIFxuICBzZWxmLnN0YXRlLmJhc2VMYXllcnMgPSBzZWxmLmNvbmZpZy5iYXNlbGF5ZXJzO1xuICBzZWxmLnN0YXRlLm1pblNjYWxlID0gc2VsZi5jb25maWcubWluc2NhbGU7XG4gIHNlbGYuc3RhdGUubWF4U2NhbGUgPSBzZWxmLmNvbmZpZy5tYXhzY2FsZTtcbiAgc2VsZi5zdGF0ZS5jcnMgPSBzZWxmLmNvbmZpZy5jcnM7XG4gIHNlbGYuc3RhdGUucHJvajQgPSBzZWxmLmNvbmZpZy5wcm9qNDtcbiAgc2VsZi5jb25maWcucHJvamVjdHMuZm9yRWFjaChmdW5jdGlvbihwcm9qZWN0KXtcbiAgICBwcm9qZWN0LmJhc2VsYXllcnMgPSBzZWxmLmNvbmZpZy5iYXNlbGF5ZXJzO1xuICAgIHByb2plY3QubWluc2NhbGUgPSBzZWxmLmNvbmZpZy5taW5zY2FsZTtcbiAgICBwcm9qZWN0Lm1heHNjYWxlID0gc2VsZi5jb25maWcubWF4c2NhbGU7XG4gICAgcHJvamVjdC5jcnMgPSBzZWxmLmNvbmZpZy5jcnM7XG4gICAgcHJvamVjdC5wcm9qNCA9IHNlbGYuY29uZmlnLnByb2o0O1xuICAgIHNlbGYuX3BlbmRpbmdQcm9qZWN0cy5wdXNoKHByb2plY3QpO1xuICB9KVxuICAvL3RoaXMuc3RhdGUucHJvamVjdHMgPSBjb25maWcuZ3JvdXAucHJvamVjdHM7XG59O1xuXG5wcm90by5nZXRQcm9qZWN0VHlwZSA9IGZ1bmN0aW9uKCkge1xuICByZXR1cm4gdGhpcy5wcm9qZWN0VHlwZTtcbn07XG5cbnByb3RvLmdldFBlbmRpbmdQcm9qZWN0cyA9IGZ1bmN0aW9uKCkge1xuICByZXR1cm4gdGhpcy5fcGVuZGluZ1Byb2plY3RzKCk7XG59O1xuXG5wcm90by5nZXRDdXJyZW50UHJvamVjdCA9IGZ1bmN0aW9uKCl7XG4gIHJldHVybiB0aGlzLnN0YXRlLmN1cnJlbnRQcm9qZWN0O1xufTtcblxuLy8gb3R0ZW5nbyBpbCBwcm9nZXR0byBkYWwgc3VvIGdpZDsgcml0b3JuYSB1bmEgcHJvbWlzZSBuZWwgY2FzbyBub24gZm9zc2Ugc3RhdG8gYW5jb3JhIHNjYXJpY2F0byBpbCBjb25maWcgY29tcGxldG8gKGUgcXVpbmRpIG5vbiBzaWEgYW5jb3JhIGlzdGFuemlhdG8gUHJvamVjdClcbnByb3RvLmdldFByb2plY3QgPSBmdW5jdGlvbihwcm9qZWN0R2lkKXtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICB2YXIgZCA9ICQuRGVmZXJyZWQoKTtcbiAgdmFyIHBlbmRpbmdQcm9qZWN0ID0gZmFsc2U7XG4gIHZhciBwcm9qZWN0ID0gbnVsbDtcbiAgdGhpcy5fcGVuZGluZ1Byb2plY3RzLmZvckVhY2goZnVuY3Rpb24oX3BlbmRpbmdQcm9qZWN0KXtcbiAgICBpZiAoX3BlbmRpbmdQcm9qZWN0LmdpZCA9PSBwcm9qZWN0R2lkKSB7XG4gICAgICBwZW5kaW5nUHJvamVjdCA9IF9wZW5kaW5nUHJvamVjdDtcbiAgICAgIHByb2plY3QgPSBzZWxmLl9wcm9qZWN0c1twcm9qZWN0R2lkXTtcbiAgICB9XG4gIH0pXG4gIGlmICghcGVuZGluZ1Byb2plY3QpIHtcbiAgICByZXR1cm4gcmVqZWN0KFwiUHJvamVjdCBkb2Vzbid0IGV4aXN0XCIpO1xuICB9XG5cbiAgaWYgKHByb2plY3Qpe1xuICAgIHJldHVybiBkLnJlc29sdmUocHJvamVjdCk7XG4gIH1cbiAgZWxzZXtcbiAgICByZXR1cm4gdGhpcy5fZ2V0UHJvamVjdEZ1bGxDb25maWcocGVuZGluZ1Byb2plY3QpXG4gICAgLnRoZW4oZnVuY3Rpb24ocHJvamVjdEZ1bGxDb25maWcpe1xuICAgICAgdmFyIHByb2plY3RDb25maWcgPSBfLm1lcmdlKHBlbmRpbmdQcm9qZWN0LHByb2plY3RGdWxsQ29uZmlnKTtcbiAgICAgIHNlbGYuX2J1aWxkUHJvamVjdFRyZWUocHJvamVjdENvbmZpZyk7XG4gICAgICB2YXIgcHJvamVjdCA9IG5ldyBQcm9qZWN0KHByb2plY3RDb25maWcpO1xuICAgICAgcHJvamVjdC5zZXRHZXRXbXNVcmwoc2VsZi5jb25maWcuZ2V0V21zVXJsKTsgLy8gQlJVVFRPIE1BIFBFUiBPUkEgU0kgVElFTkUgQ09TSSdcbiAgICAgIHNlbGYuX3Byb2plY3RzW3Byb2plY3RDb25maWcuZ2lkXSA9IHByb2plY3Q7XG4gICAgICByZXR1cm4gZC5yZXNvbHZlKHByb2plY3QpO1xuICAgIH0pO1xuICB9XG4gIFxuICByZXR1cm4gZC5wcm9taXNlKCk7XG59O1xuICBcbi8vcml0b3JuYSB1bmEgcHJvbWlzZXNcbnByb3RvLl9nZXRQcm9qZWN0RnVsbENvbmZpZyA9IGZ1bmN0aW9uKHByb2plY3RCYXNlQ29uZmlnKXtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICB2YXIgZGVmZXJyZWQgPSAkLkRlZmVycmVkKCk7XG4gIHZhciB1cmwgPSB0aGlzLmNvbmZpZy5nZXRQcm9qZWN0Q29uZmlnVXJsKHByb2plY3RCYXNlQ29uZmlnKTtcbiAgJC5nZXQodXJsKS5kb25lKGZ1bmN0aW9uKHByb2plY3RGdWxsQ29uZmlnKXtcbiAgICAgIGRlZmVycmVkLnJlc29sdmUocHJvamVjdEZ1bGxDb25maWcpO1xuICB9KVxuICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZSgpO1xufTtcblxucHJvdG8uX2J1aWxkUHJvamVjdFRyZWUgPSBmdW5jdGlvbihwcm9qZWN0KXtcbiAgdmFyIGxheWVycyA9IF8ua2V5QnkocHJvamVjdC5sYXllcnMsJ2lkJyk7XG4gIHZhciBsYXllcnNUcmVlID0gXy5jbG9uZURlZXAocHJvamVjdC5sYXllcnN0cmVlKTtcbiAgXG4gIGZ1bmN0aW9uIHRyYXZlcnNlKG9iail7XG4gICAgXy5mb3JJbihvYmosIGZ1bmN0aW9uIChsYXllciwga2V5KSB7XG4gICAgICAvL3ZlcmlmaWNhIGNoZSBpbCBub2RvIHNpYSB1biBsYXllciBlIG5vbiB1biBmb2xkZXJcbiAgICAgIGlmICghXy5pc05pbChsYXllci5pZCkpIHtcbiAgICAgICAgICB2YXIgZnVsbGxheWVyID0gXy5tZXJnZShsYXllcixsYXllcnNbbGF5ZXIuaWRdKTtcbiAgICAgICAgICBvYmpbcGFyc2VJbnQoa2V5KV0gPSBmdWxsbGF5ZXI7XG4gICAgICAgICAgdmFyIGEgPTE7XG4gICAgICB9XG4gICAgICBpZiAoIV8uaXNOaWwobGF5ZXIubm9kZXMpKXtcbiAgICAgICAgLy8gYWdnaXVuZ28gcHJvcHJpZXTDoCB0aXRsZSBwZXIgbCdhbGJlcm9cbiAgICAgICAgbGF5ZXIudGl0bGUgPSBsYXllci5uYW1lO1xuICAgICAgICB0cmF2ZXJzZShsYXllci5ub2Rlcyk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cbiAgdHJhdmVyc2UobGF5ZXJzVHJlZSk7XG4gIHByb2plY3QubGF5ZXJzdHJlZSA9IGxheWVyc1RyZWU7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IG5ldyBQcm9qZWN0c1JlZ2lzdHJ5KCk7XG4iLCJ2YXIgUHJvamVjdFR5cGVzID0ge1xuICBRREpBTkdPOiAncWRqYW5nbycsXG4gIE9HUjogJ29ncidcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gUHJvamVjdFR5cGVzOyIsInZhciBpbmhlcml0ID0gcmVxdWlyZSgnY29yZS91dGlscy91dGlscycpLmluaGVyaXQ7XG52YXIgYmFzZSA9IHJlcXVpcmUoJ2NvcmUvdXRpbHMvdXRpbHMnKS5iYXNlO1xudmFyIEJhc2U2NCA9IHJlcXVpcmUoJ2NvcmUvdXRpbHMvdXRpbHMnKS5CYXNlNjQ7XG52YXIgRzNXT2JqZWN0ID0gcmVxdWlyZSgnY29yZS9nM3dvYmplY3QnKTtcblxudmFyIFJvdXRlclNlcnZpY2UgPSBmdW5jdGlvbigpe1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIHRoaXMuX3JvdXRlID0gJyc7XG4gIHRoaXMuc2V0dGVycyA9IHtcbiAgICBzZXRSb3V0ZTogZnVuY3Rpb24ocGF0aCl7XG4gICAgICB0aGlzLl9yb3V0ZSA9IHBhdGg7XG4gICAgfVxuICB9XG4gIFxuICBIaXN0b3J5LkFkYXB0ZXIuYmluZCh3aW5kb3csJ3N0YXRlY2hhbmdlJyxmdW5jdGlvbigpeyAvLyBOb3RlOiBXZSBhcmUgdXNpbmcgc3RhdGVjaGFuZ2UgaW5zdGVhZCBvZiBwb3BzdGF0ZVxuICAgICAgdmFyIHN0YXRlID0gSGlzdG9yeS5nZXRTdGF0ZSgpOyAvLyBOb3RlOiBXZSBhcmUgdXNpbmcgSGlzdG9yeS5nZXRTdGF0ZSgpIGluc3RlYWQgb2YgZXZlbnQuc3RhdGVcbiAgICAgIHZhciBoYXNoID0gc3RhdGUuaGFzaDtcbiAgICAgIHNlbGYuc2V0Um91dGVGcm9tSGFzaChoYXNoKTtcbiAgfSk7XG4gIFxuICBiYXNlKHRoaXMpO1xufTtcbmluaGVyaXQoUm91dGVyU2VydmljZSxHM1dPYmplY3QpO1xuXG52YXIgcHJvdG8gPSBSb3V0ZXJTZXJ2aWNlLnByb3RvdHlwZTtcblxucHJvdG8uaW5pdFJvdXRlID0gZnVuY3Rpb24oKXtcbiAgdmFyIGZpcnN0SGFzaCA9IHdpbmRvdy5sb2NhdGlvbi5zZWFyY2g7XG4gIHRoaXMuc2V0Um91dGVGcm9tSGFzaChmaXJzdEhhc2gpO1xufVxuXG5wcm90by5nb3RvID0gZnVuY3Rpb24ocGF0aCl7XG4gIHZhciBwYXRoYjY0ID0gQmFzZTY0LmVuY29kZShwYXRoKTtcbiAgSGlzdG9yeS5wdXNoU3RhdGUoe3BhdGg6cGF0aH0sbnVsbCwnP3A9JytwYXRoYjY0KTtcbiAgLy90aGlzLnNldFJvdXRlKHBhdGgpO1xufTtcblxucHJvdG8uc2V0Um91dGVGcm9tSGFzaCA9IGZ1bmN0aW9uKGhhc2gpIHtcbiAgdmFyIHBhdGhiNjQgPSB0aGlzLmdldFF1ZXJ5UGFyYW1zKGhhc2gpWydwJ107XG4gIHZhciBwYXRoID0gcGF0aGI2NCA/IEJhc2U2NC5kZWNvZGUocGF0aGI2NCkgOiAnJztcbiAgdGhpcy5zZXRSb3V0ZShwYXRoKTtcbn1cblxucHJvdG8uc2xpY2VQYXRoID0gZnVuY3Rpb24ocGF0aCl7XG4gIHJldHVybiBwYXRoLnNwbGl0KCc/JylbMF0uc3BsaXQoJy8nKTtcbn07XG4gIFxucHJvdG8uc2xpY2VGaXJzdCA9IGZ1bmN0aW9uKHBhdGgpe1xuICB2YXIgcGF0aEFuZFF1ZXJ5ID0gcGF0aC5zcGxpdCgnPycpO1xuICB2YXIgcXVlcnlTdHJpbmcgPSBwYXRoQW5kUXVlcnlbMV07XG4gIHZhciBwYXRoQXJyID0gcGF0aEFuZFF1ZXJ5WzBdLnNwbGl0KCcvJylcbiAgdmFyIGZpcnN0UGF0aCA9IHBhdGhBcnJbMF07XG4gIHBhdGggPSBwYXRoQXJyLnNsaWNlKDEpLmpvaW4oJy8nKTtcbiAgcGF0aCA9IFtwYXRoLHF1ZXJ5U3RyaW5nXS5qb2luKCc/JylcbiAgcmV0dXJuIFtmaXJzdFBhdGgscGF0aF07XG59O1xuICBcbnByb3RvLmdldFF1ZXJ5UGFyYW1zID0gZnVuY3Rpb24ocGF0aCl7XG4gIHZhciBxdWVyeVBhcmFtcyA9IHt9O1xuICB0cnkge1xuICAgIHZhciBxdWVyeVN0cmluZyA9IHBhdGguc3BsaXQoJz8nKVsxXTtcbiAgICB2YXIgcXVlcnlQYWlycyA9IHF1ZXJ5U3RyaW5nLnNwbGl0KCcmJyk7XG4gICAgdmFyIHF1ZXJ5UGFyYW1zID0ge307XG4gICAgXy5mb3JFYWNoKHF1ZXJ5UGFpcnMsZnVuY3Rpb24ocXVlcnlQYWlyKXtcbiAgICAgIHZhciBwYWlyID0gcXVlcnlQYWlyLnNwbGl0KCc9Jyk7XG4gICAgICB2YXIga2V5ID0gcGFpclswXTtcbiAgICAgIHZhciB2YWx1ZSA9IHBhaXJbMV07XG4gICAgICBxdWVyeVBhcmFtc1trZXldID0gdmFsdWU7XG4gICAgfSk7XG4gIH1cbiAgY2F0Y2ggKGUpIHt9XG4gIHJldHVybiBxdWVyeVBhcmFtcztcbn07XG5cbnByb3RvLmdldFF1ZXJ5U3RyaW5nID0gZnVuY3Rpb24ocGF0aCl7XG4gIHJldHVybiBwYXRoLnNwbGl0KCc/JylbMV07XG59O1xuICBcbnByb3RvLm1ha2VRdWVyeVN0cmluZyA9IGZ1bmN0aW9uKHF1ZXJ5UGFyYW1zKXt9O1xuXG5tb2R1bGUuZXhwb3J0cyA9IG5ldyBSb3V0ZXJTZXJ2aWNlO1xuIiwidmFyIGluaGVyaXQgPSByZXF1aXJlKCdjb3JlL3V0aWxzL3V0aWxzJykuaW5oZXJpdDtcbnZhciBiYXNlID0gcmVxdWlyZSgnY29yZS91dGlscy91dGlscycpLmJhc2U7XG52YXIgRzNXT2JqZWN0ID0gcmVxdWlyZSgnY29yZS9nM3dvYmplY3QnKTtcbnZhciByZXNvbHZlID0gcmVxdWlyZSgnY29yZS91dGlscy91dGlscycpLnJlc29sdmU7XG52YXIgUHJvamVjdHNSZWdpc3RyeSA9IHJlcXVpcmUoJ2NvcmUvcHJvamVjdC9wcm9qZWN0c3JlZ2lzdHJ5Jyk7XG5cblxuLy8gRklMVFJJXG52YXIgRmlsdGVycyA9IHtcbiAgZXE6ICc9JyxcbiAgZ3Q6ICc+JyxcbiAgZ3RlOiAnPj0nLFxuICBsdDogJzwnLFxuICBsdGU6ICc9PCcsXG4gIExJS0U6ICdMSUtFJyxcbiAgSUxJS0U6ICdJTElLRScsXG4gIEFORDogJ0FORCcsXG4gIE9SOiAnT1InLFxuICBOT1Q6ICchPSdcbn07XG5cbmZ1bmN0aW9uIFF1ZXJ5UUdJU1dNU1Byb3ZpZGVyKCkge1xuXG4gIHNlbGYgPSB0aGlzO1xuICAvL2Z1bnppb25lIGNoZSBmYSBsYSByaWNoaWVzdGEgdmVyYSBlIHByb3ByaWEgYWwgc2VydmVyIHFnaXNcbiAgdGhpcy5zdWJtaXRHZXRGZWF0dXJlSW5mbyA9IGZ1bmN0aW9uKG9wdGlvbnMpIHtcblxuICAgIHZhciB1cmwgPSBvcHRpb25zLnVybCB8fCAnJztcbiAgICB2YXIgcXVlcnlsYXllciA9IG9wdGlvbnMucXVlcnlsYXllciB8fCBudWxsO1xuICAgIHZhciBmaWx0ZXIgPSBvcHRpb25zLmZpbHRlciB8fCBudWxsO1xuICAgIHZhciBiYm94ID0gb3B0aW9ucy5iYm94IHx8IFByb2plY3RzUmVnaXN0cnkuZ2V0Q3VycmVudFByb2plY3QoKS5zdGF0ZS5leHRlbnQuam9pbignLCcpO1xuICAgIHZhciBzaW1wbGVXbXNTZWFyY2hNYXhSZXN1bHRzID0gbnVsbDtcbiAgICB2YXIgY3JzID0gb3B0aW9ucy5jcnMgfHwgJzQzMjY7J1xuICAgIHJldHVybiAkLmdldCggdXJsLCB7XG4gICAgICAgICdTRVJWSUNFJzogJ1dNUycsXG4gICAgICAgICdWRVJTSU9OJzogJzEuMy4wJyxcbiAgICAgICAgJ1JFUVVFU1QnOiAnR2V0RmVhdHVyZUluZm8nLFxuICAgICAgICAnTEFZRVJTJzogcXVlcnlsYXllcixcbiAgICAgICAgJ1FVRVJZX0xBWUVSUyc6IHF1ZXJ5bGF5ZXIsXG4gICAgICAgICdGRUFUVVJFX0NPVU5UJzogc2ltcGxlV21zU2VhcmNoTWF4UmVzdWx0cyB8fCAgNTAsXG4gICAgICAgICdJTkZPX0ZPUk1BVCc6ICd0ZXh0L3htbCcsXG4gICAgICAgICdDUlMnOiAnRVBTRzonKyBjcnMsXG4gICAgICAgICdGSUxURVInOiBmaWx0ZXIsXG4gICAgICAgIC8vIFRlbXBvcmFyeSBmaXggZm9yIGh0dHBzOi8vaHViLnFnaXMub3JnL2lzc3Vlcy84NjU2IChmaXhlZCBpbiBRR0lTIG1hc3RlcilcbiAgICAgICAgJ0JCT1gnOiBiYm94IC8vIFFVSSBDSSBWQSBJTCBCQk9YIERFTExBIE1BUFBBXG4gICAgICB9XG4gICAgKTtcbiAgIH07XG5cbiAgLy9mdW56aW9uZSBjaGUgZmEgbGEgcmljZXJjYVxuICB0aGlzLmRvU2VhcmNoID0gZnVuY3Rpb24ocXVlcnlGaWx0ZXJPYmplY3QpIHtcblxuICAgIHZhciB1cmwgPSBxdWVyeUZpbHRlck9iamVjdC51cmw7XG4gICAgdmFyIHF1ZXJ5bGF5ZXIgPSBxdWVyeUZpbHRlck9iamVjdC5xdWVyeWxheWVyO1xuICAgIHZhciBmaWx0ZXJPYmplY3QgPSBxdWVyeUZpbHRlck9iamVjdC5maWx0ZXJPYmplY3Q7XG4gICAgdmFyIGNycyA9IHF1ZXJ5RmlsdGVyT2JqZWN0LmNycztcbiAgICAvL2NyZW8gaWwgZmlsdHJvXG4gICAgdmFyIGZpbHRlciA9IHRoaXMuY3JlYXRlRmlsdGVyKGZpbHRlck9iamVjdCwgcXVlcnlsYXllcik7XG4gICAgLy9lc2VndW8gbGEgcmljaGllc3RhIGUgcmVzdGl0dWlzY28gY29tZSByaXNwb3N0YSBsYSBwcm9taXNlIGRlbCAkLmdldFxuICAgIHZhciByZXNwb25zZSA9IHRoaXMuc3VibWl0R2V0RmVhdHVyZUluZm8oe1xuICAgICAgdXJsOiB1cmwsXG4gICAgICBjcnM6IGNycyxcbiAgICAgIGZpbHRlcjogZmlsdGVyLFxuICAgICAgcXVlcnlsYXllcjogcXVlcnlsYXllclxuICAgIH0pO1xuICAgIHJldHVybiByZXNwb25zZTtcbiAgfTtcblxuICB0aGlzLmNyZWF0ZUZpbHRlciA9IGZ1bmN0aW9uKGZpbHRlck9iamVjdCwgcXVlcnlsYXllcikge1xuXG4gICAgLy8vLy9pbnNlcmlzY28gaWwgbm9tZSBkZWwgbGF5ZXIgKHR5cGVuYW1lKSAvLy9cbiAgICB2YXIgZmlsdGVyID0gW107XG4gICAgZnVuY3Rpb24gY3JlYXRlU2luZ2xlRmlsdGVyKGJvb2xlYW5PYmplY3QpIHtcbiAgICAgIHZhciBmaWx0ZXJFbGVtZW50cyA9IFtdO1xuICAgICAgdmFyIGZpbHRlckVsZW1lbnQgPSAnJztcbiAgICAgIHZhciB2YWx1ZUV4dHJhID0gXCJcIjtcbiAgICAgIHZhciB2YWx1ZVF1b3RlcyA9IFwiXCI7XG4gICAgICB2YXIgcm9vdEZpbHRlcjtcbiAgICAgIF8uZm9yRWFjaChib29sZWFuT2JqZWN0LCBmdW5jdGlvbih2LCBrLCBvYmopIHtcbiAgICAgICAgLy9jcmVvIGlsIGZpbHRybyByb290IGNoZSBzYXLDoCBBTkQgT1JcbiAgICAgICAgcm9vdEZpbHRlciA9IEZpbHRlcnNba107XG4gICAgICAgIC8vcXVpIGMnw6ggYXJyYXkgZGVnbGkgZWxlbWVudGkgZGkgdW4gYm9vbGVhbm9cbiAgICAgICAgXy5mb3JFYWNoKHYsIGZ1bmN0aW9uKGlucHV0KXtcbiAgICAgICAgICAvL3Njb3JybyBzdSBvZ2dldHRvXG4gICAgICAgICAgXy5mb3JFYWNoKGlucHV0LCBmdW5jdGlvbih2LCBrLCBvYmopIHtcbiAgICAgICAgICAvL3ZlcmlmaWNvIHNlIGlsIHZhbG9yZSBkZWxsJ29nZ2V0dG8gw6ggYXJyYXkgZSBxdWluZGkgw6ggYWx0cm8gb2dnZXR0byBwYWRyZSBib29sZWFub1xuICAgICAgICAgICAgaWYgKF8uaXNBcnJheSh2KSkge1xuICAgICAgICAgICAgICBmaWx0ZXJFbGVtZW50ID0gY3JlYXRlU2luZ2xlRmlsdGVyKG9iaik7XG4gICAgICAgICAgICB9IGVsc2UgeyAvLyDDqCB1biBvZ2dldHRvIG9wZXJhdG9yZVxuICAgICAgICAgICAgICBpZiAoayA9PSAnTElLRScgfHwgayA9PSAnSUxJS0UnKSB7XG4gICAgICAgICAgICAgICAgdmFsdWVFeHRyYSA9IFwiJVwiO1xuICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICBmaWx0ZXJPcCA9IEZpbHRlcnNba107XG4gICAgICAgICAgICAgIF8uZm9yRWFjaChpbnB1dCwgZnVuY3Rpb24odiwgaywgb2JqKSB7XG4gICAgICAgICAgICAgICAgXy5mb3JFYWNoKHYsIGZ1bmN0aW9uKHYsIGssIG9iaikge1xuICAgICAgICAgICAgICAgICAgLy92ZXJpZmljbyBzZSBpbCB2YWxvcmUgbm9uIMOoIHVuIG51bWVybyBlIHF1aW5kaSBhZ2dpdW5nbyBzaW5nb2xvIGFwaWNlXG4gICAgICAgICAgICAgICAgICBpZihpc05hTih2KSkge1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZVF1b3RlcyA9IFwiJ1wiO1xuICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWVRdW90ZXMgPSBcIlwiO1xuICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgIGZpbHRlckVsZW1lbnQgPSBcIlxcXCJcIiArIGsgKyBcIlxcXCIgXCIrIGZpbHRlck9wICtcIiBcIiArIHZhbHVlUXVvdGVzICsgdmFsdWVFeHRyYSArIHYgKyB2YWx1ZUV4dHJhICsgdmFsdWVRdW90ZXM7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGZpbHRlckVsZW1lbnRzLnB1c2goZmlsdGVyRWxlbWVudCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgICByb290RmlsdGVyID0gZmlsdGVyRWxlbWVudHMuam9pbihcIiBcIisgcm9vdEZpbHRlciArIFwiIFwiKTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHJvb3RGaWx0ZXI7XG4gICAgfTtcbiAgICAvL2Fzc2Vnbm8gaWwgZmlsdHJvIGNyZWF0b1xuICAgIGZpbHRlciA9IHF1ZXJ5bGF5ZXIgKyBcIjpcIiArIGNyZWF0ZVNpbmdsZUZpbHRlcihmaWx0ZXJPYmplY3QpO1xuICAgIHJldHVybiBmaWx0ZXI7XG4gIH07XG5cbn07XG5cbmluaGVyaXQoUXVlcnlRR0lTV01TUHJvdmlkZXIsIEczV09iamVjdCk7XG5cbm1vZHVsZS5leHBvcnRzID0gIG5ldyBRdWVyeVFHSVNXTVNQcm92aWRlcigpO1xuIiwidmFyIGluaGVyaXQgPSByZXF1aXJlKCdjb3JlL3V0aWxzL3V0aWxzJykuaW5oZXJpdDtcbnZhciBiYXNlID0gcmVxdWlyZSgnY29yZS91dGlscy91dGlscycpLmJhc2U7XG52YXIgRzNXT2JqZWN0ID0gcmVxdWlyZSgnY29yZS9nM3dvYmplY3QnKTtcbnZhciByZXNvbHZlID0gcmVxdWlyZSgnY29yZS91dGlscy91dGlscycpLnJlc29sdmU7XG4vL2RlZmluaXNjbyBpbCBmaWx0cm8gb2wzXG52YXIgb2wzT0dDRmlsdGVyID0gb2wuZm9ybWF0Lm9nYy5maWx0ZXI7XG5cbi8vb2dnZXR0byBjaGUgdmllbmUgcGFzc2F0byBwZXIgZWZmZXR0dXJhcmUgaWwgbGEgc2VhcmNoXG52YXIgb2wzR2V0RmVhdHVyZVJlcXVlc3RPYmplY3QgPSB7XG4gIHNyc05hbWU6ICdFUFNHOicsXG4gIGZlYXR1cmVOUzogJycsXG4gIGZlYXR1cmVQcmVmaXg6ICcnLFxuICBmZWF0dXJlVHlwZXM6IFtdLFxuICBvdXRwdXRGb3JtYXQ6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgZmlsdGVyOiBudWxsIC8vIGVzZW1waW8gZmlsdHJvIGNvbXBvc3RvIG9sM09HQ0ZpbHRlci5hbmQob2wzT0dDRmlsdGVyLmJib3goJ3RoZV9nZW9tJywgWzEsIDIsIDMsIDRdLCAndXJuOm9nYzpkZWY6Y3JzOkVQU0c6OjQzMjYnKSxvbDNPR0NGaWx0ZXIubGlrZSgnbmFtZScsICdOZXcqJykpXG59O1xuXG4vLyBGSUxUUkkgT0wzXG52YXIgb2wzRmlsdGVycyA9IHtcbiAgZXE6IG9sM09HQ0ZpbHRlci5lcXVhbFRvLFxuICBndDogb2wzT0dDRmlsdGVyLmdyZWF0ZXJUaGFuLFxuICBndGU6IG9sM09HQ0ZpbHRlci5ncmVhdGVyVGhhbk9yRXF1YWxUbyxcbiAgbHQ6IG9sM09HQ0ZpbHRlci5sZXNzVGhhbixcbiAgbHRlOiBvbDNPR0NGaWx0ZXIubGVzc1RoYW5PckVxdWFsVG8sXG4gIGxpa2U6IG9sM09HQ0ZpbHRlci5saWtlLFxuICBpbGlrZTogXCJcIixcbiAgYmJveDogb2wzT0dDRmlsdGVyLmJib3gsXG4gIEFORDogb2wzT0dDRmlsdGVyLmFuZCxcbiAgT1I6IG9sM09HQ0ZpbHRlci5vcixcbiAgTk9UOiBvbDNPR0NGaWx0ZXIubm90XG59O1xuXG5cbi8vIENSRUFUTyBVTiBGSUxUUk8gREkgRVNFTVBJTyBQRVIgVkVSSUZJQ0FSRSBMQSBDT1JSRVRURVpaQSBERUxMQSBGVU5aSU9ORSBDUkVBWklPTkUgRklMVFJPXG52YXIgdGVzdEZpbHRlciA9IHtcbiAgJ0FORCc6XG4gICAgW1xuICAgICAge1xuICAgICAgICBlcTpcbiAgICAgICAgICB7XG4gICAgICAgICAgICBnaWQgOiAxMFxuICAgICAgICAgIH1cbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgICdPUic6XG4gICAgICAgICAgW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBlcToge1xuICAgICAgICAgICAgICAgIHBpcHBvIDogJ2xhbGxvJ1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBndDoge1xuICAgICAgICAgICAgICAgIGlkIDogNVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICBdXG4gICAgICB9XG4gICBdXG59XG4vLy8vLy8vLy8vLy8vL1xuXG4vLy9GSUxUUkkgQ1VTVE9NXG52YXIgc3RhbmRhcmRGaWx0ZXJUZW1wbGF0ZXMgPSBmdW5jdGlvbigpIHtcbiAgdmFyIGNvbW1vbiA9IHtcbiAgICBwcm9wZXJ0eU5hbWU6XG4gICAgICAgICAgXCI8UHJvcGVydHlOYW1lPlwiICtcbiAgICAgICAgICAgIFwiW1BST1BdXCIgK1xuICAgICAgICAgIFwiPC9Qcm9wZXJ0eU5hbWU+XCIsXG4gICAgbGl0ZXJhbDpcbiAgICAgICAgICBcIjxMaXRlcmFsPlwiICtcbiAgICAgICAgICAgIFwiW1ZBTFVFXVwiICtcbiAgICAgICAgICBcIjwvTGl0ZXJhbD5cIlxuICB9O1xuICByZXR1cm4ge1xuICAgIGVxOiBcIjxQcm9wZXJ0eUlzRXF1YWxUbz5cIiArXG4gICAgICAgICAgICBjb21tb24ucHJvcGVydHlOYW1lICtcbiAgICAgICAgICAgIGNvbW1vbi5saXRlcmFsICtcbiAgICAgICAgXCI8L1Byb3BlcnR5SXNFcXVhbFRvPlwiLFxuICAgIGd0OiBcIjxQcm9wZXJ0eUlzR3JlYXRlclRoYW4+XCIgK1xuICAgICAgICAgICAgY29tbW9uLnByb3BlcnR5TmFtZSArXG4gICAgICAgICAgICBjb21tb24ubGl0ZXJhbCArXG4gICAgICAgICBcIjwvUHJvcGVydHlJc0dyZWF0ZXJUaGFuPlwiLFxuICAgIGd0ZTpcIlwiLFxuICAgIGx0OiBcIlwiLFxuICAgIGx0ZTogXCJcIixcbiAgICBsaWtlOiBcIlwiLFxuICAgIGlsaWtlOiBcIlwiLFxuICAgIEFORDogXCI8QW5kPltBTkRdPC9BbmQ+XCIsXG4gICAgT1I6IFwiPE9yPltPUl08L09yPlwiLFxuICB9XG59KCk7XG5cbi8vLy8vXG52YXIgcWdpc0ZpbHRlclRlbXBsYXRlcyA9IHtcbiAgLy8gY29kaWNlIHF1aVxufTtcblxudmFyIG1hcHNlcnZlckZpbHRlclRlbXBsYXRlcyA9IHtcbiAgLy8gY29kaWNlIHF1aVxufTtcblxudmFyIGdlb3NlcnZlckZpbHRlclRlbXBsYXRlcyA9IHtcbiAgLy8gY29kaWNlIHF1aVxufTtcblxuZnVuY3Rpb24gUXVlcnlXRlNQcm92aWRlcigpe1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIHZhciBkID0gJC5EZWZlcnJlZCgpO1xuICB2YXIgcmVzdWx0cyA9IHtcbiAgICBoZWFkZXJzOltdLFxuICAgIHZhbHVlczpbXVxuICB9O1xuXG4gIHRoaXMuZG9TZWFyY2ggPSBmdW5jdGlvbihxdWVyeUZpbHRlck9iamVjdCl7XG4gICAgdmFyIG9nY3NlcnZlcnR5cGUgPSBxdWVyeUZpbHRlck9iamVjdC5zZXJ2ZXJ0eXBlO1xuICAgIHZhciB1cmwgPSBxdWVyeUZpbHRlck9iamVjdC51cmw7XG4gICAgdmFyIHF1ZXJ5bGF5ZXIgPSBxdWVyeUZpbHRlck9iamVjdC5xdWVyeWxheWVyO1xuICAgIHZhciBmaWx0ZXJPYmplY3QgPSBxdWVyeUZpbHRlck9iamVjdC5maWx0ZXJPYmplY3Q7XG4gICAgdmFyIGNycyA9IHF1ZXJ5RmlsdGVyT2JqZWN0LmNycztcbiAgICAvL3NldHRvIGlsIHNyc1xuICAgIG9sM0dldEZlYXR1cmVSZXF1ZXN0T2JqZWN0LnNyc05hbWUrPWNycyB8fCAnNDMyNic7XG4gICAgdmFyIHJlc3BvbnNlLCBmaWx0ZXI7XG4gICAgc3dpdGNoIChvZ2NzZXJ2ZXJ0eXBlKSB7XG4gICAgICBjYXNlICdPR0MnOlxuICAgICAgICBmaWx0ZXIgPSB0aGlzLmNyZWF0ZVN0YW5kYXJkRmlsdGVyKGZpbHRlck9iamVjdCwgcXVlcnlsYXllcik7XG4gICAgICAgIHJlc3BvbnNlID0gdGhpcy5zdGFuZGFyZFNlYXJjaCh1cmwsIGZpbHRlcik7XG4gICAgICAgIHJldHVybiByZXNvbHZlKHJlc3BvbnNlKVxuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ3FnaXMnOlxuICAgICAgICBmaWx0ZXIgPSB0aGlzLmNyZWF0ZVFnaXNGaWx0ZXIoZmlsdGVyT2JqZWN0KTtcbiAgICAgICAgcmVzcG9uc2UgPSB0aGlzLnFnaXNTZWFyY2gocXVlcnlsYXllciwgdXJsLCBmaWx0ZXIpO1xuICAgICAgICByZXR1cm4gcmVzb2x2ZShyZXNwb25zZSlcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdtYXBzZXJ2ZXInOlxuICAgICAgICBmaWx0ZXIgPSB0aGlzLmNyZWF0ZU1hcHNlcnZlckZpbHRlcihmaWx0ZXJPYmplY3QpO1xuICAgICAgICByZXNwb25zZSA9IHRoaXMubWFwc2VydmVyU2VhcmNoKHF1ZXJ5bGF5ZXIsIHVybCwgZmlsdGVyKTtcbiAgICAgICAgcmV0dXJuIHJlc29sdmUocmVzcG9uc2UpXG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnZ2Vvc2VydmVyJzpcbiAgICAgICAgZmlsdGVyID0gdGhpcy5jcmVhdGVHZW9zZXJ2ZXJGaWx0ZXIoZmlsdGVyT2JqZWN0KTtcbiAgICAgICAgcmVzcG9uc2UgPSB0aGlzLmdlb3NlcnZlclNlYXJjaChxdWVyeWxheWVyLCB1cmwsIGZpbHRlcik7XG4gICAgICAgIHJldHVybiByZXNvbHZlKHJlc3BvbnNlKVxuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHJldHVybiBmYWxzZVxuICAgIH1cbiAgfTtcblxuICB0aGlzLnN0YW5kYXJkU2VhcmNoID0gZnVuY3Rpb24odXJsLCBmaWx0ZXIpe1xuICAgIGNvbnNvbGUubG9nKGZpbHRlcilcbiAgfTtcbiAgdGhpcy5jcmVhdGVTdGFuZGFyZEZpbHRlciA9IGZ1bmN0aW9uKGZpbHRlck9iamVjdCwgcXVlcnlsYXllcikge1xuICAgIC8vLy8vaW5zZXJpc2NvIGlsIG5vbWUgZGVsIGxheWVyICh0eXBlbmFtZSkgLy8vXG4gICAgb2wzR2V0RmVhdHVyZVJlcXVlc3RPYmplY3QuZmVhdHVyZVR5cGVzLnB1c2gocXVlcnlsYXllcik7XG4gICAgdmFyIGZpbHRlciA9IFtdO1xuICAgIGZ1bmN0aW9uIGNyZWF0ZVNpbmdsZUZpbHRlcihib29sZWFuT2JqZWN0KSB7XG4gICAgICB2YXIgZmlsdGVyRWxlbWVudHMgPSBbXTtcbiAgICAgIHZhciBmaWx0ZXJFbGVtZW50ID0gJyc7XG4gICAgICB2YXIgcm9vdEZpbHRlcjtcbiAgICAgIF8uZm9yRWFjaChib29sZWFuT2JqZWN0LCBmdW5jdGlvbih2LCBrLCBvYmopIHtcbiAgICAgICAgLy9jcmVvIGlsIGZpbHRybyByb290IGNoZSBzYXLDoCBBTkQgT1JcbiAgICAgICAgcm9vdEZpbHRlciA9IG9sM0ZpbHRlcnNba107XG4gICAgICAgIC8vcXVpIGMnw6ggYXJyYXkgZGVnbGkgZWxlbWVudGkgZGkgdW4gYm9vbGVhbm9cbiAgICAgICAgXy5mb3JFYWNoKHYsIGZ1bmN0aW9uKGlucHV0KXtcbiAgICAgICAgICAvL3Njb3JybyBzdSBvZ2dldHRvIG9wZXJhdG9yZVxuICAgICAgICAgIF8uZm9yRWFjaChpbnB1dCwgZnVuY3Rpb24odiwgaywgb2JqKSB7XG4gICAgICAgICAgLy/DqCB1biBhcnJheSBlIHF1aW5kaSDDqCBhbHRybyBvZ2dldHRvIHBhZHJlIGJvb2xlYW5vXG4gICAgICAgICAgICBpZiAoXy5pc0FycmF5KHYpKSB7XG4gICAgICAgICAgICAgIGZpbHRlckVsZW1lbnQgPSBjcmVhdGVTaW5nbGVGaWx0ZXIob2JqKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIGZpbHRlckVsZW1lbnQgPSBvbDNGaWx0ZXJzW2tdO1xuICAgICAgICAgICAgICBfLmZvckVhY2goaW5wdXQsIGZ1bmN0aW9uKHYsIGssIG9iaikge1xuICAgICAgICAgICAgICAgIF8uZm9yRWFjaCh2LCBmdW5jdGlvbih2LCBrLCBvYmopIHtcbiAgICAgICAgICAgICAgICAgIGZpbHRlckVsZW1lbnQgPSBmaWx0ZXJFbGVtZW50KGssIHYpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBmaWx0ZXJFbGVtZW50cy5wdXNoKGZpbHRlckVsZW1lbnQpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgLy92ZXJpZmljbyBjaGUgY2kgc2lhbm8gYWxtZW5vIGR1ZSBjb25kaXppb25lIG5lbCBmaWx0cm8gQU5ELiBOZWwgY2FzbyBkaSB1bmEgc29sYSBjb25kaXppb25lIChlc2VtcGlvIDogdW4gc29sbyBpbnB1dClcbiAgICAgICAgLy9lc3RyYWdnbyBzb2xvIGwnZWxlbWVudG8gZmlsdHJvIGFsdHJpbWVudGkgZGEgZXJyb3JlIC0tIERBIFZFUklGSUNBUkUgU0UgQ0FNQklBUkxPXG4gICAgICAgIGlmIChmaWx0ZXJFbGVtZW50cy5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgcm9vdEZpbHRlciA9IHJvb3RGaWx0ZXIuYXBwbHkodGhpcywgZmlsdGVyRWxlbWVudHMpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJvb3RGaWx0ZXIgPSBmaWx0ZXJFbGVtZW50c1swXTtcbiAgICAgICAgfTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHJvb3RGaWx0ZXI7XG4gICAgfTtcbiAgICAvL2Fzc2Vnbm8gaWwgZmlsdHJvIGNyZWF0b1xuICAgIG9sM0dldEZlYXR1cmVSZXF1ZXN0T2JqZWN0LmZpbHRlciA9IGNyZWF0ZVNpbmdsZUZpbHRlcihmaWx0ZXJPYmplY3QpO1xuICAgIC8vY3JlbyBpbCBmaWx0cm8gdXRpbGl6emFuZG8gb2wzXG4gICAgZmlsdGVyID0gbmV3IG9sLmZvcm1hdC5XRlMoKS53cml0ZUdldEZlYXR1cmUob2wzR2V0RmVhdHVyZVJlcXVlc3RPYmplY3QpO1xuICAgIHJldHVybiBmaWx0ZXI7XG4gIH07XG5cbiAgdGhpcy5xZ2lzU2VhcmNoID0gZnVuY3Rpb24odXJscywgZmlsdGVyKXtcbiAgICAkLmdldChzZWFyY2hVcmwpLnRoZW4oZnVuY3Rpb24ocmVzdWx0KXtcbiAgICAgIHNlbGYuZW1pdChcInNlYXJjaGRvbmVcIixyZXN1bHQpO1xuICAgIH0pO1xuICAgIHJldHVybiBkLnByb21pc2UoKTtcbiAgfTtcbiAgdGhpcy5jcmVhdGVRR2lzRmlsdGVyID0gZnVuY3Rpb24oZmlsdGVyT2JqZWN0KSB7XG4gICAgdmFyIGZpbHRlcjtcbiAgICByZXR1cm4gZmlsdGVyXG4gIH07XG4gIHRoaXMubWFwc2VydmVyU2VhcmNoID0gZnVuY3Rpb24ocXVlcnlsYXllciwgdXJsLCBmaWx0ZXIpe1xuICAgIHJldHVybiBkLnByb21pc2UoKTtcbiAgfTtcbiAgdGhpcy5jcmVhdGVNYXBzZXJ2ZXJGaWx0ZXIgPSBmdW5jdGlvbihmaWx0ZXJPYmplY3QpIHtcbiAgICB2YXIgZmlsdGVyO1xuICAgIHJldHVybiBmaWx0ZXJcbiAgfTtcbiAgdGhpcy5nZW9zZXJ2ZXJTZWFyY2ggPSBmdW5jdGlvbihxdWVyeWxheWVyLCB1cmwsIGZpbHRlcil7XG4gICAgcmV0dXJuIGQucHJvbWlzZSgpO1xuICB9O1xuICB0aGlzLmNyZWF0ZUdlb3NlcnZlckZpbHRlciA9IGZ1bmN0aW9uKGZpbHRlck9iamVjdCkge1xuICAgIHZhciBmaWx0ZXI7XG4gICAgcmV0dXJuIGZpbHRlclxuICB9O1xuICBiYXNlKHRoaXMpO1xufVxuaW5oZXJpdChRdWVyeVdGU1Byb3ZpZGVyLEczV09iamVjdCk7XG5cbm1vZHVsZS5leHBvcnRzID0gIG5ldyBRdWVyeVdGU1Byb3ZpZGVyKClcblxuIiwidmFyIGluaGVyaXQgPSByZXF1aXJlKCdjb3JlL3V0aWxzL3V0aWxzJykuaW5oZXJpdDtcbnZhciBiYXNlID0gcmVxdWlyZSgnY29yZS91dGlscy91dGlscycpLmJhc2U7XG52YXIgRzNXT2JqZWN0ID0gcmVxdWlyZSgnY29yZS9nM3dvYmplY3QnKTtcbnZhciBQcm9qZWN0c1JlZ2lzdHJ5ID0gcmVxdWlyZSgnY29yZS9wcm9qZWN0L3Byb2plY3RzcmVnaXN0cnknKTtcbnZhciBRdWVyeVdGU1Byb3ZpZGVyID0gcmVxdWlyZSgnLi9xdWVyeVdGU1Byb3ZpZGVyJyk7XG52YXIgUXVlcnlRR0lTV01TUHJvdmlkZXIgPSByZXF1aXJlKCcuL3F1ZXJ5UUdJU1dNU1Byb3ZpZGVyJyk7XG5cbnZhciBQcm92aWRlciA9IHtcbiAgJ1FHSVMnOiBRdWVyeVFHSVNXTVNQcm92aWRlcixcbiAgJ09HQyc6IFF1ZXJ5V0ZTUHJvdmlkZXJcbn07XG5cbmZ1bmN0aW9uIFNlYXJjaFF1ZXJ5U2VydmljZSgpe1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIHRoaXMudXJsID0gXCJcIjtcbiAgdGhpcy5maWx0ZXJPYmplY3QgPSB7fTtcbiAgdGhpcy5xdWVyeUZpbHRlck9iamVjdCA9IHt9O1xuXG4gIHRoaXMuc2V0RmlsdGVyT2JqZWN0ID0gZnVuY3Rpb24oZmlsdGVyT2JqZWN0KXtcbiAgICB0aGlzLmZpbHRlck9iamVjdCA9IGZpbHRlck9iamVjdDtcbiAgfTtcblxuICB0aGlzLmdldEZpbHRlck9iamVjdCA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLmZpbHRlck9iamVjdDtcbiAgfTtcbiAgLy9kYXRvIGwnb2dnZXR0byBmaWx0ZXIgcmVzdGl0dWl0byBkYWwgc2VydmVyIHJpY29zdHJ1aXNjbyBsYSBzdHJ1dHR1cmEgZGVsIGZpbHRlck9iamVjdFxuICAvL2ludGVycHJldGF0byBkYSBxdWVyeVdNU1Byb3ZpZGVyXG4gIHRoaXMuY3JlYXRlUXVlcnlGaWx0ZXJGcm9tQ29uZmlnID0gZnVuY3Rpb24oZmlsdGVyKSB7XG5cbiAgICB2YXIgcXVlcnlGaWx0ZXIgPSB7fTtcbiAgICB2YXIgYXR0cmlidXRlO1xuICAgIHZhciBvcGVyYXRvcjtcbiAgICB2YXIgZmllbGQ7XG4gICAgdmFyIG9wZXJhdG9yT2JqZWN0ID0ge307XG4gICAgdmFyIGJvb2xlYW5PYmplY3QgPSB7fTtcbiAgICAvL2Z1bnppb25lIGNoZSBjb3N0cnVpc2NlIGwnb2dnZXR0byBvcGVyYXRvcmUgZXMuIHsnPSc6eydub21lY2FtcG8nOm51bGx9fVxuICAgIGZ1bmN0aW9uIGNyZWF0ZU9wZXJhdG9yT2JqZWN0KG9iaikge1xuICAgICAgLy9yaW5pemlhbGl6em8gYSBvZ2dldHRvIHZ1b3RvXG4gICAgICBldmFsT2JqZWN0ID0ge307XG4gICAgICAvL3ZlcmlmaWNvIGNoZSBsJ29nZ2V0dG8gcGFzc2F0byBub24gc2lhIGEgc3VhIHZvbHRhIHVuIG9nZ2V0dG8gJ0JPT0xFQU5PJ1xuICAgICAgXy5mb3JFYWNoKG9iaiwgZnVuY3Rpb24odixrKSB7XG4gICAgICAgIGlmIChfLmlzQXJyYXkodikpIHtcbiAgICAgICAgICByZXR1cm4gY3JlYXRlQm9vbGVhbk9iamVjdChrLHYpO1xuICAgICAgICB9O1xuICAgICAgfSk7XG4gICAgICBmaWVsZCA9IG9iai5hdHRyaWJ1dGU7XG4gICAgICBvcGVyYXRvciA9IG9iai5vcDtcbiAgICAgIGV2YWxPYmplY3Rbb3BlcmF0b3JdID0ge307XG4gICAgICBldmFsT2JqZWN0W29wZXJhdG9yXVtmaWVsZF0gPSBudWxsO1xuICAgICAgcmV0dXJuIGV2YWxPYmplY3Q7XG4gICAgfTtcbiAgICAvL2Z1bmN0aW9uZSBjaGUgY29zdHJ1aXNjZSBvZ2dldHRpIEJPT0xFQU5JIGNhc28gQU5EIE9SIGNvbnRlbmVudGUgYXJyYXkgZGkgb2dnZXR0aSBmb3JuaXQgZGFsbGEgZnVuemlvbmUgY3JlYXRlT3BlcmF0b3JPYmplY3RcbiAgICBmdW5jdGlvbiBjcmVhdGVCb29sZWFuT2JqZWN0KGJvb2xlYW5PcGVyYXRvciwgb3BlcmF0aW9ucykge1xuICAgICAgYm9vbGVhbk9iamVjdCA9IHt9O1xuICAgICAgYm9vbGVhbk9iamVjdFtib29sZWFuT3BlcmF0b3JdID0gW107XG4gICAgICBfLmZvckVhY2gob3BlcmF0aW9ucywgZnVuY3Rpb24ob3BlcmF0aW9uKXtcbiAgICAgICAgYm9vbGVhbk9iamVjdFtib29sZWFuT3BlcmF0b3JdLnB1c2goY3JlYXRlT3BlcmF0b3JPYmplY3Qob3BlcmF0aW9uKSk7XG4gICAgICB9KVxuICAgICAgcmV0dXJuIGJvb2xlYW5PYmplY3Q7XG4gICAgfTtcbiAgICAvKlxuICAgIC8vIHZhZG8gYSBjcmVhcmUgbCdvZ2dldHRvIGZpbHRybyBwcmluY2lwYWxlLiBRdWVzdG8gw6ggdW4gb2dnZXR0byBjaGUgY29udGllbmUgbCdvcGVyYXRvcmUgYm9vbGVhbm8gY29tZSByb290IChjaGlhdmUpXG4gICAgLy8gY29tZSB2YWxvcmUgdW4gYXJyYXkgZGkgb2dnZXR0aSBvcGVyYXRvcmkgY2hlIGNvbnRlbmdvbm8gaWwgdGlwbyBkaSBvcGVyYXRvcmUgY29tZSBjaGlhdmUgZSBjb21lIHZhbG9yZSB1biBvZ2dldHRvIGNvbnRlbmV0ZVxuICAgIC8vIG5vbWUgY2FtcG8gZSB2YWxvcmUgcGFzc2F0b1xuICAgICovXG4gICAgXy5mb3JFYWNoKGZpbHRlciwgZnVuY3Rpb24odixrLG9iaikge1xuICAgICAgcXVlcnlGaWx0ZXIgPSBjcmVhdGVCb29sZWFuT2JqZWN0KGssdik7XG4gICAgfSk7XG4gICAgcmV0dXJuIHF1ZXJ5RmlsdGVyO1xuICB9O1xuXG4gIHRoaXMuY3JlYXRlUXVlcnlGaWx0ZXJPYmplY3QgPSBmdW5jdGlvbihsYXllcklkLCBmaWx0ZXJPYmplY3Qpe1xuICAgIHZhciBsYXllckluZm8gPSB0aGlzLmdldExheWVySW5mb1VybEZyb21Qcm9qZWN0Q29uZmlnKGxheWVySWQpO1xuICAgIHJldHVybiB7XG4gICAgICB0eXBlOiAnc3RhbmRhcmQnLFxuICAgICAgdXJsOiBsYXllckluZm8udXJsLFxuICAgICAgcXVlcnlsYXllcjogbGF5ZXJJbmZvLm5hbWUsXG4gICAgICBzZXJ2ZXJ0eXBlOiBsYXllckluZm8uc2VydmVydHlwZSxcbiAgICAgIGNyczogbGF5ZXJJbmZvLmNycyxcbiAgICAgIGZpbHRlck9iamVjdCA6IGZpbHRlck9iamVjdFxuICAgIH07XG4gIH07XG5cbiAgdGhpcy5nZXRMYXllckluZm9VcmxGcm9tUHJvamVjdENvbmZpZyA9IGZ1bmN0aW9uKGxheWVySWQpIHtcbiAgICB2YXIgbGF5ZXJGaWx0ZXJJbmZvID0ge307XG4gICAgdmFyIFByb2plY3QgPSBQcm9qZWN0c1JlZ2lzdHJ5LmdldEN1cnJlbnRQcm9qZWN0KCk7XG4gICAgdmFyIGxheWVySW5mbyA9IFByb2plY3QuZ2V0TGF5ZXJCeUlkKGxheWVySWQpO1xuICAgIGlmIChsYXllckluZm8pIHtcbiAgICAgIGxheWVyRmlsdGVySW5mby5uYW1lID0gbGF5ZXJJbmZvLm5hbWU7XG4gICAgICBsYXllckZpbHRlckluZm8uY3JzID0gbGF5ZXJJbmZvLmNycztcbiAgICAgIGxheWVyRmlsdGVySW5mby5zZXJ2ZXJ0eXBlID0gbGF5ZXJJbmZvLnNlcnZlcnR5cGU7XG4gICAgICBpZiAobGF5ZXJJbmZvLnNvdXJjZSAmJiBsYXllckluZm8uc291cmNlLnVybCl7XG4gICAgICAgIGxheWVyRmlsdGVySW5mby51cmwgPSBsYXllckluZm8uc291cmNlLnVybDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGxheWVyRmlsdGVySW5mby51cmwgPSBQcm9qZWN0LmdldFdtc1VybCgpO1xuICAgICAgfTtcbiAgICB9O1xuICAgIHJldHVybiBsYXllckZpbHRlckluZm87XG4gIH07XG5cbiAgdGhpcy5kb1F1ZXJ5U2VhcmNoID0gZnVuY3Rpb24ocXVlcnlGaWx0ZXJPYmplY3QpIHtcbiAgICB2YXIgcHJvdmlkZXIgPSBQcm92aWRlcltxdWVyeUZpbHRlck9iamVjdC5zZXJ2ZXJ0eXBlXTtcbiAgICBwcm92aWRlci5kb1NlYXJjaChxdWVyeUZpbHRlck9iamVjdClcbiAgICAudGhlbihmdW5jdGlvbihyZXN1bHQpe1xuICAgICAgY29uc29sZS5sb2cocmVzdWx0KTtcbiAgICAgIHNlbGYuZW1pdChcInNlYXJjaHJlc3VsdHNcIiwgcmVzdWx0KVxuICAgIH0pO1xuICB9O1xuICBiYXNlKHRoaXMpO1xufVxuaW5oZXJpdChTZWFyY2hRdWVyeVNlcnZpY2UsRzNXT2JqZWN0KTtcblxubW9kdWxlLmV4cG9ydHMgPSAgbmV3IFNlYXJjaFF1ZXJ5U2VydmljZVxuXG4iLCJcbi8qKlxuICogRGVjaW1hbCBhZGp1c3RtZW50IG9mIGEgbnVtYmVyLlxuICpcbiAqIEBwYXJhbSB7U3RyaW5nfSAgdHlwZSAgVGhlIHR5cGUgb2YgYWRqdXN0bWVudC5cbiAqIEBwYXJhbSB7TnVtYmVyfSAgdmFsdWUgVGhlIG51bWJlci5cbiAqIEBwYXJhbSB7SW50ZWdlcn0gZXhwICAgVGhlIGV4cG9uZW50ICh0aGUgMTAgbG9nYXJpdGhtIG9mIHRoZSBhZGp1c3RtZW50IGJhc2UpLlxuICogQHJldHVybnMge051bWJlcn0gVGhlIGFkanVzdGVkIHZhbHVlLlxuICovXG5mdW5jdGlvbiBkZWNpbWFsQWRqdXN0KHR5cGUsIHZhbHVlLCBleHApIHtcbiAgLy8gSWYgdGhlIGV4cCBpcyB1bmRlZmluZWQgb3IgemVyby4uLlxuICBpZiAodHlwZW9mIGV4cCA9PT0gJ3VuZGVmaW5lZCcgfHwgK2V4cCA9PT0gMCkge1xuICAgIHJldHVybiBNYXRoW3R5cGVdKHZhbHVlKTtcbiAgfVxuICB2YWx1ZSA9ICt2YWx1ZTtcbiAgZXhwID0gK2V4cDtcbiAgLy8gSWYgdGhlIHZhbHVlIGlzIG5vdCBhIG51bWJlciBvciB0aGUgZXhwIGlzIG5vdCBhbiBpbnRlZ2VyLi4uXG4gIGlmIChpc05hTih2YWx1ZSkgfHwgISh0eXBlb2YgZXhwID09PSAnbnVtYmVyJyAmJiBleHAgJSAxID09PSAwKSkge1xuICAgIHJldHVybiBOYU47XG4gIH1cbiAgLy8gU2hpZnRcbiAgdmFsdWUgPSB2YWx1ZS50b1N0cmluZygpLnNwbGl0KCdlJyk7XG4gIHZhbHVlID0gTWF0aFt0eXBlXSgrKHZhbHVlWzBdICsgJ2UnICsgKHZhbHVlWzFdID8gKCt2YWx1ZVsxXSAtIGV4cCkgOiAtZXhwKSkpO1xuICAvLyBTaGlmdCBiYWNrXG4gIHZhbHVlID0gdmFsdWUudG9TdHJpbmcoKS5zcGxpdCgnZScpO1xuICByZXR1cm4gKyh2YWx1ZVswXSArICdlJyArICh2YWx1ZVsxXSA/ICgrdmFsdWVbMV0gKyBleHApIDogZXhwKSk7XG59XG5cbi8vIERlY2ltYWwgcm91bmRcbmlmICghTWF0aC5yb3VuZDEwKSB7XG4gIE1hdGgucm91bmQxMCA9IGZ1bmN0aW9uKHZhbHVlLCBleHApIHtcbiAgICByZXR1cm4gZGVjaW1hbEFkanVzdCgncm91bmQnLCB2YWx1ZSwgZXhwKTtcbiAgfTtcbn1cbi8vIERlY2ltYWwgZmxvb3JcbmlmICghTWF0aC5mbG9vcjEwKSB7XG4gIE1hdGguZmxvb3IxMCA9IGZ1bmN0aW9uKHZhbHVlLCBleHApIHtcbiAgICByZXR1cm4gZGVjaW1hbEFkanVzdCgnZmxvb3InLCB2YWx1ZSwgZXhwKTtcbiAgfTtcbn1cbi8vIERlY2ltYWwgY2VpbFxuaWYgKCFNYXRoLmNlaWwxMCkge1xuICBNYXRoLmNlaWwxMCA9IGZ1bmN0aW9uKHZhbHVlLCBleHApIHtcbiAgICByZXR1cm4gZGVjaW1hbEFkanVzdCgnY2VpbCcsIHZhbHVlLCBleHApO1xuICB9O1xufVxuXG5TdHJpbmcucHJvdG90eXBlLmhhc2hDb2RlID0gZnVuY3Rpb24oKSB7XG4gIHZhciBoYXNoID0gMCwgaSwgY2hyLCBsZW47XG4gIGlmICh0aGlzLmxlbmd0aCA9PT0gMCkgcmV0dXJuIGhhc2g7XG4gIGZvciAoaSA9IDAsIGxlbiA9IHRoaXMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcbiAgICBjaHIgICA9IHRoaXMuY2hhckNvZGVBdChpKTtcbiAgICBoYXNoICA9ICgoaGFzaCA8PCA1KSAtIGhhc2gpICsgY2hyO1xuICAgIGhhc2ggfD0gMDtcbiAgfVxuICByZXR1cm4gaGFzaDtcbn07XG5cbnZhciBCYXNlNjQgPSB7X2tleVN0cjpcIkFCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXowMTIzNDU2Nzg5Ky89XCIsZW5jb2RlOmZ1bmN0aW9uKGUpe3ZhciB0PVwiXCI7dmFyIG4scixpLHMsbyx1LGE7dmFyIGY9MDtlPUJhc2U2NC5fdXRmOF9lbmNvZGUoZSk7d2hpbGUoZjxlLmxlbmd0aCl7bj1lLmNoYXJDb2RlQXQoZisrKTtyPWUuY2hhckNvZGVBdChmKyspO2k9ZS5jaGFyQ29kZUF0KGYrKyk7cz1uPj4yO289KG4mMyk8PDR8cj4+NDt1PShyJjE1KTw8MnxpPj42O2E9aSY2MztpZihpc05hTihyKSl7dT1hPTY0fWVsc2UgaWYoaXNOYU4oaSkpe2E9NjR9dD10K3RoaXMuX2tleVN0ci5jaGFyQXQocykrdGhpcy5fa2V5U3RyLmNoYXJBdChvKSt0aGlzLl9rZXlTdHIuY2hhckF0KHUpK3RoaXMuX2tleVN0ci5jaGFyQXQoYSl9cmV0dXJuIHR9LGRlY29kZTpmdW5jdGlvbihlKXt2YXIgdD1cIlwiO3ZhciBuLHIsaTt2YXIgcyxvLHUsYTt2YXIgZj0wO2U9ZS5yZXBsYWNlKC9bXkEtWmEtejAtOSsvPV0vZyxcIlwiKTt3aGlsZShmPGUubGVuZ3RoKXtzPXRoaXMuX2tleVN0ci5pbmRleE9mKGUuY2hhckF0KGYrKykpO289dGhpcy5fa2V5U3RyLmluZGV4T2YoZS5jaGFyQXQoZisrKSk7dT10aGlzLl9rZXlTdHIuaW5kZXhPZihlLmNoYXJBdChmKyspKTthPXRoaXMuX2tleVN0ci5pbmRleE9mKGUuY2hhckF0KGYrKykpO249czw8MnxvPj40O3I9KG8mMTUpPDw0fHU+PjI7aT0odSYzKTw8NnxhO3Q9dCtTdHJpbmcuZnJvbUNoYXJDb2RlKG4pO2lmKHUhPTY0KXt0PXQrU3RyaW5nLmZyb21DaGFyQ29kZShyKX1pZihhIT02NCl7dD10K1N0cmluZy5mcm9tQ2hhckNvZGUoaSl9fXQ9QmFzZTY0Ll91dGY4X2RlY29kZSh0KTtyZXR1cm4gdH0sX3V0ZjhfZW5jb2RlOmZ1bmN0aW9uKGUpe2U9ZS5yZXBsYWNlKC9ybi9nLFwiblwiKTt2YXIgdD1cIlwiO2Zvcih2YXIgbj0wO248ZS5sZW5ndGg7bisrKXt2YXIgcj1lLmNoYXJDb2RlQXQobik7aWYocjwxMjgpe3QrPVN0cmluZy5mcm9tQ2hhckNvZGUocil9ZWxzZSBpZihyPjEyNyYmcjwyMDQ4KXt0Kz1TdHJpbmcuZnJvbUNoYXJDb2RlKHI+PjZ8MTkyKTt0Kz1TdHJpbmcuZnJvbUNoYXJDb2RlKHImNjN8MTI4KX1lbHNle3QrPVN0cmluZy5mcm9tQ2hhckNvZGUocj4+MTJ8MjI0KTt0Kz1TdHJpbmcuZnJvbUNoYXJDb2RlKHI+PjYmNjN8MTI4KTt0Kz1TdHJpbmcuZnJvbUNoYXJDb2RlKHImNjN8MTI4KX19cmV0dXJuIHR9LF91dGY4X2RlY29kZTpmdW5jdGlvbihlKXt2YXIgdD1cIlwiO3ZhciBuPTA7dmFyIHI9YzE9YzI9MDt3aGlsZShuPGUubGVuZ3RoKXtyPWUuY2hhckNvZGVBdChuKTtpZihyPDEyOCl7dCs9U3RyaW5nLmZyb21DaGFyQ29kZShyKTtuKyt9ZWxzZSBpZihyPjE5MSYmcjwyMjQpe2MyPWUuY2hhckNvZGVBdChuKzEpO3QrPVN0cmluZy5mcm9tQ2hhckNvZGUoKHImMzEpPDw2fGMyJjYzKTtuKz0yfWVsc2V7YzI9ZS5jaGFyQ29kZUF0KG4rMSk7YzM9ZS5jaGFyQ29kZUF0KG4rMik7dCs9U3RyaW5nLmZyb21DaGFyQ29kZSgociYxNSk8PDEyfChjMiY2Myk8PDZ8YzMmNjMpO24rPTN9fXJldHVybiB0fX07XG5cblxudmFyIHV0aWxzID0ge1xuICBtaXhpbjogZnVuY3Rpb24gbWl4aW4oZGVzdGluYXRpb24sIHNvdXJjZSkge1xuICAgICAgcmV0dXJuIHV0aWxzLm1lcmdlKGRlc3RpbmF0aW9uLnByb3RvdHlwZSwgc291cmNlKTtcbiAgfSxcbiAgXG4gIG1peGluaW5zdGFuY2U6IGZ1bmN0aW9uIG1peGluaW5zdGFuY2UoZGVzdGluYXRpb24sc291cmNlKXtcbiAgICAgIHZhciBzb3VyY2VJbnN0YW5jZSA9IG5ldyBzb3VyY2U7XG4gICAgICB1dGlscy5tZXJnZShkZXN0aW5hdGlvbiwgc291cmNlSW5zdGFuY2UpO1xuICAgICAgdXRpbHMubWVyZ2UoZGVzdGluYXRpb24ucHJvdG90eXBlLCBzb3VyY2UucHJvdG90eXBlKTtcbiAgfSxcblxuXG4gIG1lcmdlOiBmdW5jdGlvbiBtZXJnZShkZXN0aW5hdGlvbiwgc291cmNlKSB7XG4gICAgICB2YXIga2V5O1xuXG4gICAgICBmb3IgKGtleSBpbiBzb3VyY2UpIHtcbiAgICAgICAgICBpZiAodXRpbHMuaGFzT3duKHNvdXJjZSwga2V5KSkge1xuICAgICAgICAgICAgICBkZXN0aW5hdGlvbltrZXldID0gc291cmNlW2tleV07XG4gICAgICAgICAgfVxuICAgICAgfVxuICB9LFxuXG4gIGhhc093bjogZnVuY3Rpb24gaGFzT3duKG9iamVjdCwga2V5KSB7XG4gICAgICByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwga2V5KTtcbiAgfSxcbiAgXG4gIGluaGVyaXQ6ZnVuY3Rpb24oY2hpbGRDdG9yLCBwYXJlbnRDdG9yKSB7XG4gICAgZnVuY3Rpb24gdGVtcEN0b3IoKSB7fTtcbiAgICB0ZW1wQ3Rvci5wcm90b3R5cGUgPSBwYXJlbnRDdG9yLnByb3RvdHlwZTtcbiAgICBjaGlsZEN0b3Iuc3VwZXJDbGFzc18gPSBwYXJlbnRDdG9yLnByb3RvdHlwZTtcbiAgICBjaGlsZEN0b3IucHJvdG90eXBlID0gbmV3IHRlbXBDdG9yKCk7XG4gICAgY2hpbGRDdG9yLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IGNoaWxkQ3RvcjtcbiAgfSxcbiAgXG4gIGJhc2U6IGZ1bmN0aW9uKG1lLCBvcHRfbWV0aG9kTmFtZSwgdmFyX2FyZ3MpIHtcbiAgICB2YXIgY2FsbGVyID0gYXJndW1lbnRzLmNhbGxlZS5jYWxsZXI7XG4gICAgaWYgKGNhbGxlci5zdXBlckNsYXNzXykge1xuICAgICAgLy8gVGhpcyBpcyBhIGNvbnN0cnVjdG9yLiBDYWxsIHRoZSBzdXBlcmNsYXNzIGNvbnN0cnVjdG9yLlxuICAgICAgcmV0dXJuIGNhbGxlci5zdXBlckNsYXNzXy5jb25zdHJ1Y3Rvci5hcHBseShcbiAgICAgICAgICBtZSwgQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKSk7XG4gICAgfVxuXG4gICAgdmFyIGFyZ3MgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDIpO1xuICAgIHZhciBmb3VuZENhbGxlciA9IGZhbHNlO1xuICAgIGZvciAodmFyIGN0b3IgPSBtZS5jb25zdHJ1Y3RvcjtcbiAgICAgICAgIGN0b3I7IGN0b3IgPSBjdG9yLnN1cGVyQ2xhc3NfICYmIGN0b3Iuc3VwZXJDbGFzc18uY29uc3RydWN0b3IpIHtcbiAgICAgIGlmIChjdG9yLnByb3RvdHlwZVtvcHRfbWV0aG9kTmFtZV0gPT09IGNhbGxlcikge1xuICAgICAgICBmb3VuZENhbGxlciA9IHRydWU7XG4gICAgICB9IGVsc2UgaWYgKGZvdW5kQ2FsbGVyKSB7XG4gICAgICAgIHJldHVybiBjdG9yLnByb3RvdHlwZVtvcHRfbWV0aG9kTmFtZV0uYXBwbHkobWUsIGFyZ3MpO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIElmIHdlIGRpZCBub3QgZmluZCB0aGUgY2FsbGVyIGluIHRoZSBwcm90b3R5cGUgY2hhaW4sXG4gICAgLy8gdGhlbiBvbmUgb2YgdHdvIHRoaW5ncyBoYXBwZW5lZDpcbiAgICAvLyAxKSBUaGUgY2FsbGVyIGlzIGFuIGluc3RhbmNlIG1ldGhvZC5cbiAgICAvLyAyKSBUaGlzIG1ldGhvZCB3YXMgbm90IGNhbGxlZCBieSB0aGUgcmlnaHQgY2FsbGVyLlxuICAgIGlmIChtZVtvcHRfbWV0aG9kTmFtZV0gPT09IGNhbGxlcikge1xuICAgICAgcmV0dXJuIG1lLmNvbnN0cnVjdG9yLnByb3RvdHlwZVtvcHRfbWV0aG9kTmFtZV0uYXBwbHkobWUsIGFyZ3MpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyBFcnJvcihcbiAgICAgICAgICAnYmFzZSBjYWxsZWQgZnJvbSBhIG1ldGhvZCBvZiBvbmUgbmFtZSAnICtcbiAgICAgICAgICAndG8gYSBtZXRob2Qgb2YgYSBkaWZmZXJlbnQgbmFtZScpO1xuICAgIH1cbiAgfSxcbiAgXG4gIG5vb3A6IGZ1bmN0aW9uKCl7fSxcbiAgXG4gIHRydWVmbmM6IGZ1bmN0aW9uKCl7cmV0dXJuIHRydWV9LFxuICBcbiAgZmFsc2VmbmM6IGZ1bmN0aW9uKCl7cmV0dXJuIHRydWV9LFxuICBcbiAgcmVzb2x2ZTogZnVuY3Rpb24odmFsdWUpe1xuICAgIHZhciBkZWZlcnJlZCA9ICQuRGVmZXJyZWQoKTtcbiAgICBkZWZlcnJlZC5yZXNvbHZlKHZhbHVlKTtcbiAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZSgpO1xuICB9LFxuICBcbiAgcmVqZWN0OiBmdW5jdGlvbih2YWx1ZSl7XG4gICAgdmFyIGRlZmVycmVkID0gJC5EZWZlcnJlZCgpO1xuICAgIGRlZmVycmVkLnJlamVjdCh2YWx1ZSk7XG4gICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2UoKTtcbiAgfSxcbiAgXG4gIEJhc2U2NDogQmFzZTY0XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IHV0aWxzO1xuIiwidmFyIENvbnRyb2wgPSBmdW5jdGlvbihvcHRpb25zKXtcbiAgdmFyIG5hbWUgPSBvcHRpb25zLm5hbWUgfHwgXCI/XCI7XG4gIHRoaXMubmFtZSA9IG5hbWUuc3BsaXQoJyAnKS5qb2luKCctJykudG9Mb3dlckNhc2UoKTtcbiAgdGhpcy5pZCA9IHRoaXMubmFtZSsnXycrKE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwMDAwMDApKTtcbiAgXG4gIGlmICghb3B0aW9ucy5lbGVtZW50KSB7XG4gICAgdmFyIGNsYXNzTmFtZSA9IFwib2wtXCIrdGhpcy5uYW1lLnNwbGl0KCcgJykuam9pbignLScpLnRvTG93ZXJDYXNlKCk7XG4gICAgdmFyIHRpcExhYmVsID0gb3B0aW9ucy50aXBMYWJlbCB8fCB0aGlzLm5hbWU7XG4gICAgdmFyIGxhYmVsID0gb3B0aW9ucy5sYWJlbCB8fCBcIj9cIjtcbiAgICBcbiAgICBvcHRpb25zLmVsZW1lbnQgPSAkKCc8ZGl2IGNsYXNzPVwiJytjbGFzc05hbWUrJyBvbC11bnNlbGVjdGFibGUgb2wtY29udHJvbFwiPjxidXR0b24gdHlwZT1cImJ1dHRvblwiIHRpdGxlPVwiJyt0aXBMYWJlbCsnXCI+JytsYWJlbCsnPC9idXR0b24+PC9kaXY+JylbMF07XG4gIH1cbiAgXG4gIHZhciBidXR0b25DbGlja0hhbmRsZXIgPSBvcHRpb25zLmJ1dHRvbkNsaWNrSGFuZGxlciB8fCBDb250cm9sLnByb3RvdHlwZS5faGFuZGxlQ2xpY2suYmluZCh0aGlzKTtcbiAgXG4gICQob3B0aW9ucy5lbGVtZW50KS5vbignY2xpY2snLGJ1dHRvbkNsaWNrSGFuZGxlcik7XG4gIFxuICBvbC5jb250cm9sLkNvbnRyb2wuY2FsbCh0aGlzLG9wdGlvbnMpO1xuICBcbiAgdGhpcy5fcG9zdFJlbmRlcigpO1xufVxub2wuaW5oZXJpdHMoQ29udHJvbCwgb2wuY29udHJvbC5Db250cm9sKTtcblxuXG52YXIgcHJvdG8gPSBDb250cm9sLnByb3RvdHlwZTtcblxucHJvdG8uX2hhbmRsZUNsaWNrID0gZnVuY3Rpb24oKXtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICB2YXIgbWFwID0gdGhpcy5nZXRNYXAoKTtcbiAgXG4gIHZhciByZXNldENvbnRyb2wgPSBudWxsO1xuICAvLyByZW1vdmUgYWxsIHRoZSBvdGhlciwgZXZlbnR1YWxseSB0b2dnbGVkLCBpbnRlcmFjdGlvbmNvbnRyb2xzXG4gIHZhciBjb250cm9scyA9IG1hcC5nZXRDb250cm9scygpO1xuICBjb250cm9scy5mb3JFYWNoKGZ1bmN0aW9uKGNvbnRyb2wpe1xuICAgIGlmKGNvbnRyb2wuaWQgJiYgY29udHJvbC50b2dnbGUgJiYgKGNvbnRyb2wuaWQgIT0gc2VsZi5pZCkpIHtcbiAgICAgIGNvbnRyb2wudG9nZ2xlKGZhbHNlKTtcbiAgICAgIGlmIChjb250cm9sLm5hbWUgPT0gJ3Jlc2V0Jykge1xuICAgICAgICByZXNldENvbnRyb2wgPSBjb250cm9sO1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG4gIGlmICghc2VsZi5fdG9nZ2xlZCAmJiByZXNldENvbnRyb2wpIHtcbiAgICByZXNldENvbnRyb2wudG9nZ2xlKHRydWUpO1xuICB9XG59O1xuXG5wcm90by5fcG9zdFJlbmRlciA9IGZ1bmN0aW9uKCl7fTtcblxubW9kdWxlLmV4cG9ydHMgPSBDb250cm9sO1xuIiwidmFyIENvbnRyb2wgPSByZXF1aXJlKCcuL2NvbnRyb2wnKTtcblxudmFyIEludGVyYWN0aW9uQ29udHJvbCA9IGZ1bmN0aW9uKG9wdGlvbnMpe1xuICB0aGlzLl90b2dnbGVkID0gdGhpcy5fdG9nZ2xlZCB8fCBmYWxzZTtcbiAgdGhpcy5faW50ZXJhY3Rpb24gPSBvcHRpb25zLmludGVyYWN0aW9uIHx8IG51bGw7XG4gIHRoaXMuX2F1dG91bnRvZ2dsZSA9IG9wdGlvbnMuYXV0b3VudG9nZ2xlIHx8IGZhbHNlO1xuICBcbiAgb3B0aW9ucy5idXR0b25DbGlja0hhbmRsZXIgPSBJbnRlcmFjdGlvbkNvbnRyb2wucHJvdG90eXBlLl9oYW5kbGVDbGljay5iaW5kKHRoaXMpO1xuICBcbiAgQ29udHJvbC5jYWxsKHRoaXMsb3B0aW9ucyk7XG59O1xub2wuaW5oZXJpdHMoSW50ZXJhY3Rpb25Db250cm9sLCBDb250cm9sKTtcblxudmFyIHByb3RvID0gSW50ZXJhY3Rpb25Db250cm9sLnByb3RvdHlwZTtcblxucHJvdG8udG9nZ2xlID0gZnVuY3Rpb24odG9nZ2xlKXtcbiAgdmFyIHRvZ2dsZSA9IHRvZ2dsZSAhPT0gdW5kZWZpbmVkID8gdG9nZ2xlIDogIXRoaXMuX3RvZ2dsZWRcbiAgdGhpcy5fdG9nZ2xlZCA9IHRvZ2dsZTtcbiAgdmFyIG1hcCA9IHRoaXMuZ2V0TWFwKCk7XG4gIHZhciBjb250cm9sQnV0dG9uID0gJCh0aGlzLmVsZW1lbnQpLmZpbmQoJ2J1dHRvbicpLmZpcnN0KCk7XG4gIFxuICBpZiAodG9nZ2xlKSB7XG4gICAgaWYgKHRoaXMuX2ludGVyYWN0aW9uKSB7XG4gICAgICBtYXAuYWRkSW50ZXJhY3Rpb24odGhpcy5faW50ZXJhY3Rpb24pO1xuICAgIH1cbiAgICBjb250cm9sQnV0dG9uLmFkZENsYXNzKCdnM3ctb2wtdG9nZ2xlZCcpO1xuICB9XG4gIGVsc2Uge1xuICAgIGlmICh0aGlzLl9pbnRlcmFjdGlvbikge1xuICAgICAgbWFwLnJlbW92ZUludGVyYWN0aW9uKHRoaXMuX2ludGVyYWN0aW9uKTtcbiAgICB9XG4gICAgY29udHJvbEJ1dHRvbi5yZW1vdmVDbGFzcygnZzN3LW9sLXRvZ2dsZWQnKTtcbiAgfVxufVxuXG5wcm90by5faGFuZGxlQ2xpY2sgPSBmdW5jdGlvbihlKXtcbiAgdGhpcy50b2dnbGUoKTtcbiAgQ29udHJvbC5wcm90b3R5cGUuX2hhbmRsZUNsaWNrLmNhbGwodGhpcyxlKTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gSW50ZXJhY3Rpb25Db250cm9sO1xuIiwidmFyIHV0aWxzID0gcmVxdWlyZSgnLi4vdXRpbHMnKTtcbnZhciBJbnRlcmFjdGlvbkNvbnRyb2wgPSByZXF1aXJlKCcuL2ludGVyYWN0aW9uY29udHJvbCcpO1xuXG52YXIgUGlja0Nvb3JkaW5hdGVzSW50ZXJhY3Rpb24gPSByZXF1aXJlKCcuLi9pbnRlcmFjdGlvbnMvcGlja2Nvb3JkaW5hdGVzaW50ZXJhY3Rpb24nKTtcblxudmFyIFF1ZXJ5Q29udHJvbCA9IGZ1bmN0aW9uKG9wdGlvbnMpe1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIHZhciBfb3B0aW9ucyA9IHtcbiAgICBuYW1lOiBcInF1ZXJ5bGF5ZXJcIixcbiAgICB0aXBMYWJlbDogXCJRdWVyeSBsYXllclwiLFxuICAgIGxhYmVsOiBcIlxcdWVhMGZcIixcbiAgICBpbnRlcmFjdGlvbjogbmV3IFBpY2tDb29yZGluYXRlc0ludGVyYWN0aW9uXG4gIH07XG4gIFxuICBvcHRpb25zID0gdXRpbHMubWVyZ2Uob3B0aW9ucyxfb3B0aW9ucyk7XG4gIFxuICBJbnRlcmFjdGlvbkNvbnRyb2wuY2FsbCh0aGlzLG9wdGlvbnMpO1xuICBcbiAgdGhpcy5faW50ZXJhY3Rpb24ub24oJ3BpY2tlZCcsZnVuY3Rpb24oZSl7XG4gICAgc2VsZi5kaXNwYXRjaEV2ZW50KHtcbiAgICAgIHR5cGU6ICdwaWNrZWQnLFxuICAgICAgY29vcmRpbmF0ZXM6IGUuY29vcmRpbmF0ZVxuICAgIH0pO1xuICAgIGlmIChzZWxmLl9hdXRvdW50b2dnbGUpIHtcbiAgICAgIHNlbGYudG9nZ2xlKCk7XG4gICAgfVxuICB9KTtcbn1cbm9sLmluaGVyaXRzKFF1ZXJ5Q29udHJvbCwgSW50ZXJhY3Rpb25Db250cm9sKTtcblxubW9kdWxlLmV4cG9ydHMgPSBRdWVyeUNvbnRyb2w7XG4iLCJ2YXIgdXRpbHMgPSByZXF1aXJlKCcuLi91dGlscycpO1xudmFyIEludGVyYWN0aW9uQ29udHJvbCA9IHJlcXVpcmUoJy4vaW50ZXJhY3Rpb25jb250cm9sJyk7XG5cbnZhciBSZXNldENvbnRyb2wgPSBmdW5jdGlvbihvcHRpb25zKXtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICB0aGlzLl90b2dnbGVkID0gdHJ1ZTtcbiAgdGhpcy5fc3RhcnRDb29yZGluYXRlID0gbnVsbDtcbiAgdmFyIF9vcHRpb25zID0ge1xuICAgICAgbmFtZTogXCJyZXNldFwiLFxuICAgICAgdGlwTGFiZWw6IFwiUGFuXCIsXG4gICAgICBsYWJlbDogXCJcXHVlOTAxXCIsXG4gICAgfTtcbiAgXG4gIG9wdGlvbnMgPSB1dGlscy5tZXJnZShvcHRpb25zLF9vcHRpb25zKTtcbiAgXG4gIEludGVyYWN0aW9uQ29udHJvbC5jYWxsKHRoaXMsb3B0aW9ucyk7XG59XG5vbC5pbmhlcml0cyhSZXNldENvbnRyb2wsIEludGVyYWN0aW9uQ29udHJvbCk7XG5tb2R1bGUuZXhwb3J0cyA9IFJlc2V0Q29udHJvbDtcblxudmFyIHByb3RvID0gUmVzZXRDb250cm9sLnByb3RvdHlwZTtcblxucHJvdG8uX3Bvc3RSZW5kZXIgPSBmdW5jdGlvbigpe1xuICB0aGlzLnRvZ2dsZSh0cnVlKTtcbn07XG4iLCJ2YXIgdXRpbHMgPSByZXF1aXJlKCcuLi91dGlscycpO1xudmFyIEludGVyYWN0aW9uQ29udHJvbCA9IHJlcXVpcmUoJy4vaW50ZXJhY3Rpb25jb250cm9sJyk7XG5cbnZhciBab29tQm94Q29udHJvbCA9IGZ1bmN0aW9uKG9wdGlvbnMpe1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIHRoaXMuX3N0YXJ0Q29vcmRpbmF0ZSA9IG51bGw7XG4gIHZhciBfb3B0aW9ucyA9IHtcbiAgICAgIG5hbWU6IFwiem9vbWJveFwiLFxuICAgICAgdGlwTGFiZWw6IFwiWm9vbSB0byBib3hcIixcbiAgICAgIGxhYmVsOiBcIlxcdWU5MDBcIixcbiAgICAgIGludGVyYWN0aW9uOiBuZXcgb2wuaW50ZXJhY3Rpb24uRHJhZ0JveFxuICAgIH07XG4gIFxuICBvcHRpb25zID0gdXRpbHMubWVyZ2Uob3B0aW9ucyxfb3B0aW9ucyk7XG4gIFxuICBJbnRlcmFjdGlvbkNvbnRyb2wuY2FsbCh0aGlzLG9wdGlvbnMpO1xuICBcbiAgdGhpcy5faW50ZXJhY3Rpb24ub24oJ2JveHN0YXJ0JyxmdW5jdGlvbihlKXtcbiAgICBzZWxmLl9zdGFydENvb3JkaW5hdGUgPSBlLmNvb3JkaW5hdGU7XG4gIH0pO1xuICBcbiAgdGhpcy5faW50ZXJhY3Rpb24ub24oJ2JveGVuZCcsZnVuY3Rpb24oZSl7XG4gICAgdmFyIHN0YXJ0X2Nvb3JkaW5hdGUgPSBzZWxmLl9zdGFydENvb3JkaW5hdGU7XG4gICAgdmFyIGVuZF9jb29yZGluYXRlID0gZS5jb29yZGluYXRlO1xuICAgIHZhciBleHRlbnQgPSBvbC5leHRlbnQuYm91bmRpbmdFeHRlbnQoW3N0YXJ0X2Nvb3JkaW5hdGUsZW5kX2Nvb3JkaW5hdGVdKTtcbiAgICBzZWxmLmRpc3BhdGNoRXZlbnQoe1xuICAgICAgdHlwZTogJ3pvb21lbmQnLFxuICAgICAgZXh0ZW50OiBleHRlbnRcbiAgICB9KTtcbiAgICBzZWxmLl9zdGFydENvb3JkaW5hdGUgPSBudWxsO1xuICAgIGlmIChzZWxmLl9hdXRvdW50b2dnbGUpIHtcbiAgICAgIHNlbGYudG9nZ2xlKCk7XG4gICAgfVxuICB9KVxufVxub2wuaW5oZXJpdHMoWm9vbUJveENvbnRyb2wsIEludGVyYWN0aW9uQ29udHJvbCk7XG5tb2R1bGUuZXhwb3J0cyA9IFpvb21Cb3hDb250cm9sO1xuIiwidmFyIHV0aWxzID0gcmVxdWlyZSgnLi91dGlscycpO1xudmFyIG1hcGhlbHBlcnMgPSByZXF1aXJlKCcuL21hcC9tYXBoZWxwZXJzJyk7XG5cbihmdW5jdGlvbiAobmFtZSwgcm9vdCwgZmFjdG9yeSkge1xuICBpZiAodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKSB7XG4gICAgZGVmaW5lKGZhY3RvcnkpO1xuICB9XG4gIGVsc2UgaWYgKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0Jykge1xuICAgIG1vZHVsZS5leHBvcnRzID0gZmFjdG9yeSgpO1xuICB9XG4gIGVsc2Uge1xuICAgIHJvb3RbbmFtZV0gPSBmYWN0b3J5KCk7XG4gIH1cbn0pKCdnM3dvbDMnLCB0aGlzLCBmdW5jdGlvbiAoKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgXG4gIHZhciBoZWxwZXJzID0gdXRpbHMubWVyZ2Uoe30sbWFwaGVscGVycyk7XG4gIFxuICByZXR1cm4ge1xuICAgIGhlbHBlcnM6IGhlbHBlcnNcbiAgfVxufSk7XG4iLCJ2YXIgQmFzZUxheWVycyA9IHt9O1xuXG5CYXNlTGF5ZXJzLk9TTSA9IG5ldyBvbC5sYXllci5UaWxlKHtcbiAgc291cmNlOiBuZXcgb2wuc291cmNlLk9TTSh7XG4gICAgYXR0cmlidXRpb25zOiBbXG4gICAgICBuZXcgb2wuQXR0cmlidXRpb24oe1xuICAgICAgICBodG1sOiAnQWxsIG1hcHMgJmNvcHk7ICcgK1xuICAgICAgICAgICAgJzxhIGhyZWY9XCJodHRwOi8vd3d3Lm9wZW5zdHJlZXRtYXAub3JnL1wiPk9wZW5TdHJlZXRNYXA8L2E+J1xuICAgICAgfSksXG4gICAgICBvbC5zb3VyY2UuT1NNLkFUVFJJQlVUSU9OXG4gICAgXSxcbiAgICB1cmw6ICdodHRwOi8ve2EtY30udGlsZS5vcGVuc3RyZWV0bWFwLm9yZy97en0ve3h9L3t5fS5wbmcnLFxuICAgIGNyb3NzT3JpZ2luOiBudWxsXG4gIH0pLFxuICBpZDogJ29zbScsXG4gIHRpdGxlOiAnT1NNJyxcbiAgYmFzZW1hcDogdHJ1ZVxufSk7XG5cbkJhc2VMYXllcnMuQklORyA9IHt9O1xuXG5CYXNlTGF5ZXJzLkJJTkcuUm9hZCA9IG5ldyBvbC5sYXllci5UaWxlKHtcbiAgbmFtZTonUm9hZCcsXG4gIHZpc2libGU6IGZhbHNlLFxuICBwcmVsb2FkOiBJbmZpbml0eSxcbiAgc291cmNlOiBuZXcgb2wuc291cmNlLkJpbmdNYXBzKHtcbiAgICBrZXk6ICdBbV9tQVNuVUEtanRXM08zTXhJWW1PT1BMT3ZMMzlkd012Um55b0h4ZktmX0VQTllnZldNOWltcUdFVFdLR1ZuJyxcbiAgICBpbWFnZXJ5U2V0OiAnUm9hZCdcbiAgICAgIC8vIHVzZSBtYXhab29tIDE5IHRvIHNlZSBzdHJldGNoZWQgdGlsZXMgaW5zdGVhZCBvZiB0aGUgQmluZ01hcHNcbiAgICAgIC8vIFwibm8gcGhvdG9zIGF0IHRoaXMgem9vbSBsZXZlbFwiIHRpbGVzXG4gICAgICAvLyBtYXhab29tOiAxOVxuICB9KSxcbiAgYmFzZW1hcDogdHJ1ZVxufSk7XG5cbkJhc2VMYXllcnMuQklORy5BZXJpYWxXaXRoTGFiZWxzID0gbmV3IG9sLmxheWVyLlRpbGUoe1xuICBuYW1lOiAnQWVyaWFsV2l0aExhYmVscycsXG4gIHZpc2libGU6IHRydWUsXG4gIHByZWxvYWQ6IEluZmluaXR5LFxuICBzb3VyY2U6IG5ldyBvbC5zb3VyY2UuQmluZ01hcHMoe1xuICAgIGtleTogJ0FtX21BU25VQS1qdFczTzNNeElZbU9PUExPdkwzOWR3TXZSbnlvSHhmS2ZfRVBOWWdmV005aW1xR0VUV0tHVm4nLFxuICAgIGltYWdlcnlTZXQ6ICdBZXJpYWxXaXRoTGFiZWxzJ1xuICAgICAgLy8gdXNlIG1heFpvb20gMTkgdG8gc2VlIHN0cmV0Y2hlZCB0aWxlcyBpbnN0ZWFkIG9mIHRoZSBCaW5nTWFwc1xuICAgICAgLy8gXCJubyBwaG90b3MgYXQgdGhpcyB6b29tIGxldmVsXCIgdGlsZXNcbiAgICAgIC8vIG1heFpvb206IDE5XG4gIH0pLFxuICBiYXNlbWFwOiB0cnVlXG59KTtcblxuQmFzZUxheWVycy5CSU5HLkFlcmlhbCA9IG5ldyBvbC5sYXllci5UaWxlKHtcbiAgbmFtZTogJ0FlcmlhbCcsXG4gIHZpc2libGU6IGZhbHNlLFxuICBwcmVsb2FkOiBJbmZpbml0eSxcbiAgc291cmNlOiBuZXcgb2wuc291cmNlLkJpbmdNYXBzKHtcbiAgICBrZXk6ICdBbV9tQVNuVUEtanRXM08zTXhJWW1PT1BMT3ZMMzlkd012Um55b0h4ZktmX0VQTllnZldNOWltcUdFVFdLR1ZuJyxcbiAgICBpbWFnZXJ5U2V0OiAnQWVyaWFsJ1xuICAgICAgLy8gdXNlIG1heFpvb20gMTkgdG8gc2VlIHN0cmV0Y2hlZCB0aWxlcyBpbnN0ZWFkIG9mIHRoZSBCaW5nTWFwc1xuICAgICAgLy8gXCJubyBwaG90b3MgYXQgdGhpcyB6b29tIGxldmVsXCIgdGlsZXNcbiAgICAgIC8vIG1heFpvb206IDE5XG4gIH0pLFxuICBiYXNlbWFwOiB0cnVlXG59KTtcblxubW9kdWxlLmV4cG9ydHMgPSBCYXNlTGF5ZXJzO1xuIiwidmFyIHV0aWxzID0gcmVxdWlyZSgnLi4vdXRpbHMnKTtcbnZhciBSYXN0ZXJMYXllcnMgPSB7fTtcblxuUmFzdGVyTGF5ZXJzLlRpbGVkV01TTGF5ZXIgPSBmdW5jdGlvbihsYXllck9iaixleHRyYVBhcmFtcyl7XG4gIHZhciBvcHRpb25zID0ge1xuICAgIGxheWVyT2JqOiBsYXllck9iaixcbiAgICBleHRyYVBhcmFtczogZXh0cmFQYXJhbXMgfHwge30sXG4gICAgdGlsZWQ6IHRydWVcbiAgfVxuICByZXR1cm4gUmFzdGVyTGF5ZXJzLl9XTVNMYXllcihvcHRpb25zKTtcbn07XG5cblJhc3RlckxheWVycy5XTVNMYXllciA9IGZ1bmN0aW9uKGxheWVyT2JqLGV4dHJhUGFyYW1zKXtcbiAgdmFyIG9wdGlvbnMgPSB7XG4gICAgbGF5ZXJPYmo6IGxheWVyT2JqLFxuICAgIGV4dHJhUGFyYW1zOiBleHRyYVBhcmFtcyB8fCB7fVxuICB9XG4gIHJldHVybiBSYXN0ZXJMYXllcnMuX1dNU0xheWVyKG9wdGlvbnMpO1xufTtcblxuUmFzdGVyTGF5ZXJzLl9XTVNMYXllciA9IGZ1bmN0aW9uKG9wdGlvbnMpe1xuICB2YXIgbGF5ZXJPYmogPSBvcHRpb25zLmxheWVyT2JqO1xuICB2YXIgZXh0cmFQYXJhbXMgPSBvcHRpb25zLmV4dHJhUGFyYW1zO1xuICB2YXIgdGlsZWQgPSBvcHRpb25zLnRpbGVkIHx8IGZhbHNlO1xuICBcbiAgdmFyIHBhcmFtcyA9IHtcbiAgICBMQVlFUlM6IGxheWVyT2JqLmxheWVycyB8fCAnJyxcbiAgICBWRVJTSU9OOiAnMS4zLjAnLFxuICAgIFRSQU5TUEFSRU5UOiB0cnVlLFxuICAgIFNMRF9WRVJTSU9OOiAnMS4xLjAnXG4gIH07XG4gIFxuICBwYXJhbXMgPSB1dGlscy5tZXJnZShwYXJhbXMsZXh0cmFQYXJhbXMpO1xuICBcbiAgdmFyIHNvdXJjZU9wdGlvbnMgPSB7XG4gICAgdXJsOiBsYXllck9iai51cmwsXG4gICAgcGFyYW1zOiBwYXJhbXMsXG4gICAgcmF0aW86IDFcbiAgfTtcbiAgXG4gIHZhciBpbWFnZU9wdGlvbnMgPSB7XG4gICAgaWQ6IGxheWVyT2JqLmlkLFxuICAgIG5hbWU6IGxheWVyT2JqLm5hbWUsXG4gICAgb3BhY2l0eTogbGF5ZXJPYmoub3BhY2l0eSB8fCAxLjAsXG4gICAgdmlzaWJsZTpsYXllck9iai52aXNpYmxlLFxuICAgIG1heFJlc29sdXRpb246IGxheWVyT2JqLm1heFJlc29sdXRpb25cbiAgfVxuICBcbiAgdmFyIGltYWdlQ2xhc3M7XG4gIHZhciBzb3VyY2U7XG4gIGlmICh0aWxlZCkge1xuICAgIHNvdXJjZSA9IG5ldyBvbC5zb3VyY2UuVGlsZVdNUyhzb3VyY2VPcHRpb25zKTtcbiAgICBpbWFnZUNsYXNzID0gb2wubGF5ZXIuVGlsZTtcbiAgICAvL2ltYWdlT3B0aW9ucy5leHRlbnQgPSBbMTEzNDg2NywzODczMDAyLDI1MDU5NjQsNTU5Njk0NF07XG4gIH1cbiAgZWxzZSB7XG4gICAgc291cmNlID0gbmV3IG9sLnNvdXJjZS5JbWFnZVdNUyhzb3VyY2VPcHRpb25zKVxuICAgIGltYWdlQ2xhc3MgPSBvbC5sYXllci5JbWFnZTtcbiAgfVxuICBcbiAgaW1hZ2VPcHRpb25zLnNvdXJjZSA9IHNvdXJjZTtcbiAgXG4gIHZhciBsYXllciA9IG5ldyBpbWFnZUNsYXNzKGltYWdlT3B0aW9ucyk7XG4gIFxuICByZXR1cm4gbGF5ZXI7XG59O1xuXG4vKlJhc3RlckxheWVycy5UaWxlZFdNU0xheWVyID0gZnVuY3Rpb24obGF5ZXJPYmope1xuICB2YXIgbGF5ZXIgPSBuZXcgb2wubGF5ZXIuVGlsZSh7XG4gICAgbmFtZTogbGF5ZXJPYmoubmFtZSxcbiAgICBvcGFjaXR5OiAxLjAsXG4gICAgc291cmNlOiBuZXcgb2wuc291cmNlLlRpbGVXTVMoe1xuICAgICAgdXJsOiBsYXllck9iai51cmwsXG4gICAgICBwYXJhbXM6IHtcbiAgICAgICAgTEFZRVJTOiBsYXllck9iai5sYXllcnMgfHwgJycsXG4gICAgICAgIFZFUlNJT046ICcxLjMuMCcsXG4gICAgICAgIFRSQU5TUEFSRU5UOiB0cnVlXG4gICAgICB9XG4gICAgfSksXG4gICAgdmlzaWJsZTogbGF5ZXJPYmoudmlzaWJsZVxuICB9KTtcbiAgXG4gIHJldHVybiBsYXllcjtcbn07Ki9cblxubW9kdWxlLmV4cG9ydHMgPSBSYXN0ZXJMYXllcnM7XG5cbiIsIkJhc2VMYXllcnMgPSByZXF1aXJlKCcuLi9sYXllcnMvYmFzZXMnKTtcblxudmFyIE1hcEhlbHBlcnMgPSB7XG4gIGNyZWF0ZVZpZXdlcjogZnVuY3Rpb24ob3B0cyl7XG4gICAgcmV0dXJuIG5ldyBfVmlld2VyKG9wdHMpO1xuICB9XG59O1xuXG52YXIgX1ZpZXdlciA9IGZ1bmN0aW9uKG9wdHMpe1xuICB2YXIgY29udHJvbHMgPSBvbC5jb250cm9sLmRlZmF1bHRzKHtcbiAgICBhdHRyaWJ1dGlvbk9wdGlvbnM6IHtcbiAgICAgIGNvbGxhcHNpYmxlOiBmYWxzZVxuICAgIH0sXG4gICAgem9vbTogZmFsc2UsXG4gICAgYXR0cmlidXRpb246IGZhbHNlXG4gIH0pOy8vLmV4dGVuZChbbmV3IG9sLmNvbnRyb2wuWm9vbSgpXSk7XG4gIFxuICB2YXIgaW50ZXJhY3Rpb25zID0gb2wuaW50ZXJhY3Rpb24uZGVmYXVsdHMoKVxuICAgIC5leHRlbmQoW1xuICAgICAgbmV3IG9sLmludGVyYWN0aW9uLkRyYWdSb3RhdGUoKVxuICAgIF0pO1xuICBpbnRlcmFjdGlvbnMucmVtb3ZlQXQoMSkgLy8gcmltdW92byBkb3VjbGlja3pvb21cbiAgXG4gIHZhciB2aWV3O1xuICBpZiAob3B0cy52aWV3IGluc3RhbmNlb2Ygb2wuVmlldykge1xuICAgIHZpZXcgPSBvcHRzLnZpZXc7XG4gIH1cbiAgZWxzZSB7XG4gICAgdmlldyA9IG5ldyBvbC5WaWV3KG9wdHMudmlldyk7XG4gIH1cbiAgdmFyIG9wdGlvbnMgPSB7XG4gICAgY29udHJvbHM6IGNvbnRyb2xzLFxuICAgIGludGVyYWN0aW9uczogaW50ZXJhY3Rpb25zLFxuICAgIG9sM0xvZ286IGZhbHNlLFxuICAgIHZpZXc6IHZpZXcsXG4gICAga2V5Ym9hcmRFdmVudFRhcmdldDogZG9jdW1lbnRcbiAgfTtcbiAgaWYgKG9wdHMuaWQpe1xuICAgIG9wdGlvbnMudGFyZ2V0ID0gb3B0cy5pZDtcbiAgfVxuICB2YXIgbWFwICA9IG5ldyBvbC5NYXAob3B0aW9ucyk7XG4gIHRoaXMubWFwID0gbWFwO1xufTtcblxuX1ZpZXdlci5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uKCl7XG4gIGlmICh0aGlzLm1hcCkge1xuICAgIHRoaXMubWFwLmRpc3Bvc2UoKTtcbiAgICB0aGlzLm1hcCA9IG51bGxcbiAgfVxufTtcblxuX1ZpZXdlci5wcm90b3R5cGUuZ2V0VmlldyA9IGZ1bmN0aW9uKCkge1xuICByZXR1cm4gdGhpcy5tYXAuZ2V0VmlldygpO1xufVxuXG5fVmlld2VyLnByb3RvdHlwZS51cGRhdGVNYXAgPSBmdW5jdGlvbihtYXBPYmplY3Qpe307XG5cbl9WaWV3ZXIucHJvdG90eXBlLnVwZGF0ZVZpZXcgPSBmdW5jdGlvbigpe307XG5cbl9WaWV3ZXIucHJvdG90eXBlLmdldE1hcCA9IGZ1bmN0aW9uKCl7XG4gIHJldHVybiB0aGlzLm1hcDtcbn07XG5cbl9WaWV3ZXIucHJvdG90eXBlLnNldFRhcmdldCA9IGZ1bmN0aW9uKGlkKXtcbiAgdGhpcy5tYXAuc2V0VGFyZ2V0KGlkKTtcbn07XG5cbl9WaWV3ZXIucHJvdG90eXBlLmdvVG8gPSBmdW5jdGlvbihjb29yZGluYXRlcywgem9vbSl7XG4gIHZhciBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcbiAgdmFyIGFuaW1hdGUgPSBvcHRpb25zLmFuaW1hdGUgfHwgdHJ1ZTtcbiAgdmFyIHZpZXcgPSB0aGlzLm1hcC5nZXRWaWV3KCk7XG4gIFxuICBpZiAoYW5pbWF0ZSkge1xuICAgIHZhciBwYW4gPSBvbC5hbmltYXRpb24ucGFuKHtcbiAgICAgIGR1cmF0aW9uOiA1MDAsXG4gICAgICBzb3VyY2U6IHZpZXcuZ2V0Q2VudGVyKClcbiAgICB9KTtcbiAgICB2YXIgem9vbSA9IG9sLmFuaW1hdGlvbi56b29tKHtcbiAgICAgIGR1cmF0aW9uOiA1MDAsXG4gICAgICByZXNvbHV0aW9uOiB2aWV3LmdldFJlc29sdXRpb24oKVxuICAgIH0pO1xuICAgIHRoaXMubWFwLmJlZm9yZVJlbmRlcihwYW4sem9vbSk7XG4gIH1cbiAgXG4gIHZpZXcuc2V0Q2VudGVyKGNvb3JkaW5hdGVzKTtcbiAgdmlldy5zZXRab29tKHpvb20pO1xufTtcblxuX1ZpZXdlci5wcm90b3R5cGUuZ29Ub1JlcyA9IGZ1bmN0aW9uKGNvb3JkaW5hdGVzLCByZXNvbHV0aW9uKXtcbiAgdmFyIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuICB2YXIgYW5pbWF0ZSA9IG9wdGlvbnMuYW5pbWF0ZSB8fCB0cnVlO1xuICB2YXIgdmlldyA9IHRoaXMubWFwLmdldFZpZXcoKTtcbiAgXG4gIGlmIChhbmltYXRlKSB7XG4gICAgdmFyIHBhbiA9IG9sLmFuaW1hdGlvbi5wYW4oe1xuICAgICAgZHVyYXRpb246IDUwMCxcbiAgICAgIHNvdXJjZTogdmlldy5nZXRDZW50ZXIoKVxuICAgIH0pO1xuICAgIHZhciB6b29tID0gb2wuYW5pbWF0aW9uLnpvb20oe1xuICAgICAgZHVyYXRpb246IDUwMCxcbiAgICAgIHJlc29sdXRpb246IHZpZXcuZ2V0UmVzb2x1dGlvbigpXG4gICAgfSk7XG4gICAgdGhpcy5tYXAuYmVmb3JlUmVuZGVyKHBhbix6b29tKTtcbiAgfVxuXG4gIHZpZXcuc2V0Q2VudGVyKGNvb3JkaW5hdGVzKTtcbiAgdmlldy5zZXRSZXNvbHV0aW9uKHJlc29sdXRpb24pO1xufTtcblxuX1ZpZXdlci5wcm90b3R5cGUuZml0ID0gZnVuY3Rpb24oZ2VvbWV0cnksIG9wdGlvbnMpe1xuICB2YXIgdmlldyA9IHRoaXMubWFwLmdldFZpZXcoKTtcbiAgXG4gIHZhciBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcbiAgdmFyIGFuaW1hdGUgPSBvcHRpb25zLmFuaW1hdGUgfHwgdHJ1ZTtcbiAgXG4gIGlmIChhbmltYXRlKSB7XG4gICAgdmFyIHBhbiA9IG9sLmFuaW1hdGlvbi5wYW4oe1xuICAgICAgZHVyYXRpb246IDUwMCxcbiAgICAgIHNvdXJjZTogdmlldy5nZXRDZW50ZXIoKVxuICAgIH0pO1xuICAgIHZhciB6b29tID0gb2wuYW5pbWF0aW9uLnpvb20oe1xuICAgICAgZHVyYXRpb246IDUwMCxcbiAgICAgIHJlc29sdXRpb246IHZpZXcuZ2V0UmVzb2x1dGlvbigpXG4gICAgfSk7XG4gICAgdGhpcy5tYXAuYmVmb3JlUmVuZGVyKHBhbix6b29tKTtcbiAgfVxuICBcbiAgaWYgKG9wdGlvbnMuYW5pbWF0ZSkge1xuICAgIGRlbGV0ZSBvcHRpb25zLmFuaW1hdGU7IC8vIG5vbiBsbyBwYXNzbyBhbCBtZXRvZG8gZGkgT0wzIHBlcmNow6kgw6ggdW4nb3B6aW9uZSBpbnRlcm5hXG4gIH1cbiAgb3B0aW9ucy5jb25zdHJhaW5SZXNvbHV0aW9uID0gb3B0aW9ucy5jb25zdHJhaW5SZXNvbHV0aW9uIHx8IGZhbHNlO1xuICBcbiAgdmlldy5maXQoZ2VvbWV0cnksdGhpcy5tYXAuZ2V0U2l6ZSgpLG9wdGlvbnMpO1xufTtcblxuX1ZpZXdlci5wcm90b3R5cGUuZ2V0Wm9vbSA9IGZ1bmN0aW9uKCl7XG4gIHZhciB2aWV3ID0gdGhpcy5tYXAuZ2V0VmlldygpO1xuICByZXR1cm4gdmlldy5nZXRab29tKCk7XG59O1xuXG5fVmlld2VyLnByb3RvdHlwZS5nZXRSZXNvbHV0aW9uID0gZnVuY3Rpb24oKXtcbiAgdmFyIHZpZXcgPSB0aGlzLm1hcC5nZXRWaWV3KCk7XG4gIHJldHVybiB2aWV3LmdldFJlc29sdXRpb24oKTtcbn07XG5cbl9WaWV3ZXIucHJvdG90eXBlLmdldENlbnRlciA9IGZ1bmN0aW9uKCl7XG4gIHZhciB2aWV3ID0gdGhpcy5tYXAuZ2V0VmlldygpO1xuICByZXR1cm4gdmlldy5nZXRDZW50ZXIoKTtcbn07XG5cbl9WaWV3ZXIucHJvdG90eXBlLmdldEJCT1ggPSBmdW5jdGlvbigpe1xuICByZXR1cm4gdGhpcy5tYXAuZ2V0VmlldygpLmNhbGN1bGF0ZUV4dGVudCh0aGlzLm1hcC5nZXRTaXplKCkpO1xufTtcblxuX1ZpZXdlci5wcm90b3R5cGUuZ2V0TGF5ZXJCeU5hbWUgPSBmdW5jdGlvbihsYXllck5hbWUpIHtcbiAgdmFyIGxheWVycyA9IHRoaXMubWFwLmdldExheWVycygpO1xuICB2YXIgbGVuZ3RoID0gbGF5ZXJzLmdldExlbmd0aCgpO1xuICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7XG4gICAgaWYgKGxheWVyTmFtZSA9PT0gbGF5ZXJzLml0ZW0oaSkuZ2V0KCduYW1lJykpIHtcbiAgICAgIHJldHVybiBsYXllcnMuaXRlbShpKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIG51bGw7XG59O1xuXG5fVmlld2VyLnByb3RvdHlwZS5yZW1vdmVMYXllckJ5TmFtZSA9IGZ1bmN0aW9uKGxheWVyTmFtZSl7XG4gIHZhciBsYXllciA9IHRoaXMuZ2V0TGF5ZXJCeU5hbWUobGF5ZXJOYW1lKTtcbiAgaWYgKGxheWVyKXtcbiAgICB0aGlzLm1hcC5yZW1vdmVMYXllcihsYXllcik7XG4gICAgZGVsZXRlIGxheWVyO1xuICB9XG59O1xuXG5fVmlld2VyLnByb3RvdHlwZS5nZXRBY3RpdmVMYXllcnMgPSBmdW5jdGlvbigpe1xuICB2YXIgYWN0aXZlbGF5ZXJzID0gW107XG4gIHRoaXMubWFwLmdldExheWVycygpLmZvckVhY2goZnVuY3Rpb24obGF5ZXIpIHtcbiAgICB2YXIgcHJvcHMgPSBsYXllci5nZXRQcm9wZXJ0aWVzKCk7XG4gICAgaWYgKHByb3BzLmJhc2VtYXAgIT0gdHJ1ZSAmJiBwcm9wcy52aXNpYmxlKXtcbiAgICAgICBhY3RpdmVsYXllcnMucHVzaChsYXllcik7XG4gICAgfVxuICB9KTtcbiAgXG4gIHJldHVybiBhY3RpdmVsYXllcnM7XG59O1xuXG5fVmlld2VyLnByb3RvdHlwZS5yZW1vdmVMYXllcnMgPSBmdW5jdGlvbigpe1xuICB0aGlzLm1hcC5nZXRMYXllcnMoKS5jbGVhcigpO1xufTtcblxuX1ZpZXdlci5wcm90b3R5cGUuZ2V0TGF5ZXJzTm9CYXNlID0gZnVuY3Rpb24oKXtcbiAgdmFyIGxheWVycyA9IFtdO1xuICB0aGlzLm1hcC5nZXRMYXllcnMoKS5mb3JFYWNoKGZ1bmN0aW9uKGxheWVyKSB7XG4gICAgdmFyIHByb3BzID0gbGF5ZXIuZ2V0UHJvcGVydGllcygpO1xuICAgIGlmIChwcm9wcy5iYXNlbWFwICE9IHRydWUpe1xuICAgICAgbGF5ZXJzLnB1c2gobGF5ZXIpO1xuICAgIH1cbiAgfSk7XG4gIFxuICByZXR1cm4gbGF5ZXJzO1xufTtcblxuX1ZpZXdlci5wcm90b3R5cGUuYWRkQmFzZUxheWVyID0gZnVuY3Rpb24odHlwZSl7XG4gIHZhciBsYXllcjtcbiAgdHlwZSA/IGxheWVyID0gQmFzZUxheWVyc1t0eXBlXTogIGxheWVyID0gQmFzZUxheWVycy5CSU5HLkFlcmlhbDtcbiAgdGhpcy5tYXAuYWRkTGF5ZXIobGF5ZXIpO1xufTtcblxuX1ZpZXdlci5wcm90b3R5cGUuY2hhbmdlQmFzZUxheWVyID0gZnVuY3Rpb24obGF5ZXJOYW1lKXtcbiAgdmFyIGJhc2VMYXllciA9IHRoaXMuZ2V0TGF5ZXJCeU5hbWUobGF5ZXJuYW1lKTtcbiAgdmFyIGxheWVycyA9IHRoaXMubWFwLmdldExheWVycygpO1xuICBsYXllcnMuaW5zZXJ0QXQoMCwgYmFzZUxheWVyKTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gTWFwSGVscGVycztcbiIsInZhciB1dGlscyA9IHtcbiAgbWVyZ2U6IGZ1bmN0aW9uKG9iajEsb2JqMil7XG4gICAgdmFyIG9iajMgPSB7fTtcbiAgICBmb3IgKHZhciBhdHRybmFtZSBpbiBvYmoxKSB7IG9iajNbYXR0cm5hbWVdID0gb2JqMVthdHRybmFtZV07IH1cbiAgICBmb3IgKHZhciBhdHRybmFtZSBpbiBvYmoyKSB7IG9iajNbYXR0cm5hbWVdID0gb2JqMlthdHRybmFtZV07IH1cbiAgICByZXR1cm4gb2JqMztcbiAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IHV0aWxzO1xuIiwidmFyIGluaGVyaXQgPSByZXF1aXJlKCdjb3JlL3V0aWxzL3V0aWxzJykuaW5oZXJpdDtcbnZhciBHM1dPYmplY3QgPSByZXF1aXJlKCdjb3JlL2czd29iamVjdCcpO1xuXG52YXIgQ29tcG9uZW50ID0gZnVuY3Rpb24ob3B0aW9ucykge1xuICB2YXIgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307XG4gIHRoaXMuaWQgPSBvcHRpb25zLmlkIHx8IE1hdGgucmFuZG9tKCkgKiAxMDAwO1xuICB0aGlzLnRpdGxlID0gb3B0aW9ucy50aXRsZSB8fCAnJztcbiAgdGhpcy5pbnRlcm5hbENvbXBvbmVudCA9IG51bGw7XG59O1xuaW5oZXJpdChDb21wb25lbnQsRzNXT2JqZWN0KTtcblxudmFyIHByb3RvID0gQ29tcG9uZW50LnByb3RvdHlwZTtcblxucHJvdG8uZ2V0SWQgPSBmdW5jdGlvbigpe1xuICByZXR1cm4gc2VsZi5pZDtcbn07XG5cbnByb3RvLmdldE5hbWUgPSBmdW5jdGlvbigpIHtcbiAgcmV0dXJuIHNlbGYubmFtZTtcbn07XG5cbnByb3RvLmdldFRpdGxlID0gZnVuY3Rpb24oKXtcbiAgcmV0dXJuIHNlbGYudGl0bGU7XG59O1xuXG4vKiBIT09LUyAqL1xuXG4vKiBcbiAqIElsIG1ldG9kbyBwZXJtZXR0ZSBhbCBjb21wb25lbnRlIGRpIG1vbnRhcnNpIG5lbCBET01cbiAqIHBhcmVudEVsOiBlbGVtZW50byBET00gcGFkcmUsIHN1IGN1aSBpbnNlcmlyc2k7IFxuICogcml0b3JuYSB1bmEgcHJvbWlzZSwgcmlzb2x0YSBuZWwgbW9tZW50byBpbiBjdWkgc2Fyw6AgdGVybWluYXRvIGlsIG1vbnRhZ2dpb1xuKi9cbnByb3RvLm1vdW50ID0gZnVuY3Rpb24ocGFyZW50KXt9O1xuXG4vKlxuICogTWV0b2RvIHJpY2hpYW1hdG8gcXVhbmRvIHNpIHZ1b2xlIHJpbXVvdmVyZSBpbCBjb21wb25lbnRlLlxuICogUml0b3JuYSB1bmEgcHJvbWVzc2EgY2hlIHNhcsOgIHJpc29sdGEgbmVsIG1vbWVudG8gaW4gY3VpIGlsIGNvbXBvbmVudGUgYXZyw6AgY29tcGxldGF0byBsYSBwcm9wcmlhIHJpbW96aW9uZSAoZWQgZXZlbnR1YWxlIHJpbGFzY2lvIGRpIHJpc29yc2UgZGlwZW5kZW50aSlcbiovXG5wcm90by51bm1vdW50ID0gZnVuY3Rpb24oKXt9O1xuXG4vKiBcbiAqIE1ldG9kbyAob3B6aW9uYWxlKSBjaGUgb2ZmcmUgbCdvcHBvcnR1bml0w6AgZGkgcmljYWxjb2xhcmUgcHJvcHJpZXTDoCBkaXBlbmRlbnRpIGRhbGxlIGRpbWVuc2lvbmkgZGVsIHBhZHJlXG4gKiBwYXJlbnRIZWlnaHQ6IG51b3ZhIGFsdGV6emEgZGVsIHBhcmVudFxuICogcGFyZW50V2lkdGg6IG51b3ZhIGxhcmdoZXp6YSBkZWwgcGFyZW50XG4gKiByaWNoaWFtYXRvIG9nbmkgdm9sdGEgY2hlIGlsIHBhcmVudCBzdWJpc2NlIHVuIHJpZGltZW5zaW9uYW1lbnRvXG4qL1xucHJvdG8ub25SZXNpemUgPSBmdW5jdGlvbihwYXJlbnRXaWR0aCxwYXJlbnRIZWlnaHQpe307XG5cblxubW9kdWxlLmV4cG9ydHMgPSBDb21wb25lbnQ7XG4iLCJ2YXIgRzNXT2JqZWN0ID0gcmVxdWlyZSgnY29yZS9nM3dvYmplY3QnKTtcbnZhciBpbmhlcml0ID0gcmVxdWlyZSgnY29yZS91dGlscy91dGlscycpLmluaGVyaXQ7XG52YXIgYmFzZSA9IHJlcXVpcmUoJ2NvcmUvdXRpbHMvdXRpbHMnKS5iYXNlO1xuXG5mdW5jdGlvbiBDb21wb25lbnRzUmVnaXN0cnkoKSB7XG4gIHRoaXMuY29tcG9uZW50cyA9IHt9O1xuICBcbiAgdGhpcy5hZGRDb21wb25lbnQgPSBmdW5jdGlvbihjb21wb25lbnQpIHtcbiAgICB2YXIgaWQgPSBjb21wb25lbnQuZ2V0SWQoKTtcbiAgICBpZiAoIXRoaXMuY29tcG9uZW50c1tpZF0pIHtcbiAgICAgIHRoaXMuY29tcG9uZW50c1tpZF0gPSBjb21wb25lbnQ7XG4gICAgfVxuICB9OyBcbiAgXG4gIHRoaXMuZ2V0Q29tcG9uZW50ID0gZnVuY3Rpb24oaWQpIHtcbiAgICByZXR1cm4gdGhpcy5jb21wb25lbnRzW2lkXTtcbiAgfTtcbiAgXG4gIHRoaXMucmVtb3ZlQ29tcG9uZW50ID0gZnVuY3Rpb24oaWQpIHtcbiAgICB2YXIgY29tcG9uZW50ID0gdGhpcy5fY29tcG9uZW50c1tpZF07XG4gICAgaWYgKGNvbXBvbmVudCkge1xuICAgICAgaWYgKF8uaXNGdW5jdGlvbihjb21wb25lbnQuZGVzdHJveSkpIHtcbiAgICAgICAgY29tcG9uZW50LmRlc3Ryb3koKTtcbiAgICAgIH1cbiAgICAgIGRlbGV0ZSBjb21wb25lbnQ7XG4gICAgICB0aGlzLl9jb21wb25lbnRzW2lkXSA9IG51bGw7XG4gICAgfVxuICB9O1xufVxuaW5oZXJpdChDb21wb25lbnRzUmVnaXN0cnksRzNXT2JqZWN0KTtcblxubW9kdWxlLmV4cG9ydHMgPSBuZXcgQ29tcG9uZW50c1JlZ2lzdHJ5O1xuIiwibm9vcCA9IHJlcXVpcmUoJ2NvcmUvdXRpbHMvdXRpbHMnKS5ub29wO1xudmFyIGluaGVyaXQgPSByZXF1aXJlKCdjb3JlL3V0aWxzL3V0aWxzJykuaW5oZXJpdDtcbnZhciBHM1dPYmplY3QgPSByZXF1aXJlKCdjb3JlL2czd29iamVjdCcpO1xudmFyIENvbXBvbmVudHNSZWdpc3RyeSA9IHJlcXVpcmUoJ2d1aS9jb21wb25lbnRzcmVnaXN0cnknKTtcblxuLy8gcmFwcHJlc2VudGEgbCdpbnRlcmZhY2NpYSBnbG9iYWxlIGRlbGwnQVBJIGRlbGxhIEdVSS4gXG4vLyBtZXRvZGkgZGV2b25vIGVzc2VyZSBpbXBsZW1lbnRhdGkgKGRlZmluaXRpKSBkYWxsJ2FwcGxpY2F6aW9uZSBvc3BpdGVcbi8vIGwnYXBwIG9zcGl0ZSBkb3ZyZWJiZSBjaGlhbWFyZSBhbmNoZSBsYSBmdW56aW9uZSBHVUkucmVhZHkoKSBxdWFuZG8gbGEgVUkgw6ggcHJvbnRhXG5mdW5jdGlvbiBHVUkoKXtcbiAgLy8gdXJsIGRlbGxlIHJpc29yc2UgKGltbWFnaW5pLCBlY2MuKVxuICB0aGlzLmdldFJlc291cmNlc1VybCA9IG5vb3A7XG4gIC8vIHNob3cgYSBWdWUgZm9ybVxuICB0aGlzLnNob3dGb3JtID0gbm9vcDtcbiAgdGhpcy5jbG9zZUZvcm0gPSBub29wO1xuICBcbiAgLy8gbW9zdHJhIHVuYSBsaXN0YSBkaSBvZ2dldHRpIChlcy4gbGlzdGEgZGkgcmlzdWx0YXRpKVxuICB0aGlzLnNob3dMaXN0aW5nID0gbm9vcDtcbiAgdGhpcy5jbG9zZUxpc3RpbmcgPSBub29wO1xuICB0aGlzLmhpZGVMaXN0aW5nID0gbm9vcDtcblxuICAvKiBwYW5lbCAqL1xuICB0aGlzLnNob3dQYW5lbCA9IG5vb3A7XG4gIHRoaXMuaGlkZVBhbmVsID0gbm9vcDtcblxuICAvL21ldG9kaSBjb21wb25lbnRlXG4gIHRoaXMuYWRkQ29tcG9uZW50ID0gbm9vcDtcbiAgdGhpcy5yZW1vdmVDb21wb25lbnQgPSBub29wO1xuICB0aGlzLmdldENvbXBvbmVudCA9IGZ1bmN0aW9uKGlkKSB7XG4gICAgcmV0dXJuIENvbXBvbmVudHNSZWdpc3RyeS5nZXRDb21wb25lbnQoaWQpO1xuICB9O1xuICAvL2ZpbmUgbWV0b2RpIGNvbXBvbmVudGVcblxuICB0aGlzLnJlYWR5ID0gZnVuY3Rpb24oKXtcbiAgICB0aGlzLmVtaXQoJ2d1aXJlYWR5Jyk7XG4gIH07XG4gIFxuICB0aGlzLmd1aVJlc2l6ZWQgPSBmdW5jdGlvbigpe1xuICAgIHRoaXMuZW1pdCgnZ3VpcmVzaXplZCcpO1xuICB9O1xuXG4gIC8qIHNwaW5uZXIgKi9cbiAgdGhpcy5zaG93U3Bpbm5lciA9IG5vb3A7IC8vIHBlciBtb3N0cmFyZSB1bidpY29uYSBzcGlubmVyIGNoZSBub3RpZmljYSB1biBjYXJpY2FtZW50byBkYXRpIGluIGNvcnNvXG4gIHRoaXMuaGlkZVNwaW5uZXIgPSBub29wO1xuICBcbiAgdGhpcy5ub3RpZnkgPSBub29wO1xuICB0aGlzLmRpYWxvZyA9IG5vb3A7XG59XG5cbmluaGVyaXQoR1VJLEczV09iamVjdCk7XG5cbm1vZHVsZS5leHBvcnRzID0gbmV3IEdVSTtcbiIsIm1vZHVsZS5leHBvcnRzID0gXCI8ZGl2PlxcbiAgTGlzdGEgZGkgb2dnZXR0aVxcbjwvZGl2PlxcblwiO1xuIiwidmFyIHJlc29sdmUgPSByZXF1aXJlKCdjb3JlL3V0aWxzL3V0aWxzJykucmVzb2x2ZTtcbnZhciByZWplY3QgPSByZXF1aXJlKCdjb3JlL3V0aWxzL3V0aWxzJykucmVqZWN0O1xudmFyIEdVSSA9IHJlcXVpcmUoJ2d1aS9ndWknKTtcbi8vdmFyIE1hcFNlcnZpY2UgPSByZXF1aXJlKCdjb3JlL21hcC9tYXBzZXJ2aWNlJyk7XG5cbnZhciBMaXN0UGFuZWxDb21wb25lbnQgPSBWdWUuZXh0ZW5kKHtcbiAgdGVtcGxhdGU6IHJlcXVpcmUoJy4vbGlzdHBhbmVsLmh0bWwnKSxcbiAgbWV0aG9kczoge1xuICAgIGV4ZWM6IGZ1bmN0aW9uKGNiayl7XG4gICAgICB2YXIgcmVsYXRpb25zID0gdGhpcy5zdGF0ZS5yZWxhdGlvbnMgfHwgbnVsbDtcbiAgICAgIGNiayh0aGlzLnN0YXRlLmZpZWxkcyxyZWxhdGlvbnMpO1xuICAgICAgR1VJLmNsb3NlRm9ybSgpO1xuICAgIH1cbiAgfVxufSk7XG5cblxuZnVuY3Rpb24gTGlzdFBhbmVsKG9wdGlvbnMpe1xuICAvLyBwcm9wcmlldMOgIG5lY2Vzc2FyaWUuIEluIGZ1dHVybyBsZSBtZXR0ZXJtbyBpbiB1bmEgY2xhc3NlIFBhbmVsIGRhIGN1aSBkZXJpdmVyYW5ubyB0dXR0aSBpIHBhbm5lbGxpIGNoZSB2b2dsaW9ubyBlc3NlcmUgbW9zdHJhdGkgbmVsbGEgc2lkZWJhclxuICB0aGlzLnBhbmVsQ29tcG9uZW50ID0gbnVsbDtcbiAgdGhpcy5vcHRpb25zID0gIG9wdGlvbnMgfHwge307XG4gIHRoaXMuaWQgPSBvcHRpb25zLmlkIHx8IG51bGw7IC8vIGlkIGRlbCBmb3JtXG4gIHRoaXMubmFtZSA9IG9wdGlvbnMubmFtZSB8fCBudWxsOyAvLyBub21lIGRlbCBmb3JtXG4gIFxuICB0aGlzLnN0YXRlID0ge1xuICAgIGxpc3Q6IG9wdGlvbnMubGlzdCB8fCBbXVxuICB9XG4gIFxuICB0aGlzLl9saXN0UGFuZWxDb21wb25lbnQgPSBvcHRpb25zLmxpc3RQYW5lbENvbXBvbmVudCB8fCBMaXN0UGFuZWxDb21wb25lbnQ7XG59XG5cbnZhciBwcm90byA9IExpc3RQYW5lbC5wcm90b3R5cGU7XG5cbi8vIHZpZW5lIHJpY2hpYW1hdG8gZGFsbGEgdG9vbGJhciBxdWFuZG8gaWwgcGx1Z2luIGNoaWVkZSBkaSBtb3N0cmFyZSB1biBwcm9wcmlvIHBhbm5lbGxvIG5lbGxhIEdVSSAoR1VJLnNob3dQYW5lbClcbnByb3RvLm9uU2hvdyA9IGZ1bmN0aW9uKGNvbnRhaW5lcil7XG4gIHZhciBwYW5lbCA9IHRoaXMuX3NldHVwUGFuZWwoKTtcbiAgdGhpcy5fbW91bnRQYW5lbChwYW5lbCxjb250YWluZXIpO1xuICByZXR1cm4gcmVzb2x2ZSh0cnVlKTtcbn07XG5cbi8vIHJpY2hpYW1hdG8gcXVhbmRvIGxhIEdVSSBjaGllZGUgZGkgY2hpdWRlcmUgaWwgcGFubmVsbG8uIFNlIHJpdG9ybmEgZmFsc2UgaWwgcGFubmVsbG8gbm9uIHZpZW5lIGNoaXVzb1xucHJvdG8ub25DbG9zZSA9IGZ1bmN0aW9uKCl7XG4gIHRoaXMucGFuZWxDb21wb25lbnQuJGRlc3Ryb3kodHJ1ZSk7XG4gIHRoaXMucGFuZWxDb21wb25lbnQgPSBudWxsO1xuICByZXR1cm4gcmVzb2x2ZSh0cnVlKTtcbn07XG5cbnByb3RvLl9zZXR1cFBhbmVsID0gZnVuY3Rpb24oKXtcbiAgdmFyIHBhbmVsID0gdGhpcy5wYW5lbENvbXBvbmVudCA9IG5ldyB0aGlzLl9saXN0UGFuZWxDb21wb25lbnQoe1xuICAgIHBhbmVsOiB0aGlzXG4gIH0pO1xuICBwYW5lbC5zdGF0ZSA9IHRoaXMuc3RhdGU7XG4gIHJldHVybiBwYW5lbFxufTtcblxucHJvdG8uX21vdW50UGFuZWwgPSBmdW5jdGlvbihwYW5lbCxjb250YWluZXIpe1xuICBwYW5lbC4kbW91bnQoKS4kYXBwZW5kVG8oY29udGFpbmVyKTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0ge1xuICBMaXN0UGFuZWxDb21wb25lbnQ6IExpc3RQYW5lbENvbXBvbmVudCxcbiAgTGlzdFBhbmVsOiBMaXN0UGFuZWxcbn1cbiIsInZhciBpbmhlcml0ID0gcmVxdWlyZSgnY29yZS91dGlscy91dGlscycpLmluaGVyaXQ7XG52YXIgYmFzZSA9IHJlcXVpcmUoJ2NvcmUvdXRpbHMvdXRpbHMnKS5iYXNlO1xudmFyIEczV09iamVjdCA9IHJlcXVpcmUoJ2NvcmUvZzN3b2JqZWN0Jyk7XG52YXIgR1VJID0gcmVxdWlyZSgnZ3VpL2d1aScpO1xudmFyIEFwcGxpY2F0aW9uU2VydmljZSA9IHJlcXVpcmUoJ2NvcmUvYXBwbGljYXRpb25zZXJ2aWNlJyk7XG52YXIgUHJvamVjdHNSZWdpc3RyeSA9IHJlcXVpcmUoJ2NvcmUvcHJvamVjdC9wcm9qZWN0c3JlZ2lzdHJ5Jyk7XG52YXIgUHJvamVjdFR5cGVzID0gcmVxdWlyZSgnY29yZS9wcm9qZWN0L3Byb2plY3R0eXBlcycpO1xudmFyIEdlb21ldHJ5VHlwZXMgPSByZXF1aXJlKCdjb3JlL2dlb21ldHJ5L2dlb21ldHJ5JykuR2VvbWV0cnlUeXBlcztcbnZhciBvbDNoZWxwZXJzID0gcmVxdWlyZSgnZzN3LW9sMy9zcmMvZzN3Lm9sMycpLmhlbHBlcnM7XG52YXIgUmVzZXRDb250cm9sID0gcmVxdWlyZSgnZzN3LW9sMy9zcmMvY29udHJvbHMvcmVzZXRjb250cm9sJyk7XG52YXIgUXVlcnlDb250cm9sID0gcmVxdWlyZSgnZzN3LW9sMy9zcmMvY29udHJvbHMvcXVlcnljb250cm9sJyk7XG52YXIgWm9vbUJveENvbnRyb2wgPSByZXF1aXJlKCdnM3ctb2wzL3NyYy9jb250cm9scy96b29tYm94Y29udHJvbCcpO1xudmFyIFBpY2tDb29yZGluYXRlc0ludGVyYWN0aW9uID0gcmVxdWlyZSgnZzN3LW9sMy9zcmMvaW50ZXJhY3Rpb25zL3BpY2tjb29yZGluYXRlc2ludGVyYWN0aW9uJyk7XG52YXIgV01TTGF5ZXIgPSByZXF1aXJlKCdjb3JlL2xheWVyL3dtc2xheWVyJyk7XG52YXIgTWFwUXVlcnlTZXJ2aWNlID0gcmVxdWlyZSgnY29yZS9tYXAvbWFwcXVlcnlzZXJ2aWNlJyk7XG5cbi8vdmFyIEdVSSA9IHJlcXVpcmUoJ2d1aS9ndWknKTsgLy8gUVVFU1RPIE5PTiBDSSBERVZFIEVTU0VSRSEhIVxuXG52YXIgUGlja1RvbGVyYW5jZVBhcmFtcyA9IHt9O1xuUGlja1RvbGVyYW5jZVBhcmFtc1tQcm9qZWN0VHlwZXMuUURKQU5HT10gPSB7fTtcblBpY2tUb2xlcmFuY2VQYXJhbXNbUHJvamVjdFR5cGVzLlFESkFOR09dW0dlb21ldHJ5VHlwZXMuUE9JTlRdID0gXCJGSV9QT0lOVF9UT0xFUkFOQ0VcIjtcblBpY2tUb2xlcmFuY2VQYXJhbXNbUHJvamVjdFR5cGVzLlFESkFOR09dW0dlb21ldHJ5VHlwZXMuTElORVNUUklOR10gPSBcIkZJX0xJTkVfVE9MRVJBTkNFXCI7XG5QaWNrVG9sZXJhbmNlUGFyYW1zW1Byb2plY3RUeXBlcy5RREpBTkdPXVtHZW9tZXRyeVR5cGVzLlBPTFlHT05dID0gXCJGSV9QT0xZR09OX1RPTEVSQU5DRVwiO1xuXG52YXIgUGlja1RvbGVyYW5jZVZhbHVlcyA9IHt9XG5QaWNrVG9sZXJhbmNlVmFsdWVzW0dlb21ldHJ5VHlwZXMuUE9JTlRdID0gNTtcblBpY2tUb2xlcmFuY2VWYWx1ZXNbR2VvbWV0cnlUeXBlcy5MSU5FU1RSSU5HXSA9IDU7XG5QaWNrVG9sZXJhbmNlVmFsdWVzW0dlb21ldHJ5VHlwZXMuUE9MWUdPTl0gPSA1O1xuXG5mdW5jdGlvbiBNYXBTZXJ2aWNlKHByb2plY3Qpe1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIHRoaXMuY29uZmlnO1xuICB0aGlzLnZpZXdlcjtcbiAgdGhpcy5tYXBMYXllcnMgPSB7fTtcbiAgdGhpcy5tYXBCYXNlTGF5ZXJzID0ge307XG4gIHRoaXMubGF5ZXJzQXNzb2NpYXRpb24gPSB7fTtcbiAgdGhpcy5sYXllcnNFeHRyYVBhcmFtcyA9IHt9O1xuICB0aGlzLnN0YXRlID0ge1xuICAgICAgYmJveDogW10sXG4gICAgICByZXNvbHV0aW9uOiBudWxsLFxuICAgICAgY2VudGVyOiBudWxsLFxuICAgICAgbG9hZGluZzogZmFsc2VcbiAgfTtcbiAgdGhpcy5jb25maWcgPSBBcHBsaWNhdGlvblNlcnZpY2UuZ2V0Q29uZmlnKCkubWFwO1xuICBcbiAgdGhpcy5faG93TWFueUFyZUxvYWRpbmcgPSAwO1xuICB0aGlzLl9pbmNyZW1lbnRMb2FkZXJzID0gZnVuY3Rpb24oKXtcbiAgICBpZiAodGhpcy5faG93TWFueUFyZUxvYWRpbmcgPT0gMCl7XG4gICAgICB0aGlzLmVtaXQoJ2xvYWRzdGFydCcpO1xuICAgIH1cbiAgICB0aGlzLl9ob3dNYW55QXJlTG9hZGluZyArPSAxO1xuICB9O1xuICBcbiAgdGhpcy5fZGVjcmVtZW50TG9hZGVycyA9IGZ1bmN0aW9uKCl7XG4gICAgdGhpcy5faG93TWFueUFyZUxvYWRpbmcgLT0gMTtcbiAgICBpZiAodGhpcy5faG93TWFueUFyZUxvYWRpbmcgPT0gMCl7XG4gICAgICB0aGlzLmVtaXQoJ2xvYWRlbmQnKTtcbiAgICB9XG4gIH07XG4gIFxuICB0aGlzLl9pbnRlcmFjdGlvbnNTdGFjayA9IFtdO1xuICBcbiAgaWYoIV8uaXNOaWwocHJvamVjdCkpIHtcbiAgICB0aGlzLnByb2plY3QgPSBwcm9qZWN0O1xuICB9XG4gIGVsc2Uge1xuICAgIHRoaXMucHJvamVjdCA9IFByb2plY3RzUmVnaXN0cnkuZ2V0Q3VycmVudFByb2plY3QoKTtcbiAgfVxuICBcbiAgXG4gIHRoaXMuc2V0dGVycyA9IHtcbiAgICBzZXRNYXBWaWV3OiBmdW5jdGlvbihiYm94LHJlc29sdXRpb24sY2VudGVyKXtcbiAgICAgIHRoaXMuc3RhdGUuYmJveCA9IGJib3g7XG4gICAgICB0aGlzLnN0YXRlLnJlc29sdXRpb24gPSByZXNvbHV0aW9uO1xuICAgICAgdGhpcy5zdGF0ZS5jZW50ZXIgPSBjZW50ZXI7XG4gICAgICB0aGlzLnVwZGF0ZU1hcExheWVycyh0aGlzLm1hcExheWVycyk7XG4gICAgfSxcbiAgICBzZXR1cFZpZXdlcjogZnVuY3Rpb24oKXtcbiAgICAgIC8vJHNjcmlwdChcImh0dHA6Ly9lcHNnLmlvL1wiK1Byb2plY3RTZXJ2aWNlLnN0YXRlLnByb2plY3QuY3JzK1wiLmpzXCIpO1xuICAgICAgcHJvajQuZGVmcyhcIkVQU0c6XCIrc2VsZi5wcm9qZWN0LnN0YXRlLmNycyx0aGlzLnByb2plY3Quc3RhdGUucHJvajQpO1xuICAgICAgaWYgKHNlbGYudmlld2VyKSB7XG4gICAgICAgIHNlbGYudmlld2VyLmRlc3Ryb3koKTtcbiAgICAgICAgc2VsZi52aWV3ZXIgPSBudWxsO1xuICAgICAgfVxuICAgICAgc2VsZi5fc2V0dXBWaWV3ZXIoKTtcbiAgICAgIHNlbGYuc2V0dXBDb250cm9scygpO1xuICAgICAgc2VsZi5zZXR1cExheWVycygpO1xuICAgICAgc2VsZi5lbWl0KCd2aWV3ZXJzZXQnKTtcbiAgICB9XG4gIH07XG4gIFxuICB0aGlzLl9zZXR1cFZpZXdlciA9IGZ1bmN0aW9uKCl7XG4gICAgdmFyIGV4dGVudCA9IHRoaXMucHJvamVjdC5zdGF0ZS5leHRlbnQ7XG4gICAgdmFyIHByb2plY3Rpb24gPSBuZXcgb2wucHJvai5Qcm9qZWN0aW9uKHtcbiAgICAgIGNvZGU6IFwiRVBTRzpcIit0aGlzLnByb2plY3Quc3RhdGUuY3JzLFxuICAgICAgZXh0ZW50OiBleHRlbnRcbiAgICB9KTtcbiAgICBcbiAgICAvKnZhciBjb25zdHJhaW5fZXh0ZW50O1xuICAgIGlmICh0aGlzLmNvbmZpZy5jb25zdHJhaW50ZXh0ZW50KSB7XG4gICAgICB2YXIgZXh0ZW50ID0gdGhpcy5jb25maWcuY29uc3RyYWludGV4dGVudDtcbiAgICAgIHZhciBkeCA9IGV4dGVudFsyXS1leHRlbnRbMF07XG4gICAgICB2YXIgZHkgPSBleHRlbnRbM10tZXh0ZW50WzFdO1xuICAgICAgdmFyIGR4NCA9IGR4LzQ7XG4gICAgICB2YXIgZHk0ID0gZHkvNDtcbiAgICAgIHZhciBiYm94X3htaW4gPSBleHRlbnRbMF0gKyBkeDQ7XG4gICAgICB2YXIgYmJveF94bWF4ID0gZXh0ZW50WzJdIC0gZHg0O1xuICAgICAgdmFyIGJib3hfeW1pbiA9IGV4dGVudFsxXSArIGR5NDtcbiAgICAgIHZhciBiYm94X3ltYXggPSBleHRlbnRbM10gLSBkeTQ7XG4gICAgICBcbiAgICAgIGNvbnN0cmFpbl9leHRlbnQgPSBbYmJveF94bWluLGJib3hfeW1pbixiYm94X3htYXgsYmJveF95bWF4XTtcbiAgICB9Ki9cbiAgICBcbiAgICB0aGlzLnZpZXdlciA9IG9sM2hlbHBlcnMuY3JlYXRlVmlld2VyKHtcbiAgICAgIHZpZXc6IHtcbiAgICAgICAgcHJvamVjdGlvbjogcHJvamVjdGlvbixcbiAgICAgICAgLypjZW50ZXI6IHRoaXMuY29uZmlnLmluaXRjZW50ZXIgfHwgb2wuZXh0ZW50LmdldENlbnRlcihleHRlbnQpLFxuICAgICAgICB6b29tOiB0aGlzLmNvbmZpZy5pbml0em9vbSB8fCAwLFxuICAgICAgICBleHRlbnQ6IHRoaXMuY29uZmlnLmNvbnN0cmFpbnRleHRlbnQgfHwgZXh0ZW50LFxuICAgICAgICBtaW5ab29tOiB0aGlzLmNvbmZpZy5taW56b29tIHx8IDAsIC8vIGRlZmF1bHQgZGkgT0wzIDMuMTYuMFxuICAgICAgICBtYXhab29tOiB0aGlzLmNvbmZpZy5tYXh6b29tIHx8IDI4IC8vIGRlZmF1bHQgZGkgT0wzIDMuMTYuMCovXG4gICAgICAgIGNlbnRlcjogb2wuZXh0ZW50LmdldENlbnRlcihleHRlbnQpLFxuICAgICAgICB6b29tOiAwLFxuICAgICAgICBleHRlbnQ6IGV4dGVudCxcbiAgICAgICAgbWluWm9vbTogMCwgLy8gZGVmYXVsdCBkaSBPTDMgMy4xNi4wXG4gICAgICAgIG1heFpvb206IDI4IC8vIGRlZmF1bHQgZGkgT0wzIDMuMTYuMFxuICAgICAgfVxuICAgIH0pO1xuICAgIFxuICAgIHRoaXMudmlld2VyLm1hcC5vbignbW92ZWVuZCcsZnVuY3Rpb24oZSl7XG4gICAgICBzZWxmLl9zZXRNYXBWaWV3KCk7XG4gICAgfSk7XG4gICAgXG4gICAgTWFwUXVlcnlTZXJ2aWNlLmluaXQodGhpcy52aWV3ZXIubWFwKTtcbiAgICBcbiAgICB0aGlzLmVtaXQoJ3JlYWR5Jyk7XG4gIH07XG4gIFxuICB0aGlzLnByb2plY3Qub24oJ3Byb2plY3RzZXQnLGZ1bmN0aW9uKCl7XG4gICAgc2VsZi5zZXR1cFZpZXdlcigpO1xuICB9KTtcbiAgXG4gIHRoaXMucHJvamVjdC5vbigncHJvamVjdHN3aXRjaCcsZnVuY3Rpb24oKXtcbiAgICBzZWxmLnNldHVwTGF5ZXJzKCk7XG4gIH0pO1xuICBcbiAgdGhpcy5wcm9qZWN0Lm9uYWZ0ZXIoJ3NldExheWVyc1Zpc2libGUnLGZ1bmN0aW9uKGxheWVycyl7XG4gICAgdmFyIG1hcExheWVycyA9IF8ubWFwKGxheWVycyxmdW5jdGlvbihsYXllcil7XG4gICAgICByZXR1cm4gc2VsZi5nZXRNYXBMYXllckZvckxheWVyKGxheWVyKTtcbiAgICB9KVxuICAgIHNlbGYudXBkYXRlTWFwTGF5ZXJzKG1hcExheWVycyk7XG4gIH0pO1xuICBcbiAgdGhpcy5wcm9qZWN0Lm9uYWZ0ZXIoJ3NldEJhc2VMYXllcicsZnVuY3Rpb24oKXtcbiAgICBzZWxmLnVwZGF0ZU1hcExheWVycyhzZWxmLm1hcEJhc2VMYXllcnMpO1xuICB9KTtcbiAgXG4gIGJhc2UodGhpcyk7XG4gIFxuICB0aGlzLnNldHVwVmlld2VyKCk7XG59O1xuXG5pbmhlcml0KE1hcFNlcnZpY2UsRzNXT2JqZWN0KTtcblxudmFyIHByb3RvID0gTWFwU2VydmljZS5wcm90b3R5cGU7XG5cbi8vIHJlbmRlIHF1ZXN0byBtYXBzZXJ2aWNlIHNsYXZlIGRpIHVuIGFsdHJvIE1hcFNlcnZpY2VcbnByb3RvLnNsYXZlT2YgPSBmdW5jdGlvbihtYXBTZXJ2aWNlLCBzYW1lTGF5ZXJzKXtcbiAgLy8gc2UgaW1wb3N0YXJlIGkgbGF5ZXIgaW5pemlhbGkgdWd1YWxpIGEgcXVlbGxpIGRlbCBtYXBTZXJ2aWNlIG1hc3RlclxuICB2YXIgc2FtZUxheWVycyA9IHNhbWVMYXllcnMgfHwgZmFsc2U7XG59O1xuXG5wcm90by5zZXRMYXllcnNFeHRyYVBhcmFtcyA9IGZ1bmN0aW9uKHBhcmFtcyx1cGRhdGUpe1xuICB0aGlzLmxheWVyc0V4dHJhUGFyYW1zID0gXy5hc3NpZ24odGhpcy5sYXllcnNFeHRyYVBhcmFtcyxwYXJhbXMpO1xuICB0aGlzLmVtaXQoJ2V4dHJhUGFyYW1zU2V0JyxwYXJhbXMsdXBkYXRlKTtcbn07XG5cbnByb3RvLmdldE1hcCA9IGZ1bmN0aW9uKCkge1xuICByZXR1cm4gdGhpcy52aWV3ZXIubWFwO1xufTtcblxucHJvdG8uZ2V0Vmlld2VyRWxlbWVudCA9IGZ1bmN0aW9uKCl7XG4gIHJldHVybiB0aGlzLnZpZXdlci5tYXAuZ2V0VGFyZ2V0RWxlbWVudCgpO1xufTtcblxucHJvdG8uZ2V0Vmlld3BvcnQgPSBmdW5jdGlvbigpe1xuICByZXR1cm4gdGhpcy52aWV3ZXIubWFwLmdldFZpZXdwb3J0KCk7XG59O1xuXG5wcm90by5zZXR1cENvbnRyb2xzID0gZnVuY3Rpb24oKXtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICB2YXIgbWFwID0gc2VsZi52aWV3ZXIubWFwO1xuICBpZiAodGhpcy5jb25maWcgJiYgdGhpcy5jb25maWcuY29udHJvbHMpIHtcbiAgICBfLmZvckVhY2godGhpcy5jb25maWcuY29udHJvbHMsZnVuY3Rpb24oY29udHJvbFR5cGUpe1xuICAgICAgdmFyIGNvbnRyb2w7XG4gICAgICBzd2l0Y2ggKGNvbnRyb2xUeXBlKSB7XG4gICAgICAgIGNhc2UgJ3Jlc2V0JzpcbiAgICAgICAgICBpZiAoIWlzTW9iaWxlLmFueSkge1xuICAgICAgICAgICAgY29udHJvbCA9IG5ldyBSZXNldENvbnRyb2woKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgJ3pvb20nOlxuICAgICAgICAgIGNvbnRyb2wgPSBuZXcgb2wuY29udHJvbC5ab29tKHtcbiAgICAgICAgICAgIHpvb21JbkxhYmVsOiBcIlxcdWU5OGFcIixcbiAgICAgICAgICAgIHpvb21PdXRMYWJlbDogXCJcXHVlOThiXCJcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnem9vbWJveCc6IFxuICAgICAgICAgIGlmICghaXNNb2JpbGUuYW55KSB7XG4gICAgICAgICAgICBjb250cm9sID0gbmV3IFpvb21Cb3hDb250cm9sKCk7XG4gICAgICAgICAgICBjb250cm9sLm9uKCd6b29tZW5kJyxmdW5jdGlvbihlKXtcbiAgICAgICAgICAgICAgc2VsZi52aWV3ZXIuZml0KGUuZXh0ZW50KTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgfVxuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICd6b29tdG9leHRlbnQnOlxuICAgICAgICAgIGNvbnRyb2wgPSBuZXcgb2wuY29udHJvbC5ab29tVG9FeHRlbnQoe1xuICAgICAgICAgICAgbGFiZWw6ICBcIlxcdWU5OGNcIixcbiAgICAgICAgICAgIGV4dGVudDogc2VsZi5jb25maWcuY29uc3RyYWludGV4dGVudFxuICAgICAgICAgIH0pO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdxdWVyeSc6XG4gICAgICAgICAgY29udHJvbCA9IG5ldyBRdWVyeUNvbnRyb2woKTtcbiAgICAgICAgICBjb250cm9sLm9uKCdwaWNrZWQnLGZ1bmN0aW9uKGUpe1xuICAgICAgICAgICAgdmFyIGNvb3JkaW5hdGVzID0gZS5jb29yZGluYXRlcztcblxuICAgICAgICAgICAgTWFwUXVlcnlTZXJ2aWNlLnF1ZXJ5UG9pbnQoY29vcmRpbmF0ZXMsc2VsZi5tYXBMYXllcnMpXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbihjb29yZGluYXRlcyxuZmVhdHVyZXMsZmVhdHVyZXNGb3JMYXllck5hbWVzKXtcbiAgICAgICAgICAgICAgdmFyIGZlYXR1cmVzRm9yTGF5ZXJzID0gW107XG4gICAgICAgICAgICAgIF8uZm9yRWFjaChmZWF0dXJlc0ZvckxheWVyTmFtZXMsZnVuY3Rpb24oZmVhdHVyZXMsbGF5ZXJOYW1lKXtcbiAgICAgICAgICAgICAgICB2YXIgbGF5ZXIgPSB0aGlzLnByb2plY3QubGF5ZXJzW2xheWVyTmFtZV07XG4gICAgICAgICAgICAgICAgZmVhdHVyZXNGb3JMYXllcnMucHVzaCh7XG4gICAgICAgICAgICAgICAgICBsYXllcjogbGF5ZXIsXG4gICAgICAgICAgICAgICAgICBmZWF0dXJlczogZmVhdHVyZXNcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgc2VsZi5lbWl0KCdtYXBxdWVyeWVuZCcsZmVhdHVyZXNGb3JMYXllcnMsbmZlYXR1cmVzLGNvb3JkaW5hdGVzLHNlbGYuc3RhdGUucmVzb2x1dGlvbik7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgIH0pO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgXG4gICAgICBpZiAoY29udHJvbCkge1xuICAgICAgICBzZWxmLmFkZENvbnRyb2woY29udHJvbCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cbn07XG5cbnByb3RvLmFkZENvbnRyb2wgPSBmdW5jdGlvbihjb250cm9sKXtcbiAgdGhpcy52aWV3ZXIubWFwLmFkZENvbnRyb2woY29udHJvbCk7XG59O1xuXG5wcm90by5zZXR1cEJhc2VMYXllcnMgPSBmdW5jdGlvbigpe1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIGlmICghdGhpcy5wcm9qZWN0LnN0YXRlLmJhc2VsYXllcnMpe1xuICAgIHJldHVybjtcbiAgfVxuICB2YXIgc2VsZiA9IHRoaXM7XG4gIHRoaXMubWFwQmFzZUxheWVycyA9IHt9O1xuICBcbiAgdmFyIGluaXRCYXNlTGF5ZXIgPSBQcm9qZWN0c1JlZ2lzdHJ5LmNvbmZpZy5pbml0YmFzZWxheWVyO1xuICB2YXIgYmFzZUxheWVyc0FycmF5ID0gdGhpcy5wcm9qZWN0LnN0YXRlLmJhc2VsYXllcnM7XG4gIFxuICBfLmZvckVhY2goYmFzZUxheWVyc0FycmF5LGZ1bmN0aW9uKGJhc2VMYXllcil7XG4gICAgdmFyIHZpc2libGUgPSB0cnVlO1xuICAgIGlmIChzZWxmLnByb2plY3Quc3RhdGUuaW5pdGJhc2VsYXllcikge1xuICAgICAgdmlzaWJsZSA9IGJhc2VMYXllci5pZCA9PSAoc2VsZi5wcm9qZWN0LnN0YXRlLmluaXRiYXNlbGF5ZXIpO1xuICAgIH1cbiAgICBpZiAoYmFzZUxheWVyLmZpeGVkKSB7XG4gICAgICB2aXNpYmxlID0gYmFzZUxheWVyLmZpeGVkO1xuICAgIH1cbiAgICBiYXNlTGF5ZXIudmlzaWJsZSA9IHZpc2libGU7XG4gIH0pXG4gIFxuICBiYXNlTGF5ZXJzQXJyYXkuZm9yRWFjaChmdW5jdGlvbihsYXllcil7ICAgICBcbiAgICB2YXIgY29uZmlnID0ge1xuICAgICAgdXJsOiB0aGlzLnByb2plY3QuZ2V0V21zVXJsKCksXG4gICAgICBpZDogbGF5ZXIuaWQsXG4gICAgICB0aWxlZDogdHJ1ZVxuICAgIH07XG4gICAgXG4gICAgdmFyIG1hcExheWVyID0gbmV3IFdNU0xheWVyKGNvbmZpZyk7XG4gICAgc2VsZi5yZWdpc3Rlckxpc3RlbmVycyhtYXBMYXllcik7XG4gICAgXG4gICAgbWFwTGF5ZXIuYWRkTGF5ZXIobGF5ZXIpO1xuICAgIHNlbGYubWFwQmFzZUxheWVyc1tsYXllci5pZF0gPSBtYXBMYXllcjtcbiAgfSk7XG4gIFxuICBfLmZvckVhY2goXy52YWx1ZXModGhpcy5tYXBCYXNlTGF5ZXJzKS5yZXZlcnNlKCksZnVuY3Rpb24obWFwTGF5ZXIpe1xuICAgIHNlbGYudmlld2VyLm1hcC5hZGRMYXllcihtYXBMYXllci5nZXRPTExheWVyKCkpO1xuICAgIG1hcExheWVyLnVwZGF0ZShzZWxmLnN0YXRlKTtcbiAgfSlcbn07XG5cbnByb3RvLnNldHVwTGF5ZXJzID0gZnVuY3Rpb24oKXtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICB0aGlzLnZpZXdlci5yZW1vdmVMYXllcnMoKTtcbiAgdGhpcy5zZXR1cEJhc2VMYXllcnMoKTtcbiAgXG4gIHRoaXMubWFwTGF5ZXJzID0ge307XG4gIHRoaXMubGF5ZXJzQXNzb2NpYXRpb24gPSB7fTtcbiAgdmFyIGxheWVyc0FycmF5ID0gdGhpcy50cmF2ZXJzZUxheWVyc1RyZWUodGhpcy5wcm9qZWN0LnN0YXRlLmxheWVyc3RyZWUpO1xuICAvLyBwcmVuZG8gc29sbyBpIGxheWVyIHZlcmkgZSBub24gaSBmb2xkZXJcbiAgdmFyIGxlYWZMYXllcnNBcnJheSA9IF8uZmlsdGVyKGxheWVyc0FycmF5LGZ1bmN0aW9uKGxheWVyKXtcbiAgICByZXR1cm4gIV8uZ2V0KGxheWVyLCdub2RlcycpO1xuICB9KTtcbiAgdmFyIG11bHRpTGF5ZXJzID0gXy5ncm91cEJ5KGxlYWZMYXllcnNBcnJheSxmdW5jdGlvbihsYXllcil7XG4gICAgcmV0dXJuIGxheWVyLm11bHRpbGF5ZXI7XG4gIH0pO1xuICBfLmZvckVhY2gobXVsdGlMYXllcnMsZnVuY3Rpb24obGF5ZXJzLGlkKXtcbiAgICB2YXIgbGF5ZXJJZCA9ICdsYXllcl8nK2lkXG4gICAgdmFyIG1hcExheWVyID0gXy5nZXQoc2VsZi5tYXBMYXllcnMsbGF5ZXJJZCk7XG4gICAgdmFyIHRpbGVkID0gbGF5ZXJzWzBdLnRpbGVkIC8vIEJSVVRUTywgZGEgc2lzdGVtYXJlIHF1YW5kbyByaW9yZ2FuaXp6ZXJlbW8gaSBtZXRhbGF5ZXIgKGRhIGZhciBkaXZlbnRhcmUgbXVsdGlsYXllcikuIFBlciBvcmEgcG9zc28gY29uZmlndXJhcmUgdGlsZWQgc29sbyBpIGxheWVyIHNpbmdvbGlcbiAgICB2YXIgY29uZmlnID0ge1xuICAgICAgdXJsOiBzZWxmLnByb2plY3QuZ2V0V21zVXJsKCksXG4gICAgICBpZDogbGF5ZXJJZCxcbiAgICAgIHRpbGVkOiB0aWxlZFxuICAgIH07XG4gICAgbWFwTGF5ZXIgPSBzZWxmLm1hcExheWVyc1tsYXllcklkXSA9IG5ldyBXTVNMYXllcihjb25maWcsc2VsZi5sYXllcnNFeHRyYVBhcmFtcyk7XG4gICAgc2VsZi5yZWdpc3Rlckxpc3RlbmVycyhtYXBMYXllcik7XG4gICAgXG4gICAgbGF5ZXJzLmZvckVhY2goZnVuY3Rpb24obGF5ZXIpe1xuICAgICAgbWFwTGF5ZXIuYWRkTGF5ZXIobGF5ZXIpO1xuICAgICAgc2VsZi5sYXllcnNBc3NvY2lhdGlvbltsYXllci5pZF0gPSBsYXllcklkO1xuICAgIH0pO1xuICB9KVxuICBcbiAgXy5mb3JFYWNoKF8udmFsdWVzKHRoaXMubWFwTGF5ZXJzKS5yZXZlcnNlKCksZnVuY3Rpb24obWFwTGF5ZXIpe1xuICAgIHNlbGYudmlld2VyLm1hcC5hZGRMYXllcihtYXBMYXllci5nZXRPTExheWVyKCkpO1xuICAgIG1hcExheWVyLnVwZGF0ZShzZWxmLnN0YXRlLHNlbGYubGF5ZXJzRXh0cmFQYXJhbXMpO1xuICB9KVxufTtcblxucHJvdG8udXBkYXRlTWFwTGF5ZXJzID0gZnVuY3Rpb24obWFwTGF5ZXJzKSB7XG4gIHZhciBzZWxmID0gdGhpcztcbiAgXy5mb3JFYWNoKF8udmFsdWVzKG1hcExheWVycyksZnVuY3Rpb24obWFwTGF5ZXIpe1xuICAgIG1hcExheWVyLnVwZGF0ZShzZWxmLnN0YXRlLHNlbGYubGF5ZXJzRXh0cmFQYXJhbXMpO1xuICB9KVxufTtcblxucHJvdG8uZ2V0TWFwTGF5ZXJGb3JMYXllciA9IGZ1bmN0aW9uKGxheWVyKXtcbiAgcmV0dXJuIHRoaXMubWFwTGF5ZXJzWydsYXllcl8nK2xheWVyLm11bHRpbGF5ZXJdO1xufTtcblxucHJvdG8udHJhdmVyc2VMYXllcnNUcmVlID0gZnVuY3Rpb24obGF5ZXJzVHJlZSl7XG4gIHZhciBzZWxmID0gdGhpcztcbiAgdmFyIGxheWVyc0FycmF5ID0gW107XG4gIGZ1bmN0aW9uIHRyYXZlcnNlKG9iail7XG4gICAgXy5mb3JJbihvYmosIGZ1bmN0aW9uICh2YWwsIGtleSkge1xuICAgICAgICBpZiAoIV8uaXNOaWwodmFsLmlkKSkge1xuICAgICAgICAgICAgbGF5ZXJzQXJyYXkudW5zaGlmdCh2YWwpO1xuICAgICAgICB9XG4gICAgICAgIGlmICghXy5pc05pbCh2YWwubm9kZXMpKSB7XG4gICAgICAgICAgICB0cmF2ZXJzZSh2YWwubm9kZXMpO1xuICAgICAgICB9XG4gICAgfSk7XG4gIH1cbiAgdHJhdmVyc2UobGF5ZXJzVHJlZSk7XG4gIHJldHVybiBsYXllcnNBcnJheTtcbn07XG5cbnByb3RvLnJlZ2lzdGVyTGlzdGVuZXJzID0gZnVuY3Rpb24obWFwTGF5ZXIpe1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIG1hcExheWVyLm9uKCdsb2Fkc3RhcnQnLGZ1bmN0aW9uKCl7XG4gICAgc2VsZi5faW5jcmVtZW50TG9hZGVycygpO1xuICB9KTtcbiAgbWFwTGF5ZXIub24oJ2xvYWRlbmQnLGZ1bmN0aW9uKCl7XG4gICAgc2VsZi5fZGVjcmVtZW50TG9hZGVycyhmYWxzZSk7XG4gIH0pO1xuICBcbiAgdGhpcy5vbignZXh0cmFQYXJhbXNTZXQnLGZ1bmN0aW9uKGV4dHJhUGFyYW1zLHVwZGF0ZSl7XG4gICAgaWYgKHVwZGF0ZSkge1xuICAgICAgbWFwTGF5ZXIudXBkYXRlKHRoaXMuc3RhdGUsZXh0cmFQYXJhbXMpO1xuICAgIH1cbiAgfSlcbn07XG5cbnByb3RvLnNob3dWaWV3ZXIgPSBmdW5jdGlvbihlbElkKXtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICB0aGlzLnZpZXdlci5zZXRUYXJnZXQoZWxJZCk7XG4gIHZhciBtYXAgPSB0aGlzLnZpZXdlci5tYXA7XG4gIEdVSS5vbignZ3VpcmVhZHknLGZ1bmN0aW9uKCl7XG4gICAgc2VsZi5fc2V0TWFwVmlldygpO1xuICB9KTtcbn07XG5cblxuLy8gcGVyIGNyZWFyZSB1bmEgcGlsYSBkaSBvbC5pbnRlcmFjdGlvbiBpbiBjdWkgbCd1bHRpbW8gY2hlIHNpIGFnZ2l1bmdlIGRpc2F0dGl2YSB0ZW1wb3JhZW1lbnRlIGkgcHJlY2VkZW50aSAocGVyIHBvaSB0b2dsaWVyc2kgZGkgbWV6em8gY29uIHBvcEludGVyYWN0aW9uISlcbi8vIFVzYXRvIGFkIGVzLiBkYSBwaWNrZmVhdHVyZXRvb2wgZSBnZXRmZWF0dXJlaW5mb1xucHJvdG8ucHVzaEludGVyYWN0aW9uID0gZnVuY3Rpb24oaW50ZXJhY3Rpb24pe1xuICBpZiAodGhpcy5faW50ZXJhY3Rpb25zU3RhY2subGVuZ3RoKXtcbiAgICB2YXIgcHJldkludGVyYWN0aW9uID0gdGhpcy5faW50ZXJhY3Rpb25zU3RhY2suc2xpY2UoLTEpWzBdO1xuICAgIGlmIChfLmlzQXJyYXkocHJldkludGVyYWN0aW9uKSl7XG4gICAgICBfLmZvckVhY2gocHJldkludGVyYWN0aW9uLGZ1bmN0aW9uKGludGVyYWN0aW9uKXtcbiAgICAgICAgaW50ZXJhY3Rpb24uc2V0QWN0aXZlKGZhbHNlKTtcbiAgICAgIH0pXG4gICAgfVxuICAgIGVsc2V7XG4gICAgICBwcmV2SW50ZXJhY3Rpb24uc2V0QWN0aXZlKGZhbHNlKTtcbiAgICB9O1xuICB9XG4gIFxuICB0aGlzLnZpZXdlci5tYXAuYWRkSW50ZXJhY3Rpb24oaW50ZXJhY3Rpb24pO1xuICBpbnRlcmFjdGlvbi5zZXRBY3RpdmUodHJ1ZSk7XG4gIHRoaXMuX2ludGVyYWN0aW9uc1N0YWNrLnB1c2goaW50ZXJhY3Rpb24pXG59O1xuXG5wcm90by5wb3BJbnRlcmFjdGlvbiA9IGZ1bmN0aW9uKCl7XG4gIHZhciBpbnRlcmFjdGlvbiA9IHRoaXMuX2ludGVyYWN0aW9uc1N0YWNrLnBvcCgpO1xuICB0aGlzLnZpZXdlci5tYXAucmVtb3ZlSW50ZXJhY3Rpb24oaW50ZXJhY3Rpb24pO1xuICBcbiAgaWYgKHRoaXMuX2ludGVyYWN0aW9uc1N0YWNrLmxlbmd0aCl7XG4gICAgdmFyIHByZXZJbnRlcmFjdGlvbiA9IHRoaXMuX2ludGVyYWN0aW9uc1N0YWNrLnNsaWNlKC0xKVswXTtcbiAgICBpZiAoXy5pc0FycmF5KHByZXZJbnRlcmFjdGlvbikpe1xuICAgICAgXy5mb3JFYWNoKHByZXZJbnRlcmFjdGlvbixmdW5jdGlvbihpbnRlcmFjdGlvbil7XG4gICAgICAgIGludGVyYWN0aW9uLnNldEFjdGl2ZSh0cnVlKTtcbiAgICAgIH0pXG4gICAgfVxuICAgIGVsc2V7XG4gICAgICBwcmV2SW50ZXJhY3Rpb24uc2V0QWN0aXZlKHRydWUpO1xuICAgIH07XG4gIH1cbn07XG5cbnByb3RvLmdvVG8gPSBmdW5jdGlvbihjb29yZGluYXRlcyx6b29tKXtcbiAgdmFyIHpvb20gPSB6b29tIHx8IDY7XG4gIHRoaXMudmlld2VyLmdvVG8oY29vcmRpbmF0ZXMsem9vbSk7XG59O1xuXG5wcm90by5nb1RvV0dTODQgPSBmdW5jdGlvbihjb29yZGluYXRlcyx6b29tKXtcbiAgdmFyIGNvb3JkaW5hdGVzID0gb2wucHJvai50cmFuc2Zvcm0oY29vcmRpbmF0ZXMsJ0VQU0c6NDMyNicsJ0VQU0c6Jyt0aGlzLnByb2plY3Quc3RhdGUuY3JzKTtcbiAgdGhpcy5nb1RvKGNvb3JkaW5hdGVzLHpvb20pO1xufTtcblxucHJvdG8uZXh0ZW50VG9XR1M4NCA9IGZ1bmN0aW9uKGV4dGVudCl7XG4gIHJldHVybiBvbC5wcm9qLnRyYW5zZm9ybUV4dGVudChleHRlbnQsJ0VQU0c6Jyt0aGlzLnByb2plY3Quc3RhdGUuY3JzLCdFUFNHOjQzMjYnKTtcbn07XG5cbnByb3RvLmdldEZlYXR1cmVJbmZvID0gZnVuY3Rpb24obGF5ZXJJZCl7XG4gIHZhciBzZWxmID0gdGhpcztcbiAgdmFyIGRlZmVycmVkID0gJC5EZWZlcnJlZCgpO1xuICB0aGlzLl9waWNrSW50ZXJhY3Rpb24gPSBuZXcgUGlja0Nvb3JkaW5hdGVzSW50ZXJhY3Rpb24oKTtcbiAgLy90aGlzLnZpZXdlci5tYXAuYWRkSW50ZXJhY3Rpb24odGhpcy5fcGlja0ludGVyYWN0aW9uKTtcbiAgLy90aGlzLl9waWNrSW50ZXJhY3Rpb24uc2V0QWN0aXZlKHRydWUpO1xuICB0aGlzLnB1c2hJbnRlcmFjdGlvbih0aGlzLl9waWNrSW50ZXJhY3Rpb24pO1xuICB0aGlzLl9waWNrSW50ZXJhY3Rpb24ub24oJ3BpY2tlZCcsZnVuY3Rpb24oZSl7XG4gICAgc2VsZi5fY29tcGxldGVHZXRGZWF0dXJlSW5mbyhsYXllcklkLGUuY29vcmRpbmF0ZSxkZWZlcnJlZCk7XG4gIH0pXG4gIHJldHVybiBkZWZlcnJlZC5wcm9taXNlKCk7XG59O1xuXG5wcm90by5fY29tcGxldGVHZXRGZWF0dXJlSW5mbyA9IGZ1bmN0aW9uKGxheWVySWQsY29vcmRpbmF0ZSxkZWZlcnJlZCl7XG4gIHZhciBzZWxmID0gdGhpcztcbiAgdmFyIHByb2plY3RUeXBlID0gdGhpcy5wcm9qZWN0LnN0YXRlLnR5cGU7XG4gIFxuICB2YXIgbWFwTGF5ZXIgPSB0aGlzLm1hcExheWVyc1t0aGlzLmxheWVyc0Fzc29jaWF0aW9uW2xheWVySWRdXTtcbiAgdmFyIHJlc29sdXRpb24gPSBzZWxmLnZpZXdlci5nZXRSZXNvbHV0aW9uKCk7XG4gIHZhciBlcHNnID0gc2VsZi52aWV3ZXIubWFwLmdldFZpZXcoKS5nZXRQcm9qZWN0aW9uKCkuZ2V0Q29kZSgpO1xuICB2YXIgcGFyYW1zID0ge1xuICAgIFFVRVJZX0xBWUVSUzogUHJvamVjdC5nZXRMYXllcihsYXllcklkKS5uYW1lLFxuICAgIElORk9fRk9STUFUOiBcInRleHQveG1sXCJcbiAgfVxuICBcbiAgaWYgKHByb2plY3RUeXBlID09IFByb2plY3RUeXBlcy5RREpBTkdPKXtcbiAgICB2YXIgdG9sZXJhbmNlUGFyYW1zID0gUGlja1RvbGVyYW5jZVBhcmFtc1twcm9qZWN0VHlwZV07XG4gICAgaWYgKHRvbGVyYW5jZVBhcmFtcyl7XG4gICAgICB2YXIgZ2VvbWV0cnl0eXBlID0gdGhpcy5wcm9qZWN0LmdldExheWVyKGxheWVySWQpLmdlb21ldHJ5dHlwZTtcbiAgICAgIHBhcmFtc1t0b2xlcmFuY2VQYXJhbXNbZ2VvbWV0cnl0eXBlXV0gPSBQaWNrVG9sZXJhbmNlVmFsdWVzW2dlb21ldHJ5dHlwZV07XG4gICAgfVxuICB9XG4gIFxuICB2YXIgZ2V0RmVhdHVyZUluZm9VcmwgPSBtYXBMYXllci5nZXRTb3VyY2UoKS5nZXRHZXRGZWF0dXJlSW5mb1VybChjb29yZGluYXRlLHJlc29sdXRpb24sZXBzZyxwYXJhbXMpO1xuICAkLmdldChnZXRGZWF0dXJlSW5mb1VybClcbiAgLnRoZW4oZnVuY3Rpb24oZGF0YSl7XG4gICAgdmFyIHgyanMgPSBuZXcgWDJKUygpO1xuICAgIHZhciBqc29uRGF0YSA9IHgyanMueG1sMmpzb24oZGF0YSk7XG4gICAgaWYgKGpzb25EYXRhLkdldEZlYXR1cmVJbmZvUmVzcG9uc2UuTGF5ZXIuRmVhdHVyZSl7XG4gICAgICB2YXIgYXR0cmlidXRlcyA9IGpzb25EYXRhLkdldEZlYXR1cmVJbmZvUmVzcG9uc2UuTGF5ZXIuRmVhdHVyZS5BdHRyaWJ1dGU7XG4gICAgICB2YXIgYXR0cmlidXRlc09iaiA9IHt9O1xuICAgICAgXy5mb3JFYWNoKGF0dHJpYnV0ZXMsZnVuY3Rpb24oYXR0cmlidXRlKXtcbiAgICAgICAgYXR0cmlidXRlc09ialthdHRyaWJ1dGUuX25hbWVdID0gYXR0cmlidXRlLl92YWx1ZTsgLy8gWDJKUyBhZ2dpdW5nZSBcIl9cIiBjb21lIHByZWZpc3NvIGRlZ2xpIGF0dHJpYnV0aVxuICAgICAgfSlcbiAgICAgIFxuICAgICAgZGVmZXJyZWQucmVzb2x2ZShhdHRyaWJ1dGVzT2JqKTtcbiAgICB9XG4gICAgZGVmZXJyZWQucmVqZWN0KCk7O1xuICB9KVxuICAuZmFpbChmdW5jdGlvbigpe1xuICAgIGRlZmVycmVkLnJlamVjdCgpO1xuICB9KVxuICAuYWx3YXlzKGZ1bmN0aW9uKCl7XG4gICAgLy9zZWxmLnZpZXdlci5tYXAucmVtb3ZlSW50ZXJhY3Rpb24oc2VsZi5fcGlja0ludGVyYWN0aW9uKTtcbiAgICBzZWxmLnBvcEludGVyYWN0aW9uKCk7XG4gICAgc2VsZi5fcGlja0ludGVyYWN0aW9uID0gbnVsbDtcbiAgfSlcbn07XG5cbnByb3RvLmhpZ2hsaWdodEdlb21ldHJ5ID0gZnVuY3Rpb24oZ2VvbWV0cnlPYmosb3B0aW9ucyl7ICAgIFxuICB2YXIgZ2VvbWV0cnk7XG4gIGlmIChnZW9tZXRyeU9iaiBpbnN0YW5jZW9mIG9sLmdlb20uR2VvbWV0cnkpe1xuICAgIGdlb21ldHJ5ID0gZ2VvbWV0cnlPYmo7XG4gIH1cbiAgZWxzZSB7XG4gICAgZm9ybWF0ID0gbmV3IG9sLmZvcm1hdC5HZW9KU09OO1xuICAgIGdlb21ldHJ5ID0gZm9ybWF0LnJlYWRHZW9tZXRyeShnZW9tZXRyeU9iaik7XG4gIH1cbiAgXG4gIGlmIChvcHRpb25zLnpvb20pIHtcbiAgICB0aGlzLnZpZXdlci5maXQoZ2VvbWV0cnkpO1xuICB9XG4gIFxuICB2YXIgZHVyYXRpb24gPSBvcHRpb25zLmR1cmF0aW9uIHx8IDQwMDA7XG4gIFxuICBpZiAob3B0aW9ucy5mcm9tV0dTODQpIHtcbiAgICBnZW9tZXRyeS50cmFuc2Zvcm0oJ0VQU0c6NDMyNicsJ0VQU0c6Jyt0aGlzLnByb2plY3QucHJvamVjdC5jcnMpO1xuICB9XG4gIFxuICB2YXIgZmVhdHVyZSA9IG5ldyBvbC5GZWF0dXJlKHtcbiAgICBnZW9tZXRyeTogZ2VvbWV0cnlcbiAgfSk7XG4gIHZhciBzb3VyY2UgPSBuZXcgb2wuc291cmNlLlZlY3RvcigpO1xuICBzb3VyY2UuYWRkRmVhdHVyZXMoW2ZlYXR1cmVdKTtcbiAgdmFyIGxheWVyID0gbmV3IG9sLmxheWVyLlZlY3Rvcih7XG4gICAgc291cmNlOiBzb3VyY2UsXG4gICAgc3R5bGU6IGZ1bmN0aW9uKGZlYXR1cmUpe1xuICAgICAgdmFyIHN0eWxlcyA9IFtdO1xuICAgICAgdmFyIGdlb21ldHJ5VHlwZSA9IGZlYXR1cmUuZ2V0R2VvbWV0cnkoKS5nZXRUeXBlKCk7XG4gICAgICBpZiAoZ2VvbWV0cnlUeXBlID09ICdMaW5lU3RyaW5nJykge1xuICAgICAgICB2YXIgc3R5bGUgPSBuZXcgb2wuc3R5bGUuU3R5bGUoe1xuICAgICAgICAgIHN0cm9rZTogbmV3IG9sLnN0eWxlLlN0cm9rZSh7XG4gICAgICAgICAgICBjb2xvcjogJ3JnYigyNTUsMjU1LDApJyxcbiAgICAgICAgICAgIHdpZHRoOiA0XG4gICAgICAgICAgfSlcbiAgICAgICAgfSlcbiAgICAgICAgc3R5bGVzLnB1c2goc3R5bGUpO1xuICAgICAgfVxuICAgICAgZWxzZSBpZiAoZ2VvbWV0cnlUeXBlID09ICdQb2ludCcpe1xuICAgICAgICB2YXIgc3R5bGUgPSBuZXcgb2wuc3R5bGUuU3R5bGUoe1xuICAgICAgICAgIGltYWdlOiBuZXcgb2wuc3R5bGUuQ2lyY2xlKHtcbiAgICAgICAgICAgIHJhZGl1czogNixcbiAgICAgICAgICAgIGZpbGw6IG5ldyBvbC5zdHlsZS5GaWxsKHtcbiAgICAgICAgICAgICAgY29sb3I6ICdyZ2IoMjU1LDI1NSwwKScsXG4gICAgICAgICAgICB9KVxuICAgICAgICAgIH0pLFxuICAgICAgICAgIHpJbmRleDogSW5maW5pdHlcbiAgICAgICAgfSk7XG4gICAgICAgIHN0eWxlcy5wdXNoKHN0eWxlKTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgcmV0dXJuIHN0eWxlcztcbiAgICB9XG4gIH0pXG4gIGxheWVyLnNldE1hcCh0aGlzLnZpZXdlci5tYXApO1xuICBcbiAgc2V0VGltZW91dChmdW5jdGlvbigpe1xuICAgIGxheWVyLnNldE1hcChudWxsKTtcbiAgfSxkdXJhdGlvbik7XG59O1xuXG5wcm90by5yZWZyZXNoTWFwID0gZnVuY3Rpb24oKXtcbiAgXy5mb3JFYWNoKHRoaXMubWFwTGF5ZXJzLGZ1bmN0aW9uKHdtc0xheWVyKXtcbiAgICB3bXNMYXllci5nZXRMYXllcigpLmdldFNvdXJjZSgpLnVwZGF0ZVBhcmFtcyh7XCJ0aW1lXCI6IERhdGUubm93KCl9KTtcbiAgfSlcbn07XG5cbnByb3RvLl9zZXRNYXBWaWV3ID0gZnVuY3Rpb24oKXtcbiAgdmFyIGJib3ggPSB0aGlzLnZpZXdlci5nZXRCQk9YKCk7XG4gIHZhciByZXNvbHV0aW9uID0gdGhpcy52aWV3ZXIuZ2V0UmVzb2x1dGlvbigpO1xuICB2YXIgY2VudGVyID0gdGhpcy52aWV3ZXIuZ2V0Q2VudGVyKCk7XG4gIHRoaXMuc2V0TWFwVmlldyhiYm94LHJlc29sdXRpb24sY2VudGVyKTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gTWFwU2VydmljZVxuIiwibW9kdWxlLmV4cG9ydHMgPSBcIjxkaXYgaWQ9XFxcIm1hcFxcXCIgc3R5bGU9XFxcIndpZHRoOjEwMCU7aGVpZ2h0OjEwMCVcXFwiPlxcbjwvZGl2PlxcblwiO1xuIiwidmFyIGluaGVyaXQgPSByZXF1aXJlKCdjb3JlL3V0aWxzL3V0aWxzJykuaW5oZXJpdDtcbnZhciBiYXNlID0gcmVxdWlyZSgnY29yZS91dGlscy91dGlscycpLmJhc2U7XG52YXIgbWVyZ2UgPSByZXF1aXJlKCdjb3JlL3V0aWxzL3V0aWxzJykubWVyZ2U7XG52YXIgdCA9IHJlcXVpcmUoJ2NvcmUvaTE4bi9pMThuLnNlcnZpY2UnKS50O1xudmFyIHJlc29sdmUgPSByZXF1aXJlKCdjb3JlL3V0aWxzL3V0aWxzJykucmVzb2x2ZTtcbnZhciBHVUkgPSByZXF1aXJlKCdndWkvZ3VpJyk7ICAgXG52YXIgQ29tcG9uZW50ID0gcmVxdWlyZSgnZ3VpL3Z1ZS9jb21wb25lbnQnKTtcbnZhciBSb3V0ZXJTZXJ2aWNlID0gcmVxdWlyZSgnY29yZS9yb3V0ZXInKTtcbnZhciBvbDNoZWxwZXJzID0gcmVxdWlyZSgnZzN3LW9sMy9zcmMvZzN3Lm9sMycpLmhlbHBlcnM7XG52YXIgTWFwc1JlZ2lzdHJ5ID0gcmVxdWlyZSgnY29yZS9tYXAvbWFwc3JlZ2lzdHJ5Jyk7XG52YXIgTWFwU2VydmljZSA9IHJlcXVpcmUoJy4uL21hcHNlcnZpY2UnKTtcblxuZnVuY3Rpb24gbWFpbkhlaWdodCgpe1xuICAvL3JldHVybiAkKHdpbmRvdykuaW5uZXJIZWlnaHQoKS0kKFwiLm5hdmJhclwiKS5pbm5lckhlaWdodCgpO1xuICAvL3JldHVybiAkKHdpbmRvdykuaW5uZXJIZWlnaHQoKTtcbiAgdmFyIHRvcEhlaWdodCA9ICQoXCIubmF2YmFyXCIpLmlubmVySGVpZ2h0KCk7XG4gIHZhciBib3R0b21IZWlnaHQgPSAwO1xuICBcbiAgaWYgKCQoXCIuYm90dG9tYmFyXCIpLmlzKFwiOnZpc2libGVcIikpIHtcbiAgICBib3R0b21IZWlnaHQgPSAkKFwiLmJvdHRvbWJhclwiKS5pbm5lckhlaWdodCgpXG4gIH1cbiAgcmV0dXJuICQod2luZG93KS5pbm5lckhlaWdodCgpIC0gdG9wSGVpZ2h0IC0gYm90dG9tSGVpZ2h0O1xufVxuXG4vKiBtYXAgcmVzaXplIGNhbGN1bGF0aW9ucyAqL1xuZnVuY3Rpb24gc2V0TWFwRGl2SGVpZ2h0KG1hcCl7XG4gIHZhciBoZWlnaHQgPSBtYWluSGVpZ2h0KCk7XG4gICQoXCIjbWFwXCIpLmhlaWdodChoZWlnaHQpO1xuICBtYXAudXBkYXRlU2l6ZSgpO1xufVxuXG5mdW5jdGlvbiBzZXRNYXBEaXZXaWR0aChtYXApe1xuICB2YXIgb2Zmc2V0ID0gJChcIi5tYWluLXNpZGViYXJcIikub2Zmc2V0KCkubGVmdDtcbiAgdmFyIHdpZHRoID0gJChcIi5tYWluLXNpZGViYXJcIikuaW5uZXJXaWR0aCgpO1xuICB2YXIgc2lkZUJhclNwYWNlID0gd2lkdGggKyBvZmZzZXQ7XG4gICQoXCIjbWFwXCIpLndpZHRoKCQod2luZG93KS5pbm5lcldpZHRoKCkgLSBzaWRlQmFyU3BhY2UpO1xuICBtYXAudXBkYXRlU2l6ZSgpO1xufVxuXG52YXIgdnVlQ29tcG9uZW50T3B0aW9ucyA9IHtcbiAgdGVtcGxhdGU6IHJlcXVpcmUoJy4vbWFwLmh0bWwnKSxcbiAgcmVhZHk6IGZ1bmN0aW9uKCl7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIFxuICAgIHZhciBtYXBTZXJ2aWNlID0gdGhpcy4kb3B0aW9ucy5tYXBTZXJ2aWNlO1xuICAgIFxuICAgIG1hcFNlcnZpY2Uuc2hvd1ZpZXdlcih0aGlzLiRlbC5pZCk7XG4gICAgXG4gICAgLy8gcXVlc3RvIHNlcnZlIHBlciBxdWFuZG8gdmllbmUgY2FtYmlhdG8gcHJvZ2V0dG8vdmlzdGEgY2FydG9ncmFmaWNhLCBpbiBjdWkgdmllbmUgcmljcmVhdG8gaWwgdmlld2VyIChlIHF1aW5kaSBsYSBtYXBwYSlcbiAgICBtYXBTZXJ2aWNlLm9uYWZ0ZXIoJ3NldHVwVmlld2VyJyxmdW5jdGlvbigpe1xuICAgICAgbWFwU2VydmljZS5zaG93Vmlld2VyKHNlbGYuJGVsLmlkKTtcbiAgICB9KTtcbiAgICBcbiAgICBHVUkub24oJ2d1aXJlYWR5JyxmdW5jdGlvbigpe1xuICAgICAgc2V0TWFwRGl2SGVpZ2h0KG1hcFNlcnZpY2UuZ2V0TWFwKCkpO1xuICAgICAgXG4gICAgICAkKCcubWFpbi1zaWRlYmFyJykub24oJ3dlYmtpdFRyYW5zaXRpb25FbmQgdHJhbnNpdGlvbmVuZCBtc1RyYW5zaXRpb25FbmQgb1RyYW5zaXRpb25FbmQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgJCh0aGlzKS50cmlnZ2VyKCd0cmFucy1lbmQnKTtcbiAgICAgICAgICBzZXRNYXBEaXZXaWR0aChtYXBTZXJ2aWNlLmdldE1hcCgpKTtcbiAgICAgIH0pO1xuICAgICAgXG4gICAgICB2YXIgZHJhd2luZyA9IGZhbHNlO1xuICAgICAgdmFyIHJlc2l6ZUZpcmVkID0gZmFsc2U7XG4gICAgICBcbiAgICAgIEdVSS5vbignZ3VpcmVzaXplZCcsZnVuY3Rpb24oKXtcbiAgICAgICAgcmVzaXplRmlyZWQgPSB0cnVlO1xuICAgICAgICBkcmF3UmVzaXplKCk7XG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgJCh3aW5kb3cpLnJlc2l6ZShmdW5jdGlvbigpIHtcbiAgICAgICAgLy8gc2V0IHJlc2l6ZWRGaXJlZCB0byB0cnVlIGFuZCBleGVjdXRlIGRyYXdSZXNpemUgaWYgaXQncyBub3QgYWxyZWFkeSBydW5uaW5nXG4gICAgICAgIGlmIChkcmF3aW5nID09PSBmYWxzZSkge1xuICAgICAgICAgICAgcmVzaXplRmlyZWQgPSB0cnVlO1xuICAgICAgICAgICAgZHJhd1Jlc2l6ZSgpO1xuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgICAgZnVuY3Rpb24gZHJhd1Jlc2l6ZSgpIHtcbiAgICAgICAgdmFyIGhlaWdodDtcbiAgICAgICAgLy8gcmVuZGVyIGZyaWVuZGx5IHJlc2l6ZSBsb29wXG4gICAgICAgIGlmIChyZXNpemVGaXJlZCA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgcmVzaXplRmlyZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIGRyYXdpbmcgPSB0cnVlO1xuICAgICAgICAgICAgc2V0TWFwRGl2SGVpZ2h0KG1hcFNlcnZpY2UuZ2V0TWFwKCkpO1xuICAgICAgICAgICAgc2V0TWFwRGl2V2lkdGgobWFwU2VydmljZS5nZXRNYXAoKSk7XG4gICAgICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoZHJhd1Jlc2l6ZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBkcmF3aW5nID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIFxuICAgIH0pXG4gIH1cbn1cblxudmFyIEludGVybmFsQ29tcG9uZW50ID0gVnVlLmV4dGVuZCh2dWVDb21wb25lbnRPcHRpb25zKTtcblxuVnVlLmNvbXBvbmVudCgnZzN3LW1hcCcsIHZ1ZUNvbXBvbmVudE9wdGlvbnMpO1xuXG5mdW5jdGlvbiBNYXBDb21wb25lbnQob3B0aW9ucyl7XG4gIGJhc2UodGhpcyxvcHRpb25zKTtcbiAgdGhpcy5pZCA9IFwibWFwLWNvbXBvbmVudFwiO1xuICB0aGlzLnRpdGxlID0gXCJDYXRhbG9nbyBkYXRpXCI7XG4gIHRoaXMubWFwU2VydmljZSA9IG5ldyBNYXBTZXJ2aWNlO1xuICBtZXJnZSh0aGlzLCBvcHRpb25zKTtcbiAgdGhpcy5pbnRlcm5hbENvbXBvbmVudCA9IG5ldyBJbnRlcm5hbENvbXBvbmVudCh7XG4gICAgbWFwU2VydmljZTogdGhpcy5tYXBTZXJ2aWNlXG4gIH0pO1xufVxuaW5oZXJpdChNYXBDb21wb25lbnQsIENvbXBvbmVudCk7XG5cbnZhciBwcm90byA9IE1hcENvbXBvbmVudC5wcm90b3R5cGU7XG5cbm1vZHVsZS5leHBvcnRzID0gIE1hcENvbXBvbmVudDtcbiIsInZhciBsb2NhbGl6ZSA9IHJlcXVpcmUoJ2NvcmUvaTE4bi9pMThuLnNlcnZpY2UnKS50O1xudmFyIGluaGVyaXQgPSByZXF1aXJlKCdjb3JlL3V0aWxzL3V0aWxzJykuaW5oZXJpdDtcbnZhciByZXNvbHZlZFZhbHVlID0gcmVxdWlyZSgnY29yZS91dGlscy91dGlscycpLnJlc29sdmU7XG52YXIgRzNXT2JqZWN0ID0gcmVxdWlyZSgnY29yZS9nM3dvYmplY3QnKTtcblxudmFyIFBhbmVsID0gZnVuY3Rpb24ob3B0aW9ucykge1xuICBzZWxmID0gdGhpcztcbiAgdmFyIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuICBzZWxmLmlkID0gb3B0aW9ucy5pZCB8fCBudWxsO1xuICBzZWxmLnRpdGxlID0gb3B0aW9ucy50aXRsZSB8fCAnJztcbn07XG5cbmluaGVyaXQoUGFuZWwsIEczV09iamVjdCk7XG5cbnZhciBwcm90byA9IFBhbmVsLnByb3RvdHlwZTtcblxucHJvdG8uZ2V0SWQgPSBmdW5jdGlvbigpe1xuICByZXR1cm4gc2VsZi5pZDtcbn07XG5cbnByb3RvLmdldFRpdGxlID0gZnVuY3Rpb24oKXtcbiAgcmV0dXJuIHNlbGYudGl0bGU7XG59O1xuXG4vKiBIT09LUyAqL1xuXG4vKlxuICogSWwgbWV0b2RvIHBlcm1ldHRlIGFsIHBhbm5lbGxvIGRpIG1vbnRhcnNpIG5lbCBET01cbiAqIHBhcmVudDogZWxlbWVudG8gRE9NIHBhZHJlLCBzdSBjdWkgaW5zZXJpcnNpO1xuICogcml0b3JuYSB1bmEgcHJvbWlzZSwgcmlzb2x0YSBuZWwgbW9tZW50byBpbiBjdWkgc2Fyw6AgdGVybWluYXRvIGlsIG1vbnRhZ2dpb1xuKi9cblxuLy8gU09OTyBEVUUgVElQT0xPR0lFIERJIE1PTlRBR0dJTyBDT04gSUwgUVVBTEUgSUwgUEFOTkVMTE9cbi8vIENIRSBWRVJSQScgTU9OVEFUTyBBTCBWT0xPIENPTiBJTCBNRVRPRE8gTU9VTlQgQSBTRUNPTkRBIERFTCBUSVBPIERJIFBBTk5FTExPIFJJQ0hJRVNUT1xuXG4vLyByaWNoaWFtYXRvIHF1YW5kbyBsYSBHVUkgY2hpZWRlIGRpIGNoaXVkZXJlIGlsIHBhbm5lbGxvLiBTZSByaXRvcm5hIGZhbHNlIGlsIHBhbm5lbGxvIG5vbiB2aWVuZSBjaGl1c29cblxucHJvdG8ubW91bnQgPSBmdW5jdGlvbihwYXJlbnQpIHtcbiAgdmFyIHBhbmVsID0gdGhpcy5JbnRlcm5hbFBhbmVsO1xuICBwYW5lbC4kbW91bnQoKS4kYXBwZW5kVG8ocGFyZW50KTtcbiAgbG9jYWxpemUoKTtcbiAgcmV0dXJuIHJlc29sdmVkVmFsdWUodHJ1ZSk7XG59O1xuXG4vKlxuICogTWV0b2RvIHJpY2hpYW1hdG8gcXVhbmRvIHNpIHZ1b2xlIHJpbXVvdmVyZSBpbCBwYW5lbGxvLlxuICogUml0b3JuYSB1bmEgcHJvbWVzc2EgY2hlIHNhcsOgIHJpc29sdGEgbmVsIG1vbWVudG8gaW4gY3VpIGlsIHBhbm5lbGxvIGF2csOgIGNvbXBsZXRhdG8gbGEgcHJvcHJpYSByaW1vemlvbmUgKGVkIGV2ZW50dWFsZSByaWxhc2NpbyBkaSByaXNvcnNlIGRpcGVuZGVudGkpXG4qL1xucHJvdG8udW5tb3VudCA9IGZ1bmN0aW9uKCl7XG4gIHZhciBwYW5lbCA9IHRoaXMuSW50ZXJuYWxQYW5lbDtcbiAgdmFyIGRlZmVycmVkID0gJC5EZWZlcnJlZCgpO1xuICBwYW5lbC4kZGVzdHJveSh0cnVlKTtcbiAgZGVmZXJyZWQucmVzb2x2ZSgpO1xuICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZSgpO1xufTtcblxuLypcbiAqIE1ldG9kbyAob3B6aW9uYWxlKSBjaGUgb2ZmcmUgbCdvcHBvcnR1bml0w6AgZGkgcmljYWxjb2xhcmUgcHJvcHJpZXTDoCBkaXBlbmRlbnRpIGRhbGxlIGRpbWVuc2lvbmkgZGVsIHBhZHJlXG4gKiBwYXJlbnRIZWlnaHQ6IG51b3ZhIGFsdGV6emEgZGVsIHBhcmVudFxuICogcGFyZW50V2lkdGg6IG51b3ZhIGxhcmdoZXp6YSBkZWwgcGFyZW50XG4gKiByaWNoaWFtYXRvIG9nbmkgdm9sdGEgY2hlIGlsIHBhcmVudCBzdWJpc2NlIHVuIHJpZGltZW5zaW9uYW1lbnRvXG4qL1xucHJvdG8ub25SZXNpemUgPSBmdW5jdGlvbihwYXJlbnRXaWR0aCxwYXJlbnRIZWlnaHQpe307XG5cblxubW9kdWxlLmV4cG9ydHMgPSBQYW5lbDtcbiIsInZhciBpbmhlcml0ID0gcmVxdWlyZSgnY29yZS91dGlscy91dGlscycpLmluaGVyaXQ7XG52YXIgR1VJID0gcmVxdWlyZSgnZ3VpL2d1aScpO1xudmFyIFByb2plY3RzUmVnaXN0cnkgPSByZXF1aXJlKCdjb3JlL3Byb2plY3QvcHJvamVjdHNyZWdpc3RyeScpO1xudmFyIEczV09iamVjdCA9IHJlcXVpcmUoJ2NvcmUvZzN3b2JqZWN0Jyk7XG52YXIgU2VhcmNoUGFuZWwgPSByZXF1aXJlKCdndWkvc2VhcmNoL3Z1ZS9wYW5lbC9zZWFyY2hwYW5lbCcpO1xuXG5mdW5jdGlvbiBTZWFyY2hlc1NlcnZpY2UoKXtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICB0aGlzLmluaXQgPSBmdW5jdGlvbihzZWFyY2hlc09iamVjdCkge1xuICAgIHZhciBzZWFyY2hlcyA9IHNlYXJjaGVzT2JqZWN0IHx8IFByb2plY3RzUmVnaXN0cnkuZ2V0Q3VycmVudFByb2plY3QoKS5zdGF0ZS5zZWFyY2g7XG4gICAgdGhpcy5zdGF0ZS5zZWFyY2hlcyA9IHNlYXJjaGVzO1xuICB9O1xuXG4gIHRoaXMuc3RhdGUgPSB7XG4gICAgc2VhcmNoZXM6IFtdXG4gIH07XG5cbiAgdGhpcy5zaG93U2VhcmNoUGFuZWwgPSBmdW5jdGlvbihwYW5lbENvbmZpZykge1xuICAgIHBhbmVsID0gbmV3IFNlYXJjaFBhbmVsKCk7Ly8gY3JlbyBwYW5lbGxvIHNlYXJjaFxuICAgIHBhbmVsLmluaXQocGFuZWxDb25maWcpOy8vaW5pemlhbGl6em8gcGFubmVsbG8gc2VyYWNoXG4gICAgR1VJLnNob3dQYW5lbChwYW5lbCk7XG4gICAgcmV0dXJuIHBhbmVsO1xuICB9O1xuXG4gIHRoaXMuY2xlYW5TZWFyY2hQYW5lbHMgPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLnN0YXRlLnBhbmVscyA9IHt9O1xuICB9O1xuXG4gIHRoaXMuc3RvcCA9IGZ1bmN0aW9uKCl7XG4gICAgdmFyIGRlZmVycmVkID0gJC5EZWZlcnJlZCgpO1xuICAgIGRlZmVycmVkLnJlc29sdmUoKTtcbiAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZSgpO1xuICB9O1xufTtcblxuLy8gTWFrZSB0aGUgcHVibGljIHNlcnZpY2UgZW4gRXZlbnQgRW1pdHRlclxuaW5oZXJpdChTZWFyY2hlc1NlcnZpY2UsIEczV09iamVjdCk7XG5cbm1vZHVsZS5leHBvcnRzID0gbmV3IFNlYXJjaGVzU2VydmljZSgpO1xuIiwibW9kdWxlLmV4cG9ydHMgPSBcIjxkaXYgY2xhc3M9XFxcImczdy1zZWFyY2gtcGFuZWwgZm9ybS1ncm91cFxcXCI+XFxuICA8Zm9ybSBpZD1cXFwiZzN3LXNlYXJjaC1mb3JtXFxcIj5cXG4gICAgPHRlbXBsYXRlIHYtZm9yPVxcXCJmb3JtaW5wdXQgaW4gZm9ybWlucHV0c1xcXCI+XFxuICAgICAgIDx0ZW1wbGF0ZSB2LWlmPVxcXCJmb3JtaW5wdXQuaW5wdXQudHlwZSA9PSAnbnVtYmVyZmllbGQnXFxcIiBjbGFzcz1cXFwibnVtZXJpY1xcXCI+XFxuICAgICAgICAgPGxhYmVsIGZvcj1cXFwie3sgZm9ybWlucHV0LmlkIH19IFxcXCI+e3sgZm9ybWlucHV0LmxhYmVsIH19PC9sYWJlbD5cXG4gICAgICAgICA8aW5wdXQgdHlwZT1cXFwibnVtYmVyXFxcIiB2LW1vZGVsPVxcXCJmb3JtSW5wdXRWYWx1ZXNbJGluZGV4XS52YWx1ZVxcXCIgY2xhc3M9XFxcImZvcm0tY29udHJvbFxcXCIgaWQ9XFxcInt7IGZvcm1pbnB1dC5pZCB9fVxcXCI+XFxuICAgICAgIDwvdGVtcGxhdGU+XFxuICAgICAgPHRlbXBsYXRlIHYtaWY9XFxcImZvcm1pbnB1dC5pbnB1dC50eXBlID09ICd0ZXh0ZmllbGQnXFxcIiBjbGFzcz1cXFwidGV4dFxcXCI+XFxuICAgICAgICAgPGxhYmVsIGZvcj1cXFwie3sgZm9ybWlucHV0LmlkIH19XFxcIj57eyBmb3JtaW5wdXQubGFiZWwgfX08L2xhYmVsPlxcbiAgICAgICAgIDxpbnB1dCB0eXBlPVxcXCJ0ZXh0XFxcIiB2LW1vZGVsPVxcXCJmb3JtSW5wdXRWYWx1ZXNbJGluZGV4XS52YWx1ZVxcXCIgY2xhc3M9XFxcImZvcm0tY29udHJvbFxcXCIgaWQ9XFxcInt7IGZvcm1pbnB1dC5pZCB9fVxcXCI+XFxuICAgICAgIDwvdGVtcGxhdGU+XFxuICAgIDwvdGVtcGxhdGU+XFxuICAgIDxidXR0b24gY2xhc3M9XFxcImJ0biBidG4tcHJpbWFyeVxcXCIgQGNsaWNrPVxcXCJkb1NlYXJjaCgkZXZlbnQpXFxcIiBkYXRhLWkxOG49XFxcImRvc2VhcmNoXFxcIj5TZWFyY2g8L2J1dHRvbj5cXG4gIDwvZm9ybT5cXG48L2Rpdj5cXG5cIjtcbiIsInZhciBpbmhlcml0ID0gcmVxdWlyZSgnY29yZS91dGlscy91dGlscycpLmluaGVyaXQ7XG52YXIgbG9jYWxpemUgPSByZXF1aXJlKCdjb3JlL2kxOG4vaTE4bi5zZXJ2aWNlJykudDtcbnZhciByZXNvbHZlID0gcmVxdWlyZSgnY29yZS91dGlscy91dGlscycpLnJlc29sdmU7XG52YXIgR1VJID0gcmVxdWlyZSgnZ3VpL2d1aScpO1xudmFyIFNlYXJjaFF1ZXJ5U2VydmljZSA9IHJlcXVpcmUoJ2NvcmUvc2VhcmNoL3NlYXJjaHF1ZXJ5c2VydmljZScpO1xudmFyIExpc3RQYW5lbCA9IHJlcXVpcmUoJ2d1aS9saXN0cGFuZWwnKS5MaXN0UGFuZWw7XG52YXIgUGFuZWwgPSByZXF1aXJlKCdndWkvcGFuZWwnKTtcbnZhciBTZWFyY2hSZXN1bHRQYW5lbENvbXBvbmVudCA9IHJlcXVpcmUoJ2d1aS9zZWFyY2gvdnVlL3Jlc3VsdHMvcmVzdWx0cGFuZWwnKTtcbnZhciBQcm9qZWN0c1JlZ2lzdHJ5ID0gcmVxdWlyZSgnY29yZS9wcm9qZWN0L3Byb2plY3RzcmVnaXN0cnknKTtcblxuLy9jb21wb25lbnRlIHZ1ZSBwYW5uZWxsbyBzZWFyY2hcbnZhciBTZWFyY2hQYW5lbENvbXBvbmV0ID0gVnVlLmV4dGVuZCh7XG4gIHRlbXBsYXRlOiByZXF1aXJlKCcuL3NlYXJjaHBhbmVsLmh0bWwnKSxcbiAgZGF0YTogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGZvcm1pbnB1dHM6IFtdLFxuICAgICAgZmlsdGVyT2JqZWN0OiB7fSxcbiAgICAgIGZvcm1JbnB1dFZhbHVlcyA6IFtdXG4gICAgfVxuICB9LFxuICBtZXRob2RzOiB7XG4gICAgZG9TZWFyY2g6IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgLy9hbCBtb21lbnRvIG1vbHRvIGZhcnJhZ2dpbm9zbyBtYSBkYSByaXZlZGVyZVxuICAgICAgLy9wZXIgYXNzb2NpYXppb25lIHZhbG9yZSBpbnB1dFxuICAgICAgdGhpcy5maWx0ZXJPYmplY3QgPSBmaWxsRmlsdGVySW5wdXRzV2l0aFZhbHVlcyh0aGlzLmZpbHRlck9iamVjdCwgdGhpcy5mb3JtSW5wdXRWYWx1ZXMpO1xuICAgICAgU2VhcmNoUXVlcnlTZXJ2aWNlLmRvUXVlcnlTZWFyY2godGhpcy5maWx0ZXJPYmplY3QpO1xuICAgIH1cbiAgfVxufSk7XG5cbi8vZnVuemlvbmUgY2hlIGFzc29jaWEgaSB2YWxvcmkgZGVsbCdpbnB1dHMgZm9ybSBhbCByZWxhdGl2byBvZ2dldHRvIFwib3BlcmF6aW9uZGUgZGVsIGZpbHRyb1wiXG5cbmZ1bmN0aW9uIGZpbGxGaWx0ZXJJbnB1dHNXaXRoVmFsdWVzIChmaWx0ZXJPYmplY3QsIGZvcm1JbnB1dFZhbHVlcywgZ2xvYmFsSW5kZXgpIHtcbiAgLy9mdW56aW9uZSBjb252ZXJzaW9uZSBkYSB2YWxvcmUgcmVzdGl0dWl0byBkYWxsJ2lucHV0IChzZW1wcmUgc3RyaW5nYSkgYWwgdmVybyB0aXBvIGRpIHZhbG9yZVxuICBmdW5jdGlvbiBjb252ZXJ0SW5wdXRWYWx1ZVRvSW5wdXRUeXBlKHR5cGUsIHZhbHVlKSB7XG4gICAgc3dpdGNoKHR5cGUpIHtcbiAgICAgIGNhc2UgJ251bWJlcmZpZWxkJzpcbiAgICAgICAgICAgdmFsdWUgPSBwYXJzZUludCh2YWx1ZSk7XG4gICAgICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgYnJlYWs7XG4gICAgfVxuICAgIHJldHVybiB2YWx1ZTtcbiAgfVxuICAvL2NpY2xvIHN1bGwnb2dnZXR0byBmaWx0cm8gY2hlIGhhIGNvbWUgY2hpYXZlIHJvb3QgJ0FORCcgbyAnT1InXG4gIF8uZm9yRWFjaChmaWx0ZXJPYmplY3QuZmlsdGVyT2JqZWN0LCBmdW5jdGlvbih2LGspIHtcbiAgICAvL3Njb3JybyBhdHRyYXZlcnNvIGwnYXJyYXkgZGkgZWxlbWVudGkgb3BlcmF6aW9uYWxpIGRhIGNvbmZyb250YXJlXG4gICAgXy5mb3JFYWNoKHYsIGZ1bmN0aW9uKGlucHV0LCBpZHgpIHtcbiAgICAgIC8vZWxlbWVudG8gb3BlcmF6aW9uYWxlIHsnPSc6e319XG4gICAgICBfLmZvckVhY2goaW5wdXQsIGZ1bmN0aW9uKHYsIGssIG9iaikge1xuICAgICAgICAvL3ZhZG8gYSBsZWdnZXJlIGwnb2dnZXR0byBhdHRyaWJ1dG9cbiAgICAgICAgaWYgKF8uaXNBcnJheSh2KSkge1xuICAgICAgICAgIC8vcmljaGlhbWEgbGEgZnVuemlvbmUgcmljb3JzaXZhbWVudGUgLi4gYW5kcsOgIGJlbmUgP1xuICAgICAgICAgIGZpbGxGaWx0ZXJJbnB1dHNXaXRoVmFsdWVzKGlucHV0LCBmb3JtSW5wdXRWYWx1ZXMsIGlkeCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgXy5mb3JFYWNoKHYsIGZ1bmN0aW9uKHYsIGssIG9iaikge1xuICAgICAgICAgICAgLy9jb25zaWRlcm8gbCdpbmRleCBnbG9iYWxlIGluIG1vZG8gY2hlIGlucHV0cyBkaSBvcGVyYXppb25pIGJvb2xlYW5lIGludGVybmVcbiAgICAgICAgICAgIC8vdmVuZ29ubyBjb25zaWRlcmF0ZVxuICAgICAgICAgICAgaW5kZXggPSAoZ2xvYmFsSW5kZXgpID8gZ2xvYmFsSW5kZXggKyBpZHggOiBpZHg7XG4gICAgICAgICAgICBvYmpba10gPSBjb252ZXJ0SW5wdXRWYWx1ZVRvSW5wdXRUeXBlKGZvcm1JbnB1dFZhbHVlc1tpbmRleF0udHlwZSwgZm9ybUlucHV0VmFsdWVzW2luZGV4XS52YWx1ZSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG4gIHJldHVybiBmaWx0ZXJPYmplY3Q7XG59O1xuXG4vL2Nvc3RydXR0b3JlIGRlbCBwYW5uZWxsbyBlIGRlbCBzdW8gY29tcG9uZW50ZSB2dWVcbmZ1bmN0aW9uIFNlYXJjaFBhbmVsKCkge1xuICBzZWxmID0gdGhpcztcbiAgdGhpcy5jb25maWcgPSB7fTtcbiAgdGhpcy5maWx0ZXIgPSB7fTtcbiAgdGhpcy5pZCA9IG51bGw7XG4gIHRoaXMucXVlcnlsYXllcmlkID0gbnVsbDtcbiAgdGhpcy5JbnRlcm5hbFBhbmVsID0gbmV3IFNlYXJjaFBhbmVsQ29tcG9uZXQoKTtcbiAgLy9mdW56aW9uZSBpbml6aWFsaXp6YXppb25lXG4gIHRoaXMuaW5pdCA9IGZ1bmN0aW9uKGNvbmZpZykge1xuICAgIHRoaXMuY29uZmlnID0gY29uZmlnIHx8IHt9O1xuICAgIHRoaXMubmFtZSA9IHRoaXMuY29uZmlnLm5hbWUgfHwgdGhpcy5uYW1lO1xuICAgIHRoaXMuaWQgPSB0aGlzLmNvbmZpZy5pZCB8fCB0aGlzLmlkO1xuICAgIHRoaXMuZmlsdGVyID0gdGhpcy5jb25maWcub3B0aW9ucy5maWx0ZXIgfHwgdGhpcy5maWx0ZXI7XG4gICAgdGhpcy5xdWVyeWxheWVyaWQgPSB0aGlzLmNvbmZpZy5vcHRpb25zLnF1ZXJ5bGF5ZXJpZCB8fCB0aGlzLnF1ZXJ5bGF5ZXJpZDtcbiAgICAvL3ZhZG8gYSByaWVtcGlyZSBnbGkgaW5wdXQgZGVsIGZvcm0gZGVsIHBhbm5lbGxvXG4gICAgdGhpcy5maWxsSW5wdXRzRm9ybUZyb21GaWx0ZXIoKTtcbiAgICAvL2NyZW8gZSBhc3NlZ25vIGwnb2dnZXR0byBmaWx0cm9cbiAgICB2YXIgZmlsdGVyT2JqRnJvbUNvbmZpZyA9IFNlYXJjaFF1ZXJ5U2VydmljZS5jcmVhdGVRdWVyeUZpbHRlckZyb21Db25maWcodGhpcy5maWx0ZXIpO1xuICAgIC8vYWxsYSBmaW5lIGNyZW8gbCdnZ2V0dG8gZmluYWxlIGRlbCBmaWx0cm8gZGEgcGFzc2FyZSBwb2kgYWwgcHJvdmlkZXIgUUdJU1dNUyBvIFdGUyBldGMuLiBjaGUgY29udGllbmUgc2lhXG4gICAgLy9pbCBmaWx0cm8gY2hlIHVybCwgaWwgbm9tZSBkZWwgbGF5ZXIgaWwgdGlwbyBkaSBzZXJ2ZXIgZXRjIC4uXG4gICAgdGhpcy5JbnRlcm5hbFBhbmVsLmZpbHRlck9iamVjdCA9IFNlYXJjaFF1ZXJ5U2VydmljZS5jcmVhdGVRdWVyeUZpbHRlck9iamVjdCh0aGlzLnF1ZXJ5bGF5ZXJpZCwgZmlsdGVyT2JqRnJvbUNvbmZpZyk7XG4gIH07XG5cbiAgLy9mdW56aW9uZSBjaGUgcG9wb2xhIGdsaSBpbnB1dHMgY2hlIGNpIHNhcmFubm8gbmVsIGZvcm0gZGVsIHBhbm5lbGxvIHJpY2VyY2FcbiAgLy9vbHRyZSBjb3N0cnVpcmUgdW4gb2dnZXR0byBjaGUgbGVnaGVyw6AgaSB2YWxvcmkgZGVnbGkgaW5wdXRzIGRlbCBmb3JtIGNvbiBnbGkgb2dnZXR0aVxuICAvLydvcGVyYXppb25hbGknIGRlbCBmaWx0cm9cbiAgdGhpcy5maWxsSW5wdXRzRm9ybUZyb21GaWx0ZXIgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgaWQgPSAwO1xuICAgIHZhciBmb3JtVmFsdWU7XG4gICAgXy5mb3JFYWNoKHRoaXMuZmlsdGVyLGZ1bmN0aW9uKHYsayxvYmopIHtcbiAgICAgIF8uZm9yRWFjaCh2LCBmdW5jdGlvbihpbnB1dCl7XG4gICAgICAgIC8vc2VtcHJlIG51b3ZvIG9nZ2V0dG9cbiAgICAgICAgZm9ybVZhbHVlID0ge307XG4gICAgICAgIC8vaW5zZXJpc2NvIGwnaWQgYWxsJ2lucHV0XG4gICAgICAgIGlucHV0LmlkID0gaWRcbiAgICAgICAgLy9hZ2dpdW5nbyBpbCB0aXBvIGFsIHZhbG9yZSBwZXIgZmFyZSBjb252ZXJzaW9uZSBkYSBzdHJpbmdhIGEgdGlwbyBpbnB1dFxuICAgICAgICBmb3JtVmFsdWUudHlwZSA9IGlucHV0LmlucHV0LnR5cGU7XG4gICAgICAgIC8vLy9URU1QT1JBTkVPICEhISBERVZPIFBSRU5ERVJFIElMIFZFUk8gVkFMT1JFIERJIERFRkFVTFRcbiAgICAgICAgZm9ybVZhbHVlLnZhbHVlID0gbnVsbDtcbiAgICAgICAgLy9wb3BvbG8gZ2xpIGlucHV0czpcblxuICAgICAgICAvLyB2YWxvcmlcbiAgICAgICAgc2VsZi5JbnRlcm5hbFBhbmVsLmZvcm1JbnB1dFZhbHVlcy5wdXNoKGZvcm1WYWx1ZSk7XG4gICAgICAgIC8vaW5wdXRcbiAgICAgICAgc2VsZi5JbnRlcm5hbFBhbmVsLmZvcm1pbnB1dHMucHVzaChpbnB1dCk7XG4gICAgICAgIGlkKz0xO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH07XG59O1xuXG5pbmhlcml0KFNlYXJjaFBhbmVsLCBQYW5lbCk7XG5cbi8vc2VhcmNoIHF1ZXJ5XG5TZWFyY2hRdWVyeVNlcnZpY2Uub24oXCJzZWFyY2hyZXN1bHRzXCIsZnVuY3Rpb24ocmVzdWx0cyl7XG4gIHZhciBsaXN0UGFuZWwgPSBuZXcgTGlzdFBhbmVsKHtcbiAgICBuYW1lOiBcIlJpc3VsdGF0aSByaWNlcmNhXCIsXG4gICAgaWQ6ICdub21pbmF0aW1fcmVzdWx0cycsXG4gICAgbGlzdDogcmVzdWx0cyxcbiAgICBsaXN0UGFuZWxDb21wb25lbnQ6IFNlYXJjaFJlc3VsdFBhbmVsQ29tcG9uZW50XG4gIH0pO1xuICBHVUkuc2hvd0xpc3RpbmcobGlzdFBhbmVsKTtcbn0pO1xuXG5tb2R1bGUuZXhwb3J0cyA9IFNlYXJjaFBhbmVsO1xuIiwibW9kdWxlLmV4cG9ydHMgPSBcIjxkaXYgaWQ9XFxcInNlYXJjaC1yZXN1bHRzXFxcIj5cXG4gIDx0YWJsZSBzdHlsZT1cXFwid2lkdGg6MTAwcHg7XFxcIiBpZD1cXFwic2VhcmNoLXJlc3VsdHMtdGFibGVcXFwiPlxcbiAgICA8dGhlYWQ+XFxuICAgICAgPHRyPlxcbiAgICAgICAgPHRoIHYtZm9yPVxcXCJoZWFkZXIgaW4gc3RhdGUubGlzdC5oZWFkZXJzXFxcIiAgc3R5bGU9XFxcImN1cnNvcjpwb2ludGVyXFxcIj57eyBoZWFkZXIgfX08L3RoPlxcbiAgICAgIDwvdHI+XFxuICAgIDwvdGhlYWQ+XFxuICAgIDx0Ym9keT5cXG4gICAgICA8dHIgdi1mb3I9XFxcInZhbHVlcyBpbiBzdGF0ZS5saXN0LnZhbHVlc1xcXCIgc3R5bGU9XFxcImN1cnNvcjpwb2ludGVyXFxcIj5cXG4gICAgICAgIDx0ZCB2LWZvcj1cXFwidmFsdWUgaW4gdmFsdWVzXFxcIj5cXG4gICAgICAgICAge3sgdmFsdWUgfX1cXG4gICAgICAgIDwvdGQ+XFxuICAgICAgPC90cj5cXG4gICAgPC90Ym9keT5cXG4gIDwvdGFibGU+XFxuPC9kaXY+XFxuXCI7XG4iLCJ2YXIgU2VhcmNoUmVzdWx0UGFuZWxDb21wb25lbnQgPSBWdWUuZXh0ZW5kKHtcbiAgdGVtcGxhdGU6IHJlcXVpcmUoJy4vcmVzdWx0cGFuZWwuaHRtbCcpLFxuICBtZXRob2RzOiB7fSxcbiAgY3JlYXRlZDogZnVuY3Rpb24oKXtcbiAgICAkKFwiI3NlYXJjaC1yZXN1bHRzLXRhYmxlXCIpLmZvb3RhYmxlKHtcbiAgICAgIGNhbGN1bGF0ZVdpZHRoT3ZlcnJpZGU6IGZ1bmN0aW9uKCl7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgd2lkdGg6ICQoJyNzZWFyY2gtcmVzdWx0cycpLndpZHRoKClcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICB9XG59KTtcblxubW9kdWxlLmV4cG9ydHMgPSBTZWFyY2hSZXN1bHRQYW5lbENvbXBvbmVudDtcbiIsIm1vZHVsZS5leHBvcnRzID0gXCI8ZGl2IGlkPVxcXCJnM3ctc2VhcmNoXFxcIiBjbGFzcz1cXFwiZzN3LXNlYXJjaCBnM3ctdG9vbHNcXFwiPlxcbiAgPHVsPlxcbiAgICA8bGkgdi1mb3I9XFxcInNlYXJjaCBpbiBzZWFyY2hlcy5zZWFyY2hcXFwiPlxcbiAgICAgIDxkaXYgc3R5bGU9XFxcIm1hcmdpbi1ib3R0b206IDVweDtcXFwiY2xhc3M9XFxcInNlYXJjaC1oZWFkZXIgdG9vbC1oZWFkZXJcXFwiIEBjbGljaz1cXFwic2hvd1NlYXJjaFBhbmVsKHNlYXJjaClcXFwiPlxcbiAgICAgICAgPHNwYW4gc3R5bGU9XFxcIlxcXCI+e3sgc2VhcmNoLm5hbWUgfX08L3NwYW4+XFxuICAgICAgPC9kaXY+XFxuICAgIDwvbGk+XFxuICA8L3VsPlxcbjwvZGl2PlxcblxcblwiO1xuIiwidmFyIGluaGVyaXQgPSByZXF1aXJlKCdjb3JlL3V0aWxzL3V0aWxzJykuaW5oZXJpdDtcbnZhciBiYXNlID0gcmVxdWlyZSgnY29yZS91dGlscy91dGlscycpLmJhc2U7XG52YXIgbWVyZ2UgPSByZXF1aXJlKCdjb3JlL3V0aWxzL3V0aWxzJykubWVyZ2U7XG52YXIgdCA9IHJlcXVpcmUoJ2NvcmUvaTE4bi9pMThuLnNlcnZpY2UnKS50O1xudmFyIHJlc29sdmUgPSByZXF1aXJlKCdjb3JlL3V0aWxzL3V0aWxzJykucmVzb2x2ZTtcbnZhciBDb21wb25lbnQgPSByZXF1aXJlKCdndWkvdnVlL2NvbXBvbmVudCcpO1xudmFyIEdVSSA9IHJlcXVpcmUoJ2d1aS9ndWknKTtcbnZhciBQcm9qZWN0c1JlZ2lzdHJ5ID0gcmVxdWlyZSgnY29yZS9wcm9qZWN0L3Byb2plY3RzcmVnaXN0cnknKTtcbnZhciBHM1dPYmplY3QgPSByZXF1aXJlKCdjb3JlL2czd29iamVjdCcpO1xudmFyIFNlYXJjaFBhbmVsID0gcmVxdWlyZSgnZ3VpL3NlYXJjaC92dWUvcGFuZWwvc2VhcmNocGFuZWwnKTtcbnZhciBQcm9qZWN0c1JlZ2lzdHJ5ID0gcmVxdWlyZSgnY29yZS9wcm9qZWN0L3Byb2plY3RzcmVnaXN0cnknKTtcbnZhciBTZWFyY2hlc1NlcnZpY2UgPSByZXF1aXJlKCdndWkvc2VhcmNoL3NlYXJjaGVzc2VydmljZScpO1xuXG52YXIgdnVlQ29tcG9uZW50T3B0aW9ucyA9IHtcbiAgIHRlbXBsYXRlOiByZXF1aXJlKCcuL3NlYXJjaC5odG1sJyksXG4gICBkYXRhOiBmdW5jdGlvbigpIHtcbiAgICBcdHJldHVybiB7XG4gICAgXHQgIHNlYXJjaGVzOiBQcm9qZWN0c1JlZ2lzdHJ5LmdldEN1cnJlbnRQcm9qZWN0KCkuc3RhdGVcbiAgICBcdH07XG4gICB9LFxuICAgbWV0aG9kczoge1xuICAgIHNob3dTZWFyY2hQYW5lbDogZnVuY3Rpb24oc2VhcmNoKSB7XG4gICAgICAgIHZhciBwYW5lbCA9IFNlYXJjaGVzU2VydmljZS5zaG93U2VhcmNoUGFuZWwoc2VhcmNoKTtcbiAgICB9XG4gIH1cbn07XG5cbi8vIHNlIGxvIHZvZ2xpbyBpc3RhbnppYXJlIG1hbnVhbG1lbnRlXG52YXIgSW50ZXJuYWxDb21wb25lbnQgPSBWdWUuZXh0ZW5kKHZ1ZUNvbXBvbmVudE9wdGlvbnMpO1xuLy8gc2UgbG8gdm9nbGlvIHVzYXJlIGNvbWUgY29tcG9uZW50ZSBjb21lIGVsZW1lbnRvIGh0bWxcbi8vVnVlLmNvbXBvbmVudCgnZzN3LXNlYXJjaCcsdnVlQ29tcG9uZW50T3B0aW9ucyk7XG5cbi8qIENPTVBPTkVOVEkgRklHTEkgKi9cbi8qIEZJTkUgQ09NUE9ORU5USSBGSUdMSSAqL1xuXG4vKiBJTlRFUkZBQ0NJQSBQVUJCTElDQSAqL1xuZnVuY3Rpb24gU2VhcmNoQ29tcG9uZW50KG9wdGlvbnMpe1xuICBiYXNlKHRoaXMsb3B0aW9ucyk7XG4gIHRoaXMuaWQgPSBcInNlYXJjaC1jb21wb25lbnRcIjtcbiAgdGhpcy50aXRsZSA9IFwic2VhcmNoXCI7XG4gIHRoaXMuaW50ZXJuYWxDb21wb25lbnQgPSBuZXcgSW50ZXJuYWxDb21wb25lbnQ7XG4gIG1lcmdlKHRoaXMsIG9wdGlvbnMpO1xuICB0aGlzLmluaXRTZXJ2aWNlID0gZnVuY3Rpb24oKSB7XG4gICAgLy9pbml6aWFsaXp6byBpbCBzZXJ2aXppb1xuICAgIFNlYXJjaGVzU2VydmljZS5pbml0KCk7XG4gIH07XG59O1xuXG5pbmhlcml0KFNlYXJjaENvbXBvbmVudCwgQ29tcG9uZW50KTtcblxuXG5tb2R1bGUuZXhwb3J0cyA9IFNlYXJjaENvbXBvbmVudDtcbiIsInZhciBpbmhlcml0ID0gcmVxdWlyZSgnY29yZS91dGlscy91dGlscycpLmluaGVyaXQ7XG52YXIgRzNXT2JqZWN0ID0gcmVxdWlyZSgnY29yZS9nM3dvYmplY3QnKTtcblxuZnVuY3Rpb24gVG9vbHNTZXJ2aWNlKCl7XG4gIHZhciBzZWxmID0gdGhpcztcbiAgdGhpcy5jb25maWcgPSBudWxsO1xuICB0aGlzLl9hY3Rpb25zID0ge307XG4gIHRoaXMuc3RhdGUgPSB7XG4gICAgdG9vbHM6IFtdXG4gIH07XG4gIFxuICB0aGlzLmluaXQgPSBmdW5jdGlvbihjb25maWcpe1xuICAgIHRoaXMuY29uZmlnID0gY29uZmlnO1xuICAgIHRoaXMuc2V0U3RhdGUoKTtcbiAgfTtcbiAgXG4gIHRoaXMuc2V0U3RhdGUgPSBmdW5jdGlvbigpe1xuICAgIHRoaXMuX21lcmdlVG9vbHModGhpcy5jb25maWcudG9vbHMpO1xuICB9O1xuICBcbiAgdGhpcy5yZWdpc3RlclRvb2xzUHJvdmlkZXIgPSBmdW5jdGlvbihwbHVnaW4pe1xuICAgIHNlbGYuX21lcmdlVG9vbHMocGx1Z2luLmdldFRvb2xzKCkpO1xuICAgIHNlbGYuX2FkZEFjdGlvbnMocGx1Z2luKTtcbiAgfVxuICBcbiAgdGhpcy5maXJlQWN0aW9uID0gZnVuY3Rpb24oYWN0aW9uaWQpe1xuICAgIHZhciBwbHVnaW4gPSB0aGlzLl9hY3Rpb25zW2FjdGlvbmlkXTtcbiAgICB2YXIgbWV0aG9kID0gdGhpcy5fYWN0aW9uTWV0aG9kKGFjdGlvbmlkKTtcbiAgICBwbHVnaW5bbWV0aG9kXSgpO1xuICB9O1xuICBcbiAgdGhpcy5fYWN0aW9uTWV0aG9kID0gZnVuY3Rpb24oYWN0aW9uaWQpe1xuICAgIHZhciBuYW1lc3BhY2UgPSBhY3Rpb25pZC5zcGxpdChcIjpcIik7XG4gICAgcmV0dXJuIG5hbWVzcGFjZS5wb3AoKTtcbiAgfTtcbiAgXG4gIHRoaXMuX21lcmdlVG9vbHMgPSBmdW5jdGlvbih0b29scyl7XG4gICAgc2VsZi5zdGF0ZS50b29scyA9IF8uY29uY2F0KHNlbGYuc3RhdGUudG9vbHMsdG9vbHMpO1xuICB9O1xuICBcbiAgdGhpcy5fYWRkQWN0aW9ucyA9IGZ1bmN0aW9uKHBsdWdpbil7XG4gICAgXy5mb3JFYWNoKHBsdWdpbi5nZXRUb29scygpLGZ1bmN0aW9uKHRvb2wpe1xuICAgICAgXy5mb3JFYWNoKHBsdWdpbi5nZXRBY3Rpb25zKHRvb2wpLGZ1bmN0aW9uKGFjdGlvbil7XG4gICAgICAgIHNlbGYuX2FjdGlvbnNbYWN0aW9uLmlkXSA9IHBsdWdpbjtcbiAgICAgIH0pXG4gICAgfSlcbiAgfTtcbn07XG5cbi8vIE1ha2UgdGhlIHB1YmxpYyBzZXJ2aWNlIGVuIEV2ZW50IEVtaXR0ZXJcbmluaGVyaXQoVG9vbHNTZXJ2aWNlLEczV09iamVjdCk7XG5cbm1vZHVsZS5leHBvcnRzID0gVG9vbHNTZXJ2aWNlXG4iLCJtb2R1bGUuZXhwb3J0cyA9IFwiPGRpdiBjbGFzcz1cXFwiZzN3LXRvb2xzXFxcIj5cXG4gIDx1bD5cXG4gICAgPGxpIHYtZm9yPVxcXCJ0b29sIGluIHRvb2xzXFxcIj5cXG4gICAgICA8ZGl2IGRhdGEtdG9nZ2xlPVxcXCJjb2xsYXBzZVxcXCIgZGF0YS10YXJnZXQ9XFxcIiNpdGVybmV0LXRvb2xzXFxcIiBjbGFzcz1cXFwidG9vbC1oZWFkZXJcXFwiPlxcbiAgICAgICAgPHNwYW4gc3R5bGU9XFxcIlxcXCI+e3sgdG9vbC5uYW1lIH19PC9zcGFuPlxcbiAgICAgIDwvZGl2PlxcbiAgICAgIDxkaXYgaWQ9XFxcIml0ZXJuZXQtdG9vbHNcXFwiIGNsYXNzPVxcXCJ0b29sLWJveCBjb2xsYXBzZVxcXCI+XFxuICAgICAgICA8dGVtcGxhdGUgdi1mb3I9XFxcImFjdGlvbiBpbiB0b29sLmFjdGlvbnNcXFwiPlxcbiAgICAgICAgICA8aSBjbGFzcz1cXFwiZ2x5cGhpY29uIGdseXBoaWNvbi1jb2dcXFwiPjwvaT5cXG4gICAgICAgICAgPHNwYW4gQGNsaWNrPVxcXCJmaXJlQWN0aW9uKGFjdGlvbi5pZClcXFwiPnt7IGFjdGlvbi5uYW1lIH19PC9zcGFuPlxcbiAgICAgICAgPC90ZW1wbGF0ZT5cXG4gICAgICA8L2Rpdj5cXG4gICAgPC9saT5cXG4gIDwvdWw+XFxuPC9kaXY+XFxuXCI7XG4iLCJ2YXIgdCA9IHJlcXVpcmUoJ2NvcmUvaTE4bi9pMThuLnNlcnZpY2UnKS50O1xudmFyIGluaGVyaXQgPSByZXF1aXJlKCdjb3JlL3V0aWxzL3V0aWxzJykuaW5oZXJpdDtcbnZhciBiYXNlID0gcmVxdWlyZSgnY29yZS91dGlscy91dGlscycpLmJhc2U7XG52YXIgbWVyZ2UgPSByZXF1aXJlKCdjb3JlL3V0aWxzL3V0aWxzJykubWVyZ2U7XG52YXIgQ29tcG9uZW50ID0gcmVxdWlyZSgnZ3VpL3Z1ZS9jb21wb25lbnQnKTtcblxudmFyIFRvb2xzU2VydmljZSA9IHJlcXVpcmUoJ2d1aS90b29scy90b29sc3NlcnZpY2UnKTtcblxudmFyIEludGVybmFsQ29tcG9uZW50ID0gVnVlLmV4dGVuZCh7XG4gICAgdGVtcGxhdGU6IHJlcXVpcmUoJy4vdG9vbHMuaHRtbCcpLFxuICAgIGRhdGE6IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgLy90b29sczogVG9vbHNTZXJ2aWNlLnN0YXRlLnRvb2xzXG4gICAgICB9XG4gICAgfSxcbiAgICBtZXRob2RzOiB7XG4gICAgICBmaXJlQWN0aW9uOiBmdW5jdGlvbihhY3Rpb25pZCl7XG4gICAgICAgIC8vVG9vbHNTZXJ2aWNlLmZpcmVBY3Rpb24oYWN0aW9uaWQpO1xuICAgICAgfVxuICAgIH1cbn0pO1xuXG5mdW5jdGlvbiBUb29sc0NvbXBvbmVudChvcHRpb25zKXtcbiAgYmFzZSh0aGlzLG9wdGlvbnMpO1xuICB0aGlzLmlkID0gXCJ0b29scy1jb21wb25lbnRcIjtcbiAgdGhpcy50aXRsZSA9IFwidG9vbHNcIjtcbiAgdGhpcy50b29sc1NlcnZpY2UgPSBuZXcgVG9vbHNTZXJ2aWNlKCk7XG4gIG1lcmdlKHRoaXMsIG9wdGlvbnMpO1xuICB0aGlzLmludGVybmFsQ29tcG9uZW50ID0gbmV3IEludGVybmFsQ29tcG9uZW50KHtcbiAgICB0b29sc1NlcnZpY2U6IHRoaXMudG9vbHNTZXJ2aWNlXG4gIH0pO1xufVxuXG5pbmhlcml0KFRvb2xzQ29tcG9uZW50LCBDb21wb25lbnQpO1xuXG5tb2R1bGUuZXhwb3J0cyA9IFRvb2xzQ29tcG9uZW50O1xuIiwibW9kdWxlLmV4cG9ydHMgPSBcIjwhLS0gaXRlbSB0ZW1wbGF0ZSAtLT5cXG48ZGl2IGlkPVxcXCJjYXRhbG9nXFxcIiBjbGFzcz1cXFwidGFiYmFibGUtcGFuZWwgY2F0YWxvZ1xcXCI+XFxuICA8ZGl2IGNsYXNzPVxcXCJ0YWJiYWJsZS1saW5lXFxcIj5cXG4gICAgPHVsIGNsYXNzPVxcXCJuYXYgbmF2LXRhYnNcXFwiIHJvbGU9XFxcInRhYmxpc3RcXFwiPlxcbiAgICAgIDxsaSByb2xlPVxcXCJwcmVzZW50YXRpb25cXFwiIGNsYXNzPVxcXCJhY3RpdmVcXFwiPjxhIGhyZWY9XFxcIiN0cmVlXFxcIiBhcmlhLWNvbnRyb2xzPVxcXCJ0cmVlXFxcIiByb2xlPVxcXCJ0YWJcXFwiIGRhdGEtdG9nZ2xlPVxcXCJ0YWJcXFwiIGRhdGEtaTE4bj1cXFwidHJlZVxcXCI+RGF0YTwvYT48L2xpPlxcbiAgICAgIDxsaSB2LWlmPVxcXCJoYXNCYXNlTGF5ZXJzXFxcIiByb2xlPVxcXCJwcmVzZW50YXRpb25cXFwiPjxhIGhyZWY9XFxcIiNiYXNlbGF5ZXJzXFxcIiBhcmlhLWNvbnRyb2xzPVxcXCJiYXNlbGF5ZXJzXFxcIiByb2xlPVxcXCJ0YWJcXFwiIGRhdGEtdG9nZ2xlPVxcXCJ0YWJcXFwiIGRhdGEtaTE4bj1cXFwiYmFzZWxheWVyc1xcXCI+TGF5ZXIgQmFzZTwvYT48L2xpPlxcbiAgICAgIDxsaSByb2xlPVxcXCJwcmVzZW50YXRpb25cXFwiPjxhIGhyZWY9XFxcIiNsZWdlbmRcXFwiIGFyaWEtY29udHJvbHM9XFxcImxlZ2VuZFxcXCIgcm9sZT1cXFwidGFiXFxcIiBkYXRhLXRvZ2dsZT1cXFwidGFiXFxcIiBkYXRhLWkxOG49XFxcImxlZ2VuZFxcXCI+TGVnZW5kYTwvYT48L2xpPlxcbiAgICA8L3VsPlxcbiAgICA8ZGl2ICBjbGFzcz1cXFwidGFiLWNvbnRlbnRcXFwiPlxcbiAgICAgIDxkaXYgcm9sZT1cXFwidGFicGFuZWxcXFwiIGNsYXNzPVxcXCJ0YWItcGFuZSBhY3RpdmUgdHJlZVxcXCIgaWQ9XFxcInRyZWVcXFwiPlxcbiAgICAgICAgPHVsIGNsYXNzPVxcXCJ0cmVlLXJvb3RcXFwiPlxcbiAgICAgICAgICA8dHJpc3RhdGUtdHJlZSB2LWlmPVxcXCIhaXNIaWRkZW5cXFwiIDpsYXllcnN0cmVlPVxcXCJsYXllcnN0cmVlXFxcIiBjbGFzcz1cXFwiaXRlbVxcXCIgdi1mb3I9XFxcImxheWVyc3RyZWUgaW4gbGF5ZXJzdHJlZVxcXCI+XFxuICAgICAgICAgIDwvdHJpc3RhdGUtdHJlZT5cXG4gICAgICAgIDwvdWw+XFxuICAgICAgPC9kaXY+XFxuICAgICAgPGRpdiB2LWlmPVxcXCJoYXNCYXNlTGF5ZXJzXFxcIiByb2xlPVxcXCJ0YWJwYW5lbFxcXCIgY2xhc3M9XFxcInRhYi1wYW5lIGJhc2VsYXllcnNcXFwiIGlkPVxcXCJiYXNlbGF5ZXJzXFxcIj5cXG4gICAgICAgIDxmb3JtPlxcbiAgICAgICAgICA8dWw+XFxuICAgICAgICAgICAgPGxpIHYtaWY9XFxcIiFiYXNlbGF5ZXIuZml4ZWRcXFwiIHYtZm9yPVxcXCJiYXNlbGF5ZXIgaW4gYmFzZWxheWVyc1xcXCI+XFxuICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVxcXCJyYWRpb1xcXCI+XFxuICAgICAgICAgICAgICAgIDxsYWJlbD48aW5wdXQgdHlwZT1cXFwicmFkaW9cXFwiIG5hbWU9XFxcImJhc2VsYXllclxcXCIgdi1jaGVja2VkPVxcXCJiYXNlbGF5ZXIudmlzaWJsZVxcXCIgQGNsaWNrPVxcXCJzZXRCYXNlTGF5ZXIoYmFzZWxheWVyLmlkKVxcXCI+e3sgYmFzZWxheWVyLnRpdGxlIH19PC9sYWJlbD5cXG4gICAgICAgICAgICAgIDwvZGl2PlxcbiAgICAgICAgICAgIDwvbGk+XFxuICAgICAgICAgIDwvdWw+XFxuICAgICAgICA8L2Zvcm0+XFxuICAgICAgPC9kaXY+XFxuICAgICAgPGxlZ2VuZCA6bGF5ZXJzdHJlZT1cXFwibGF5ZXJzdHJlZVxcXCI+PC9sZWdlbmQ+XFxuICAgIDwvZGl2PlxcbiAgPC9kaXY+XFxuPC9kaXY+XFxuXCI7XG4iLCJ2YXIgaW5oZXJpdCA9IHJlcXVpcmUoJ2NvcmUvdXRpbHMvdXRpbHMnKS5pbmhlcml0O1xudmFyIGJhc2UgPSByZXF1aXJlKCdjb3JlL3V0aWxzL3V0aWxzJykuYmFzZTtcbnZhciBtZXJnZSA9IHJlcXVpcmUoJ2NvcmUvdXRpbHMvdXRpbHMnKS5tZXJnZTtcbnZhciB0ID0gcmVxdWlyZSgnY29yZS9pMThuL2kxOG4uc2VydmljZScpLnQ7XG52YXIgcmVzb2x2ZSA9IHJlcXVpcmUoJ2NvcmUvdXRpbHMvdXRpbHMnKS5yZXNvbHZlO1xudmFyIENvbXBvbmVudCA9IHJlcXVpcmUoJ2d1aS92dWUvY29tcG9uZW50Jyk7XG52YXIgR1VJID0gcmVxdWlyZSgnZ3VpL2d1aScpO1xudmFyIFByb2plY3RzUmVnaXN0cnkgPSByZXF1aXJlKCdjb3JlL3Byb2plY3QvcHJvamVjdHNyZWdpc3RyeScpO1xuXG52YXIgdnVlQ29tcG9uZW50T3B0aW9ucyA9IHtcbiAgdGVtcGxhdGU6IHJlcXVpcmUoJy4vY2F0YWxvZy5odG1sJyksXG4gIGRhdGE6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB7XG4gICAgICBwcm9qZWN0OiBQcm9qZWN0c1JlZ2lzdHJ5LmdldEN1cnJlbnRQcm9qZWN0KClcbiAgICB9XG4gIH0sXG4gIGNvbXB1dGVkOiB7XG4gICAgbGF5ZXJzdHJlZTogZnVuY3Rpb24oKXtcbiAgICAgIHJldHVybiB0aGlzLnByb2plY3Quc3RhdGUubGF5ZXJzdHJlZTtcbiAgICB9LFxuICAgIGJhc2VsYXllcnM6IGZ1bmN0aW9uKCl7XG4gICAgICByZXR1cm4gdGhpcy5wcm9qZWN0LnN0YXRlLmJhc2VsYXllcnM7XG4gICAgfSxcbiAgICBoYXNCYXNlTGF5ZXJzOiBmdW5jdGlvbigpe1xuICAgICAgcmV0dXJuIHRoaXMucHJvamVjdC5zdGF0ZS5iYXNlbGF5ZXJzLmxlbmd0aD4wO1xuICAgIH1cbiAgfSxcbiAgbWV0aG9kczoge1xuICAgIHNldEJhc2VMYXllcjogZnVuY3Rpb24oaWQpIHtcbiAgICAgIHRoaXMucHJvamVjdC5zZXRCYXNlTGF5ZXIoaWQpO1xuICAgIH1cbiAgfSxcbiAgcmVhZHk6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICB0aGlzLiRvbigndHJlZW5vZGV0b29nbGVkJyxmdW5jdGlvbihub2RlKXtcbiAgICAgIHNlbGYucHJvamVjdC50b2dnbGVMYXllcihub2RlKTtcbiAgICB9KTtcblxuICAgIHRoaXMuJG9uKCd0cmVlbm9kZXN0b29nbGVkJyxmdW5jdGlvbihub2RlcyxwYXJlbnRDaGVja2VkKXtcbiAgICAgIHNlbGYucHJvamVjdC50b2dnbGVMYXllcnMobm9kZXMscGFyZW50Q2hlY2tlZCk7XG4gICAgfSk7XG4gIH1cbn1cblxuLy8gc2UgbG8gdm9nbGlvIGlzdGFuemlhcmUgbWFudWFsbWVudGVcbnZhciBJbnRlcm5hbENvbXBvbmVudCA9IFZ1ZS5leHRlbmQodnVlQ29tcG9uZW50T3B0aW9ucyk7XG5cbi8vIHNlIGxvIHZvZ2xpbyB1c2FyZSBjb21lIGNvbXBvbmVudGUgY29tZSBlbGVtZW50byBodG1sXG5WdWUuY29tcG9uZW50KCdnM3ctY2F0YWxvZycsIHZ1ZUNvbXBvbmVudE9wdGlvbnMpO1xuXG5cbi8qIENPTVBPTkVOVEkgRklHTEkgKi9cblxuLy8gdHJlZSBjb21wb25lbnRcblxuXG5WdWUuY29tcG9uZW50KCd0cmlzdGF0ZS10cmVlJywge1xuICB0ZW1wbGF0ZTogcmVxdWlyZSgnLi90cmlzdGF0ZS10cmVlLmh0bWwnKSxcbiAgcHJvcHM6IHtcbiAgICBsYXllcnN0cmVlOiBbXSxcbiAgICAvL2VyZWRpdG8gaWwgbnVtZXJvIGRpIGNoaWxkcyBkYWwgcGFyZW50XG4gICAgbl9wYXJlbnRDaGlsZHMgOiAwLFxuICAgIGNoZWNrZWQ6IGZhbHNlXG4gIH0sXG4gIGRhdGE6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4ge1xuICAgICAgZXhwYW5kZWQ6IHRoaXMubGF5ZXJzdHJlZS5leHBhbmRlZCxcbiAgICAgIHBhcmVudENoZWNrZWQ6IGZhbHNlLFxuICAgICAgLy9wcm9wcmlldGEgY2hlIHNlcnZlIHBlciBmYXJlIGNvbmZyb250byBwZXIgaWwgdHJpc3RhdGVcbiAgICAgIG5fY2hpbGRzOiB0aGlzLmxheWVyc3RyZWUubm9kZXMgPyB0aGlzLmxheWVyc3RyZWUubm9kZXMubGVuZ3RoIDogMFxuICAgIH1cbiAgfSxcbiAgd2F0Y2g6IHtcbiAgICAgICdjaGVja2VkJzogZnVuY3Rpb24gKHZhbCl7XG4gICAgICAgIHRoaXMubGF5ZXJzdHJlZS52aXNpYmxlID0gdmFsO1xuICAgICAgfVxuICB9LFxuICBjb21wdXRlZDoge1xuICAgIGlzRm9sZGVyOiBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgaXNGb2xkZXIgPSB0aGlzLm5fY2hpbGRzID8gdHJ1ZSA6IGZhbHNlO1xuICAgICAgaWYgKGlzRm9sZGVyKSB7XG4gICAgICAgIHZhciBfdmlzaWJsZUNoaWxkcyA9IDA7XG4gICAgICAgIF8uZm9yRWFjaCh0aGlzLmxheWVyc3RyZWUubm9kZXMsZnVuY3Rpb24obGF5ZXIpe1xuICAgICAgICAgIGlmIChsYXllci52aXNpYmxlKXtcbiAgICAgICAgICAgIF92aXNpYmxlQ2hpbGRzICs9IDE7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5uX3BhcmVudENoaWxkcyA9IHRoaXMubl9jaGlsZHMgLSBfdmlzaWJsZUNoaWxkcztcbiAgICAgIH1cbiAgICAgIHJldHVybiBpc0ZvbGRlclxuICAgIH0sXG4gICAgaXNIaWRkZW46IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIHRoaXMubGF5ZXJzdHJlZS5oaWRkZW4gJiYgKHRoaXMubGF5ZXJzdHJlZS5oaWRkZW4gPT09IHRydWUpO1xuICAgIH1cbiAgfSxcbiAgbWV0aG9kczoge1xuICAgIHRvZ2dsZTogZnVuY3Rpb24gKGNoZWNrQWxsTGF5ZXJzKSB7XG4gICAgICB2YXIgY2hlY2tBbGwgPSBjaGVja0FsbExheWVycyA9PSAndHJ1ZScgPyB0cnVlIDogZmFsc2U7XG4gICAgICBpZiAodGhpcy5pc0ZvbGRlciAmJiAhY2hlY2tBbGwpIHtcbiAgICAgICAgdGhpcy5sYXllcnN0cmVlLmV4cGFuZGVkID0gIXRoaXMubGF5ZXJzdHJlZS5leHBhbmRlZDtcbiAgICAgIH1cbiAgICAgIGVsc2UgaWYgKGNoZWNrQWxsKXtcbiAgICAgICAgaWYgKHRoaXMucGFyZW50Q2hlY2tlZCAmJiAhdGhpcy5uX3BhcmVudENoaWxkcyl7XG4gICAgICAgICAgdGhpcy5wYXJlbnRDaGVja2VkID0gZmFsc2U7XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5wYXJlbnRDaGVja2VkICYmIHRoaXMubl9wYXJlbnRDaGlsZHMpIHtcbiAgICAgICAgICB0aGlzLnBhcmVudENoZWNrZWQgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgIHRoaXMucGFyZW50Q2hlY2tlZCA9ICF0aGlzLnBhcmVudENoZWNrZWQ7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy4kZGlzcGF0Y2goJ3RyZWVub2Rlc3Rvb2dsZWQnLHRoaXMubGF5ZXJzdHJlZS5ub2Rlcyx0aGlzLnBhcmVudENoZWNrZWQpO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIHRoaXMuJGRpc3BhdGNoKCd0cmVlbm9kZXRvb2dsZWQnLHRoaXMubGF5ZXJzdHJlZSk7XG4gICAgICB9XG4gICAgfSxcbiAgICB0cmlDbGFzczogZnVuY3Rpb24gKCkge1xuICAgICAgaWYgKCF0aGlzLm5fcGFyZW50Q2hpbGRzKSB7XG4gICAgICAgIHJldHVybiAnZmEtY2hlY2stc3F1YXJlLW8nO1xuICAgICAgfSBlbHNlIGlmICgodGhpcy5uX3BhcmVudENoaWxkcyA+IDApICYmICh0aGlzLm5fcGFyZW50Q2hpbGRzIDwgdGhpcy5uX2NoaWxkcykpIHtcbiAgICAgICAgcmV0dXJuICdmYS1zcXVhcmUnO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuICdmYS1zcXVhcmUtbyc7XG4gICAgICB9XG4gICAgfVxuICB9XG59KVxuXG5WdWUuY29tcG9uZW50KCdsZWdlbmQnLHtcbiAgICB0ZW1wbGF0ZTogcmVxdWlyZSgnLi9sZWdlbmQuaHRtbCcpLFxuICAgIHByb3BzOiBbJ2xheWVyc3RyZWUnXSxcbiAgICBkYXRhOiBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIC8vZGF0YSBxdWlcbiAgICAgIH1cbiAgICB9LFxuICAgIGNvbXB1dGVkOiB7XG4gICAgICB2aXNpYmxlbGF5ZXJzOiBmdW5jdGlvbigpe1xuICAgICAgICB2YXIgX3Zpc2libGVsYXllcnMgPSBbXTtcbiAgICAgICAgdmFyIGxheWVyc3RyZWUgPSB0aGlzLmxheWVyc3RyZWU7XG4gICAgICAgIGZ1bmN0aW9uIHRyYXZlcnNlKG9iail7XG4gICAgICAgIF8uZm9ySW4ob2JqLCBmdW5jdGlvbiAobGF5ZXIsIGtleSkge1xuICAgICAgICAgICAgICAvL3ZlcmlmaWNhIGNoZSBpbCB2YWxvcmUgZGVsbCdpZCBub24gc2lhIG51bGxvXG4gICAgICAgICAgICAgIGlmICghXy5pc05pbChsYXllci5pZCkgJiYgbGF5ZXIudmlzaWJsZSkge1xuICAgICAgICAgICAgICAgICAgX3Zpc2libGVsYXllcnMucHVzaChsYXllcik7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgaWYgKCFfLmlzTmlsKGxheWVyLm5vZGVzKSkge1xuICAgICAgICAgICAgICAgICAgdHJhdmVyc2UobGF5ZXIubm9kZXMpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgdHJhdmVyc2UobGF5ZXJzdHJlZSk7XG4gICAgICAgIHJldHVybiBfdmlzaWJsZWxheWVycztcbiAgICAgIH1cbiAgICB9LFxuICAgIHdhdGNoOiB7XG4gICAgICAnbGF5ZXJzdHJlZSc6IHtcbiAgICAgICAgaGFuZGxlcjogZnVuY3Rpb24odmFsLCBvbGQpe1xuICAgICAgICAgIC8vY29kaWNlIHF1aVxuICAgICAgICB9LFxuICAgICAgICBkZWVwOiB0cnVlXG4gICAgICB9XG4gICAgfSxcbiAgICByZWFkeTogZnVuY3Rpb24oKSB7XG4gICAgICAvL2NvZGljZSBxdWlcbiAgICB9XG59KTtcblxuVnVlLmNvbXBvbmVudCgnbGVnZW5kLWl0ZW0nLHtcbiAgdGVtcGxhdGU6IHJlcXVpcmUoJy4vbGVnZW5kX2l0ZW0uaHRtbCcpLFxuICBwcm9wczogWydsYXllciddLFxuICBjb21wdXRlZDoge1xuICAgIGxlZ2VuZHVybDogZnVuY3Rpb24oKXtcbiAgICAgIC8vIGluIGF0dGVzYSBkaSByaXNvbHZlcmUgbG8gc2NoaWFudG8gZGkgUUdTSSBTZXJ2ZXIuLi5cbiAgICAgIC8vcmV0dXJuIFwiaHR0cDovL2xvY2FsaG9zdC9jZ2ktYmluL3FnaXNfbWFwc2Vydi5mY2dpP21hcD0vaG9tZS9naW9oYXBweS9TY3JpdmFuaWEvRGV2L0czVy9nM3ctY2xpZW50L3Rlc3QvcHJvZ2V0dG8vdGVzdC5xZ3MmU0VSVklDRT1XTVMmVkVSU0lPTj0xLjMuMCZSRVFVRVNUPUdldExlZ2VuZEdyYXBoaWMmRk9STUFUPWltYWdlL3BuZyZMQVlFUlRJVExFPUZhbHNlJklURU1GT05UU0laRT0xMCZMQVlFUj1cIit0aGlzLmxheWVyLm5hbWU7XG4gICAgICByZXR1cm4gUHJvamVjdHNSZWdpc3RyeS5nZXRDdXJyZW50UHJvamVjdCgpLmdldExlZ2VuZFVybCh0aGlzLmxheWVyKTtcbiAgICB9XG4gIH0sXG4gIG1ldGhvZHM6IHtcbiAgICAvLyBlc2VtcGlvIHV0aWxpenpvIGRlbCBzZXJ2aXppbyBHVUlcbiAgICBvcGVuZm9ybTogZnVuY3Rpb24oKXtcbiAgICAgIC8vR1VJLm5vdGlmeS5zdWNjZXNzKFwiQXBybyB1biBmb3JtXCIpO1xuICAgICAgLy9HVUkuc2hvd0Zvcm0oKTtcbiAgICB9XG4gIH1cbn0pO1xuXG4vKiBGSU5FIENPTVBPTkVOVEkgRklHTEkgKi9cblxuLyogSU5URVJGQUNDSUEgUFVCQkxJQ0EgKi9cbmZ1bmN0aW9uIENhdGFsb2dDb21wb25lbnQob3B0aW9ucyl7XG4gIHRoaXMuaWQgPSBcImNhdGFsb2ctY29tcG9uZW50XCI7XG4gIHRoaXMudGl0bGUgPSBcImNhdGFsb2dcIjtcbiAgdGhpcy5pbnRlcm5hbENvbXBvbmVudCA9IG5ldyBJbnRlcm5hbENvbXBvbmVudDtcbiAgLy9tZXJnaW8gb3B6aW9uaSBjb24gcHJvcHJpdMOgIGRpIGRlZmF1bHQgZGVsIGNvbXBvbmVudGVcbiAgbWVyZ2UodGhpcywgb3B0aW9ucyk7XG59XG5cbmluaGVyaXQoQ2F0YWxvZ0NvbXBvbmVudCwgQ29tcG9uZW50KTtcblxubW9kdWxlLmV4cG9ydHMgPSBDYXRhbG9nQ29tcG9uZW50O1xuIiwibW9kdWxlLmV4cG9ydHMgPSBcIjxkaXYgcm9sZT1cXFwidGFicGFuZWxcXFwiIGNsYXNzPVxcXCJ0YWItcGFuZVxcXCIgaWQ9XFxcImxlZ2VuZFxcXCI+XFxuICA8bGVnZW5kLWl0ZW0gOmxheWVyPVxcXCJsYXllclxcXCIgdi1mb3I9XFxcImxheWVyIGluIHZpc2libGVsYXllcnNcXFwiPjwvbGVnZW5kLWl0ZW0+XFxuPC9kaXY+XFxuXCI7XG4iLCJtb2R1bGUuZXhwb3J0cyA9IFwiPGRpdiBAY2xpY2s9XFxcIm9wZW5mb3JtKClcXFwiPnt7IGxheWVyLnRpdGxlIH19PC9kaXY+XFxuPGRpdj48aW1nIDpzcmM9XFxcImxlZ2VuZHVybFxcXCI+PC9kaXY+XFxuXCI7XG4iLCJtb2R1bGUuZXhwb3J0cyA9IFwiPGxpIGNsYXNzPVxcXCJ0cmVlLWl0ZW1cXFwiPlxcbiAgPHNwYW4gOmNsYXNzPVxcXCJ7Ym9sZDogaXNGb2xkZXIsICdmYS1jaGV2cm9uLWRvd24nOiBsYXllcnN0cmVlLmV4cGFuZGVkLCAnZmEtY2hldnJvbi1yaWdodCc6ICFsYXllcnN0cmVlLmV4cGFuZGVkfVxcXCIgQGNsaWNrPVxcXCJ0b2dnbGVcXFwiIHYtaWY9XFxcImlzRm9sZGVyXFxcIiBjbGFzcz1cXFwiZmFcXFwiPjwvc3Bhbj5cXG4gIDxzcGFuIHYtaWY9XFxcImlzRm9sZGVyXFxcIiBAY2xpY2s9XFxcInRvZ2dsZSgndHJ1ZScpXFxcIiA6Y2xhc3M9XFxcIlt0cmlDbGFzcygpXVxcXCIgY2xhc3M9XFxcImZhXFxcIj48L3NwYW4+XFxuICA8c3BhbiB2LWVsc2UgQGNsaWNrPVxcXCJ0b2dnbGVcXFwiIDpjbGFzcz1cXFwiW2xheWVyc3RyZWUudmlzaWJsZSAgPyAnZmEtY2hlY2stc3F1YXJlLW8nOiAnZmEtc3F1YXJlLW8nLGxheWVyc3RyZWUuZGlzYWJsZWQgID8gJ2Rpc2FibGVkJzogJyddXFxcIiBjbGFzcz1cXFwiZmFcXFwiIHN0eWxlPVxcXCJjdXJzb3I6ZGVmYXVsdFxcXCI+PC9zcGFuPlxcbiAgPHNwYW4gOmNsYXNzPVxcXCJ7Ym9sZDogaXNGb2xkZXIsIGRpc2FibGVkOiBsYXllcnN0cmVlLmRpc2FibGVkfVxcXCIgQGNsaWNrPVxcXCJ0b2dnbGVcXFwiPnt7bGF5ZXJzdHJlZS50aXRsZX19PC9zcGFuPlxcbiAgPHVsIHYtc2hvdz1cXFwibGF5ZXJzdHJlZS5leHBhbmRlZFxcXCIgdi1pZj1cXFwiaXNGb2xkZXJcXFwiPlxcbiAgICA8dHJpc3RhdGUtdHJlZSA6bl9wYXJlbnQtY2hpbGRzLnN5bmM9XFxcIm5fcGFyZW50Q2hpbGRzXFxcIiA6bGF5ZXJzdHJlZT1cXFwibGF5ZXJzdHJlZVxcXCIgOmNoZWNrZWQ9XFxcInBhcmVudENoZWNrZWRcXFwiIHYtZm9yPVxcXCJsYXllcnN0cmVlIGluIGxheWVyc3RyZWUubm9kZXNcXFwiPlxcbiAgICA8L3RyaXN0YXRlLXRyZWU+XFxuICA8L3VsPlxcbjwvbGk+XFxuXFxuXFxuXFxuXFxuXCI7XG4iLCJ2YXIgaW5oZXJpdCA9IHJlcXVpcmUoJ2NvcmUvdXRpbHMvdXRpbHMnKS5pbmhlcml0O1xudmFyIGJhc2UgPSByZXF1aXJlKCdjb3JlL3V0aWxzL3V0aWxzJykuYmFzZTtcbnZhciByZXNvbHZlID0gcmVxdWlyZSgnY29yZS91dGlscy91dGlscycpLnJlc29sdmU7XG52YXIgcmVqZWN0ID0gcmVxdWlyZSgnY29yZS91dGlscy91dGlscycpLnJlamVjdDtcbnZhciBCYXNlQ29tcG9uZW50ID0gcmVxdWlyZSgnZ3VpL2NvbXBvbmVudCcpO1xuXG52YXIgQ29tcG9uZW50ID0gZnVuY3Rpb24ob3B0aW9ucykge1xuICBiYXNlKHRoaXMsb3B0aW9ucyk7XG59O1xuXG5pbmhlcml0KENvbXBvbmVudCwgQmFzZUNvbXBvbmVudCk7XG5cbnZhciBwcm90byA9IENvbXBvbmVudC5wcm90b3R5cGU7XG5cbi8vIHZpZW5lIHJpY2hpYW1hdG8gZGFsbGEgdG9vbGJhciBxdWFuZG8gaWwgcGx1Z2luIGNoaWVkZSBkaSBtb3N0cmFyZSB1biBwcm9wcmlvIHBhbm5lbGxvIG5lbGxhIEdVSSAoR1VJLnNob3dQYW5lbClcbnByb3RvLm1vdW50ID0gZnVuY3Rpb24ocGFyZW50KXtcbiAgdGhpcy5pbnRlcm5hbENvbXBvbmVudC4kbW91bnQocGFyZW50KTtcbiAgcmV0dXJuIHJlc29sdmUodHJ1ZSk7XG59O1xuXG4vLyByaWNoaWFtYXRvIHF1YW5kbyBsYSBHVUkgY2hpZWRlIGRpIGNoaXVkZXJlIGlsIHBhbm5lbGxvLiBTZSByaXRvcm5hIGZhbHNlIGlsIHBhbm5lbGxvIG5vbiB2aWVuZSBjaGl1c29cbnByb3RvLnVubW91bnQgPSBmdW5jdGlvbigpe1xuICB0aGlzLmludGVybmFsQ29tcG9uZW50LiRkZXN0cm95KHRydWUpO1xuICB0aGlzLmludGVybmFsQ29tcG9uZW50ID0gbnVsbDtcbiAgcmV0dXJuIHJlc29sdmUoKTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gQ29tcG9uZW50O1xuIiwiVnVlLmRpcmVjdGl2ZShcImRpc2FibGVkXCIsZnVuY3Rpb24odmFsdWUpe1xuICAgIGlmICh2YWx1ZSl7XG4gICAgICB0aGlzLmVsLnNldEF0dHJpYnV0ZSgnZGlzYWJsZWQnLCdkaXNhYmxlZCcpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIHRoaXMuZWwucmVtb3ZlQXR0cmlidXRlKCdkaXNhYmxlZCcpO1xuICAgIH1cbiAgfVxuKTtcblxuVnVlLmRpcmVjdGl2ZShcImNoZWNrZWRcIixmdW5jdGlvbih2YWx1ZSl7XG4gICAgaWYgKHZhbHVlKXtcbiAgICAgIHRoaXMuZWwuc2V0QXR0cmlidXRlKCdjaGVja2VkJywnY2hlY2tlZCcpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIHRoaXMuZWwucmVtb3ZlQXR0cmlidXRlKCdjaGVja2VkJyk7XG4gICAgfVxuICB9XG4pO1xuXG5WdWUuZGlyZWN0aXZlKFwic2VsZWN0ZWQtZmlyc3RcIixmdW5jdGlvbih2YWx1ZSl7XG4gICAgaWYgKHZhbHVlPT0wKXtcbiAgICAgIHRoaXMuZWwuc2V0QXR0cmlidXRlKCdzZWxlY3RlZCcsJycpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIHRoaXMuZWwucmVtb3ZlQXR0cmlidXRlKCdzZWxlY3RlZCcpO1xuICAgIH1cbiAgfVxuKTtcbiIsInZhciBnM3cgPSBnM3cgfHwge307XG5cbmczdy5jb3JlID0ge1xuICAgRzNXT2JqZWN0OiByZXF1aXJlKCdjb3JlL2czd29iamVjdCcpLFxuICAgdXRpbHM6IHJlcXVpcmUoJ2NvcmUvdXRpbHMvdXRpbHMnKSxcbiAgIEFwcGxpY2F0aW9uU2VydmljZTogcmVxdWlyZSgnY29yZS9hcHBsaWNhdGlvbnNlcnZpY2UnKSxcbiAgIEFwaVNlcnZpY2U6IHJlcXVpcmUoJ2NvcmUvYXBpc2VydmljZScpLFxuICAgUm91dGVyOiByZXF1aXJlKCdjb3JlL3JvdXRlcicpLFxuICAgUHJvamVjdHNSZWdpc3RyeTogcmVxdWlyZSgnY29yZS9wcm9qZWN0L3Byb2plY3RzcmVnaXN0cnknKSxcbiAgIFByb2plY3Q6IHJlcXVpcmUoJ2NvcmUvcHJvamVjdC9wcm9qZWN0JyksXG4gICBNYXBRdWVyeVNlcnZpY2U6IHJlcXVpcmUoJ2NvcmUvbWFwL21hcHF1ZXJ5c2VydmljZScpLFxuICAgTWFwTGF5ZXI6IHJlcXVpcmUoJ2NvcmUvbWFwL21hcGxheWVyJyksXG4gICBMYXllclN0YXRlOiByZXF1aXJlKCdjb3JlL2xheWVyL2xheWVyc3RhdGUnKSxcbiAgIFZlY3RvckxheWVyOiByZXF1aXJlKCdjb3JlL2xheWVyL3ZlY3RvcmxheWVyJyksXG4gICBXbXNMYXllcjogcmVxdWlyZSgnY29yZS9sYXllci93bXNsYXllcicpLFxuICAgR2VvbWV0cnk6IHJlcXVpcmUoJ2NvcmUvZ2VvbWV0cnkvZ2VvbWV0cnknKSxcbiAgIGdlb206IHJlcXVpcmUoJ2NvcmUvZ2VvbWV0cnkvZ2VvbScpLFxuICAgUGlja0Nvb3JkaW5hdGVzSW50ZXJhY3Rpb246IHJlcXVpcmUoJ2NvcmUvaW50ZXJhY3Rpb25zL3BpY2tjb29yZGluYXRlc2ludGVyYWN0aW9uJyksXG4gICBQaWNrRmVhdHVyZUludGVyYWN0aW9uOiByZXF1aXJlKCdjb3JlL2ludGVyYWN0aW9ucy9waWNrZmVhdHVyZWludGVyYWN0aW9uJyksXG4gICBpMThuOiByZXF1aXJlKCdjb3JlL2kxOG4vaTE4bi5zZXJ2aWNlJyksXG4gICBQbHVnaW46IHJlcXVpcmUoJ2NvcmUvcGx1Z2luL3BsdWdpbicpLFxuICAgUGx1Z2luc1JlZ2lzdHJ5OiByZXF1aXJlKCdjb3JlL3BsdWdpbi9wbHVnaW5zcmVnaXN0cnknKVxufTtcblxuZzN3Lmd1aSA9IHtcbiAgZ3VpOiByZXF1aXJlKCdndWkvZ3VpJyksXG4gIHZ1ZToge1xuICAgIC8vR2VvY29kaW5nQ29tcG9uZW50OiByZXF1aXJlKCdndWkvdnVlL2dlb2NvZGluZy9nZW9jb2RpbmcnKSxcbiAgICBTZWFyY2hDb21wb25lbnQ6IHJlcXVpcmUoJ2d1aS9zZWFyY2gvdnVlL3NlYXJjaCcpLFxuICAgIENhdGFsb2dDb21wb25lbnQ6IHJlcXVpcmUoJ2d1aS92dWUvY2F0YWxvZy9jYXRhbG9nJyksXG4gICAgTWFwQ29tcG9uZW50OiByZXF1aXJlKCdndWkvbWFwL3Z1ZS9tYXAnKSxcbiAgICBUb29sc0NvbXBvbmVudDogcmVxdWlyZSgnZ3VpL3Rvb2xzL3Z1ZS90b29scycpXG4gIH1cbn07XG5cbm1vZHVsZS5leHBvcnRzID0ge1xuICBjb3JlOiBnM3cuY29yZSxcbiAgZ3VpOiBnM3cuZ3VpXG59O1xuIl19
