(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
var apptitle = "G3W Client";

var plugins = {
};

var tools = {
  tools:  []
};

var mapcontrols = ['zoom','zoombox','query','scaleline'];
//var mapcontrols = ['zoom','zoombox','zoomtoextent','query'];

var i18n = {
  resources: require('./locales/app.js')
};

var client =  {
  debug:  true,
  local:  false
};

var server =  {
  urls:  {
    ows:  '/ows',
    api:  '/api',
    config:  '/api/config',
    staticurl:  '',
  }
};

/*var templates =  {
  app:  require('../templates/app.html'),
  sidebar:  require('../templates/sidebar.html'),
  floatbar:  require('../templates/floatbar.html'),
};*/

module.exports = {
  apptitle: apptitle,
  client: client,
  server: server,
  plugins:  plugins,
  tools:  tools,
  map: {
    controls: mapcontrols
  },
  i18n: i18n
};

},{"./locales/app.js":2}],2:[function(require,module,exports){
var translations = {
    "it": {
        "translation": {
            "component": "Componente Generico",
            "search": "Ricerca",
            "dosearch": "Cerca",
            "catalog": "Mappa",
            "baselayers": "Basi",
            "tools": "Strumenti",
            "tree": "Strati",
            "legend": "Legenda",
            "street_search": "Cerca indirizzo"
        }
    }
};

module.exports = translations;

},{}],3:[function(require,module,exports){
var i18ninit = require('sdk').core.i18n.init;
var ApplicationService = require('sdk/sdk').core.ApplicationService;
var ApplicationTemplate = require('./template/js/template');

// SETTO LA VARIABILE GLOBALE g3wsdk, COME SE AVESSI USATO sdk.js
window.g3wsdk = require('sdk');

var config = require('./config/config.js');

function createApplicationConfig() {  
  return {
    apptitle: config.apptitle || '',
    logo_img: config.group.header_logo_img,
    logo_link: config.group.header_logo_link,
    terms_of_use_text: config.group.header_terms_of_use_text,
    terms_of_use_link: config.group.terms_of_use_link,
    debug: config.client.debug || false,
    group: config.group,
    urls: config.server.urls,
    mediaurl: config.server.urls.mediaurl,
    resourcesurl: config.server.urls.staticurl,
    projects: config.group.projects,
    initproject: config.group.initproject,
    baselayers: config.group.baselayers,
    crs: config.group.crs,
    proj4: config.group.proj4,
    minscale: config.group.minscale,
    maxscale: config.group.maxscale,
    // richiesto da ProjectService
    getWmsUrl: function(project){
      return config.server.urls.ows+'/'+config.group.id+'/'+project.type+'/'+project.id;
    },
    // richiesto da ProjectsRegistry
    getProjectConfigUrl: function(project){
      return config.server.urls.config+'/'+config.group.id+'/'+project.type+'/'+project.id;
    },
    plugins: config.group.plugins,
    tools: config.tools,
    views: config.views || {},
    map: config.map
  };
};

// questa è la configurazione base del template che conterrà tutti gli
// elementi previsti dal template. Nella definizione sono tutti oggetti vuoti
// Sarà l'applicazione a scegliere di riempire gli elementi
function createTemplateConfig(){
  var CatalogComponent = require('sdk').gui.vue.CatalogComponent;
  var SearchComponent = require('sdk').gui.vue.SearchComponent;
  var ToolsComponent = require('sdk').gui.vue.ToolsComponent;
  var MapComponent = require('sdk').gui.vue.MapComponent;
  //al momento si utilizza quesllo quenerico ma si potrebbe costruire un componente
  //ad hoc per i risultati
  var QueryResultsComponent = require('sdk').gui.vue.QueryResultsComponent;
  
  return {
    title: config.apptitle,
    placeholders: {
      navbar: {
        components: []
      },
      sidebar: {
        components: [
          new SearchComponent({
            id: 'search',
            open: false,
            icon: "fa fa-search"
          }),
          new CatalogComponent({
            id: 'catalog',
            open: true,
            icon: "fa fa-database"
          }),
          new ToolsComponent({
            id: 'tools',
            open: false,
            icon: "fa fa-gear"
          })
        ]
      },
      viewport: { // placeholder del contenuto (view content) inizialmente Vista Secondaria (nascosta)
        components: [
          new MapComponent({
            id: 'map'
          })
        ]
      }, 
      floatbar:{
        components: []
      }
    },
    othercomponents: [
      new QueryResultsComponent({
          id: 'queryresults'
      })
    ]
  };
}

function obtainInitConfig(){
  var d = $.Deferred();
  if (window.initConfig) {
    return d.resolve(window.initConfig);
  }
  // altrimenti devo aspettare che local.initconfig.js abbia caricato l'initconfig
  else{
    $(document).on('initconfigReady',function(e,initconfig){
      return d.resolve(initconfig);
    })
  }
  return d.promise();
}

ApplicationService.on('ready',function(){
  //istanzio l'appication template passando la configurazione del template e l'applicationService che fornisce API del progetto
  var templateConfig = createTemplateConfig();
  //istanzio l'application Template
  applicationTemplate = new ApplicationTemplate(templateConfig, this);
  //inizializzo e faccio partire con ilmetodo init
  applicationTemplate.init();
});

bootstrap = function(){
  i18ninit(config.i18n);
  obtainInitConfig()
  .then(function(initConfig){
    config.server.urls.staticurl = initConfig.staticurl;
    config.server.urls.mediaurl = initConfig.mediaurl;
    config.group = initConfig.group;
    
    var applicationConfig = createApplicationConfig();
    ApplicationService.init(applicationConfig);
  })
}();



},{"./config/config.js":1,"./template/js/template":14,"sdk":91,"sdk/sdk":91}],4:[function(require,module,exports){
module.exports = "<div class=\"wrapper\">\n  <header class=\"main-header\">\n    <!-- Logo -->\n    <!-- Header Navbar: style can be found in header.less -->\n    <nav class=\"navbar navbar-static-top\" role=\"navigation\">\n      <!-- Toggle button on navbar only for mobile -->\n      <a v-if=\"isMobile()\" href=\"#\" class=\"sidebar-toggle\" data-toggle=\"offcanvas\" role=\"button\">\n        <span class=\"sr-only\">Expand</span>\n      </a>\n      <div class=\"logo-wrapper\">\n        <a v-if=\"logo_url\" :href=\"logo_link\" :target=\"logo_link_target\" class=\"\"><img :src=\"logo_url\" style=\"height:40px\"></a>\n        <span class=\"\">{{project_title}}</span>\n      </div>\n    </nav>\n  </header>\n  <!-- Left side column. contains the logo and sidebar -->\n  <sidebar></sidebar>\n  <!-- Content Wrapper. Contains page content -->\n  <div class=\"content-wrapper\" style=\"background-color:white\">\n    <viewport></viewport>\n  </div>\n  <!-- /.content-wrapper -->\n  <!-- Control Sidebar -->\n  <floatbar></floatbar>\n  <!-- /.control-sidebar -->\n  <!-- Add the sidebar's background. This div must be placed\n       immediately after the control sidebar -->\n  <div class=\"control-sidebar-bg\"></div>\n</div>\n";

},{}],5:[function(require,module,exports){
module.exports = "<aside class=\"control-sidebar control-sidebar-light\" >\n  <a v-show=\"panelsinstack\" href=\"#\" class=\"floatbar-aside-toggle\" data-toggle=\"control-sidebar\" role=\"button\">\n    <span class=\"sr-only\">Expand</span>\n  </a>\n  <div id=\"floatbar-spinner\" style=\"position:absolute\"></div>\n  <div v-show=\"panelsinstack\" class=\"g3w-sidebarpanel\">\n    <div class=\"row\">\n      <div class=\"col-xs-12 col-sm-12 col-md-12\">\n        <button class=\"glyphicon glyphicon-remove pull-right close-panel-button\" @click=\"closePanel\"></button>\n      </div>\n    </div>\n    <div>\n      <h4 class=\"g3w-floatbarpanel-name\">{{ panelname }}</h2>\n    </div>\n    <div id=\"g3w-floatbarpanel-placeholder\" class=\"g3w-floatbarpanel-placeholder\"></div>\n  </div>\n</aside>\n";

},{}],6:[function(require,module,exports){
module.exports = "<li v-show=\"state.visible\" class=\"treeview\" :class=\"{'active': open}\">\n  <a href=\"#\">\n    <i :class=\"icon\"></i>\n    <span class=\"treeview-label\">{{title | t}}</span>\n    <i v-if=\"(dataType === 'inline')\" class=\"fa fa-angle-left pull-right\"></i>\n  </a>\n  <ul v-if=\"(dataType === 'inline')\" class=\"treeview-menu\">\n    <div id=\"g3w-sidebarcomponent-placeholder\"></div>\n  </ul>\n</li>\n";

},{}],7:[function(require,module,exports){
module.exports = "<aside class=\"main-sidebar\">\n  <!-- sidebar: style can be found in sidebar.less -->\n  <!-- Sidebar toggle button-->\n  <!-- Toggle button on the left side of main sidebar only if not mobile -->\n  <a v-if=\"!isMobile()\" href=\"#\" class=\"sidebar-aside-toggle\" data-toggle=\"offcanvas\" role=\"button\">\n    <span class=\"sr-only\">Expand</span>\n  </a>\n\t<section class=\"sidebar\">\n    <div v-show=\"panelsinstack\" class=\"g3w-sidebarpanel\">\n      <div style=\"overflow: hidden;line-height: 14px;margin-top: 4px; font-size:1.5em\">\n          <button class=\"glyphicon glyphicon-remove pull-right close-panel-button\" @click=\"closePanel\"></button>\n      </div>\n      <div id=\"g3w-sidebarpanel-placeholder\" class=\"g3w-sidebarpanel-placeholder\"></div>\n    </div>\n\t  <ul id=\"g3w-sidebarcomponents\" v-show=\"showmainpanel\" class=\"sidebar-menu\"></ul>\n\t</section>\n\t<!-- /.sidebar -->\n</aside>\n";

},{}],8:[function(require,module,exports){
module.exports = "<div>\n  <div id=\"g3w-view-one\" class=\"g3w-view one\" :style=\"{width:state.viewSizes.one.width+'px',height:state.viewSizes.one.height+'px'}\"></div>\n  <div v-show=\"state.secondaryVisible\" id=\"g3w-view-two\" class=\"g3w-view two\" :style=\"{width:state.viewSizes.two.width+'px',height:state.viewSizes.two.height+'px'}\">\n    <div>TEST CONTENUTO X</div>\n  </div>\n</div>\n";

},{}],9:[function(require,module,exports){
var ApplicationService = require('core/applicationservice');
var ProjectsRegistry = require('core/project/projectsregistry');
var layout = require('./layout');
var AppUI = Vue.extend({
  template: require('../html/app.html'),
  ready: function(){
    /* start to render LayoutManager layout */
    layout.loading(false);
    layout.setup();
    //Fix the problem with right sidebar and layout boxed
    layout.pushMenu.expandOnHover();
    layout.controlSidebar._fix($(".control-sidebar-bg"));
    layout.controlSidebar._fix($(".control-sidebar"));
    var controlsidebarEl = layout.options.controlSidebarOptions.selector;
    function setFloatBarMaxHeight(){
      $(controlsidebarEl).css('max-height',$(window).innerHeight());
      $('.g3w-sidebarpanel').css('height',$(window).height() - $(".main-header").height());
    }
    setFloatBarMaxHeight();
    function setModalHeight(){
      $('#g3w-modal-overlay').css('height',$(window).height());
    }
    $(window).resize(function() {
      setFloatBarMaxHeight();
      setModalHeight();
    });
   },
   computed: {
    logo_url: function() {
      var config = ApplicationService.getConfig();
      var logo_url;
      if (config.logo_img && config.logo_img!='') {
        logo_url = config.mediaurl+config.logo_img;
      }
      return logo_url;
    },
    logo_link: function() {
      var logo_link = this.getLogoLink();
      return logo_link ? logo_link : "#";
    },
    logo_link_target: function() {
      var logo_link = this.getLogoLink();
      return logo_link ? "_blank" : "";
    },
    project_title: function() {
      var currentProject = ProjectsRegistry.getCurrentProject();
      return currentProject.state.name;
    }
   },
   methods: {
      closePanel: function(){
        sidebarService.closePanel();
      },
      isMobile: function(){return isMobile.any},
      getLogoLink: function() {
        var logo_link = null;
        if (ApplicationService.getConfig().logo_link) {
          logo_link = ApplicationService.getConfig().logo_link;
        }
        return logo_link;
      }
    },
});

module.exports = AppUI;

},{"../html/app.html":4,"./layout":12,"core/applicationservice":17,"core/project/projectsregistry":42}],10:[function(require,module,exports){
var inherit = require('sdk/core/utils/utils').inherit;
var G3WObject = require('sdk/core/g3wobject');

function BarStack(){
  this.state = {
    panels: []
  }
  /*this.state = {
    panels: []
  };*/
}

inherit(BarStack,G3WObject);

var proto = BarStack.prototype;

proto.push = function(panel, parent, append){
  var self = this;
  var append = append || false;
  var idxToRemove = null;
  var id = panel.getId();
  _.forEach(this.state.panels, function(_panel,idx) {
    if (_panel.getId() == id) {
      idxToRemove = idx;
    };
  });
  if (!_.isNull(idxToRemove)) {
    var _panel = self.state.panels[idxToRemove];
    _panel.unmount()
    .then(function() {
      self.state.panels.splice(idxToRemove,1);
    });
  }
  panel.mount(parent, append)
  .then(function(){
    self.state.panels.push(panel);
  });
};

proto.pop = function(){
  // qui potremo chiedere al pannello se può essere chiuso...
  var self = this;
  var panel = this.state.panels.slice(-1)[0];
  panel.unmount()
  .then(function(){
    //self.state.panels.pop();
    self.state.panels.pop();
  });
};

proto.getLength = function() {
  return this.state.panels.length;
};

module.exports = BarStack;

},{"sdk/core/g3wobject":28,"sdk/core/utils/utils":49}],11:[function(require,module,exports){
var t = require('sdk/core/i18n/i18n.service').t;
var Stack = require('./barstack.js');
var GUI = require('sdk/gui/gui');

function FloatbarService(){
  this.stack = new Stack();
  this.init = function(layout){
    this.layout = layout;
    this.closable = true;
    this.sidebarEl = $(this.layout.options.controlSidebarOptions.selector);
    this._zindex = this.sidebarEl.css("z-index");
    this._modalOverlay = null;
    this._modal = false;
    this._isopen = false;
  };

  this.isOpen = function() {
    return this._isopen;
  };

  this.open = function() {
    this.layout.floatBar.open(this.sidebarEl,true);
    this._isopen = true;
  };

  this.close = function() {
    this.layout.floatBar.close(this.sidebarEl,true);
    this._isopen = false;
  };

  this.showPanel = function(panel,options){
    var options = options || {};
    var append = options.append || false;
    var modal = options.modal || false;
    this.closable = options.closable || true;
    this.stack.push(panel,"#g3w-floatbarpanel-placeholder", append);
    if (!this._isopen) {
      this.open();
    };
    if (modal){
      this._modal = true;
      GUI.setModal();
      this.sidebarEl.css("z-index",5000);
      this.sidebarEl.css("padding-top","0px");
      $('.control-sidebar-bg').css("z-index",4999);
      $('.control-sidebar-bg').toggleClass('control-sidebar-bg-shadow');
    }
  };
  
  this.closePanel = function(){
    this.stack.pop();
    if (!this.stack.getLength()) {
      if (this._modal){
        GUI.setModal(false);
        this.close();
        $('.control-sidebar-bg').toggleClass('control-sidebar-bg-shadow');
        this.sidebarEl.css("z-index","");
        this.sidebarEl.css("padding-top","50px");
        $('.control-sidebar-bg').css("z-index","");
        this._modal = false;
      }
      else {
        this.close();
      }
    }
  };
  
  this.hidePanel = function(){
    this.close();
  };
}

var floatbarService = new FloatbarService();

var FloatbarComponent = Vue.extend({
    template: require('../html/floatbar.html'),
    data: function() {
    	return {
        stack: floatbarService.stack.state,
      };
    },
    computed: {
      // quanti pannelli sono attivi nello stack
      panelsinstack: function(){
        return this.stack.panels.length>0;
      },
      panelname: function(){
        var name = "";
        if (this.stack.panels.length){
          name = this.stack.panels.slice(-1)[0].getTitle();
        }
        return name;
      },
      closable: function() {
        return floatbarService.closable;
      }
    },
    watch: {
      // TODO: Brutto, ma è l'unico (per ora) modo flessibile che ho trovato per implementare il concetto di stack... 
      "stack.panels": function(){
        var children = $("#g3w-floatbarpanel-placeholder").children();
        _.forEach(children,function(child,index){
          if (index == children.length-1){
            $(child).show();
          }
          else {
            $(child).hide();
          }
        })
      }
    },
    methods: {
      closePanel: function(){
        floatbarService.closePanel();
      }
    }
});

module.exports = {
  FloatbarService: floatbarService,
  FloatbarComponent: FloatbarComponent
}

},{"../html/floatbar.html":5,"./barstack.js":10,"sdk/core/i18n/i18n.service":31,"sdk/gui/gui":71}],12:[function(require,module,exports){
//Make sure jQuery has been loaded before app.js
if (typeof jQuery === "undefined") {
  throw new Error("LayoutManager requires jQuery");
}

$.LayoutManager = {};

/* --------------------
 * - LayoutManager Options -
 * --------------------
 * Modify these options to suit your implementation
 */
$.LayoutManager.options = {
  //Add slimscroll to navbar menus
  //This requires you to load the slimscroll plugin
  //in every page before app.js
  navbarMenuSlimscroll: true,
  navbarMenuSlimscrollWidth: "0px", //The width of the scroll bar
  navbarMenuHeight: "200px", //The height of the inner menu
  //General animation speed for JS animated elements such as box collapse/expand and
  //sidebar treeview slide up/down. This options accepts an integer as milliseconds,
  //'fast', 'normal', or 'slow'
  animationSpeed:'fast',
  //Sidebar push menu toggle button selector
  sidebarToggleSelector: "[data-toggle='offcanvas']",
  //Activate sidebar push menu
  sidebarPushMenu: true,
  //Activate sidebar slimscroll if the fixed layout is set (requires SlimScroll Plugin)
  sidebarSlimScroll: true,
  //Enable sidebar expand on hover effect for sidebar mini
  //This option is forced to true if both the fixed layout and sidebar mini
  //are used together
  sidebarExpandOnHover: false,
  //BoxRefresh Plugin
  enableBoxRefresh: true,
  //Bootstrap.js tooltip
  enableBSToppltip: true,
  BSTooltipSelector: "[data-toggle='tooltip']",
  //Enable Fast Click. Fastclick.js creates a more
  //native touch experience with touch devices. If you
  //choose to enable the plugin, make sure you load the script
  //before LayoutManager's app.js
  enableFastclick: true,
  //Control Sidebar Options
  enableControlSidebar: true,
  controlSidebarOptions: {
    //Which button should trigger the open/close event
    toggleBtnSelector: "[data-toggle='control-sidebar']",
    //The sidebar selector
    selector: ".control-sidebar",
    //Enable slide over content
    slide: true
  },
  //Box Widget Plugin. Enable this plugin
  //to allow boxes to be collapsed and/or removed
  enableBoxWidget: true,
  //Box Widget plugin options
  boxWidgetOptions: {
    boxWidgetIcons: {
      //Collapse icon
      collapse: 'fa-minus',
      //Open icon
      open: 'fa-plus',
      //Remove icon
      remove: 'fa-times'
    },
    boxWidgetSelectors: {
      //Remove button selector
      remove: '[data-widget="remove"]',
      //Collapse button selector
      collapse: '[data-widget="collapse"]'
    }
  },
  //Direct Chat plugin options
  directChat: {
    //Enable direct chat by default
    enable: true,
    //The button to open and close the chat contacts pane
    contactToggleSelector: '[data-widget="chat-pane-toggle"]'
  },
  //Define the set of colors to use globally around the website
  colors: {
    lightBlue: "#3c8dbc",
    red: "#f56954",
    green: "#00a65a",
    aqua: "#00c0ef",
    yellow: "#f39c12",
    blue: "#0073b7",
    navy: "#001F3F",
    teal: "#39CCCC",
    olive: "#3D9970",
    lime: "#01FF70",
    orange: "#FF851B",
    fuchsia: "#F012BE",
    purple: "#8E24AA",
    maroon: "#D81B60",
    black: "#222222",
    gray: "#d2d6de"
  },
  //The standard screen sizes that bootstrap uses.
  //If you change these in the variables.less file, change
  //them here too.
  screenSizes: {
    xs: 480,
    sm: 768,
    md: 992,
    lg: 1200
  }
};


/* ----------------------------------
 * - Initialize the LayoutManager Object -
 * ----------------------------------
 * All LayoutManager functions are implemented below.
 */
$.LayoutManager._init = function() {
  'use strict';
  /* Layout
   * ======
   * Fixes the layout height in case min-height fails.
   *
   * @type Object
   * @usage $.LayoutManager.layout.activate()
   *        $.LayoutManager.layout.fix()
   *        $.LayoutManager.layout.fixSidebar()
   */
  $.LayoutManager.layout = {
    activate: function () {
      var _this = this;
      _this.fix();
      _this.fixSidebar();
      $(window, ".wrapper").resize(function () {
        _this.fix();
        _this.fixSidebar();
      });
    },
    fix: function () {
      //Get window height and the wrapper height
      var neg = $('.main-header').outerHeight() + $('.main-footer').outerHeight();
      var window_height = $(window).height();
      var sidebar_height = $(".sidebar").height();
      //Set the min-height of the content and sidebar based on the
      //the height of the document.
      if ($("body").hasClass("fixed")) {
        $(".content-wrapper, .right-side").css('min-height', window_height - $('.main-footer').outerHeight());
        $(".content-wrapper, .right-side").css('height', window_height - $('.main-footer').outerHeight());
      } else {
        var postSetWidth;
        if (window_height >= sidebar_height) {
          $(".content-wrapper, .right-side").css('min-height', window_height - neg);
          postSetWidth = window_height - neg;
        } else {
          $(".content-wrapper, .right-side").css('min-height', sidebar_height);
          postSetWidth = sidebar_height;
        }
        //Fix for the control sidebar height
        var controlSidebar = $($.LayoutManager.options.controlSidebarOptions.selector);
        if (typeof controlSidebar !== "undefined") {
          if (controlSidebar.height() > postSetWidth)
            $(".content-wrapper, .right-side").css('min-height', controlSidebar.height());
        }

      }
    },
    fixSidebar: function () {
      //Make sure the body tag has the .fixed class
      if (!$("body").hasClass("fixed")) {
        if (typeof $.fn.slimScroll != 'undefined') {
          $(".sidebar").slimScroll({destroy: true}).height("auto");
        }
        return;
      } else if (typeof $.fn.slimScroll == 'undefined' && window.console) {
        window.console.error("Error: the fixed layout requires the slimscroll plugin!");
      }
      //Enable slimscroll for fixed layout
      if ($.LayoutManager.options.sidebarSlimScroll) {
        if (typeof $.fn.slimScroll != 'undefined') {
          //Destroy if it exists
          $(".sidebar").slimScroll({destroy: true}).height("auto");
          //Add slimscroll
          $(".sidebar").slimscroll({
            height: ($(window).height() - $(".main-header").height()) + "px",
            color: "rgba(255,255,255,0.7)",
            size: "3px"
          });
        }
      }
      else {
         $(".sidebar").css({'height': ($(window).height() - $(".main-header").height()) + "px"})
      }
      
      /*$(".sidebar li a").each(function(){
        var $this = $(this);
        var checkElement = $this.next();
        if ((checkElement.is('.treeview-menu')) && (!checkElement.is(':visible'))) {
          //Get the parent menu
          var parent = $this.parents('ul').first();
          var parent_li = $this.parent("li");
          var li_siblings = parent_li.siblings();
          var parent_find_active;
          var sidebar_content_height = parent.height() - parent.find('li.header').outerHeight();
          var treeviewHeight = parent_li.outerHeight();
          li_siblings.not('.header').each(function(index, el) {
                  treeviewHeight+=$(el).find('a').outerHeight();
          });
          var section_height = (sidebar_content_height - treeviewHeight);
          checkElement.css({
            'height': section_height + 'px',
            'max-height':section_height + 'px',
            'overflow-y': 'auto'
          });
        }
      });*/
      
    }
    
  };

  /* PushMenu()
   * ==========
   * Adds the push menu functionality to the sidebar.
   *
   * @type Function
   * @usage: $.LayoutManager.pushMenu("[data-toggle='offcanvas']")
   */
  $.LayoutManager.pushMenu = {
    activate: function (toggleBtn) {
      //Get the screen sizes
      var screenSizes = $.LayoutManager.options.screenSizes;

      //Enable sidebar toggle
      $(toggleBtn).on('click', function (e) {
        e.preventDefault();

        //Enable sidebar push menu
        if ($(window).width() > (screenSizes.sm - 1)) {
          if ($("body").hasClass('sidebar-collapse')) {
            $("body").removeClass('sidebar-collapse').trigger('expanded.pushMenu');
          } else {
            $("body").addClass('sidebar-collapse').trigger('collapsed.pushMenu');
          }
        }
        //Handle sidebar push menu for small screens
        else {
          if ($("body").hasClass('sidebar-open')) {
            $("body").removeClass('sidebar-open').removeClass('sidebar-collapse').trigger('collapsed.pushMenu');
          } else {
            $("body").addClass('sidebar-open').trigger('expanded.pushMenu');
          }
        }
      });

      $(".content-wrapper").click(function () {
        //Enable hide menu when clicking on the content-wrapper on small screens
        if ($(window).width() <= (screenSizes.sm - 1) && $("body").hasClass("sidebar-open")) {
          $("body").removeClass('sidebar-open');
        }
      });

      //Enable expand on hover for sidebar mini
      if ($.LayoutManager.options.sidebarExpandOnHover || ($('body').hasClass('fixed') && $('body').hasClass('sidebar-mini'))) {
        this.expandOnHover();
      }
    },
    expandOnHover: function () {
      var _this = this;
      var screenWidth = $.LayoutManager.options.screenSizes.sm - 1;
      //Expand sidebar on hover
      $('.main-sidebar').hover(function () {
        if ($('body').hasClass('sidebar-mini') && $("body").hasClass('sidebar-collapse') && $(window).width() > screenWidth) {
          _this.expand();
        }
      }, function () {
        if ($('body').hasClass('sidebar-mini') && $('body').hasClass('sidebar-expanded-on-hover') && $(window).width() > screenWidth) {
          _this.collapse();
        }
      });
    },
    expand: function () {
      $("body").removeClass('sidebar-collapse').addClass('sidebar-expanded-on-hover');
    },
    collapse: function () {
      if ($('body').hasClass('sidebar-expanded-on-hover')) {
        $('body').removeClass('sidebar-expanded-on-hover').addClass('sidebar-collapse');
      }
    }
  };

  /* Tree()
   * ======
   * Converts the sidebar into a multilevel
   * tree view menu.
   *
   * @type Function
   * @Usage: $.LayoutManager.tree('.sidebar')
   */
  $.LayoutManager.tree = function (menu) {
    var _this = this;
    var animationSpeed = $.LayoutManager.options.animationSpeed;
    //click event //
    $(document).on('click', menu + ' li a', function (e) {

      //Get the clicked link and the next element
      var $this = $(this);
      //is the content of the "accordion" ul //
      var checkElement = $this.next();

      //Check if the next element is a menu and is visible
      if ((checkElement.is('.treeview-menu')) && (checkElement.is(':visible'))) {
        //Close the menu
        checkElement.slideUp(animationSpeed, function () {
          checkElement.parent("li.treeview").removeClass("active");
          checkElement.removeClass('menu-open');
          //Fix the layout in case the sidebar stretches over the height of the window
          //_this.layout.fix();
        });

      }
      //If the menu is not visible
      else if ((checkElement.is('.treeview-menu')) && (!checkElement.is(':visible'))) {
        //Get the parent menu
        var parent = $this.parents('ul').first();
        var parent_li = $this.parent("li");
        var li_siblings = parent_li.siblings();
        var parent_find_active;
        var sidebar_content_height = parent.height() - parent.find('li.header').outerHeight();
        var treeviewHeight = parent_li.outerHeight();
        li_siblings.not('.header').each(function(index, el) {
                treeviewHeight+=$(el).find('a').outerHeight();
        });
        var section_height = (sidebar_content_height - treeviewHeight);
        /*checkElement.css({
          'height': section_height + 'px',
          'max-height':section_height + 'px',
          //'overflow-y': 'auto'
        });*/
        //Close all open menus within the parent
        var ul = parent.find('ul.treeview-menu:visible').slideUp(animationSpeed);
        //Remove the menu-open class from the parent
        ul.removeClass('menu-open');
        //Get the parent li
        //Open the target menu and add the menu-open class
        checkElement.slideDown(animationSpeed, function () {
          //Add the class active to the parent li
          checkElement.addClass('menu-open');
          parent_find_active = parent.find('li.treeview.active');
          parent_find_active.removeClass('active');
          parent_li.addClass('active');
          //Fix the layout in case the sidebar stretches over the height of the window
          _this.layout.fix();
        });
      }
      //if this isn't a link, prevent the page from being redirected
      if (checkElement.is('.treeview-menu')) {
        e.preventDefault();
      }
      
      //$.LayoutManager.layout.fix();
      //$.LayoutManager.layout.fixSidebar();
    });
  };

  /* ControlSidebar
   * ==============
   * Adds functionality to the right sidebar
   *
   * @type Object
   * @usage $.LayoutManager.controlSidebar.activate(options)
   */
  $.LayoutManager.floatBar = $.LayoutManager.controlSidebar = {
    //instantiate the object
    activate: function () {
      //Get the object
      var _this = this;
      //Update options
      var o = $.LayoutManager.options.controlSidebarOptions;
      //Get the sidebar
      var sidebar = $(o.selector);
      //The toggle button
      var btn = $(o.toggleBtnSelector);

      //Listen to the click event
      btn.on('click', function (e) {
        e.preventDefault();
        //If the sidebar is not open
        if (!sidebar.hasClass('control-sidebar-open') && !$('body').hasClass('control-sidebar-open')) {
          //Open the sidebar
          _this.open(sidebar, o.slide);
        } else {
          _this.close(sidebar, o.slide);
        }
      });

      //If the body has a boxed layout, fix the sidebar bg position
      var bg = $(".control-sidebar-bg");
      _this._fix(bg);

      //If the body has a fixed layout, make the control sidebar fixed
      if ($('body').hasClass('fixed')) {
        _this._fixForFixed(sidebar);
      } else {
        //If the content height is less than the sidebar's height, force max height
        if ($('.content-wrapper, .right-side').height() < sidebar.height()) {
          _this._fixForContent(sidebar);
        }
      }
    },
    //Open the control sidebar
    open: function (sidebar, slide) {
      //Slide over content
      if (slide) {
        sidebar.addClass('control-sidebar-open');
      } else {
        //Push the content by adding the open class to the body instead
        //of the sidebar itself
        $('body').addClass('control-sidebar-open');
      }
    },
    //Close the control sidebar
    close: function (sidebar, slide) {
      if (slide) {
        sidebar.removeClass('control-sidebar-open');
      } else {
        $('body').removeClass('control-sidebar-open');
      }
    },
    _fix: function (sidebar) {
      var _this = this;
      if ($("body").hasClass('layout-boxed')) {
        sidebar.css('position', 'absolute');
        sidebar.height($(".wrapper").height());
        $(window).resize(function () {
          _this._fix(sidebar);
        });
      } else {
        sidebar.css({
          'position': 'fixed',
          'height': 'auto'
        });
      }
    },
    _fixForFixed: function (sidebar) {
      sidebar.css({
        'position': 'fixed',
        'max-height': '100%',
        'overflow': 'auto',
        'padding-bottom': '50px'
      });
    },
    _fixForContent: function (sidebar) {
      $(".content-wrapper, .right-side").css('min-height', sidebar.height());
    }
  };

  /* BoxWidget
   * =========
   * BoxWidget is a plugin to handle collapsing and
   * removing boxes from the screen.
   *
   * @type Object
   * @usage $.LayoutManager.boxWidget.activate()
   *        Set all your options in the main $.LayoutManager.options object
   */
  $.LayoutManager.boxWidget = {
    selectors: $.LayoutManager.options.boxWidgetOptions.boxWidgetSelectors,
    icons: $.LayoutManager.options.boxWidgetOptions.boxWidgetIcons,
    animationSpeed: $.LayoutManager.options.animationSpeed,
    activate: function (_box) {
      var _this = this;
      if (!_box) {
        _box = document; // activate all boxes per default
      }
      //Listen for collapse event triggers
      $(_box).on('click', _this.selectors.collapse, function (e) {
        e.preventDefault();
        _this.collapse($(this));
      });

      //Listen for remove event triggers
      $(_box).on('click', _this.selectors.remove, function (e) {
        e.preventDefault();
        _this.remove($(this));
      });
    },
    collapse: function (element) {
      var _this = this;
      //Find the box parent
      var box = element.parents(".box").first();
      //Find the body and the footer
      var box_content = box.find("> .box-body, > .box-footer, > form  >.box-body, > form > .box-footer");
      if (!box.hasClass("collapsed-box")) {
        //Convert minus into plus
        element.children(":first")
                .removeClass(_this.icons.collapse)
                .addClass(_this.icons.open);
        //Hide the content
        box_content.slideUp(_this.animationSpeed, function () {
          box.addClass("collapsed-box");
        });
      } else {
        //Convert plus into minus
        element.children(":first")
                .removeClass(_this.icons.open)
                .addClass(_this.icons.collapse);
        //Show the content
        box_content.slideDown(_this.animationSpeed, function () {
          box.removeClass("collapsed-box");
        });
      }
    },
    remove: function (element) {
      //Find the box parent
      var box = element.parents(".box").first();
      box.slideUp(this.animationSpeed);
    }
  };
  
  return $.LayoutManager;
};

/* ------------------
 * - Custom Plugins -
 * ------------------
 * All custom plugins are defined below.
 */

/*
 * BOX REFRESH BUTTON
 * ------------------
 * This is a custom plugin to use with the component BOX. It allows you to add
 * a refresh button to the box. It converts the box's state to a loading state.
 *
 * @type plugin
 * @usage $("#box-widget").boxRefresh( options );
 */
$.LayoutManager.addRefreshButton = function () {
  "use strict";

  $.fn.boxRefresh = function (options) {

    // Render options
    var settings = $.extend({
      //Refresh button selector
      trigger: ".refresh-btn",
      //File source to be loaded (e.g: ajax/src.php)
      source: "",
      //Callbacks
      onLoadStart: function (box) {
        return box;
      }, //Right after the button has been clicked
      onLoadDone: function (box) {
        return box;
      } //When the source has been loaded

    }, options);

    //The overlay
    var overlay = $('<div class="overlay"><div class="fa fa-refresh fa-spin"></div></div>');

    return this.each(function () {
      //if a source is specified
      if (settings.source === "") {
        if (window.console) {
          window.console.log("Please specify a source first - boxRefresh()");
        }
        return;
      }
      //the box
      var box = $(this);
      //the button
      var rBtn = box.find(settings.trigger).first();

      //On trigger click
      rBtn.on('click', function (e) {
        e.preventDefault();
        //Add loading overlay
        start(box);

        //Perform ajax call
        box.find(".box-body").load(settings.source, function () {
          done(box);
        });
      });
    });

    function start(box) {
      //Add overlay and loading img
      box.append(overlay);

      settings.onLoadStart.call(box);
    }

    function done(box) {
      //Remove overlay and loading img
      box.find(overlay).remove();

      settings.onLoadDone.call(box);
    }

  };
  return $.LayoutManager;
};

/*
 * EXPLICIT BOX ACTIVATION
 * -----------------------
 * This is a custom plugin to use with the component BOX. It allows you to activate
 * a box inserted in the DOM after the app.js was loaded.
 *
 * @type plugin
 * @usage $("#box-widget").activateBox();
 */
$.LayoutManager.activateBox = function () {
  'use strict';

  $.fn.activateBox = function () {
    $.LayoutManager.boxWidget.activate(this);
  };
  
  return $.LayoutManager;
};

/*
 * TODO LIST CUSTOM PLUGIN
 * -----------------------
 * This plugin depends on iCheck plugin for checkbox and radio inputs
 *
 * @type plugin
 * @usage $("#todo-widget").todolist( options );
 */

$.LayoutManager.listCustomPlugin = function () {

	  'use strict';

	  $.fn.todolist = function (options) {
	    // Render options
	    var settings = $.extend({
	      //When the user checks the input
	      onCheck: function (ele) {
	        return ele;
	      },
	      //When the user unchecks the input
	      onUncheck: function (ele) {
	        return ele;
	      }
	    }, options);

	    return this.each(function () {

	      if (typeof $.fn.iCheck != 'undefined') {
	        $('input', this).on('ifChecked', function () {
	          var ele = $(this).parents("li").first();
	          ele.toggleClass("done");
	          settings.onCheck.call(ele);
	        });

	        $('input', this).on('ifUnchecked', function () {
	          var ele = $(this).parents("li").first();
	          ele.toggleClass("done");
	          settings.onUncheck.call(ele);
	        });
	      } else {
	        $('input', this).on('change', function () {
	          var ele = $(this).parents("li").first();
	          ele.toggleClass("done");
	          if ($('input', ele).is(":checked")) {
	            settings.onCheck.call(ele);
	          } else {
	            settings.onUncheck.call(ele);
	          }
	        });
	      }
	    });
	  };
	  return $.LayoutManager;
	};
	
	/* ------------------
	 * - Implementation -
	 * ------------------
	 * The next block of code implements LayoutManager's
	 * functions and plugins as specified by the
	 * options above.
	 */
	$.LayoutManager.setup = function ()
	{
	  "use strict";

	  //Fix for IE page transitions
	  $("body").removeClass("hold-transition");

	  //Extend options if external options exist
	  if (typeof LayoutManagerOptions !== "undefined") {
	    $.extend(true,
	            $.LayoutManager.options,
	            LayoutManagerOptions);
	  }

	  //Easy access to options
	  var o = $.LayoutManager.options;

	  //Set up the object
	  $.LayoutManager._init();

	  //Activate the layout maker
	  $.LayoutManager.layout.activate();

	  //Enable sidebar tree view controls
	  $.LayoutManager.tree('.sidebar');

	  //Enable control sidebar
	  if (o.enableControlSidebar) {
	    $.LayoutManager.controlSidebar.activate();
	  }

	  //Add slimscroll to navbar dropdown
	  if (o.navbarMenuSlimscroll && typeof $.fn.slimscroll != 'undefined') {
	    $(".navbar .menu").slimscroll({
	      height: o.navbarMenuHeight,
	      alwaysVisible: false,
	      size: o.navbarMenuSlimscrollWidth
	    }).css("width", "100%");
	  }

	  //Activate sidebar push menu
	  if (o.sidebarPushMenu) {
	    $.LayoutManager.pushMenu.activate(o.sidebarToggleSelector);
	  }

	  //Activate Bootstrap tooltip
	  if (o.enableBSToppltip) {
	    $('body').tooltip({
	      selector: o.BSTooltipSelector
	    });
	  }

	  //Activate box widget
	  if (o.enableBoxWidget) {
	    $.LayoutManager.boxWidget.activate();
	  }

	  //Activate fast click
	  if (o.enableFastclick && typeof FastClick != 'undefined') {
	    FastClick.attach(document.body);
	  }

	  //Activate direct chat widget
	  if (o.directChat.enable) {
	    $(document).on('click', o.directChat.contactToggleSelector, function () {
	      var box = $(this).parents('.direct-chat').first();
	      box.toggleClass('direct-chat-contacts-open');
	    });
	  }

	  /*
	   * INITIALIZE BUTTON TOGGLE
	   * ------------------------
	   */
	  $('.btn-group[data-toggle="btn-toggle"]').each(function () {
	    var group = $(this);
	    $(this).find(".btn").on('click', function (e) {
	      group.find(".btn.active").removeClass("active");
	      $(this).addClass("active");
	      e.preventDefault();
	    });

	  });
	  
	  return $.LayoutManager
	  	.addRefreshButton()
	  	.activateBox()
	  	.listCustomPlugin();
	};

$.LayoutManager.loading = function(start){
  var start = _.isBoolean(start) ? start : true;
  if (start) {
    $('body').append('<div id="loadspinner" class="loading"></div>');
  }
  else {
    $('#loadspinner').remove();
  }
}

module.exports = $.LayoutManager;

},{}],13:[function(require,module,exports){
var t = require('sdk/core/i18n/i18n.service').t;
var Stack = require('./barstack.js');

//sidebar item che non è altro che un li della sidebar dove sarà possobile impostare
//titolo tipo di icona etc .. customizzata per ogni componente

var SidebarItem = Vue.extend({
  template: require('../html/sidebar-item.html'),
  data: function() {
    return {
        main: true,
        component: null,
        active: false,
        dataType: 'inline',
        title: 'component',
        icon: null,
        open: true,
        state: null
      };
  }
});

function SidebarService(){
  this.stack = new Stack();
  this.state = {
    components: []
  };
  
  this.init = function(layout){
    this.layout = layout;
  };
  
  this.addComponent = function(component){
    //aggiungo componente
    this.state.components.push(component);
    //faccio montare il sedebar-item che contiene al suo interno il placeholder del componente vero e proprio
    //in questo modo il componente non si dovrà occupare di costruire anche l'elemento li della sidebar
    //ma conterrà solo il contenuto
    var sidebarItem = new SidebarItem();
    //setto le parti della sidebar-item che cambiano da componente a componente (da rivedere)
    sidebarItem.title = component.title || sidebarItem.title;
    sidebarItem.open = (component.open === undefined) ? sidebarItem.open : component.open;
    sidebarItem.icon = component.dataIcon || sidebarItem.icon;
    sidebarItem.state = component.state || true;
    sidebarItem.$mount().$appendTo('#g3w-sidebarcomponents');
    
    //monto il componete nella sidebar
    component.mount("#g3w-sidebarcomponent-placeholder");
    if (_.has(component, 'initService')) {
      component.initService();
    };
  };
  
  this.removeComponent = function(){
    //da vedere
  };

  this.showPanel = function(panel){
    var parent = "#g3w-sidebarpanel-placeholder";
    this.stack.push(panel, parent);
  };

  this.closePanel = function(){
    var panel = this.stack.pop();
  };
}

var sidebarService = new SidebarService();

var SidebarComponent = Vue.extend({
    template: require('../html/sidebar.html'),
    data: function() {
    	return {
        components: sidebarService.state.components,
        panels: sidebarService.stack.state.panels,
        bOpen: true,
    		bPageMode: false,
    		header: t('main navigation'),
        };
    },
    computed: {
      // quanti pannelli sono attivi nello stack
      panelsinstack: function(){
        return this.panels.length>0;
      },
      showmainpanel: function(){
        return this.components.length>0 && !this.panelsinstack;
      },
      componentname: function(){
        var name = "";
        if (this.components.length){
          name = this.components.slice(-1)[0].getTitle();
        }
        return name;
      },
      panelname: function(){
        var name = "";
        if (this.panels.length){
          name = this.panels.slice(-1)[0].getTitle();
        }
        return name;
      }
    },
    methods: {
      closePanel: function(){
        sidebarService.closePanel();
      },
      isMobile: function(){
        return isMobile.any
      }
    },
    ready: function(){
    }
});

module.exports = {
  SidebarService: sidebarService,
  SidebarComponent: SidebarComponent
}

},{"../html/sidebar-item.html":6,"../html/sidebar.html":7,"./barstack.js":10,"sdk/core/i18n/i18n.service":31}],14:[function(require,module,exports){
var t = require('sdk/core/i18n/i18n.service').t;
require('sdk/gui/vue/vue.directives');
var ComponentsRegistry = require('sdk/gui/componentsregistry');
var GUI = require('sdk/gui/gui');
// temporaneo per far funzionare le cose
var config = {
    client:{}
};

var sidebar = require('./sidebar');
var floatbar = require('./floatbar');
var viewport = require('./viewport');
var AppUI = require('./applicationui');
var layout = require('./layout');

// forse da trovare un posto migliore per attivare lo spinner iniziale...
layout.loading();

var ApplicationTemplate = function(templateConfig, ApplicationService) {
  self = this;
  this.templateConfig = templateConfig;
  this.ApplicationService = ApplicationService;
  
  this.init = function() {
    var config = ApplicationService.getConfig();
    if (config.debug){
      Vue.config.debug = true;
    }
    this._setupInterface();
    this._setupLayout();
  };
  
  this._setupLayout = function(){  
    Vue.filter('t', function (value) {
      return t(value);
    });

    var AppUI = require('./applicationui');

    Vue.component('sidebar', sidebar.SidebarComponent);
    Vue.component('viewport', viewport.ViewportComponent);
    Vue.component('floatbar', floatbar.FloatbarComponent);
    Vue.component('app', AppUI);
    //inizializza l'applicazione Vue
    var template = this;  
    var app = new Vue({
      el: 'body',
      ready: function(){
        self._buildTemplate();
        $(document).localize();
      }
    });
  }
  
  this._buildTemplate = function() {
    var self = this;
    floatbar.FloatbarService.init(layout);
    var placeholdersConfig = this.templateConfig.placeholders;
    _.forEach(placeholdersConfig, function(components, placeholder){
      // per ogni placeholder ci possono essere più componenti ciclo e aggiungo
     _.forEach(components.components, function(component){
        self._addComponent(placeholder, component);
      });
    });
    //registro altri componenti che non hanno una collocazione spaziale precisa
    // come da esempio i risultati che possono essere montati sulla floatbar o altre parti del template
    this._addOtherComponents();

    GUI.ready();
  };

  //aggiungere compineti non legati ad un placeholder
  this._addOtherComponents = function() {
    var self = this;
    if (this.templateConfig.othercomponents) {
      _.forEach(this.templateConfig.othercomponents, function(component) {
        self._addComponent('othercomponents', component);
      })
    };
  };
  
  this._addComponent = function(placeholder, component) {
    if (ApplicationTemplate.PLACEHOLDERS.indexOf(placeholder) > -1){
      var placeholderService = ApplicationTemplate.PlaceholdersServices[placeholder];
      if (placeholderService) {
        placeholderService.addComponent(component);
        ComponentsRegistry.registerComponent(component);
      }
    } else { // caso di componenti non placeholder
      ComponentsRegistry.registerComponent(component);
    }
  };
  
  this._removeComponent = function(plceholder,componentId) {
    ComponentsRegistry.unregisterComponent(component);
  };
  
  this._showModalOverlay = function(bool){
    /*if (!this._modalOverlay){
      this._modalOverlay = $('<div id="g3w-modal-overlay" style="background-color: #000000; opacity: 0.7;z-index:4000;position:fixed;top:0px;left:0px"></div>');
      $("body").append(this._modalOverlay);
      this._modalOverlay.width($(window).innerWidth());
      this._modalOverlay.height($(window).innerHeight());
    }
    if (_.isUndefined(bool) || bool === true){
      this._modalOverlay.width($(window).innerWidth());
      this._modalOverlay.height($(window).innerHeight());
      this._modalOverlay.show();
    }
    else {
      this._modalOverlay.hide();
    }*/
  };

  this._showSidebar = function() {
    //codice qui
  };
  this._hideSidebar = function() {
    //codice qui
  };
  
  this._setupInterface = function() {
    /* DEFINIZIONE INTERFACCIA PUBBLICA */
    
    /* Metodi comuni a tutti i template */
    GUI.layout = layout;
    GUI.addComponent = _.bind(this._addComponent, this);
    GUI.removeComponent = _.bind(this._removeComponent, this);
    
    /* Metodi da definire (tramite binding) */
    GUI.getResourcesUrl = _.bind(function() {
      return this.ApplicationService.getConfig().resourcesurl;
    },this);
    
    GUI.showForm = _.bind(floatbar.FloatbarService.showPanel,floatbar.FloatbarService);
    GUI.closeForm = _.bind(floatbar.FloatbarService.closePanel,floatbar.FloatbarService);
    GUI.showList = _.bind(floatbar.FloatbarService.showPanel,floatbar.FloatbarService);
    GUI.closeList = _.bind(floatbar.FloatbarService.closePanel,floatbar.FloatbarService);
    GUI.hideList = _.bind(floatbar.FloatbarService.hidePanel,floatbar.FloatbarService);
    
    GUI.showTable = function() {};
    GUI.closeTable = function() {};
    
    // Qui si implementa il metodo per la visualizzazione dei risultati
    // derivanti da una query

    //esempio di metodo generico
    GUI.showResultsFactory = function(type) {
      var showPanelResults;
      switch (type) {
        case 'query':
          GUI.showFloatbar();
          showPanelResults = GUI.showQueryResults;
          break;
      };
      return showPanelResults;
    };

    GUI.showQueryResults = function(title,results) {
      // istanziare il componente queryresults
      var queryResultsComponent = GUI.getComponent('queryresults');
      // passarlo a Floatbar
      var queryResultService = queryResultsComponent.getService();
      queryResultService.reset();
      queryResultService.setTitle(title);
      if (results) {
        queryResultService.setQueryResponse(results);
      }
      //rimuovo spinner
      var options = {append: true};
      floatbar.FloatbarService.showPanel(queryResultsComponent, options);
      return queryResultService;
    };
    
    GUI.hideQueryResults = _.bind(floatbar.FloatbarService.hidePanel,floatbar.FloatbarService);
    //temporaneo show panel
    GUI.showPanel = _.bind(sidebar.SidebarService.showPanel, sidebar.SidebarService);
    GUI.closePanel = _.bind(sidebar.SidebarService.closePanel, sidebar.SidebarService);
    /* ------------------ */

    toastr.options.positionClass = 'toast-top-center';
    toastr.options.preventDuplicates = true;
    // proxy della libreria toastr
    GUI.notify = toastr;
    // proxy della libreria bootbox
    GUI.dialog = bootbox;
    /* spinner */
    GUI.showSpinner = function(options){
      var container = options.container || 'body';
      var id = options.id || 'loadspinner';
      var where = options.where || 'prepend'; // append | prepend
      var style = options.style || '';
      var transparent = options.transparent ? 'background-color: transparent' : '';
      if (!$("#"+id).length) {
        $(container)[where].call($(container),'<div id="'+id+'" class="spinner-wrapper '+style+'" style="'+transparent+'"><div class="spinner '+style+'"></div></div>');
      }
    };
    GUI.hideSpinner = function(id){
      $("#"+id).remove();
    };
    /* end spinner*/

    /* fine metodi comuni */
    
    /* Metodi specifici del template */
    // FLOATBAR //
    GUI.showFloatbar = function() {
      floatbar.FloatbarService.open();
    };
    GUI.hideFloatbar = function() {
      floatbar.FloatbarService.close();
    };

    // SIDEBAR //
    GUI.showSidebar = _.bind(this._showSidebar, this);
    GUI.hideSidebar = _.bind(this._hideSidebar, this);
    
    GUI.setModal = _.bind(this._showModalOverlay,this);
    
    // Mostra la mappa come vista principale
    GUI.showMap = function() {
      viewport.ViewportService.setPrimaryComponent('map');
    };
    // Mostra la mappa come vista aside, impostando il rapporto vista principale / vista secondaria (es. 2 per 1/2, 3 per vista secondaria 1/ di quella primaria, ecc.)
    GUI.showMapAside = function(split,ratio) {
      
    };
    // Mostra il contenuto come vista principale. Il contenuto può essere una string HTML, un elemento DOM o un componente Vue
    GUI.showContent = function(content) {
      var contentComponent = ComponentsRegistry.getComponent('content');
      // contentComponent.setContent(content);  DA IMPLEMENTARE: Il secondo componente settato in fase di configurazione (ancora non presente) dovrà implementare il metodo setContent
      // che accetterà o una stringa HTML, o un elemento DOM, oppure un componente Vue
      viewport.ViewportService.setPrimaryComponent('content');
    };
    // Mostra i contenuto come vista aside
    GUI.showContentAside = function(content,split,ratio) {
      var contentComponent = ComponentsRegistry.getComponent('content');
      // contentComponent.setContent(content);
      viewport.ViewportService.setPrimaryComponent('map');
      viewport.ViewportService.showSecondaryView(split,ratio);
    };
    // Nasconde la vista secondaria
    GUI.hideAside = function() {
      viewport.ViewportService.hideSecondaryView();
    }
    
    /* fine metodi specifici */
    
    /* FINE DEFINIZIONE INTERFACCIA PUBBLICA */
  };
  
};

ApplicationTemplate.PLACEHOLDERS = [
  'navbar',
  'sidebar',
  'viewport',
  'floatbar'
];

ApplicationTemplate.PlaceholdersServices = {
  navbar: null,
  sidebar: sidebar.SidebarService,
  viewport: viewport.ViewportService,
  floatbar: sidebar.FloatbarService,
};

module.exports =  ApplicationTemplate;


},{"./applicationui":9,"./floatbar":11,"./layout":12,"./sidebar":13,"./viewport":15,"sdk/core/i18n/i18n.service":31,"sdk/gui/componentsregistry":68,"sdk/gui/gui":71,"sdk/gui/vue/vue.directives":90}],15:[function(require,module,exports){
var inherit = require('sdk').core.utils.inherit;
var base = require('sdk').core.utils.base;
var merge = require('sdk').core.utils.merge;
var G3WObject = require('sdk').core.G3WObject;
var GUI = require('sdk').gui.GUI;

var ViewportService = function(){  
  this.state = {
    primaryViewTag: 'one', // di default la vista primaria è la prima
    secondaryVisible: false,
    ratioDenom: 2,
    split: 'h',
    viewSizes: {
      one: {
        width: 0,
        height: 0
      },
      two: {
        width: 0,
        height: 0
      }
    }
  };
  
  this.setters = {
    setPrimaryComponent: function(componentId) {
      var component = this._viewsByComponentId[componentId];
      if(component) {
        var viewTag = component.viewTag;
        this._setPrimaryView(viewTag);
      }
    }
  }
  
  this._viewsByComponentId = {};
  var _components = null;
  
  /* INTERFACCIA PUBBLICA */
  
  this.addComponent = function(component) {
    var self = this;
    // la viewport ha al massimo due viste, ognuna contente al massimo un componente. Se viene richiesta l'aggiunta di più di due componenti questi vengono ignorati
    var spaceLeft = 2 - _.keys(self._viewsByComponentId).length;
    if (spaceLeft <= 0) {
      return;
    }
    
    // il primo componente ad essere aggiunto avrà il tag 'one'
    var viewTag = (spaceLeft == 2) ? 'one' : 'two';

    component.mount('#g3w-view-'+viewTag,true).
    then(function(){
      var componentId = component.getId();
      self._viewsByComponentId[componentId] = {
        viewTag: viewTag,
        component: component
      }
    });
  };
  
  this.showSecondaryView = function(split,ratioDenom) {
    this.state.secondaryVisible = true;
    this.state.split = split ? split : this.state.split;
    this.state.ratioDenom = ratioDenom ? ratioDenom : this.state.ratioDenom;
    this._layout();
  };
  
  this.hideSecondaryView = function() {
    this.state.secondaryVisible = false;
    this._layout();
  };
  
  /* FINE INTERFACCIA PUBBLICA */
  
  this._otherTag = function(viewTag) {
    return (viewTag == 'one') ? 'two' : 'one';
  };
  
  // meccanismo per il ricalcolo delle dimensioni della viewport e dei suoi componenti figli
  
  this._setPrimaryView = function(viewTag) {
    this.state.primaryView = viewTag;
    this._layout();
  };
  
  this._prepareLayout = function() {
    var self = this;
    var drawing = false;
    var resizeFired = false;
    
    function triggerResize() {
      resizeFired = true;
      drawResize();
    } 

    function drawResize() {
      if (resizeFired === true) {
          resizeFired = false;
          drawing = true;
          self._layout();
          requestAnimationFrame(drawResize);
      } else {
          drawing = false;
      }
    }
    
    GUI.on('ready',function(){
      // primo layout
      self._layout();
      
      // resize scatenato da GUI
      GUI.on('guiresized',function(){
        triggerResize();
      });
      
      // resize della window
      $(window).resize(function() {
        // set resizedFired to true and execute drawResize if it's not already running
        if (drawing === false) {
            triggerResize();
        }
      });
      
      // resize sul ridimensionamento della sidebar
      $('.main-sidebar').on('webkitTransitionEnd transitionend msTransitionEnd oTransitionEnd', function () {
          $(this).trigger('trans-end');
          triggerResize();
      });
    });
  };
  
  this._calcViewSizes = function() {
    var primaryViewTag = this.state.primaryViewTag;
    var seondaryViewTag = this._otherTag(primaryViewTag);
    
    var viewportWidth = this._viewportWidth();
    var viewportHeight = this._viewportHeight();
    
    var primaryWidth = viewportWidth;
    var primaryHeight = viewportHeight;
    var secondaryWidth = 0;
    var secondaryHeight = 0;
    
    if (this.state.secondaryVisible) {
      var ratio = this.state.ratioDenom;
      if (ratio > 0) {
        if (this.state.split == 'h') {
          secondaryWidth = viewportWidth / ratio;
          secondaryHeight = viewportHeight;
          primaryWidth = viewportWidth - secondaryWidth;
          primaryHeight = viewportHeight;
        }
        else {
          secondaryWidth = viewportWidth;
          secondaryHeight = viewportHeight / ratio;
          primaryWidth = viewportWidth;
          primaryHeight = viewportHeight - secondaryHeight;
        }
      }
      else {
        this.state.secondaryVisible = false;
      }
    }
    
    this.state.viewSizes[primaryViewTag].width = primaryWidth;
    this.state.viewSizes[primaryViewTag].height = primaryHeight;
    this.state.viewSizes[seondaryViewTag].width = secondaryWidth;
    this.state.viewSizes[seondaryViewTag].height = secondaryHeight;
  };
  
  this._viewportHeight = function() {
      var topHeight = $(".navbar").innerHeight();
      return $(window).innerHeight() - topHeight;
    };
    
  this._viewportWidth = function() {
    var offset = $(".main-sidebar").offset().left;
    var width = $(".main-sidebar").innerWidth();
    var sideBarSpace = width + offset;
    return $(window).innerWidth() - sideBarSpace;
  };
  
  this._layout = function() {
    var self = this;
      if (!_components){
        _components = _.map(this._viewsByComponentId,function(view){ return view.component; });
      }
      //var width = self._viewportWidth();
      //var height = self._viewportHeight();
      this._calcViewSizes();
      _.forEach(_components,function(component){
        // viene chiamato il metodo per il ricacolo delle dimensioni nei componenti figli
        var viewTag = self._viewsByComponentId[component.getId()].viewTag;
        var width = self.state.viewSizes[viewTag].width;
        var height = self.state.viewSizes[viewTag].height;
        component.layout(width,height);
      })
    }
  
  this._prepareLayout();
  base(this);
};
inherit(ViewportService, G3WObject);

var viewportService = new ViewportService;

var ViewportComponent = Vue.extend({
  template: require('../html/viewport.html'),
  data: function() {
    return {
      state: viewportService.state
    }
  }
})

module.exports = {
  ViewportService: viewportService,
  ViewportComponent: ViewportComponent
}

},{"../html/viewport.html":8,"sdk":91}],16:[function(require,module,exports){
var inherit = require('core/utils/utils').inherit;
var base = require('core/utils/utils').base;
var G3WObject = require('core/g3wobject');
var reject = require('core/utils/utils').reject;

function ApiService(){
  this._config = null;
  this._baseUrl = null;
  this._apiUrls = {};
  
  this.init = function(config) {
    this._config = config;
    this._baseUrl = config.urls.api;
    this._apiEndpoints = config.urls.apiEndpoints;
  };
  
  var howManyAreLoading = 0;
  this._incrementLoaders = function(){
    if (howManyAreLoading == 0){
      this.emit('apiquerystart');
    }
    howManyAreLoading += 1;
  };
  
  this._decrementLoaders = function(){
    howManyAreLoading -= 1;
    if (howManyAreLoading == 0){
      this.emit('apiqueryend');
    }
  };
  
  this.get = function(api,options) {
    var self = this;
    var apiEndPoint = this._apiEndpoints[api];
    if (apiEndPoint) {
      var completeUrl = this._baseUrl + '/' + apiEndPoint;
      if (options.request) {
         completeUrl = completeUrl + '/' + options.request;
      }
      var params = options.params || {};
      
      self.emit(api+'querystart');
      this._incrementLoaders();
      return $.get(completeUrl,params)
      .done(function(response){
        self.emit(api+'queryend',response);
        return response;
      })
      .fail(function(e){
        self.emit(api+'queryfail',e);
        return e;
      })
      .always(function(){
        self._decrementLoaders();
      });
    }
    else {
      return reject();
    }
  };
  
  base(this);
}
inherit(ApiService,G3WObject);

module.exports = new ApiService;

},{"core/g3wobject":28,"core/utils/utils":49}],17:[function(require,module,exports){
var inherit = require('core/utils/utils').inherit;
var base = require('core/utils/utils').base;
var G3WObject = require('core/g3wobject');
var ApiService = require('core/apiservice');
var ProjectsRegistry = require('core/project/projectsregistry');
var PluginsRegistry = require('core/plugin/pluginsregistry');

var ApplicationService = function(){
  this.secret = "### G3W Client Application Service ###";
  var self = this;
  this.initialized = false;
  this._modalOverlay = null;
  this.config = {};

  // chiama il costruttore di G3WObject (che in questo momento non fa niente)
  base(this);
  
  this.init = function(config){
    this._config = config;
    this._bootstrap();
  };
  
  this.getConfig = function() {
    return this._config;
  };
  
  this._bootstrap = function(){
    var self = this;
    if (!this.initialized){
      //inizializza la configurazione dei servizi. Ognungo cercherà dal config quello di cui avrà bisogno
      //una volta finita la configurazione emetto l'evento ready. A questo punto potrò avviare l'istanza Vue globale
      $.when(
        ApiService.init(this._config),
        ProjectsRegistry.init(this._config)
      ).then(function(){
        PluginsRegistry.init({
          plusingBaseUrl: self._config.urls.staticurl,
          pluginsConfigs: self._config.plugins
        });
        self.emit('ready');
        this.initialized = true;
      });
    };
  };
};
inherit(ApplicationService,G3WObject);

module.exports = new ApplicationService;

},{"core/apiservice":16,"core/g3wobject":28,"core/plugin/pluginsregistry":40,"core/project/projectsregistry":42,"core/utils/utils":49}],18:[function(require,module,exports){
var inherit = require('core/utils/utils').inherit;
var G3WObject = require('core/g3wobject');

function EditBuffer(editor){
  this._editor = editor;
  
  this._origVectorLayer = new ol.layer.Vector({
    source: new ol.source.Vector()
  });
  this._cloneLayer();
  
  //buffer delle geometrie
  this._geometriesBuffer = {};
  
  // buffer degli attributi
  this._attributesBuffer = {};
  
  // buffer degli attributi delle relazioni
  this._relationsAttributesBuffer = {};
}
inherit(EditBuffer,G3WObject);
module.exports = EditBuffer;

var proto = EditBuffer.prototype;

proto.commit = function(){
  var newFeatures = this._editor.getEditVectorLayer().getFeatures();
  this._editor.getVectorLayer().addFeatures(newFeatures);
  this._editor.getEditVectorLayer().clear();
  this._clearBuffers();
  this._cloneLayer();
};

proto.undoAll = function(){
  this._resetVectorLayer();
  this._clearBuffers();
};

proto.destroy = function(){
  this._clearBuffers();
};

proto.generateId = function(){
  return this._editor.generateId();
};

proto.addFeature = function(feature){
  if(!feature.getId()){
    feature.setId(this.generateId());
  }
  this._addEditToGeometryBuffer(feature,'add');
  console.log("Inserita nuova feature: (ID: "+feature.getId()+" "+feature.getGeometry().getCoordinates()+") nel buffer");
};

proto.updateFeature = function(feature){
  this._addEditToGeometryBuffer(feature,'update');
  console.log("Modificata feature: (ID: "+feature.getId()+" "+feature.getGeometry().getCoordinates()+") nel buffer");
};

proto.deleteFeature = function(feature){
  this._addEditToGeometryBuffer(feature,'delete');
  console.log("Rimossa feature: (ID: "+feature.getId()+" "+feature.getGeometry().getCoordinates()+") nel buffer");
};

proto.updateAttributes = function(feature,relationsAttributes){
  if(!feature.getId()){
    feature.setId(this.generateId());
  }
  this._addEditToAttributesBuffer(feature,relationsAttributes);
  console.log("Modificati attributi feature: (ID: "+feature.getId()+")");
};

proto.getFeatureAttributes = function(fid){
  if(this._attributesBuffer[fid]){
    return this._attributesBuffer[fid].slice(-1)[0];
  }
  return null;
};

proto.areFeatureAttributesEdited = function(fid){
  if (this._attributesBuffer[fid]){
    return this._attributesBuffer[fid].length > -1;
  }
  return false;
};

proto.getRelationsAttributes = function(fid){
  return this._relationsAttributesBuffer[fid].slice(-1)[0];
};

proto.areFeatureRelationsEdited = function(fid){
  if (this._relationsAttributesBuffer[fid]){
    return this._relationsAttributesBuffer[fid].length > -1;
  }
  return false;
};

proto.collectFeatureIds = function(){
  var geometriesBuffers = this._geometriesBuffer;
  var attributesBuffers = this._attributesBuffer;
  
  var modifiedFids = [];

  modifiedFids = _.concat(modifiedFids,_.keys(geometriesBuffers));
  modifiedFids = _.concat(modifiedFids,_.keys(attributesBuffers));
  
  return _.uniq(modifiedFids);
};

proto.collectFeatures = function(state,asGeoJSON){
  var self = this;
  var geometriesBuffers = this._geometriesBuffer;
  var attributesBuffers = this._attributesBuffer;
  var asGeoJSON = asGeoJSON || false;
  var GeoJSONFormat = new ol.format.GeoJSON();
  
  var modifiedFids = this.collectFeatureIds();
  
  var layer;
  if (state == 'new') {
    layer = self._editor.getEditVectorLayer();
  }
  else {
    layer = self._editor.getVectorLayer();
  }
  
  var features = [];
  _.forEach(modifiedFids,function(fid){
    
    var feature = layer.getFeatureById(fid);
    var isNew = self._isNewFeature(fid);
    var addedFeature = (state == 'new' && isNew && feature);
    var updatedFeature = (state == 'updated' && !isNew && feature);
    var deletedFeature = (state == 'deleted' && !isNew && !feature);
    
    if (addedFeature || updatedFeature){
      if (asGeoJSON){
        feature = GeoJSONFormat.writeFeatureObject(feature);
      }
      features.push(feature);
    }
    else if (deletedFeature) {
      features.push(fid);
    }
  });
  return features;
};

proto.createFeature = function(fid,geometry,attributes){
  var feature = new ol.Feature();
  feature.setId(fid);
  feature.setGeometry(geometry);
  feature.setProperties(attributes);
  return feature;
};

proto.collectRelationsAttributes = function(){
  var relationsAttributes = {};
  _.forEach(this._relationsAttributesBuffer,function(relationsBuffer,fid){
    lastRelationsAttributes = relationsBuffer[relationsBuffer.length-1];
    relationsAttributes[fid] = lastRelationsAttributes;
  })
  return relationsAttributes;
};

proto._addEditToGeometryBuffer = function(feature,operation){
  var geometriesBuffer = this._geometriesBuffer;
  
  var id = feature.getId();
  var geometry = feature.getGeometry();
  
  if (operation == 'delete'){
      geometry = null;
      var layer = this._isNewFeature(id) ? this._editor._editVectorLayer : this._editor._vectorLayer;
      layer.getSource().removeFeature(feature);
  } 
  
  if (!_.has(geometriesBuffer,id)){
    geometriesBuffer[id] = [];
  }
  geometriesBuffer[id].push(geometry);
  this._setDirty();
};

proto._addEditToAttributesBuffer = function(feature,relationsAttributes){
  var fid = feature.getId();
  var attributes = feature.getProperties();
  var attributesBuffer = this._attributesBuffer;

  if (!_.has(attributesBuffer,fid)){
    attributesBuffer[fid] = [];
  }
  attributesBuffer[fid].push(attributes);
  
  if (relationsAttributes){
    if (!_.has(this._relationsAttributesBuffer,fid)){
    this._relationsAttributesBuffer[fid] = [];
  }
    this._relationsAttributesBuffer[fid].push(relationsAttributes);
  }
  this._setDirty();
};

// guardo se è una feature già presente nel buffer delle nuove geometrie
proto._isNewFeature = function(fid){
  //return id.toString().indexOf('_new_') > -1;
  return this._editor.isNewFeature(fid);
};

proto._setDirty = function(){
  this._editor._setDirty();
};

proto._resetVectorLayer = function(){
  this._editor.vectoLayer = this._origVectorLayer;
  this._origVectorLayer.getSource().clear();
};

proto._clearBuffers = function(){
  this._geometriesBuffer = {};
  this._attributesBuffer = {};
  this._relationsAttributesBuffer = {};
  this._editor._setDirty(false);
};

proto._cloneLayer = function(){
  var clonedFeatures = [];
  this._editor._vectorLayer.getSource().forEachFeature(function(feature){
    clonedFeatures.push(feature.clone());
  },this);
  this._origVectorLayer.getSource().addFeatures(clonedFeatures);
};

},{"core/g3wobject":28,"core/utils/utils":49}],19:[function(require,module,exports){
var inherit = require('core/utils/utils').inherit;
var base = require('core/utils/utils').base;
var resolve = require('core/utils/utils').resolve;
var reject = require('core/utils/utils').reject;
var G3WObject = require('core/g3wobject');
var GUI = require('gui/gui');
var VectorLayer = require('core/layer/vectorlayer');

//var Sequencer = require('./stepsequencer');
var AddFeatureTool = require('./tools/addfeaturetool');
var MoveFeatureTool = require('./tools/movepointtool');
var ModifyFeatureTool = require('./tools/modifyfeaturetool');
var DeleteFeatureTool = require('./tools/deletefeaturetool');
var PickFeatureTool = require('./tools/pickfeaturetool');
var CutLineTool = require('./tools/cutlinetool');
var EditBuffer = require('./editbuffer');

var EditorGeometryTypes = [
  'Point',
  //'MultiPoint',
  'LineString',
  'MultiLineString',
  //'Polygon',
  //'MultiPolygon'
];

// Editor di vettori puntuali
function Editor(options){
  this._vectorLayer = null;
  this._editVectorLayer = null;
  this._editBuffer = null;
  this._activeTool = null;
  this._dirty = false;
  this._newPrefix = '_new_';
  
  this._withFeatureLocks = false;
  this._featureLocks = null;
  
  this._started = false;
  
  this._setterslisteners = {
      before: {},
      after: {}
  };
  this._geometrytypes = [
    'Point',
    //'MultiPoint',
    'LineString',
    'MultiLineString',
    //'Polygon',
    //'MultiPolygon'
  ];
  
  // elenco dei tool e delle relative classi per tipo di geometria (in base a vector.geometrytype)
  this._toolsForGeometryTypes = {
      'Point': {
        addfeature: AddFeatureTool,
        movefeature: MoveFeatureTool,
        deletefeature: DeleteFeatureTool,
        editattributes: PickFeatureTool
      },
      'LineString': {
        addfeature: AddFeatureTool,
        modifyvertex: ModifyFeatureTool,
        movefeature: MoveFeatureTool,
        deletefeature: DeleteFeatureTool,
        editattributes: PickFeatureTool,
        cutline: CutLineTool
      }
  };
  
  this._activeTool = new function(){
    this.type = null;
    this.instance = null;
    
    this.setTool = function(type,instance){
      this.type = type;
      this.instance = instance;
    };
    
    this.getType = function(){
      return this.type;
    };
    
    this.getTool = function(){
      return this.instance;
    };
    
    this.clear = function(){
      this.type = null;
      this.instance = null;
    };
  }
  
  this._tools = {};
  
  base(this);
}
inherit(Editor,G3WObject);
module.exports = Editor;

var proto = Editor.prototype;

// associa l'oggetto VectorLayer su cui si vuole fare l'editing
proto.setVectorLayer = function(vectorLayer){
  var geometrytype = vectorLayer.geometrytype;
  if (!geometrytype || ! this._isCompatibleType(geometrytype)){
    throw Error("Vector geometry type "+geometrytype+" is not valid for editing");
  }
  this._setToolsForVectorType(geometrytype);
  this._vectorLayer = vectorLayer;
};

// avvia la sessione di editazione con un determinato tool (es. addfeature)
proto.start = function(){
  // TODO: aggiungere notifica nel caso questo if non si verifichi
  var res = false;
  // se è stato settato il vectorLayer
  if (this._vectorLayer){
    // nel caso non sia già avviato prima lo stoppo;
    this.stop();
    
    // istanzio l'editVectorLayer
    this._editVectorLayer = new VectorLayer({
      name: "editvector",
      geometrytype: this._vectorLayer.geometrytype,
    })
    GUI.getComponent('map').getService().viewer.map.addLayer(this._editVectorLayer.getLayer());
    
    // istanzio l'EditBuffer
    this._editBuffer = new EditBuffer(this);
    this._setStarted(true);
    res = true;
  }
  return res;
};

// termina l'editazione
proto.stop = function(){
  if (this.isStarted()){
    if (this.stopTool()) {
      this._editBuffer.destroy();
      this._editBuffer = null;
      this.removeAllListeners();
      GUI.getComponent('map').getService().viewer.removeLayerByName(this._editVectorLayer.name);
      this._setStarted(false);
      return true;
    }
    return false;
  }
  return true;
};

proto.setTool = function(toolType,options){
  if (!this.stopTool()){
    return false;
  }
  var toolClass = this._tools[toolType];
  
  // se esiste il tool richiesto
  if (toolClass ){
    var toolInstance = new toolClass(this,options);
    this._activeTool.setTool(toolType,toolInstance);
    this._setToolSettersListeners(toolInstance,this._setterslisteners);
    toolInstance.run();
    return true;
  }
};

proto.stopTool = function(){
  if (this._activeTool.instance && !this._activeTool.instance.stop()){
    return false;
  }
  this._activeTool.clear();
  return true;
};

proto.getActiveTool = function(){
  return this._activeTool;
};

proto.isStarted = function(){
  return this._started;
};

proto.hasActiveTool = function(){
  return !_.isNull(this._activeTool.instance);
};

proto.isToolActive = function(toolType){
   if (this._activeTool.toolType){
    return this._activeTool.toolType == toolType;
   };
   return false;
};

proto.generateId = function(){
  return this._editBuffer.generateId();
};

proto.commit = function(newFeatures){
  this._editBuffer.commit(newFeatures);
};

proto.undoAll = function(){
  this._editBuffer.undoAll();
};

proto.setFeatureLocks = function(featureLocks){
  this._withFeatureLocks = true;
  this._featureLocks = featureLocks;
};

proto.getFeatureLocks = function(featureLocks){
  return this._featureLocks;
};

proto.getFeatureLockIds = function(){
  return _.map(this._featureLocks,function(featurelock){
    return featurelock.lockid;
  });
};

proto.getFeatureLocksLockIds = function(featureLocks){
  var featureLocks = featureLocks || this._featureLocks;
  return _.map(featureLocks,function(featurelock){
    return featurelock.lockid;
  });
};

proto.getFeatureLocksFeatureIds = function(featureLocks){
  var featureLocks = featureLocks || this._featureLocks;
  return _.map(featureLocks,function(featurelock){
    return featurelock.featureid;
  });
};

proto.getFeatureLockIdsForFeatureIds = function(fids){
  var featurelocksForFids = _.filter(this._featureLocks,function(featurelock){
    return _.includes(fids,featurelock.featureid);
  });
  
  return this.getFeatureLocksLockIds(featurelocksForFids);
};

proto.getEditedFeatures = function(){
  var modifiedFids = this._editBuffer.collectFeatureIds();
  var lockIds = this.getFeatureLockIdsForFeatureIds(modifiedFids);
  return {
    add: this._editBuffer.collectFeatures('new',true),
    update: this._editBuffer.collectFeatures('updated',true),
    delete: this._editBuffer.collectFeatures('deleted',true),
    relationsattributes: this._editBuffer.collectRelationsAttributes(),
    lockids: lockIds
  }
};

proto.setFieldsWithAttributes = function(feature,fields,relations){
  var attributes = {};
  _.forEach(fields,function(field){
    attributes[field.name] = field.value;
  });
  
  var relationsAttributes = null;
  if (relations){
    var relationsAttributes = {};
    _.forEach(relations,function(relation,relationKey){
      var attributes = {};
      _.forEach(relation.fields,function(field){
        attributes[field.name] = field.value;
      });
      relationsAttributes[relationKey] = attributes;
    });
  }
  feature.setProperties(attributes);
  this._editBuffer.updateAttributes(feature,relationsAttributes);
};

proto.setAttributes = function(feature,attributes){
  feature.setProperties(attributes);
  this._editBuffer.updateAttributes(feature);
};

proto.getRelationsWithAttributes = function(feature){
  var fid = feature.getId();
  if (this._vectorLayer.hasRelations()){
    var fieldsPromise;
    // se non ha fid vuol dire che è nuovo e senza attributi, quindi prendo i fields vuoti
    if (!fid){
      fieldsPromise = this._vectorLayer.getRelationsWithAttributes();
    }
    // se per caso ha un fid ma è un vettoriale nuovo
    else if (!this._vectorLayer.getFeatureById(fid)){
      // se questa feature, ancora non presente nel vectorLayer, ha comunque i valori delle FKs popolate, allora le estraggo
      if (this._vectorLayer.featureHasRelationsFksWithValues(feature)){
        var fks = this._vectorLayer.getRelationsFksWithValuesForFeature(feature);
        fieldsPromise = this._vectorLayer.getRelationsWithAttributesFromFks(fks);
      }
      // altrimenti prendo i fields vuoti
      else {
        fieldsPromise = this._vectorLayer.getRelationsWithAttributes();
      }
    }
    // se invece è un vettoriale preesistente controllo intanto se ha dati delle relazioni già editati
    else {    
      var hasEdits = this._editBuffer.areFeatureRelationsEdited(fid);
      if (hasEdits){
        var relations = this._vectorLayer.getRelations();
        var relationsAttributes = this._editBuffer.getRelationsAttributes(fid);
        _.forEach(relationsAttributes,function(relation,relationKey){
          _.forEach(relations[relationKey].fields,function(field){
            field.value = relationsAttributes[relationKey][field.name];
          });
        });
        
        fieldsPromise = resolve(relations);
      }
      // se non ce li ha vuol dire che devo caricare i dati delle relazioni da remoto
      else {
        fieldsPromise = this._vectorLayer.getRelationsWithAttributes(fid);
      }
    }
  }
  else {
    fieldsPromise = resolve(null);
  }
  return fieldsPromise;
};

proto.getField = function(name,fields){
  var fields = fields || this.getVectorLayer().getFieldsWithAttributes();
  var field = null;
  _.forEach(fields,function(f){
    if (f.name == name){
      field = f;
    }
  })
  return field;
};

proto.isDirty = function(){
  return this._dirty;
};

proto.onafter = function(setter,listener){
  this._onaftertoolaction(setter,listener);
};

// permette di inserire un setter listener sincrono prima che venga effettuata una operazione da un tool (es. addfeature)
proto.onbefore = function(setter,listener){
  this._onbeforetoolaction(setter,listener,false);
};

// come onbefore() ma per listener asincroni
proto.onbeforeasync = function(setter,listener){
  this._onbeforetoolaction(setter,listener,true);
};

proto.addFeature = function(feature){
  this._editBuffer.addFeature(feature);
};

proto.updateFeature = function(feature){
  this._editBuffer.updateFeature(feature);
};

proto.deleteFeature = function(feature){
  this._editBuffer.deleteFeature(feature);
};

proto.getVectorLayer = function(){
  return this._vectorLayer;
};

proto.getEditVectorLayer = function(){
  return this._editVectorLayer;
};

proto.generateId = function(){
  return this._newPrefix+Date.now();
};

proto.isNewFeature = function(fid){
  if (fid) {
    return fid.toString().indexOf(this._newPrefix) == 0;
  }
  return true;
};

/*proto.isNewFeature = function(fid){
  if (fid) {
    if(!this.getVectorLayer().getFeatureById(fid)){
      return true;
    }
    return false;
  }
  else {
    return true
  }
};*/

proto._isCompatibleType = function(geometrytype){
  return this._geometrytypes.indexOf(geometrytype) > -1;
};

proto._setToolsForVectorType = function(geometrytype){
  var self = this;
  var tools = this._toolsForGeometryTypes[geometrytype];
  _.forEach(tools,function(toolClass,tool){
    self._tools[tool] = toolClass;
  })
};

proto._onaftertoolaction = function(setter,listener){
  if (!_.get(this._setterslisteners.after,setter)){
    this._setterslisteners.after[setter] = [];
  }
  this._setterslisteners.after[setter].push({
    fnc: listener
  });
}

proto._onbeforetoolaction = function(setter,listener,async){
  if (!_.get(this._setterslisteners.before,setter)){
    this._setterslisteners.before[setter] = [];
  }
  this._setterslisteners.before[setter].push({
    fnc: listener,
    how: async ? 'async' : 'sync'
  });
}

// una volta istanziato il tool aggiungo a questo tutti i listener definiti a livello di editor
proto._setToolSettersListeners = function(tool,settersListeners){
  _.forEach(settersListeners.before,function(listeners,setter){
    if (_.hasIn(tool.setters,setter)){
      _.forEach(listeners,function(listener){
        if (listener.how == 'sync'){
          tool.onbefore(setter,listener.fnc);
        }
        else {
          tool.onbeforeasync(setter,listener.fnc);
        }
      })
    }
  });
  
  _.forEach(settersListeners.after,function(listeners,setter){
    if (_.hasIn(tool.setters,setter)){
      _.forEach(listeners,function(listener){
          tool.onafter(setter,listener.fnc);
      })
    }
  })
};

proto._setStarted = function(bool){
  this._started = bool;
};

proto._setDirty = function(bool){
  if (_.isNil(bool)){
    this._dirty = true;
  }
  else {
    this._dirty = bool;
  }
  this.emit("dirty",this._dirty);
};

},{"./editbuffer":18,"./tools/addfeaturetool":20,"./tools/cutlinetool":21,"./tools/deletefeaturetool":23,"./tools/modifyfeaturetool":24,"./tools/movepointtool":25,"./tools/pickfeaturetool":26,"core/g3wobject":28,"core/layer/vectorlayer":35,"core/utils/utils":49,"gui/gui":71}],20:[function(require,module,exports){
var inherit = require('core/utils/utils').inherit;
var base = require('core/utils/utils').base;
var G3WObject = require('core/g3wobject');
var GUI = require('gui/gui');

function AddFeatureTool(editor,options){
  var self = this;
  var options = options || {};
  this._running = false;
  this._busy = false;
  this.editor = editor;
  this.source = editor.getEditVectorLayer().getLayer().getSource();
  this.isPausable = true;
  
  this.drawInteraction = null;
  this._snap = options.snap || null;
  this._snapInteraction = null; 
  
  this._finishCondition = options.finishCondition || _.constant(true);
  
  this._condition = options.condition || _.constant(true);
  
  // qui si definiscono i metodi che vogliamo poter intercettare, ed eventualmente bloccare (vedi API G3WObject)
  this.setters = {
    addFeature: {
      fnc: AddFeatureTool.prototype._addFeature,
      fallback: AddFeatureTool.prototype._fallBack
    }
  };
  
  base(this);
}
inherit(AddFeatureTool,G3WObject);
module.exports = AddFeatureTool;

var proto = AddFeatureTool.prototype;

// metodo eseguito all'avvio del tool
proto.run = function(){
  var self = this;
  var map = GUI.getComponent('map').getService().viewer.map;
  
  this.drawInteraction = new ol.interaction.Draw({
    type: this.editor.getEditVectorLayer().geometrytype,
    source: this.source,
    condition: this._condition,
    finishCondition: this._finishCondition // disponibile da https://github.com/openlayers/ol3/commit/d425f75bea05cb77559923e494f54156c6690c0b
  });
  map.addInteraction(this.drawInteraction);
  this.drawInteraction.setActive(true);
  
  this.drawInteraction.on('drawstart',function(e){
    self.editor.emit('drawstart',e);
  });
  
  this.drawInteraction.on('drawend',function(e){
    self.editor.emit('drawend',e);
    if (!self._busy){
      self._busy = true;
      self.pause();
      self.addFeature(e.feature);
    }
  });
  
  if (this._snap){
    this._snapInteraction = new ol.interaction.Snap({
      source: this._snap.vectorLayer.getSource()
    });
    map.addInteraction(this._snapInteraction);
  }
};

proto.pause = function(pause){
  if (_.isUndefined(pause) || pause){
    if (this._snapInteraction){
      this._snapInteraction.setActive(false);
    }
    this.drawInteraction.setActive(false);
  }
  else {
    if (this._snapInteraction){
      this._snapInteraction.setActive(true);
    }
    this.drawInteraction.setActive(true);
  }
};

// metodo eseguito alla disattivazione del tool
proto.stop = function(){
  var map = GUI.getComponent('map').getService().viewer.map;
  if (this._snapInteraction){
     map.removeInteraction(this._snapInteraction);
     this._snapInteraction = null;
  }
  map.removeInteraction(this.drawInteraction);
  this.drawInteraction = null;
  return true;
};

proto.removeLastPoint = function(){
  if (this.drawInteraction){
    // provo a rimuovere l'ultimo punto. Nel caso non esista la geometria gestisco silenziosamente l'errore
    try{
      this.drawInteraction.removeLastPoint();
    }
    catch (e){
      //
    }
  }
};

proto._addFeature = function(feature){
  // aggiungo la geometria nell'edit buffer
  this.editor.addFeature(feature);
  this._busy = false;
  this.pause(false);
  return true;
};

proto._fallBack = function(feature){
  this._busy = false;
  // rimuovo l'ultima feature inserita, ovvero quella disegnata ma che non si vuole salvare
  this.source.getFeaturesCollection().pop();
  this.pause(false);
};

},{"core/g3wobject":28,"core/utils/utils":49,"gui/gui":71}],21:[function(require,module,exports){
var inherit = require('core/utils/utils').inherit;
var base = require('core/utils/utils').base;
var geom = require('core/geometry/geom');
var PickFeatureInteraction = require('g3w-ol3/src/interactions/pickfeatureinteraction');
var PickCoordinatesInteraction = require('g3w-ol3/src/interactions/pickcoordinatesinteraction');
var GUI = require('gui/gui');

var EditingTool = require('./tool');

function CutLineTool(editor,options){
  this.setters = {
    cutLine: CutLineTool.prototype._cutLine
  };
  
  base(this,editor,options);
  
  var self = this;
  this.isPausable = true;
  this.steps = new EditingTool.Steps(CutLineTool.steps);
  
  this._origFeature = null;
  this._origGeometry = null;
  this._newFeatures = [];
  this._linePickInteraction = null;
  this._pointPickInteraction = null;
  this._selectLineToKeepInteraction = null;
  this._pointLayer = options.pointLayer || null;
  this._minCutPointDistance = options.minCutPointDistance || Infinity;
  this._modType = options.modType || 'MODONCUT'; // 'NEWONCUT' | 'MODONCUT'
  
  this._selectedLineOverlay = new ol.layer.Vector({
    source: new ol.source.Vector(),
    style: new ol.style.Style({
      stroke: new ol.style.Stroke({
        color: 'rgb(255,255,0)',
        width: 4
      })
    })
  });
  
  //var cutLineIdx = 0;
  //var cutLineColors = ['rgb(255,0,0)','rgb(0,0,255)']
  this._lineToKeepOverlay = new ol.layer.Vector({
    source: new ol.source.Vector(),
    /*style: function(feature){ 
      cutLineIdx += 1;
      return [new ol.style.Style({
        stroke: new ol.style.Stroke({
          color: cutLineColors[cutLineIdx%2],
          width: 4
        })
      })]
    }*/
  });

  
}
inherit(CutLineTool,EditingTool);
module.exports = CutLineTool;

var proto = CutLineTool.prototype;

proto.run = function(){
  var self = this;
  
  this._linePickInteraction = new PickFeatureInteraction({
    layers: [this.layer,this.editingLayer]
  });
  
  this.map.addInteraction(this._linePickInteraction);
  
  // seleziono la linea da tagliare
  self.steps.next();
  this._linePickInteraction.on('picked',function(e){
    var cutFeature;
    var feature = self._origFeature = e.feature;
    self._origGeometry = feature.getGeometry().clone();
    self._showSelection(self._origGeometry,300);
    self.map.removeInteraction(this);

    
    if (self._pointLayer){
      self._pointPickInteraction = new PickFeatureInteraction({
        layers: [self._pointLayer]
      });
    }
    else {
      self._pointPickInteraction = new PickCoordinatesInteraction();
    }
    
    // pesco coordinata o feature di taglio selezionata
    self.steps.next();
    self._pointPickInteraction.on('picked',function(e){
      self.map.removeInteraction(this);
      var coordinate;
      if (e.feature){
        cutFeature = e.feature;
        coordinate = cutFeature.getGeometry().getCoordinates();
      }
      else {
        coordinate = e.coordinate;
      }
      if (coordinate){
        // snappo sulla linea
        var closestCoordinate = feature.getGeometry().getClosestPoint(coordinate);
        var distance = geom.distance(coordinate,closestCoordinate);
        // se lo snap è entro la tolleranza
        if (distance < self._minCutPointDistance){
          // taglio la linea e ottengo l'array con le due nuove feature
          var slicedLines = self._cut(feature.getGeometry(),closestCoordinate);
          if (slicedLines){
            var prevLineFeature = slicedLines[0];
            var nextLineFeature = slicedLines[1];
            
            var newId = self.editor.generateId();
            prevLineFeature.setId(newId+'_1');
            nextLineFeature.setId(newId+'_2');
            
            // prendo le proprietà della feature originale (esclusa la geometria)
            var origProperties = feature.getProperties();
            delete origProperties[feature.getGeometryName()];
            
            self._showSelection(prevLineFeature.getGeometry(),300);
            setTimeout(function(){
              self._showSelection(nextLineFeature.getGeometry(),300);
            },300)
            
            // nel caso di modifica su taglio
            if (self._modType == 'MODONCUT'){
              // seleziono la porzione da mantenere/modificare
              self.steps.next();
              self._selectLineToKeep(prevLineFeature,nextLineFeature)
              .then(function(featureToKeep){
                // aggiorno la feature originale con la geometria della feature che si è selezionato da mantenere
                feature.setGeometry(featureToKeep.getGeometry().clone());
                
                var featureToAdd;
                
                // rimuovo una delle due nuove feature e mi tengo l'unica feature da aggiungere come nuova
                if (prevLineFeature.getId() == featureToKeep.getId()){
                  delete prevLineFeature;
                  featureToAdd = nextLineFeature;
                }
                else if (nextLineFeature.getId() == featureToKeep.getId()){
                  delete nextLineFeature;
                  featureToAdd = prevLineFeature;
                }
                
                self._newFeatures.push(featureToAdd);
                
                // tramite l'editor assegno alla nuova feature gli stessi attributi dell'altra, originale, modificata
                featureToAdd.setProperties(origProperties);
                // e la aggiungo al layer di editing, così mi viene mostrata come nuova feature sulla mappa
                self.editingLayer.getSource().addFeatures([featureToAdd]);
                
                var data = {
                  added: [featureToAdd],
                  updated: feature,
                  cutfeature:cutFeature
                }
                
                // a questo punto avvio il setter, che si occuperò di aggiornare l'editbuffer a seconda del tipo di modifica
                self.cutLine(data,self._modType)
                .fail(function(){
                  self._rollBack();
                  self.rerun();
                })
              })
            }
            else {
              // nel caso la modifica sia aggiungo su taglia, allora rimuovo l'originale e aggiungo le due nuove feature
              self.layer.getSource().removeFeature(feature);
              //self.editor.setAttributes(prevLineFeature,origProperties);
              //self.editor.setAttributes(nextLineFeature,origProperties);
              self._newFeatures.push(prevLineFeature);
              self._newFeatures.push(nextLineFeature);
              self.editingLayer.getSource().addFeatures([featureToAdd,prevLineFeature]);
              
              var data = {
                added: [prevLineFeature,nextLineFeature],
                removed: feature
              }
              
              self.cutLine(data,self._modType)
              .fail(function(){
                self._rollBack();
                self.rerun();
              })
            }
          }
          else {
            self.rerun();
          }
        }
      }
    })
    self.map.addInteraction(self._pointPickInteraction);
  });
};

proto.pause = function(pause){
  if (_.isUndefined(pause) || pause){
    this._linePickInteraction.setActive(false);
    this._pointPickInteraction.setActive(false);
  }
  else {
    this._linePickInteraction.setActive(true);
    this._pointPickInteraction.setActive(true);
  }
};

proto.rerun = function(){
  this.stop();
  this.run();
};

proto.stop = function(){
  this._cleanUp();
  
  var stop = EditingTool.prototype.stop.call(this);
  
  if (stop) {
    this.map.removeInteraction(this._linePickInteraction);
    this.map.removeInteraction(this._pointPickInteraction);
    this._linePickInteraction = null;
    this._pointPickInteraction = null;
  }

  return stop;
};

proto._cleanUp = function(){
  this._origFeature = null;
  this._origGeometry = null;
  this._newFeatures = [];
  this._lineToKeepOverlay.setMap(null);
  this._selectedLineOverlay.setMap(null);
};

proto._rollBack = function(){
  // rimetto la vecchia geometria
  this._origFeature.setGeometry(this._origGeometry);
  // rimuovo le feature (nuove) editate dal layer di editazione
  try {
    _.forEach(this._newFeatures,function(feature){
      self.editingLayer.getSource().removeFeature(feature);
    });
  }
  catch (e) {};
};

proto._cutLine = function(data,modType){
  // se modifico su taglio aggiorno la vecchia feature e aggiungo la nuova
  if (modType == 'MODONCUT'){
    var featureToUpdate = data.updated;
    var featureToAdd = data.added[0];
    this.editor.updateFeature(featureToUpdate);
    this.editor.addFeature(featureToAdd);
  }
  // altrimenti rimuovo la vecchia e aggiungo le nuove
  else{
    var featureToRemove = data.removed;
    var featureToAdd1 = data.added[0];
    var featureToAdd2 = data.added[1];
    this.editor.deleteFeature(featureToRemove);
    this.editor.addFeature(featureToAdd1);
    this.editor.addFeature(featureToAdd2);
  }
  this._busy = false;
  this.pause(false);
  this.steps.completed();
  this.rerun();
  return true;
};

proto._selectLineToKeep = function(prevLineFeature,nextLineFeature){
  var d = $.Deferred();
  var self = this;
  var layer = this._lineToKeepOverlay;
  layer.getSource().addFeatures([prevLineFeature,nextLineFeature]);
  layer.setMap(this.map);
  
  var selectLineInteraction = new PickFeatureInteraction({
    layers: [this._lineToKeepOverlay],
  });
  this.map.addInteraction(selectLineInteraction);
  
  selectLineInteraction.on('picked',function(e){
    layer.setMap(null);
    self.map.removeInteraction(this);
    d.resolve(e.feature);
  });
  
  return d.promise();
};

proto._fallBack = function(feature){
  this._busy = false;
  this.pause(false);
};

proto._cut = function(geometry,cutCoordinate){
  while (cutCoordinate.length < geometry.getStride()) {
    cutCoordinate.push(0);
  }

  var minDistance = Infinity;
  var closestIndex = 0;
  var index = 0;
  // cerco l'indice del segmento lineare su cui ricade la coordinata di taglio
  geometry.forEachSegment(function(v0,v1){
    var segmentPoint = geom.closestOnSegment(cutCoordinate,[v0,v1]);
    var distance = geom.distance(cutCoordinate,segmentPoint);
    if (distance < minDistance){
      minDistance = distance;
      closestIndex = index;
    }
    index += 1;
  })
  
  var coordinates = geometry.getCoordinates();
  // prendo la prima porzione di coordinate
  var prevCoords = coordinates.slice(0,closestIndex+1);
  // aggiungo la coordinata di taglio alla prima porzione
  prevCoords.splice(prevCoords.length,0,cutCoordinate);
  // prendo la seconda porzione di coordinate
  var nextCoords = coordinates.slice(closestIndex);
  // aggiungo la coordinata di taglio alla seconda porzione
  nextCoords.splice(0,1,cutCoordinate);
  
  if (prevCoords.length < 2 || nextCoords.length < 2){
    return false;
  }
  
  // creo le geometrie
  var prevLine = new ol.geom.LineString();
  prevLine.setCoordinates(prevCoords);
  var nextLine = new ol.geom.LineString();
  nextLine.setCoordinates(nextCoords);
  
  // creo le nuove feature
  var prevLineFeat = new ol.Feature({
    geometry: prevLine
  });
  var nextLineFeat = new ol.Feature({
    geometry: nextLine
  });
  
  return [prevLineFeat,nextLineFeat];
};


// TODO questo andrà spostato dentro MapService o comunque in una libreria core
proto._showSelection = function(geometry,duration){
  var self = this;
  var duration = duration || null;
  var overlay = this._selectedLineOverlay;
  
  var feature = new ol.Feature();
  feature.setGeometry(geometry);
  overlay.getSource().addFeatures([feature]);
  overlay.setMap(this.map);
  if(duration){
    setTimeout(function(){
      overlay.setMap(null);
      self._selectedLineOverlay.getSource().clear();
    },duration);
  }
};

proto._isNew = function(feature){
  return (!_.isNil(this.editingLayer.getSource().getFeatureById(feature.getId())));
};

CutLineTool.steps = [
  {
    type: "selectline"
  },
  {
    type: "selectcutpoint"
  },
  {
    type: "selectparttokeep"
  }
]

},{"./tool":27,"core/geometry/geom":29,"core/utils/utils":49,"g3w-ol3/src/interactions/pickcoordinatesinteraction":56,"g3w-ol3/src/interactions/pickfeatureinteraction":57,"gui/gui":71}],22:[function(require,module,exports){
var DeleteInteractionEvent = function(type, features, coordinate) {

  this.type = type;
  this.features = features;
  this.coordinate = coordinate;
};

var DeleteInteraction = function(options) {
  ol.interaction.Pointer.call(this, {
    handleDownEvent: DeleteInteraction.handleDownEvent_,
    handleMoveEvent: DeleteInteraction.handleMoveEvent_,
    handleUpEvent: DeleteInteraction.handleUpEvent_,
    handleEvent: DeleteInteraction.handleEvent_,
  });

  this.previousCursor_ = undefined;
  this.lastCoordinate_ = null;
  this.features_ = options.features !== undefined ? options.features : null;
};
ol.inherits(DeleteInteraction, ol.interaction.Pointer);

DeleteInteraction.handleEvent_ = function(mapBrowserEvent) {
  if (mapBrowserEvent.type == 'keydown'){
    if(this.features_.getArray().length && mapBrowserEvent.originalEvent.keyCode == 46){
      this.dispatchEvent(
          new DeleteInteractionEvent(
              'deleteend', this.features_,
              event.coordinate));
      return true;
    }
  }
  else{
    return ol.interaction.Pointer.handleEvent.call(this,mapBrowserEvent);
  }
};

DeleteInteraction.handleDownEvent_ = function(event) {
  this.lastFeature_ = this.featuresAtPixel_(event.pixel, event.map);
  if (this.lastFeature_) {
    DeleteInteraction.handleMoveEvent_.call(this, event);
    this.dispatchEvent(
            new DeleteInteractionEvent(
                'deleteend', this.features_,
                event.coordinate));
    return true;
  }
  return false;
};

DeleteInteraction.handleMoveEvent_ = function(event) {
  var elem = event.map.getTargetElement();
  var intersectingFeature = event.map.forEachFeatureAtPixel(event.pixel,
      function(feature) {
        return feature;
      });

  if (intersectingFeature) {
    this.previousCursor_ = elem.style.cursor;

    elem.style.cursor =  'pointer';

  } else {
    elem.style.cursor = this.previousCursor_ !== undefined ?
        this.previousCursor_ : '';
    this.previousCursor_ = undefined;
  }
};

DeleteInteraction.prototype.featuresAtPixel_ = function(pixel, map) {
  var found = null;

  var intersectingFeature = map.forEachFeatureAtPixel(pixel,
      function(feature) {
        return feature;
      });

  if (this.features_ &&
     _.includes(this.features_.getArray(), intersectingFeature)) {
    found = intersectingFeature;
  }

  return found;
};

module.exports = DeleteInteraction;

},{}],23:[function(require,module,exports){
var inherit = require('core/utils/utils').inherit;
var base = require('core/utils/utils').base;
var G3WObject = require('core/g3wobject');
var GUI = require('gui/gui');

var DeleteInteraction = require('./deletefeatureinteraction');

function DeleteFeatureTool(editor){
  var self = this;
  this.editor = editor;
  this.isPausable = true;
  this.drawInteraction = null;
  this.layer = null;
  this.editingLayer = null;

  this.setters = {
    deleteFeature: DeleteFeatureTool.prototype._deleteFeature
  };
  
  base(this);
}
inherit(DeleteFeatureTool,G3WObject);
module.exports = DeleteFeatureTool;

var proto = DeleteFeatureTool.prototype;

/* BRUTTISSIMO! Tocca ridefinire tutte le parti interne di OL3 non esposte dalle API */

ol.geom.GeometryType = {
  POINT: 'Point',
  LINE_STRING: 'LineString',
  LINEAR_RING: 'LinearRing',
  POLYGON: 'Polygon',
  MULTI_POINT: 'MultiPoint',
  MULTI_LINE_STRING: 'MultiLineString',
  MULTI_POLYGON: 'MultiPolygon',
  GEOMETRY_COLLECTION: 'GeometryCollection',
  CIRCLE: 'Circle'
};

var styles = {};
var white = [255, 255, 255, 1];
var blue = [0, 153, 255, 1];
var red = [255, 0, 0, 1];
var width = 3;
styles[ol.geom.GeometryType.POLYGON] = [
  new ol.style.Style({
    fill: new ol.style.Fill({
      color: [255, 255, 255, 0.5]
    })
  })
];
styles[ol.geom.GeometryType.MULTI_POLYGON] =
    styles[ol.geom.GeometryType.POLYGON];

styles[ol.geom.GeometryType.LINE_STRING] = [
  new ol.style.Style({
    stroke: new ol.style.Stroke({
      color: white,
      width: width + 2
    })
  }),
  new ol.style.Style({
    stroke: new ol.style.Stroke({
      color: red,
      width: width
    })
  })
];
styles[ol.geom.GeometryType.MULTI_LINE_STRING] =
    styles[ol.geom.GeometryType.LINE_STRING];

styles[ol.geom.GeometryType.CIRCLE] =
    styles[ol.geom.GeometryType.POLYGON].concat(
        styles[ol.geom.GeometryType.LINE_STRING]
    );


styles[ol.geom.GeometryType.POINT] = [
  new ol.style.Style({
    image: new ol.style.Circle({
      radius: width * 2,
      fill: new ol.style.Fill({
        color: red
      }),
      stroke: new ol.style.Stroke({
        color: white,
        width: width / 2
      })
    }),
    zIndex: Infinity
  })
];
styles[ol.geom.GeometryType.MULTI_POINT] =
    styles[ol.geom.GeometryType.POINT];

styles[ol.geom.GeometryType.GEOMETRY_COLLECTION] =
    styles[ol.geom.GeometryType.POLYGON].concat(
        styles[ol.geom.GeometryType.LINE_STRING],
        styles[ol.geom.GeometryType.POINT]
    );


styles[ol.geom.GeometryType.POLYGON] = _.concat(styles[ol.geom.GeometryType.POLYGON],styles[ol.geom.GeometryType.LINE_STRING]);
styles[ol.geom.GeometryType.GEOMETRY_COLLECTION] = _.concat(styles[ol.geom.GeometryType.GEOMETRY_COLLECTION],styles[ol.geom.GeometryType.LINE_STRING]);
    
/* FINE BRUTTISSIMO! */

proto.run = function(){
  var self = this;
  var map = GUI.getComponent('map').getService().viewer.map;
  this.layer = this.editor.getVectorLayer().getLayer();
  this.editingLayer = this.editor.getEditVectorLayer().getLayer();
  
  this._selectInteraction = new ol.interaction.Select({
    layers: [this.layer,this.editingLayer],
    condition: ol.events.condition.click,
    style: function(feature, resolution) {
      return styles[feature.getGeometry().getType()];
    }
  });
  map.addInteraction(this._selectInteraction);
  
  this._deleteInteraction = new DeleteInteraction({
    features: this._selectInteraction.getFeatures()
  });
  map.addInteraction(this._deleteInteraction);
  
  var origGeometry = null;
  
  /*this._selectInteraction.on('select',function(e){
    var feature = e.selected[0];
    origGeometry = feature.getGeometry();
  });*/
  
  this._deleteInteraction.on('deleteend',function(e){
    var feature = e.features.getArray()[0];
    var isNew = self._isNew(feature);
    //try {
      if (!self._busy){
        self._busy = true;
        self.pause(true);
        self.deleteFeature(feature,isNew)
        .always(function(){
          self._busy = false;
          self.pause(false);
        })
      }
    //}
    /*catch (error){
      console.log(error);
      feature.setGeometry(origGeometry);
    }*/
  });

};

proto.pause = function(pause){
  if (_.isUndefined(pause) || pause){
    this._selectInteraction.setActive(false);
    this._deleteInteraction.setActive(false);
  }
  else {
    this._selectInteraction.setActive(true);
    this._deleteInteraction.setActive(true);
  }
};

proto.stop = function(){
  var map = GUI.getComponent('map').getService().viewer.map;
  this._selectInteraction.getFeatures().clear();
  map.removeInteraction(this._selectInteraction);
  this._selectInteraction = null;
  map.removeInteraction(this._deleteInteraction);
  this._deleteInteraction = null;
  return true;
};

proto._deleteFeature = function(feature,isNew){
  this.editor.deleteFeature(feature,isNew);
  this._selectInteraction.getFeatures().clear();
  this._busy = false;
  this.pause(false);
  return true;
};

proto._fallBack = function(feature){
  this._busy = false;
  this.pause(false);
};

proto._isNew = function(feature){
  return (!_.isNil(this.editingLayer.getSource().getFeatureById(feature.getId())));
};

},{"./deletefeatureinteraction":22,"core/g3wobject":28,"core/utils/utils":49,"gui/gui":71}],24:[function(require,module,exports){
var inherit = require('core/utils/utils').inherit;
var base = require('core/utils/utils').base;
var G3WObject = require('core/g3wobject');
var GUI = require('gui/gui');

function ModifyFeatureTool(editor,options){
  var self = this;
  this.editor = editor;
  this.isPausable = true;
  this.drawInteraction = null;
  this.layer = null;
  this.editingLayer = null;
  this._deleteCondition = options.deleteCondition || undefined;
  this._snap = options.snap || null;
  this._snapInteraction = null; 

  this.setters = {
    modifyFeature: ModifyFeatureTool.prototype._modifyFeature
  };
  
  base(this);
}
inherit(ModifyFeatureTool,G3WObject);
module.exports = ModifyFeatureTool;

var proto = ModifyFeatureTool.prototype;

proto.run = function(){
  var self = this;
  var map = GUI.getComponent('map').getService().viewer.map;
  this.layer = this.editor.getVectorLayer().getLayer();
  this.editingLayer = this.editor.getEditVectorLayer().getLayer();
  
  this._selectInteraction = new ol.interaction.Select({
    layers: [this.layer,this.editingLayer],
  });
  map.addInteraction(this._selectInteraction);
  
  this._modifyInteraction = new ol.interaction.Modify({
    features: this._selectInteraction.getFeatures(),
    deleteCondition: this._deleteCondition,
  });
  map.addInteraction(this._modifyInteraction);
  
  var origGeometry = null;
  
  this._modifyInteraction.on('modifystart',function(e){
    var feature = e.features.getArray()[0];
    origGeometry = feature.getGeometry().clone();
  });
  
  this._modifyInteraction.on('modifyend',function(e){
    var feature = e.features.getArray()[0];
    var isNew = self._isNew(feature);
    //try {
      if (!self._busy){
        self._busy = true;
        self.pause(true);
        self.modifyFeature(feature,isNew)
        .fail(function(){
          feature.setGeometry(origGeometry);
        })
        .always(function(){
          self._busy = false;
          self.pause(false);
        })
      }
    //}
    //catch (error){
    //  console.log(error);
    //  feature.setGeometry(origGeometry);
    //}
  });
  
  if (this._snap){
    this._snapInteraction = new ol.interaction.Snap({
      source: this._snap.vectorLayer.getSource()
    });
    map.addInteraction(this._snapInteraction);
  }
};

proto.pause = function(pause){
  if (_.isUndefined(pause) || pause){
    if (this._snapInteraction){
      this._snapInteraction.setActive(false);
    }
    this._selectInteraction.setActive(false);
    this._modifyInteraction.setActive(false);
  }
  else {
    if (this._snapInteraction){
      this._snapInteraction.setActive(true);
    }
    this._selectInteraction.setActive(true);
    this._modifyInteraction.setActive(true);
  }
};

proto.stop = function(){
  var map = GUI.getComponent('map').getService().viewer.map;
  this._selectInteraction.getFeatures().clear();
  if (this._snapInteraction){
     map.removeInteraction(this._snapInteraction);
     this._snapInteraction = null;
  }
  map.removeInteraction(this._selectInteraction);
  this._selectInteraction = null;
  map.removeInteraction(this._modifyInteraction);
  this._modifyInteraction = null;
  return true;
};

proto._modifyFeature = function(feature,isNew){
  // aggionro la geometria nel buffer di editing
  this.editor.updateFeature(feature,isNew);
  this._selectInteraction.getFeatures().clear();
  this._busy = false;
  this.pause(false);
  return true;
};

proto.removePoint = function(coordinate){
  if (this._modifyInteraction){
    // provo a rimuovere l'ultimo punto. Nel caso non esista la geometria gestisco silenziosamente l'errore
    try{
      this._modifyInteraction.removePoint();
    }
    catch (e){
      console.log(e);
    }
  }
};

proto._fallBack = function(feature){
  this._busy = false;
  this.pause(false);
};

proto._isNew = function(feature){
  return (!_.isNil(this.editingLayer.getSource().getFeatureById(feature.getId())));
};

},{"core/g3wobject":28,"core/utils/utils":49,"gui/gui":71}],25:[function(require,module,exports){
var inherit = require('core/utils/utils').inherit;
var base = require('core/utils/utils').base;
var G3WObject = require('core/g3wobject');
var GUI = require('gui/gui');

function MoveFeatureTool(editor){
  var self = this;
  this.editor = editor;
  this.isPausable = true;
  this.drawInteraction = null;
  this.layer = null;
  this.editingLayer = null;
  
  this._origGeometry = null;

  this.setters = {
    moveFeature: {
      fnc: MoveFeatureTool.prototype._moveFeature,
      fallback: MoveFeatureTool.prototype._fallBack
    }
  };
  
  base(this);
}
inherit(MoveFeatureTool,G3WObject);
module.exports = MoveFeatureTool;

var proto = MoveFeatureTool.prototype;

proto.run = function(){
  var self = this;
  var map = GUI.getComponent('map').getService().viewer.map;
  this.layer = this.editor.getVectorLayer().getLayer();
  this.editingLayer = this.editor.getEditVectorLayer().getLayer();
  
  this._selectInteraction = new ol.interaction.Select({
    layers: [this.layer,this.editingLayer],
    condition: ol.events.condition.click
  });
  map.addInteraction(this._selectInteraction);
  
  this._translateInteraction = new ol.interaction.Translate({
    features: this._selectInteraction.getFeatures()
  });
  map.addInteraction(this._translateInteraction);
  
  this._translateInteraction.on('translatestart',function(e){
    var feature = e.features.getArray()[0];
    self._origGeometry = feature.getGeometry().clone();
    self.editor.emit('movestart',feature);
  });
  
  this._translateInteraction.on('translateend',function(e){
    var feature = e.features.getArray()[0];
    //try {
      if (!self._busy){
        self._busy = true;
        self.pause();
        self.moveFeature(feature)
        .then(function(res){
          self.pause(false);
        })
        .fail(function(){
          feature.setGeometry(self._origGeometry);
        });
      }
    //}
    /*catch (error){
      console.log(error);
      feature.setGeometry(self._origGeometry);
    }*/
  });

};

proto.pause = function(pause){
  if (_.isUndefined(pause) || pause){
    this._selectInteraction.setActive(false);
    this._translateInteraction.setActive(false);
  }
  else {
    this._selectInteraction.setActive(true);
    this._translateInteraction.setActive(true);
  }
};

proto.stop = function(){
  var map = GUI.getComponent('map').getService().viewer.map;
  this._selectInteraction.getFeatures().clear();
  map.removeInteraction(this._selectInteraction);
  this._selectInteraction = null;
  map.removeInteraction(this._translateInteraction);
  this._translateInteraction = null;
  return true;
};

proto._moveFeature = function(feature){
  this.editor.emit('moveend',feature);
  this.editor.updateFeature(feature);
  this._selectInteraction.getFeatures().clear();
  this._busy = false;
  this.pause(false);
  return true;
};

proto._fallBack = function(feature){
  this._busy = false;
  this.pause(false);
};

},{"core/g3wobject":28,"core/utils/utils":49,"gui/gui":71}],26:[function(require,module,exports){
var inherit = require('core/utils/utils').inherit;
var base = require('core/utils/utils').base;
var noop = require('core/utils/utils').noop;
var G3WObject = require('core/g3wobject');
var PickFeatureInteraction = require('g3w-ol3/src/interactions/pickfeatureinteraction');
var GUI = require('gui/gui');

function PickFeatureTool(editor){
  var self = this;
  this.editor = editor;
  this.isPausable = true;
  this.pickFeatureInteraction = null;
  this._running = false;
  this._busy = false;
  
  // qui si definiscono i metodi che vogliamo poter intercettare, ed eventualmente bloccare (vedi API G3WObject)
  this.setters = {
    pickFeature: noop,
  };
  
  base(this);
}
inherit(PickFeatureTool,G3WObject);
module.exports = PickFeatureTool;

var proto = PickFeatureTool.prototype;

// metodo eseguito all'avvio del tool
proto.run = function(){
  var self = this;
  //var map = MapService.viewer.map;
  var layers = [this.editor.getVectorLayer().getLayer(),this.editor.getEditVectorLayer().getLayer()];
  
  this.pickFeatureInteraction = new PickFeatureInteraction({
    layers: layers
  });
  
  this.pickFeatureInteraction.on('picked',function(e){
    if (!self._busy){
      self._busy = true;
      self.pause(true);
      self.pickFeature(e.feature)
      .then(function(res){
        self._busy = false;
        self.pause(false);
      })
    }
  });
  
  //map.addInteraction(this.pickFeatureInteraction);
  //this.pickFeatureInteraction.setActive(true);
  var mapService = GUI.getComponent('map').getService();
  mapService.pushInteraction(this.pickFeatureInteraction);
};

proto.pause = function(pause){
  if (_.isUndefined(pause) || pause){
    this.pickFeatureInteraction.setActive(false);
  }
  else {
    this.pickFeatureInteraction.setActive(true);
  }
};

// metodo eseguito alla disattivazione del tool
proto.stop = function(){
  GUI.getComponent('map').getService().popInteraction();
  return true;
};

proto._fallBack = function(feature){
  this._busy = false;
  this.pause(false);
};

},{"core/g3wobject":28,"core/utils/utils":49,"g3w-ol3/src/interactions/pickfeatureinteraction":57,"gui/gui":71}],27:[function(require,module,exports){
var inherit = require('core/utils/utils').inherit;
var base = require('core/utils/utils').base;
var G3WObject = require('core/g3wobject');

function EditingTool(editor,options){
  this.editor = editor;
  this.layer = this.editor.getVectorLayer().getLayer();
  this.editingLayer = this.editor.getEditVectorLayer().getLayer();
  this.map = GUI.getComponent('map').getService().viewer.map;
  this.isPausable = false;
  this.options = options || {};
  this.steps = null;
  
  base(this);
}
inherit(EditingTool,G3WObject);

var proto = EditingTool.prototype;

proto.stop = function(){
  if (this.steps) {
    this.steps.destroy();
  }
  return true;
}

EditingTool.Steps = function(steps){
  var index = -1;
  var steps = steps;
  
  this.next = function(){
    index += 1;
    var step = steps[index];
    this.emit('step',index,step);
  };
  
  this.currentStep = function(){
    return steps[index];
  };
  
  this.currentStepIndex = function(){
    return index;
  };
  
  this.totalSteps = function(){
    return steps.length;
  };
  
  this.reset = function(){
    index = 0;
  };
  
  this.destroy = function(){
    this.removeAllListeners();
  };
  
  this.completed = function(){
    this.emit('complete');
    this.reset();
  };
  
  this.insertStepAt = function(idx,step){
    steps.splice(idx,0,step);
  }
}
inherit(EditingTool.Steps,G3WObject);

module.exports = EditingTool

},{"core/g3wobject":28,"core/utils/utils":49}],28:[function(require,module,exports){
var inherit = require('core/utils/utils').inherit;
var noop = require('core/utils/utils').noop;

/**
 * Un oggetto base in grado di gestire eventuali setter e relativa catena di listeners.
 * @constructor
 */
var G3WObject = function(){
  if (this.setters){
    this._setupListenersChain(this.setters);
  }
};
inherit(G3WObject,EventEmitter);

var proto = G3WObject.prototype;

/**
 * Inserisce un listener dopo che è stato eseguito il setter
 * @param {string} setter - Il nome del metodo su cui si cuole registrare una funzione listener
 * @param {function} listener - Una funzione listener (solo sincrona)
 */
proto.onafter = function(setter,listener){
  return this._onsetter('after',setter,listener,false);
};

// un listener può registrarsi in modo da essere eseguito PRIMA dell'esecuzione del metodo setter. Può ritornare true/false per
// votare a favore o meno dell'esecuzione del setter. Se non ritorna nulla o undefined, non viene considerato votante
/**
 * Inserisce un listener prima che venga eseguito il setter. Se ritorna false il setter non viene eseguito
 * @param {string} setter - Il nome del metodo su cui si cuole registrare una funzione listener
 * @param {function} listener - Una funzione listener, a cui viene passato una funzione "next" come ultimo parametro, da usare nel caso di listener asincroni
 */
proto.onbefore = function(setter,listener){
  return this._onsetter('before',setter,listener,false);
};

/**
 * Inserisce un listener prima che venga eseguito il setter. Al listener viene passato una funzione "next" come ultimo parametro, da chiamare con parametro true/false per far proseguire o meno il setter
 * @param {string} setter - Il nome del metodo su cui si cuole registrare una funzione listener
 * @param {function} listener - Una funzione listener, a cui 
 */
proto.onbeforeasync = function(setter,listener){
  return this._onsetter('before',setter,listener,true);
};

proto.un = function(setter,key){
  _.forEach(this.settersListeners,function(settersListeners,when){
    _.forEach(settersListeners[setter],function(setterListener){
      if(setterListener.key == key){
        delete setterListener;
      }
    })
  })
};

proto._onsetter = function(when,setter,listener,async){ /*when=before|after, type=sync|async*/
  var settersListeners = this.settersListeners[when];
  var listenerKey = ""+Math.floor(Math.random()*1000000)+""+Date.now();
  /*if ((when == 'before') && !async){
    listener = this._makeChainable(listener);
  }*/
  settersListeners[setter].push({
    key: listenerKey,
    fnc: listener,
    async: async
  });
  return listenerKey;
  //return this.generateUnListener(setter,listenerKey);
};

// trasformo un listener sincrono in modo da poter essere usato nella catena di listeners (richiamando next col valore di ritorno del listener)
/*proto._makeChainable = function(listener){
  var self = this
  return function(){
    var args = Array.prototype.slice.call(arguments);
    // rimuovo next dai parametri prima di chiamare il listener
    var next = args.pop();
    var canSet = listener.apply(self,arguments);
    var _canSet = true;
    if (_.isBoolean(canSet)){
      _canSet = canSet;
    }
    next(canSet);
  }
};*/

proto._setupListenersChain = function(setters){
  // inizializza tutti i metodi definiti nell'oggetto "setters" della classe figlia.
  var self = this;
  this.settersListeners = {
    after:{},
    before:{}
  };
  // per ogni setter viene definito l'array dei listeners e fiene sostituito il metodo originale con la funzioni che gestisce la coda di listeners
  _.forEach(setters,function(setterOption,setter){
    var setterFnc = noop;
    var setterFallback = noop;
    if (_.isFunction(setterOption)){
      setterFnc = setterOption
    }
    else {
      setterFnc = setterOption.fnc;
      setterFallback = setterOption.fallback || noop;
    }
    self.settersListeners.after[setter] = [];
    self.settersListeners.before[setter] = [];
    // setter sostituito
    self[setter] = function(){
      var args = arguments;
      // eseguo i listener registrati per il before
      var deferred = $.Deferred();
      var returnVal = null;
      var counter = 0;
      var canSet = true;
      
      // richiamata alla fine della catena di listeners
      function done(){
        if(canSet){
          // eseguo la funzione
          returnVal = setterFnc.apply(self,args);
          // e risolvo la promessa (eventualmente utilizzata da chi ha invocato il setter
          deferred.resolve(returnVal);
          
          var afterListeners = self.settersListeners.after[setter];
          _.forEach(afterListeners,function(listener, key){
            listener.fnc.apply(self,args);
          })
        }
        else {
          // se non posso proseguire 
          // chiamo l'eventuale funzione di fallback
          setterFallback.apply(self,args);
          // e rigetto la promessa
          deferred.reject();
        }
      };
      
      function complete(){
        // eseguo la funzione
        returnVal = setterFnc.apply(self,args);
        // e risolvo la promessa (eventualmente utilizzata da chi ha invocato il setter
        deferred.resolve(returnVal);
        
        var afterListeners = self.settersListeners.after[setter];
        _.forEach(afterListeners,function(listener, key){
          listener.fnc.apply(self,args);
        })
      }
      
      function abort(){
          // se non posso proseguire ...
          // chiamo l'eventuale funzione di fallback
          setterFallback.apply(self,args);
          // e rigetto la promessa
          deferred.reject();
      }
      
      var beforeListeners = this.settersListeners['before'][setter];
      // contatore dei listener che verrà decrementato ad ogni chiamata a next()
      counter = 0;
      
      // funzione passata come ultimo parametro ai listeners, che ***SE SONO STATI AGGIUNTI COME ASINCRONI la DEVONO*** richiamare per poter proseguire la catena
      function next(bool){
        var cont = true;
        if (_.isBoolean(bool)){
          cont = bool;
        }
        var _args = Array.prototype.slice.call(args);
        // se la catena è stata bloccata o se siamo arrivati alla fine dei beforelisteners
        if (cont === false || (counter == beforeListeners.length)){
          if(cont === false)
            abort.apply(self,args);
          else{
            completed = complete.apply(self,args);
            if(_.isUndefined(completed) || completed === true){
              self.emitEvent('set:'+setter,args);
            }
          }
        }
        else {
          if (cont){
            var listenerFnc = beforeListeners[counter].fnc;
            if (beforeListeners[counter].async){
              // aggiungo next come ulitmo parametro
              _args.push(next);
              counter += 1;
              listenerFnc.apply(self,_args)
            }
            else {
              var _cont = listenerFnc.apply(self,_args);
              counter += 1;
              next(_cont);
            }
          }
        }
      }
      
      next();
      return deferred.promise();
    }
  })
};

/*
proto.generateUnListener = function(settersListeners,setter,listenerKey){
  var self = this;
  return function(){
    settersListeners[setter][listenerKey] = null;
    delete settersListeners[setter][listenerKey];
  }
};
*/

module.exports = G3WObject;

},{"core/utils/utils":49}],29:[function(require,module,exports){
var geom = {
  distance: function(c1,c2){
    return Math.sqrt(geom.squaredDistance(c1,c2));
  },
  squaredDistance: function(c1,c2){
    var x1 = c1[0];
    var y1 = c1[1];
    var x2 = c2[0];
    var y2 = c2[1];
    var dx = x2 - x1;
    var dy = y2 - y1;
    return dx * dx + dy * dy;
  },
  closestOnSegment: function(coordinate, segment) {
    var x0 = coordinate[0];
    var y0 = coordinate[1];
    var start = segment[0];
    var end = segment[1];
    var x1 = start[0];
    var y1 = start[1];
    var x2 = end[0];
    var y2 = end[1];
    var dx = x2 - x1;
    var dy = y2 - y1;
    var along = (dx === 0 && dy === 0) ? 0 :
        ((dx * (x0 - x1)) + (dy * (y0 - y1))) / ((dx * dx + dy * dy) || 0);
    var x, y;
    if (along <= 0) {
      x = x1;
      y = y1;
    } else if (along >= 1) {
      x = x2;
      y = y2;
    } else {
      x = x1 + along * dx;
      y = y1 + along * dy;
    }
    return [x, y];
  }
}

module.exports = geom;

},{}],30:[function(require,module,exports){
var Geometry = {};

Geometry.GeometryTypes = {
  POINT: "Point",
  MULTIPOINT: "MultiPoint",
  LINESTRING: "Line", // per seguire la definizione di QGis.GeometryType, che definisce Line invece di Linestring.
  MULTILINESTRING: "MultiLine",
  POLYGON: "Polygon",
  MULTIPOLYGON: "MultiPolygon",
  GEOMETRYCOLLECTION: "GeometryCollection"
};

Geometry.SupportedGeometryTypes = [
  Geometry.GeometryTypes.POINT,
  Geometry.GeometryTypes.MULTIPOINT,
  Geometry.GeometryTypes.LINESTRING,
  Geometry.GeometryTypes.MULTILINESTRING,
  Geometry.GeometryTypes.POLYGON,
  Geometry.GeometryTypes.MULTIPOLYGON
]

module.exports = Geometry;

},{}],31:[function(require,module,exports){
function init(config) {
  i18next
  .use(i18nextXHRBackend)
  .init({ 
      lng: 'it',
      ns: 'app',
      fallbackLng: 'it',
      resources: config.resources
  });
  
  jqueryI18next.init(i18next, $, {
    tName: 't', // --> appends $.t = i18next.t
    i18nName: 'i18n', // --> appends $.i18n = i18next
    handleName: 'localize', // --> appends $(selector).localize(opts);
    selectorAttr: 'data-i18n', // selector for translating elements
    targetAttr: 'data-i18n-target', // element attribute to grab target element to translate (if diffrent then itself)
    optionsAttr: 'data-i18n-options', // element attribute that contains options, will load/set if useOptionsAttr = true
    useOptionsAttr: false, // see optionsAttr
    parseDefaultValueFromContent: true // parses default values from content ele.val or ele.text
  });
}
    
var t = function(text){
    var trad = i18next.t(text);
    return trad;
};
    
module.exports = {
  init: init,
  t: t
}

},{}],32:[function(require,module,exports){
var PickCoordinatesEventType = {
  PICKED: 'picked'
};

var PickCoordinatesEvent = function(type, coordinate) {
  this.type = type;
  this.coordinate = coordinate;
};

var PickCoordinatesInteraction = function(options) {
  this.previousCursor_ = null;
  
  ol.interaction.Pointer.call(this, {
    handleDownEvent: PickCoordinatesInteraction.handleDownEvent_,
    handleUpEvent: PickCoordinatesInteraction.handleUpEvent_,
    handleMoveEvent: PickCoordinatesInteraction.handleMoveEvent_,
  });
};
ol.inherits(PickCoordinatesInteraction, ol.interaction.Pointer);

PickCoordinatesInteraction.handleDownEvent_ = function(event) {
  return true;
};

PickCoordinatesInteraction.handleUpEvent_ = function(event) {
  this.dispatchEvent(
          new PickCoordinatesEvent(
              PickCoordinatesEventType.PICKED,
              event.coordinate));
  return true;
};

PickCoordinatesInteraction.handleMoveEvent_ = function(event) {
  var elem = event.map.getTargetElement();
  elem.style.cursor =  'pointer';
};

PickCoordinatesInteraction.prototype.shouldStopEvent = function(){
  return true;
};

PickCoordinatesInteraction.prototype.setMap = function(map){
  if (!map) {
    var elem = this.getMap().getTargetElement();
    elem.style.cursor = '';
  }
  ol.interaction.Pointer.prototype.setMap.call(this,map);
};

module.exports = PickCoordinatesInteraction;

},{}],33:[function(require,module,exports){
var PickFeatureEventType = {
  PICKED: 'picked'
};

var PickFeatureEvent = function(type, coordinate, feature) {
  this.type = type;
  this.feature = feature;
  this.coordinate = coordinate;
};



var PickFeatureInteraction = function(options) {
  ol.interaction.Pointer.call(this, {
    handleDownEvent: PickFeatureInteraction.handleDownEvent_,
    handleUpEvent: PickFeatureInteraction.handleUpEvent_,
    handleMoveEvent: PickFeatureInteraction.handleMoveEvent_,
  });
  
  this.features_ = options.features || null;
  
  this.layers_ = options.layers || null;
  
  this.pickedFeature_ = null;
  
  var self = this;
  this.layerFilter_ = function(layer) {
    return _.includes(self.layers_, layer);
  };
};
ol.inherits(PickFeatureInteraction, ol.interaction.Pointer);

PickFeatureInteraction.handleDownEvent_ = function(event) {
  this.pickedFeature_ = this.featuresAtPixel_(event.pixel, event.map);
  return true;
};

PickFeatureInteraction.handleUpEvent_ = function(event) {
  if(this.pickedFeature_){
    this.dispatchEvent(
            new PickFeatureEvent(
                PickFeatureEventType.PICKED,
                event.coordinate,
                this.pickedFeature_));
  }
  return true;
};

PickFeatureInteraction.handleMoveEvent_ = function(event) {
  var elem = event.map.getTargetElement();
  var intersectingFeature = this.featuresAtPixel_(event.pixel, event.map);

  if (intersectingFeature) {
    elem.style.cursor =  'pointer';
  } else {
    elem.style.cursor = '';
  }
};

PickFeatureInteraction.prototype.featuresAtPixel_ = function(pixel, map) {
  var found = null;

  var intersectingFeature = map.forEachFeatureAtPixel(pixel,
      function(feature) {
        if (this.features_) {
          if (this.features_.indexOf(feature) > -1){
            return feature
          }
          else{
            return null;
          }
        }
        return feature;
      },this,this.layerFilter_);
  
  if(intersectingFeature){
    found = intersectingFeature;
  }
  return found;
};

PickFeatureInteraction.prototype.shouldStopEvent = function(){
  return false;
};

PickFeatureInteraction.prototype.setMap = function(map){
  if (!map) {
    var elem = this.getMap().getTargetElement();
    elem.style.cursor = '';
  }
  ol.interaction.Pointer.prototype.setMap.call(this,map);
};

module.exports = PickFeatureInteraction;

},{}],34:[function(require,module,exports){
var inherit = require('core/utils/utils').inherit;
var base = require('core/utils/utils').base;
var G3WObject = require('core/g3wobject');
var GeometryTypes = require('core/geometry/geometry').GeometryTypes;

var CAPABILITIES = {
  QUERY: 1,
  EDIT: 2
};

var EDITOPS = {
  INSERT: 1,
  UPDATE: 2,
  DELETE: 4
};

LayerState = {};

LayerState.ServerTypes = {
  OGC: "OGC",
  QGIS: "QGIS",
  Mapserver: "Mapserver",
  Geoserver: "Geoserver",
  ArcGIS: "ArcGIS"
};

LayerState.getGeometryType = function(layerState) {
  return layerState.geometrytype;
};

LayerState.getAttributes = function(layerState) {
  var attributes = [];
  if (layerState.attributes) {
    attributes = _.map(layerState.attributes,function(attribute) {
      return attribute.name;
    })
  }
  return attributes;
};

LayerState.isQueryable = function(layerState){
  var queryEnabled = false;
  var queryableForCababilities = (layerState.capabilities && (layerState.capabilities && CAPABILITIES.QUERY)) ? true : false;
  if (queryableForCababilities) {
    // è interrogabile se visibile e non disabilitato (per scala) oppure se interrogabile comunque (forzato dalla proprietà infowhennotvisible)
    var queryEnabled = (layerState.visible && !layerState.disabled) || (layerState.infowhennotvisible && (layerState.infowhennotvisible === true));
  }
  return queryEnabled;
};

LayerState.getQueryLayerName = function(layerState) {
  var queryLayerName;
  if (layerState.infolayer && layerState.infolayer != '') {
    queryLayerName = layerState.infolayer;
  }
  else {
    queryLayerName = layerState.name;
  }
  return queryLayerName;
};

LayerState.getServerType = function(layerState) {
  if (layerState.servertype && layerState.servertype != '') {
    return layerState.servertype;
  }
  else {
    return LayerState.ServerTypes.QGIS;
  }
};

LayerState.isExternalWMS = function(layerState) {
  return (layerState.source && layerState.source.url);
};

LayerState.getWMSLayerName = function(layerState) {
  var layerName = layerState.name;
  if (layerState.source && layerState.source.layers){
    layerName = layerState.source.layers
  };
  return layerName;
};

LayerState.getOriginURL = function(layerState) {
  var url;
  if (layerState.source && layerState.source.type == 'wms' && layerState.source.url){
    url = layerState.source.url
  };
  return url;
};

module.exports = LayerState;

},{"core/g3wobject":28,"core/geometry/geometry":30,"core/utils/utils":49}],35:[function(require,module,exports){
var inherit = require('core/utils/utils').inherit;
var truefnc = require('core/utils/utils').truefnc;
var resolve = require('core/utils/utils').resolve;
var reject = require('core/utils/utils').reject;
var G3WObject = require('core/g3wobject');

function VectorLayer(config){
  var config = config || {};
  this.geometrytype = config.geometrytype || null;
  this.format = config.format || null;
  this.crs = config.crs  || null;
  this.id = config.id || null;
  this.name = config.name || "";
  this.pk = config.pk || "id"; // TODO: il GeoJSON setta l'id della feature da sé, e nasconde il campo PK dalle properties. In altri formati va verificato, e casomai usare feature.setId()
  
  this._olSource = new ol.source.Vector({
    features: new ol.Collection()
  });
  this._olLayer = new ol.layer.Vector({
    name: this.name,
    source: this._olSource
  });
  
  /*
   * Array di oggetti:
   * {
   *  name: Nome dell'attributo,
   *  type: integer | float | string | boolean | date | time | datetime,
   *  input: {
   *    label: Nome del campo di input,
   *    type: select | check | radio | coordspicker | boxpicker | layerpicker | fielddepend,
   *    options: {
   *      Le opzioni per lo spcifico tipo di input (es. "values" per la lista di valori di select, check e radio)
   *    }
   *  }
   * }
  */
  this._PKinAttributes = false;
  this._featuresFilter = null;
  this._fields = null
  this.lazyRelations = true;
  this._relations = null;
}
inherit(VectorLayer,G3WObject);
module.exports = VectorLayer;

var proto = VectorLayer.prototype;

proto.setData = function(featuresData){
  var self = this;
  var features;
  if (this.format) {
    switch (this.format){
      case "GeoJSON":
        var geojson = new ol.format.GeoJSON({
          defaultDataProjection: this.crs,
          geometryName: "geometry"
        });
        features = geojson.readFeatures(featuresData);
        break;
    }
    
    if (features && features.length) {
      if (!_.isNull(this._featuresFilter)){
        var features = _.map(features,function(feature){
          return self._featuresFilter(feature);
        });
      }
      
      var alreadyLoadedIds = this.getFeatureIds();
      var featuresToLoad = _.filter(features,function(feature){
        return !_.includes(alreadyLoadedIds,feature.getId());
      })
      
      this._olSource.addFeatures(featuresToLoad);
      
      // verifico, prendendo la prima feature, se la PK è presente o meno tra gli attributi
      var attributes = this.getSource().getFeatures()[0].getProperties();
      this._PKinAttributes = _.get(attributes,this.pk) ? true : false;
    }
  }
  else {
    console.log("VectorLayer format not defined");
  }
};

proto.setFeatureData = function(oldfid,fid,geometry,attributes){
  var feature = this.getFeatureById(oldfid);
  if (fid){
    feature.setId(fid);
  }
  
  if (geometry){
    feature.setGeometry(geometry);
  }
  
  if (attributes){
    var oldAttributes = feature.getProperties();
    var newAttributes =_.assign(oldAttributes,attributes);
    feature.setProperties(newAttributes);
  }
  
  return feature;
};

proto.addFeatures = function(features){
  this.getSource().addFeatures(features);
};

proto.setFeaturesFilter = function(featuresFilter){
  this._featuresFilter = featuresFilter;
};

proto.setFields = function(fields){
  this._fields = fields;
};

proto.setPkField = function(){
  var self = this;
  var pkfieldSet = false;
  _.forEach(this._fields,function(field){
    if (field.name == self.pk ){
      pkfieldSet = true;
    }
  });
  
  if (!pkfieldSet){
    this._fields
  }
};

proto.getFeatures = function(){
  return this.getSource().getFeatures();
};

proto.getFeatureIds = function(){
  var featureIds = _.map(this.getSource().getFeatures(),function(feature){
    return feature.getId();
  })
  return featureIds
};

proto.getFields = function(){
  return _.cloneDeep(this._fields);
};

proto.getFieldsNames = function(){
  return _.map(this._fields,function(field){
    return field.name;
  });
};

proto.getFieldsWithAttributes = function(obj){
  var self = this;
  /*var fields = _.cloneDeep(_.filter(this._fields,function(field){
    return ((field.name != self.pk) && field.editable);
  }));*/
  var fields = _.cloneDeep(this._fields);
  
  var feature, attributes;
  
  // il metodo accetta sia feature che fid
  if (obj instanceof ol.Feature){
    feature = obj;
  }
  else if (obj){
    feature = this.getFeatureById(obj);
  }
  if (feature){
    attributes = feature.getProperties();
  }
  
  _.forEach(fields,function(field){
    if (feature){
      if (!this._PKinAttributes && field.name == self.pk){
        field.value = feature.getId();
      }
      else{
        field.value = attributes[field.name];
      }
    }
    else{
      field.value = null;
    }
  });
  return fields;
};

proto.setRelations = function(relations){
  _.forEach(relations,function(relation,relationKey){
    relation.name = relationKey;
  });
  this._relations = relations;
};

proto.getRelations = function(){
  return this._relations;
};

proto.hasRelations = function(){
  return !_.isNull(this._relations);
};

proto.getRelationsNames = function(){
  return _.keys(this._relations);
};

proto.getRelationsFksKeys = function(){
  var fks = [];
  _.forEach(this._relations,function(relation){
    fks.push(relation.fk);
  })
  return fks;
};

proto.getRelationFieldsNames = function(relation){
  var relationFields = this._relations[relation];
  if (relationFields){
    return _.map(relationFields,function(field){
      return field.name;
    });
  }
  return null;
};

// ottengo le relazioni a partire dal fid di una feature esistente
proto.getRelationsWithAttributes = function(fid){
  var relations = _.cloneDeep(this._relations);
  var self = this;
  if (!fid || !this.getFeatureById(fid)){
    _.forEach(relations,function(relation,relationKey){
        // inizialmente setto a null i valori
      _.forEach(relation.fields,function(field){
        field.value = null;
      })
    });
    return resolve(relations);
  }
  else {
    if (this.lazyRelations){
      var deferred = $.Deferred();
      var attributes = this.getFeatureById(fid).getProperties();
      var fks = {};
      _.forEach(relations,function(relation,relationKey){
        var url = relation.url;
        var keyVals = [];
        _.forEach(relation.fk,function(fkKey){
          fks[fkKey] = attributes[fkKey];
        });
      })
      
      this.getRelationsWithAttributesFromFks(fks)
      .then(function(relationsResponse){
        deferred.resolve(relationsResponse);
      })
      .fail(function(){
        deferred.reject();
      });
      return deferred.promise();
    }
  }
};

// ottengo le relazioni valorizzate a partire da un oggetto con le chiavi FK come keys e i loro valori come values
proto.getRelationsWithAttributesFromFks = function(fks){
  var self = this;
  var relations = _.cloneDeep(this._relations);
  var relationsRequests = [];

  _.forEach(relations,function(relation,relationKey){
    var url = relation.url;
    var keyVals = [];
    _.forEach(relation.fk,function(fkKey){
      var fkValue = fks[fkKey];
      keyVals.push(fkKey+"="+fkValue);
    });
    var fkParams = _.join(keyVals,"&");
    url += "?"+fkParams;
    relationsRequests.push($.get(url)
      .then(function(relationAttributes){
        _.forEach(relation.fields,function(field){
          field.value = relationAttributes[0][field.name];
        });
      })
    )
  })
  
  return $.when.apply(this,relationsRequests)
  .then(function(){
    return relations;
  });
}

proto.setStyle = function(style){
  this._olLayer.setStyle(style);
};

proto.getLayer = function(){
  return this._olLayer;
};

proto.getSource = function(){
  return this._olLayer.getSource();
};

proto.getFeatureById = function(id){
  return this._olLayer.getSource().getFeatureById(id);
};

proto.clear = function(){
  this.getSource().clear();
};

proto.addToMap = function(map){
  map.addLayer(this._olLayer);
};

// data una feature verifico se ha tra gli attributi i valori delle FK delle (eventuali) relazioni
proto.featureHasRelationsFksWithValues = function(feature){
  var attributes = feature.getProperties();
  var fksKeys = this.getRelationsFksKeys();
  return _.every(fksKeys,function(fkKey){
    var value = attributes[fkKey];
    return (!_.isNil(value) && value != '');
  })
};

// data una feature popolo un oggetto con chiavi/valori delle FK delle (eventuali) relazione
proto.getRelationsFksWithValuesForFeature = function(feature){
  var attributes = feature.getProperties();
  var fks = {};
  var fksKeys = this.getRelationsFksKeys();
  _.forEach(fksKeys,function(fkKey){
    fks[fkKey] = attributes[fkKey];
  })
  return fks;
};

},{"core/g3wobject":28,"core/utils/utils":49}],36:[function(require,module,exports){
var inherit = require('core/utils/utils').inherit;
var base = require('core/utils/utils').base;
var geo = require('core/utils/geo');
var LayerState = require('core/layer/layerstate');
var MapLayer = require('core/map/maplayer');
var RasterLayers = require('g3w-ol3/src/layers/rasters');

function WMSLayer(options,extraParams){
  var self = this;
  this.LAYERTYPE = {
    LAYER: 'layer',
    MULTILAYER: 'multilayer'
  };

  this.extraParams = extraParams
  this.layers = [];
  
  base(this,options);
}
inherit(WMSLayer,MapLayer)
var proto = WMSLayer.prototype;

proto.getOLLayer = function(){
  var olLayer = this._olLayer;
  if (!olLayer){
    olLayer = this._olLayer = this._makeOlLayer();
  }
  return olLayer;
};

proto.getSource = function(){
  return this.getOLLayer().getSource();
};

proto.getInfoFormat = function() {
  return 'application/vnd.ogc.gml';
};

proto.getGetFeatureInfoUrl = function(coordinate,resolution,epsg,params){
  return this.getOLLayer().getSource().getGetFeatureInfoUrl(coordinate,resolution,epsg,params);
};

proto.getLayerConfigs = function(){
  return this.layers;
};

proto.addLayer = function(layerConfig){
  this.layers.push(layerConfig);
};

proto.toggleLayer = function(layer){
  _.forEach(this.layers,function(_layer){
    if (_layer.id == layer.id){
      _layer.visible = layer.visible;
    }
  });
  this._updateLayers();
};
  
proto.update = function(mapState,extraParams){
  this._updateLayers(mapState,extraParams);
};

proto.isVisible = function(){
  return this._getVisibleLayers().length > 0;
};

proto.getQueryUrl = function(){
  var layer = this.layers[0];
  if (layer.infourl && layer.infourl != '') {
    return layer.infourl;
  }
  return this.config.url;
};

proto.getQueryLayers = function(){ 
  var layer = this.layers[0];
  var queryLayers = [];
  _.forEach(this.layers,function(layer){
    if (LayerState.isQueryable(layer)) {
      queryLayers.push({
        layerName: LayerState.getWMSLayerName(layer),
        queryLayerName: LayerState.getQueryLayerName(layer),
        geometryType: LayerState.getGeometryType(layer),
        attributes: LayerState.getAttributes(layer)
      });
    }
  });
  return queryLayers;
};

proto._makeOlLayer = function(){
  var self = this;
  var wmsConfig = {
    url: this.config.url,
    id: this.config.id
  };
  
  var representativeLayer = this.layers[0]; //BRUTTO, DEVO PRENDERE UN LAYER A CASO (IL PRIMO) PER VEDERE SE PUNTA AD UN SOURCE DIVERSO (dovrebbe accadere solo per i layer singoli, WMS esterni)
  
  if (representativeLayer.source && representativeLayer.source.type == 'wms' && representativeLayer.source.url){
    wmsConfig.url = representativeLayer.source.url;
  };
  
  var olLayer = new RasterLayers.WMSLayer(wmsConfig,this.extraParams);
  
  olLayer.getSource().on('imageloadstart', function() {
        self.emit("loadstart");
      });
  olLayer.getSource().on('imageloadend', function() {
      self.emit("loadend");
  });
  
  return olLayer
};

proto._getVisibleLayers = function(mapState){
  var self = this;
  var visibleLayers = [];
  _.forEach(this.layers,function(layer){
    var resolutionBasedVisibility = layer.maxresolution ? (layer.maxresolution && layer.maxresolution > mapState.resolution) : true;
    if (layer.visible && resolutionBasedVisibility) {
      visibleLayers.push(layer);
    }    
  })
  return visibleLayers;
};

proto.checkLayerDisabled = function(layer,resolution) {
  var scale = geo.resToScale(resolution);
  var enabled = true;
  if (layer.maxresolution){
    enabled = enabled && (layer.maxresolution > resolution);
  }
  if (layer.minresolution){
    enabled = enabled && (layer.minresolution < resolution);
  }
  if (layer.minscale) {
    enabled = enabled && (layer.minscale > scale);
  }
  if (layer.maxscale) {
    enabled = enabled && (layer.maxscale < scale);
  }
  layer.disabled = !enabled;
};

proto.checkLayersDisabled = function(resolution){
  var self = this;
  _.forEach(this.layers,function(layer){
    self.checkLayerDisabled(layer,resolution);
  });
};

proto._updateLayers = function(mapState,extraParams){
  this.checkLayersDisabled(mapState.resolution);
  var visibleLayers = this._getVisibleLayers(mapState);
  if (visibleLayers.length > 0) {
    var params = {
      LAYERS: _.join(_.map(visibleLayers,function(layer){
        return LayerState.getWMSLayerName(layer);
      }),',')
    };
    if (extraParams) {
      params = _.assign(params,extraParams);
    }
    this._olLayer.setVisible(true);
    this._olLayer.getSource().updateParams(params);
  }
  else {
    this._olLayer.setVisible(false);
  }
};

module.exports = WMSLayer;

},{"core/layer/layerstate":34,"core/map/maplayer":37,"core/utils/geo":48,"core/utils/utils":49,"g3w-ol3/src/layers/rasters":59}],37:[function(require,module,exports){
var inherit = require('core/utils/utils').inherit;
var base = require('core/utils/utils').base;
var G3WObject = require('core/g3wobject');


function MapLayer(config){
  this.config = config || {};
  this.id = config.id;
  
  this._olLayer = null;
  
  base(this);
}
inherit(MapLayer,G3WObject);

var proto = MapLayer.prototype;

proto.getId = function(){
  return this.id;
};

module.exports = MapLayer;

},{"core/g3wobject":28,"core/utils/utils":49}],38:[function(require,module,exports){
var inherit = require('core/utils/utils').inherit;
var base = require('core/utils/utils').base;
var G3WObject = require('core/g3wobject');

function MapsRegistry() {
  base(this);
  
  this._mapsServices = {
  };
  
  this.addMap = function(mapService) {
    this._registerMapService(mapService);
  };
  
  this._registerMapService = function(mapService) {
    var mapService = this._mapsServices[mapService.id]
    if (_.isUndefined(mapService)) {
      this._mapsServices[mapService.id] = mapService;
    }
  };
} 
inherit(MapsRegistry,G3WObject);

module.exports = MapsRegistry;

},{"core/g3wobject":28,"core/utils/utils":49}],39:[function(require,module,exports){
var inherit = require('core/utils/utils').inherit;
var base = require('core/utils/utils').base;
var G3WObject = require('core/g3wobject');

var Plugin = function() {
  this.name = '(no name)';
  this.config = null;
  
  base(this);
}
inherit(Plugin,G3WObject);

var proto = Plugin.prototype;

module.exports = Plugin;

},{"core/g3wobject":28,"core/utils/utils":49}],40:[function(require,module,exports){
var base = require('core/utils/utils').base;
var inherit = require('core/utils/utils').inherit;
var G3WObject = require('core/g3wobject');
var ApplicationService = require('core/applicationservice');

//var Plugin = require('./plugin');
//var ToolsService = require('core/plugin/toolsservice');

function PluginsRegistry(){
  var self = this;
  this.config = null;
  // un domani questo sarà dinamico
  this._plugins = {};

  this.setters = {
    registerPlugin: function(plugin){
      if (!self._plugins[plugin.name]) {
        self._plugins[plugin.name] = plugin;
        console.log("Registrato plugin "+plugin.name);
      }
    }
  }
  
  base(this);
  
  this.init = function(options){
    var self = this;
    this.pluginsBaseUrl = options.plusingBaseUrl
    this.pluginsConfigs = options.pluginsConfigs;
    _.forEach(this.pluginsConfigs,function(pluginConfig,name){
      self._setup(name,pluginConfig);
    })
  };
  
  this._setup = function(name,pluginConfig) {
    var self = this;
    if (pluginConfig){
      var url = this.pluginsBaseUrl+'plugins/'+name+'/plugin.js';
      $script(url);
    }
  };
  
  this.getPluginConfig = function(pluginName) {
    return this.pluginsConfigs[pluginName];
  };
  
  this.activate = function(plugin) {
    var tools = plugin.getTools();
    if (tools.length) {
      ToolsService.registerToolsProvider(plugin);
    }
  };
};

inherit(PluginsRegistry,G3WObject);

module.exports = new PluginsRegistry

},{"core/applicationservice":17,"core/g3wobject":28,"core/utils/utils":49}],41:[function(require,module,exports){
var inherit = require('core/utils/utils').inherit;
var base = require('core/utils//utils').base;
var G3WObject = require('core/g3wobject');
var ApplicationService = require('core/applicationservice');

function Project(projectConfig) {
  var self = this;
  
  /* struttura oggetto 'project'
  {
    id,
    type,
    gid,
    name,
    crs,
    extent,
    layerstree
  }
  */
  this.state = projectConfig;
  
  this._layers = {};
  function traverse(obj){
    _.forIn(obj, function (layer, key) {
        //verifica che il valore dell'id non sia nullo
        if (!_.isNil(layer.id)) {
            self._layers[layer.id] = layer;
        }
        if (!_.isNil(layer.nodes)) {
            traverse(layer.nodes);
        }
    });
  }
  traverse(projectConfig.layerstree);
  
  /*var eventType = 'projectset';
  if (doswitch && doswitch === true) {
    eventType = 'projectswitch';
  }
  this.emit(eventType);*/
  
  this.setters = {
    setLayersVisible: function(layers,visible){
      _.forEach(layers,function(layer){
        self._layers[layer.id].visible = visible;
      })
    },
    setBaseLayer: function(id){
      _.forEach(self.state.baseLayers,function(baseLayer){
        baseLayer.visible = (baseLayer.id == id);
      })
    },
    setLayerSelected: function(layer){
      _.forEach(this._layers,function(_layer){
        _layer.selected = (layer.id == _layer.id);
      })
    }
  };

  base(this);
}
inherit(Project,G3WObject);

var proto = Project.prototype;

proto.getGid = function() {
  return this.state.gid;
}

proto.getLayer = function(id){
  return this._layers[id];
};

proto.getLayers = function(){
  return this._layers;
};

proto.getLayerById = function(id) {
  var layer = null;
  _.forEach(this.getLayers(),function(_layer){
    if (_layer.id == id){
      layer = _layer;
    }
  });
  return layer;
};

proto.getLayerByName = function(name) {
  var layer = null;
  _.forEach(this.getLayers(),function(_layer){
    if (_layer.name == name){
      layer = _layer;
    }
  });
  return layer;
};

proto.getQueryableLayers = function(){
  var queryableLayers = [];
  _.forEach(this.getLayers(),function(layer){
    if (LayerState.isQueryable(layer)){
      queryableLayers.push(layer);
    }
  });
  return queryableLayers;
};

proto.getLayerAttributes = function(id){
  return this._layers[id].attributes;
};

proto.getLayerAttributeLabel = function(id,name){
  var label = '';
  _.forEach(this._layers[id].attributes,function(attribute){
    if (attribute.name == name){
      label = attribute.label;
    }
  })
  return label;
};

proto.toggleLayer = function(layer,visible){
  var visible = visible || !layer.visible;
  this.setLayersVisible([layer],visible);
};

proto.toggleLayers = function(layers,visible){
  this.setLayersVisible(layers,visible);
};

proto.selectLayer = function(layer){
  this.setLayerSelected(layer);
};

proto.unselectLayer = function(layer) {
  _.forEach(this.getLayers(),function(_layer){
    if (_layer == layer) {
      _layer.selected = false;
    }
  });
}

proto.getSelectedLayers = function() {
  var selectedLayers = [];
  _.forEach(this.getLayers(),function(_layer){
    if (_layer.selected) {
      selectedLayers.push(_layer);
    }
  });
  return selectedLayers;
}

proto.setGetWmsUrl = function(getWmsUrlFnc){
  this._getWmsUrlFnc = getWmsUrlFnc;
};

proto.getWmsUrl = function(){
  return this._getWmsUrlFnc(this.state);
};

proto.getLegendUrl = function(layer){
  var url = this.getWmsUrl();
  sep = (url.indexOf('?') > -1) ? '&' : '?';
  return this.getWmsUrl()+sep+'SERVICE=WMS&VERSION=1.3.0&REQUEST=GetLegendGraphic&SLD_VERSION=1.1.0&FORMAT=image/png&TRANSPARENT=true&ITEMFONTCOLOR=white&LAYERTITLE=False&ITEMFONTSIZE=10&LAYER='+layer.name;
};

module.exports = Project;

},{"core/applicationservice":17,"core/g3wobject":28,"core/utils//utils":49,"core/utils/utils":49}],42:[function(require,module,exports){
var inherit = require('core/utils/utils').inherit;
var base = require('core/utils/utils').base;
var resolve = require('core/utils/utils').resolve;
var reject = require('core/utils/utils').reject;
var G3WObject = require('core/g3wobject');
var Project = require('core/project/project');


/* service
Funzione costruttore contentente tre proprieta':
    setup: metodo di inizializzazione
    getLayersState: ritorna l'oggetto LayersState
    getLayersTree: ritorna l'array layersTree dall'oggetto LayersState
*/

// Public interface
function ProjectsRegistry(){
  var self = this;
  this.config = null;
  this.initialized = false;
  this.projectType = null;
  
  this.setters = {
    setCurrentProject: function(project){
      this.state.currentProject = project;
    }
  };
  
  this.state = {
    baseLayers: {},
    minScale: null,
    maxscale: null,
    currentProject: null
  };
  
  // tutte le configurazioni di base dei progetti, ma di cui non è detto che sia ancora disponibile l'istanza (lazy loading)
  this._pendingProjects = [];
  this._projects = {};
  
  base(this);
}
inherit(ProjectsRegistry, G3WObject);

var proto = ProjectsRegistry.prototype;

proto.init = function(config){
  var self = this;
  if (!this.initialized){
    this.initialized = true;
    this.config = config;
    this.setupState();
    return this.getProject(config.initproject)
    .then(function(project){
      self.setCurrentProject(project);
      //aggiunto tipo progetto
      self.setProjectType(project.state.type);
    });
  }
};

proto.setProjectType = function(projectType) {
   this.projectType = projectType;
};

proto.setupState = function(){
  var self = this;
  
  self.state.baseLayers = self.config.baselayers;
  self.state.minScale = self.config.minscale;
  self.state.maxScale = self.config.maxscale;
  self.state.crs = self.config.crs;
  self.state.proj4 = self.config.proj4;
  self.config.projects.forEach(function(project){
    project.baselayers = self.config.baselayers;
    project.minscale = self.config.minscale;
    project.maxscale = self.config.maxscale;
    project.crs = self.config.crs;
    project.proj4 = self.config.proj4;
    self._pendingProjects.push(project);
  })
  //this.state.projects = config.group.projects;
};

proto.getProjectType = function() {
  return this.projectType;
};

proto.getPendingProjects = function() {
  return this._pendingProjects();
};

proto.getCurrentProject = function(){
  return this.state.currentProject;
};

// ottengo il progetto dal suo gid; ritorna una promise nel caso non fosse stato ancora scaricato il config completo (e quindi non sia ancora istanziato Project)
proto.getProject = function(projectGid){
  var self = this;
  var d = $.Deferred();
  var pendingProject = false;
  var project = null;
  this._pendingProjects.forEach(function(_pendingProject){
    if (_pendingProject.gid == projectGid) {
      pendingProject = _pendingProject;
      project = self._projects[projectGid];
    }
  })
  if (!pendingProject) {
    return reject("Project doesn't exist");
  }

  if (project){
    return d.resolve(project);
  }
  else{
    return this._getProjectFullConfig(pendingProject)
    .then(function(projectFullConfig){
      var projectConfig = _.merge(pendingProject,projectFullConfig);
      self._buildProjectTree(projectConfig);
      var project = new Project(projectConfig);
      project.setGetWmsUrl(self.config.getWmsUrl); // BRUTTO MA PER ORA SI TIENE COSI'
      self._projects[projectConfig.gid] = project;
      return d.resolve(project);
    });
  }
  
  return d.promise();
};
  
//ritorna una promises
proto._getProjectFullConfig = function(projectBaseConfig){
  var self = this;
  var deferred = $.Deferred();
  var url = this.config.getProjectConfigUrl(projectBaseConfig);
  $.get(url).done(function(projectFullConfig){
      deferred.resolve(projectFullConfig);
  })
  return deferred.promise();
};

proto._buildProjectTree = function(project){
  var layers = _.keyBy(project.layers,'id');
  var layersTree = _.cloneDeep(project.layerstree);
  
  function traverse(obj){
    _.forIn(obj, function (layer, key) {
      //verifica che il nodo sia un layer e non un folder
      if (!_.isNil(layer.id)) {
          var fulllayer = _.merge(layer,layers[layer.id]);
          obj[parseInt(key)] = fulllayer;
          layer.selected = false;
          layer.disabled = false;
      }
      if (!_.isNil(layer.nodes)){
        // aggiungo proprietà title per l'albero
        layer.title = layer.name;
        traverse(layer.nodes);
      }
    });
  }
  traverse(layersTree);
  project.layerstree = layersTree;
};

module.exports = new ProjectsRegistry();

},{"core/g3wobject":28,"core/project/project":41,"core/utils/utils":49}],43:[function(require,module,exports){
var ProjectTypes = {
  QDJANGO: 'qdjango',
  OGR: 'ogr'
};

module.exports = ProjectTypes;
},{}],44:[function(require,module,exports){
var inherit = require('core/utils/utils').inherit;
var base = require('core/utils/utils').base;
var G3WObject = require('core/g3wobject');
var resolve = require('core/utils/utils').resolve;
var ProjectsRegistry = require('core/project/projectsregistry');

// FILTRI
var Filters = {
  eq: '=',
  gt: '>',
  gte: '>=',
  lt: '<',
  lte: '=<',
  LIKE: 'LIKE',
  ILIKE: 'ILIKE',
  AND: 'AND',
  OR: 'OR',
  NOT: '!='
};

function QueryQGISWMSProvider() {

  self = this;
  //funzione che fa la richiesta vera e propria al server qgis
  this.submitGetFeatureInfo = function(options) {

    var url = options.url || '';
    var querylayer = options.querylayer || null;
    var filter = options.filter || null;
    var bbox = options.bbox || ProjectsRegistry.getCurrentProject().state.extent.join(',');
    var simpleWmsSearchMaxResults = null;
    var crs = options.crs || '4326;'
    return $.get( url, {
        'SERVICE': 'WMS',
        'VERSION': '1.3.0',
        'REQUEST': 'GetFeatureInfo',
        'LAYERS': querylayer,
        'QUERY_LAYERS': querylayer,
        'FEATURE_COUNT': simpleWmsSearchMaxResults ||  50,
        'INFO_FORMAT': 'application/vnd.ogc.gml',
        'CRS': 'EPSG:'+ crs,
        'FILTER': filter,
        // Temporary fix for https://hub.qgis.org/issues/8656 (fixed in QGIS master)
        'BBOX': bbox // QUI CI VA IL BBOX DELLA MAPPA
      }
    );
   };

  //funzione che fa la ricerca
  this.doSearch = function(queryFilterObject) {

    var url = queryFilterObject.url;
    var querylayer = queryFilterObject.querylayer;
    var filterObject = queryFilterObject.filterObject;
    var crs = queryFilterObject.crs;
    //creo il filtro
    var filter = this.createFilter(filterObject, querylayer);
    //eseguo la richiesta e restituisco come risposta la promise del $.get
    var response = this.submitGetFeatureInfo({
      url: url,
      crs: crs,
      filter: filter,
      querylayer: querylayer
    });
    return response;
  };

  this.createFilter = function(filterObject, querylayer) {

    /////inserisco il nome del layer (typename) ///
    var filter = [];
    function createSingleFilter(booleanObject) {
      var filterElements = [];
      var filterElement = '';
      var valueExtra = "";
      var valueQuotes = "";
      var rootFilter;
      _.forEach(booleanObject, function(v, k, obj) {
        //creo il filtro root che sarà AND OR
        rootFilter = Filters[k];
        //qui c'è array degli elementi di un booleano
        _.forEach(v, function(input){
          //scorro su oggetto
          _.forEach(input, function(v, k, obj) {
          //verifico se il valore dell'oggetto è array e quindi è altro oggetto padre booleano
            if (_.isArray(v)) {
              filterElement = createSingleFilter(obj);
            } else { // è un oggetto operatore
              if (k == 'LIKE' || k == 'ILIKE') {
                valueExtra = "%";
              };
              filterOp = Filters[k];
              _.forEach(input, function(v, k, obj) {
                _.forEach(v, function(v, k, obj) {
                  //verifico se il valore non è un numero e quindi aggiungo singolo apice
                  if(isNaN(v)) {
                    valueQuotes = "'";
                  } else {
                    valueQuotes = "";
                  };
                  filterElement = "\"" + k + "\" "+ filterOp +" " + valueQuotes + valueExtra + v + valueExtra + valueQuotes;
                });
              });
            };
            filterElements.push(filterElement);
          });
        });
        rootFilter = filterElements.join(" "+ rootFilter + " ");
      });
      return rootFilter;
    };
    //assegno il filtro creato
    filter = querylayer + ":" + createSingleFilter(filterObject);
    return filter;
  };

};

inherit(QueryQGISWMSProvider, G3WObject);

module.exports =  new QueryQGISWMSProvider();

},{"core/g3wobject":28,"core/project/projectsregistry":42,"core/utils/utils":49}],45:[function(require,module,exports){
var inherit = require('core/utils/utils').inherit;
var base = require('core/utils/utils').base;
var G3WObject = require('core/g3wobject');
var resolve = require('core/utils/utils').resolve;
//definisco il filtro ol3
var ol3OGCFilter = ol.format.ogc.filter;

//oggetto che viene passato per effetturare il la search
var ol3GetFeatureRequestObject = {
  srsName: 'EPSG:',
  featureNS: '',
  featurePrefix: '',
  featureTypes: [],
  outputFormat: 'application/json',
  filter: null // esempio filtro composto ol3OGCFilter.and(ol3OGCFilter.bbox('the_geom', [1, 2, 3, 4], 'urn:ogc:def:crs:EPSG::4326'),ol3OGCFilter.like('name', 'New*'))
};

// FILTRI OL3
var ol3Filters = {
  eq: ol3OGCFilter.equalTo,
  gt: ol3OGCFilter.greaterThan,
  gte: ol3OGCFilter.greaterThanOrEqualTo,
  lt: ol3OGCFilter.lessThan,
  lte: ol3OGCFilter.lessThanOrEqualTo,
  like: ol3OGCFilter.like,
  ilike: "",
  bbox: ol3OGCFilter.bbox,
  AND: ol3OGCFilter.and,
  OR: ol3OGCFilter.or,
  NOT: ol3OGCFilter.not
};


// CREATO UN FILTRO DI ESEMPIO PER VERIFICARE LA CORRETTEZZA DELLA FUNZIONE CREAZIONE FILTRO
var testFilter = {
  'AND':
    [
      {
        eq:
          {
            gid : 10
          }
      },
      {
        'OR':
          [
            {
              eq: {
                pippo : 'lallo'
              }
            },
            {
              gt: {
                id : 5
              }
            }

          ]
      }
   ]
}
//////////////

///FILTRI CUSTOM
var standardFilterTemplates = function() {
  var common = {
    propertyName:
          "<PropertyName>" +
            "[PROP]" +
          "</PropertyName>",
    literal:
          "<Literal>" +
            "[VALUE]" +
          "</Literal>"
  };
  return {
    eq: "<PropertyIsEqualTo>" +
            common.propertyName +
            common.literal +
        "</PropertyIsEqualTo>",
    gt: "<PropertyIsGreaterThan>" +
            common.propertyName +
            common.literal +
         "</PropertyIsGreaterThan>",
    gte:"",
    lt: "",
    lte: "",
    like: "",
    ilike: "",
    AND: "<And>[AND]</And>",
    OR: "<Or>[OR]</Or>",
  }
}();

/////
var qgisFilterTemplates = {
  // codice qui
};

var mapserverFilterTemplates = {
  // codice qui
};

var geoserverFilterTemplates = {
  // codice qui
};

function QueryWFSProvider(){
  var self = this;
  var d = $.Deferred();
  var results = {
    headers:[],
    values:[]
  };

  this.doSearch = function(queryFilterObject){
    var ogcservertype = queryFilterObject.servertype;
    var url = queryFilterObject.url;
    var querylayer = queryFilterObject.querylayer;
    var filterObject = queryFilterObject.filterObject;
    var crs = queryFilterObject.crs;
    //setto il srs
    ol3GetFeatureRequestObject.srsName+=crs || '4326';
    var response, filter;
    switch (ogcservertype) {
      case 'OGC':
        filter = this.createStandardFilter(filterObject, querylayer);
        response = this.standardSearch(url, filter);
        return resolve(response)
        break;
      case 'qgis':
        filter = this.createQgisFilter(filterObject);
        response = this.qgisSearch(querylayer, url, filter);
        return resolve(response)
        break;
      case 'mapserver':
        filter = this.createMapserverFilter(filterObject);
        response = this.mapserverSearch(querylayer, url, filter);
        return resolve(response)
        break;
      case 'geoserver':
        filter = this.createGeoserverFilter(filterObject);
        response = this.geoserverSearch(querylayer, url, filter);
        return resolve(response)
        break;
      default:
        return false
    }
  };

  this.standardSearch = function(url, filter){
    console.log(filter)
  };
  this.createStandardFilter = function(filterObject, querylayer) {
    /////inserisco il nome del layer (typename) ///
    ol3GetFeatureRequestObject.featureTypes.push(querylayer);
    var filter = [];
    function createSingleFilter(booleanObject) {
      var filterElements = [];
      var filterElement = '';
      var rootFilter;
      _.forEach(booleanObject, function(v, k, obj) {
        //creo il filtro root che sarà AND OR
        rootFilter = ol3Filters[k];
        //qui c'è array degli elementi di un booleano
        _.forEach(v, function(input){
          //scorro su oggetto operatore
          _.forEach(input, function(v, k, obj) {
          //è un array e quindi è altro oggetto padre booleano
            if (_.isArray(v)) {
              filterElement = createSingleFilter(obj);
            } else {
              filterElement = ol3Filters[k];
              _.forEach(input, function(v, k, obj) {
                _.forEach(v, function(v, k, obj) {
                  filterElement = filterElement(k, v);
                });
              });
            };
            filterElements.push(filterElement);
          });
        });
        //verifico che ci siano almeno due condizione nel filtro AND. Nel caso di una sola condizione (esempio : un solo input)
        //estraggo solo l'elemento filtro altrimenti da errore -- DA VERIFICARE SE CAMBIARLO
        if (filterElements.length > 1) {
          rootFilter = rootFilter.apply(this, filterElements);
        } else {
          rootFilter = filterElements[0];
        };
      });
      return rootFilter;
    };
    //assegno il filtro creato
    ol3GetFeatureRequestObject.filter = createSingleFilter(filterObject);
    //creo il filtro utilizzando ol3
    filter = new ol.format.WFS().writeGetFeature(ol3GetFeatureRequestObject);
    return filter;
  };

  this.qgisSearch = function(urls, filter){
    $.get(searchUrl).then(function(result){
      self.emit("searchdone",result);
    });
    return d.promise();
  };
  this.createQGisFilter = function(filterObject) {
    var filter;
    return filter
  };
  this.mapserverSearch = function(querylayer, url, filter){
    return d.promise();
  };
  this.createMapserverFilter = function(filterObject) {
    var filter;
    return filter
  };
  this.geoserverSearch = function(querylayer, url, filter){
    return d.promise();
  };
  this.createGeoserverFilter = function(filterObject) {
    var filter;
    return filter
  };
  base(this);
}
inherit(QueryWFSProvider,G3WObject);

module.exports =  new QueryWFSProvider()


},{"core/g3wobject":28,"core/utils/utils":49}],46:[function(require,module,exports){
var inherit = require('core/utils/utils').inherit;
var base = require('core/utils/utils').base;
var G3WObject = require('core/g3wobject');
var ProjectsRegistry = require('core/project/projectsregistry');
var QueryWFSProvider = require('./queryWFSProvider');
var QueryQGISWMSProvider = require('./queryQGISWMSProvider');
var ComponentsRegistry = require('sdk/gui/componentsregistry');

var Provider = {
  'QGIS': QueryQGISWMSProvider,
  'OGC': QueryWFSProvider
};
//oggetto query service
function QueryService(){
  var self = this;
  this.url = "";
  this.filterObject = {};
  this.queryFilterObject = {};
  //me lo porto da mapqueryservice ma vediamo cosa succede
  this.init = function(map){
    this.map = map;
  }
  this.setFilterObject = function(filterObject){
    this.filterObject = filterObject;
  };

  this.getFilterObject = function() {
    return this.filterObject;
  };
  //dato l'oggetto filter restituito dal server ricostruisco la struttura del filterObject
  //interpretato da queryWMSProvider
  this.createQueryFilterFromConfig = function(filter) {

    var queryFilter = {};
    var attribute;
    var operator;
    var field;
    var operatorObject = {};
    var booleanObject = {};
    //funzione che costruisce l'oggetto operatore es. {'=':{'nomecampo':null}}
    function createOperatorObject(obj) {
      //rinizializzo a oggetto vuoto
      evalObject = {};
      //verifico che l'oggetto passato non sia a sua volta un oggetto 'BOOLEANO'
      _.forEach(obj, function(v,k) {
        if (_.isArray(v)) {
          return createBooleanObject(k,v);
        };
      });
      field = obj.attribute;
      operator = obj.op;
      evalObject[operator] = {};
      evalObject[operator][field] = null;
      return evalObject;
    };
    //functione che costruisce oggetti BOOLEANI caso AND OR contenente array di oggetti fornit dalla funzione createOperatorObject
    function createBooleanObject(booleanOperator, operations) {
      booleanObject = {};
      booleanObject[booleanOperator] = [];
      _.forEach(operations, function(operation){
        booleanObject[booleanOperator].push(createOperatorObject(operation));
      })
      return booleanObject;
    };
    /*
    // vado a creare l'oggetto filtro principale. Questo è un oggetto che contiene l'operatore booleano come root (chiave)
    // come valore un array di oggetti operatori che contengono il tipo di operatore come chiave e come valore un oggetto contenete
    // nome campo e valore passato
    */
    _.forEach(filter, function(v,k,obj) {
      queryFilter = createBooleanObject(k,v);
    });
    return queryFilter;
  };

  this.createQueryFilterObject = function(layerId, filterObject){
    var project = ProjectsRegistry.getCurrentProject();
    var layerInfo = this.getLayerInfoUrlFromProjectConfig(layerId);
    return {
      type: 'standard',
      url: layerInfo.url,
      querylayer: layerInfo.name,
      servertype: layerInfo.servertype,
      crs: layerInfo.crs,
      filterObject : filterObject
    };
  };

  this.getLayerInfoUrlFromProjectConfig = function(layerId) {
    var layerFilterInfo = {};
    var project = ProjectsRegistry.getCurrentProject();
    var layerInfo = project.getLayerById(layerId);
    if (layerInfo) {
      layerFilterInfo.name = layerInfo.name;
      layerFilterInfo.crs = project.state.crs;
      layerFilterInfo.servertype = layerInfo.servertype;
      if (layerInfo.source && layerInfo.source.url){
        layerFilterInfo.url = layerInfo.source.url;
      } else {
        layerFilterInfo.url = project.getWmsUrl();
      };
    };
    return layerFilterInfo;
  };

  /////PARSERS //////////////////

  // Brutto ma per ora unica soluzione trovata per dividere per layer i risultati di un doc xml wfs.FeatureCollection.
  // OL3 li parserizza tutti insieme non distinguendo le features dei diversi layers
  this._parseLayerFeatureCollection = function(queryLayer, data) {
    var features = [];
    var layerName = queryLayer.queryLayerName;
    var layerData = _.cloneDeep(data);
    layerData.FeatureCollection.featureMember = [];
    
    var featureMembers = data.FeatureCollection.featureMember;
    featureMembers = _.isArray(featureMembers) ? featureMembers : [featureMembers];
    _.forEach(featureMembers,function(featureMember){
      layerName = layerName.replace(/ /g,''); // QGIS SERVER rimuove gli spazi dal nome del layer per creare l'elemento FeatureMember
      var isLayerMember = _.get(featureMember,layerName)

      if (isLayerMember) {
        layerData.FeatureCollection.featureMember.push(featureMember);
      }
    });

    var x2js = new X2JS();
    var layerFeatureCollectionXML = x2js.json2xml_str(layerData);
    var parser = new ol.format.WMSGetFeatureInfo();
    return parser.readFeatures(layerFeatureCollectionXML);
  };

  // mentre con i risultati in msGLMOutput (da Mapserver) il parser può essere istruito per parserizzare in base ad un layer di filtro
  this._parseLayermsGMLOutput = function(queryLayer, data){
    var parser = new ol.format.WMSGetFeatureInfo({
      layers: [queryLayer.queryLayerName]
    });
    return parser.readFeatures(data);
  };

  //// FINE PARSER ////

  this.getGetFeatureInfoUrl = function(mapLayer,coordinate){
    //var parser = new ol.format.WMSGetFeatureInfo();
    var resolution = this.map.getView().getResolution();
    var epsg = this.map.getView().getProjection().getCode();
    var params = {
      QUERY_LAYERS: _.map(mapLayer.getQueryLayers(),'queryLayerName'),
      INFO_FORMAT: mapLayer.getInfoFormat(),
      // PARAMETRI DI TOLLERANZA PER QGIS SERVER
      FI_POINT_TOLERANCE: 10,
      FI_LINE_TOLERANCE: 10,
      FI_POLYGON_TOLERANCE: 10
    }
    var url = mapLayer.getGetFeatureInfoUrl(coordinate,resolution,epsg,params);
    return url;
  };

  //INIZO SEZIONE QUERIES ///

  // Messo qui generale la funzione che si prende cura della trasformazione dell'xml di risposta
  // dal server così da avere una risposta coerente in termini di formato risultati da presentare
  // nel componente QueryResults
  this.handleQueryResponseFromServer = function(response, queryLayers) {
    var jsonresponse;
    var featuresForLayerNames = {};
    var d = $.Deferred();
    var x2js = new X2JS();
    try {
      if (_.isString(response)) {
        jsonresponse = x2js.xml_str2json(response);
      } else {
        jsonresponse = x2js.xml2json(response);
      }
    }
    catch (e) {
      d.reject(e);
    }
    var rootNode = _.keys(jsonresponse)[0];
    var parser, data;
    switch (rootNode) {
      case 'FeatureCollection':
        parser = this._parseLayerFeatureCollection;
        data = jsonresponse;
        break;
      case "msGMLOutput":
        parser = this._parseLayermsGMLOutput;
        data = response;
        break;
    };
    var nfeatures = 0
    _.forEach(queryLayers,function(queryLayer) {
      var features = parser.call(self, queryLayer, data)
      nfeatures += features.length;
      featuresForLayerNames[queryLayer.layerName] = features;
    });
    var projectLayers = ProjectsRegistry.getCurrentProject().getLayers();
    var featuresForLayers = [];
    var layer;
    _.forEach(featuresForLayerNames,function(features, layerName){
      _.forEach(projectLayers, function(layerObj, layerId) {
        // caso layers QGIS
        if (layerObj.name == layerName) {
          layer = layerObj;
          return true;
        } else if (layerObj.source) {
          //caso WMS layer
          if (layerObj.source.layers == layerName) {
            layer = layerObj;
            return true;
          }
        }
      });
      featuresForLayers.push({
        layer: layer,
        features: features
      })
    });
    d.resolve(featuresForLayers);
    return d.promise();
  };
  // query basato sul filtro

  this.queryByFilter = function(queryFilterObject) {
    var self = this;
    var d = $.Deferred();
    //parte da rivedere nel filtro
    var provider = Provider[queryFilterObject.servertype];
    //ritorna una promise poi gestita da che la chiede
    provider.doSearch(queryFilterObject).
    then(function(response) {
      //al momento qui replico struttura per i parser
      var queryLayers = [];
      var queryLayer = {};
      queryLayer.queryLayerName = queryLayer.layerName = queryFilterObject.querylayer;
      queryLayers.push(queryLayer);
      self.handleQueryResponseFromServer(response, queryLayers)
      .then(function(featuresForLayers) {
            d.resolve({
              data: featuresForLayers,
              query: {
                filter: queryFilterObject
              }
            });
      })
    })
    .fail(function(e){
          d.reject(e);
    })
    return d.promise();
  };

  //query basato click/posizione nella mappa
  this.queryByLocation = function(coordinates, mapLayers) {
    var self = this;
    var d = $.Deferred();
    var urlsForLayers = {};
    _.forEach(mapLayers, function(mapLayer) {
      var url = mapLayer.getQueryUrl();
      var urlHash = url.hashCode().toString();
      // creo un oggetto contentente layers che fanno riferimento
      // ad un uguale url in modo da semplificare la chiamata (farla una sola su più layer
      // invece di farne n su ogni singolo layer
      if (_.keys(urlsForLayers).indexOf(urlHash) == -1) {
        urlsForLayers[urlHash] = {
          url: url,
          mapLayers: []
        };
      }
      urlsForLayers[urlHash].mapLayers.push(mapLayer);
    });
    var queryUrlsForLayers = [];
    _.forEach(urlsForLayers,function(urlForLayers){
      var firstLayer = urlForLayers.mapLayers[0];
      var _getFeatureInfoUrl = self.getGetFeatureInfoUrl(firstLayer,coordinates);
      var queryBase = _getFeatureInfoUrl.split('?')[0];
      var queryString = _getFeatureInfoUrl.split('?')[1];
      var queryParams = {};
      _.forEach(queryString.split('&'),function(queryStringPair){
        var queryPair = queryStringPair.split('=');
        var key = queryPair[0];
        var value = queryPair[1];
        queryParams[key] = value;
      });

      var layerNames = [];
      var queryLayers = [];
      _.forEach(urlForLayers.mapLayers,function(mapLayer){
        var mapLayerQueryLayers = mapLayer.getQueryLayers();
        if (mapLayerQueryLayers.length) {
          queryLayers = _.concat(queryLayers,mapLayerQueryLayers);
        }
      });
      if (queryLayers.length) {

        delete queryParams['STYLES'];
        queryParams['LAYERS'] = _.map(queryLayers,'queryLayerName');
        queryParams['QUERY_LAYERS'] = _.map(queryLayers,'queryLayerName');
        queryParams['FEATURE_COUNT'] = 1000;

        var getFeatureInfoUrl = queryBase;
        var newQueryPairs = [];
        _.forEach(queryParams,function(value,key){
          newQueryPairs.push(key+'='+value);
        });
        getFeatureInfoUrl = queryBase+'?'+newQueryPairs.join('&');
        queryUrlsForLayers.push({
          url: getFeatureInfoUrl,
          queryLayers: queryLayers
        });
      }
    });
    if (queryUrlsForLayers.length > 0) {
      _.forEach(queryUrlsForLayers,function(queryUrlForLayers){
        var url = queryUrlForLayers.url;
        var queryLayers = queryUrlForLayers.queryLayers;
        $.get(url).
        then(function(response){
          self.handleQueryResponseFromServer(response, queryLayers, coordinates)
          .then(function(featuresForLayers){
            d.resolve({
              data: featuresForLayers,
              query: {
                coordinates: coordinates
              }
            });
          })
        })
        .fail(function(e){
          d.reject(e);
        })
      });
    }
    else {
      d.resolve(coordinates,0,{});
    }
    return d.promise();
  };

  //query by BBOX
  this.queryByBoundingBox = function(bbox) {
    //codice qui
  };

  //importatta query generica
  this._query = function(rect,layerId) {
    var Project = ProjectsRegistry.getCurrentProject();
    var layers;
    if (layerId) {
      layers = [Project.getLayer(layerId)];
    }
    else {
      layers = Project.getLayers();
    }
  };

  this.showQueryResults = function(results) {

      //codice qui

  };


  base(this);
}
inherit(QueryService,G3WObject);

module.exports =  new QueryService


},{"./queryQGISWMSProvider":44,"./queryWFSProvider":45,"core/g3wobject":28,"core/project/projectsregistry":42,"core/utils/utils":49,"sdk/gui/componentsregistry":68}],47:[function(require,module,exports){
var inherit = require('core/utils/utils').inherit;
var base = require('core/utils/utils').base;
var Base64 = require('core/utils/utils').Base64;
var G3WObject = require('core/g3wobject');

var RouterService = function(){
  var self = this;
  this._route = '';
  this.setters = {
    setRoute: function(path){
      this._route = path;
    }
  }
  
  History.Adapter.bind(window,'statechange',function(){ // Note: We are using statechange instead of popstate
      var state = History.getState(); // Note: We are using History.getState() instead of event.state
      var hash = state.hash;
      self.setRouteFromHash(hash);
  });
  
  base(this);
};
inherit(RouterService,G3WObject);

var proto = RouterService.prototype;

proto.initRoute = function(){
  var firstHash = window.location.search;
  this.setRouteFromHash(firstHash);
}

proto.goto = function(path){
  var pathb64 = Base64.encode(path);
  History.pushState({path:path},null,'?p='+pathb64);
  //this.setRoute(path);
};

proto.setRouteFromHash = function(hash) {
  var pathb64 = this.getQueryParams(hash)['p'];
  var path = pathb64 ? Base64.decode(pathb64) : '';
  this.setRoute(path);
}

proto.slicePath = function(path){
  return path.split('?')[0].split('/');
};
  
proto.sliceFirst = function(path){
  var pathAndQuery = path.split('?');
  var queryString = pathAndQuery[1];
  var pathArr = pathAndQuery[0].split('/')
  var firstPath = pathArr[0];
  path = pathArr.slice(1).join('/');
  path = [path,queryString].join('?')
  return [firstPath,path];
};
  
proto.getQueryParams = function(path){
  var queryParams = {};
  try {
    var queryString = path.split('?')[1];
    var queryPairs = queryString.split('&');
    var queryParams = {};
    _.forEach(queryPairs,function(queryPair){
      var pair = queryPair.split('=');
      var key = pair[0];
      var value = pair[1];
      queryParams[key] = value;
    });
  }
  catch (e) {}
  return queryParams;
};

proto.getQueryString = function(path){
  return path.split('?')[1];
};
  
proto.makeQueryString = function(queryParams){};

module.exports = new RouterService;

},{"core/g3wobject":28,"core/utils/utils":49}],48:[function(require,module,exports){
var OGC_PIXEL_WIDTH = 0.28;
var OGC_DPI = 25.4/OGC_PIXEL_WIDTH;

module.exports = {
  resToScale: function(res, metric) {
    var metric = metric || 'm';
    var scale;
    switch (metric) {
      case 'm':
        var scale = (res*1000) / OGC_PIXEL_WIDTH;
        break
    }
    return scale;
  }
};

},{}],49:[function(require,module,exports){

/**
 * Decimal adjustment of a number.
 *
 * @param {String}  type  The type of adjustment.
 * @param {Number}  value The number.
 * @param {Integer} exp   The exponent (the 10 logarithm of the adjustment base).
 * @returns {Number} The adjusted value.
 */
function decimalAdjust(type, value, exp) {
  // If the exp is undefined or zero...
  if (typeof exp === 'undefined' || +exp === 0) {
    return Math[type](value);
  }
  value = +value;
  exp = +exp;
  // If the value is not a number or the exp is not an integer...
  if (isNaN(value) || !(typeof exp === 'number' && exp % 1 === 0)) {
    return NaN;
  }
  // Shift
  value = value.toString().split('e');
  value = Math[type](+(value[0] + 'e' + (value[1] ? (+value[1] - exp) : -exp)));
  // Shift back
  value = value.toString().split('e');
  return +(value[0] + 'e' + (value[1] ? (+value[1] + exp) : exp));
}

// Decimal round
if (!Math.round10) {
  Math.round10 = function(value, exp) {
    return decimalAdjust('round', value, exp);
  };
}
// Decimal floor
if (!Math.floor10) {
  Math.floor10 = function(value, exp) {
    return decimalAdjust('floor', value, exp);
  };
}
// Decimal ceil
if (!Math.ceil10) {
  Math.ceil10 = function(value, exp) {
    return decimalAdjust('ceil', value, exp);
  };
}

String.prototype.hashCode = function() {
  var hash = 0, i, chr, len;
  if (this.length === 0) return hash;
  for (i = 0, len = this.length; i < len; i++) {
    chr   = this.charCodeAt(i);
    hash  = ((hash << 5) - hash) + chr;
    hash |= 0;
  }
  return hash;
};

var Base64 = {_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){var t="";var n,r,i,s,o,u,a;var f=0;e=Base64._utf8_encode(e);while(f<e.length){n=e.charCodeAt(f++);r=e.charCodeAt(f++);i=e.charCodeAt(f++);s=n>>2;o=(n&3)<<4|r>>4;u=(r&15)<<2|i>>6;a=i&63;if(isNaN(r)){u=a=64}else if(isNaN(i)){a=64}t=t+this._keyStr.charAt(s)+this._keyStr.charAt(o)+this._keyStr.charAt(u)+this._keyStr.charAt(a)}return t},decode:function(e){var t="";var n,r,i;var s,o,u,a;var f=0;e=e.replace(/[^A-Za-z0-9+/=]/g,"");while(f<e.length){s=this._keyStr.indexOf(e.charAt(f++));o=this._keyStr.indexOf(e.charAt(f++));u=this._keyStr.indexOf(e.charAt(f++));a=this._keyStr.indexOf(e.charAt(f++));n=s<<2|o>>4;r=(o&15)<<4|u>>2;i=(u&3)<<6|a;t=t+String.fromCharCode(n);if(u!=64){t=t+String.fromCharCode(r)}if(a!=64){t=t+String.fromCharCode(i)}}t=Base64._utf8_decode(t);return t},_utf8_encode:function(e){e=e.replace(/rn/g,"n");var t="";for(var n=0;n<e.length;n++){var r=e.charCodeAt(n);if(r<128){t+=String.fromCharCode(r)}else if(r>127&&r<2048){t+=String.fromCharCode(r>>6|192);t+=String.fromCharCode(r&63|128)}else{t+=String.fromCharCode(r>>12|224);t+=String.fromCharCode(r>>6&63|128);t+=String.fromCharCode(r&63|128)}}return t},_utf8_decode:function(e){var t="";var n=0;var r=c1=c2=0;while(n<e.length){r=e.charCodeAt(n);if(r<128){t+=String.fromCharCode(r);n++}else if(r>191&&r<224){c2=e.charCodeAt(n+1);t+=String.fromCharCode((r&31)<<6|c2&63);n+=2}else{c2=e.charCodeAt(n+1);c3=e.charCodeAt(n+2);t+=String.fromCharCode((r&15)<<12|(c2&63)<<6|c3&63);n+=3}}return t}};


var utils = {
  mixin: function mixin(destination, source) {
      return utils.merge(destination.prototype, source);
  },
  
  mixininstance: function mixininstance(destination,source){
      var sourceInstance = new source;
      utils.merge(destination, sourceInstance);
      utils.merge(destination.prototype, source.prototype);
  },


  merge: function merge(destination, source) {
      var key;

      for (key in source) {
          if (utils.hasOwn(source, key)) {
              destination[key] = source[key];
          }
      }
  },

  hasOwn: function hasOwn(object, key) {
      return Object.prototype.hasOwnProperty.call(object, key);
  },
  
  inherit:function(childCtor, parentCtor) {
    function tempCtor() {};
    tempCtor.prototype = parentCtor.prototype;
    childCtor.superClass_ = parentCtor.prototype;
    childCtor.prototype = new tempCtor();
    childCtor.prototype.constructor = childCtor;
  },
  
  base: function(me, opt_methodName, var_args) {
    var caller = arguments.callee.caller;
    if (caller.superClass_) {
      // This is a constructor. Call the superclass constructor.
      return caller.superClass_.constructor.apply(
          me, Array.prototype.slice.call(arguments, 1));
    }

    var args = Array.prototype.slice.call(arguments, 2);
    var foundCaller = false;
    for (var ctor = me.constructor;
         ctor; ctor = ctor.superClass_ && ctor.superClass_.constructor) {
      if (ctor.prototype[opt_methodName] === caller) {
        foundCaller = true;
      } else if (foundCaller) {
        return ctor.prototype[opt_methodName].apply(me, args);
      }
    }

    // If we did not find the caller in the prototype chain,
    // then one of two things happened:
    // 1) The caller is an instance method.
    // 2) This method was not called by the right caller.
    if (me[opt_methodName] === caller) {
      return me.constructor.prototype[opt_methodName].apply(me, args);
    } else {
      throw Error(
          'base called from a method of one name ' +
          'to a method of a different name');
    }
  },
  
  noop: function(){},
  
  truefnc: function(){return true},
  
  falsefnc: function(){return true},
  
  resolve: function(value){
    var deferred = $.Deferred();
    deferred.resolve(value);
    return deferred.promise();
  },
  
  reject: function(value){
    var deferred = $.Deferred();
    deferred.reject(value);
    return deferred.promise();
  },
  
  Base64: Base64
};

module.exports = utils;

},{}],50:[function(require,module,exports){
var Control = function(options){
  var name = options.name || "?";
  this.name = name.split(' ').join('-').toLowerCase();
  this.id = this.name+'_'+(Math.floor(Math.random() * 1000000));
  
  if (!options.element) {
    var className = "ol-"+this.name.split(' ').join('-').toLowerCase();
    var tipLabel = options.tipLabel || this.name;
    var label = options.label || "?";
    
    options.element = $('<div class="'+className+' ol-unselectable ol-control"><button type="button" title="'+tipLabel+'">'+label+'</button></div>')[0];
  }
  
  var buttonClickHandler = options.buttonClickHandler || Control.prototype._handleClick.bind(this);
  
  $(options.element).on('click',buttonClickHandler);
  
  ol.control.Control.call(this,options);
  
  this._postRender();
}
ol.inherits(Control, ol.control.Control);


var proto = Control.prototype;

proto._handleClick = function(){
  var self = this;
  var map = this.getMap();
  
  var resetControl = null;
  // remove all the other, eventually toggled, interactioncontrols
  var controls = map.getControls();
  controls.forEach(function(control){
    if(control.id && control.toggle && (control.id != self.id)) {
      control.toggle(false);
      if (control.name == 'reset') {
        resetControl = control;
      }
    }
  });
  if (!self._toggled && resetControl) {
    resetControl.toggle(true);
  }
};

proto._postRender = function(){};

module.exports = Control;

},{}],51:[function(require,module,exports){
var Control = require('./control');

var InteractionControl = function(options){
  this._toggled = this._toggled || false;
  this._interactionClass = options.interactionClass || null;
  this._interaction = null;
  this._autountoggle = options.autountoggle || false;

  
  options.buttonClickHandler = InteractionControl.prototype._handleClick.bind(this);
  
  Control.call(this,options);
};
ol.inherits(InteractionControl, Control);

var proto = InteractionControl.prototype;

proto.toggle = function(toggle){
  var toggle = toggle !== undefined ? toggle : !this._toggled
  this._toggled = toggle;
  var map = this.getMap();
  var controlButton = $(this.element).find('button').first();
  
  if (toggle) {
    if (this._interaction) {
      //map.addInteraction(this._interaction);
      this._interaction.setActive(true);
    }
    controlButton.addClass('g3w-ol-toggled');
  }
  else {
    if (this._interaction) {
      //map.removeInteraction(this._interaction);
      this._interaction.setActive(false);
    }
    controlButton.removeClass('g3w-ol-toggled');
  }
};

proto.setMap = function(map) {
  if (!this._interaction) {
    this._interaction = new this._interactionClass;
    map.addInteraction(this._interaction);
    this._interaction.setActive(false);
  }
  Control.prototype.setMap.call(this,map);
};

proto._handleClick = function(e){
  this.toggle();
  Control.prototype._handleClick.call(this,e);
};

module.exports = InteractionControl;

},{"./control":50}],52:[function(require,module,exports){
var utils = require('../utils');
var InteractionControl = require('./interactioncontrol');

var PickCoordinatesInteraction = require('../interactions/pickcoordinatesinteraction');

var QueryControl = function(options){
  var self = this;
  var _options = {
    name: "querylayer",
    tipLabel: "Query layer",
    label: "\uea0f",
    interactionClass: PickCoordinatesInteraction
  };
  
  options = utils.merge(options,_options);
  
  InteractionControl.call(this,options);
}
ol.inherits(QueryControl, InteractionControl);

var proto = QueryControl.prototype;

proto.setMap = function(map) {
  var self = this;
  InteractionControl.prototype.setMap.call(this,map);
  this._interaction.on('boxstart',function(e){
    self._startCoordinate = e.coordinate;
  });
  
  this._interaction.on('picked',function(e){
    self.dispatchEvent({
      type: 'picked',
      coordinates: e.coordinate
    });
    if (self._autountoggle) {
      self.toggle();
    }
  });
};

module.exports = QueryControl;

},{"../interactions/pickcoordinatesinteraction":56,"../utils":61,"./interactioncontrol":51}],53:[function(require,module,exports){
var utils = require('../utils');
var InteractionControl = require('./interactioncontrol');

var ResetControl = function(options){
  var self = this;
  this._toggled = true;
  this._startCoordinate = null;
  var _options = {
      name: "reset",
      tipLabel: "Pan",
      label: "\ue901",
    };
  
  options = utils.merge(options,_options);
  
  InteractionControl.call(this,options);
}
ol.inherits(ResetControl, InteractionControl);
module.exports = ResetControl;

var proto = ResetControl.prototype;

proto._postRender = function(){
  this.toggle(true);
};

},{"../utils":61,"./interactioncontrol":51}],54:[function(require,module,exports){
var utils = require('../utils');
var InteractionControl = require('./interactioncontrol');

var ZoomBoxControl = function(options){
  var self = this;
  this._startCoordinate = null;
  var _options = {
      name: "zoombox",
      tipLabel: "Zoom to box",
      label: "\ue900",
      interactionClass: ol.interaction.DragBox
    };
  
  options = utils.merge(options,_options);
  
  InteractionControl.call(this,options);
}
ol.inherits(ZoomBoxControl, InteractionControl);
module.exports = ZoomBoxControl;

var proto = ZoomBoxControl.prototype;

proto.setMap = function(map) {
  var self = this;
  InteractionControl.prototype.setMap.call(this,map);
  this._interaction.on('boxstart',function(e){
    self._startCoordinate = e.coordinate;
  });
  
  this._interaction.on('boxend',function(e){
    var start_coordinate = self._startCoordinate;
    var end_coordinate = e.coordinate;
    var extent = ol.extent.boundingExtent([start_coordinate,end_coordinate]);
    self.dispatchEvent({
      type: 'zoomend',
      extent: extent
    });
    self._startCoordinate = null;
    if (self._autountoggle) {
      self.toggle();
    }
  })
};

},{"../utils":61,"./interactioncontrol":51}],55:[function(require,module,exports){
var utils = require('./utils');
var maphelpers = require('./map/maphelpers');

(function (name, root, factory) {
  if (typeof define === 'function' && define.amd) {
    define(factory);
  }
  else if (typeof exports === 'object') {
    module.exports = factory();
  }
  else {
    root[name] = factory();
  }
})('g3wol3', this, function () {
  'use strict';
  
  var helpers = utils.merge({},maphelpers);
  
  return {
    helpers: helpers
  }
});

},{"./map/maphelpers":60,"./utils":61}],56:[function(require,module,exports){
var PickCoordinatesEventType = {
  PICKED: 'picked'
};

var PickCoordinatesEvent = function(type, coordinate) {
  this.type = type;
  this.coordinate = coordinate;
};

var PickCoordinatesInteraction = function(options) {
  this.previousCursor_ = null;
  
  ol.interaction.Pointer.call(this, {
    handleDownEvent: PickCoordinatesInteraction.handleDownEvent_,
    handleUpEvent: PickCoordinatesInteraction.handleUpEvent_,
    handleMoveEvent: PickCoordinatesInteraction.handleMoveEvent_,
  });
};
ol.inherits(PickCoordinatesInteraction, ol.interaction.Pointer);

PickCoordinatesInteraction.handleDownEvent_ = function(event) {
  return true;
};

PickCoordinatesInteraction.handleUpEvent_ = function(event) {
  this.dispatchEvent(
          new PickCoordinatesEvent(
              PickCoordinatesEventType.PICKED,
              event.coordinate));
  return true;
};

PickCoordinatesInteraction.handleMoveEvent_ = function(event) {
  var elem = event.map.getTargetElement();
  elem.style.cursor =  'pointer';
};

PickCoordinatesInteraction.prototype.shouldStopEvent = function(){
  return false;
};

PickCoordinatesInteraction.prototype.setMap = function(map){
  if (!map) {
    var elem = this.getMap().getTargetElement();
    elem.style.cursor = '';
  }
  ol.interaction.Pointer.prototype.setMap.call(this,map);
};

module.exports = PickCoordinatesInteraction;

},{}],57:[function(require,module,exports){
  var PickFeatureEventType = {
  PICKED: 'picked'
};

var PickFeatureEvent = function(type, coordinate, feature) {
  this.type = type;
  this.feature = feature;
  this.coordinate = coordinate;
};

var PickFeatureInteraction = function(options) {
  ol.interaction.Pointer.call(this, {
    handleDownEvent: PickFeatureInteraction.handleDownEvent_,
    handleUpEvent: PickFeatureInteraction.handleUpEvent_,
    handleMoveEvent: PickFeatureInteraction.handleMoveEvent_,
  });
  
  this.features_ = options.features || null;
  
  this.layers_ = options.layers || null;
  
  this.pickedFeature_ = null;
  
  var self = this;
  this.layerFilter_ = function(layer) {
    return _.includes(self.layers_, layer);
  };
};
ol.inherits(PickFeatureInteraction, ol.interaction.Pointer);

PickFeatureInteraction.handleDownEvent_ = function(event) {
  this.pickedFeature_ = this.featuresAtPixel_(event.pixel, event.map);
  return true;
};

PickFeatureInteraction.handleUpEvent_ = function(event) {
  if(this.pickedFeature_){
    this.dispatchEvent(
            new PickFeatureEvent(
                PickFeatureEventType.PICKED,
                event.coordinate,
                this.pickedFeature_));
  }
  return true;
};

PickFeatureInteraction.handleMoveEvent_ = function(event) {
  var elem = event.map.getTargetElement();
  var intersectingFeature = this.featuresAtPixel_(event.pixel, event.map);

  if (intersectingFeature) {
    elem.style.cursor =  'pointer';
  } else {
    elem.style.cursor = '';
  }
};

PickFeatureInteraction.prototype.featuresAtPixel_ = function(pixel, map) {
  var found = null;

  var intersectingFeature = map.forEachFeatureAtPixel(pixel,
      function(feature) {
        if (this.features_) {
          if (this.features_.indexOf(feature) > -1){
            return feature
          }
          else{
            return null;
          }
        }
        return feature;
      },this,this.layerFilter_);
  
  if(intersectingFeature){
    found = intersectingFeature;
  }
  return found;
};

PickFeatureInteraction.prototype.shouldStopEvent = function(){
  return false;
};

PickFeatureInteraction.prototype.setMap = function(map){
  if (!map) {
    var elem = this.getMap().getTargetElement();
    elem.style.cursor = '';
  }
  ol.interaction.Pointer.prototype.setMap.call(this,map);
};

module.exports = PickFeatureInteraction;

},{}],58:[function(require,module,exports){
var BaseLayers = {};

BaseLayers.OSM = new ol.layer.Tile({
  source: new ol.source.OSM({
    attributions: [
      new ol.Attribution({
        html: 'All maps &copy; ' +
            '<a href="http://www.openstreetmap.org/">OpenStreetMap</a>'
      }),
      ol.source.OSM.ATTRIBUTION
    ],
    url: 'http://{a-c}.tile.openstreetmap.org/{z}/{x}/{y}.png',
    crossOrigin: null
  }),
  id: 'osm',
  title: 'OSM',
  basemap: true
});

BaseLayers.BING = {};

BaseLayers.BING.Road = new ol.layer.Tile({
  name:'Road',
  visible: false,
  preload: Infinity,
  source: new ol.source.BingMaps({
    key: 'Am_mASnUA-jtW3O3MxIYmOOPLOvL39dwMvRnyoHxfKf_EPNYgfWM9imqGETWKGVn',
    imagerySet: 'Road'
      // use maxZoom 19 to see stretched tiles instead of the BingMaps
      // "no photos at this zoom level" tiles
      // maxZoom: 19
  }),
  basemap: true
});

BaseLayers.BING.AerialWithLabels = new ol.layer.Tile({
  name: 'AerialWithLabels',
  visible: true,
  preload: Infinity,
  source: new ol.source.BingMaps({
    key: 'Am_mASnUA-jtW3O3MxIYmOOPLOvL39dwMvRnyoHxfKf_EPNYgfWM9imqGETWKGVn',
    imagerySet: 'AerialWithLabels'
      // use maxZoom 19 to see stretched tiles instead of the BingMaps
      // "no photos at this zoom level" tiles
      // maxZoom: 19
  }),
  basemap: true
});

BaseLayers.BING.Aerial = new ol.layer.Tile({
  name: 'Aerial',
  visible: false,
  preload: Infinity,
  source: new ol.source.BingMaps({
    key: 'Am_mASnUA-jtW3O3MxIYmOOPLOvL39dwMvRnyoHxfKf_EPNYgfWM9imqGETWKGVn',
    imagerySet: 'Aerial'
      // use maxZoom 19 to see stretched tiles instead of the BingMaps
      // "no photos at this zoom level" tiles
      // maxZoom: 19
  }),
  basemap: true
});

module.exports = BaseLayers;

},{}],59:[function(require,module,exports){
var utils = require('../utils');
var RasterLayers = {};

RasterLayers.TiledWMSLayer = function(layerObj,extraParams){
  var options = {
    layerObj: layerObj,
    extraParams: extraParams || {},
    tiled: true
  }
  return RasterLayers._WMSLayer(options);
};

RasterLayers.WMSLayer = function(layerObj,extraParams){
  var options = {
    layerObj: layerObj,
    extraParams: extraParams || {}
  }
  return RasterLayers._WMSLayer(options);
};

RasterLayers._WMSLayer = function(options){
  var layerObj = options.layerObj;
  var extraParams = options.extraParams;
  var tiled = options.tiled || false;
  
  var params = {
    LAYERS: layerObj.layers || '',
    VERSION: '1.3.0',
    TRANSPARENT: true,
    SLD_VERSION: '1.1.0'
  };
  
  params = utils.merge(params,extraParams);
  
  var sourceOptions = {
    url: layerObj.url,
    params: params,
    ratio: 1
  };
  
  var imageOptions = {
    id: layerObj.id,
    name: layerObj.name,
    opacity: layerObj.opacity || 1.0,
    visible:layerObj.visible,
    maxResolution: layerObj.maxResolution
  }
  
  var imageClass;
  var source;
  if (tiled) {
    source = new ol.source.TileWMS(sourceOptions);
    imageClass = ol.layer.Tile;
    //imageOptions.extent = [1134867,3873002,2505964,5596944];
  }
  else {
    source = new ol.source.ImageWMS(sourceOptions)
    imageClass = ol.layer.Image;
  }
  
  imageOptions.source = source;
  
  var layer = new imageClass(imageOptions);
  
  return layer;
};

/*RasterLayers.TiledWMSLayer = function(layerObj){
  var layer = new ol.layer.Tile({
    name: layerObj.name,
    opacity: 1.0,
    source: new ol.source.TileWMS({
      url: layerObj.url,
      params: {
        LAYERS: layerObj.layers || '',
        VERSION: '1.3.0',
        TRANSPARENT: true
      }
    }),
    visible: layerObj.visible
  });
  
  return layer;
};*/

module.exports = RasterLayers;


},{"../utils":61}],60:[function(require,module,exports){
BaseLayers = require('../layers/bases');

var MapHelpers = {
  createViewer: function(opts){
    return new _Viewer(opts);
  }
};

var _Viewer = function(opts){
  var controls = ol.control.defaults({
    attributionOptions: {
      collapsible: false
    },
    zoom: false,
    attribution: false
  });//.extend([new ol.control.Zoom()]);
  
  var interactions = ol.interaction.defaults()
    .extend([
      new ol.interaction.DragRotate()
    ]);
  interactions.removeAt(1) // rimuovo douclickzoom
  
  var view;
  if (opts.view instanceof ol.View) {
    view = opts.view;
  }
  else {
    view = new ol.View(opts.view);
  }
  var options = {
    controls: controls,
    interactions: interactions,
    ol3Logo: false,
    view: view,
    keyboardEventTarget: document
  };
  if (opts.id){
    options.target = opts.id;
  }
  var map  = new ol.Map(options);
  this.map = map;
};

_Viewer.prototype.destroy = function(){
  if (this.map) {
    this.map.dispose();
    this.map = null
  }
};

_Viewer.prototype.getView = function() {
  return this.map.getView();
}

_Viewer.prototype.updateMap = function(mapObject){};

_Viewer.prototype.updateView = function(){};

_Viewer.prototype.getMap = function(){
  return this.map;
};

_Viewer.prototype.setTarget = function(id){
  this.map.setTarget(id);
};

_Viewer.prototype.goTo = function(coordinates, zoom){
  var options = options || {};
  var animate = options.animate || true;
  var view = this.map.getView();
  
  if (animate) {
    var pan = ol.animation.pan({
      duration: 500,
      source: view.getCenter()
    });
    var zoom = ol.animation.zoom({
      duration: 500,
      resolution: view.getResolution()
    });
    this.map.beforeRender(pan,zoom);
  }
  
  view.setCenter(coordinates);
  view.setZoom(zoom);
};

_Viewer.prototype.goToRes = function(coordinates, resolution){
  var options = options || {};
  var animate = options.animate || true;
  var view = this.map.getView();
  
  if (animate) {
    var pan = ol.animation.pan({
      duration: 500,
      source: view.getCenter()
    });
    var zoom = ol.animation.zoom({
      duration: 500,
      resolution: view.getResolution()
    });
    this.map.beforeRender(pan,zoom);
  }

  view.setCenter(coordinates);
  view.setResolution(resolution);
};

_Viewer.prototype.fit = function(geometry, options){
  var view = this.map.getView();
  
  var options = options || {};
  var animate = options.animate || true;
  
  if (animate) {
    var pan = ol.animation.pan({
      duration: 500,
      source: view.getCenter()
    });
    var zoom = ol.animation.zoom({
      duration: 500,
      resolution: view.getResolution()
    });
    this.map.beforeRender(pan,zoom);
  }
  
  if (options.animate) {
    delete options.animate; // non lo passo al metodo di OL3 perché è un'opzione interna
  }
  options.constrainResolution = options.constrainResolution || false;
  
  view.fit(geometry,this.map.getSize(),options);
};

_Viewer.prototype.getZoom = function(){
  var view = this.map.getView();
  return view.getZoom();
};

_Viewer.prototype.getResolution = function(){
  var view = this.map.getView();
  return view.getResolution();
};

_Viewer.prototype.getCenter = function(){
  var view = this.map.getView();
  return view.getCenter();
};

_Viewer.prototype.getBBOX = function(){
  return this.map.getView().calculateExtent(this.map.getSize());
};

_Viewer.prototype.getLayerByName = function(layerName) {
  var layers = this.map.getLayers();
  var length = layers.getLength();
  for (var i = 0; i < length; i++) {
    if (layerName === layers.item(i).get('name')) {
      return layers.item(i);
    }
  }
  return null;
};

_Viewer.prototype.removeLayerByName = function(layerName){
  var layer = this.getLayerByName(layerName);
  if (layer){
    this.map.removeLayer(layer);
    delete layer;
  }
};

_Viewer.prototype.getActiveLayers = function(){
  var activelayers = [];
  this.map.getLayers().forEach(function(layer) {
    var props = layer.getProperties();
    if (props.basemap != true && props.visible){
       activelayers.push(layer);
    }
  });
  
  return activelayers;
};

_Viewer.prototype.removeLayers = function(){
  this.map.getLayers().clear();
};

_Viewer.prototype.getLayersNoBase = function(){
  var layers = [];
  this.map.getLayers().forEach(function(layer) {
    var props = layer.getProperties();
    if (props.basemap != true){
      layers.push(layer);
    }
  });
  
  return layers;
};

_Viewer.prototype.addBaseLayer = function(type){
  var layer;
  type ? layer = BaseLayers[type]:  layer = BaseLayers.BING.Aerial;
  this.map.addLayer(layer);
};

_Viewer.prototype.changeBaseLayer = function(layerName){
  var baseLayer = this.getLayerByName(layername);
  var layers = this.map.getLayers();
  layers.insertAt(0, baseLayer);
};

module.exports = MapHelpers;

},{"../layers/bases":58}],61:[function(require,module,exports){
var utils = {
  merge: function(obj1,obj2){
    var obj3 = {};
    for (var attrname in obj1) { obj3[attrname] = obj1[attrname]; }
    for (var attrname in obj2) { obj3[attrname] = obj2[attrname]; }
    return obj3;
  }
}

module.exports = utils;

},{}],62:[function(require,module,exports){
module.exports = "<!-- item template -->\n<div id=\"catalog\" class=\"tabbable-panel catalog\">\n  <div class=\"tabbable-line\">\n    <ul class=\"nav nav-tabs\" role=\"tablist\">\n      <li role=\"presentation\" class=\"active\"><a href=\"#tree\" aria-controls=\"tree\" role=\"tab\" data-toggle=\"tab\" data-i18n=\"tree\">Data</a></li>\n      <li v-if=\"hasBaseLayers\" role=\"presentation\"><a href=\"#baselayers\" aria-controls=\"baselayers\" role=\"tab\" data-toggle=\"tab\" data-i18n=\"baselayers\">Layer Base</a></li>\n      <li role=\"presentation\"><a href=\"#legend\" aria-controls=\"legend\" role=\"tab\" data-toggle=\"tab\" data-i18n=\"legend\">Legenda</a></li>\n    </ul>\n    <div  class=\"tab-content\">\n      <div role=\"tabpanel\" class=\"tab-pane active tree\" id=\"tree\">\n        <ul class=\"tree-root\">\n          <tristate-tree v-if=\"!isHidden\" :layerstree=\"layerstree\" class=\"item\" v-for=\"layerstree in layerstree\">\n          </tristate-tree>\n        </ul>\n      </div>\n      <div v-if=\"hasBaseLayers\" role=\"tabpanel\" class=\"tab-pane baselayers\" id=\"baselayers\">\n        <form>\n          <ul>\n            <li v-if=\"!baselayer.fixed\" v-for=\"baselayer in baselayers\">\n              <div class=\"radio\">\n                <label><input type=\"radio\" name=\"baselayer\" v-checked=\"baselayer.visible\" @click=\"setBaseLayer(baselayer.id)\">{{ baselayer.title }}</label>\n              </div>\n            </li>\n          </ul>\n        </form>\n      </div>\n      <legend :layerstree=\"layerstree\"></legend>\n    </div>\n  </div>\n</div>\n";

},{}],63:[function(require,module,exports){
var inherit = require('core/utils/utils').inherit;
var base = require('core/utils/utils').base;
var merge = require('core/utils/utils').merge;
var t = require('core/i18n/i18n.service').t;
var resolve = require('core/utils/utils').resolve;
var Component = require('gui/vue/component');
var GUI = require('gui/gui');
var ProjectsRegistry = require('core/project/projectsregistry');

var vueComponentOptions = {
  template: require('./catalog.html'),
  data: function() {
    return {
      project: ProjectsRegistry.getCurrentProject()
    }
  },
  computed: {
    layerstree: function(){
      return this.project.state.layerstree;
    },
    baselayers: function(){
      return this.project.state.baselayers;
    },
    hasBaseLayers: function(){
      return this.project.state.baselayers.length>0;
    }
  },
  methods: {
    setBaseLayer: function(id) {
      this.project.setBaseLayer(id);
    }
  },
  ready: function() {
    var self = this;
    this.$on('treenodetoogled',function(node){
      self.project.toggleLayer(node);
    });

    this.$on('treenodestoogled',function(nodes,parentChecked){
      self.project.toggleLayers(nodes,parentChecked);
    });
    
    this.$on('treenodeselected',function(node){
      if (!node.selected) {
        self.project.selectLayer(node);
      } else {
        self.project.unselectLayer(node);
      }
    });
  }
}

// se lo voglio istanziare manualmente
var InternalComponent = Vue.extend(vueComponentOptions);

// se lo voglio usare come componente come elemento html
Vue.component('g3w-catalog', vueComponentOptions);


/* COMPONENTI FIGLI */

// tree component


Vue.component('tristate-tree', {
  template: require('./tristate-tree.html'),
  props: {
    layerstree: [],
    //eredito il numero di childs dal parent
    n_parentChilds : 0,
    checked: false
  },
  data: function () {
    return {
      expanded: this.layerstree.expanded,
      parentChecked: false,
      //proprieta che serve per fare confronto per il tristate
      n_childs: this.layerstree.nodes ? this.layerstree.nodes.length : 0
    }
  },
  watch: {
      'checked': function (val){
        this.layerstree.visible = val;
      }
  },
  computed: {
    isFolder: function () {
      var isFolder = this.n_childs ? true : false;
      if (isFolder) {
        var _visibleChilds = 0;
        _.forEach(this.layerstree.nodes,function(layer){
          if (layer.visible){
            _visibleChilds += 1;
          }
        });
        this.n_parentChilds = this.n_childs - _visibleChilds;
      }
      return isFolder
    },
    isHidden: function() {
      return this.layerstree.hidden && (this.layerstree.hidden === true);
    },
    selected: function() {
      var isSelected = this.layerstree.selected ? "SI" : "NO";
      console.log(isSelected);
      return isSelected;
    }
  },
  methods: {
    toggle: function (checkAllLayers) {
      var checkAll = checkAllLayers == 'true' ? true : false;
      if (this.isFolder && !checkAll) {
        this.layerstree.expanded = !this.layerstree.expanded;
      }
      else if (checkAll){
        if (this.parentChecked && !this.n_parentChilds){
          this.parentChecked = false;
        } else if (this.parentChecked && this.n_parentChilds) {
          this.parentChecked = true;
        }
        else {
          this.parentChecked = !this.parentChecked;
        }
        this.$dispatch('treenodestoogled',this.layerstree.nodes,this.parentChecked);
      }
      else {
        this.$dispatch('treenodetoogled',this.layerstree);
      }
    },
    select: function () {
      if (!this.isFolder) {
        this.$dispatch('treenodeselected',this.layerstree);
      }
    },
    triClass: function () {
      if (!this.n_parentChilds) {
        return 'fa-check-square-o';
      } else if ((this.n_parentChilds > 0) && (this.n_parentChilds < this.n_childs)) {
        return 'fa-square';
      } else {
        return 'fa-square-o';
      }
    }
  }
})

Vue.component('legend',{
    template: require('./legend.html'),
    props: ['layerstree'],
    data: function() {
      return {
        //data qui
      }
    },
    computed: {
      visiblelayers: function(){
        var _visiblelayers = [];
        var layerstree = this.layerstree;
        function traverse(obj){
        _.forIn(obj, function (layer, key) {
              //verifica che il valore dell'id non sia nullo
              if (!_.isNil(layer.id) && layer.visible) {
                  _visiblelayers.push(layer);
              }
              if (!_.isNil(layer.nodes)) {
                  traverse(layer.nodes);
              }
          });
        }
        traverse(layerstree);
        return _visiblelayers;
      }
    },
    watch: {
      'layerstree': {
        handler: function(val, old){
          //codice qui
        },
        deep: true
      }
    },
    ready: function() {
      //codice qui
    }
});

Vue.component('legend-item',{
  template: require('./legend_item.html'),
  props: ['layer'],
  computed: {
    legendurl: function(){
      // in attesa di risolvere lo schianto di QGSI Server...
      //return "http://localhost/cgi-bin/qgis_mapserv.fcgi?map=/home/giohappy/Scrivania/Dev/G3W/g3w-client/test/progetto/test.qgs&SERVICE=WMS&VERSION=1.3.0&REQUEST=GetLegendGraphic&FORMAT=image/png&LAYERTITLE=False&ITEMFONTSIZE=10&LAYER="+this.layer.name;
      return ProjectsRegistry.getCurrentProject().getLegendUrl(this.layer);
    }
  },
  methods: {
    // esempio utilizzo del servizio GUI
    openform: function(){
      //GUI.notify.success("Apro un form");
      //GUI.showForm();
    }
  }
});

/* FINE COMPONENTI FIGLI */

/* INTERFACCIA PUBBLICA */
function CatalogComponent(options){
  base(this);
  this.id = "catalog-component";
  this.title = "catalog";
  this.internalComponent = new InternalComponent;
  //mergio opzioni con proprità di default del componente
  merge(this, options);
}

inherit(CatalogComponent, Component);

module.exports = CatalogComponent;

},{"./catalog.html":62,"./legend.html":64,"./legend_item.html":65,"./tristate-tree.html":66,"core/i18n/i18n.service":31,"core/project/projectsregistry":42,"core/utils/utils":49,"gui/gui":71,"gui/vue/component":89}],64:[function(require,module,exports){
module.exports = "<div role=\"tabpanel\" class=\"tab-pane\" id=\"legend\">\n  <legend-item :layer=\"layer\" v-for=\"layer in visiblelayers\"></legend-item>\n</div>\n";

},{}],65:[function(require,module,exports){
module.exports = "<div @click=\"openform()\">{{ layer.title }}</div>\n<div><img :src=\"legendurl\"></div>\n";

},{}],66:[function(require,module,exports){
module.exports = "<li class=\"tree-item\" :class=\"{selected: layerstree.selected}\">\n  <span :class=\"{bold: isFolder, 'fa-chevron-down': layerstree.expanded, 'fa-chevron-right': !layerstree.expanded}\" @click=\"toggle\" v-if=\"isFolder\" class=\"fa\"></span>\n  <span v-if=\"isFolder\" @click=\"toggle('true')\" :class=\"[triClass()]\" class=\"fa\"></span>\n  <span v-else @click=\"toggle\" :class=\"[layerstree.visible  ? 'fa-check-square-o': 'fa-square-o',layerstree.disabled  ? 'disabled': '']\" class=\"fa\" style=\"cursor:default\"></span>\n  <span id=\"tree-node-title\" :class=\"{bold: isFolder, disabled: layerstree.disabled}\" @click=\"select\">{{layerstree.title}}</span>\n  <ul v-show=\"layerstree.expanded\" v-if=\"isFolder\">\n    <tristate-tree :n_parent-childs.sync=\"n_parentChilds\" :layerstree=\"layerstree\" :checked=\"parentChecked\" v-for=\"layerstree in layerstree.nodes\">\n    </tristate-tree>\n  </ul>\n</li>\n\n\n\n\n";

},{}],67:[function(require,module,exports){
var inherit = require('core/utils/utils').inherit;
var G3WObject = require('core/g3wobject');

var Component = function(options) {
  var options = options || {};
  this.internalComponent = null;
  this.id = options.id || Math.random() * 1000;
  this.title = options.title || ''
  this.state = {
    visible: options.visible || true,
    open: options.open || false
  }
};
inherit(Component,G3WObject);

var proto = Component.prototype;

proto.getId = function(){
  return this.id;
};

proto.getTitle = function(){
  return this.state.title;
};

proto.setTitle = function(title) {
  this.state.title = title;
};

//implementati due metodi per poter unificare il metodo di recupero del servizio
//legato al componente

proto.getService = function() {
  return this._service;
};

proto.setService = function(serviceInstance) {
  this._service = serviceInstance;
};

////////// fine metodi Service Components //////////

/* HOOKS */

/* 
 * Il metodo permette al componente di montarsi nel DOM
 * parentEl: elemento DOM padre, su cui inserirsi; 
 * ritorna una promise, risolta nel momento in cui sarà terminato il montaggio
*/
proto.mount = function(parent){};

/*
 * Metodo richiamato quando si vuole rimuovere il componente.
 * Ritorna una promessa che sarà risolta nel momento in cui il componente avrà completato la propria rimozione (ed eventuale rilascio di risorse dipendenti)
*/
proto.unmount = function(){};

/* 
 * Metodo (opzionale) che offre l'opportunità di ricalcolare proprietà dipendenti dalle dimensioni del padre
 * parentHeight: nuova altezza del parent
 * parentWidth: nuova larghezza del parent
 * richiamato ogni volta che il parent subisce un ridimensionamento
*/
proto.layout = function(parentWidth,parentHeight){};


module.exports = Component;

},{"core/g3wobject":28,"core/utils/utils":49}],68:[function(require,module,exports){
var G3WObject = require('core/g3wobject');
var inherit = require('core/utils/utils').inherit;
var base = require('core/utils/utils').base;

function ComponentsRegistry() {
  this.components = {};
  
  this.registerComponent = function(component) {
    var id = component.getId();
    if (!this.components[id]) {
      this.components[id] = component;
    }
  }; 
  
  this.getComponent = function(id) {
    return this.components[id];
  };
  
  this.unregisterComponent = function(id) {
    var component = this._components[id];
    if (component) {
      if (_.isFunction(component.destroy)) {
        component.destroy();
      }
      delete component;
      this._components[id] = null;
    }
  };
}
inherit(ComponentsRegistry,G3WObject);

module.exports = new ComponentsRegistry;

},{"core/g3wobject":28,"core/utils/utils":49}],69:[function(require,module,exports){
var inherit = require('core/utils/utils').inherit;
var resolve = require('core/utils/utils').resolve;
var reject = require('core/utils/utils').reject;
var GUI = require('gui/gui');
var Panel =  require('gui/panel');
var ProjectsRegistry = require('core/project/projectsregistry');

Vue.filter('startcase', function (value) {
  return _.startCase(value);
});

Vue.validator('email', function (val) {
  return /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(val)
});

Vue.validator('integer', function (val) {
  return /^(-?[1-9]\d*|0)$/.test(val);
})

var FormPanel = Vue.extend({
  template: require('./formpanel.html'),
  methods: {
    exec: function(cbk){
      var relations = this.state.relations || null;
      cbk(this.state.fields,relations);
      GUI.closeForm();
    },
    btnEnabled: function(button) {
      return button.type != 'save' || (button.type == 'save' && this.$validation.valid);
    },
    hasFieldsRequired: function() {
      return this.$options.form._hasFieldsRequired();
    },
    isEditable: function(field){
      return this.$options.form._isEditable(field);
    },
    isSimple: function(field){
      return this.$options.form._isSimple(field);
    },
    isSelect: function(field){
      return this.$options.form._isSelect(field);
    },
    isLayerPicker: function(field){
      return this.$options.form._isLayerPicker(field);
    },
    layerPickerPlaceHolder: function(field){
      return this.$options.form._getlayerPickerLayerName(field.input.options.layerid);
    },
    pickLayer: function(field){
      this.$options.form._pickLayer(field);
    },
    isVisible: function(field){
      return this.$options.form._isVisible(field);
    },
    showRelation: function(relation){
      return this.$options.form._shouldShowRelation(relation);
    }
  },
  computed: {
    isValid: function(field) {
      return this.$validate(field.name);
    },
  }
});

var Inputs = {};
Inputs.STRING = 'string';
Inputs.INTEGER = 'integer';
Inputs.FLOAT = 'float';

Inputs.defaults = {};
Inputs.defaults[Inputs.STRING] = "";
Inputs.defaults[Inputs.INTEGER] = 0;
Inputs.defaults[Inputs.FLOAT] = 0.0;
Inputs.simpleFieldTypes = [Inputs.STRING,Inputs.INTEGER,Inputs.FLOAT];

Inputs.SELECT = 'select';
Inputs.LAYERPICKER = 'layerpicker';

Inputs.specialInputs = [Inputs.SELECT,Inputs.LAYERPICKER];

function Form(options){
  // proprietà necessarie. In futuro le mettermo in una classe Panel da cui deriveranno tutti i pannelli che vogliono essere mostrati nella sidebar
  this.internalComponent = null;
  this.options =  options || {};
  this.id = options.id; // id del form
  this.name = options.name; // nome del form
  this.dataid = options.dataid; // "accessi", "giunzioni", ecc.
  this.pk = options.pk || null, // eventuale chiave primaria (non tutti i form potrebbero avercela o averne bisogno
  this.isnew = (!_.isNil(options.isnew) && _.isBoolean(options.isnew)) ? options.isnew : true;
  
  this.state = {
    // i dati del form possono avere o meno una primary key
    fields: options.fields,
    relations: options.relations
  }
  
  this._formPanel = options.formPanel || FormPanel;
  this._defaults = options.defaults || Inputs.defaults;
}
inherit(Form,Panel);

var proto = Form.prototype;

// viene richiamato dalla toolbar quando il plugin chiede di mostrare un proprio pannello nella GUI (GUI.showPanel)
proto.mount = function(container){
  this._setupFields();
  var panel = this._setupPanel();
  this._mountPanel(panel,container);
  return resolve(true);
};

// richiamato quando la GUI chiede di chiudere il pannello. Se ritorna false il pannello non viene chiuso
proto.unmount = function(){
  this.internalComponent.$destroy(true);
  this.internalComponent = null;
  return resolve(true);
};

proto._isNew = function(){
  return this.isnew;
};

proto._hasFieldsRequired = function() {
  var someFieldsRequired = _.some(this.state.fields,function(field){
    return field.validate && field.validate.required;
  });
  var someRelationsRequired = _.some(this.state.relations,function(relation){
    return relation.validate && relation.validate.required;
  });
  return someFieldsRequired || someRelationsRequired;
};

proto._isVisible = function(field){
  if(!field.editable && (field.value == "" || _.isNull(field.value))){
    return false
  }
  return true;
};

proto._isEditable = function(field){
  return field.editable;
};

proto._isSimple = function(field){
  if (_.includes(Inputs.specialInputs,field.input.type)){
    return false;
  }
  return _.includes(Inputs.simpleFieldTypes,field.type)
};

proto._isSelect = function(field){
  return (_.includes(Inputs.specialInputs,field.input.type) && field.input.type == Inputs.SELECT);
};

proto._isLayerPicker = function(field){
  return (_.includes(Inputs.specialInputs,field.input.type) && field.input.type == Inputs.LAYERPICKER);
};

proto._pickLayer = function(field){
  // ritorno una promessa, se qualcun altro volesse usare il risultato (es. per settare altri campi in base alla feature selezionata)
  var d = $.Deferred();
  // disabilito temporanemante lo strato modale per permettere l'interazione con la mappa
  GUI.setModal(false);
  var layerId = field.input.options.layerid;
  var relFieldName = field.input.options.field;
  var relFieldLabel = ProjectsRegistry.getCurrentProject().getLayerAttributeLabel(layerId,field.input.options.field);
  var mapService = GUI.getComponent('map').getService();
  mapService.getFeatureInfo(layerId)
  .then(function(attributes){
    var value = attributes[relFieldName] ? attributes[relFieldName] : attributes[relFieldLabel];
    field.value = value;
    d.resolve(attributes);
  })
  .always(function(){
    GUI.setModal(true);
    d.reject();
  });
  return d.promise();
};

proto._getDefaultValue = function(field){
  var defaultValue = null;
  if (field.input && field.input.options && field.input.options.default){
    defaultValue = field.input.options.default;
  }
  else if (this._isSelect(field)){
    defaultValue = field.input.options.values[0].key;
  }
  /*else {
    defaultValue = this._defaults[field.type];
  }*/
  return defaultValue;
};

proto._getlayerPickerLayerName = function(id){
  var layer = ProjectsRegistry.getCurrentProject().getLayer(id);
  if (layer){
    return layer.name;
  }
  return "";
};

proto._shouldShowRelation = function(relation){
  return true;
};

// per definire i valori di default nel caso si tratta di un nuovo inserimento
proto._setupFields = function(){
  var self = this;
  
  var fields = _.filter(this.state.fields,function(field){
    // tutti i campi eccetto la PK (se non nulla)
    if (self.pk && field.value==null){
      return ((field.name != self.pk));
    }
    return true;
  });
  
  _.forEach(fields,function(field){
    if(_.isNil(field.value)){
      var defaultValue = self._getDefaultValue(field);
      if (defaultValue){
        field.value = defaultValue;
      }
    }
  });
  
  if (this.state.relations){
    var relations = this.state.relations;
    _.forEach(relations,function(relation){
      _.forEach(relation.fields,function(field){
        if(_.isNil(field.value)){
          var defaultValue = self._getDefaultValue(field);
          if (defaultValue){
            field.value = defaultValue;
          }
        }
      });
    })
  }
};

proto._setupPanel = function(){
  var panel = this.internalComponent = new this._formPanel({
    form: this
  });
  if (this.options.buttons) {
    panel.buttons = this.options.buttons;
  }
  panel.state = this.state;
  return panel
};

proto._mountPanel = function(panel,container){
  panel.$mount().$appendTo(container);
};

proto._getField = function(fieldName){
  var field = null;
  _.forEach(this.state.fields,function(f){
    if (f.name == fieldName){
      field = f;
    }
  })
  return field;
};

proto._getRelationField = function(fieldName,relationName){
  var field = null;
  _.forEach(this.state.relations,function(relation,name){
    if (relationName == name){
      _.forEach(relation.fields,function(f){
        if (f.name == fieldName){
          field = f;
        }
      })
    }
  })
  return field;
};

module.exports = {
  Form: Form,
  FormPanel: FormPanel
}

},{"./formpanel.html":70,"core/project/projectsregistry":42,"core/utils/utils":49,"gui/gui":71,"gui/panel":77}],70:[function(require,module,exports){
module.exports = "<div>\n  <validator name=\"validation\">\n    <form novalidate class=\"form-horizontal g3w-form\">\n      <template v-for=\"field in state.fields\">\n        <div v-if=\"isVisible(field)\" class=\"form-group has-feedback\">\n          <label :for=\"field.name\" class=\"col-sm-4 control-label\">{{ field.label }}<span v-if=\"field.validate && field.validate.required\">*</span></label>\n          <div class=\"col-sm-8\">\n            <input v-if=\"isSimple(field)\" :field=\"field.name\" v-validate=\"field.validate\" v-disabled=\"!isEditable(field)\" class=\"form-control\" v-model=\"field.value\" :id=\"field.name\" :placeholder=\"field.input.label\">\n            <select v-if=\"isSelect(field)\" :field=\"field.name\" v-validate=\"field.validate\" v-disabled=\"!isEditable(field)\" class=\"form-control\" v-model=\"field.value\" :id=\"field.name\" :placeholder=\"field.input.label\">\n              <option v-for=\"value in field.input.options.values\" value=\"{{ value.key }}\">{{ value.value }}</option>\n            </select>\n            <div v-if=\"isLayerPicker(field)\">\n              <input class=\"form-control\" @click=\"pickLayer(field)\" :field=\"field.name\" v-validate=\"field.validate\" v-disabled=\"!isEditable(field)\" onfocus=\"blur()\" data-toggle=\"tooltip\" title=\"Ottieni il dato da un elemento del layer '{{ layerPickerPlaceHolder(field) }}'\" v-model=\"field.value\" :id=\"field.name\" :placeholder=\"'['+layerPickerPlaceHolder(field)+']'\">\n              <i class=\"glyphicon glyphicon-screenshot form-control-feedback\"></i>\n            </div>\n          </div>\n        </div>\n      </template>\n      <div v-for=\"relation in state.relations\">\n        <div v-if=\"showRelation(relation)\" transition=\"expand\">\n          <div class=\"g3w-relationname\">{{ relation.name | startcase }}</div>\n          <template v-for=\"relfield in relation.fields\">\n            <div v-if=\"isVisible(relfield)\" class=\"form-group has-feedback\">\n              <label :for=\"relfield.name\" class=\"col-sm-4 control-label\">{{relfield.label}}<span v-if=\"relfield.validate && relfield.validate.required\">*</span></label>\n              <div class=\"col-sm-8\">\n                <input v-if=\"isSimple(relfield)\" :field=\"relfield.name\" v-validate=\"relfield.validate\" v-disabled=\"!isEditable(relfield)\" class=\"form-control\" v-model=\"relfield.value\" :id=\"relfield.name\" :placeholder=\"relfield.input.label\">\n                <select v-if=\"isSelect(relfield)\" :field=\"relfield.name\" v-validate=\"relfield.validate\" v-disabled=\"!isEditable(relfield)\" class=\"form-control\" v-model=\"relfield.value\" :id=\"relfield.name\" :placeholder=\"relfield.input.label\">\n                  <option v-for=\"relvalue in relfield.input.options.values\" value=\"{{ relvalue.key }}\">{{ relvalue.value }}</option>\n                </select>\n                <div v-if=\"isLayerPicker(relfield)\">\n                  <input class=\"form-control\" @click=\"pickLayer(relfield)\" :field=\"relfield.name\" v-validate=\"relfield.validate\" v-disabled=\"!isEditable(relfield)\" onfocus=\"blur()\" style=\"cursor:pointer\" data-toggle=\"tooltip\" title=\"Ottieni il dato da un elemento del layer '{{ layerPickerPlaceHolder(relfield) }}'\" v-model=\"relfield.value\" :id=\"relfield.name\" :placeholder=\"'['+layerPickerPlaceHolder(relfield)+']'\">\n                  <i class=\"glyphicon glyphicon-screenshot form-control-feedback\"></i>\n                </div>\n              </div>\n            </div>\n          </template>\n        </div>\n      </div>\n      <div class=\"form-group\">\n        <div class=\"col-sm-offset-4 col-sm-8\">\n          <div v-if=\"hasFieldsRequired\" style=\"margin-bottom:10px\">\n            <span>* Campi richiesti</span>\n          </div>\n          <span v-for=\"button in buttons\">\n            <button class=\"btn \" :class=\"[button.class]\" @click.stop.prevent=\"exec(button.cbk)\" v-disabled=\"!btnEnabled(button)\">{{ button.title }}</button>\n          </span>\n        </div>\n      </div>\n    </form>\n  </validator>\n</div>\n";

},{}],71:[function(require,module,exports){
var noop = require('core/utils/utils').noop;
var inherit = require('core/utils/utils').inherit;
var G3WObject = require('core/g3wobject');
var ComponentsRegistry = require('gui/componentsregistry');

// rappresenta l'interfaccia globale dell'API della GUI. 
// metodi devono essere implementati (definiti) dall'applicazione ospite
// l'app ospite dovrebbe chiamare anche la funzione GUI.ready() quando la UI è pronta
function GUI(){
  this.ready = false;
  // url delle risorse (immagini, ecc.)
  this.getResourcesUrl = noop;
  // show a Vue form
  this.showForm = noop;
  this.closeForm = noop;
  
  // mostra una lista di oggetti (es. lista di risultati)
  this.showListing = noop;
  this.closeListing = noop;
  this.hideListing = noop;
  
  // options conterrà i vari dati sui risultati. Sicuramente avrà la prprietà options.features
  // nel caso di queryByLocation avrà anche options.coordinate
  this.showQueryResults = function(options) {};
  this.hideQueryResults = noop;

  /* panel */
  this.showPanel = noop;
  this.hidePanel = noop;

  //metodi componente
  // aggiunge (e registra) un componente in un placeholder del template - Metodo implementato dal template
  this.addComponent = function(component,placeholder) {};
  this.removeComponent = function(id) {};
  // registra globalmente un componente (non legato ad uno specifico placeholder. Es. componente per mostrare risultati interrogazion)
  this.setComponent = function(component) {
    ComponentsRegistry.registerComponent(component);
  };
  this.getComponent = function(id) {
    return ComponentsRegistry.getComponent(id);
  };
  //fine metodi componente

  this.ready = function(){
    this.emit('ready');
    this.ready = true;
  };
  
  this.guiResized = function(){
    this.emit('guiresized');
  };

  /* spinner */
  GUI.showSpinner = function(options){};

  GUI.hideSpinner = function(id){};

  
  this.notify = noop;
  this.dialog = noop;
}

inherit(GUI,G3WObject);

module.exports = new GUI;

},{"core/g3wobject":28,"core/utils/utils":49,"gui/componentsregistry":68}],72:[function(require,module,exports){
module.exports = "<div>\n  Lista di oggetti\n</div>\n";

},{}],73:[function(require,module,exports){
var resolve = require('core/utils/utils').resolve;
var reject = require('core/utils/utils').reject;
var GUI = require('gui/gui');
//var MapService = require('core/map/mapservice');

var ListPanelComponent = Vue.extend({
  template: require('./listpanel.html'),
  methods: {
    exec: function(cbk){
      var relations = this.state.relations || null;
      cbk(this.state.fields,relations);
      GUI.closeForm();
    }
  }
});


function ListPanel(options){
  // proprietà necessarie. In futuro le mettermo in una classe Panel da cui deriveranno tutti i pannelli che vogliono essere mostrati nella sidebar
  this.panelComponent = null;
  this.options =  options || {};
  this.id = options.id || null; // id del form
  this.name = options.name || null; // nome del form
  
  this.state = {
    list: options.list || []
  }
  
  this._listPanelComponent = options.listPanelComponent || ListPanelComponent;
}

var proto = ListPanel.prototype;

// viene richiamato dalla toolbar quando il plugin chiede di mostrare un proprio pannello nella GUI (GUI.showPanel)
proto.onShow = function(container){
  var panel = this._setupPanel();
  this._mountPanel(panel,container);
  return resolve(true);
};

// richiamato quando la GUI chiede di chiudere il pannello. Se ritorna false il pannello non viene chiuso
proto.onClose = function(){
  this.panelComponent.$destroy(true);
  this.panelComponent = null;
  return resolve(true);
};

proto._setupPanel = function(){
  var panel = this.panelComponent = new this._listPanelComponent({
    panel: this
  });
  panel.state = this.state;
  return panel
};

proto._mountPanel = function(panel,container){
  panel.$mount().$appendTo(container);
};

module.exports = {
  ListPanelComponent: ListPanelComponent,
  ListPanel: ListPanel
}

},{"./listpanel.html":72,"core/utils/utils":49,"gui/gui":71}],74:[function(require,module,exports){
var inherit = require('core/utils/utils').inherit;
var base = require('core/utils/utils').base;
var G3WObject = require('core/g3wobject');
var GUI = require('gui/gui');
var ApplicationService = require('core/applicationservice');
var ProjectsRegistry = require('core/project/projectsregistry');
var ProjectTypes = require('core/project/projecttypes');
var GeometryTypes = require('core/geometry/geometry').GeometryTypes;
var ol3helpers = require('g3w-ol3/src/g3w.ol3').helpers;
var ResetControl = require('g3w-ol3/src/controls/resetcontrol');
var QueryControl = require('g3w-ol3/src/controls/querycontrol');
var ZoomBoxControl = require('g3w-ol3/src/controls/zoomboxcontrol');
var PickCoordinatesInteraction = require('g3w-ol3/src/interactions/pickcoordinatesinteraction');
var WMSLayer = require('core/layer/wmslayer');
var QueryService = require('core/query/queryservice');


//var GUI = require('gui/gui'); // QUESTO NON CI DEVE ESSERE!!!

var PickToleranceParams = {};
PickToleranceParams[ProjectTypes.QDJANGO] = {};
PickToleranceParams[ProjectTypes.QDJANGO][GeometryTypes.POINT] = "FI_POINT_TOLERANCE";
PickToleranceParams[ProjectTypes.QDJANGO][GeometryTypes.LINESTRING] = "FI_LINE_TOLERANCE";
PickToleranceParams[ProjectTypes.QDJANGO][GeometryTypes.POLYGON] = "FI_POLYGON_TOLERANCE";

var PickToleranceValues = {}
PickToleranceValues[GeometryTypes.POINT] = 5;
PickToleranceValues[GeometryTypes.LINESTRING] = 5;
PickToleranceValues[GeometryTypes.POLYGON] = 5;

function MapService(project){
  var self = this;
  this.config;
  this.viewer;
  this.target;
  this._mapControls = [],
  this.mapLayers = {};
  this.mapBaseLayers = {};
  this.layersAssociation = {};
  this.layersExtraParams = {};
  this.state = {
      bbox: [],
      resolution: null,
      center: null,
      loading: false
  };
  this.config = ApplicationService.getConfig().map;
  
  this._howManyAreLoading = 0;
  this._incrementLoaders = function(){
    if (this._howManyAreLoading == 0){
      this.emit('loadstart');
    }
    this._howManyAreLoading += 1;
  };
  
  this._decrementLoaders = function(){
    this._howManyAreLoading -= 1;
    if (this._howManyAreLoading == 0){
      this.emit('loadend');
    }
  };
  
  this._interactionsStack = [];
  if(!_.isNil(project)) {
    this.project = project;
  }
  else {
    this.project = ProjectsRegistry.getCurrentProject();
  }

  
  this.setters = {
    setMapView: function(bbox,resolution,center){
      this.state.bbox = bbox;
      this.state.resolution = resolution;
      this.state.center = center;
      this.updateMapLayers(this.mapLayers);
    },
    setupViewer: function(initialResolution){
      //$script("http://epsg.io/"+ProjectService.state.project.crs+".js");
      proj4.defs("EPSG:"+self.project.state.crs,this.project.state.proj4);
      if (self.viewer) {
        self.viewer.destroy();
        self.viewer = null;
      }
      self._setupViewer(initialResolution);
      self.setupControls();
      self.setupLayers();
      self.emit('viewerset');
    }
  };
  
  this._setupViewer = function(initialResolution){
    var extent = this.project.state.extent;
    var projection = new ol.proj.Projection({
      code: "EPSG:"+this.project.state.crs,
      extent: extent
    });
    
    /*var constrain_extent;
    if (this.config.constraintextent) {
      var extent = this.config.constraintextent;
      var dx = extent[2]-extent[0];
      var dy = extent[3]-extent[1];
      var dx4 = dx/4;
      var dy4 = dy/4;
      var bbox_xmin = extent[0] + dx4;
      var bbox_xmax = extent[2] - dx4;
      var bbox_ymin = extent[1] + dy4;
      var bbox_ymax = extent[3] - dy4;
      
      constrain_extent = [bbox_xmin,bbox_ymin,bbox_xmax,bbox_ymax];
    }*/
    
    this.viewer = ol3helpers.createViewer({
      id: this.target,
      view: {
        projection: projection,
        /*center: this.config.initcenter || ol.extent.getCenter(extent),
        zoom: this.config.initzoom || 0,
        extent: this.config.constraintextent || extent,
        minZoom: this.config.minzoom || 0, // default di OL3 3.16.0
        maxZoom: this.config.maxzoom || 28 // default di OL3 3.16.0*/
        center: ol.extent.getCenter(extent),
        extent: extent,
        //minZoom: 0, // default di OL3 3.16.0
        //maxZoom: 28 // default di OL3 3.16.0
        maxResolution: initialResolution
      }
    });
    
    this.viewer.map.getInteractions().forEach(function(interaction){
      self._watchInteraction(interaction);
    });
    
    this.viewer.map.getInteractions().on('add',function(interaction){
      self._watchInteraction(interaction.element);
    })
    
    this.viewer.map.getInteractions().on('remove',function(interaction){
      //self._onRemoveInteraction(interaction);
    });
  
    
    this.viewer.map.getView().setResolution(initialResolution);
    
    this.viewer.map.on('moveend',function(e){
      self._setMapView();
    });

    //AL MOMENTO LASCIO COSÌ POI VEDIAMO
    QueryService.init(this.viewer.map);

    this.emit('ready');
  };
  
  this.project.on('projectswitch',function(){
    self.setupLayers();
  });
  
  this.project.onafter('setLayersVisible',function(layers){
    var mapLayers = _.map(layers,function(layer){
      return self.getMapLayerForLayer(layer);
    })
    self.updateMapLayers(mapLayers);
  });
  
  this.project.onafter('setBaseLayer',function(){
    self.updateMapLayers(self.mapBaseLayers);
  });
  
  base(this);
};

inherit(MapService,G3WObject);

var proto = MapService.prototype;

// rende questo mapservice slave di un altro MapService
proto.slaveOf = function(mapService, sameLayers){
  // se impostare i layer iniziali uguali a quelli del mapService master
  var sameLayers = sameLayers || false;
};

proto.setLayersExtraParams = function(params,update){
  this.layersExtraParams = _.assign(this.layersExtraParams,params);
  this.emit('extraParamsSet',params,update);
};

proto.getMap = function() {
  return this.viewer.map;
};

proto.getViewerElement = function(){
  return this.viewer.map.getTargetElement();
};

proto.getViewport = function(){
  return this.viewer.map.getViewport();
};

proto.setupControls = function(){
  var self = this;
  var map = self.viewer.map;
  if (this.config && this.config.controls) {
    _.forEach(this.config.controls,function(controlType){
      var control;
      switch (controlType) {
        case 'reset':
          if (!isMobile.any) {
            control = new ResetControl();
          }
          break;
        case 'zoom':
          control = new ol.control.Zoom({
            zoomInLabel: "\ue98a",
            zoomOutLabel: "\ue98b"
          });
          break;
        case 'zoombox': 
          if (!isMobile.any) {
            control = new ZoomBoxControl();
            control.on('zoomend',function(e){
              self.viewer.fit(e.extent);
            })
          }
          break;
        case 'zoomtoextent':
          control = new ol.control.ZoomToExtent({
            label:  "\ue98c",
            extent: self.config.constraintextent
          });
          break;
        case 'query':
          control = new QueryControl();
          control.on('picked',function(e){
            var coordinates = e.coordinates;
            var showQueryResults = GUI.showResultsFactory('query');
            //Brutto ma reimposto mapLayers tutte le volte
            var mapLayers = self.mapLayers;
            //verifico se ci sono layers selezionati
            var selectedLayers = self.project.getSelectedLayers();
            if (selectedLayers.length) {
              _.forEach(selectedLayers, function(selectedLayer) {
                _.forEach(mapLayers, function(mapLayer) {
                  if (_.find(mapLayer.layers, selectedLayer))	{
                    mapLayer.layers = selectedLayers;
                    return true
                  }		
                });		
              });				
            };
            //faccio query by location su i layers selezionati o tutti
            var queryResultsPanel = showQueryResults('interrogazione');
            QueryService.queryByLocation(coordinates, mapLayers, selectedLayers)
            //MapQueryService.queryPoint(coordinates,self.mapLayers)
            .then(function(results){
              queryResultsPanel.setQueryResponse(results);
              //ritraccio i Layers
              //self.setupLayers(); ??? a che serve?
              //self.emit('mapqueryend',featuresForLayers,nfeatures,coordinates,self.state.resolution);
            });
          });
          break;
          case 'scaleline':
            //control = new ol.control.ScaleLine()
          break;
      };
      if (control) {
        self.addControl(control);
      };
    });
  }
};

proto.addControl = function(control){
  this.viewer.map.addControl(control);
  this._mapControls.push(control);
};

proto.setupBaseLayers = function(){
  var self = this;
  if (!this.project.state.baselayers){
    return;
  }
  var self = this;
  this.mapBaseLayers = {};
  
  var initBaseLayer = ProjectsRegistry.config.initbaselayer;
  var baseLayersArray = this.project.state.baselayers;
  
  _.forEach(baseLayersArray,function(baseLayer){
    var visible = true;
    if (self.project.state.initbaselayer) {
      visible = baseLayer.id == (self.project.state.initbaselayer);
    }
    if (baseLayer.fixed) {
      visible = baseLayer.fixed;
    }
    baseLayer.visible = visible;
  })
  
  baseLayersArray.forEach(function(layer){     
    var config = {
      url: self.project.getWmsUrl(),
      id: layer.id,
      tiled: true
    };
    
    var mapLayer = new WMSLayer(config);
    self.registerListeners(mapLayer);
    
    mapLayer.addLayer(layer);
    self.mapBaseLayers[layer.id] = mapLayer;
  });
  
  _.forEach(_.values(this.mapBaseLayers).reverse(),function(mapLayer){
    self.viewer.map.addLayer(mapLayer.getOLLayer());
    mapLayer.update(self.state);
  })
};

proto.setupLayers = function(){
  var self = this;
  this.viewer.removeLayers();
  this.setupBaseLayers();
  this.mapLayers = {};
  this.layersAssociation = {};
  var layersArray = this.traverseLayersTree(this.project.state.layerstree);
  // prendo solo i layer veri e non i folder
  var leafLayersArray = _.filter(layersArray,function(layer){
    return !_.get(layer,'nodes');
  });
  //raggruppo per valore del multilayer con chiave valore multilayer e valore array
  var multiLayers = _.groupBy(leafLayersArray,function(layer){
    return layer.multilayer;
  });
  _.forEach(multiLayers,function(layers,id){
    var layerId = 'layer_'+id
    var mapLayer = _.get(self.mapLayers, layerId);
    // BRUTTO, da sistemare quando riorganizzeremo i metalayer (da far diventare multilayer).
    //Per ora posso configurare tiled solo i layer singoli.
    var tiled = layers[0].tiled;
    var config = {
      url: self.project.getWmsUrl(),
      id: layerId,
      tiled: tiled
    };
    mapLayer = self.mapLayers[layerId] = new WMSLayer(config,self.layersExtraParams);
    self.registerListeners(mapLayer);
    layers.forEach(function(layer){
      mapLayer.addLayer(layer);
      self.layersAssociation[layer.id] = layerId;
    });
  })
  
  _.forEach(_.values(this.mapLayers).reverse(),function(mapLayer){
    self.viewer.map.addLayer(mapLayer.getOLLayer());
    mapLayer.update(self.state,self.layersExtraParams);
  })
  return this.mapLayers;
};

proto.updateMapLayers = function(mapLayers) {
  var self = this;
  _.forEach(_.values(mapLayers),function(mapLayer){
    mapLayer.update(self.state,self.layersExtraParams);
  })
};

proto.getMapLayerForLayer = function(layer){
  return this.mapLayers['layer_'+layer.multilayer];
};

proto.traverseLayersTree = function(layersTree){
  var self = this;
  var layersArray = [];
  function traverse(obj){
    _.forIn(obj, function (val, key) {
        if (!_.isNil(val.id)) {
            layersArray.unshift(val);
        }
        if (!_.isNil(val.nodes)) {
            traverse(val.nodes);
        }
    });
  }
  traverse(layersTree);
  return layersArray;
};

proto.registerListeners = function(mapLayer){
  var self = this;
  mapLayer.on('loadstart',function(){
    self._incrementLoaders();
  });
  mapLayer.on('loadend',function(){
    self._decrementLoaders(false);
  });
  
  this.on('extraParamsSet',function(extraParams,update){
    if (update) {
      mapLayer.update(this.state,extraParams);
    }
  })
};

proto.setTarget = function(elId){
  this.target = elId;
};


// per creare una pila di ol.interaction in cui l'ultimo che si aggiunge disattiva temporaemente i precedenti (per poi togliersi di mezzo con popInteraction!)
// Usato ad es. da pickfeaturetool e getfeatureinfo
proto.pushInteraction = function(interaction){
  this._unsetControls();
  if (this._interactionsStack.length){
    var prevInteraction = this._interactionsStack.slice(-1)[0];
    if (_.isArray(prevInteraction)){
      _.forEach(prevInteraction,function(interaction){
        interaction.setActive(false);
      })
    }
    else{
      prevInteraction.setActive(false);
    };
  }
  
  this.viewer.map.addInteraction(interaction);
  interaction.setActive(true);
  this._interactionsStack.push(interaction)
};

proto.popInteraction = function(){
  var interaction = this._interactionsStack.pop();
  this.viewer.map.removeInteraction(interaction);
  
  if (this._interactionsStack.length){
    var prevInteraction = this._interactionsStack.slice(-1)[0];
    if (_.isArray(prevInteraction)){
      _.forEach(prevInteraction,function(interaction){
        interaction.setActive(true);
      })
    }
    else{
      prevInteraction.setActive(true);
    };
  }
};

proto._watchInteraction = function(interaction) {
  var self = this;
  interaction.on('change:active',function(e){
    //console.log((e.target instanceof ol.interaction.Pointer) + '-' + e.target.getActive());
    if ((e.target instanceof ol.interaction.Pointer) && e.target.getActive()) {
      self.emit('pointerInteractionSet',e.target);
    }
  })
};

proto.goTo = function(coordinates,zoom){
  var zoom = zoom || 6;
  this.viewer.goTo(coordinates,zoom);
};

proto.goToWGS84 = function(coordinates,zoom){
  var coordinates = ol.proj.transform(coordinates,'EPSG:4326','EPSG:'+this.project.state.crs);
  this.goTo(coordinates,zoom);
};

proto.extentToWGS84 = function(extent){
  return ol.proj.transformExtent(extent,'EPSG:'+this.project.state.crs,'EPSG:4326');
};

proto.getFeatureInfo = function(layerId){
  var self = this;
  var deferred = $.Deferred();
  this._pickInteraction = new PickCoordinatesInteraction();
  //this.viewer.map.addInteraction(this._pickInteraction);
  //this._pickInteraction.setActive(true);
  this.pushInteraction(this._pickInteraction);
  this._pickInteraction.on('picked',function(e){
    self._completeGetFeatureInfo(layerId,e.coordinate,deferred);
  })
  return deferred.promise();
};

proto._completeGetFeatureInfo = function(layerId,coordinate,deferred){
  var self = this;
  var projectType = this.project.state.type;
  
  var mapLayer = this.mapLayers[this.layersAssociation[layerId]];
  var resolution = this.viewer.getResolution();
  var epsg = self.viewer.map.getView().getProjection().getCode();
  var params = {
    QUERY_LAYERS: this.project.getLayer(layerId).name,
    INFO_FORMAT: "text/xml"
  }
  
  if (projectType == ProjectTypes.QDJANGO){
    var toleranceParams = PickToleranceParams[projectType];
    if (toleranceParams){
      var geometrytype = this.project.getLayer(layerId).geometrytype;
      params[toleranceParams[geometrytype]] = PickToleranceValues[geometrytype];
    }
  }
  
  var getFeatureInfoUrl = mapLayer.getSource().getGetFeatureInfoUrl(coordinate,resolution,epsg,params);
  $.get(getFeatureInfoUrl)
  .then(function(data){
    var x2js = new X2JS();
    var jsonData = x2js.xml2json(data);
    if (jsonData.GetFeatureInfoResponse.Layer.Feature){
      var attributes = jsonData.GetFeatureInfoResponse.Layer.Feature.Attribute;
      var attributesObj = {};
      _.forEach(attributes,function(attribute){
        attributesObj[attribute._name] = attribute._value; // X2JS aggiunge "_" come prefisso degli attributi
      })
      
      deferred.resolve(attributesObj);
    }
    deferred.reject();;
  })
  .fail(function(){
    deferred.reject();
  })
  .always(function(){
    //self.viewer.map.removeInteraction(self._pickInteraction);
    self.popInteraction();
    self._pickInteraction = null;
  })
};

proto.highlightGeometry = function(geometryObj,options){    
  var geometry;
  if (geometryObj instanceof ol.geom.Geometry){
    geometry = geometryObj;
  }
  else {
    format = new ol.format.GeoJSON;
    geometry = format.readGeometry(geometryObj);
  }
  
  if (options.zoom) {
    this.viewer.fit(geometry);
  }
  
  var duration = options.duration || 4000;
  
  if (options.fromWGS84) {
    geometry.transform('EPSG:4326','EPSG:'+this.project.project.crs);
  }
  
  var feature = new ol.Feature({
    geometry: geometry
  });
  var source = new ol.source.Vector();
  source.addFeatures([feature]);
  var layer = new ol.layer.Vector({
    source: source,
    style: function(feature){
      var styles = [];
      var geometryType = feature.getGeometry().getType();
      if (geometryType == 'LineString') {
        var style = new ol.style.Style({
          stroke: new ol.style.Stroke({
            color: 'rgb(255,255,0)',
            width: 4
          })
        })
        styles.push(style);
      }
      else if (geometryType == 'Point'){
        var style = new ol.style.Style({
          image: new ol.style.Circle({
            radius: 6,
            fill: new ol.style.Fill({
              color: 'rgb(255,255,0)',
            })
          }),
          zIndex: Infinity
        });
        styles.push(style);
      }
      
      return styles;
    }
  })
  layer.setMap(this.viewer.map);
  
  setTimeout(function(){
    layer.setMap(null);
  },duration);
};

proto.refreshMap = function(){
  _.forEach(this.mapLayers,function(wmsLayer){
    wmsLayer.getOLLayer().getSource().updateParams({"time": Date.now()});
  })
};

proto.resize = function(width,height) {
  if (!this.viewer) {
    var initialExtent = this.project.state.extent;
    var xRes = ol.extent.getWidth(initialExtent) / width;
    var yRes = ol.extent.getHeight(initialExtent) / height;
    var res = Math.max(xRes,yRes);
    this.setupViewer(res);
  }
  this.getMap().updateSize();
  this._setMapView();
};

proto._unsetControls = function() {
  _.forEach(this._mapControls,function(control){
    if (control.toggle) {
      control.toggle(false);
    }
  })
};

proto._setMapView = function(){
  var bbox = this.viewer.getBBOX();
  var resolution = this.viewer.getResolution();
  var center = this.viewer.getCenter();
  this.setMapView(bbox,resolution,center);
};

module.exports = MapService

},{"core/applicationservice":17,"core/g3wobject":28,"core/geometry/geometry":30,"core/layer/wmslayer":36,"core/project/projectsregistry":42,"core/project/projecttypes":43,"core/query/queryservice":46,"core/utils/utils":49,"g3w-ol3/src/controls/querycontrol":52,"g3w-ol3/src/controls/resetcontrol":53,"g3w-ol3/src/controls/zoomboxcontrol":54,"g3w-ol3/src/g3w.ol3":55,"g3w-ol3/src/interactions/pickcoordinatesinteraction":56,"gui/gui":71}],75:[function(require,module,exports){
module.exports = "<div id=\"map\" style=\"width:100%;height:100%\"></div>\n";

},{}],76:[function(require,module,exports){
var inherit = require('core/utils/utils').inherit;
var base = require('core/utils/utils').base;
var merge = require('core/utils/utils').merge;
var t = require('core/i18n/i18n.service').t;
var resolve = require('core/utils/utils').resolve;
var GUI = require('gui/gui');   
var Component = require('gui/vue/component');
var RouterService = require('core/router');
var ol3helpers = require('g3w-ol3/src/g3w.ol3').helpers;
var MapsRegistry = require('core/map/mapsregistry');
var MapService = require('../mapservice');

var vueComponentOptions = {
  template: require('./map.html'),
  ready: function(){
    var self = this;
    
    var mapService = this.$options.mapService;
    
    mapService.setTarget(this.$el.id);
    
    // questo serve per quando viene cambiato progetto/vista cartografica, in cui viene ricreato il viewer (e quindi la mappa)
    mapService.onafter('setupViewer',function(){
      mapService.setTarget(self.$el.id);
    });
  }
}

var InternalComponent = Vue.extend(vueComponentOptions);

Vue.component('g3w-map', vueComponentOptions);

function MapComponent(options){
  base(this,options);
  this.id = "map-component";
  this.title = "Catalogo dati";
  this._service = new MapService;
  merge(this, options);
  this.internalComponent = new InternalComponent({
    mapService: this._service
  });
};

inherit(MapComponent, Component);
var proto = MapComponent.prototype;

proto.layout = function(width,height) {
  $("#map").height(height);
  $("#map").width(width);
  this._service.resize(width,height);
};

module.exports =  MapComponent;

},{"../mapservice":74,"./map.html":75,"core/i18n/i18n.service":31,"core/map/mapsregistry":38,"core/router":47,"core/utils/utils":49,"g3w-ol3/src/g3w.ol3":55,"gui/gui":71,"gui/vue/component":89}],77:[function(require,module,exports){
var inherit = require('core/utils/utils').inherit;
var resolvedValue = require('core/utils/utils').resolve;
var G3WObject = require('core/g3wobject');

var Panel = function(options) {
  self = this;
  this.internalPanel = null;
  var options = options || {};
  self.id = options.id || null;
  self.title = options.title || '';
};

inherit(Panel, G3WObject);

var proto = Panel.prototype;

proto.getId = function(){
  return this.id;
};

proto.getTitle = function(){
  return this.title;
};

/* HOOKS */

/*
 * Il metodo permette al pannello di montarsi nel DOM
 * parent: elemento DOM padre, su cui inserirsi;
 * ritorna una promise, risolta nel momento in cui sarà terminato il montaggio
*/

// SONO DUE TIPOLOGIE DI MONTAGGIO CON IL QUALE IL PANNELLO
// CHE VERRA' MONTATO AL VOLO CON IL METODO MOUNT A SECONDA DEL TIPO DI PANNELLO RICHIESTO

// richiamato quando la GUI chiede di chiudere il pannello. Se ritorna false il pannello non viene chiuso

proto.mount = function(parent) {
  var panel = this.internalPanel;
  panel.$mount().$appendTo(parent);
  $(parent).localize();
  return resolvedValue(true);
};

/*
 * Metodo richiamato quando si vuole rimuovere il panello.
 * Ritorna una promessa che sarà risolta nel momento in cui il pannello avrà completato la propria rimozione (ed eventuale rilascio di risorse dipendenti)
*/
proto.unmount = function(){
  var panel = this.internalPanel;
  var deferred = $.Deferred();
  panel.$destroy(true);
  deferred.resolve();
  return deferred.promise();
};

/*
 * Metodo (opzionale) che offre l'opportunità di ricalcolare proprietà dipendenti dalle dimensioni del padre
 * parentHeight: nuova altezza del parent
 * parentWidth: nuova larghezza del parent
 * richiamato ogni volta che il parent subisce un ridimensionamento
*/
proto.onResize = function(parentWidth,parentHeight){};


module.exports = Panel;

},{"core/g3wobject":28,"core/utils/utils":49}],78:[function(require,module,exports){
var inherit = require('core/utils/utils').inherit;
var base = require('core/utils/utils').base;
var GUI = require('gui/gui');
var G3WObject = require('core/g3wobject');
var ProjectsRegistry = require('core/project/projectsregistry');

function QueryResultsService(){
  var self = this;
  this._actions = {
    'zoomto': QueryResultsService.zoomToElement
  };
  
  this.init = function(options) {
    this.clearState();
  };
  
  this.state = {
    layers: [],
    query: {},
    querytitle: "",
    loading: true
  };
  
  this.setters = {
    setQueryResponse: function(queryResponse) {
      this.state.layers = [];
      this.state.query = queryResponse.query;
      this._digestFeaturesForLayers(queryResponse.data);
      this.state.loading = false;
    }
  };
  
  this.clearState = function() {
    this.state = {
      layers: [],
      query: {},
      querytitle: "",
      loading: true
    };
  };
  
  this.setTitle = function(querytitle) {
    this.state.querytitle = querytitle || "";
  };
  
  this.reset = function() {
    this.clearState();
  };
  
  this._digestFeaturesForLayers = function(featuresForLayers) {
    var self = this;
    _.forEach(featuresForLayers,function(featuresForLayer){
      var layer = featuresForLayer.layer;
      if (featuresForLayer.features.length) {
        var layerObj = {
          title: layer.title,
          id: layer.id,
          attributes: self._parseAttributes(layer.attributes,featuresForLayer.features[0].getProperties()), // prendo solo gli attributi effettivamente ritornati dal WMS (usando la prima feature disponibile)
          features: []
        };
        _.forEach(featuresForLayer.features,function(feature){      
          var featureObj = {
            id: feature.getId(),
            attributes: feature.getProperties(),
            geometry: feature.getGeometry()
          }
          layerObj.features.push(featureObj);
        })
        self.state.layers.push(layerObj);
      }
    })
  };
  
  this._parseAttributes = function(layerAttributes,featureAttributes) {
    var featureAttributesNames = _.keys(featureAttributes);
    return _.filter(layerAttributes,function(attribute){
      return featureAttributesNames.indexOf(attribute.name) > -1;
    })
  }
  
  this.trigger = function(action,layer,feature) {
    var actionMethod = this._actions[action];
    if (actionMethod) {
      actionMethod(layer,feature);
    }
  };
  
  base(this);
};

QueryResultsService.zoomToElement = function(layer,feature) {
  console.log(feature.geometry);
};

// Make the public service en Event Emitter
inherit(QueryResultsService, G3WObject);

module.exports = QueryResultsService;

},{"core/g3wobject":28,"core/project/projectsregistry":42,"core/utils/utils":49,"gui/gui":71}],79:[function(require,module,exports){
module.exports = "<!--<div id=\"search-results\">\n  <div v-for=\"layer in state.layers\" style=\"cursor:pointer\">\n    <h4>{{ layer.title }}</h4>\n    <p>Numero di features: {{ layer.features.length }}</p>\n  </div>\n</div>-->\n<div id=\"search-results\" class=\"queryresults-container\">\n  <h3>Risultati {{state.querytitle | lowercase}}</h3>\n  <div v-show=\"state.loading\" class=\"bar-loader\"></div>\n  <ul class=\"queryresults\" id=\"queryresults\">\n    <li v-if=\"layerHasFeatures(layer)\" v-for=\"layer in state.layers\">\n      <div class=\"box box-primary\">\n        <div class=\"box-header with-border\">\n          <h3 class=\"box-title\">{{ layer.title }} ({{layer.features.length}})</h3>\n          <div class=\"box-tools pull-right\">\n            <button class=\"btn btn-box-tool\" data-widget=\"collapse\"><i class=\"fa fa-minus\"></i></button>\n          </div>\n        </div>\n        <div class=\"box-body\">\n          <table class=\"table table-striped\">\n            <thead>\n              <tr>\n                <th v-for=\"attribute in attributesSubset(layer.attributes)\">{{attribute.label}}</th>\n              </tr>\n            </thead>\n            <tbody>\n              <template v-for=\"feature in layer.features\">\n                <tr class=\"attributes-preview\" @click=\"toggleFeatureBox(layer,feature)\">\n                  <td v-for=\"attribute in attributesSubset(layer.attributes)\">\n                    <span>{{feature.attributes[attribute.name]}}</span>\n                    <!--<span v-if=\"isSimple(layer,feature,attribute)\">{{feature.attributes[attribute.name]}}</span>-->\n                    <!--<span v-if=\"isRoute(layer,feature,attribute)\" class=\"link dashboardlink\" @click=\"goto(layer,feature.attributes[attribute.name])\">{{ feature.attributes[attribute.name] }}</span>-->\n                    <!--<img v-if=\"isPhoto(layer,feature,attribute)\" data-url=\"{{getPhotoUrl(feature.attributes[attribute.name])}}\" style=\"max-width:50px\" :src=\"getPhotoUrl(feature.attributes[attribute.name],thumb)\" />-->\n                    <!--<a v-if=\"isLink(layer,feature,attribute)\" href=\"layer.feature.attributes[attribute.name]\" class=\"glyphicon glyphicon-link\"></a>-->\n                  </td>\n                  <td><span class=\"glyphicon glyphicon-option-horizontal link morelink\"></span></td>\n              </tr>\n              <tr v-show=\"collapseFeatureBox(layer,feature)\" class=\"queryresults-featurebox\">\n                <td :colspan=\"attributesSubsetLength(layer.attributes)+1\">\n                  <div class=\"action-buttons-container\">\n                    <div v-if=\"geometryAvailable(feature)\" class=\"action-button hint--top-right\" aria-label=\"Visualizza sulla mappa\">\n                      <span class=\"action-button-icon glyphicon glyphicon-map-marker\" @click=\"trigger('zoomto',layer,feature)\"></span>\n                    </div>\n                    <div class=\"action-button hint--top-right\" aria-label=\"Link all'elemento\">\n                      <span class=\"action-button-icon glyphicon glyphicon-link\"></span>\n                    </div>\n                  </div>\n                  <table>\n                    <tr v-for=\"attribute in layer.attributes\">\n                      <td class=\"attr-label\">{{attribute.label}}</td>\n                      <td class=\"attr-value\">{{feature.attributes[attribute.name]}}</td>\n                    </tr>\n                  </table>\n                </td>\n              </tr>\n              </template>\n            </tbody>\n          </table>\n        </div>\n      </div>\n    </li>\n  </ul>\n</div>\n\n";

},{}],80:[function(require,module,exports){
var inherit = require('core/utils/utils').inherit;
var base = require('core/utils/utils').base;
var merge = require('core/utils/utils').merge;
var Component = require('gui/vue/component');
var G3WObject = require('core/g3wobject');
var QueryResultsService = require('gui/queryresults/queryresultsservice');

var vueComponentOptions = {
  template: require('./queryresults.html'),
  data: function() {
    return {
      state: this.$options.queryResultsService.state,
      layersFeaturesBoxes: {},
    }
  },
  replace: false,
  methods: {
    layerHasFeatures: function(layer) {
      if (layer.features) {
        return layer.features.length > 0;
      }
      return false;
    },
    geometryAvailable: function(feature) {
      return feature.geometry ? true : false;
    },
    attributesSubset: function(attributes) {
      var end = Math.min(3,attributes.length);
      return attributes.slice(0,end);
    },
    attributesSubsetLength: function(attributes) {
      return this.attributesSubset(attributes).length;
    },
    collapseFeatureBox: function(layer,feature) {
      var collapsed = true;
      var boxid = layer.id+'_'+feature.id;
      if (this.layersFeaturesBoxes[boxid]) {
        collapsed = this.layersFeaturesBoxes[boxid].collapsed;
      }
      return collapsed;
    },
    toggleFeatureBox: function(layer,feature) {
      var boxid = layer.id+'_'+feature.id;
      this.layersFeaturesBoxes[boxid].collapsed = !this.layersFeaturesBoxes[boxid].collapsed;
    },
    trigger: function(action,layer,feature) {
      this.$options.queryResultsService.trigger(action,layer,feature);
    }
  }
};

// se lo voglio istanziare manualmente
var InternalComponent = Vue.extend(vueComponentOptions);

function QueryResultsComponent(options){
  base(this,options);
  var self = this;
  this.id = "queryresults";
  this.title = "Query Results";
  this._service = new QueryResultsService();
  //usato quando è stato distrutto
  this.setInternalComponent = function() {
    this.internalComponent = new InternalComponent({
      queryResultsService: this._service
    });
    this.createLayersFeaturesBoxes();
    this.internalComponent.querytitle = this._service.state.querytitle;
  }
  
  this._service.onafter('setQueryResponse',function(){
    self.createLayersFeaturesBoxes();
  })
  merge(this, options);
  
  this.createLayersFeaturesBoxes = function() {
    var layersFeaturesBoxes = {}
    var layers = this._service.state.layers;
    _.forEach(layers,function(layer){
      _.forEach(layer.features,function(feature){
        var boxid = layer.id+'_'+feature.id
        layersFeaturesBoxes[boxid] = {
          collapsed: false
        }
      })
    })
    this.internalComponent.layersFeaturesBoxes = layersFeaturesBoxes;
  };
};

inherit(QueryResultsComponent, Component);

module.exports = QueryResultsComponent;

/*

var resolvedValue = require('g3w/core/utils').resolvedValue;
var inherit = require('g3w/core/utils').inherit;
var base = require('g3w/core/utils').base;
var G3WObject = require('g3w/core/g3wobject');
var GUI = require('g3w/gui/gui');
var ApiService = require('g3w/core/apiservice');
var ProjectService = require('g3w/core/projectservice').ProjectService;
var MapService = require('g3w/core/mapservice');
var RouterService = require('g3w/core/router');

var TplService = require('./tplservice');

var Fields = {};
Fields.STRING = 'string';
Fields.INTEGER = 'integer';
Fields.FLOAT = 'float';


Fields.simpleFieldTypes = [Fields.STRING,Fields.INTEGER,Fields.FLOAT];
Fields.LINK = 'link';
Fields.PHOTO = 'photo';
Fields.POINTLINK = 'pointlink';
Fields.ROUTE = 'route';

var FieldsRules = {
  varianti: {
    id: Fields.ROUTE
  },
  paline: {
    id: Fields.ROUTE
  }
};

function getFieldType(layer,feature,attribute) {
  var fieldTypeFromRules = _.get(FieldsRules,layer.id+'.'+attribute.name);
  if (fieldTypeFromRules) {
    return fieldTypeFromRules;
  }
  
  var URLPattern = /^(https?:\/\/[^\s]+)/g;
  var PhotoPattern = /[^\s]+.(png|jpg|jpeg)$/g;
  var value = feature.attributes[attribute.name].toString();
  
  var extension = value.split('.').pop();
  if (value.match(URLPattern)) {
    return Fields.LINK;
  }
  
  if (value.match(PhotoPattern)) {
    return Fields.PHOTO;
  }
  
  if (Fields.simpleFieldTypes.indexOf(attribute.type) > -1) {
    return attribute.type;
  }
};

function isSimple(layer,feature,attribute) {
  var fieldType = getFieldType(layer,feature,attribute);
  return Fields.simpleFieldTypes.indexOf(fieldType) > -1;
};

function isLink(layer,feature,attribute) {
  var fieldType = getFieldType(layer,feature,attribute);
  return Fields.LINK == fieldType;
};

function isPhoto(layer,feature,attribute) {
  var fieldType = getFieldType(layer,feature,attribute);
  return Fields.PHOTO == fieldType;
};

function isRoute(layer,feature,attribute) {
  var fieldType = getFieldType(layer,feature,attribute);
  return Fields.ROUTE == fieldType;
};

var TplQueryResultsComponent = Vue.extend({
  template: require('./tplqueryresults.html'),
  data: function(){
    return {
      lotto: null,
      day: null,
      territorial_details: {},
      layers: [],
      basePhotoUrl: ''
    }
  },
  ready: function(){
    try {
      var viewer = new Viewer(document.getElementById('tpl-mapqueryresults'), {
        url: 'data-url',
        zIndex: 10000
      });
    }
    catch(err){
    }
  },
  methods: {
    layerHasFeatures: function(layer) {
      if (layer.features) {
        return layer.features.length > 0;
      }
      return false;
    },
    calcKm: function(meters) {
      return Math.round10((meters/1000),-2);
    },
    showFeature: function(feature) {
      GUI.hideListing();
      MapService.highlightGeometry(feature.geometry,{zoom: true});
    },
    hasGeometry: function(feature) {
      return _.isNil(feature.getGeometry);
    },
    isSimple: function(layer,feature,attribute) {
      return isSimple(layer,feature,attribute);
    },
    isPhoto: function(layer,feature,attribute) {
      return isPhoto(layer,feature,attribute);
    },
    isLink: function(layer,feature,attribute) {
      return isLink(layer,feature,attribute);
    },
    isRoute: function(layer,feature,attribute) {
      return isRoute(layer,feature,attribute);
    },
    getPhotoUrl: function(path,thumb) {
      var pathsplit = path.split('/');
      var photoName = pathsplit[pathsplit.length - 1];
      var photoSplit = photoName.split('_').slice(1);
      var prefix = 'foto';
      if (thumb) {
        prefix = 'thumb';
      }
      var thumbName = prefix+"_"+photoSplit.join('_');
      return this.basePhotoUrl + '/' + thumbName;
    },
    getLabel: function(layerName){
      return this.labels_territorio[layerName].denominazione;
    },
    getOrBlank: function(path) {
      var value = _.get(this,path);
      return (value && value != '') ? value : '-';
    },
    goto: function(layer,value) {
      switch (layer.id) {
        case 'varianti':
          GUI.hideListing();
          var lotto = this.lotto;
          var day = this.day;
          RouterService.goto('dashboard/corsevariante/'+value+'?day='+this.day);
          break;
        case 'paline':
          GUI.hideListing();
          var day = this.day;
          RouterService.goto('dashboard/fermata/'+value+'?day='+day);
          break;
      }
    },
    showVariante: function(id_variante) {
      GUI.hideListing();
      var lotto = this.lotto;
      var day = this.day;
      RouterService.goto('dashboard/varianti/'+this.lotto+'/###/'+id_variante+'?day='+this.day);
    },
    showFermata: function(id_fermata) {
      GUI.hideListing();
      var day = this.day;
      RouterService.goto('dashboard/fermata/'+id_fermata+'?day='+day);
    }
  }
})

var TplQueryResultsPanel = function(context){
  this.panelComponent = null;
  this.context = context;
  
  this.onShow = function(container){
    var self = this;
    var panel = this.panelComponent = new TplQueryResultsComponent();
    panel.layers = [];
    panel.labels_territorio = null;
    
    var layerData = _.keyBy(context.layersResults,'id');
    
    var territorial_details = {};
    var layers_labels_territorio = ['province','comuni','bacini','localita'];
    
    _.forEach(layers_labels_territorio,function(layerName){
      if (layerData[layerName].features && layerData[layerName].features.length) {
        territorial_details[layerName] =  layerData[layerName].features[0].attributes
      }
    });
    
    panel.lotto = context.lottoId;
    panel.day = context.day;
    panel.territorial_details = territorial_details;   
    
    var layersFromApi = ['varianti'];
    
    this.queryVarianti(this.context)
    .then(function(features){
      panel.layers.push({
        title: 'Varianti',
        id: 'varianti',
        attributes: ProjectService.getLayerByName('varianti').attributes,
        features: features
      })
    });
    
    var excludedLayers = _.concat(layers_labels_territorio,layersFromApi);
    var queryableLayers = _.filter(this.context.queryableLayers,function(layer){
      return excludedLayers.indexOf(layer.name) == -1;
    });
    
    _.forEach(queryableLayers,function(queryableLayer){
        var features = self.processResults(queryableLayer.name,self.context)
        panel.layers.push({
          title: queryableLayer.title,
          id: queryableLayer.name,
          attributes: queryableLayer.attributes,
          features: features
        });
    })

    panel.basePhotoUrl = context.urls.basePhotoUrl;
    
    panel.$mount().$appendTo(container);
    
    return resolvedValue(true);
  };
  
  this.onClose = function(){
    this.panelComponent.$destroy(true);
    this.panelComponent = null;
    return resolvedValue(true);
  };
  
  this.processResults = function(layerName,context) {
    var layerData = _.keyBy(context.layersResults,'id');
    var features = [];
    if (layerData[layerName]) {
      features = layerData[layerName].features;
    }
    return features;
  };
  
  this.queryVarianti = function(context){
    return ApiService.get('VARIANTIQUERYMAP',{
      params: {
        day: context.day,
        lotto: context.lottoId,
        coords: context.coordinates.join(','),
        res: context.resolution
      }
    })
    .then(function(response){
      return _.map(response,function(rowData){
        return {
          attributes: rowData
        }
      })
    });
  }
}
inherit(TplQueryResultsPanel,G3WObject);

module.exports = TplQueryResultsPanel;

*/

},{"./queryresults.html":79,"core/g3wobject":28,"core/utils/utils":49,"gui/queryresults/queryresultsservice":78,"gui/vue/component":89}],81:[function(require,module,exports){
var inherit = require('core/utils/utils').inherit;
var GUI = require('gui/gui');
var ProjectsRegistry = require('core/project/projectsregistry');
var G3WObject = require('core/g3wobject');
var SearchPanel = require('gui/search/vue/panel/searchpanel');

function SearchesService(){
  var self = this;
  //this._searchPanelService = new SearchPanelService();
  this.init = function(searchesObject) {
    var searches = searchesObject || ProjectsRegistry.getCurrentProject().state.search;
    this.state.searches = searches;
  };
  this.state = {
    searches: []
  };

  this.showSearchPanel = function(panelConfig) {
    var panel =  new SearchPanel();// creo panello search
    panel.init(panelConfig);//inizializzo pannello se
    GUI.showPanel(panel);
    return panel;
  };

  this.cleanSearchPanels = function() {
    this.state.panels = {};
  };

  this.stop = function(){
    var deferred = $.Deferred();
    deferred.resolve();
    return deferred.promise();
  };

};

// Make the public service en Event Emitter
inherit(SearchesService, G3WObject);

module.exports = SearchesService;

},{"core/g3wobject":28,"core/project/projectsregistry":42,"core/utils/utils":49,"gui/gui":71,"gui/search/vue/panel/searchpanel":83}],82:[function(require,module,exports){
module.exports = "<div class=\"g3w-search-panel form-group\">\n  <h3>{{title}}</h3>\n  <form id=\"g3w-search-form\">\n    <template v-for=\"forminput in forminputs\">\n      <div v-if=\"forminput.input.type == 'numberfield'\" class=\"form-group numeric\">\n        <label for=\"{{ forminput.id }} \">{{ forminput.label }}</label>\n        <input type=\"number\" v-model=\"formInputValues[$index].value\" class=\"form-control\" id=\"{{ forminput.id }}\">\n      </div>\n      <div v-if=\"forminput.input.type == 'textfield'\" class=\"form-group text\">\n        <label for=\"{{ forminput.id }}\">{{ forminput.label }}</label>\n        <input type=\"text\" v-model=\"formInputValues[$index].value\" class=\"form-control\" id=\"{{ forminput.id }}\">\n      </div>\n    </template>\n    <div class=\"form-group\">\n      <button class=\"btn btn-primary pull-right\" @click=\"doSearch($event)\" data-i18n=\"dosearch\">Search</button>\n    </div>\n  </form>\n</div>\n";

},{}],83:[function(require,module,exports){
var inherit = require('core/utils/utils').inherit;
var localize = require('core/i18n/i18n.service').t;
var resolve = require('core/utils/utils').resolve;
var GUI = require('gui/gui');
var QueryService = require('core/query/queryservice');
var ListPanel = require('gui/listpanel').ListPanel;
var Panel = require('gui/panel');
var ProjectsRegistry = require('core/project/projectsregistry');

//componente vue pannello search
var SearchPanelComponet = Vue.extend({
  template: require('./searchpanel.html'),
  data: function() {
    return {
      title: "",
      forminputs: [],
      filterObject: {},
      formInputValues : []
    }
  },
  methods: {
    doSearch: function(event) {
      var self = this;
      event.preventDefault();
      //al momento molto farragginoso ma da rivedere
      //per associazione valore input
      var showQueryResults = GUI.showResultsFactory('query');
      var queryResultsPanel = showQueryResults(self.title);
      this.filterObject = this.fillFilterInputsWithValues(this.filterObject, this.formInputValues);
      QueryService.queryByFilter(this.filterObject)
      .then(function(results){
        queryResultsPanel.setQueryResponse(results);
      })
    }
  }
});

//costruttore del pannello e del suo componente vue
function SearchPanel() {
  self = this;
  this.config = {};
  this.filter = {};
  this.id = null;
  this.querylayerid = null;
  this.internalPanel = new SearchPanelComponet();
  //funzione inizializzazione
  this.init = function(config) {
    this.config = config || {};
    this.name = this.config.name || this.name;
    this.id = this.config.id || this.id;
    this.filter = this.config.options.filter || this.filter;
    this.querylayerid = this.config.options.querylayerid || this.querylayerid;
    //vado a riempire gli input del form del pannello
    this.fillInputsFormFromFilter();
    //creo e assegno l'oggetto filtro
    var filterObjFromConfig = QueryService.createQueryFilterFromConfig(this.filter);
    //alla fine creo l'ggetto finale del filtro da passare poi al provider QGISWMS o WFS etc.. che contiene sia
    //il filtro che url, il nome del layer il tipo di server etc ..
    this.internalPanel.filterObject = QueryService.createQueryFilterObject(this.querylayerid, filterObjFromConfig);
    //soluzione momentanea assegno  la funzione del SearchPanle ma come pattern è sbagliato
    //vorrei delegarlo a SearchesService ma lo stesso stanzia questo (loop) come uscirne???
    //creare un searchpanelservice?
    this.internalPanel.fillFilterInputsWithValues = this.fillFilterInputsWithValues;
    this.internalPanel.title = this.name;
  };
  //funzione che popola gli inputs che ci saranno nel form del pannello ricerca
  //oltre costruire un oggetto che legherà i valori degli inputs del form con gli oggetti
  //'operazionali' del filtro
  this.fillInputsFormFromFilter = function() {
    var id = 0;
    var formValue;
    _.forEach(this.filter,function(v,k,obj) {
      _.forEach(v, function(input){
        //sempre nuovo oggetto
        formValue = {};
        //inserisco l'id all'input
        input.id = id
        //aggiungo il tipo al valore per fare conversione da stringa a tipo input
        formValue.type = input.input.type;
        ////TEMPORANEO !!! DEVO PRENDERE IL VERO VALORE DI DEFAULT
        formValue.value = null;
        //popolo gli inputs:
        // valori
        self.internalPanel.formInputValues.push(formValue);
        //input
        self.internalPanel.forminputs.push(input);
        id+=1;
      });
    });
  };
  //funzione che associa i valori dell'inputs form al relativo oggetto "operazionde del filtro"
  this.fillFilterInputsWithValues = function(filterObject, formInputValues, globalIndex) {
    //funzione conversione da valore restituito dall'input (sempre stringa) al vero tipo di valore
    function convertInputValueToInputType(type, value) {
      switch(type) {
        case 'numberfield':
             value = parseInt(value);
             break;
        default:
             break;
      }
      return value;
    }
    //ciclo sull'oggetto filtro che ha come chiave root 'AND' o 'OR'
    _.forEach(filterObject.filterObject, function(v,k) {
      //scorro attraverso l'array di elementi operazionali da confrontare
      _.forEach(v, function(input, idx) {
        //elemento operazionale {'=':{}}
        _.forEach(input, function(v, k, obj) {
          //vado a leggere l'oggetto attributo
          if (_.isArray(v)) {
            //richiama la funzione ricorsivamente .. andrà bene ?
            fillFilterInputsWithValues(input, formInputValues, idx);
          } else {
            _.forEach(v, function(v, k, obj) {
              //considero l'index globale in modo che inputs di operazioni booleane interne
              //vengono considerate
              index = (globalIndex) ? globalIndex + idx : idx;
              obj[k] = convertInputValueToInputType(formInputValues[index].type, formInputValues[index].value);
            });
          };
        });
      });
    });
    return filterObject;
  };
};

inherit(SearchPanel, Panel);
module.exports = SearchPanel;

},{"./searchpanel.html":82,"core/i18n/i18n.service":31,"core/project/projectsregistry":42,"core/query/queryservice":46,"core/utils/utils":49,"gui/gui":71,"gui/listpanel":73,"gui/panel":77}],84:[function(require,module,exports){
module.exports = "<div id=\"g3w-search\" class=\"g3w-search g3w-tools\">\n  <ul>\n    <li v-for=\"search in project.search\">\n      <div class=\"search-header tool-header\" @click=\"showSearchPanel(search)\">\n        <span style=\"\">{{ search.name }}</span>\n      </div>\n    </li>\n  </ul>\n</div>\n";

},{}],85:[function(require,module,exports){
var inherit = require('core/utils/utils').inherit;
var base = require('core/utils/utils').base;
var merge = require('core/utils/utils').merge;
var t = require('core/i18n/i18n.service').t;
var resolve = require('core/utils/utils').resolve;
var Component = require('gui/vue/component');
var GUI = require('gui/gui');
var ProjectsRegistry = require('core/project/projectsregistry');
var G3WObject = require('core/g3wobject');
var SearchPanel = require('gui/search/vue/panel/searchpanel');
var ProjectsRegistry = require('core/project/projectsregistry');
var SearchesService = require('gui/search/searchesservice');

var vueComponentOptions = {
   template: require('./search.html'),
   data: function() {
    	return {
    	  project: ProjectsRegistry.getCurrentProject().state
    	};
   },
   methods: {
    showSearchPanel: function(search) {
        var panel = this.$options.searchesService.showSearchPanel(search);
    }
  }
};

// se lo voglio istanziare manualmente
var InternalComponent = Vue.extend(vueComponentOptions);
// se lo voglio usare come componente come elemento html
//Vue.component('g3w-search',vueComponentOptions);

/* COMPONENTI FIGLI */
/* FINE COMPONENTI FIGLI */

/* INTERFACCIA PUBBLICA */
function SearchComponent(options){
  base(this,options);
  this.id = "search-component";
  this.title = "search";
  this._service = new SearchesService();
  this.internalComponent = new InternalComponent({
    searchesService: this._service
  });
  this.state.visible = ProjectsRegistry.getCurrentProject().state.search.length > 0;
  merge(this, options);
  this.initService = function() {
    //inizializzo il servizio
    this._service.init();
  };
};

inherit(SearchComponent, Component);
module.exports = SearchComponent;

},{"./search.html":84,"core/g3wobject":28,"core/i18n/i18n.service":31,"core/project/projectsregistry":42,"core/utils/utils":49,"gui/gui":71,"gui/search/searchesservice":81,"gui/search/vue/panel/searchpanel":83,"gui/vue/component":89}],86:[function(require,module,exports){
var inherit = require('core/utils/utils').inherit;
var base = require('core/utils/utils').base;
var G3WObject = require('core/g3wobject');

function ToolsService(){
  var self = this;
  this.config = null;
  this._actions = {};
  this.state = {
    toolsGroups: []
  };
  
  this.setters = {
    addToolGroup: function(group) {
      this.state.toolsGroups.push(group);
    }
  }
  
  this.addTools = function(groupName,tools) {
    var self = this;
    var group = this._getToolsGroup(groupName);
    if (!group) {
      group = {
        name: groupName,
        tools: []
      };
      this.addToolGroup(group);
    }
    _.forEach(tools,function(tool){
      group.tools.push(tool);
      self._addAction(tool);
    });
  };
  
  this.removeTool = function(toolId) {
  };
  
  this.fireAction = function(actionid){
    var action = this._actions[actionid];
    action();
  };
  
  this._getToolsGroup = function(groupName) {
    var group = null;
    _.forEach(this.state.toolsGroups,function(_group){
      if (_group.name == groupName) {
        group = _group;
      }
    })
    return group;
  }
  
  this._addAction = function(tool) {
    var actionId = Math.floor(Math.random() * 1000000)+1;
    tool.actionId = actionId;
    this._actions[actionId] = tool.action;
  }
  
  base(this);
};
inherit(ToolsService,G3WObject);

module.exports = ToolsService;

},{"core/g3wobject":28,"core/utils/utils":49}],87:[function(require,module,exports){
module.exports = "<div class=\"g3w-tools\">\n  <ul>\n    <li v-for=\"group in state.toolsGroups\">\n      <div data-toggle=\"collapse\" data-target=\"#{{ group.name }}-tools\" class=\"tool-header\">\n        <span style=\"\">{{ group.name }}</span>\n      </div>\n      <div id=\"{{ group.name }}-tools\" class=\"tool-box collapse\">\n        <template v-for=\"tool in group.tools\">\n          <i class=\"glyphicon glyphicon-cog\"></i>\n          <span @click=\"fireAction(tool.actionId)\">{{ tool.name }}</span>\n        </template>\n      </div>\n    </li>\n  </ul>\n</div>\n";

},{}],88:[function(require,module,exports){
var t = require('core/i18n/i18n.service').t;
var inherit = require('core/utils/utils').inherit;
var base = require('core/utils/utils').base;
var merge = require('core/utils/utils').merge;
var Component = require('gui/vue/component');
var ToolsService = require('gui/tools/toolsservice');

var InternalComponent = Vue.extend({
    template: require('./tools.html'),
    data: function() {
      return {
        state: null
      }
    },
    methods: {
      fireAction: function(actionid){
        this.$options.toolsService.fireAction(actionid);
      }
    }
});

function ToolsComponent(options){
  base(this,options);
  var self = this;
  this._service = new ToolsService();
  this.id = "tools-component";
  this.title = "tools";
  this.state.visible = false;
  this._service.onafter('addToolGroup',function(){
    self.state.visible = self._service.state.toolsGroups.length > 0;
  })
  merge(this, options);
  this.internalComponent = new InternalComponent({
    toolsService: this._service
  });
  this.internalComponent.state = this._service.state
};

inherit(ToolsComponent, Component);

var proto = ToolsComponent.prototype;

module.exports = ToolsComponent;

},{"./tools.html":87,"core/i18n/i18n.service":31,"core/utils/utils":49,"gui/tools/toolsservice":86,"gui/vue/component":89}],89:[function(require,module,exports){
var inherit = require('core/utils/utils').inherit;
var base = require('core/utils/utils').base;
var resolve = require('core/utils/utils').resolve;
var reject = require('core/utils/utils').reject;
var BaseComponent = require('gui/component');

var Component = function(options) {
  base(this,options);
};

inherit(Component, BaseComponent);

var proto = Component.prototype;

// viene richiamato dalla toolbar quando il plugin chiede di mostrare un proprio pannello nella GUI (GUI.showPanel)
proto.mount = function(parent,append) {
  if (!this.internalComponent) {
    this.setInternalComponent();
  };
  if(append) {
    this.internalComponent.$mount().$appendTo(parent);
  }
  else {
    this.internalComponent.$mount(parent);
  }
  $(parent).localize();
  return resolve(true);
};

// richiamato quando la GUI chiede di chiudere il pannello. Se ritorna false il pannello non viene chiuso
proto.unmount = function() {
  // il problema che distruggere
  this.internalComponent.$destroy(true);
  this.internalComponent = null;
  return resolve();
};

proto.hide = function() {
  console.log(this.internalComponent.$el);
};

module.exports = Component;

},{"core/utils/utils":49,"gui/component":67}],90:[function(require,module,exports){
Vue.directive("disabled",function(value){
    if (value){
      this.el.setAttribute('disabled','disabled');
    }
    else {
      this.el.removeAttribute('disabled');
    }
  }
);

Vue.directive("checked",function(value){
    if (value){
      this.el.setAttribute('checked','checked');
    }
    else {
      this.el.removeAttribute('checked');
    }
  }
);

Vue.directive("selected-first",function(value){
    if (value==0){
      this.el.setAttribute('selected','');
    }
    else {
      this.el.removeAttribute('selected');
    }
  }
);

},{}],91:[function(require,module,exports){
var g3w = g3w || {};

g3w.core = {
   G3WObject: require('core/g3wobject'),
   utils: require('core/utils/utils'),
   ApplicationService: require('core/applicationservice'),
   ApiService: require('core/apiservice'),
   Router: require('core/router'),
   ProjectsRegistry: require('core/project/projectsregistry'),
   Project: require('core/project/project'),
   QueryService: require('core/query/queryservice'),
   MapLayer: require('core/map/maplayer'),
   LayerState: require('core/layer/layerstate'),
   VectorLayer: require('core/layer/vectorlayer'),
   WmsLayer: require('core/layer/wmslayer'),
   Geometry: require('core/geometry/geometry'),
   geom: require('core/geometry/geom'),
   PickCoordinatesInteraction: require('core/interactions/pickcoordinatesinteraction'),
   PickFeatureInteraction: require('core/interactions/pickfeatureinteraction'),
   i18n: require('core/i18n/i18n.service'),
   Plugin: require('core/plugin/plugin'),
   PluginsRegistry: require('core/plugin/pluginsregistry'),
   Editor: require('core/editing/editor')
};

g3w.gui = {
  GUI: require('gui/gui'),
  Form: require('gui/form').Form,
  FormPanel: require('gui/form').FormPanel,
  Panel: require('gui/panel'),
  vue: {
    //GeocodingComponent: require('gui/vue/geocoding/geocoding'),
    SearchComponent: require('gui/search/vue/search'),
    CatalogComponent: require('gui/catalog/vue/catalog'),
    MapComponent: require('gui/map/vue/map'),
    ToolsComponent: require('gui/tools/vue/tools'),
    QueryResultsComponent : require('gui/queryresults/vue/queryresults')
  }
};

module.exports = {
  core: g3w.core,
  gui: g3w.gui
};

},{"core/apiservice":16,"core/applicationservice":17,"core/editing/editor":19,"core/g3wobject":28,"core/geometry/geom":29,"core/geometry/geometry":30,"core/i18n/i18n.service":31,"core/interactions/pickcoordinatesinteraction":32,"core/interactions/pickfeatureinteraction":33,"core/layer/layerstate":34,"core/layer/vectorlayer":35,"core/layer/wmslayer":36,"core/map/maplayer":37,"core/plugin/plugin":39,"core/plugin/pluginsregistry":40,"core/project/project":41,"core/project/projectsregistry":42,"core/query/queryservice":46,"core/router":47,"core/utils/utils":49,"gui/catalog/vue/catalog":63,"gui/form":69,"gui/gui":71,"gui/map/vue/map":76,"gui/panel":77,"gui/queryresults/vue/queryresults":80,"gui/search/vue/search":85,"gui/tools/vue/tools":88}]},{},[3])


//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvYXBwL2NvbmZpZy9jb25maWcuanMiLCJzcmMvYXBwL2NvbmZpZy9sb2NhbGVzL2FwcC5qcyIsInNyYy9hcHAvaW5kZXguanMiLCJzcmMvYXBwL3RlbXBsYXRlL2h0bWwvYXBwLmh0bWwiLCJzcmMvYXBwL3RlbXBsYXRlL2h0bWwvZmxvYXRiYXIuaHRtbCIsInNyYy9hcHAvdGVtcGxhdGUvaHRtbC9zaWRlYmFyLWl0ZW0uaHRtbCIsInNyYy9hcHAvdGVtcGxhdGUvaHRtbC9zaWRlYmFyLmh0bWwiLCJzcmMvYXBwL3RlbXBsYXRlL2h0bWwvdmlld3BvcnQuaHRtbCIsInNyYy9hcHAvdGVtcGxhdGUvanMvYXBwbGljYXRpb251aS5qcyIsInNyYy9hcHAvdGVtcGxhdGUvanMvYmFyc3RhY2suanMiLCJzcmMvYXBwL3RlbXBsYXRlL2pzL2Zsb2F0YmFyLmpzIiwic3JjL2FwcC90ZW1wbGF0ZS9qcy9sYXlvdXQuanMiLCJzcmMvYXBwL3RlbXBsYXRlL2pzL3NpZGViYXIuanMiLCJzcmMvYXBwL3RlbXBsYXRlL2pzL3RlbXBsYXRlLmpzIiwic3JjL2FwcC90ZW1wbGF0ZS9qcy92aWV3cG9ydC5qcyIsInNyYy9saWJzL3Nkay9jb3JlL2FwaXNlcnZpY2UuanMiLCJzcmMvbGlicy9zZGsvY29yZS9hcHBsaWNhdGlvbnNlcnZpY2UuanMiLCJzcmMvbGlicy9zZGsvY29yZS9lZGl0aW5nL2VkaXRidWZmZXIuanMiLCJzcmMvbGlicy9zZGsvY29yZS9lZGl0aW5nL2VkaXRvci5qcyIsInNyYy9saWJzL3Nkay9jb3JlL2VkaXRpbmcvdG9vbHMvYWRkZmVhdHVyZXRvb2wuanMiLCJzcmMvbGlicy9zZGsvY29yZS9lZGl0aW5nL3Rvb2xzL2N1dGxpbmV0b29sLmpzIiwic3JjL2xpYnMvc2RrL2NvcmUvZWRpdGluZy90b29scy9kZWxldGVmZWF0dXJlaW50ZXJhY3Rpb24uanMiLCJzcmMvbGlicy9zZGsvY29yZS9lZGl0aW5nL3Rvb2xzL2RlbGV0ZWZlYXR1cmV0b29sLmpzIiwic3JjL2xpYnMvc2RrL2NvcmUvZWRpdGluZy90b29scy9tb2RpZnlmZWF0dXJldG9vbC5qcyIsInNyYy9saWJzL3Nkay9jb3JlL2VkaXRpbmcvdG9vbHMvbW92ZXBvaW50dG9vbC5qcyIsInNyYy9saWJzL3Nkay9jb3JlL2VkaXRpbmcvdG9vbHMvcGlja2ZlYXR1cmV0b29sLmpzIiwic3JjL2xpYnMvc2RrL2NvcmUvZWRpdGluZy90b29scy90b29sLmpzIiwic3JjL2xpYnMvc2RrL2NvcmUvZzN3b2JqZWN0LmpzIiwic3JjL2xpYnMvc2RrL2NvcmUvZ2VvbWV0cnkvZ2VvbS5qcyIsInNyYy9saWJzL3Nkay9jb3JlL2dlb21ldHJ5L2dlb21ldHJ5LmpzIiwic3JjL2xpYnMvc2RrL2NvcmUvaTE4bi9pMThuLnNlcnZpY2UuanMiLCJzcmMvbGlicy9zZGsvY29yZS9pbnRlcmFjdGlvbnMvcGlja2Nvb3JkaW5hdGVzaW50ZXJhY3Rpb24uanMiLCJzcmMvbGlicy9zZGsvY29yZS9pbnRlcmFjdGlvbnMvcGlja2ZlYXR1cmVpbnRlcmFjdGlvbi5qcyIsInNyYy9saWJzL3Nkay9jb3JlL2xheWVyL2xheWVyc3RhdGUuanMiLCJzcmMvbGlicy9zZGsvY29yZS9sYXllci92ZWN0b3JsYXllci5qcyIsInNyYy9saWJzL3Nkay9jb3JlL2xheWVyL3dtc2xheWVyLmpzIiwic3JjL2xpYnMvc2RrL2NvcmUvbWFwL21hcGxheWVyLmpzIiwic3JjL2xpYnMvc2RrL2NvcmUvbWFwL21hcHNyZWdpc3RyeS5qcyIsInNyYy9saWJzL3Nkay9jb3JlL3BsdWdpbi9wbHVnaW4uanMiLCJzcmMvbGlicy9zZGsvY29yZS9wbHVnaW4vcGx1Z2luc3JlZ2lzdHJ5LmpzIiwic3JjL2xpYnMvc2RrL2NvcmUvcHJvamVjdC9wcm9qZWN0LmpzIiwic3JjL2xpYnMvc2RrL2NvcmUvcHJvamVjdC9wcm9qZWN0c3JlZ2lzdHJ5LmpzIiwic3JjL2xpYnMvc2RrL2NvcmUvcHJvamVjdC9wcm9qZWN0dHlwZXMuanMiLCJzcmMvbGlicy9zZGsvY29yZS9xdWVyeS9xdWVyeVFHSVNXTVNQcm92aWRlci5qcyIsInNyYy9saWJzL3Nkay9jb3JlL3F1ZXJ5L3F1ZXJ5V0ZTUHJvdmlkZXIuanMiLCJzcmMvbGlicy9zZGsvY29yZS9xdWVyeS9xdWVyeXNlcnZpY2UuanMiLCJzcmMvbGlicy9zZGsvY29yZS9yb3V0ZXIuanMiLCJzcmMvbGlicy9zZGsvY29yZS91dGlscy9nZW8uanMiLCJzcmMvbGlicy9zZGsvY29yZS91dGlscy91dGlscy5qcyIsInNyYy9saWJzL3Nkay9nM3ctb2wzL3NyYy9jb250cm9scy9jb250cm9sLmpzIiwic3JjL2xpYnMvc2RrL2czdy1vbDMvc3JjL2NvbnRyb2xzL2ludGVyYWN0aW9uY29udHJvbC5qcyIsInNyYy9saWJzL3Nkay9nM3ctb2wzL3NyYy9jb250cm9scy9xdWVyeWNvbnRyb2wuanMiLCJzcmMvbGlicy9zZGsvZzN3LW9sMy9zcmMvY29udHJvbHMvcmVzZXRjb250cm9sLmpzIiwic3JjL2xpYnMvc2RrL2czdy1vbDMvc3JjL2NvbnRyb2xzL3pvb21ib3hjb250cm9sLmpzIiwic3JjL2xpYnMvc2RrL2czdy1vbDMvc3JjL2czdy5vbDMuanMiLCJzcmMvbGlicy9zZGsvZzN3LW9sMy9zcmMvaW50ZXJhY3Rpb25zL3BpY2tjb29yZGluYXRlc2ludGVyYWN0aW9uLmpzIiwic3JjL2xpYnMvc2RrL2czdy1vbDMvc3JjL2ludGVyYWN0aW9ucy9waWNrZmVhdHVyZWludGVyYWN0aW9uLmpzIiwic3JjL2xpYnMvc2RrL2czdy1vbDMvc3JjL2xheWVycy9iYXNlcy5qcyIsInNyYy9saWJzL3Nkay9nM3ctb2wzL3NyYy9sYXllcnMvcmFzdGVycy5qcyIsInNyYy9saWJzL3Nkay9nM3ctb2wzL3NyYy9tYXAvbWFwaGVscGVycy5qcyIsInNyYy9saWJzL3Nkay9nM3ctb2wzL3NyYy91dGlscy5qcyIsInNyYy9saWJzL3Nkay9ndWkvY2F0YWxvZy92dWUvY2F0YWxvZy5odG1sIiwic3JjL2xpYnMvc2RrL2d1aS9jYXRhbG9nL3Z1ZS9jYXRhbG9nLmpzIiwic3JjL2xpYnMvc2RrL2d1aS9jYXRhbG9nL3Z1ZS9sZWdlbmQuaHRtbCIsInNyYy9saWJzL3Nkay9ndWkvY2F0YWxvZy92dWUvbGVnZW5kX2l0ZW0uaHRtbCIsInNyYy9saWJzL3Nkay9ndWkvY2F0YWxvZy92dWUvdHJpc3RhdGUtdHJlZS5odG1sIiwic3JjL2xpYnMvc2RrL2d1aS9jb21wb25lbnQuanMiLCJzcmMvbGlicy9zZGsvZ3VpL2NvbXBvbmVudHNyZWdpc3RyeS5qcyIsInNyYy9saWJzL3Nkay9ndWkvZm9ybS5qcyIsInNyYy9saWJzL3Nkay9ndWkvZm9ybXBhbmVsLmh0bWwiLCJzcmMvbGlicy9zZGsvZ3VpL2d1aS5qcyIsInNyYy9saWJzL3Nkay9ndWkvbGlzdHBhbmVsLmh0bWwiLCJzcmMvbGlicy9zZGsvZ3VpL2xpc3RwYW5lbC5qcyIsInNyYy9saWJzL3Nkay9ndWkvbWFwL21hcHNlcnZpY2UuanMiLCJzcmMvbGlicy9zZGsvZ3VpL21hcC92dWUvbWFwLmh0bWwiLCJzcmMvbGlicy9zZGsvZ3VpL21hcC92dWUvbWFwLmpzIiwic3JjL2xpYnMvc2RrL2d1aS9wYW5lbC5qcyIsInNyYy9saWJzL3Nkay9ndWkvcXVlcnlyZXN1bHRzL3F1ZXJ5cmVzdWx0c3NlcnZpY2UuanMiLCJzcmMvbGlicy9zZGsvZ3VpL3F1ZXJ5cmVzdWx0cy92dWUvcXVlcnlyZXN1bHRzLmh0bWwiLCJzcmMvbGlicy9zZGsvZ3VpL3F1ZXJ5cmVzdWx0cy92dWUvcXVlcnlyZXN1bHRzLmpzIiwic3JjL2xpYnMvc2RrL2d1aS9zZWFyY2gvc2VhcmNoZXNzZXJ2aWNlLmpzIiwic3JjL2xpYnMvc2RrL2d1aS9zZWFyY2gvdnVlL3BhbmVsL3NlYXJjaHBhbmVsLmh0bWwiLCJzcmMvbGlicy9zZGsvZ3VpL3NlYXJjaC92dWUvcGFuZWwvc2VhcmNocGFuZWwuanMiLCJzcmMvbGlicy9zZGsvZ3VpL3NlYXJjaC92dWUvc2VhcmNoLmh0bWwiLCJzcmMvbGlicy9zZGsvZ3VpL3NlYXJjaC92dWUvc2VhcmNoLmpzIiwic3JjL2xpYnMvc2RrL2d1aS90b29scy90b29sc3NlcnZpY2UuanMiLCJzcmMvbGlicy9zZGsvZ3VpL3Rvb2xzL3Z1ZS90b29scy5odG1sIiwic3JjL2xpYnMvc2RrL2d1aS90b29scy92dWUvdG9vbHMuanMiLCJzcmMvbGlicy9zZGsvZ3VpL3Z1ZS9jb21wb25lbnQuanMiLCJzcmMvbGlicy9zZGsvZ3VpL3Z1ZS92dWUuZGlyZWN0aXZlcy5qcyIsInNyYy9saWJzL3Nkay9zZGsuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUNBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDL0NBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNqQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN4SUE7QUFDQTs7QUNEQTtBQUNBOztBQ0RBO0FBQ0E7O0FDREE7QUFDQTs7QUNEQTtBQUNBOztBQ0RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNqRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN2REE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzFIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ254QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3ZIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDN1FBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzNOQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNsRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDaERBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDeE9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDcmRBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM3SEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNqWUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNyRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2xNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzlJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzdHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDMUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNwRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN0TkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDMUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDL0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNsREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM5RkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMzRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNqVkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDOUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3hCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNmQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN6REE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3ZLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNyS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ0xBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDekhBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDck9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2pYQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNqRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDZkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3JKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2pEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN0REE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3pDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3pCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzNDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3RCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbERBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM1RkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNoRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdkZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdE5BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDVkE7QUFDQTs7QUNEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzVOQTtBQUNBOztBQ0RBO0FBQ0E7O0FDREE7QUFDQTs7QUNEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ25FQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDaENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDOVJBO0FBQ0E7O0FDREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2pFQTtBQUNBOztBQ0RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQy9EQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN0bkJBO0FBQ0E7O0FDREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3JEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNsRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2xHQTtBQUNBOztBQ0RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzlXQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3hDQTtBQUNBOztBQ0RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbElBO0FBQ0E7O0FDREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdERBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQy9EQTtBQUNBOztBQ0RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDM0NBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDN0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJidWlsZC5qcyIsInNvdXJjZVJvb3QiOiIvc291cmNlLyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwidmFyIGFwcHRpdGxlID0gXCJHM1cgQ2xpZW50XCI7XG5cbnZhciBwbHVnaW5zID0ge1xufTtcblxudmFyIHRvb2xzID0ge1xuICB0b29sczogIFtdXG59O1xuXG52YXIgbWFwY29udHJvbHMgPSBbJ3pvb20nLCd6b29tYm94JywncXVlcnknLCdzY2FsZWxpbmUnXTtcbi8vdmFyIG1hcGNvbnRyb2xzID0gWyd6b29tJywnem9vbWJveCcsJ3pvb210b2V4dGVudCcsJ3F1ZXJ5J107XG5cbnZhciBpMThuID0ge1xuICByZXNvdXJjZXM6IHJlcXVpcmUoJy4vbG9jYWxlcy9hcHAuanMnKVxufTtcblxudmFyIGNsaWVudCA9ICB7XG4gIGRlYnVnOiAgdHJ1ZSxcbiAgbG9jYWw6ICBmYWxzZVxufTtcblxudmFyIHNlcnZlciA9ICB7XG4gIHVybHM6ICB7XG4gICAgb3dzOiAgJy9vd3MnLFxuICAgIGFwaTogICcvYXBpJyxcbiAgICBjb25maWc6ICAnL2FwaS9jb25maWcnLFxuICAgIHN0YXRpY3VybDogICcnLFxuICB9XG59O1xuXG4vKnZhciB0ZW1wbGF0ZXMgPSAge1xuICBhcHA6ICByZXF1aXJlKCcuLi90ZW1wbGF0ZXMvYXBwLmh0bWwnKSxcbiAgc2lkZWJhcjogIHJlcXVpcmUoJy4uL3RlbXBsYXRlcy9zaWRlYmFyLmh0bWwnKSxcbiAgZmxvYXRiYXI6ICByZXF1aXJlKCcuLi90ZW1wbGF0ZXMvZmxvYXRiYXIuaHRtbCcpLFxufTsqL1xuXG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgYXBwdGl0bGU6IGFwcHRpdGxlLFxuICBjbGllbnQ6IGNsaWVudCxcbiAgc2VydmVyOiBzZXJ2ZXIsXG4gIHBsdWdpbnM6ICBwbHVnaW5zLFxuICB0b29sczogIHRvb2xzLFxuICBtYXA6IHtcbiAgICBjb250cm9sczogbWFwY29udHJvbHNcbiAgfSxcbiAgaTE4bjogaTE4blxufTtcbiIsInZhciB0cmFuc2xhdGlvbnMgPSB7XG4gICAgXCJpdFwiOiB7XG4gICAgICAgIFwidHJhbnNsYXRpb25cIjoge1xuICAgICAgICAgICAgXCJjb21wb25lbnRcIjogXCJDb21wb25lbnRlIEdlbmVyaWNvXCIsXG4gICAgICAgICAgICBcInNlYXJjaFwiOiBcIlJpY2VyY2FcIixcbiAgICAgICAgICAgIFwiZG9zZWFyY2hcIjogXCJDZXJjYVwiLFxuICAgICAgICAgICAgXCJjYXRhbG9nXCI6IFwiTWFwcGFcIixcbiAgICAgICAgICAgIFwiYmFzZWxheWVyc1wiOiBcIkJhc2lcIixcbiAgICAgICAgICAgIFwidG9vbHNcIjogXCJTdHJ1bWVudGlcIixcbiAgICAgICAgICAgIFwidHJlZVwiOiBcIlN0cmF0aVwiLFxuICAgICAgICAgICAgXCJsZWdlbmRcIjogXCJMZWdlbmRhXCIsXG4gICAgICAgICAgICBcInN0cmVldF9zZWFyY2hcIjogXCJDZXJjYSBpbmRpcml6em9cIlxuICAgICAgICB9XG4gICAgfVxufTtcblxubW9kdWxlLmV4cG9ydHMgPSB0cmFuc2xhdGlvbnM7XG4iLCJ2YXIgaTE4bmluaXQgPSByZXF1aXJlKCdzZGsnKS5jb3JlLmkxOG4uaW5pdDtcbnZhciBBcHBsaWNhdGlvblNlcnZpY2UgPSByZXF1aXJlKCdzZGsvc2RrJykuY29yZS5BcHBsaWNhdGlvblNlcnZpY2U7XG52YXIgQXBwbGljYXRpb25UZW1wbGF0ZSA9IHJlcXVpcmUoJy4vdGVtcGxhdGUvanMvdGVtcGxhdGUnKTtcblxuLy8gU0VUVE8gTEEgVkFSSUFCSUxFIEdMT0JBTEUgZzN3c2RrLCBDT01FIFNFIEFWRVNTSSBVU0FUTyBzZGsuanNcbndpbmRvdy5nM3dzZGsgPSByZXF1aXJlKCdzZGsnKTtcblxudmFyIGNvbmZpZyA9IHJlcXVpcmUoJy4vY29uZmlnL2NvbmZpZy5qcycpO1xuXG5mdW5jdGlvbiBjcmVhdGVBcHBsaWNhdGlvbkNvbmZpZygpIHsgIFxuICByZXR1cm4ge1xuICAgIGFwcHRpdGxlOiBjb25maWcuYXBwdGl0bGUgfHwgJycsXG4gICAgbG9nb19pbWc6IGNvbmZpZy5ncm91cC5oZWFkZXJfbG9nb19pbWcsXG4gICAgbG9nb19saW5rOiBjb25maWcuZ3JvdXAuaGVhZGVyX2xvZ29fbGluayxcbiAgICB0ZXJtc19vZl91c2VfdGV4dDogY29uZmlnLmdyb3VwLmhlYWRlcl90ZXJtc19vZl91c2VfdGV4dCxcbiAgICB0ZXJtc19vZl91c2VfbGluazogY29uZmlnLmdyb3VwLnRlcm1zX29mX3VzZV9saW5rLFxuICAgIGRlYnVnOiBjb25maWcuY2xpZW50LmRlYnVnIHx8IGZhbHNlLFxuICAgIGdyb3VwOiBjb25maWcuZ3JvdXAsXG4gICAgdXJsczogY29uZmlnLnNlcnZlci51cmxzLFxuICAgIG1lZGlhdXJsOiBjb25maWcuc2VydmVyLnVybHMubWVkaWF1cmwsXG4gICAgcmVzb3VyY2VzdXJsOiBjb25maWcuc2VydmVyLnVybHMuc3RhdGljdXJsLFxuICAgIHByb2plY3RzOiBjb25maWcuZ3JvdXAucHJvamVjdHMsXG4gICAgaW5pdHByb2plY3Q6IGNvbmZpZy5ncm91cC5pbml0cHJvamVjdCxcbiAgICBiYXNlbGF5ZXJzOiBjb25maWcuZ3JvdXAuYmFzZWxheWVycyxcbiAgICBjcnM6IGNvbmZpZy5ncm91cC5jcnMsXG4gICAgcHJvajQ6IGNvbmZpZy5ncm91cC5wcm9qNCxcbiAgICBtaW5zY2FsZTogY29uZmlnLmdyb3VwLm1pbnNjYWxlLFxuICAgIG1heHNjYWxlOiBjb25maWcuZ3JvdXAubWF4c2NhbGUsXG4gICAgLy8gcmljaGllc3RvIGRhIFByb2plY3RTZXJ2aWNlXG4gICAgZ2V0V21zVXJsOiBmdW5jdGlvbihwcm9qZWN0KXtcbiAgICAgIHJldHVybiBjb25maWcuc2VydmVyLnVybHMub3dzKycvJytjb25maWcuZ3JvdXAuaWQrJy8nK3Byb2plY3QudHlwZSsnLycrcHJvamVjdC5pZDtcbiAgICB9LFxuICAgIC8vIHJpY2hpZXN0byBkYSBQcm9qZWN0c1JlZ2lzdHJ5XG4gICAgZ2V0UHJvamVjdENvbmZpZ1VybDogZnVuY3Rpb24ocHJvamVjdCl7XG4gICAgICByZXR1cm4gY29uZmlnLnNlcnZlci51cmxzLmNvbmZpZysnLycrY29uZmlnLmdyb3VwLmlkKycvJytwcm9qZWN0LnR5cGUrJy8nK3Byb2plY3QuaWQ7XG4gICAgfSxcbiAgICBwbHVnaW5zOiBjb25maWcuZ3JvdXAucGx1Z2lucyxcbiAgICB0b29sczogY29uZmlnLnRvb2xzLFxuICAgIHZpZXdzOiBjb25maWcudmlld3MgfHwge30sXG4gICAgbWFwOiBjb25maWcubWFwXG4gIH07XG59O1xuXG4vLyBxdWVzdGEgw6ggbGEgY29uZmlndXJhemlvbmUgYmFzZSBkZWwgdGVtcGxhdGUgY2hlIGNvbnRlcnLDoCB0dXR0aSBnbGlcbi8vIGVsZW1lbnRpIHByZXZpc3RpIGRhbCB0ZW1wbGF0ZS4gTmVsbGEgZGVmaW5pemlvbmUgc29ubyB0dXR0aSBvZ2dldHRpIHZ1b3RpXG4vLyBTYXLDoCBsJ2FwcGxpY2F6aW9uZSBhIHNjZWdsaWVyZSBkaSByaWVtcGlyZSBnbGkgZWxlbWVudGlcbmZ1bmN0aW9uIGNyZWF0ZVRlbXBsYXRlQ29uZmlnKCl7XG4gIHZhciBDYXRhbG9nQ29tcG9uZW50ID0gcmVxdWlyZSgnc2RrJykuZ3VpLnZ1ZS5DYXRhbG9nQ29tcG9uZW50O1xuICB2YXIgU2VhcmNoQ29tcG9uZW50ID0gcmVxdWlyZSgnc2RrJykuZ3VpLnZ1ZS5TZWFyY2hDb21wb25lbnQ7XG4gIHZhciBUb29sc0NvbXBvbmVudCA9IHJlcXVpcmUoJ3NkaycpLmd1aS52dWUuVG9vbHNDb21wb25lbnQ7XG4gIHZhciBNYXBDb21wb25lbnQgPSByZXF1aXJlKCdzZGsnKS5ndWkudnVlLk1hcENvbXBvbmVudDtcbiAgLy9hbCBtb21lbnRvIHNpIHV0aWxpenphIHF1ZXNsbG8gcXVlbmVyaWNvIG1hIHNpIHBvdHJlYmJlIGNvc3RydWlyZSB1biBjb21wb25lbnRlXG4gIC8vYWQgaG9jIHBlciBpIHJpc3VsdGF0aVxuICB2YXIgUXVlcnlSZXN1bHRzQ29tcG9uZW50ID0gcmVxdWlyZSgnc2RrJykuZ3VpLnZ1ZS5RdWVyeVJlc3VsdHNDb21wb25lbnQ7XG4gIFxuICByZXR1cm4ge1xuICAgIHRpdGxlOiBjb25maWcuYXBwdGl0bGUsXG4gICAgcGxhY2Vob2xkZXJzOiB7XG4gICAgICBuYXZiYXI6IHtcbiAgICAgICAgY29tcG9uZW50czogW11cbiAgICAgIH0sXG4gICAgICBzaWRlYmFyOiB7XG4gICAgICAgIGNvbXBvbmVudHM6IFtcbiAgICAgICAgICBuZXcgU2VhcmNoQ29tcG9uZW50KHtcbiAgICAgICAgICAgIGlkOiAnc2VhcmNoJyxcbiAgICAgICAgICAgIG9wZW46IGZhbHNlLFxuICAgICAgICAgICAgaWNvbjogXCJmYSBmYS1zZWFyY2hcIlxuICAgICAgICAgIH0pLFxuICAgICAgICAgIG5ldyBDYXRhbG9nQ29tcG9uZW50KHtcbiAgICAgICAgICAgIGlkOiAnY2F0YWxvZycsXG4gICAgICAgICAgICBvcGVuOiB0cnVlLFxuICAgICAgICAgICAgaWNvbjogXCJmYSBmYS1kYXRhYmFzZVwiXG4gICAgICAgICAgfSksXG4gICAgICAgICAgbmV3IFRvb2xzQ29tcG9uZW50KHtcbiAgICAgICAgICAgIGlkOiAndG9vbHMnLFxuICAgICAgICAgICAgb3BlbjogZmFsc2UsXG4gICAgICAgICAgICBpY29uOiBcImZhIGZhLWdlYXJcIlxuICAgICAgICAgIH0pXG4gICAgICAgIF1cbiAgICAgIH0sXG4gICAgICB2aWV3cG9ydDogeyAvLyBwbGFjZWhvbGRlciBkZWwgY29udGVudXRvICh2aWV3IGNvbnRlbnQpIGluaXppYWxtZW50ZSBWaXN0YSBTZWNvbmRhcmlhIChuYXNjb3N0YSlcbiAgICAgICAgY29tcG9uZW50czogW1xuICAgICAgICAgIG5ldyBNYXBDb21wb25lbnQoe1xuICAgICAgICAgICAgaWQ6ICdtYXAnXG4gICAgICAgICAgfSlcbiAgICAgICAgXVxuICAgICAgfSwgXG4gICAgICBmbG9hdGJhcjp7XG4gICAgICAgIGNvbXBvbmVudHM6IFtdXG4gICAgICB9XG4gICAgfSxcbiAgICBvdGhlcmNvbXBvbmVudHM6IFtcbiAgICAgIG5ldyBRdWVyeVJlc3VsdHNDb21wb25lbnQoe1xuICAgICAgICAgIGlkOiAncXVlcnlyZXN1bHRzJ1xuICAgICAgfSlcbiAgICBdXG4gIH07XG59XG5cbmZ1bmN0aW9uIG9idGFpbkluaXRDb25maWcoKXtcbiAgdmFyIGQgPSAkLkRlZmVycmVkKCk7XG4gIGlmICh3aW5kb3cuaW5pdENvbmZpZykge1xuICAgIHJldHVybiBkLnJlc29sdmUod2luZG93LmluaXRDb25maWcpO1xuICB9XG4gIC8vIGFsdHJpbWVudGkgZGV2byBhc3BldHRhcmUgY2hlIGxvY2FsLmluaXRjb25maWcuanMgYWJiaWEgY2FyaWNhdG8gbCdpbml0Y29uZmlnXG4gIGVsc2V7XG4gICAgJChkb2N1bWVudCkub24oJ2luaXRjb25maWdSZWFkeScsZnVuY3Rpb24oZSxpbml0Y29uZmlnKXtcbiAgICAgIHJldHVybiBkLnJlc29sdmUoaW5pdGNvbmZpZyk7XG4gICAgfSlcbiAgfVxuICByZXR1cm4gZC5wcm9taXNlKCk7XG59XG5cbkFwcGxpY2F0aW9uU2VydmljZS5vbigncmVhZHknLGZ1bmN0aW9uKCl7XG4gIC8vaXN0YW56aW8gbCdhcHBpY2F0aW9uIHRlbXBsYXRlIHBhc3NhbmRvIGxhIGNvbmZpZ3VyYXppb25lIGRlbCB0ZW1wbGF0ZSBlIGwnYXBwbGljYXRpb25TZXJ2aWNlIGNoZSBmb3JuaXNjZSBBUEkgZGVsIHByb2dldHRvXG4gIHZhciB0ZW1wbGF0ZUNvbmZpZyA9IGNyZWF0ZVRlbXBsYXRlQ29uZmlnKCk7XG4gIC8vaXN0YW56aW8gbCdhcHBsaWNhdGlvbiBUZW1wbGF0ZVxuICBhcHBsaWNhdGlvblRlbXBsYXRlID0gbmV3IEFwcGxpY2F0aW9uVGVtcGxhdGUodGVtcGxhdGVDb25maWcsIHRoaXMpO1xuICAvL2luaXppYWxpenpvIGUgZmFjY2lvIHBhcnRpcmUgY29uIGlsbWV0b2RvIGluaXRcbiAgYXBwbGljYXRpb25UZW1wbGF0ZS5pbml0KCk7XG59KTtcblxuYm9vdHN0cmFwID0gZnVuY3Rpb24oKXtcbiAgaTE4bmluaXQoY29uZmlnLmkxOG4pO1xuICBvYnRhaW5Jbml0Q29uZmlnKClcbiAgLnRoZW4oZnVuY3Rpb24oaW5pdENvbmZpZyl7XG4gICAgY29uZmlnLnNlcnZlci51cmxzLnN0YXRpY3VybCA9IGluaXRDb25maWcuc3RhdGljdXJsO1xuICAgIGNvbmZpZy5zZXJ2ZXIudXJscy5tZWRpYXVybCA9IGluaXRDb25maWcubWVkaWF1cmw7XG4gICAgY29uZmlnLmdyb3VwID0gaW5pdENvbmZpZy5ncm91cDtcbiAgICBcbiAgICB2YXIgYXBwbGljYXRpb25Db25maWcgPSBjcmVhdGVBcHBsaWNhdGlvbkNvbmZpZygpO1xuICAgIEFwcGxpY2F0aW9uU2VydmljZS5pbml0KGFwcGxpY2F0aW9uQ29uZmlnKTtcbiAgfSlcbn0oKTtcblxuXG4iLCJtb2R1bGUuZXhwb3J0cyA9IFwiPGRpdiBjbGFzcz1cXFwid3JhcHBlclxcXCI+XFxuICA8aGVhZGVyIGNsYXNzPVxcXCJtYWluLWhlYWRlclxcXCI+XFxuICAgIDwhLS0gTG9nbyAtLT5cXG4gICAgPCEtLSBIZWFkZXIgTmF2YmFyOiBzdHlsZSBjYW4gYmUgZm91bmQgaW4gaGVhZGVyLmxlc3MgLS0+XFxuICAgIDxuYXYgY2xhc3M9XFxcIm5hdmJhciBuYXZiYXItc3RhdGljLXRvcFxcXCIgcm9sZT1cXFwibmF2aWdhdGlvblxcXCI+XFxuICAgICAgPCEtLSBUb2dnbGUgYnV0dG9uIG9uIG5hdmJhciBvbmx5IGZvciBtb2JpbGUgLS0+XFxuICAgICAgPGEgdi1pZj1cXFwiaXNNb2JpbGUoKVxcXCIgaHJlZj1cXFwiI1xcXCIgY2xhc3M9XFxcInNpZGViYXItdG9nZ2xlXFxcIiBkYXRhLXRvZ2dsZT1cXFwib2ZmY2FudmFzXFxcIiByb2xlPVxcXCJidXR0b25cXFwiPlxcbiAgICAgICAgPHNwYW4gY2xhc3M9XFxcInNyLW9ubHlcXFwiPkV4cGFuZDwvc3Bhbj5cXG4gICAgICA8L2E+XFxuICAgICAgPGRpdiBjbGFzcz1cXFwibG9nby13cmFwcGVyXFxcIj5cXG4gICAgICAgIDxhIHYtaWY9XFxcImxvZ29fdXJsXFxcIiA6aHJlZj1cXFwibG9nb19saW5rXFxcIiA6dGFyZ2V0PVxcXCJsb2dvX2xpbmtfdGFyZ2V0XFxcIiBjbGFzcz1cXFwiXFxcIj48aW1nIDpzcmM9XFxcImxvZ29fdXJsXFxcIiBzdHlsZT1cXFwiaGVpZ2h0OjQwcHhcXFwiPjwvYT5cXG4gICAgICAgIDxzcGFuIGNsYXNzPVxcXCJcXFwiPnt7cHJvamVjdF90aXRsZX19PC9zcGFuPlxcbiAgICAgIDwvZGl2PlxcbiAgICA8L25hdj5cXG4gIDwvaGVhZGVyPlxcbiAgPCEtLSBMZWZ0IHNpZGUgY29sdW1uLiBjb250YWlucyB0aGUgbG9nbyBhbmQgc2lkZWJhciAtLT5cXG4gIDxzaWRlYmFyPjwvc2lkZWJhcj5cXG4gIDwhLS0gQ29udGVudCBXcmFwcGVyLiBDb250YWlucyBwYWdlIGNvbnRlbnQgLS0+XFxuICA8ZGl2IGNsYXNzPVxcXCJjb250ZW50LXdyYXBwZXJcXFwiIHN0eWxlPVxcXCJiYWNrZ3JvdW5kLWNvbG9yOndoaXRlXFxcIj5cXG4gICAgPHZpZXdwb3J0Pjwvdmlld3BvcnQ+XFxuICA8L2Rpdj5cXG4gIDwhLS0gLy5jb250ZW50LXdyYXBwZXIgLS0+XFxuICA8IS0tIENvbnRyb2wgU2lkZWJhciAtLT5cXG4gIDxmbG9hdGJhcj48L2Zsb2F0YmFyPlxcbiAgPCEtLSAvLmNvbnRyb2wtc2lkZWJhciAtLT5cXG4gIDwhLS0gQWRkIHRoZSBzaWRlYmFyJ3MgYmFja2dyb3VuZC4gVGhpcyBkaXYgbXVzdCBiZSBwbGFjZWRcXG4gICAgICAgaW1tZWRpYXRlbHkgYWZ0ZXIgdGhlIGNvbnRyb2wgc2lkZWJhciAtLT5cXG4gIDxkaXYgY2xhc3M9XFxcImNvbnRyb2wtc2lkZWJhci1iZ1xcXCI+PC9kaXY+XFxuPC9kaXY+XFxuXCI7XG4iLCJtb2R1bGUuZXhwb3J0cyA9IFwiPGFzaWRlIGNsYXNzPVxcXCJjb250cm9sLXNpZGViYXIgY29udHJvbC1zaWRlYmFyLWxpZ2h0XFxcIiA+XFxuICA8YSB2LXNob3c9XFxcInBhbmVsc2luc3RhY2tcXFwiIGhyZWY9XFxcIiNcXFwiIGNsYXNzPVxcXCJmbG9hdGJhci1hc2lkZS10b2dnbGVcXFwiIGRhdGEtdG9nZ2xlPVxcXCJjb250cm9sLXNpZGViYXJcXFwiIHJvbGU9XFxcImJ1dHRvblxcXCI+XFxuICAgIDxzcGFuIGNsYXNzPVxcXCJzci1vbmx5XFxcIj5FeHBhbmQ8L3NwYW4+XFxuICA8L2E+XFxuICA8ZGl2IGlkPVxcXCJmbG9hdGJhci1zcGlubmVyXFxcIiBzdHlsZT1cXFwicG9zaXRpb246YWJzb2x1dGVcXFwiPjwvZGl2PlxcbiAgPGRpdiB2LXNob3c9XFxcInBhbmVsc2luc3RhY2tcXFwiIGNsYXNzPVxcXCJnM3ctc2lkZWJhcnBhbmVsXFxcIj5cXG4gICAgPGRpdiBjbGFzcz1cXFwicm93XFxcIj5cXG4gICAgICA8ZGl2IGNsYXNzPVxcXCJjb2wteHMtMTIgY29sLXNtLTEyIGNvbC1tZC0xMlxcXCI+XFxuICAgICAgICA8YnV0dG9uIGNsYXNzPVxcXCJnbHlwaGljb24gZ2x5cGhpY29uLXJlbW92ZSBwdWxsLXJpZ2h0IGNsb3NlLXBhbmVsLWJ1dHRvblxcXCIgQGNsaWNrPVxcXCJjbG9zZVBhbmVsXFxcIj48L2J1dHRvbj5cXG4gICAgICA8L2Rpdj5cXG4gICAgPC9kaXY+XFxuICAgIDxkaXY+XFxuICAgICAgPGg0IGNsYXNzPVxcXCJnM3ctZmxvYXRiYXJwYW5lbC1uYW1lXFxcIj57eyBwYW5lbG5hbWUgfX08L2gyPlxcbiAgICA8L2Rpdj5cXG4gICAgPGRpdiBpZD1cXFwiZzN3LWZsb2F0YmFycGFuZWwtcGxhY2Vob2xkZXJcXFwiIGNsYXNzPVxcXCJnM3ctZmxvYXRiYXJwYW5lbC1wbGFjZWhvbGRlclxcXCI+PC9kaXY+XFxuICA8L2Rpdj5cXG48L2FzaWRlPlxcblwiO1xuIiwibW9kdWxlLmV4cG9ydHMgPSBcIjxsaSB2LXNob3c9XFxcInN0YXRlLnZpc2libGVcXFwiIGNsYXNzPVxcXCJ0cmVldmlld1xcXCIgOmNsYXNzPVxcXCJ7J2FjdGl2ZSc6IG9wZW59XFxcIj5cXG4gIDxhIGhyZWY9XFxcIiNcXFwiPlxcbiAgICA8aSA6Y2xhc3M9XFxcImljb25cXFwiPjwvaT5cXG4gICAgPHNwYW4gY2xhc3M9XFxcInRyZWV2aWV3LWxhYmVsXFxcIj57e3RpdGxlIHwgdH19PC9zcGFuPlxcbiAgICA8aSB2LWlmPVxcXCIoZGF0YVR5cGUgPT09ICdpbmxpbmUnKVxcXCIgY2xhc3M9XFxcImZhIGZhLWFuZ2xlLWxlZnQgcHVsbC1yaWdodFxcXCI+PC9pPlxcbiAgPC9hPlxcbiAgPHVsIHYtaWY9XFxcIihkYXRhVHlwZSA9PT0gJ2lubGluZScpXFxcIiBjbGFzcz1cXFwidHJlZXZpZXctbWVudVxcXCI+XFxuICAgIDxkaXYgaWQ9XFxcImczdy1zaWRlYmFyY29tcG9uZW50LXBsYWNlaG9sZGVyXFxcIj48L2Rpdj5cXG4gIDwvdWw+XFxuPC9saT5cXG5cIjtcbiIsIm1vZHVsZS5leHBvcnRzID0gXCI8YXNpZGUgY2xhc3M9XFxcIm1haW4tc2lkZWJhclxcXCI+XFxuICA8IS0tIHNpZGViYXI6IHN0eWxlIGNhbiBiZSBmb3VuZCBpbiBzaWRlYmFyLmxlc3MgLS0+XFxuICA8IS0tIFNpZGViYXIgdG9nZ2xlIGJ1dHRvbi0tPlxcbiAgPCEtLSBUb2dnbGUgYnV0dG9uIG9uIHRoZSBsZWZ0IHNpZGUgb2YgbWFpbiBzaWRlYmFyIG9ubHkgaWYgbm90IG1vYmlsZSAtLT5cXG4gIDxhIHYtaWY9XFxcIiFpc01vYmlsZSgpXFxcIiBocmVmPVxcXCIjXFxcIiBjbGFzcz1cXFwic2lkZWJhci1hc2lkZS10b2dnbGVcXFwiIGRhdGEtdG9nZ2xlPVxcXCJvZmZjYW52YXNcXFwiIHJvbGU9XFxcImJ1dHRvblxcXCI+XFxuICAgIDxzcGFuIGNsYXNzPVxcXCJzci1vbmx5XFxcIj5FeHBhbmQ8L3NwYW4+XFxuICA8L2E+XFxuXFx0PHNlY3Rpb24gY2xhc3M9XFxcInNpZGViYXJcXFwiPlxcbiAgICA8ZGl2IHYtc2hvdz1cXFwicGFuZWxzaW5zdGFja1xcXCIgY2xhc3M9XFxcImczdy1zaWRlYmFycGFuZWxcXFwiPlxcbiAgICAgIDxkaXYgc3R5bGU9XFxcIm92ZXJmbG93OiBoaWRkZW47bGluZS1oZWlnaHQ6IDE0cHg7bWFyZ2luLXRvcDogNHB4OyBmb250LXNpemU6MS41ZW1cXFwiPlxcbiAgICAgICAgICA8YnV0dG9uIGNsYXNzPVxcXCJnbHlwaGljb24gZ2x5cGhpY29uLXJlbW92ZSBwdWxsLXJpZ2h0IGNsb3NlLXBhbmVsLWJ1dHRvblxcXCIgQGNsaWNrPVxcXCJjbG9zZVBhbmVsXFxcIj48L2J1dHRvbj5cXG4gICAgICA8L2Rpdj5cXG4gICAgICA8ZGl2IGlkPVxcXCJnM3ctc2lkZWJhcnBhbmVsLXBsYWNlaG9sZGVyXFxcIiBjbGFzcz1cXFwiZzN3LXNpZGViYXJwYW5lbC1wbGFjZWhvbGRlclxcXCI+PC9kaXY+XFxuICAgIDwvZGl2PlxcblxcdCAgPHVsIGlkPVxcXCJnM3ctc2lkZWJhcmNvbXBvbmVudHNcXFwiIHYtc2hvdz1cXFwic2hvd21haW5wYW5lbFxcXCIgY2xhc3M9XFxcInNpZGViYXItbWVudVxcXCI+PC91bD5cXG5cXHQ8L3NlY3Rpb24+XFxuXFx0PCEtLSAvLnNpZGViYXIgLS0+XFxuPC9hc2lkZT5cXG5cIjtcbiIsIm1vZHVsZS5leHBvcnRzID0gXCI8ZGl2PlxcbiAgPGRpdiBpZD1cXFwiZzN3LXZpZXctb25lXFxcIiBjbGFzcz1cXFwiZzN3LXZpZXcgb25lXFxcIiA6c3R5bGU9XFxcInt3aWR0aDpzdGF0ZS52aWV3U2l6ZXMub25lLndpZHRoKydweCcsaGVpZ2h0OnN0YXRlLnZpZXdTaXplcy5vbmUuaGVpZ2h0KydweCd9XFxcIj48L2Rpdj5cXG4gIDxkaXYgdi1zaG93PVxcXCJzdGF0ZS5zZWNvbmRhcnlWaXNpYmxlXFxcIiBpZD1cXFwiZzN3LXZpZXctdHdvXFxcIiBjbGFzcz1cXFwiZzN3LXZpZXcgdHdvXFxcIiA6c3R5bGU9XFxcInt3aWR0aDpzdGF0ZS52aWV3U2l6ZXMudHdvLndpZHRoKydweCcsaGVpZ2h0OnN0YXRlLnZpZXdTaXplcy50d28uaGVpZ2h0KydweCd9XFxcIj5cXG4gICAgPGRpdj5URVNUIENPTlRFTlVUTyBYPC9kaXY+XFxuICA8L2Rpdj5cXG48L2Rpdj5cXG5cIjtcbiIsInZhciBBcHBsaWNhdGlvblNlcnZpY2UgPSByZXF1aXJlKCdjb3JlL2FwcGxpY2F0aW9uc2VydmljZScpO1xudmFyIFByb2plY3RzUmVnaXN0cnkgPSByZXF1aXJlKCdjb3JlL3Byb2plY3QvcHJvamVjdHNyZWdpc3RyeScpO1xudmFyIGxheW91dCA9IHJlcXVpcmUoJy4vbGF5b3V0Jyk7XG52YXIgQXBwVUkgPSBWdWUuZXh0ZW5kKHtcbiAgdGVtcGxhdGU6IHJlcXVpcmUoJy4uL2h0bWwvYXBwLmh0bWwnKSxcbiAgcmVhZHk6IGZ1bmN0aW9uKCl7XG4gICAgLyogc3RhcnQgdG8gcmVuZGVyIExheW91dE1hbmFnZXIgbGF5b3V0ICovXG4gICAgbGF5b3V0LmxvYWRpbmcoZmFsc2UpO1xuICAgIGxheW91dC5zZXR1cCgpO1xuICAgIC8vRml4IHRoZSBwcm9ibGVtIHdpdGggcmlnaHQgc2lkZWJhciBhbmQgbGF5b3V0IGJveGVkXG4gICAgbGF5b3V0LnB1c2hNZW51LmV4cGFuZE9uSG92ZXIoKTtcbiAgICBsYXlvdXQuY29udHJvbFNpZGViYXIuX2ZpeCgkKFwiLmNvbnRyb2wtc2lkZWJhci1iZ1wiKSk7XG4gICAgbGF5b3V0LmNvbnRyb2xTaWRlYmFyLl9maXgoJChcIi5jb250cm9sLXNpZGViYXJcIikpO1xuICAgIHZhciBjb250cm9sc2lkZWJhckVsID0gbGF5b3V0Lm9wdGlvbnMuY29udHJvbFNpZGViYXJPcHRpb25zLnNlbGVjdG9yO1xuICAgIGZ1bmN0aW9uIHNldEZsb2F0QmFyTWF4SGVpZ2h0KCl7XG4gICAgICAkKGNvbnRyb2xzaWRlYmFyRWwpLmNzcygnbWF4LWhlaWdodCcsJCh3aW5kb3cpLmlubmVySGVpZ2h0KCkpO1xuICAgICAgJCgnLmczdy1zaWRlYmFycGFuZWwnKS5jc3MoJ2hlaWdodCcsJCh3aW5kb3cpLmhlaWdodCgpIC0gJChcIi5tYWluLWhlYWRlclwiKS5oZWlnaHQoKSk7XG4gICAgfVxuICAgIHNldEZsb2F0QmFyTWF4SGVpZ2h0KCk7XG4gICAgZnVuY3Rpb24gc2V0TW9kYWxIZWlnaHQoKXtcbiAgICAgICQoJyNnM3ctbW9kYWwtb3ZlcmxheScpLmNzcygnaGVpZ2h0JywkKHdpbmRvdykuaGVpZ2h0KCkpO1xuICAgIH1cbiAgICAkKHdpbmRvdykucmVzaXplKGZ1bmN0aW9uKCkge1xuICAgICAgc2V0RmxvYXRCYXJNYXhIZWlnaHQoKTtcbiAgICAgIHNldE1vZGFsSGVpZ2h0KCk7XG4gICAgfSk7XG4gICB9LFxuICAgY29tcHV0ZWQ6IHtcbiAgICBsb2dvX3VybDogZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgY29uZmlnID0gQXBwbGljYXRpb25TZXJ2aWNlLmdldENvbmZpZygpO1xuICAgICAgdmFyIGxvZ29fdXJsO1xuICAgICAgaWYgKGNvbmZpZy5sb2dvX2ltZyAmJiBjb25maWcubG9nb19pbWchPScnKSB7XG4gICAgICAgIGxvZ29fdXJsID0gY29uZmlnLm1lZGlhdXJsK2NvbmZpZy5sb2dvX2ltZztcbiAgICAgIH1cbiAgICAgIHJldHVybiBsb2dvX3VybDtcbiAgICB9LFxuICAgIGxvZ29fbGluazogZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgbG9nb19saW5rID0gdGhpcy5nZXRMb2dvTGluaygpO1xuICAgICAgcmV0dXJuIGxvZ29fbGluayA/IGxvZ29fbGluayA6IFwiI1wiO1xuICAgIH0sXG4gICAgbG9nb19saW5rX3RhcmdldDogZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgbG9nb19saW5rID0gdGhpcy5nZXRMb2dvTGluaygpO1xuICAgICAgcmV0dXJuIGxvZ29fbGluayA/IFwiX2JsYW5rXCIgOiBcIlwiO1xuICAgIH0sXG4gICAgcHJvamVjdF90aXRsZTogZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgY3VycmVudFByb2plY3QgPSBQcm9qZWN0c1JlZ2lzdHJ5LmdldEN1cnJlbnRQcm9qZWN0KCk7XG4gICAgICByZXR1cm4gY3VycmVudFByb2plY3Quc3RhdGUubmFtZTtcbiAgICB9XG4gICB9LFxuICAgbWV0aG9kczoge1xuICAgICAgY2xvc2VQYW5lbDogZnVuY3Rpb24oKXtcbiAgICAgICAgc2lkZWJhclNlcnZpY2UuY2xvc2VQYW5lbCgpO1xuICAgICAgfSxcbiAgICAgIGlzTW9iaWxlOiBmdW5jdGlvbigpe3JldHVybiBpc01vYmlsZS5hbnl9LFxuICAgICAgZ2V0TG9nb0xpbms6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgbG9nb19saW5rID0gbnVsbDtcbiAgICAgICAgaWYgKEFwcGxpY2F0aW9uU2VydmljZS5nZXRDb25maWcoKS5sb2dvX2xpbmspIHtcbiAgICAgICAgICBsb2dvX2xpbmsgPSBBcHBsaWNhdGlvblNlcnZpY2UuZ2V0Q29uZmlnKCkubG9nb19saW5rO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBsb2dvX2xpbms7XG4gICAgICB9XG4gICAgfSxcbn0pO1xuXG5tb2R1bGUuZXhwb3J0cyA9IEFwcFVJO1xuIiwidmFyIGluaGVyaXQgPSByZXF1aXJlKCdzZGsvY29yZS91dGlscy91dGlscycpLmluaGVyaXQ7XG52YXIgRzNXT2JqZWN0ID0gcmVxdWlyZSgnc2RrL2NvcmUvZzN3b2JqZWN0Jyk7XG5cbmZ1bmN0aW9uIEJhclN0YWNrKCl7XG4gIHRoaXMuc3RhdGUgPSB7XG4gICAgcGFuZWxzOiBbXVxuICB9XG4gIC8qdGhpcy5zdGF0ZSA9IHtcbiAgICBwYW5lbHM6IFtdXG4gIH07Ki9cbn1cblxuaW5oZXJpdChCYXJTdGFjayxHM1dPYmplY3QpO1xuXG52YXIgcHJvdG8gPSBCYXJTdGFjay5wcm90b3R5cGU7XG5cbnByb3RvLnB1c2ggPSBmdW5jdGlvbihwYW5lbCwgcGFyZW50LCBhcHBlbmQpe1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIHZhciBhcHBlbmQgPSBhcHBlbmQgfHwgZmFsc2U7XG4gIHZhciBpZHhUb1JlbW92ZSA9IG51bGw7XG4gIHZhciBpZCA9IHBhbmVsLmdldElkKCk7XG4gIF8uZm9yRWFjaCh0aGlzLnN0YXRlLnBhbmVscywgZnVuY3Rpb24oX3BhbmVsLGlkeCkge1xuICAgIGlmIChfcGFuZWwuZ2V0SWQoKSA9PSBpZCkge1xuICAgICAgaWR4VG9SZW1vdmUgPSBpZHg7XG4gICAgfTtcbiAgfSk7XG4gIGlmICghXy5pc051bGwoaWR4VG9SZW1vdmUpKSB7XG4gICAgdmFyIF9wYW5lbCA9IHNlbGYuc3RhdGUucGFuZWxzW2lkeFRvUmVtb3ZlXTtcbiAgICBfcGFuZWwudW5tb3VudCgpXG4gICAgLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICBzZWxmLnN0YXRlLnBhbmVscy5zcGxpY2UoaWR4VG9SZW1vdmUsMSk7XG4gICAgfSk7XG4gIH1cbiAgcGFuZWwubW91bnQocGFyZW50LCBhcHBlbmQpXG4gIC50aGVuKGZ1bmN0aW9uKCl7XG4gICAgc2VsZi5zdGF0ZS5wYW5lbHMucHVzaChwYW5lbCk7XG4gIH0pO1xufTtcblxucHJvdG8ucG9wID0gZnVuY3Rpb24oKXtcbiAgLy8gcXVpIHBvdHJlbW8gY2hpZWRlcmUgYWwgcGFubmVsbG8gc2UgcHXDsiBlc3NlcmUgY2hpdXNvLi4uXG4gIHZhciBzZWxmID0gdGhpcztcbiAgdmFyIHBhbmVsID0gdGhpcy5zdGF0ZS5wYW5lbHMuc2xpY2UoLTEpWzBdO1xuICBwYW5lbC51bm1vdW50KClcbiAgLnRoZW4oZnVuY3Rpb24oKXtcbiAgICAvL3NlbGYuc3RhdGUucGFuZWxzLnBvcCgpO1xuICAgIHNlbGYuc3RhdGUucGFuZWxzLnBvcCgpO1xuICB9KTtcbn07XG5cbnByb3RvLmdldExlbmd0aCA9IGZ1bmN0aW9uKCkge1xuICByZXR1cm4gdGhpcy5zdGF0ZS5wYW5lbHMubGVuZ3RoO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBCYXJTdGFjaztcbiIsInZhciB0ID0gcmVxdWlyZSgnc2RrL2NvcmUvaTE4bi9pMThuLnNlcnZpY2UnKS50O1xudmFyIFN0YWNrID0gcmVxdWlyZSgnLi9iYXJzdGFjay5qcycpO1xudmFyIEdVSSA9IHJlcXVpcmUoJ3Nkay9ndWkvZ3VpJyk7XG5cbmZ1bmN0aW9uIEZsb2F0YmFyU2VydmljZSgpe1xuICB0aGlzLnN0YWNrID0gbmV3IFN0YWNrKCk7XG4gIHRoaXMuaW5pdCA9IGZ1bmN0aW9uKGxheW91dCl7XG4gICAgdGhpcy5sYXlvdXQgPSBsYXlvdXQ7XG4gICAgdGhpcy5jbG9zYWJsZSA9IHRydWU7XG4gICAgdGhpcy5zaWRlYmFyRWwgPSAkKHRoaXMubGF5b3V0Lm9wdGlvbnMuY29udHJvbFNpZGViYXJPcHRpb25zLnNlbGVjdG9yKTtcbiAgICB0aGlzLl96aW5kZXggPSB0aGlzLnNpZGViYXJFbC5jc3MoXCJ6LWluZGV4XCIpO1xuICAgIHRoaXMuX21vZGFsT3ZlcmxheSA9IG51bGw7XG4gICAgdGhpcy5fbW9kYWwgPSBmYWxzZTtcbiAgICB0aGlzLl9pc29wZW4gPSBmYWxzZTtcbiAgfTtcblxuICB0aGlzLmlzT3BlbiA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLl9pc29wZW47XG4gIH07XG5cbiAgdGhpcy5vcGVuID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5sYXlvdXQuZmxvYXRCYXIub3Blbih0aGlzLnNpZGViYXJFbCx0cnVlKTtcbiAgICB0aGlzLl9pc29wZW4gPSB0cnVlO1xuICB9O1xuXG4gIHRoaXMuY2xvc2UgPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLmxheW91dC5mbG9hdEJhci5jbG9zZSh0aGlzLnNpZGViYXJFbCx0cnVlKTtcbiAgICB0aGlzLl9pc29wZW4gPSBmYWxzZTtcbiAgfTtcblxuICB0aGlzLnNob3dQYW5lbCA9IGZ1bmN0aW9uKHBhbmVsLG9wdGlvbnMpe1xuICAgIHZhciBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcbiAgICB2YXIgYXBwZW5kID0gb3B0aW9ucy5hcHBlbmQgfHwgZmFsc2U7XG4gICAgdmFyIG1vZGFsID0gb3B0aW9ucy5tb2RhbCB8fCBmYWxzZTtcbiAgICB0aGlzLmNsb3NhYmxlID0gb3B0aW9ucy5jbG9zYWJsZSB8fCB0cnVlO1xuICAgIHRoaXMuc3RhY2sucHVzaChwYW5lbCxcIiNnM3ctZmxvYXRiYXJwYW5lbC1wbGFjZWhvbGRlclwiLCBhcHBlbmQpO1xuICAgIGlmICghdGhpcy5faXNvcGVuKSB7XG4gICAgICB0aGlzLm9wZW4oKTtcbiAgICB9O1xuICAgIGlmIChtb2RhbCl7XG4gICAgICB0aGlzLl9tb2RhbCA9IHRydWU7XG4gICAgICBHVUkuc2V0TW9kYWwoKTtcbiAgICAgIHRoaXMuc2lkZWJhckVsLmNzcyhcInotaW5kZXhcIiw1MDAwKTtcbiAgICAgIHRoaXMuc2lkZWJhckVsLmNzcyhcInBhZGRpbmctdG9wXCIsXCIwcHhcIik7XG4gICAgICAkKCcuY29udHJvbC1zaWRlYmFyLWJnJykuY3NzKFwiei1pbmRleFwiLDQ5OTkpO1xuICAgICAgJCgnLmNvbnRyb2wtc2lkZWJhci1iZycpLnRvZ2dsZUNsYXNzKCdjb250cm9sLXNpZGViYXItYmctc2hhZG93Jyk7XG4gICAgfVxuICB9O1xuICBcbiAgdGhpcy5jbG9zZVBhbmVsID0gZnVuY3Rpb24oKXtcbiAgICB0aGlzLnN0YWNrLnBvcCgpO1xuICAgIGlmICghdGhpcy5zdGFjay5nZXRMZW5ndGgoKSkge1xuICAgICAgaWYgKHRoaXMuX21vZGFsKXtcbiAgICAgICAgR1VJLnNldE1vZGFsKGZhbHNlKTtcbiAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgICAkKCcuY29udHJvbC1zaWRlYmFyLWJnJykudG9nZ2xlQ2xhc3MoJ2NvbnRyb2wtc2lkZWJhci1iZy1zaGFkb3cnKTtcbiAgICAgICAgdGhpcy5zaWRlYmFyRWwuY3NzKFwiei1pbmRleFwiLFwiXCIpO1xuICAgICAgICB0aGlzLnNpZGViYXJFbC5jc3MoXCJwYWRkaW5nLXRvcFwiLFwiNTBweFwiKTtcbiAgICAgICAgJCgnLmNvbnRyb2wtc2lkZWJhci1iZycpLmNzcyhcInotaW5kZXhcIixcIlwiKTtcbiAgICAgICAgdGhpcy5fbW9kYWwgPSBmYWxzZTtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICB9XG4gICAgfVxuICB9O1xuICBcbiAgdGhpcy5oaWRlUGFuZWwgPSBmdW5jdGlvbigpe1xuICAgIHRoaXMuY2xvc2UoKTtcbiAgfTtcbn1cblxudmFyIGZsb2F0YmFyU2VydmljZSA9IG5ldyBGbG9hdGJhclNlcnZpY2UoKTtcblxudmFyIEZsb2F0YmFyQ29tcG9uZW50ID0gVnVlLmV4dGVuZCh7XG4gICAgdGVtcGxhdGU6IHJlcXVpcmUoJy4uL2h0bWwvZmxvYXRiYXIuaHRtbCcpLFxuICAgIGRhdGE6IGZ1bmN0aW9uKCkge1xuICAgIFx0cmV0dXJuIHtcbiAgICAgICAgc3RhY2s6IGZsb2F0YmFyU2VydmljZS5zdGFjay5zdGF0ZSxcbiAgICAgIH07XG4gICAgfSxcbiAgICBjb21wdXRlZDoge1xuICAgICAgLy8gcXVhbnRpIHBhbm5lbGxpIHNvbm8gYXR0aXZpIG5lbGxvIHN0YWNrXG4gICAgICBwYW5lbHNpbnN0YWNrOiBmdW5jdGlvbigpe1xuICAgICAgICByZXR1cm4gdGhpcy5zdGFjay5wYW5lbHMubGVuZ3RoPjA7XG4gICAgICB9LFxuICAgICAgcGFuZWxuYW1lOiBmdW5jdGlvbigpe1xuICAgICAgICB2YXIgbmFtZSA9IFwiXCI7XG4gICAgICAgIGlmICh0aGlzLnN0YWNrLnBhbmVscy5sZW5ndGgpe1xuICAgICAgICAgIG5hbWUgPSB0aGlzLnN0YWNrLnBhbmVscy5zbGljZSgtMSlbMF0uZ2V0VGl0bGUoKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbmFtZTtcbiAgICAgIH0sXG4gICAgICBjbG9zYWJsZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiBmbG9hdGJhclNlcnZpY2UuY2xvc2FibGU7XG4gICAgICB9XG4gICAgfSxcbiAgICB3YXRjaDoge1xuICAgICAgLy8gVE9ETzogQnJ1dHRvLCBtYSDDqCBsJ3VuaWNvIChwZXIgb3JhKSBtb2RvIGZsZXNzaWJpbGUgY2hlIGhvIHRyb3ZhdG8gcGVyIGltcGxlbWVudGFyZSBpbCBjb25jZXR0byBkaSBzdGFjay4uLiBcbiAgICAgIFwic3RhY2sucGFuZWxzXCI6IGZ1bmN0aW9uKCl7XG4gICAgICAgIHZhciBjaGlsZHJlbiA9ICQoXCIjZzN3LWZsb2F0YmFycGFuZWwtcGxhY2Vob2xkZXJcIikuY2hpbGRyZW4oKTtcbiAgICAgICAgXy5mb3JFYWNoKGNoaWxkcmVuLGZ1bmN0aW9uKGNoaWxkLGluZGV4KXtcbiAgICAgICAgICBpZiAoaW5kZXggPT0gY2hpbGRyZW4ubGVuZ3RoLTEpe1xuICAgICAgICAgICAgJChjaGlsZCkuc2hvdygpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICQoY2hpbGQpLmhpZGUoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgICB9XG4gICAgfSxcbiAgICBtZXRob2RzOiB7XG4gICAgICBjbG9zZVBhbmVsOiBmdW5jdGlvbigpe1xuICAgICAgICBmbG9hdGJhclNlcnZpY2UuY2xvc2VQYW5lbCgpO1xuICAgICAgfVxuICAgIH1cbn0pO1xuXG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgRmxvYXRiYXJTZXJ2aWNlOiBmbG9hdGJhclNlcnZpY2UsXG4gIEZsb2F0YmFyQ29tcG9uZW50OiBGbG9hdGJhckNvbXBvbmVudFxufVxuIiwiLy9NYWtlIHN1cmUgalF1ZXJ5IGhhcyBiZWVuIGxvYWRlZCBiZWZvcmUgYXBwLmpzXG5pZiAodHlwZW9mIGpRdWVyeSA9PT0gXCJ1bmRlZmluZWRcIikge1xuICB0aHJvdyBuZXcgRXJyb3IoXCJMYXlvdXRNYW5hZ2VyIHJlcXVpcmVzIGpRdWVyeVwiKTtcbn1cblxuJC5MYXlvdXRNYW5hZ2VyID0ge307XG5cbi8qIC0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gKiAtIExheW91dE1hbmFnZXIgT3B0aW9ucyAtXG4gKiAtLS0tLS0tLS0tLS0tLS0tLS0tLVxuICogTW9kaWZ5IHRoZXNlIG9wdGlvbnMgdG8gc3VpdCB5b3VyIGltcGxlbWVudGF0aW9uXG4gKi9cbiQuTGF5b3V0TWFuYWdlci5vcHRpb25zID0ge1xuICAvL0FkZCBzbGltc2Nyb2xsIHRvIG5hdmJhciBtZW51c1xuICAvL1RoaXMgcmVxdWlyZXMgeW91IHRvIGxvYWQgdGhlIHNsaW1zY3JvbGwgcGx1Z2luXG4gIC8vaW4gZXZlcnkgcGFnZSBiZWZvcmUgYXBwLmpzXG4gIG5hdmJhck1lbnVTbGltc2Nyb2xsOiB0cnVlLFxuICBuYXZiYXJNZW51U2xpbXNjcm9sbFdpZHRoOiBcIjBweFwiLCAvL1RoZSB3aWR0aCBvZiB0aGUgc2Nyb2xsIGJhclxuICBuYXZiYXJNZW51SGVpZ2h0OiBcIjIwMHB4XCIsIC8vVGhlIGhlaWdodCBvZiB0aGUgaW5uZXIgbWVudVxuICAvL0dlbmVyYWwgYW5pbWF0aW9uIHNwZWVkIGZvciBKUyBhbmltYXRlZCBlbGVtZW50cyBzdWNoIGFzIGJveCBjb2xsYXBzZS9leHBhbmQgYW5kXG4gIC8vc2lkZWJhciB0cmVldmlldyBzbGlkZSB1cC9kb3duLiBUaGlzIG9wdGlvbnMgYWNjZXB0cyBhbiBpbnRlZ2VyIGFzIG1pbGxpc2Vjb25kcyxcbiAgLy8nZmFzdCcsICdub3JtYWwnLCBvciAnc2xvdydcbiAgYW5pbWF0aW9uU3BlZWQ6J2Zhc3QnLFxuICAvL1NpZGViYXIgcHVzaCBtZW51IHRvZ2dsZSBidXR0b24gc2VsZWN0b3JcbiAgc2lkZWJhclRvZ2dsZVNlbGVjdG9yOiBcIltkYXRhLXRvZ2dsZT0nb2ZmY2FudmFzJ11cIixcbiAgLy9BY3RpdmF0ZSBzaWRlYmFyIHB1c2ggbWVudVxuICBzaWRlYmFyUHVzaE1lbnU6IHRydWUsXG4gIC8vQWN0aXZhdGUgc2lkZWJhciBzbGltc2Nyb2xsIGlmIHRoZSBmaXhlZCBsYXlvdXQgaXMgc2V0IChyZXF1aXJlcyBTbGltU2Nyb2xsIFBsdWdpbilcbiAgc2lkZWJhclNsaW1TY3JvbGw6IHRydWUsXG4gIC8vRW5hYmxlIHNpZGViYXIgZXhwYW5kIG9uIGhvdmVyIGVmZmVjdCBmb3Igc2lkZWJhciBtaW5pXG4gIC8vVGhpcyBvcHRpb24gaXMgZm9yY2VkIHRvIHRydWUgaWYgYm90aCB0aGUgZml4ZWQgbGF5b3V0IGFuZCBzaWRlYmFyIG1pbmlcbiAgLy9hcmUgdXNlZCB0b2dldGhlclxuICBzaWRlYmFyRXhwYW5kT25Ib3ZlcjogZmFsc2UsXG4gIC8vQm94UmVmcmVzaCBQbHVnaW5cbiAgZW5hYmxlQm94UmVmcmVzaDogdHJ1ZSxcbiAgLy9Cb290c3RyYXAuanMgdG9vbHRpcFxuICBlbmFibGVCU1RvcHBsdGlwOiB0cnVlLFxuICBCU1Rvb2x0aXBTZWxlY3RvcjogXCJbZGF0YS10b2dnbGU9J3Rvb2x0aXAnXVwiLFxuICAvL0VuYWJsZSBGYXN0IENsaWNrLiBGYXN0Y2xpY2suanMgY3JlYXRlcyBhIG1vcmVcbiAgLy9uYXRpdmUgdG91Y2ggZXhwZXJpZW5jZSB3aXRoIHRvdWNoIGRldmljZXMuIElmIHlvdVxuICAvL2Nob29zZSB0byBlbmFibGUgdGhlIHBsdWdpbiwgbWFrZSBzdXJlIHlvdSBsb2FkIHRoZSBzY3JpcHRcbiAgLy9iZWZvcmUgTGF5b3V0TWFuYWdlcidzIGFwcC5qc1xuICBlbmFibGVGYXN0Y2xpY2s6IHRydWUsXG4gIC8vQ29udHJvbCBTaWRlYmFyIE9wdGlvbnNcbiAgZW5hYmxlQ29udHJvbFNpZGViYXI6IHRydWUsXG4gIGNvbnRyb2xTaWRlYmFyT3B0aW9uczoge1xuICAgIC8vV2hpY2ggYnV0dG9uIHNob3VsZCB0cmlnZ2VyIHRoZSBvcGVuL2Nsb3NlIGV2ZW50XG4gICAgdG9nZ2xlQnRuU2VsZWN0b3I6IFwiW2RhdGEtdG9nZ2xlPSdjb250cm9sLXNpZGViYXInXVwiLFxuICAgIC8vVGhlIHNpZGViYXIgc2VsZWN0b3JcbiAgICBzZWxlY3RvcjogXCIuY29udHJvbC1zaWRlYmFyXCIsXG4gICAgLy9FbmFibGUgc2xpZGUgb3ZlciBjb250ZW50XG4gICAgc2xpZGU6IHRydWVcbiAgfSxcbiAgLy9Cb3ggV2lkZ2V0IFBsdWdpbi4gRW5hYmxlIHRoaXMgcGx1Z2luXG4gIC8vdG8gYWxsb3cgYm94ZXMgdG8gYmUgY29sbGFwc2VkIGFuZC9vciByZW1vdmVkXG4gIGVuYWJsZUJveFdpZGdldDogdHJ1ZSxcbiAgLy9Cb3ggV2lkZ2V0IHBsdWdpbiBvcHRpb25zXG4gIGJveFdpZGdldE9wdGlvbnM6IHtcbiAgICBib3hXaWRnZXRJY29uczoge1xuICAgICAgLy9Db2xsYXBzZSBpY29uXG4gICAgICBjb2xsYXBzZTogJ2ZhLW1pbnVzJyxcbiAgICAgIC8vT3BlbiBpY29uXG4gICAgICBvcGVuOiAnZmEtcGx1cycsXG4gICAgICAvL1JlbW92ZSBpY29uXG4gICAgICByZW1vdmU6ICdmYS10aW1lcydcbiAgICB9LFxuICAgIGJveFdpZGdldFNlbGVjdG9yczoge1xuICAgICAgLy9SZW1vdmUgYnV0dG9uIHNlbGVjdG9yXG4gICAgICByZW1vdmU6ICdbZGF0YS13aWRnZXQ9XCJyZW1vdmVcIl0nLFxuICAgICAgLy9Db2xsYXBzZSBidXR0b24gc2VsZWN0b3JcbiAgICAgIGNvbGxhcHNlOiAnW2RhdGEtd2lkZ2V0PVwiY29sbGFwc2VcIl0nXG4gICAgfVxuICB9LFxuICAvL0RpcmVjdCBDaGF0IHBsdWdpbiBvcHRpb25zXG4gIGRpcmVjdENoYXQ6IHtcbiAgICAvL0VuYWJsZSBkaXJlY3QgY2hhdCBieSBkZWZhdWx0XG4gICAgZW5hYmxlOiB0cnVlLFxuICAgIC8vVGhlIGJ1dHRvbiB0byBvcGVuIGFuZCBjbG9zZSB0aGUgY2hhdCBjb250YWN0cyBwYW5lXG4gICAgY29udGFjdFRvZ2dsZVNlbGVjdG9yOiAnW2RhdGEtd2lkZ2V0PVwiY2hhdC1wYW5lLXRvZ2dsZVwiXSdcbiAgfSxcbiAgLy9EZWZpbmUgdGhlIHNldCBvZiBjb2xvcnMgdG8gdXNlIGdsb2JhbGx5IGFyb3VuZCB0aGUgd2Vic2l0ZVxuICBjb2xvcnM6IHtcbiAgICBsaWdodEJsdWU6IFwiIzNjOGRiY1wiLFxuICAgIHJlZDogXCIjZjU2OTU0XCIsXG4gICAgZ3JlZW46IFwiIzAwYTY1YVwiLFxuICAgIGFxdWE6IFwiIzAwYzBlZlwiLFxuICAgIHllbGxvdzogXCIjZjM5YzEyXCIsXG4gICAgYmx1ZTogXCIjMDA3M2I3XCIsXG4gICAgbmF2eTogXCIjMDAxRjNGXCIsXG4gICAgdGVhbDogXCIjMzlDQ0NDXCIsXG4gICAgb2xpdmU6IFwiIzNEOTk3MFwiLFxuICAgIGxpbWU6IFwiIzAxRkY3MFwiLFxuICAgIG9yYW5nZTogXCIjRkY4NTFCXCIsXG4gICAgZnVjaHNpYTogXCIjRjAxMkJFXCIsXG4gICAgcHVycGxlOiBcIiM4RTI0QUFcIixcbiAgICBtYXJvb246IFwiI0Q4MUI2MFwiLFxuICAgIGJsYWNrOiBcIiMyMjIyMjJcIixcbiAgICBncmF5OiBcIiNkMmQ2ZGVcIlxuICB9LFxuICAvL1RoZSBzdGFuZGFyZCBzY3JlZW4gc2l6ZXMgdGhhdCBib290c3RyYXAgdXNlcy5cbiAgLy9JZiB5b3UgY2hhbmdlIHRoZXNlIGluIHRoZSB2YXJpYWJsZXMubGVzcyBmaWxlLCBjaGFuZ2VcbiAgLy90aGVtIGhlcmUgdG9vLlxuICBzY3JlZW5TaXplczoge1xuICAgIHhzOiA0ODAsXG4gICAgc206IDc2OCxcbiAgICBtZDogOTkyLFxuICAgIGxnOiAxMjAwXG4gIH1cbn07XG5cblxuLyogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICogLSBJbml0aWFsaXplIHRoZSBMYXlvdXRNYW5hZ2VyIE9iamVjdCAtXG4gKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gKiBBbGwgTGF5b3V0TWFuYWdlciBmdW5jdGlvbnMgYXJlIGltcGxlbWVudGVkIGJlbG93LlxuICovXG4kLkxheW91dE1hbmFnZXIuX2luaXQgPSBmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICAvKiBMYXlvdXRcbiAgICogPT09PT09XG4gICAqIEZpeGVzIHRoZSBsYXlvdXQgaGVpZ2h0IGluIGNhc2UgbWluLWhlaWdodCBmYWlscy5cbiAgICpcbiAgICogQHR5cGUgT2JqZWN0XG4gICAqIEB1c2FnZSAkLkxheW91dE1hbmFnZXIubGF5b3V0LmFjdGl2YXRlKClcbiAgICogICAgICAgICQuTGF5b3V0TWFuYWdlci5sYXlvdXQuZml4KClcbiAgICogICAgICAgICQuTGF5b3V0TWFuYWdlci5sYXlvdXQuZml4U2lkZWJhcigpXG4gICAqL1xuICAkLkxheW91dE1hbmFnZXIubGF5b3V0ID0ge1xuICAgIGFjdGl2YXRlOiBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgX3RoaXMuZml4KCk7XG4gICAgICBfdGhpcy5maXhTaWRlYmFyKCk7XG4gICAgICAkKHdpbmRvdywgXCIud3JhcHBlclwiKS5yZXNpemUoZnVuY3Rpb24gKCkge1xuICAgICAgICBfdGhpcy5maXgoKTtcbiAgICAgICAgX3RoaXMuZml4U2lkZWJhcigpO1xuICAgICAgfSk7XG4gICAgfSxcbiAgICBmaXg6IGZ1bmN0aW9uICgpIHtcbiAgICAgIC8vR2V0IHdpbmRvdyBoZWlnaHQgYW5kIHRoZSB3cmFwcGVyIGhlaWdodFxuICAgICAgdmFyIG5lZyA9ICQoJy5tYWluLWhlYWRlcicpLm91dGVySGVpZ2h0KCkgKyAkKCcubWFpbi1mb290ZXInKS5vdXRlckhlaWdodCgpO1xuICAgICAgdmFyIHdpbmRvd19oZWlnaHQgPSAkKHdpbmRvdykuaGVpZ2h0KCk7XG4gICAgICB2YXIgc2lkZWJhcl9oZWlnaHQgPSAkKFwiLnNpZGViYXJcIikuaGVpZ2h0KCk7XG4gICAgICAvL1NldCB0aGUgbWluLWhlaWdodCBvZiB0aGUgY29udGVudCBhbmQgc2lkZWJhciBiYXNlZCBvbiB0aGVcbiAgICAgIC8vdGhlIGhlaWdodCBvZiB0aGUgZG9jdW1lbnQuXG4gICAgICBpZiAoJChcImJvZHlcIikuaGFzQ2xhc3MoXCJmaXhlZFwiKSkge1xuICAgICAgICAkKFwiLmNvbnRlbnQtd3JhcHBlciwgLnJpZ2h0LXNpZGVcIikuY3NzKCdtaW4taGVpZ2h0Jywgd2luZG93X2hlaWdodCAtICQoJy5tYWluLWZvb3RlcicpLm91dGVySGVpZ2h0KCkpO1xuICAgICAgICAkKFwiLmNvbnRlbnQtd3JhcHBlciwgLnJpZ2h0LXNpZGVcIikuY3NzKCdoZWlnaHQnLCB3aW5kb3dfaGVpZ2h0IC0gJCgnLm1haW4tZm9vdGVyJykub3V0ZXJIZWlnaHQoKSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2YXIgcG9zdFNldFdpZHRoO1xuICAgICAgICBpZiAod2luZG93X2hlaWdodCA+PSBzaWRlYmFyX2hlaWdodCkge1xuICAgICAgICAgICQoXCIuY29udGVudC13cmFwcGVyLCAucmlnaHQtc2lkZVwiKS5jc3MoJ21pbi1oZWlnaHQnLCB3aW5kb3dfaGVpZ2h0IC0gbmVnKTtcbiAgICAgICAgICBwb3N0U2V0V2lkdGggPSB3aW5kb3dfaGVpZ2h0IC0gbmVnO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICQoXCIuY29udGVudC13cmFwcGVyLCAucmlnaHQtc2lkZVwiKS5jc3MoJ21pbi1oZWlnaHQnLCBzaWRlYmFyX2hlaWdodCk7XG4gICAgICAgICAgcG9zdFNldFdpZHRoID0gc2lkZWJhcl9oZWlnaHQ7XG4gICAgICAgIH1cbiAgICAgICAgLy9GaXggZm9yIHRoZSBjb250cm9sIHNpZGViYXIgaGVpZ2h0XG4gICAgICAgIHZhciBjb250cm9sU2lkZWJhciA9ICQoJC5MYXlvdXRNYW5hZ2VyLm9wdGlvbnMuY29udHJvbFNpZGViYXJPcHRpb25zLnNlbGVjdG9yKTtcbiAgICAgICAgaWYgKHR5cGVvZiBjb250cm9sU2lkZWJhciAhPT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgICAgIGlmIChjb250cm9sU2lkZWJhci5oZWlnaHQoKSA+IHBvc3RTZXRXaWR0aClcbiAgICAgICAgICAgICQoXCIuY29udGVudC13cmFwcGVyLCAucmlnaHQtc2lkZVwiKS5jc3MoJ21pbi1oZWlnaHQnLCBjb250cm9sU2lkZWJhci5oZWlnaHQoKSk7XG4gICAgICAgIH1cblxuICAgICAgfVxuICAgIH0sXG4gICAgZml4U2lkZWJhcjogZnVuY3Rpb24gKCkge1xuICAgICAgLy9NYWtlIHN1cmUgdGhlIGJvZHkgdGFnIGhhcyB0aGUgLmZpeGVkIGNsYXNzXG4gICAgICBpZiAoISQoXCJib2R5XCIpLmhhc0NsYXNzKFwiZml4ZWRcIikpIHtcbiAgICAgICAgaWYgKHR5cGVvZiAkLmZuLnNsaW1TY3JvbGwgIT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAkKFwiLnNpZGViYXJcIikuc2xpbVNjcm9sbCh7ZGVzdHJveTogdHJ1ZX0pLmhlaWdodChcImF1dG9cIik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuO1xuICAgICAgfSBlbHNlIGlmICh0eXBlb2YgJC5mbi5zbGltU2Nyb2xsID09ICd1bmRlZmluZWQnICYmIHdpbmRvdy5jb25zb2xlKSB7XG4gICAgICAgIHdpbmRvdy5jb25zb2xlLmVycm9yKFwiRXJyb3I6IHRoZSBmaXhlZCBsYXlvdXQgcmVxdWlyZXMgdGhlIHNsaW1zY3JvbGwgcGx1Z2luIVwiKTtcbiAgICAgIH1cbiAgICAgIC8vRW5hYmxlIHNsaW1zY3JvbGwgZm9yIGZpeGVkIGxheW91dFxuICAgICAgaWYgKCQuTGF5b3V0TWFuYWdlci5vcHRpb25zLnNpZGViYXJTbGltU2Nyb2xsKSB7XG4gICAgICAgIGlmICh0eXBlb2YgJC5mbi5zbGltU2Nyb2xsICE9ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgLy9EZXN0cm95IGlmIGl0IGV4aXN0c1xuICAgICAgICAgICQoXCIuc2lkZWJhclwiKS5zbGltU2Nyb2xsKHtkZXN0cm95OiB0cnVlfSkuaGVpZ2h0KFwiYXV0b1wiKTtcbiAgICAgICAgICAvL0FkZCBzbGltc2Nyb2xsXG4gICAgICAgICAgJChcIi5zaWRlYmFyXCIpLnNsaW1zY3JvbGwoe1xuICAgICAgICAgICAgaGVpZ2h0OiAoJCh3aW5kb3cpLmhlaWdodCgpIC0gJChcIi5tYWluLWhlYWRlclwiKS5oZWlnaHQoKSkgKyBcInB4XCIsXG4gICAgICAgICAgICBjb2xvcjogXCJyZ2JhKDI1NSwyNTUsMjU1LDAuNylcIixcbiAgICAgICAgICAgIHNpemU6IFwiM3B4XCJcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgICAkKFwiLnNpZGViYXJcIikuY3NzKHsnaGVpZ2h0JzogKCQod2luZG93KS5oZWlnaHQoKSAtICQoXCIubWFpbi1oZWFkZXJcIikuaGVpZ2h0KCkpICsgXCJweFwifSlcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLyokKFwiLnNpZGViYXIgbGkgYVwiKS5lYWNoKGZ1bmN0aW9uKCl7XG4gICAgICAgIHZhciAkdGhpcyA9ICQodGhpcyk7XG4gICAgICAgIHZhciBjaGVja0VsZW1lbnQgPSAkdGhpcy5uZXh0KCk7XG4gICAgICAgIGlmICgoY2hlY2tFbGVtZW50LmlzKCcudHJlZXZpZXctbWVudScpKSAmJiAoIWNoZWNrRWxlbWVudC5pcygnOnZpc2libGUnKSkpIHtcbiAgICAgICAgICAvL0dldCB0aGUgcGFyZW50IG1lbnVcbiAgICAgICAgICB2YXIgcGFyZW50ID0gJHRoaXMucGFyZW50cygndWwnKS5maXJzdCgpO1xuICAgICAgICAgIHZhciBwYXJlbnRfbGkgPSAkdGhpcy5wYXJlbnQoXCJsaVwiKTtcbiAgICAgICAgICB2YXIgbGlfc2libGluZ3MgPSBwYXJlbnRfbGkuc2libGluZ3MoKTtcbiAgICAgICAgICB2YXIgcGFyZW50X2ZpbmRfYWN0aXZlO1xuICAgICAgICAgIHZhciBzaWRlYmFyX2NvbnRlbnRfaGVpZ2h0ID0gcGFyZW50LmhlaWdodCgpIC0gcGFyZW50LmZpbmQoJ2xpLmhlYWRlcicpLm91dGVySGVpZ2h0KCk7XG4gICAgICAgICAgdmFyIHRyZWV2aWV3SGVpZ2h0ID0gcGFyZW50X2xpLm91dGVySGVpZ2h0KCk7XG4gICAgICAgICAgbGlfc2libGluZ3Mubm90KCcuaGVhZGVyJykuZWFjaChmdW5jdGlvbihpbmRleCwgZWwpIHtcbiAgICAgICAgICAgICAgICAgIHRyZWV2aWV3SGVpZ2h0Kz0kKGVsKS5maW5kKCdhJykub3V0ZXJIZWlnaHQoKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgICB2YXIgc2VjdGlvbl9oZWlnaHQgPSAoc2lkZWJhcl9jb250ZW50X2hlaWdodCAtIHRyZWV2aWV3SGVpZ2h0KTtcbiAgICAgICAgICBjaGVja0VsZW1lbnQuY3NzKHtcbiAgICAgICAgICAgICdoZWlnaHQnOiBzZWN0aW9uX2hlaWdodCArICdweCcsXG4gICAgICAgICAgICAnbWF4LWhlaWdodCc6c2VjdGlvbl9oZWlnaHQgKyAncHgnLFxuICAgICAgICAgICAgJ292ZXJmbG93LXknOiAnYXV0bydcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSk7Ki9cbiAgICAgIFxuICAgIH1cbiAgICBcbiAgfTtcblxuICAvKiBQdXNoTWVudSgpXG4gICAqID09PT09PT09PT1cbiAgICogQWRkcyB0aGUgcHVzaCBtZW51IGZ1bmN0aW9uYWxpdHkgdG8gdGhlIHNpZGViYXIuXG4gICAqXG4gICAqIEB0eXBlIEZ1bmN0aW9uXG4gICAqIEB1c2FnZTogJC5MYXlvdXRNYW5hZ2VyLnB1c2hNZW51KFwiW2RhdGEtdG9nZ2xlPSdvZmZjYW52YXMnXVwiKVxuICAgKi9cbiAgJC5MYXlvdXRNYW5hZ2VyLnB1c2hNZW51ID0ge1xuICAgIGFjdGl2YXRlOiBmdW5jdGlvbiAodG9nZ2xlQnRuKSB7XG4gICAgICAvL0dldCB0aGUgc2NyZWVuIHNpemVzXG4gICAgICB2YXIgc2NyZWVuU2l6ZXMgPSAkLkxheW91dE1hbmFnZXIub3B0aW9ucy5zY3JlZW5TaXplcztcblxuICAgICAgLy9FbmFibGUgc2lkZWJhciB0b2dnbGVcbiAgICAgICQodG9nZ2xlQnRuKS5vbignY2xpY2snLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgLy9FbmFibGUgc2lkZWJhciBwdXNoIG1lbnVcbiAgICAgICAgaWYgKCQod2luZG93KS53aWR0aCgpID4gKHNjcmVlblNpemVzLnNtIC0gMSkpIHtcbiAgICAgICAgICBpZiAoJChcImJvZHlcIikuaGFzQ2xhc3MoJ3NpZGViYXItY29sbGFwc2UnKSkge1xuICAgICAgICAgICAgJChcImJvZHlcIikucmVtb3ZlQ2xhc3MoJ3NpZGViYXItY29sbGFwc2UnKS50cmlnZ2VyKCdleHBhbmRlZC5wdXNoTWVudScpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAkKFwiYm9keVwiKS5hZGRDbGFzcygnc2lkZWJhci1jb2xsYXBzZScpLnRyaWdnZXIoJ2NvbGxhcHNlZC5wdXNoTWVudScpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvL0hhbmRsZSBzaWRlYmFyIHB1c2ggbWVudSBmb3Igc21hbGwgc2NyZWVuc1xuICAgICAgICBlbHNlIHtcbiAgICAgICAgICBpZiAoJChcImJvZHlcIikuaGFzQ2xhc3MoJ3NpZGViYXItb3BlbicpKSB7XG4gICAgICAgICAgICAkKFwiYm9keVwiKS5yZW1vdmVDbGFzcygnc2lkZWJhci1vcGVuJykucmVtb3ZlQ2xhc3MoJ3NpZGViYXItY29sbGFwc2UnKS50cmlnZ2VyKCdjb2xsYXBzZWQucHVzaE1lbnUnKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgJChcImJvZHlcIikuYWRkQ2xhc3MoJ3NpZGViYXItb3BlbicpLnRyaWdnZXIoJ2V4cGFuZGVkLnB1c2hNZW51Jyk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgICAgJChcIi5jb250ZW50LXdyYXBwZXJcIikuY2xpY2soZnVuY3Rpb24gKCkge1xuICAgICAgICAvL0VuYWJsZSBoaWRlIG1lbnUgd2hlbiBjbGlja2luZyBvbiB0aGUgY29udGVudC13cmFwcGVyIG9uIHNtYWxsIHNjcmVlbnNcbiAgICAgICAgaWYgKCQod2luZG93KS53aWR0aCgpIDw9IChzY3JlZW5TaXplcy5zbSAtIDEpICYmICQoXCJib2R5XCIpLmhhc0NsYXNzKFwic2lkZWJhci1vcGVuXCIpKSB7XG4gICAgICAgICAgJChcImJvZHlcIikucmVtb3ZlQ2xhc3MoJ3NpZGViYXItb3BlbicpO1xuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgICAgLy9FbmFibGUgZXhwYW5kIG9uIGhvdmVyIGZvciBzaWRlYmFyIG1pbmlcbiAgICAgIGlmICgkLkxheW91dE1hbmFnZXIub3B0aW9ucy5zaWRlYmFyRXhwYW5kT25Ib3ZlciB8fCAoJCgnYm9keScpLmhhc0NsYXNzKCdmaXhlZCcpICYmICQoJ2JvZHknKS5oYXNDbGFzcygnc2lkZWJhci1taW5pJykpKSB7XG4gICAgICAgIHRoaXMuZXhwYW5kT25Ib3ZlcigpO1xuICAgICAgfVxuICAgIH0sXG4gICAgZXhwYW5kT25Ib3ZlcjogZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgIHZhciBzY3JlZW5XaWR0aCA9ICQuTGF5b3V0TWFuYWdlci5vcHRpb25zLnNjcmVlblNpemVzLnNtIC0gMTtcbiAgICAgIC8vRXhwYW5kIHNpZGViYXIgb24gaG92ZXJcbiAgICAgICQoJy5tYWluLXNpZGViYXInKS5ob3ZlcihmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICgkKCdib2R5JykuaGFzQ2xhc3MoJ3NpZGViYXItbWluaScpICYmICQoXCJib2R5XCIpLmhhc0NsYXNzKCdzaWRlYmFyLWNvbGxhcHNlJykgJiYgJCh3aW5kb3cpLndpZHRoKCkgPiBzY3JlZW5XaWR0aCkge1xuICAgICAgICAgIF90aGlzLmV4cGFuZCgpO1xuICAgICAgICB9XG4gICAgICB9LCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICgkKCdib2R5JykuaGFzQ2xhc3MoJ3NpZGViYXItbWluaScpICYmICQoJ2JvZHknKS5oYXNDbGFzcygnc2lkZWJhci1leHBhbmRlZC1vbi1ob3ZlcicpICYmICQod2luZG93KS53aWR0aCgpID4gc2NyZWVuV2lkdGgpIHtcbiAgICAgICAgICBfdGhpcy5jb2xsYXBzZSgpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9LFxuICAgIGV4cGFuZDogZnVuY3Rpb24gKCkge1xuICAgICAgJChcImJvZHlcIikucmVtb3ZlQ2xhc3MoJ3NpZGViYXItY29sbGFwc2UnKS5hZGRDbGFzcygnc2lkZWJhci1leHBhbmRlZC1vbi1ob3ZlcicpO1xuICAgIH0sXG4gICAgY29sbGFwc2U6IGZ1bmN0aW9uICgpIHtcbiAgICAgIGlmICgkKCdib2R5JykuaGFzQ2xhc3MoJ3NpZGViYXItZXhwYW5kZWQtb24taG92ZXInKSkge1xuICAgICAgICAkKCdib2R5JykucmVtb3ZlQ2xhc3MoJ3NpZGViYXItZXhwYW5kZWQtb24taG92ZXInKS5hZGRDbGFzcygnc2lkZWJhci1jb2xsYXBzZScpO1xuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICAvKiBUcmVlKClcbiAgICogPT09PT09XG4gICAqIENvbnZlcnRzIHRoZSBzaWRlYmFyIGludG8gYSBtdWx0aWxldmVsXG4gICAqIHRyZWUgdmlldyBtZW51LlxuICAgKlxuICAgKiBAdHlwZSBGdW5jdGlvblxuICAgKiBAVXNhZ2U6ICQuTGF5b3V0TWFuYWdlci50cmVlKCcuc2lkZWJhcicpXG4gICAqL1xuICAkLkxheW91dE1hbmFnZXIudHJlZSA9IGZ1bmN0aW9uIChtZW51KSB7XG4gICAgdmFyIF90aGlzID0gdGhpcztcbiAgICB2YXIgYW5pbWF0aW9uU3BlZWQgPSAkLkxheW91dE1hbmFnZXIub3B0aW9ucy5hbmltYXRpb25TcGVlZDtcbiAgICAvL2NsaWNrIGV2ZW50IC8vXG4gICAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgbWVudSArICcgbGkgYScsIGZ1bmN0aW9uIChlKSB7XG5cbiAgICAgIC8vR2V0IHRoZSBjbGlja2VkIGxpbmsgYW5kIHRoZSBuZXh0IGVsZW1lbnRcbiAgICAgIHZhciAkdGhpcyA9ICQodGhpcyk7XG4gICAgICAvL2lzIHRoZSBjb250ZW50IG9mIHRoZSBcImFjY29yZGlvblwiIHVsIC8vXG4gICAgICB2YXIgY2hlY2tFbGVtZW50ID0gJHRoaXMubmV4dCgpO1xuXG4gICAgICAvL0NoZWNrIGlmIHRoZSBuZXh0IGVsZW1lbnQgaXMgYSBtZW51IGFuZCBpcyB2aXNpYmxlXG4gICAgICBpZiAoKGNoZWNrRWxlbWVudC5pcygnLnRyZWV2aWV3LW1lbnUnKSkgJiYgKGNoZWNrRWxlbWVudC5pcygnOnZpc2libGUnKSkpIHtcbiAgICAgICAgLy9DbG9zZSB0aGUgbWVudVxuICAgICAgICBjaGVja0VsZW1lbnQuc2xpZGVVcChhbmltYXRpb25TcGVlZCwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGNoZWNrRWxlbWVudC5wYXJlbnQoXCJsaS50cmVldmlld1wiKS5yZW1vdmVDbGFzcyhcImFjdGl2ZVwiKTtcbiAgICAgICAgICBjaGVja0VsZW1lbnQucmVtb3ZlQ2xhc3MoJ21lbnUtb3BlbicpO1xuICAgICAgICAgIC8vRml4IHRoZSBsYXlvdXQgaW4gY2FzZSB0aGUgc2lkZWJhciBzdHJldGNoZXMgb3ZlciB0aGUgaGVpZ2h0IG9mIHRoZSB3aW5kb3dcbiAgICAgICAgICAvL190aGlzLmxheW91dC5maXgoKTtcbiAgICAgICAgfSk7XG5cbiAgICAgIH1cbiAgICAgIC8vSWYgdGhlIG1lbnUgaXMgbm90IHZpc2libGVcbiAgICAgIGVsc2UgaWYgKChjaGVja0VsZW1lbnQuaXMoJy50cmVldmlldy1tZW51JykpICYmICghY2hlY2tFbGVtZW50LmlzKCc6dmlzaWJsZScpKSkge1xuICAgICAgICAvL0dldCB0aGUgcGFyZW50IG1lbnVcbiAgICAgICAgdmFyIHBhcmVudCA9ICR0aGlzLnBhcmVudHMoJ3VsJykuZmlyc3QoKTtcbiAgICAgICAgdmFyIHBhcmVudF9saSA9ICR0aGlzLnBhcmVudChcImxpXCIpO1xuICAgICAgICB2YXIgbGlfc2libGluZ3MgPSBwYXJlbnRfbGkuc2libGluZ3MoKTtcbiAgICAgICAgdmFyIHBhcmVudF9maW5kX2FjdGl2ZTtcbiAgICAgICAgdmFyIHNpZGViYXJfY29udGVudF9oZWlnaHQgPSBwYXJlbnQuaGVpZ2h0KCkgLSBwYXJlbnQuZmluZCgnbGkuaGVhZGVyJykub3V0ZXJIZWlnaHQoKTtcbiAgICAgICAgdmFyIHRyZWV2aWV3SGVpZ2h0ID0gcGFyZW50X2xpLm91dGVySGVpZ2h0KCk7XG4gICAgICAgIGxpX3NpYmxpbmdzLm5vdCgnLmhlYWRlcicpLmVhY2goZnVuY3Rpb24oaW5kZXgsIGVsKSB7XG4gICAgICAgICAgICAgICAgdHJlZXZpZXdIZWlnaHQrPSQoZWwpLmZpbmQoJ2EnKS5vdXRlckhlaWdodCgpO1xuICAgICAgICB9KTtcbiAgICAgICAgdmFyIHNlY3Rpb25faGVpZ2h0ID0gKHNpZGViYXJfY29udGVudF9oZWlnaHQgLSB0cmVldmlld0hlaWdodCk7XG4gICAgICAgIC8qY2hlY2tFbGVtZW50LmNzcyh7XG4gICAgICAgICAgJ2hlaWdodCc6IHNlY3Rpb25faGVpZ2h0ICsgJ3B4JyxcbiAgICAgICAgICAnbWF4LWhlaWdodCc6c2VjdGlvbl9oZWlnaHQgKyAncHgnLFxuICAgICAgICAgIC8vJ292ZXJmbG93LXknOiAnYXV0bydcbiAgICAgICAgfSk7Ki9cbiAgICAgICAgLy9DbG9zZSBhbGwgb3BlbiBtZW51cyB3aXRoaW4gdGhlIHBhcmVudFxuICAgICAgICB2YXIgdWwgPSBwYXJlbnQuZmluZCgndWwudHJlZXZpZXctbWVudTp2aXNpYmxlJykuc2xpZGVVcChhbmltYXRpb25TcGVlZCk7XG4gICAgICAgIC8vUmVtb3ZlIHRoZSBtZW51LW9wZW4gY2xhc3MgZnJvbSB0aGUgcGFyZW50XG4gICAgICAgIHVsLnJlbW92ZUNsYXNzKCdtZW51LW9wZW4nKTtcbiAgICAgICAgLy9HZXQgdGhlIHBhcmVudCBsaVxuICAgICAgICAvL09wZW4gdGhlIHRhcmdldCBtZW51IGFuZCBhZGQgdGhlIG1lbnUtb3BlbiBjbGFzc1xuICAgICAgICBjaGVja0VsZW1lbnQuc2xpZGVEb3duKGFuaW1hdGlvblNwZWVkLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgLy9BZGQgdGhlIGNsYXNzIGFjdGl2ZSB0byB0aGUgcGFyZW50IGxpXG4gICAgICAgICAgY2hlY2tFbGVtZW50LmFkZENsYXNzKCdtZW51LW9wZW4nKTtcbiAgICAgICAgICBwYXJlbnRfZmluZF9hY3RpdmUgPSBwYXJlbnQuZmluZCgnbGkudHJlZXZpZXcuYWN0aXZlJyk7XG4gICAgICAgICAgcGFyZW50X2ZpbmRfYWN0aXZlLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTtcbiAgICAgICAgICBwYXJlbnRfbGkuYWRkQ2xhc3MoJ2FjdGl2ZScpO1xuICAgICAgICAgIC8vRml4IHRoZSBsYXlvdXQgaW4gY2FzZSB0aGUgc2lkZWJhciBzdHJldGNoZXMgb3ZlciB0aGUgaGVpZ2h0IG9mIHRoZSB3aW5kb3dcbiAgICAgICAgICBfdGhpcy5sYXlvdXQuZml4KCk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgLy9pZiB0aGlzIGlzbid0IGEgbGluaywgcHJldmVudCB0aGUgcGFnZSBmcm9tIGJlaW5nIHJlZGlyZWN0ZWRcbiAgICAgIGlmIChjaGVja0VsZW1lbnQuaXMoJy50cmVldmlldy1tZW51JykpIHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgfVxuICAgICAgXG4gICAgICAvLyQuTGF5b3V0TWFuYWdlci5sYXlvdXQuZml4KCk7XG4gICAgICAvLyQuTGF5b3V0TWFuYWdlci5sYXlvdXQuZml4U2lkZWJhcigpO1xuICAgIH0pO1xuICB9O1xuXG4gIC8qIENvbnRyb2xTaWRlYmFyXG4gICAqID09PT09PT09PT09PT09XG4gICAqIEFkZHMgZnVuY3Rpb25hbGl0eSB0byB0aGUgcmlnaHQgc2lkZWJhclxuICAgKlxuICAgKiBAdHlwZSBPYmplY3RcbiAgICogQHVzYWdlICQuTGF5b3V0TWFuYWdlci5jb250cm9sU2lkZWJhci5hY3RpdmF0ZShvcHRpb25zKVxuICAgKi9cbiAgJC5MYXlvdXRNYW5hZ2VyLmZsb2F0QmFyID0gJC5MYXlvdXRNYW5hZ2VyLmNvbnRyb2xTaWRlYmFyID0ge1xuICAgIC8vaW5zdGFudGlhdGUgdGhlIG9iamVjdFxuICAgIGFjdGl2YXRlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAvL0dldCB0aGUgb2JqZWN0XG4gICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgLy9VcGRhdGUgb3B0aW9uc1xuICAgICAgdmFyIG8gPSAkLkxheW91dE1hbmFnZXIub3B0aW9ucy5jb250cm9sU2lkZWJhck9wdGlvbnM7XG4gICAgICAvL0dldCB0aGUgc2lkZWJhclxuICAgICAgdmFyIHNpZGViYXIgPSAkKG8uc2VsZWN0b3IpO1xuICAgICAgLy9UaGUgdG9nZ2xlIGJ1dHRvblxuICAgICAgdmFyIGJ0biA9ICQoby50b2dnbGVCdG5TZWxlY3Rvcik7XG5cbiAgICAgIC8vTGlzdGVuIHRvIHRoZSBjbGljayBldmVudFxuICAgICAgYnRuLm9uKCdjbGljaycsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgLy9JZiB0aGUgc2lkZWJhciBpcyBub3Qgb3BlblxuICAgICAgICBpZiAoIXNpZGViYXIuaGFzQ2xhc3MoJ2NvbnRyb2wtc2lkZWJhci1vcGVuJykgJiYgISQoJ2JvZHknKS5oYXNDbGFzcygnY29udHJvbC1zaWRlYmFyLW9wZW4nKSkge1xuICAgICAgICAgIC8vT3BlbiB0aGUgc2lkZWJhclxuICAgICAgICAgIF90aGlzLm9wZW4oc2lkZWJhciwgby5zbGlkZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgX3RoaXMuY2xvc2Uoc2lkZWJhciwgby5zbGlkZSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICAvL0lmIHRoZSBib2R5IGhhcyBhIGJveGVkIGxheW91dCwgZml4IHRoZSBzaWRlYmFyIGJnIHBvc2l0aW9uXG4gICAgICB2YXIgYmcgPSAkKFwiLmNvbnRyb2wtc2lkZWJhci1iZ1wiKTtcbiAgICAgIF90aGlzLl9maXgoYmcpO1xuXG4gICAgICAvL0lmIHRoZSBib2R5IGhhcyBhIGZpeGVkIGxheW91dCwgbWFrZSB0aGUgY29udHJvbCBzaWRlYmFyIGZpeGVkXG4gICAgICBpZiAoJCgnYm9keScpLmhhc0NsYXNzKCdmaXhlZCcpKSB7XG4gICAgICAgIF90aGlzLl9maXhGb3JGaXhlZChzaWRlYmFyKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vSWYgdGhlIGNvbnRlbnQgaGVpZ2h0IGlzIGxlc3MgdGhhbiB0aGUgc2lkZWJhcidzIGhlaWdodCwgZm9yY2UgbWF4IGhlaWdodFxuICAgICAgICBpZiAoJCgnLmNvbnRlbnQtd3JhcHBlciwgLnJpZ2h0LXNpZGUnKS5oZWlnaHQoKSA8IHNpZGViYXIuaGVpZ2h0KCkpIHtcbiAgICAgICAgICBfdGhpcy5fZml4Rm9yQ29udGVudChzaWRlYmFyKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0sXG4gICAgLy9PcGVuIHRoZSBjb250cm9sIHNpZGViYXJcbiAgICBvcGVuOiBmdW5jdGlvbiAoc2lkZWJhciwgc2xpZGUpIHtcbiAgICAgIC8vU2xpZGUgb3ZlciBjb250ZW50XG4gICAgICBpZiAoc2xpZGUpIHtcbiAgICAgICAgc2lkZWJhci5hZGRDbGFzcygnY29udHJvbC1zaWRlYmFyLW9wZW4nKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vUHVzaCB0aGUgY29udGVudCBieSBhZGRpbmcgdGhlIG9wZW4gY2xhc3MgdG8gdGhlIGJvZHkgaW5zdGVhZFxuICAgICAgICAvL29mIHRoZSBzaWRlYmFyIGl0c2VsZlxuICAgICAgICAkKCdib2R5JykuYWRkQ2xhc3MoJ2NvbnRyb2wtc2lkZWJhci1vcGVuJyk7XG4gICAgICB9XG4gICAgfSxcbiAgICAvL0Nsb3NlIHRoZSBjb250cm9sIHNpZGViYXJcbiAgICBjbG9zZTogZnVuY3Rpb24gKHNpZGViYXIsIHNsaWRlKSB7XG4gICAgICBpZiAoc2xpZGUpIHtcbiAgICAgICAgc2lkZWJhci5yZW1vdmVDbGFzcygnY29udHJvbC1zaWRlYmFyLW9wZW4nKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgICQoJ2JvZHknKS5yZW1vdmVDbGFzcygnY29udHJvbC1zaWRlYmFyLW9wZW4nKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIF9maXg6IGZ1bmN0aW9uIChzaWRlYmFyKSB7XG4gICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgaWYgKCQoXCJib2R5XCIpLmhhc0NsYXNzKCdsYXlvdXQtYm94ZWQnKSkge1xuICAgICAgICBzaWRlYmFyLmNzcygncG9zaXRpb24nLCAnYWJzb2x1dGUnKTtcbiAgICAgICAgc2lkZWJhci5oZWlnaHQoJChcIi53cmFwcGVyXCIpLmhlaWdodCgpKTtcbiAgICAgICAgJCh3aW5kb3cpLnJlc2l6ZShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgX3RoaXMuX2ZpeChzaWRlYmFyKTtcbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBzaWRlYmFyLmNzcyh7XG4gICAgICAgICAgJ3Bvc2l0aW9uJzogJ2ZpeGVkJyxcbiAgICAgICAgICAnaGVpZ2h0JzogJ2F1dG8nXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0sXG4gICAgX2ZpeEZvckZpeGVkOiBmdW5jdGlvbiAoc2lkZWJhcikge1xuICAgICAgc2lkZWJhci5jc3Moe1xuICAgICAgICAncG9zaXRpb24nOiAnZml4ZWQnLFxuICAgICAgICAnbWF4LWhlaWdodCc6ICcxMDAlJyxcbiAgICAgICAgJ292ZXJmbG93JzogJ2F1dG8nLFxuICAgICAgICAncGFkZGluZy1ib3R0b20nOiAnNTBweCdcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgX2ZpeEZvckNvbnRlbnQ6IGZ1bmN0aW9uIChzaWRlYmFyKSB7XG4gICAgICAkKFwiLmNvbnRlbnQtd3JhcHBlciwgLnJpZ2h0LXNpZGVcIikuY3NzKCdtaW4taGVpZ2h0Jywgc2lkZWJhci5oZWlnaHQoKSk7XG4gICAgfVxuICB9O1xuXG4gIC8qIEJveFdpZGdldFxuICAgKiA9PT09PT09PT1cbiAgICogQm94V2lkZ2V0IGlzIGEgcGx1Z2luIHRvIGhhbmRsZSBjb2xsYXBzaW5nIGFuZFxuICAgKiByZW1vdmluZyBib3hlcyBmcm9tIHRoZSBzY3JlZW4uXG4gICAqXG4gICAqIEB0eXBlIE9iamVjdFxuICAgKiBAdXNhZ2UgJC5MYXlvdXRNYW5hZ2VyLmJveFdpZGdldC5hY3RpdmF0ZSgpXG4gICAqICAgICAgICBTZXQgYWxsIHlvdXIgb3B0aW9ucyBpbiB0aGUgbWFpbiAkLkxheW91dE1hbmFnZXIub3B0aW9ucyBvYmplY3RcbiAgICovXG4gICQuTGF5b3V0TWFuYWdlci5ib3hXaWRnZXQgPSB7XG4gICAgc2VsZWN0b3JzOiAkLkxheW91dE1hbmFnZXIub3B0aW9ucy5ib3hXaWRnZXRPcHRpb25zLmJveFdpZGdldFNlbGVjdG9ycyxcbiAgICBpY29uczogJC5MYXlvdXRNYW5hZ2VyLm9wdGlvbnMuYm94V2lkZ2V0T3B0aW9ucy5ib3hXaWRnZXRJY29ucyxcbiAgICBhbmltYXRpb25TcGVlZDogJC5MYXlvdXRNYW5hZ2VyLm9wdGlvbnMuYW5pbWF0aW9uU3BlZWQsXG4gICAgYWN0aXZhdGU6IGZ1bmN0aW9uIChfYm94KSB7XG4gICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgaWYgKCFfYm94KSB7XG4gICAgICAgIF9ib3ggPSBkb2N1bWVudDsgLy8gYWN0aXZhdGUgYWxsIGJveGVzIHBlciBkZWZhdWx0XG4gICAgICB9XG4gICAgICAvL0xpc3RlbiBmb3IgY29sbGFwc2UgZXZlbnQgdHJpZ2dlcnNcbiAgICAgICQoX2JveCkub24oJ2NsaWNrJywgX3RoaXMuc2VsZWN0b3JzLmNvbGxhcHNlLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIF90aGlzLmNvbGxhcHNlKCQodGhpcykpO1xuICAgICAgfSk7XG5cbiAgICAgIC8vTGlzdGVuIGZvciByZW1vdmUgZXZlbnQgdHJpZ2dlcnNcbiAgICAgICQoX2JveCkub24oJ2NsaWNrJywgX3RoaXMuc2VsZWN0b3JzLnJlbW92ZSwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBfdGhpcy5yZW1vdmUoJCh0aGlzKSk7XG4gICAgICB9KTtcbiAgICB9LFxuICAgIGNvbGxhcHNlOiBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgIC8vRmluZCB0aGUgYm94IHBhcmVudFxuICAgICAgdmFyIGJveCA9IGVsZW1lbnQucGFyZW50cyhcIi5ib3hcIikuZmlyc3QoKTtcbiAgICAgIC8vRmluZCB0aGUgYm9keSBhbmQgdGhlIGZvb3RlclxuICAgICAgdmFyIGJveF9jb250ZW50ID0gYm94LmZpbmQoXCI+IC5ib3gtYm9keSwgPiAuYm94LWZvb3RlciwgPiBmb3JtICA+LmJveC1ib2R5LCA+IGZvcm0gPiAuYm94LWZvb3RlclwiKTtcbiAgICAgIGlmICghYm94Lmhhc0NsYXNzKFwiY29sbGFwc2VkLWJveFwiKSkge1xuICAgICAgICAvL0NvbnZlcnQgbWludXMgaW50byBwbHVzXG4gICAgICAgIGVsZW1lbnQuY2hpbGRyZW4oXCI6Zmlyc3RcIilcbiAgICAgICAgICAgICAgICAucmVtb3ZlQ2xhc3MoX3RoaXMuaWNvbnMuY29sbGFwc2UpXG4gICAgICAgICAgICAgICAgLmFkZENsYXNzKF90aGlzLmljb25zLm9wZW4pO1xuICAgICAgICAvL0hpZGUgdGhlIGNvbnRlbnRcbiAgICAgICAgYm94X2NvbnRlbnQuc2xpZGVVcChfdGhpcy5hbmltYXRpb25TcGVlZCwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGJveC5hZGRDbGFzcyhcImNvbGxhcHNlZC1ib3hcIik7XG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy9Db252ZXJ0IHBsdXMgaW50byBtaW51c1xuICAgICAgICBlbGVtZW50LmNoaWxkcmVuKFwiOmZpcnN0XCIpXG4gICAgICAgICAgICAgICAgLnJlbW92ZUNsYXNzKF90aGlzLmljb25zLm9wZW4pXG4gICAgICAgICAgICAgICAgLmFkZENsYXNzKF90aGlzLmljb25zLmNvbGxhcHNlKTtcbiAgICAgICAgLy9TaG93IHRoZSBjb250ZW50XG4gICAgICAgIGJveF9jb250ZW50LnNsaWRlRG93bihfdGhpcy5hbmltYXRpb25TcGVlZCwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGJveC5yZW1vdmVDbGFzcyhcImNvbGxhcHNlZC1ib3hcIik7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0sXG4gICAgcmVtb3ZlOiBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgLy9GaW5kIHRoZSBib3ggcGFyZW50XG4gICAgICB2YXIgYm94ID0gZWxlbWVudC5wYXJlbnRzKFwiLmJveFwiKS5maXJzdCgpO1xuICAgICAgYm94LnNsaWRlVXAodGhpcy5hbmltYXRpb25TcGVlZCk7XG4gICAgfVxuICB9O1xuICBcbiAgcmV0dXJuICQuTGF5b3V0TWFuYWdlcjtcbn07XG5cbi8qIC0tLS0tLS0tLS0tLS0tLS0tLVxuICogLSBDdXN0b20gUGx1Z2lucyAtXG4gKiAtLS0tLS0tLS0tLS0tLS0tLS1cbiAqIEFsbCBjdXN0b20gcGx1Z2lucyBhcmUgZGVmaW5lZCBiZWxvdy5cbiAqL1xuXG4vKlxuICogQk9YIFJFRlJFU0ggQlVUVE9OXG4gKiAtLS0tLS0tLS0tLS0tLS0tLS1cbiAqIFRoaXMgaXMgYSBjdXN0b20gcGx1Z2luIHRvIHVzZSB3aXRoIHRoZSBjb21wb25lbnQgQk9YLiBJdCBhbGxvd3MgeW91IHRvIGFkZFxuICogYSByZWZyZXNoIGJ1dHRvbiB0byB0aGUgYm94LiBJdCBjb252ZXJ0cyB0aGUgYm94J3Mgc3RhdGUgdG8gYSBsb2FkaW5nIHN0YXRlLlxuICpcbiAqIEB0eXBlIHBsdWdpblxuICogQHVzYWdlICQoXCIjYm94LXdpZGdldFwiKS5ib3hSZWZyZXNoKCBvcHRpb25zICk7XG4gKi9cbiQuTGF5b3V0TWFuYWdlci5hZGRSZWZyZXNoQnV0dG9uID0gZnVuY3Rpb24gKCkge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICAkLmZuLmJveFJlZnJlc2ggPSBmdW5jdGlvbiAob3B0aW9ucykge1xuXG4gICAgLy8gUmVuZGVyIG9wdGlvbnNcbiAgICB2YXIgc2V0dGluZ3MgPSAkLmV4dGVuZCh7XG4gICAgICAvL1JlZnJlc2ggYnV0dG9uIHNlbGVjdG9yXG4gICAgICB0cmlnZ2VyOiBcIi5yZWZyZXNoLWJ0blwiLFxuICAgICAgLy9GaWxlIHNvdXJjZSB0byBiZSBsb2FkZWQgKGUuZzogYWpheC9zcmMucGhwKVxuICAgICAgc291cmNlOiBcIlwiLFxuICAgICAgLy9DYWxsYmFja3NcbiAgICAgIG9uTG9hZFN0YXJ0OiBmdW5jdGlvbiAoYm94KSB7XG4gICAgICAgIHJldHVybiBib3g7XG4gICAgICB9LCAvL1JpZ2h0IGFmdGVyIHRoZSBidXR0b24gaGFzIGJlZW4gY2xpY2tlZFxuICAgICAgb25Mb2FkRG9uZTogZnVuY3Rpb24gKGJveCkge1xuICAgICAgICByZXR1cm4gYm94O1xuICAgICAgfSAvL1doZW4gdGhlIHNvdXJjZSBoYXMgYmVlbiBsb2FkZWRcblxuICAgIH0sIG9wdGlvbnMpO1xuXG4gICAgLy9UaGUgb3ZlcmxheVxuICAgIHZhciBvdmVybGF5ID0gJCgnPGRpdiBjbGFzcz1cIm92ZXJsYXlcIj48ZGl2IGNsYXNzPVwiZmEgZmEtcmVmcmVzaCBmYS1zcGluXCI+PC9kaXY+PC9kaXY+Jyk7XG5cbiAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uICgpIHtcbiAgICAgIC8vaWYgYSBzb3VyY2UgaXMgc3BlY2lmaWVkXG4gICAgICBpZiAoc2V0dGluZ3Muc291cmNlID09PSBcIlwiKSB7XG4gICAgICAgIGlmICh3aW5kb3cuY29uc29sZSkge1xuICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZyhcIlBsZWFzZSBzcGVjaWZ5IGEgc291cmNlIGZpcnN0IC0gYm94UmVmcmVzaCgpXCIpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIC8vdGhlIGJveFxuICAgICAgdmFyIGJveCA9ICQodGhpcyk7XG4gICAgICAvL3RoZSBidXR0b25cbiAgICAgIHZhciByQnRuID0gYm94LmZpbmQoc2V0dGluZ3MudHJpZ2dlcikuZmlyc3QoKTtcblxuICAgICAgLy9PbiB0cmlnZ2VyIGNsaWNrXG4gICAgICByQnRuLm9uKCdjbGljaycsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgLy9BZGQgbG9hZGluZyBvdmVybGF5XG4gICAgICAgIHN0YXJ0KGJveCk7XG5cbiAgICAgICAgLy9QZXJmb3JtIGFqYXggY2FsbFxuICAgICAgICBib3guZmluZChcIi5ib3gtYm9keVwiKS5sb2FkKHNldHRpbmdzLnNvdXJjZSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGRvbmUoYm94KTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGZ1bmN0aW9uIHN0YXJ0KGJveCkge1xuICAgICAgLy9BZGQgb3ZlcmxheSBhbmQgbG9hZGluZyBpbWdcbiAgICAgIGJveC5hcHBlbmQob3ZlcmxheSk7XG5cbiAgICAgIHNldHRpbmdzLm9uTG9hZFN0YXJ0LmNhbGwoYm94KTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBkb25lKGJveCkge1xuICAgICAgLy9SZW1vdmUgb3ZlcmxheSBhbmQgbG9hZGluZyBpbWdcbiAgICAgIGJveC5maW5kKG92ZXJsYXkpLnJlbW92ZSgpO1xuXG4gICAgICBzZXR0aW5ncy5vbkxvYWREb25lLmNhbGwoYm94KTtcbiAgICB9XG5cbiAgfTtcbiAgcmV0dXJuICQuTGF5b3V0TWFuYWdlcjtcbn07XG5cbi8qXG4gKiBFWFBMSUNJVCBCT1ggQUNUSVZBVElPTlxuICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAqIFRoaXMgaXMgYSBjdXN0b20gcGx1Z2luIHRvIHVzZSB3aXRoIHRoZSBjb21wb25lbnQgQk9YLiBJdCBhbGxvd3MgeW91IHRvIGFjdGl2YXRlXG4gKiBhIGJveCBpbnNlcnRlZCBpbiB0aGUgRE9NIGFmdGVyIHRoZSBhcHAuanMgd2FzIGxvYWRlZC5cbiAqXG4gKiBAdHlwZSBwbHVnaW5cbiAqIEB1c2FnZSAkKFwiI2JveC13aWRnZXRcIikuYWN0aXZhdGVCb3goKTtcbiAqL1xuJC5MYXlvdXRNYW5hZ2VyLmFjdGl2YXRlQm94ID0gZnVuY3Rpb24gKCkge1xuICAndXNlIHN0cmljdCc7XG5cbiAgJC5mbi5hY3RpdmF0ZUJveCA9IGZ1bmN0aW9uICgpIHtcbiAgICAkLkxheW91dE1hbmFnZXIuYm94V2lkZ2V0LmFjdGl2YXRlKHRoaXMpO1xuICB9O1xuICBcbiAgcmV0dXJuICQuTGF5b3V0TWFuYWdlcjtcbn07XG5cbi8qXG4gKiBUT0RPIExJU1QgQ1VTVE9NIFBMVUdJTlxuICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAqIFRoaXMgcGx1Z2luIGRlcGVuZHMgb24gaUNoZWNrIHBsdWdpbiBmb3IgY2hlY2tib3ggYW5kIHJhZGlvIGlucHV0c1xuICpcbiAqIEB0eXBlIHBsdWdpblxuICogQHVzYWdlICQoXCIjdG9kby13aWRnZXRcIikudG9kb2xpc3QoIG9wdGlvbnMgKTtcbiAqL1xuXG4kLkxheW91dE1hbmFnZXIubGlzdEN1c3RvbVBsdWdpbiA9IGZ1bmN0aW9uICgpIHtcblxuXHQgICd1c2Ugc3RyaWN0JztcblxuXHQgICQuZm4udG9kb2xpc3QgPSBmdW5jdGlvbiAob3B0aW9ucykge1xuXHQgICAgLy8gUmVuZGVyIG9wdGlvbnNcblx0ICAgIHZhciBzZXR0aW5ncyA9ICQuZXh0ZW5kKHtcblx0ICAgICAgLy9XaGVuIHRoZSB1c2VyIGNoZWNrcyB0aGUgaW5wdXRcblx0ICAgICAgb25DaGVjazogZnVuY3Rpb24gKGVsZSkge1xuXHQgICAgICAgIHJldHVybiBlbGU7XG5cdCAgICAgIH0sXG5cdCAgICAgIC8vV2hlbiB0aGUgdXNlciB1bmNoZWNrcyB0aGUgaW5wdXRcblx0ICAgICAgb25VbmNoZWNrOiBmdW5jdGlvbiAoZWxlKSB7XG5cdCAgICAgICAgcmV0dXJuIGVsZTtcblx0ICAgICAgfVxuXHQgICAgfSwgb3B0aW9ucyk7XG5cblx0ICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24gKCkge1xuXG5cdCAgICAgIGlmICh0eXBlb2YgJC5mbi5pQ2hlY2sgIT0gJ3VuZGVmaW5lZCcpIHtcblx0ICAgICAgICAkKCdpbnB1dCcsIHRoaXMpLm9uKCdpZkNoZWNrZWQnLCBmdW5jdGlvbiAoKSB7XG5cdCAgICAgICAgICB2YXIgZWxlID0gJCh0aGlzKS5wYXJlbnRzKFwibGlcIikuZmlyc3QoKTtcblx0ICAgICAgICAgIGVsZS50b2dnbGVDbGFzcyhcImRvbmVcIik7XG5cdCAgICAgICAgICBzZXR0aW5ncy5vbkNoZWNrLmNhbGwoZWxlKTtcblx0ICAgICAgICB9KTtcblxuXHQgICAgICAgICQoJ2lucHV0JywgdGhpcykub24oJ2lmVW5jaGVja2VkJywgZnVuY3Rpb24gKCkge1xuXHQgICAgICAgICAgdmFyIGVsZSA9ICQodGhpcykucGFyZW50cyhcImxpXCIpLmZpcnN0KCk7XG5cdCAgICAgICAgICBlbGUudG9nZ2xlQ2xhc3MoXCJkb25lXCIpO1xuXHQgICAgICAgICAgc2V0dGluZ3Mub25VbmNoZWNrLmNhbGwoZWxlKTtcblx0ICAgICAgICB9KTtcblx0ICAgICAgfSBlbHNlIHtcblx0ICAgICAgICAkKCdpbnB1dCcsIHRoaXMpLm9uKCdjaGFuZ2UnLCBmdW5jdGlvbiAoKSB7XG5cdCAgICAgICAgICB2YXIgZWxlID0gJCh0aGlzKS5wYXJlbnRzKFwibGlcIikuZmlyc3QoKTtcblx0ICAgICAgICAgIGVsZS50b2dnbGVDbGFzcyhcImRvbmVcIik7XG5cdCAgICAgICAgICBpZiAoJCgnaW5wdXQnLCBlbGUpLmlzKFwiOmNoZWNrZWRcIikpIHtcblx0ICAgICAgICAgICAgc2V0dGluZ3Mub25DaGVjay5jYWxsKGVsZSk7XG5cdCAgICAgICAgICB9IGVsc2Uge1xuXHQgICAgICAgICAgICBzZXR0aW5ncy5vblVuY2hlY2suY2FsbChlbGUpO1xuXHQgICAgICAgICAgfVxuXHQgICAgICAgIH0pO1xuXHQgICAgICB9XG5cdCAgICB9KTtcblx0ICB9O1xuXHQgIHJldHVybiAkLkxheW91dE1hbmFnZXI7XG5cdH07XG5cdFxuXHQvKiAtLS0tLS0tLS0tLS0tLS0tLS1cblx0ICogLSBJbXBsZW1lbnRhdGlvbiAtXG5cdCAqIC0tLS0tLS0tLS0tLS0tLS0tLVxuXHQgKiBUaGUgbmV4dCBibG9jayBvZiBjb2RlIGltcGxlbWVudHMgTGF5b3V0TWFuYWdlcidzXG5cdCAqIGZ1bmN0aW9ucyBhbmQgcGx1Z2lucyBhcyBzcGVjaWZpZWQgYnkgdGhlXG5cdCAqIG9wdGlvbnMgYWJvdmUuXG5cdCAqL1xuXHQkLkxheW91dE1hbmFnZXIuc2V0dXAgPSBmdW5jdGlvbiAoKVxuXHR7XG5cdCAgXCJ1c2Ugc3RyaWN0XCI7XG5cblx0ICAvL0ZpeCBmb3IgSUUgcGFnZSB0cmFuc2l0aW9uc1xuXHQgICQoXCJib2R5XCIpLnJlbW92ZUNsYXNzKFwiaG9sZC10cmFuc2l0aW9uXCIpO1xuXG5cdCAgLy9FeHRlbmQgb3B0aW9ucyBpZiBleHRlcm5hbCBvcHRpb25zIGV4aXN0XG5cdCAgaWYgKHR5cGVvZiBMYXlvdXRNYW5hZ2VyT3B0aW9ucyAhPT0gXCJ1bmRlZmluZWRcIikge1xuXHQgICAgJC5leHRlbmQodHJ1ZSxcblx0ICAgICAgICAgICAgJC5MYXlvdXRNYW5hZ2VyLm9wdGlvbnMsXG5cdCAgICAgICAgICAgIExheW91dE1hbmFnZXJPcHRpb25zKTtcblx0ICB9XG5cblx0ICAvL0Vhc3kgYWNjZXNzIHRvIG9wdGlvbnNcblx0ICB2YXIgbyA9ICQuTGF5b3V0TWFuYWdlci5vcHRpb25zO1xuXG5cdCAgLy9TZXQgdXAgdGhlIG9iamVjdFxuXHQgICQuTGF5b3V0TWFuYWdlci5faW5pdCgpO1xuXG5cdCAgLy9BY3RpdmF0ZSB0aGUgbGF5b3V0IG1ha2VyXG5cdCAgJC5MYXlvdXRNYW5hZ2VyLmxheW91dC5hY3RpdmF0ZSgpO1xuXG5cdCAgLy9FbmFibGUgc2lkZWJhciB0cmVlIHZpZXcgY29udHJvbHNcblx0ICAkLkxheW91dE1hbmFnZXIudHJlZSgnLnNpZGViYXInKTtcblxuXHQgIC8vRW5hYmxlIGNvbnRyb2wgc2lkZWJhclxuXHQgIGlmIChvLmVuYWJsZUNvbnRyb2xTaWRlYmFyKSB7XG5cdCAgICAkLkxheW91dE1hbmFnZXIuY29udHJvbFNpZGViYXIuYWN0aXZhdGUoKTtcblx0ICB9XG5cblx0ICAvL0FkZCBzbGltc2Nyb2xsIHRvIG5hdmJhciBkcm9wZG93blxuXHQgIGlmIChvLm5hdmJhck1lbnVTbGltc2Nyb2xsICYmIHR5cGVvZiAkLmZuLnNsaW1zY3JvbGwgIT0gJ3VuZGVmaW5lZCcpIHtcblx0ICAgICQoXCIubmF2YmFyIC5tZW51XCIpLnNsaW1zY3JvbGwoe1xuXHQgICAgICBoZWlnaHQ6IG8ubmF2YmFyTWVudUhlaWdodCxcblx0ICAgICAgYWx3YXlzVmlzaWJsZTogZmFsc2UsXG5cdCAgICAgIHNpemU6IG8ubmF2YmFyTWVudVNsaW1zY3JvbGxXaWR0aFxuXHQgICAgfSkuY3NzKFwid2lkdGhcIiwgXCIxMDAlXCIpO1xuXHQgIH1cblxuXHQgIC8vQWN0aXZhdGUgc2lkZWJhciBwdXNoIG1lbnVcblx0ICBpZiAoby5zaWRlYmFyUHVzaE1lbnUpIHtcblx0ICAgICQuTGF5b3V0TWFuYWdlci5wdXNoTWVudS5hY3RpdmF0ZShvLnNpZGViYXJUb2dnbGVTZWxlY3Rvcik7XG5cdCAgfVxuXG5cdCAgLy9BY3RpdmF0ZSBCb290c3RyYXAgdG9vbHRpcFxuXHQgIGlmIChvLmVuYWJsZUJTVG9wcGx0aXApIHtcblx0ICAgICQoJ2JvZHknKS50b29sdGlwKHtcblx0ICAgICAgc2VsZWN0b3I6IG8uQlNUb29sdGlwU2VsZWN0b3Jcblx0ICAgIH0pO1xuXHQgIH1cblxuXHQgIC8vQWN0aXZhdGUgYm94IHdpZGdldFxuXHQgIGlmIChvLmVuYWJsZUJveFdpZGdldCkge1xuXHQgICAgJC5MYXlvdXRNYW5hZ2VyLmJveFdpZGdldC5hY3RpdmF0ZSgpO1xuXHQgIH1cblxuXHQgIC8vQWN0aXZhdGUgZmFzdCBjbGlja1xuXHQgIGlmIChvLmVuYWJsZUZhc3RjbGljayAmJiB0eXBlb2YgRmFzdENsaWNrICE9ICd1bmRlZmluZWQnKSB7XG5cdCAgICBGYXN0Q2xpY2suYXR0YWNoKGRvY3VtZW50LmJvZHkpO1xuXHQgIH1cblxuXHQgIC8vQWN0aXZhdGUgZGlyZWN0IGNoYXQgd2lkZ2V0XG5cdCAgaWYgKG8uZGlyZWN0Q2hhdC5lbmFibGUpIHtcblx0ICAgICQoZG9jdW1lbnQpLm9uKCdjbGljaycsIG8uZGlyZWN0Q2hhdC5jb250YWN0VG9nZ2xlU2VsZWN0b3IsIGZ1bmN0aW9uICgpIHtcblx0ICAgICAgdmFyIGJveCA9ICQodGhpcykucGFyZW50cygnLmRpcmVjdC1jaGF0JykuZmlyc3QoKTtcblx0ICAgICAgYm94LnRvZ2dsZUNsYXNzKCdkaXJlY3QtY2hhdC1jb250YWN0cy1vcGVuJyk7XG5cdCAgICB9KTtcblx0ICB9XG5cblx0ICAvKlxuXHQgICAqIElOSVRJQUxJWkUgQlVUVE9OIFRPR0dMRVxuXHQgICAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXHQgICAqL1xuXHQgICQoJy5idG4tZ3JvdXBbZGF0YS10b2dnbGU9XCJidG4tdG9nZ2xlXCJdJykuZWFjaChmdW5jdGlvbiAoKSB7XG5cdCAgICB2YXIgZ3JvdXAgPSAkKHRoaXMpO1xuXHQgICAgJCh0aGlzKS5maW5kKFwiLmJ0blwiKS5vbignY2xpY2snLCBmdW5jdGlvbiAoZSkge1xuXHQgICAgICBncm91cC5maW5kKFwiLmJ0bi5hY3RpdmVcIikucmVtb3ZlQ2xhc3MoXCJhY3RpdmVcIik7XG5cdCAgICAgICQodGhpcykuYWRkQ2xhc3MoXCJhY3RpdmVcIik7XG5cdCAgICAgIGUucHJldmVudERlZmF1bHQoKTtcblx0ICAgIH0pO1xuXG5cdCAgfSk7XG5cdCAgXG5cdCAgcmV0dXJuICQuTGF5b3V0TWFuYWdlclxuXHQgIFx0LmFkZFJlZnJlc2hCdXR0b24oKVxuXHQgIFx0LmFjdGl2YXRlQm94KClcblx0ICBcdC5saXN0Q3VzdG9tUGx1Z2luKCk7XG5cdH07XG5cbiQuTGF5b3V0TWFuYWdlci5sb2FkaW5nID0gZnVuY3Rpb24oc3RhcnQpe1xuICB2YXIgc3RhcnQgPSBfLmlzQm9vbGVhbihzdGFydCkgPyBzdGFydCA6IHRydWU7XG4gIGlmIChzdGFydCkge1xuICAgICQoJ2JvZHknKS5hcHBlbmQoJzxkaXYgaWQ9XCJsb2Fkc3Bpbm5lclwiIGNsYXNzPVwibG9hZGluZ1wiPjwvZGl2PicpO1xuICB9XG4gIGVsc2Uge1xuICAgICQoJyNsb2Fkc3Bpbm5lcicpLnJlbW92ZSgpO1xuICB9XG59XG5cbm1vZHVsZS5leHBvcnRzID0gJC5MYXlvdXRNYW5hZ2VyO1xuIiwidmFyIHQgPSByZXF1aXJlKCdzZGsvY29yZS9pMThuL2kxOG4uc2VydmljZScpLnQ7XG52YXIgU3RhY2sgPSByZXF1aXJlKCcuL2JhcnN0YWNrLmpzJyk7XG5cbi8vc2lkZWJhciBpdGVtIGNoZSBub24gw6ggYWx0cm8gY2hlIHVuIGxpIGRlbGxhIHNpZGViYXIgZG92ZSBzYXLDoCBwb3Nzb2JpbGUgaW1wb3N0YXJlXG4vL3RpdG9sbyB0aXBvIGRpIGljb25hIGV0YyAuLiBjdXN0b21penphdGEgcGVyIG9nbmkgY29tcG9uZW50ZVxuXG52YXIgU2lkZWJhckl0ZW0gPSBWdWUuZXh0ZW5kKHtcbiAgdGVtcGxhdGU6IHJlcXVpcmUoJy4uL2h0bWwvc2lkZWJhci1pdGVtLmh0bWwnKSxcbiAgZGF0YTogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgbWFpbjogdHJ1ZSxcbiAgICAgICAgY29tcG9uZW50OiBudWxsLFxuICAgICAgICBhY3RpdmU6IGZhbHNlLFxuICAgICAgICBkYXRhVHlwZTogJ2lubGluZScsXG4gICAgICAgIHRpdGxlOiAnY29tcG9uZW50JyxcbiAgICAgICAgaWNvbjogbnVsbCxcbiAgICAgICAgb3BlbjogdHJ1ZSxcbiAgICAgICAgc3RhdGU6IG51bGxcbiAgICAgIH07XG4gIH1cbn0pO1xuXG5mdW5jdGlvbiBTaWRlYmFyU2VydmljZSgpe1xuICB0aGlzLnN0YWNrID0gbmV3IFN0YWNrKCk7XG4gIHRoaXMuc3RhdGUgPSB7XG4gICAgY29tcG9uZW50czogW11cbiAgfTtcbiAgXG4gIHRoaXMuaW5pdCA9IGZ1bmN0aW9uKGxheW91dCl7XG4gICAgdGhpcy5sYXlvdXQgPSBsYXlvdXQ7XG4gIH07XG4gIFxuICB0aGlzLmFkZENvbXBvbmVudCA9IGZ1bmN0aW9uKGNvbXBvbmVudCl7XG4gICAgLy9hZ2dpdW5nbyBjb21wb25lbnRlXG4gICAgdGhpcy5zdGF0ZS5jb21wb25lbnRzLnB1c2goY29tcG9uZW50KTtcbiAgICAvL2ZhY2NpbyBtb250YXJlIGlsIHNlZGViYXItaXRlbSBjaGUgY29udGllbmUgYWwgc3VvIGludGVybm8gaWwgcGxhY2Vob2xkZXIgZGVsIGNvbXBvbmVudGUgdmVybyBlIHByb3ByaW9cbiAgICAvL2luIHF1ZXN0byBtb2RvIGlsIGNvbXBvbmVudGUgbm9uIHNpIGRvdnLDoCBvY2N1cGFyZSBkaSBjb3N0cnVpcmUgYW5jaGUgbCdlbGVtZW50byBsaSBkZWxsYSBzaWRlYmFyXG4gICAgLy9tYSBjb250ZXJyw6Agc29sbyBpbCBjb250ZW51dG9cbiAgICB2YXIgc2lkZWJhckl0ZW0gPSBuZXcgU2lkZWJhckl0ZW0oKTtcbiAgICAvL3NldHRvIGxlIHBhcnRpIGRlbGxhIHNpZGViYXItaXRlbSBjaGUgY2FtYmlhbm8gZGEgY29tcG9uZW50ZSBhIGNvbXBvbmVudGUgKGRhIHJpdmVkZXJlKVxuICAgIHNpZGViYXJJdGVtLnRpdGxlID0gY29tcG9uZW50LnRpdGxlIHx8IHNpZGViYXJJdGVtLnRpdGxlO1xuICAgIHNpZGViYXJJdGVtLm9wZW4gPSAoY29tcG9uZW50Lm9wZW4gPT09IHVuZGVmaW5lZCkgPyBzaWRlYmFySXRlbS5vcGVuIDogY29tcG9uZW50Lm9wZW47XG4gICAgc2lkZWJhckl0ZW0uaWNvbiA9IGNvbXBvbmVudC5kYXRhSWNvbiB8fCBzaWRlYmFySXRlbS5pY29uO1xuICAgIHNpZGViYXJJdGVtLnN0YXRlID0gY29tcG9uZW50LnN0YXRlIHx8IHRydWU7XG4gICAgc2lkZWJhckl0ZW0uJG1vdW50KCkuJGFwcGVuZFRvKCcjZzN3LXNpZGViYXJjb21wb25lbnRzJyk7XG4gICAgXG4gICAgLy9tb250byBpbCBjb21wb25ldGUgbmVsbGEgc2lkZWJhclxuICAgIGNvbXBvbmVudC5tb3VudChcIiNnM3ctc2lkZWJhcmNvbXBvbmVudC1wbGFjZWhvbGRlclwiKTtcbiAgICBpZiAoXy5oYXMoY29tcG9uZW50LCAnaW5pdFNlcnZpY2UnKSkge1xuICAgICAgY29tcG9uZW50LmluaXRTZXJ2aWNlKCk7XG4gICAgfTtcbiAgfTtcbiAgXG4gIHRoaXMucmVtb3ZlQ29tcG9uZW50ID0gZnVuY3Rpb24oKXtcbiAgICAvL2RhIHZlZGVyZVxuICB9O1xuXG4gIHRoaXMuc2hvd1BhbmVsID0gZnVuY3Rpb24ocGFuZWwpe1xuICAgIHZhciBwYXJlbnQgPSBcIiNnM3ctc2lkZWJhcnBhbmVsLXBsYWNlaG9sZGVyXCI7XG4gICAgdGhpcy5zdGFjay5wdXNoKHBhbmVsLCBwYXJlbnQpO1xuICB9O1xuXG4gIHRoaXMuY2xvc2VQYW5lbCA9IGZ1bmN0aW9uKCl7XG4gICAgdmFyIHBhbmVsID0gdGhpcy5zdGFjay5wb3AoKTtcbiAgfTtcbn1cblxudmFyIHNpZGViYXJTZXJ2aWNlID0gbmV3IFNpZGViYXJTZXJ2aWNlKCk7XG5cbnZhciBTaWRlYmFyQ29tcG9uZW50ID0gVnVlLmV4dGVuZCh7XG4gICAgdGVtcGxhdGU6IHJlcXVpcmUoJy4uL2h0bWwvc2lkZWJhci5odG1sJyksXG4gICAgZGF0YTogZnVuY3Rpb24oKSB7XG4gICAgXHRyZXR1cm4ge1xuICAgICAgICBjb21wb25lbnRzOiBzaWRlYmFyU2VydmljZS5zdGF0ZS5jb21wb25lbnRzLFxuICAgICAgICBwYW5lbHM6IHNpZGViYXJTZXJ2aWNlLnN0YWNrLnN0YXRlLnBhbmVscyxcbiAgICAgICAgYk9wZW46IHRydWUsXG4gICAgXHRcdGJQYWdlTW9kZTogZmFsc2UsXG4gICAgXHRcdGhlYWRlcjogdCgnbWFpbiBuYXZpZ2F0aW9uJyksXG4gICAgICAgIH07XG4gICAgfSxcbiAgICBjb21wdXRlZDoge1xuICAgICAgLy8gcXVhbnRpIHBhbm5lbGxpIHNvbm8gYXR0aXZpIG5lbGxvIHN0YWNrXG4gICAgICBwYW5lbHNpbnN0YWNrOiBmdW5jdGlvbigpe1xuICAgICAgICByZXR1cm4gdGhpcy5wYW5lbHMubGVuZ3RoPjA7XG4gICAgICB9LFxuICAgICAgc2hvd21haW5wYW5lbDogZnVuY3Rpb24oKXtcbiAgICAgICAgcmV0dXJuIHRoaXMuY29tcG9uZW50cy5sZW5ndGg+MCAmJiAhdGhpcy5wYW5lbHNpbnN0YWNrO1xuICAgICAgfSxcbiAgICAgIGNvbXBvbmVudG5hbWU6IGZ1bmN0aW9uKCl7XG4gICAgICAgIHZhciBuYW1lID0gXCJcIjtcbiAgICAgICAgaWYgKHRoaXMuY29tcG9uZW50cy5sZW5ndGgpe1xuICAgICAgICAgIG5hbWUgPSB0aGlzLmNvbXBvbmVudHMuc2xpY2UoLTEpWzBdLmdldFRpdGxlKCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG5hbWU7XG4gICAgICB9LFxuICAgICAgcGFuZWxuYW1lOiBmdW5jdGlvbigpe1xuICAgICAgICB2YXIgbmFtZSA9IFwiXCI7XG4gICAgICAgIGlmICh0aGlzLnBhbmVscy5sZW5ndGgpe1xuICAgICAgICAgIG5hbWUgPSB0aGlzLnBhbmVscy5zbGljZSgtMSlbMF0uZ2V0VGl0bGUoKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbmFtZTtcbiAgICAgIH1cbiAgICB9LFxuICAgIG1ldGhvZHM6IHtcbiAgICAgIGNsb3NlUGFuZWw6IGZ1bmN0aW9uKCl7XG4gICAgICAgIHNpZGViYXJTZXJ2aWNlLmNsb3NlUGFuZWwoKTtcbiAgICAgIH0sXG4gICAgICBpc01vYmlsZTogZnVuY3Rpb24oKXtcbiAgICAgICAgcmV0dXJuIGlzTW9iaWxlLmFueVxuICAgICAgfVxuICAgIH0sXG4gICAgcmVhZHk6IGZ1bmN0aW9uKCl7XG4gICAgfVxufSk7XG5cbm1vZHVsZS5leHBvcnRzID0ge1xuICBTaWRlYmFyU2VydmljZTogc2lkZWJhclNlcnZpY2UsXG4gIFNpZGViYXJDb21wb25lbnQ6IFNpZGViYXJDb21wb25lbnRcbn1cbiIsInZhciB0ID0gcmVxdWlyZSgnc2RrL2NvcmUvaTE4bi9pMThuLnNlcnZpY2UnKS50O1xucmVxdWlyZSgnc2RrL2d1aS92dWUvdnVlLmRpcmVjdGl2ZXMnKTtcbnZhciBDb21wb25lbnRzUmVnaXN0cnkgPSByZXF1aXJlKCdzZGsvZ3VpL2NvbXBvbmVudHNyZWdpc3RyeScpO1xudmFyIEdVSSA9IHJlcXVpcmUoJ3Nkay9ndWkvZ3VpJyk7XG4vLyB0ZW1wb3JhbmVvIHBlciBmYXIgZnVuemlvbmFyZSBsZSBjb3NlXG52YXIgY29uZmlnID0ge1xuICAgIGNsaWVudDp7fVxufTtcblxudmFyIHNpZGViYXIgPSByZXF1aXJlKCcuL3NpZGViYXInKTtcbnZhciBmbG9hdGJhciA9IHJlcXVpcmUoJy4vZmxvYXRiYXInKTtcbnZhciB2aWV3cG9ydCA9IHJlcXVpcmUoJy4vdmlld3BvcnQnKTtcbnZhciBBcHBVSSA9IHJlcXVpcmUoJy4vYXBwbGljYXRpb251aScpO1xudmFyIGxheW91dCA9IHJlcXVpcmUoJy4vbGF5b3V0Jyk7XG5cbi8vIGZvcnNlIGRhIHRyb3ZhcmUgdW4gcG9zdG8gbWlnbGlvcmUgcGVyIGF0dGl2YXJlIGxvIHNwaW5uZXIgaW5pemlhbGUuLi5cbmxheW91dC5sb2FkaW5nKCk7XG5cbnZhciBBcHBsaWNhdGlvblRlbXBsYXRlID0gZnVuY3Rpb24odGVtcGxhdGVDb25maWcsIEFwcGxpY2F0aW9uU2VydmljZSkge1xuICBzZWxmID0gdGhpcztcbiAgdGhpcy50ZW1wbGF0ZUNvbmZpZyA9IHRlbXBsYXRlQ29uZmlnO1xuICB0aGlzLkFwcGxpY2F0aW9uU2VydmljZSA9IEFwcGxpY2F0aW9uU2VydmljZTtcbiAgXG4gIHRoaXMuaW5pdCA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBjb25maWcgPSBBcHBsaWNhdGlvblNlcnZpY2UuZ2V0Q29uZmlnKCk7XG4gICAgaWYgKGNvbmZpZy5kZWJ1Zyl7XG4gICAgICBWdWUuY29uZmlnLmRlYnVnID0gdHJ1ZTtcbiAgICB9XG4gICAgdGhpcy5fc2V0dXBJbnRlcmZhY2UoKTtcbiAgICB0aGlzLl9zZXR1cExheW91dCgpO1xuICB9O1xuICBcbiAgdGhpcy5fc2V0dXBMYXlvdXQgPSBmdW5jdGlvbigpeyAgXG4gICAgVnVlLmZpbHRlcigndCcsIGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgcmV0dXJuIHQodmFsdWUpO1xuICAgIH0pO1xuXG4gICAgdmFyIEFwcFVJID0gcmVxdWlyZSgnLi9hcHBsaWNhdGlvbnVpJyk7XG5cbiAgICBWdWUuY29tcG9uZW50KCdzaWRlYmFyJywgc2lkZWJhci5TaWRlYmFyQ29tcG9uZW50KTtcbiAgICBWdWUuY29tcG9uZW50KCd2aWV3cG9ydCcsIHZpZXdwb3J0LlZpZXdwb3J0Q29tcG9uZW50KTtcbiAgICBWdWUuY29tcG9uZW50KCdmbG9hdGJhcicsIGZsb2F0YmFyLkZsb2F0YmFyQ29tcG9uZW50KTtcbiAgICBWdWUuY29tcG9uZW50KCdhcHAnLCBBcHBVSSk7XG4gICAgLy9pbml6aWFsaXp6YSBsJ2FwcGxpY2F6aW9uZSBWdWVcbiAgICB2YXIgdGVtcGxhdGUgPSB0aGlzOyAgXG4gICAgdmFyIGFwcCA9IG5ldyBWdWUoe1xuICAgICAgZWw6ICdib2R5JyxcbiAgICAgIHJlYWR5OiBmdW5jdGlvbigpe1xuICAgICAgICBzZWxmLl9idWlsZFRlbXBsYXRlKCk7XG4gICAgICAgICQoZG9jdW1lbnQpLmxvY2FsaXplKCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cbiAgXG4gIHRoaXMuX2J1aWxkVGVtcGxhdGUgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgZmxvYXRiYXIuRmxvYXRiYXJTZXJ2aWNlLmluaXQobGF5b3V0KTtcbiAgICB2YXIgcGxhY2Vob2xkZXJzQ29uZmlnID0gdGhpcy50ZW1wbGF0ZUNvbmZpZy5wbGFjZWhvbGRlcnM7XG4gICAgXy5mb3JFYWNoKHBsYWNlaG9sZGVyc0NvbmZpZywgZnVuY3Rpb24oY29tcG9uZW50cywgcGxhY2Vob2xkZXIpe1xuICAgICAgLy8gcGVyIG9nbmkgcGxhY2Vob2xkZXIgY2kgcG9zc29ubyBlc3NlcmUgcGnDuSBjb21wb25lbnRpIGNpY2xvIGUgYWdnaXVuZ29cbiAgICAgXy5mb3JFYWNoKGNvbXBvbmVudHMuY29tcG9uZW50cywgZnVuY3Rpb24oY29tcG9uZW50KXtcbiAgICAgICAgc2VsZi5fYWRkQ29tcG9uZW50KHBsYWNlaG9sZGVyLCBjb21wb25lbnQpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gICAgLy9yZWdpc3RybyBhbHRyaSBjb21wb25lbnRpIGNoZSBub24gaGFubm8gdW5hIGNvbGxvY2F6aW9uZSBzcGF6aWFsZSBwcmVjaXNhXG4gICAgLy8gY29tZSBkYSBlc2VtcGlvIGkgcmlzdWx0YXRpIGNoZSBwb3Nzb25vIGVzc2VyZSBtb250YXRpIHN1bGxhIGZsb2F0YmFyIG8gYWx0cmUgcGFydGkgZGVsIHRlbXBsYXRlXG4gICAgdGhpcy5fYWRkT3RoZXJDb21wb25lbnRzKCk7XG5cbiAgICBHVUkucmVhZHkoKTtcbiAgfTtcblxuICAvL2FnZ2l1bmdlcmUgY29tcGluZXRpIG5vbiBsZWdhdGkgYWQgdW4gcGxhY2Vob2xkZXJcbiAgdGhpcy5fYWRkT3RoZXJDb21wb25lbnRzID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIGlmICh0aGlzLnRlbXBsYXRlQ29uZmlnLm90aGVyY29tcG9uZW50cykge1xuICAgICAgXy5mb3JFYWNoKHRoaXMudGVtcGxhdGVDb25maWcub3RoZXJjb21wb25lbnRzLCBmdW5jdGlvbihjb21wb25lbnQpIHtcbiAgICAgICAgc2VsZi5fYWRkQ29tcG9uZW50KCdvdGhlcmNvbXBvbmVudHMnLCBjb21wb25lbnQpO1xuICAgICAgfSlcbiAgICB9O1xuICB9O1xuICBcbiAgdGhpcy5fYWRkQ29tcG9uZW50ID0gZnVuY3Rpb24ocGxhY2Vob2xkZXIsIGNvbXBvbmVudCkge1xuICAgIGlmIChBcHBsaWNhdGlvblRlbXBsYXRlLlBMQUNFSE9MREVSUy5pbmRleE9mKHBsYWNlaG9sZGVyKSA+IC0xKXtcbiAgICAgIHZhciBwbGFjZWhvbGRlclNlcnZpY2UgPSBBcHBsaWNhdGlvblRlbXBsYXRlLlBsYWNlaG9sZGVyc1NlcnZpY2VzW3BsYWNlaG9sZGVyXTtcbiAgICAgIGlmIChwbGFjZWhvbGRlclNlcnZpY2UpIHtcbiAgICAgICAgcGxhY2Vob2xkZXJTZXJ2aWNlLmFkZENvbXBvbmVudChjb21wb25lbnQpO1xuICAgICAgICBDb21wb25lbnRzUmVnaXN0cnkucmVnaXN0ZXJDb21wb25lbnQoY29tcG9uZW50KTtcbiAgICAgIH1cbiAgICB9IGVsc2UgeyAvLyBjYXNvIGRpIGNvbXBvbmVudGkgbm9uIHBsYWNlaG9sZGVyXG4gICAgICBDb21wb25lbnRzUmVnaXN0cnkucmVnaXN0ZXJDb21wb25lbnQoY29tcG9uZW50KTtcbiAgICB9XG4gIH07XG4gIFxuICB0aGlzLl9yZW1vdmVDb21wb25lbnQgPSBmdW5jdGlvbihwbGNlaG9sZGVyLGNvbXBvbmVudElkKSB7XG4gICAgQ29tcG9uZW50c1JlZ2lzdHJ5LnVucmVnaXN0ZXJDb21wb25lbnQoY29tcG9uZW50KTtcbiAgfTtcbiAgXG4gIHRoaXMuX3Nob3dNb2RhbE92ZXJsYXkgPSBmdW5jdGlvbihib29sKXtcbiAgICAvKmlmICghdGhpcy5fbW9kYWxPdmVybGF5KXtcbiAgICAgIHRoaXMuX21vZGFsT3ZlcmxheSA9ICQoJzxkaXYgaWQ9XCJnM3ctbW9kYWwtb3ZlcmxheVwiIHN0eWxlPVwiYmFja2dyb3VuZC1jb2xvcjogIzAwMDAwMDsgb3BhY2l0eTogMC43O3otaW5kZXg6NDAwMDtwb3NpdGlvbjpmaXhlZDt0b3A6MHB4O2xlZnQ6MHB4XCI+PC9kaXY+Jyk7XG4gICAgICAkKFwiYm9keVwiKS5hcHBlbmQodGhpcy5fbW9kYWxPdmVybGF5KTtcbiAgICAgIHRoaXMuX21vZGFsT3ZlcmxheS53aWR0aCgkKHdpbmRvdykuaW5uZXJXaWR0aCgpKTtcbiAgICAgIHRoaXMuX21vZGFsT3ZlcmxheS5oZWlnaHQoJCh3aW5kb3cpLmlubmVySGVpZ2h0KCkpO1xuICAgIH1cbiAgICBpZiAoXy5pc1VuZGVmaW5lZChib29sKSB8fCBib29sID09PSB0cnVlKXtcbiAgICAgIHRoaXMuX21vZGFsT3ZlcmxheS53aWR0aCgkKHdpbmRvdykuaW5uZXJXaWR0aCgpKTtcbiAgICAgIHRoaXMuX21vZGFsT3ZlcmxheS5oZWlnaHQoJCh3aW5kb3cpLmlubmVySGVpZ2h0KCkpO1xuICAgICAgdGhpcy5fbW9kYWxPdmVybGF5LnNob3coKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICB0aGlzLl9tb2RhbE92ZXJsYXkuaGlkZSgpO1xuICAgIH0qL1xuICB9O1xuXG4gIHRoaXMuX3Nob3dTaWRlYmFyID0gZnVuY3Rpb24oKSB7XG4gICAgLy9jb2RpY2UgcXVpXG4gIH07XG4gIHRoaXMuX2hpZGVTaWRlYmFyID0gZnVuY3Rpb24oKSB7XG4gICAgLy9jb2RpY2UgcXVpXG4gIH07XG4gIFxuICB0aGlzLl9zZXR1cEludGVyZmFjZSA9IGZ1bmN0aW9uKCkge1xuICAgIC8qIERFRklOSVpJT05FIElOVEVSRkFDQ0lBIFBVQkJMSUNBICovXG4gICAgXG4gICAgLyogTWV0b2RpIGNvbXVuaSBhIHR1dHRpIGkgdGVtcGxhdGUgKi9cbiAgICBHVUkubGF5b3V0ID0gbGF5b3V0O1xuICAgIEdVSS5hZGRDb21wb25lbnQgPSBfLmJpbmQodGhpcy5fYWRkQ29tcG9uZW50LCB0aGlzKTtcbiAgICBHVUkucmVtb3ZlQ29tcG9uZW50ID0gXy5iaW5kKHRoaXMuX3JlbW92ZUNvbXBvbmVudCwgdGhpcyk7XG4gICAgXG4gICAgLyogTWV0b2RpIGRhIGRlZmluaXJlICh0cmFtaXRlIGJpbmRpbmcpICovXG4gICAgR1VJLmdldFJlc291cmNlc1VybCA9IF8uYmluZChmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiB0aGlzLkFwcGxpY2F0aW9uU2VydmljZS5nZXRDb25maWcoKS5yZXNvdXJjZXN1cmw7XG4gICAgfSx0aGlzKTtcbiAgICBcbiAgICBHVUkuc2hvd0Zvcm0gPSBfLmJpbmQoZmxvYXRiYXIuRmxvYXRiYXJTZXJ2aWNlLnNob3dQYW5lbCxmbG9hdGJhci5GbG9hdGJhclNlcnZpY2UpO1xuICAgIEdVSS5jbG9zZUZvcm0gPSBfLmJpbmQoZmxvYXRiYXIuRmxvYXRiYXJTZXJ2aWNlLmNsb3NlUGFuZWwsZmxvYXRiYXIuRmxvYXRiYXJTZXJ2aWNlKTtcbiAgICBHVUkuc2hvd0xpc3QgPSBfLmJpbmQoZmxvYXRiYXIuRmxvYXRiYXJTZXJ2aWNlLnNob3dQYW5lbCxmbG9hdGJhci5GbG9hdGJhclNlcnZpY2UpO1xuICAgIEdVSS5jbG9zZUxpc3QgPSBfLmJpbmQoZmxvYXRiYXIuRmxvYXRiYXJTZXJ2aWNlLmNsb3NlUGFuZWwsZmxvYXRiYXIuRmxvYXRiYXJTZXJ2aWNlKTtcbiAgICBHVUkuaGlkZUxpc3QgPSBfLmJpbmQoZmxvYXRiYXIuRmxvYXRiYXJTZXJ2aWNlLmhpZGVQYW5lbCxmbG9hdGJhci5GbG9hdGJhclNlcnZpY2UpO1xuICAgIFxuICAgIEdVSS5zaG93VGFibGUgPSBmdW5jdGlvbigpIHt9O1xuICAgIEdVSS5jbG9zZVRhYmxlID0gZnVuY3Rpb24oKSB7fTtcbiAgICBcbiAgICAvLyBRdWkgc2kgaW1wbGVtZW50YSBpbCBtZXRvZG8gcGVyIGxhIHZpc3VhbGl6emF6aW9uZSBkZWkgcmlzdWx0YXRpXG4gICAgLy8gZGVyaXZhbnRpIGRhIHVuYSBxdWVyeVxuXG4gICAgLy9lc2VtcGlvIGRpIG1ldG9kbyBnZW5lcmljb1xuICAgIEdVSS5zaG93UmVzdWx0c0ZhY3RvcnkgPSBmdW5jdGlvbih0eXBlKSB7XG4gICAgICB2YXIgc2hvd1BhbmVsUmVzdWx0cztcbiAgICAgIHN3aXRjaCAodHlwZSkge1xuICAgICAgICBjYXNlICdxdWVyeSc6XG4gICAgICAgICAgR1VJLnNob3dGbG9hdGJhcigpO1xuICAgICAgICAgIHNob3dQYW5lbFJlc3VsdHMgPSBHVUkuc2hvd1F1ZXJ5UmVzdWx0cztcbiAgICAgICAgICBicmVhaztcbiAgICAgIH07XG4gICAgICByZXR1cm4gc2hvd1BhbmVsUmVzdWx0cztcbiAgICB9O1xuXG4gICAgR1VJLnNob3dRdWVyeVJlc3VsdHMgPSBmdW5jdGlvbih0aXRsZSxyZXN1bHRzKSB7XG4gICAgICAvLyBpc3RhbnppYXJlIGlsIGNvbXBvbmVudGUgcXVlcnlyZXN1bHRzXG4gICAgICB2YXIgcXVlcnlSZXN1bHRzQ29tcG9uZW50ID0gR1VJLmdldENvbXBvbmVudCgncXVlcnlyZXN1bHRzJyk7XG4gICAgICAvLyBwYXNzYXJsbyBhIEZsb2F0YmFyXG4gICAgICB2YXIgcXVlcnlSZXN1bHRTZXJ2aWNlID0gcXVlcnlSZXN1bHRzQ29tcG9uZW50LmdldFNlcnZpY2UoKTtcbiAgICAgIHF1ZXJ5UmVzdWx0U2VydmljZS5yZXNldCgpO1xuICAgICAgcXVlcnlSZXN1bHRTZXJ2aWNlLnNldFRpdGxlKHRpdGxlKTtcbiAgICAgIGlmIChyZXN1bHRzKSB7XG4gICAgICAgIHF1ZXJ5UmVzdWx0U2VydmljZS5zZXRRdWVyeVJlc3BvbnNlKHJlc3VsdHMpO1xuICAgICAgfVxuICAgICAgLy9yaW11b3ZvIHNwaW5uZXJcbiAgICAgIHZhciBvcHRpb25zID0ge2FwcGVuZDogdHJ1ZX07XG4gICAgICBmbG9hdGJhci5GbG9hdGJhclNlcnZpY2Uuc2hvd1BhbmVsKHF1ZXJ5UmVzdWx0c0NvbXBvbmVudCwgb3B0aW9ucyk7XG4gICAgICByZXR1cm4gcXVlcnlSZXN1bHRTZXJ2aWNlO1xuICAgIH07XG4gICAgXG4gICAgR1VJLmhpZGVRdWVyeVJlc3VsdHMgPSBfLmJpbmQoZmxvYXRiYXIuRmxvYXRiYXJTZXJ2aWNlLmhpZGVQYW5lbCxmbG9hdGJhci5GbG9hdGJhclNlcnZpY2UpO1xuICAgIC8vdGVtcG9yYW5lbyBzaG93IHBhbmVsXG4gICAgR1VJLnNob3dQYW5lbCA9IF8uYmluZChzaWRlYmFyLlNpZGViYXJTZXJ2aWNlLnNob3dQYW5lbCwgc2lkZWJhci5TaWRlYmFyU2VydmljZSk7XG4gICAgR1VJLmNsb3NlUGFuZWwgPSBfLmJpbmQoc2lkZWJhci5TaWRlYmFyU2VydmljZS5jbG9zZVBhbmVsLCBzaWRlYmFyLlNpZGViYXJTZXJ2aWNlKTtcbiAgICAvKiAtLS0tLS0tLS0tLS0tLS0tLS0gKi9cblxuICAgIHRvYXN0ci5vcHRpb25zLnBvc2l0aW9uQ2xhc3MgPSAndG9hc3QtdG9wLWNlbnRlcic7XG4gICAgdG9hc3RyLm9wdGlvbnMucHJldmVudER1cGxpY2F0ZXMgPSB0cnVlO1xuICAgIC8vIHByb3h5IGRlbGxhIGxpYnJlcmlhIHRvYXN0clxuICAgIEdVSS5ub3RpZnkgPSB0b2FzdHI7XG4gICAgLy8gcHJveHkgZGVsbGEgbGlicmVyaWEgYm9vdGJveFxuICAgIEdVSS5kaWFsb2cgPSBib290Ym94O1xuICAgIC8qIHNwaW5uZXIgKi9cbiAgICBHVUkuc2hvd1NwaW5uZXIgPSBmdW5jdGlvbihvcHRpb25zKXtcbiAgICAgIHZhciBjb250YWluZXIgPSBvcHRpb25zLmNvbnRhaW5lciB8fCAnYm9keSc7XG4gICAgICB2YXIgaWQgPSBvcHRpb25zLmlkIHx8ICdsb2Fkc3Bpbm5lcic7XG4gICAgICB2YXIgd2hlcmUgPSBvcHRpb25zLndoZXJlIHx8ICdwcmVwZW5kJzsgLy8gYXBwZW5kIHwgcHJlcGVuZFxuICAgICAgdmFyIHN0eWxlID0gb3B0aW9ucy5zdHlsZSB8fCAnJztcbiAgICAgIHZhciB0cmFuc3BhcmVudCA9IG9wdGlvbnMudHJhbnNwYXJlbnQgPyAnYmFja2dyb3VuZC1jb2xvcjogdHJhbnNwYXJlbnQnIDogJyc7XG4gICAgICBpZiAoISQoXCIjXCIraWQpLmxlbmd0aCkge1xuICAgICAgICAkKGNvbnRhaW5lcilbd2hlcmVdLmNhbGwoJChjb250YWluZXIpLCc8ZGl2IGlkPVwiJytpZCsnXCIgY2xhc3M9XCJzcGlubmVyLXdyYXBwZXIgJytzdHlsZSsnXCIgc3R5bGU9XCInK3RyYW5zcGFyZW50KydcIj48ZGl2IGNsYXNzPVwic3Bpbm5lciAnK3N0eWxlKydcIj48L2Rpdj48L2Rpdj4nKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIEdVSS5oaWRlU3Bpbm5lciA9IGZ1bmN0aW9uKGlkKXtcbiAgICAgICQoXCIjXCIraWQpLnJlbW92ZSgpO1xuICAgIH07XG4gICAgLyogZW5kIHNwaW5uZXIqL1xuXG4gICAgLyogZmluZSBtZXRvZGkgY29tdW5pICovXG4gICAgXG4gICAgLyogTWV0b2RpIHNwZWNpZmljaSBkZWwgdGVtcGxhdGUgKi9cbiAgICAvLyBGTE9BVEJBUiAvL1xuICAgIEdVSS5zaG93RmxvYXRiYXIgPSBmdW5jdGlvbigpIHtcbiAgICAgIGZsb2F0YmFyLkZsb2F0YmFyU2VydmljZS5vcGVuKCk7XG4gICAgfTtcbiAgICBHVUkuaGlkZUZsb2F0YmFyID0gZnVuY3Rpb24oKSB7XG4gICAgICBmbG9hdGJhci5GbG9hdGJhclNlcnZpY2UuY2xvc2UoKTtcbiAgICB9O1xuXG4gICAgLy8gU0lERUJBUiAvL1xuICAgIEdVSS5zaG93U2lkZWJhciA9IF8uYmluZCh0aGlzLl9zaG93U2lkZWJhciwgdGhpcyk7XG4gICAgR1VJLmhpZGVTaWRlYmFyID0gXy5iaW5kKHRoaXMuX2hpZGVTaWRlYmFyLCB0aGlzKTtcbiAgICBcbiAgICBHVUkuc2V0TW9kYWwgPSBfLmJpbmQodGhpcy5fc2hvd01vZGFsT3ZlcmxheSx0aGlzKTtcbiAgICBcbiAgICAvLyBNb3N0cmEgbGEgbWFwcGEgY29tZSB2aXN0YSBwcmluY2lwYWxlXG4gICAgR1VJLnNob3dNYXAgPSBmdW5jdGlvbigpIHtcbiAgICAgIHZpZXdwb3J0LlZpZXdwb3J0U2VydmljZS5zZXRQcmltYXJ5Q29tcG9uZW50KCdtYXAnKTtcbiAgICB9O1xuICAgIC8vIE1vc3RyYSBsYSBtYXBwYSBjb21lIHZpc3RhIGFzaWRlLCBpbXBvc3RhbmRvIGlsIHJhcHBvcnRvIHZpc3RhIHByaW5jaXBhbGUgLyB2aXN0YSBzZWNvbmRhcmlhIChlcy4gMiBwZXIgMS8yLCAzIHBlciB2aXN0YSBzZWNvbmRhcmlhIDEvIGRpIHF1ZWxsYSBwcmltYXJpYSwgZWNjLilcbiAgICBHVUkuc2hvd01hcEFzaWRlID0gZnVuY3Rpb24oc3BsaXQscmF0aW8pIHtcbiAgICAgIFxuICAgIH07XG4gICAgLy8gTW9zdHJhIGlsIGNvbnRlbnV0byBjb21lIHZpc3RhIHByaW5jaXBhbGUuIElsIGNvbnRlbnV0byBwdcOyIGVzc2VyZSB1bmEgc3RyaW5nIEhUTUwsIHVuIGVsZW1lbnRvIERPTSBvIHVuIGNvbXBvbmVudGUgVnVlXG4gICAgR1VJLnNob3dDb250ZW50ID0gZnVuY3Rpb24oY29udGVudCkge1xuICAgICAgdmFyIGNvbnRlbnRDb21wb25lbnQgPSBDb21wb25lbnRzUmVnaXN0cnkuZ2V0Q29tcG9uZW50KCdjb250ZW50Jyk7XG4gICAgICAvLyBjb250ZW50Q29tcG9uZW50LnNldENvbnRlbnQoY29udGVudCk7ICBEQSBJTVBMRU1FTlRBUkU6IElsIHNlY29uZG8gY29tcG9uZW50ZSBzZXR0YXRvIGluIGZhc2UgZGkgY29uZmlndXJhemlvbmUgKGFuY29yYSBub24gcHJlc2VudGUpIGRvdnLDoCBpbXBsZW1lbnRhcmUgaWwgbWV0b2RvIHNldENvbnRlbnRcbiAgICAgIC8vIGNoZSBhY2NldHRlcsOgIG8gdW5hIHN0cmluZ2EgSFRNTCwgbyB1biBlbGVtZW50byBET00sIG9wcHVyZSB1biBjb21wb25lbnRlIFZ1ZVxuICAgICAgdmlld3BvcnQuVmlld3BvcnRTZXJ2aWNlLnNldFByaW1hcnlDb21wb25lbnQoJ2NvbnRlbnQnKTtcbiAgICB9O1xuICAgIC8vIE1vc3RyYSBpIGNvbnRlbnV0byBjb21lIHZpc3RhIGFzaWRlXG4gICAgR1VJLnNob3dDb250ZW50QXNpZGUgPSBmdW5jdGlvbihjb250ZW50LHNwbGl0LHJhdGlvKSB7XG4gICAgICB2YXIgY29udGVudENvbXBvbmVudCA9IENvbXBvbmVudHNSZWdpc3RyeS5nZXRDb21wb25lbnQoJ2NvbnRlbnQnKTtcbiAgICAgIC8vIGNvbnRlbnRDb21wb25lbnQuc2V0Q29udGVudChjb250ZW50KTtcbiAgICAgIHZpZXdwb3J0LlZpZXdwb3J0U2VydmljZS5zZXRQcmltYXJ5Q29tcG9uZW50KCdtYXAnKTtcbiAgICAgIHZpZXdwb3J0LlZpZXdwb3J0U2VydmljZS5zaG93U2Vjb25kYXJ5VmlldyhzcGxpdCxyYXRpbyk7XG4gICAgfTtcbiAgICAvLyBOYXNjb25kZSBsYSB2aXN0YSBzZWNvbmRhcmlhXG4gICAgR1VJLmhpZGVBc2lkZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgdmlld3BvcnQuVmlld3BvcnRTZXJ2aWNlLmhpZGVTZWNvbmRhcnlWaWV3KCk7XG4gICAgfVxuICAgIFxuICAgIC8qIGZpbmUgbWV0b2RpIHNwZWNpZmljaSAqL1xuICAgIFxuICAgIC8qIEZJTkUgREVGSU5JWklPTkUgSU5URVJGQUNDSUEgUFVCQkxJQ0EgKi9cbiAgfTtcbiAgXG59O1xuXG5BcHBsaWNhdGlvblRlbXBsYXRlLlBMQUNFSE9MREVSUyA9IFtcbiAgJ25hdmJhcicsXG4gICdzaWRlYmFyJyxcbiAgJ3ZpZXdwb3J0JyxcbiAgJ2Zsb2F0YmFyJ1xuXTtcblxuQXBwbGljYXRpb25UZW1wbGF0ZS5QbGFjZWhvbGRlcnNTZXJ2aWNlcyA9IHtcbiAgbmF2YmFyOiBudWxsLFxuICBzaWRlYmFyOiBzaWRlYmFyLlNpZGViYXJTZXJ2aWNlLFxuICB2aWV3cG9ydDogdmlld3BvcnQuVmlld3BvcnRTZXJ2aWNlLFxuICBmbG9hdGJhcjogc2lkZWJhci5GbG9hdGJhclNlcnZpY2UsXG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9ICBBcHBsaWNhdGlvblRlbXBsYXRlO1xuXG4iLCJ2YXIgaW5oZXJpdCA9IHJlcXVpcmUoJ3NkaycpLmNvcmUudXRpbHMuaW5oZXJpdDtcbnZhciBiYXNlID0gcmVxdWlyZSgnc2RrJykuY29yZS51dGlscy5iYXNlO1xudmFyIG1lcmdlID0gcmVxdWlyZSgnc2RrJykuY29yZS51dGlscy5tZXJnZTtcbnZhciBHM1dPYmplY3QgPSByZXF1aXJlKCdzZGsnKS5jb3JlLkczV09iamVjdDtcbnZhciBHVUkgPSByZXF1aXJlKCdzZGsnKS5ndWkuR1VJO1xuXG52YXIgVmlld3BvcnRTZXJ2aWNlID0gZnVuY3Rpb24oKXsgIFxuICB0aGlzLnN0YXRlID0ge1xuICAgIHByaW1hcnlWaWV3VGFnOiAnb25lJywgLy8gZGkgZGVmYXVsdCBsYSB2aXN0YSBwcmltYXJpYSDDqCBsYSBwcmltYVxuICAgIHNlY29uZGFyeVZpc2libGU6IGZhbHNlLFxuICAgIHJhdGlvRGVub206IDIsXG4gICAgc3BsaXQ6ICdoJyxcbiAgICB2aWV3U2l6ZXM6IHtcbiAgICAgIG9uZToge1xuICAgICAgICB3aWR0aDogMCxcbiAgICAgICAgaGVpZ2h0OiAwXG4gICAgICB9LFxuICAgICAgdHdvOiB7XG4gICAgICAgIHdpZHRoOiAwLFxuICAgICAgICBoZWlnaHQ6IDBcbiAgICAgIH1cbiAgICB9XG4gIH07XG4gIFxuICB0aGlzLnNldHRlcnMgPSB7XG4gICAgc2V0UHJpbWFyeUNvbXBvbmVudDogZnVuY3Rpb24oY29tcG9uZW50SWQpIHtcbiAgICAgIHZhciBjb21wb25lbnQgPSB0aGlzLl92aWV3c0J5Q29tcG9uZW50SWRbY29tcG9uZW50SWRdO1xuICAgICAgaWYoY29tcG9uZW50KSB7XG4gICAgICAgIHZhciB2aWV3VGFnID0gY29tcG9uZW50LnZpZXdUYWc7XG4gICAgICAgIHRoaXMuX3NldFByaW1hcnlWaWV3KHZpZXdUYWcpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICBcbiAgdGhpcy5fdmlld3NCeUNvbXBvbmVudElkID0ge307XG4gIHZhciBfY29tcG9uZW50cyA9IG51bGw7XG4gIFxuICAvKiBJTlRFUkZBQ0NJQSBQVUJCTElDQSAqL1xuICBcbiAgdGhpcy5hZGRDb21wb25lbnQgPSBmdW5jdGlvbihjb21wb25lbnQpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgLy8gbGEgdmlld3BvcnQgaGEgYWwgbWFzc2ltbyBkdWUgdmlzdGUsIG9nbnVuYSBjb250ZW50ZSBhbCBtYXNzaW1vIHVuIGNvbXBvbmVudGUuIFNlIHZpZW5lIHJpY2hpZXN0YSBsJ2FnZ2l1bnRhIGRpIHBpw7kgZGkgZHVlIGNvbXBvbmVudGkgcXVlc3RpIHZlbmdvbm8gaWdub3JhdGlcbiAgICB2YXIgc3BhY2VMZWZ0ID0gMiAtIF8ua2V5cyhzZWxmLl92aWV3c0J5Q29tcG9uZW50SWQpLmxlbmd0aDtcbiAgICBpZiAoc3BhY2VMZWZ0IDw9IDApIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgXG4gICAgLy8gaWwgcHJpbW8gY29tcG9uZW50ZSBhZCBlc3NlcmUgYWdnaXVudG8gYXZyw6AgaWwgdGFnICdvbmUnXG4gICAgdmFyIHZpZXdUYWcgPSAoc3BhY2VMZWZ0ID09IDIpID8gJ29uZScgOiAndHdvJztcblxuICAgIGNvbXBvbmVudC5tb3VudCgnI2czdy12aWV3LScrdmlld1RhZyx0cnVlKS5cbiAgICB0aGVuKGZ1bmN0aW9uKCl7XG4gICAgICB2YXIgY29tcG9uZW50SWQgPSBjb21wb25lbnQuZ2V0SWQoKTtcbiAgICAgIHNlbGYuX3ZpZXdzQnlDb21wb25lbnRJZFtjb21wb25lbnRJZF0gPSB7XG4gICAgICAgIHZpZXdUYWc6IHZpZXdUYWcsXG4gICAgICAgIGNvbXBvbmVudDogY29tcG9uZW50XG4gICAgICB9XG4gICAgfSk7XG4gIH07XG4gIFxuICB0aGlzLnNob3dTZWNvbmRhcnlWaWV3ID0gZnVuY3Rpb24oc3BsaXQscmF0aW9EZW5vbSkge1xuICAgIHRoaXMuc3RhdGUuc2Vjb25kYXJ5VmlzaWJsZSA9IHRydWU7XG4gICAgdGhpcy5zdGF0ZS5zcGxpdCA9IHNwbGl0ID8gc3BsaXQgOiB0aGlzLnN0YXRlLnNwbGl0O1xuICAgIHRoaXMuc3RhdGUucmF0aW9EZW5vbSA9IHJhdGlvRGVub20gPyByYXRpb0Rlbm9tIDogdGhpcy5zdGF0ZS5yYXRpb0Rlbm9tO1xuICAgIHRoaXMuX2xheW91dCgpO1xuICB9O1xuICBcbiAgdGhpcy5oaWRlU2Vjb25kYXJ5VmlldyA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuc3RhdGUuc2Vjb25kYXJ5VmlzaWJsZSA9IGZhbHNlO1xuICAgIHRoaXMuX2xheW91dCgpO1xuICB9O1xuICBcbiAgLyogRklORSBJTlRFUkZBQ0NJQSBQVUJCTElDQSAqL1xuICBcbiAgdGhpcy5fb3RoZXJUYWcgPSBmdW5jdGlvbih2aWV3VGFnKSB7XG4gICAgcmV0dXJuICh2aWV3VGFnID09ICdvbmUnKSA/ICd0d28nIDogJ29uZSc7XG4gIH07XG4gIFxuICAvLyBtZWNjYW5pc21vIHBlciBpbCByaWNhbGNvbG8gZGVsbGUgZGltZW5zaW9uaSBkZWxsYSB2aWV3cG9ydCBlIGRlaSBzdW9pIGNvbXBvbmVudGkgZmlnbGlcbiAgXG4gIHRoaXMuX3NldFByaW1hcnlWaWV3ID0gZnVuY3Rpb24odmlld1RhZykge1xuICAgIHRoaXMuc3RhdGUucHJpbWFyeVZpZXcgPSB2aWV3VGFnO1xuICAgIHRoaXMuX2xheW91dCgpO1xuICB9O1xuICBcbiAgdGhpcy5fcHJlcGFyZUxheW91dCA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICB2YXIgZHJhd2luZyA9IGZhbHNlO1xuICAgIHZhciByZXNpemVGaXJlZCA9IGZhbHNlO1xuICAgIFxuICAgIGZ1bmN0aW9uIHRyaWdnZXJSZXNpemUoKSB7XG4gICAgICByZXNpemVGaXJlZCA9IHRydWU7XG4gICAgICBkcmF3UmVzaXplKCk7XG4gICAgfSBcblxuICAgIGZ1bmN0aW9uIGRyYXdSZXNpemUoKSB7XG4gICAgICBpZiAocmVzaXplRmlyZWQgPT09IHRydWUpIHtcbiAgICAgICAgICByZXNpemVGaXJlZCA9IGZhbHNlO1xuICAgICAgICAgIGRyYXdpbmcgPSB0cnVlO1xuICAgICAgICAgIHNlbGYuX2xheW91dCgpO1xuICAgICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShkcmF3UmVzaXplKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZHJhd2luZyA9IGZhbHNlO1xuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICBHVUkub24oJ3JlYWR5JyxmdW5jdGlvbigpe1xuICAgICAgLy8gcHJpbW8gbGF5b3V0XG4gICAgICBzZWxmLl9sYXlvdXQoKTtcbiAgICAgIFxuICAgICAgLy8gcmVzaXplIHNjYXRlbmF0byBkYSBHVUlcbiAgICAgIEdVSS5vbignZ3VpcmVzaXplZCcsZnVuY3Rpb24oKXtcbiAgICAgICAgdHJpZ2dlclJlc2l6ZSgpO1xuICAgICAgfSk7XG4gICAgICBcbiAgICAgIC8vIHJlc2l6ZSBkZWxsYSB3aW5kb3dcbiAgICAgICQod2luZG93KS5yZXNpemUoZnVuY3Rpb24oKSB7XG4gICAgICAgIC8vIHNldCByZXNpemVkRmlyZWQgdG8gdHJ1ZSBhbmQgZXhlY3V0ZSBkcmF3UmVzaXplIGlmIGl0J3Mgbm90IGFscmVhZHkgcnVubmluZ1xuICAgICAgICBpZiAoZHJhd2luZyA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgIHRyaWdnZXJSZXNpemUoKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICBcbiAgICAgIC8vIHJlc2l6ZSBzdWwgcmlkaW1lbnNpb25hbWVudG8gZGVsbGEgc2lkZWJhclxuICAgICAgJCgnLm1haW4tc2lkZWJhcicpLm9uKCd3ZWJraXRUcmFuc2l0aW9uRW5kIHRyYW5zaXRpb25lbmQgbXNUcmFuc2l0aW9uRW5kIG9UcmFuc2l0aW9uRW5kJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICQodGhpcykudHJpZ2dlcigndHJhbnMtZW5kJyk7XG4gICAgICAgICAgdHJpZ2dlclJlc2l6ZSgpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH07XG4gIFxuICB0aGlzLl9jYWxjVmlld1NpemVzID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIHByaW1hcnlWaWV3VGFnID0gdGhpcy5zdGF0ZS5wcmltYXJ5Vmlld1RhZztcbiAgICB2YXIgc2VvbmRhcnlWaWV3VGFnID0gdGhpcy5fb3RoZXJUYWcocHJpbWFyeVZpZXdUYWcpO1xuICAgIFxuICAgIHZhciB2aWV3cG9ydFdpZHRoID0gdGhpcy5fdmlld3BvcnRXaWR0aCgpO1xuICAgIHZhciB2aWV3cG9ydEhlaWdodCA9IHRoaXMuX3ZpZXdwb3J0SGVpZ2h0KCk7XG4gICAgXG4gICAgdmFyIHByaW1hcnlXaWR0aCA9IHZpZXdwb3J0V2lkdGg7XG4gICAgdmFyIHByaW1hcnlIZWlnaHQgPSB2aWV3cG9ydEhlaWdodDtcbiAgICB2YXIgc2Vjb25kYXJ5V2lkdGggPSAwO1xuICAgIHZhciBzZWNvbmRhcnlIZWlnaHQgPSAwO1xuICAgIFxuICAgIGlmICh0aGlzLnN0YXRlLnNlY29uZGFyeVZpc2libGUpIHtcbiAgICAgIHZhciByYXRpbyA9IHRoaXMuc3RhdGUucmF0aW9EZW5vbTtcbiAgICAgIGlmIChyYXRpbyA+IDApIHtcbiAgICAgICAgaWYgKHRoaXMuc3RhdGUuc3BsaXQgPT0gJ2gnKSB7XG4gICAgICAgICAgc2Vjb25kYXJ5V2lkdGggPSB2aWV3cG9ydFdpZHRoIC8gcmF0aW87XG4gICAgICAgICAgc2Vjb25kYXJ5SGVpZ2h0ID0gdmlld3BvcnRIZWlnaHQ7XG4gICAgICAgICAgcHJpbWFyeVdpZHRoID0gdmlld3BvcnRXaWR0aCAtIHNlY29uZGFyeVdpZHRoO1xuICAgICAgICAgIHByaW1hcnlIZWlnaHQgPSB2aWV3cG9ydEhlaWdodDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICBzZWNvbmRhcnlXaWR0aCA9IHZpZXdwb3J0V2lkdGg7XG4gICAgICAgICAgc2Vjb25kYXJ5SGVpZ2h0ID0gdmlld3BvcnRIZWlnaHQgLyByYXRpbztcbiAgICAgICAgICBwcmltYXJ5V2lkdGggPSB2aWV3cG9ydFdpZHRoO1xuICAgICAgICAgIHByaW1hcnlIZWlnaHQgPSB2aWV3cG9ydEhlaWdodCAtIHNlY29uZGFyeUhlaWdodDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIHRoaXMuc3RhdGUuc2Vjb25kYXJ5VmlzaWJsZSA9IGZhbHNlO1xuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICB0aGlzLnN0YXRlLnZpZXdTaXplc1twcmltYXJ5Vmlld1RhZ10ud2lkdGggPSBwcmltYXJ5V2lkdGg7XG4gICAgdGhpcy5zdGF0ZS52aWV3U2l6ZXNbcHJpbWFyeVZpZXdUYWddLmhlaWdodCA9IHByaW1hcnlIZWlnaHQ7XG4gICAgdGhpcy5zdGF0ZS52aWV3U2l6ZXNbc2VvbmRhcnlWaWV3VGFnXS53aWR0aCA9IHNlY29uZGFyeVdpZHRoO1xuICAgIHRoaXMuc3RhdGUudmlld1NpemVzW3Nlb25kYXJ5Vmlld1RhZ10uaGVpZ2h0ID0gc2Vjb25kYXJ5SGVpZ2h0O1xuICB9O1xuICBcbiAgdGhpcy5fdmlld3BvcnRIZWlnaHQgPSBmdW5jdGlvbigpIHtcbiAgICAgIHZhciB0b3BIZWlnaHQgPSAkKFwiLm5hdmJhclwiKS5pbm5lckhlaWdodCgpO1xuICAgICAgcmV0dXJuICQod2luZG93KS5pbm5lckhlaWdodCgpIC0gdG9wSGVpZ2h0O1xuICAgIH07XG4gICAgXG4gIHRoaXMuX3ZpZXdwb3J0V2lkdGggPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgb2Zmc2V0ID0gJChcIi5tYWluLXNpZGViYXJcIikub2Zmc2V0KCkubGVmdDtcbiAgICB2YXIgd2lkdGggPSAkKFwiLm1haW4tc2lkZWJhclwiKS5pbm5lcldpZHRoKCk7XG4gICAgdmFyIHNpZGVCYXJTcGFjZSA9IHdpZHRoICsgb2Zmc2V0O1xuICAgIHJldHVybiAkKHdpbmRvdykuaW5uZXJXaWR0aCgpIC0gc2lkZUJhclNwYWNlO1xuICB9O1xuICBcbiAgdGhpcy5fbGF5b3V0ID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgaWYgKCFfY29tcG9uZW50cyl7XG4gICAgICAgIF9jb21wb25lbnRzID0gXy5tYXAodGhpcy5fdmlld3NCeUNvbXBvbmVudElkLGZ1bmN0aW9uKHZpZXcpeyByZXR1cm4gdmlldy5jb21wb25lbnQ7IH0pO1xuICAgICAgfVxuICAgICAgLy92YXIgd2lkdGggPSBzZWxmLl92aWV3cG9ydFdpZHRoKCk7XG4gICAgICAvL3ZhciBoZWlnaHQgPSBzZWxmLl92aWV3cG9ydEhlaWdodCgpO1xuICAgICAgdGhpcy5fY2FsY1ZpZXdTaXplcygpO1xuICAgICAgXy5mb3JFYWNoKF9jb21wb25lbnRzLGZ1bmN0aW9uKGNvbXBvbmVudCl7XG4gICAgICAgIC8vIHZpZW5lIGNoaWFtYXRvIGlsIG1ldG9kbyBwZXIgaWwgcmljYWNvbG8gZGVsbGUgZGltZW5zaW9uaSBuZWkgY29tcG9uZW50aSBmaWdsaVxuICAgICAgICB2YXIgdmlld1RhZyA9IHNlbGYuX3ZpZXdzQnlDb21wb25lbnRJZFtjb21wb25lbnQuZ2V0SWQoKV0udmlld1RhZztcbiAgICAgICAgdmFyIHdpZHRoID0gc2VsZi5zdGF0ZS52aWV3U2l6ZXNbdmlld1RhZ10ud2lkdGg7XG4gICAgICAgIHZhciBoZWlnaHQgPSBzZWxmLnN0YXRlLnZpZXdTaXplc1t2aWV3VGFnXS5oZWlnaHQ7XG4gICAgICAgIGNvbXBvbmVudC5sYXlvdXQod2lkdGgsaGVpZ2h0KTtcbiAgICAgIH0pXG4gICAgfVxuICBcbiAgdGhpcy5fcHJlcGFyZUxheW91dCgpO1xuICBiYXNlKHRoaXMpO1xufTtcbmluaGVyaXQoVmlld3BvcnRTZXJ2aWNlLCBHM1dPYmplY3QpO1xuXG52YXIgdmlld3BvcnRTZXJ2aWNlID0gbmV3IFZpZXdwb3J0U2VydmljZTtcblxudmFyIFZpZXdwb3J0Q29tcG9uZW50ID0gVnVlLmV4dGVuZCh7XG4gIHRlbXBsYXRlOiByZXF1aXJlKCcuLi9odG1sL3ZpZXdwb3J0Lmh0bWwnKSxcbiAgZGF0YTogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHN0YXRlOiB2aWV3cG9ydFNlcnZpY2Uuc3RhdGVcbiAgICB9XG4gIH1cbn0pXG5cbm1vZHVsZS5leHBvcnRzID0ge1xuICBWaWV3cG9ydFNlcnZpY2U6IHZpZXdwb3J0U2VydmljZSxcbiAgVmlld3BvcnRDb21wb25lbnQ6IFZpZXdwb3J0Q29tcG9uZW50XG59XG4iLCJ2YXIgaW5oZXJpdCA9IHJlcXVpcmUoJ2NvcmUvdXRpbHMvdXRpbHMnKS5pbmhlcml0O1xudmFyIGJhc2UgPSByZXF1aXJlKCdjb3JlL3V0aWxzL3V0aWxzJykuYmFzZTtcbnZhciBHM1dPYmplY3QgPSByZXF1aXJlKCdjb3JlL2czd29iamVjdCcpO1xudmFyIHJlamVjdCA9IHJlcXVpcmUoJ2NvcmUvdXRpbHMvdXRpbHMnKS5yZWplY3Q7XG5cbmZ1bmN0aW9uIEFwaVNlcnZpY2UoKXtcbiAgdGhpcy5fY29uZmlnID0gbnVsbDtcbiAgdGhpcy5fYmFzZVVybCA9IG51bGw7XG4gIHRoaXMuX2FwaVVybHMgPSB7fTtcbiAgXG4gIHRoaXMuaW5pdCA9IGZ1bmN0aW9uKGNvbmZpZykge1xuICAgIHRoaXMuX2NvbmZpZyA9IGNvbmZpZztcbiAgICB0aGlzLl9iYXNlVXJsID0gY29uZmlnLnVybHMuYXBpO1xuICAgIHRoaXMuX2FwaUVuZHBvaW50cyA9IGNvbmZpZy51cmxzLmFwaUVuZHBvaW50cztcbiAgfTtcbiAgXG4gIHZhciBob3dNYW55QXJlTG9hZGluZyA9IDA7XG4gIHRoaXMuX2luY3JlbWVudExvYWRlcnMgPSBmdW5jdGlvbigpe1xuICAgIGlmIChob3dNYW55QXJlTG9hZGluZyA9PSAwKXtcbiAgICAgIHRoaXMuZW1pdCgnYXBpcXVlcnlzdGFydCcpO1xuICAgIH1cbiAgICBob3dNYW55QXJlTG9hZGluZyArPSAxO1xuICB9O1xuICBcbiAgdGhpcy5fZGVjcmVtZW50TG9hZGVycyA9IGZ1bmN0aW9uKCl7XG4gICAgaG93TWFueUFyZUxvYWRpbmcgLT0gMTtcbiAgICBpZiAoaG93TWFueUFyZUxvYWRpbmcgPT0gMCl7XG4gICAgICB0aGlzLmVtaXQoJ2FwaXF1ZXJ5ZW5kJyk7XG4gICAgfVxuICB9O1xuICBcbiAgdGhpcy5nZXQgPSBmdW5jdGlvbihhcGksb3B0aW9ucykge1xuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICB2YXIgYXBpRW5kUG9pbnQgPSB0aGlzLl9hcGlFbmRwb2ludHNbYXBpXTtcbiAgICBpZiAoYXBpRW5kUG9pbnQpIHtcbiAgICAgIHZhciBjb21wbGV0ZVVybCA9IHRoaXMuX2Jhc2VVcmwgKyAnLycgKyBhcGlFbmRQb2ludDtcbiAgICAgIGlmIChvcHRpb25zLnJlcXVlc3QpIHtcbiAgICAgICAgIGNvbXBsZXRlVXJsID0gY29tcGxldGVVcmwgKyAnLycgKyBvcHRpb25zLnJlcXVlc3Q7XG4gICAgICB9XG4gICAgICB2YXIgcGFyYW1zID0gb3B0aW9ucy5wYXJhbXMgfHwge307XG4gICAgICBcbiAgICAgIHNlbGYuZW1pdChhcGkrJ3F1ZXJ5c3RhcnQnKTtcbiAgICAgIHRoaXMuX2luY3JlbWVudExvYWRlcnMoKTtcbiAgICAgIHJldHVybiAkLmdldChjb21wbGV0ZVVybCxwYXJhbXMpXG4gICAgICAuZG9uZShmdW5jdGlvbihyZXNwb25zZSl7XG4gICAgICAgIHNlbGYuZW1pdChhcGkrJ3F1ZXJ5ZW5kJyxyZXNwb25zZSk7XG4gICAgICAgIHJldHVybiByZXNwb25zZTtcbiAgICAgIH0pXG4gICAgICAuZmFpbChmdW5jdGlvbihlKXtcbiAgICAgICAgc2VsZi5lbWl0KGFwaSsncXVlcnlmYWlsJyxlKTtcbiAgICAgICAgcmV0dXJuIGU7XG4gICAgICB9KVxuICAgICAgLmFsd2F5cyhmdW5jdGlvbigpe1xuICAgICAgICBzZWxmLl9kZWNyZW1lbnRMb2FkZXJzKCk7XG4gICAgICB9KTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICByZXR1cm4gcmVqZWN0KCk7XG4gICAgfVxuICB9O1xuICBcbiAgYmFzZSh0aGlzKTtcbn1cbmluaGVyaXQoQXBpU2VydmljZSxHM1dPYmplY3QpO1xuXG5tb2R1bGUuZXhwb3J0cyA9IG5ldyBBcGlTZXJ2aWNlO1xuIiwidmFyIGluaGVyaXQgPSByZXF1aXJlKCdjb3JlL3V0aWxzL3V0aWxzJykuaW5oZXJpdDtcbnZhciBiYXNlID0gcmVxdWlyZSgnY29yZS91dGlscy91dGlscycpLmJhc2U7XG52YXIgRzNXT2JqZWN0ID0gcmVxdWlyZSgnY29yZS9nM3dvYmplY3QnKTtcbnZhciBBcGlTZXJ2aWNlID0gcmVxdWlyZSgnY29yZS9hcGlzZXJ2aWNlJyk7XG52YXIgUHJvamVjdHNSZWdpc3RyeSA9IHJlcXVpcmUoJ2NvcmUvcHJvamVjdC9wcm9qZWN0c3JlZ2lzdHJ5Jyk7XG52YXIgUGx1Z2luc1JlZ2lzdHJ5ID0gcmVxdWlyZSgnY29yZS9wbHVnaW4vcGx1Z2luc3JlZ2lzdHJ5Jyk7XG5cbnZhciBBcHBsaWNhdGlvblNlcnZpY2UgPSBmdW5jdGlvbigpe1xuICB0aGlzLnNlY3JldCA9IFwiIyMjIEczVyBDbGllbnQgQXBwbGljYXRpb24gU2VydmljZSAjIyNcIjtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICB0aGlzLmluaXRpYWxpemVkID0gZmFsc2U7XG4gIHRoaXMuX21vZGFsT3ZlcmxheSA9IG51bGw7XG4gIHRoaXMuY29uZmlnID0ge307XG5cbiAgLy8gY2hpYW1hIGlsIGNvc3RydXR0b3JlIGRpIEczV09iamVjdCAoY2hlIGluIHF1ZXN0byBtb21lbnRvIG5vbiBmYSBuaWVudGUpXG4gIGJhc2UodGhpcyk7XG4gIFxuICB0aGlzLmluaXQgPSBmdW5jdGlvbihjb25maWcpe1xuICAgIHRoaXMuX2NvbmZpZyA9IGNvbmZpZztcbiAgICB0aGlzLl9ib290c3RyYXAoKTtcbiAgfTtcbiAgXG4gIHRoaXMuZ2V0Q29uZmlnID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuX2NvbmZpZztcbiAgfTtcbiAgXG4gIHRoaXMuX2Jvb3RzdHJhcCA9IGZ1bmN0aW9uKCl7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIGlmICghdGhpcy5pbml0aWFsaXplZCl7XG4gICAgICAvL2luaXppYWxpenphIGxhIGNvbmZpZ3VyYXppb25lIGRlaSBzZXJ2aXppLiBPZ251bmdvIGNlcmNoZXLDoCBkYWwgY29uZmlnIHF1ZWxsbyBkaSBjdWkgYXZyw6AgYmlzb2dub1xuICAgICAgLy91bmEgdm9sdGEgZmluaXRhIGxhIGNvbmZpZ3VyYXppb25lIGVtZXR0byBsJ2V2ZW50byByZWFkeS4gQSBxdWVzdG8gcHVudG8gcG90csOyIGF2dmlhcmUgbCdpc3RhbnphIFZ1ZSBnbG9iYWxlXG4gICAgICAkLndoZW4oXG4gICAgICAgIEFwaVNlcnZpY2UuaW5pdCh0aGlzLl9jb25maWcpLFxuICAgICAgICBQcm9qZWN0c1JlZ2lzdHJ5LmluaXQodGhpcy5fY29uZmlnKVxuICAgICAgKS50aGVuKGZ1bmN0aW9uKCl7XG4gICAgICAgIFBsdWdpbnNSZWdpc3RyeS5pbml0KHtcbiAgICAgICAgICBwbHVzaW5nQmFzZVVybDogc2VsZi5fY29uZmlnLnVybHMuc3RhdGljdXJsLFxuICAgICAgICAgIHBsdWdpbnNDb25maWdzOiBzZWxmLl9jb25maWcucGx1Z2luc1xuICAgICAgICB9KTtcbiAgICAgICAgc2VsZi5lbWl0KCdyZWFkeScpO1xuICAgICAgICB0aGlzLmluaXRpYWxpemVkID0gdHJ1ZTtcbiAgICAgIH0pO1xuICAgIH07XG4gIH07XG59O1xuaW5oZXJpdChBcHBsaWNhdGlvblNlcnZpY2UsRzNXT2JqZWN0KTtcblxubW9kdWxlLmV4cG9ydHMgPSBuZXcgQXBwbGljYXRpb25TZXJ2aWNlO1xuIiwidmFyIGluaGVyaXQgPSByZXF1aXJlKCdjb3JlL3V0aWxzL3V0aWxzJykuaW5oZXJpdDtcbnZhciBHM1dPYmplY3QgPSByZXF1aXJlKCdjb3JlL2czd29iamVjdCcpO1xuXG5mdW5jdGlvbiBFZGl0QnVmZmVyKGVkaXRvcil7XG4gIHRoaXMuX2VkaXRvciA9IGVkaXRvcjtcbiAgXG4gIHRoaXMuX29yaWdWZWN0b3JMYXllciA9IG5ldyBvbC5sYXllci5WZWN0b3Ioe1xuICAgIHNvdXJjZTogbmV3IG9sLnNvdXJjZS5WZWN0b3IoKVxuICB9KTtcbiAgdGhpcy5fY2xvbmVMYXllcigpO1xuICBcbiAgLy9idWZmZXIgZGVsbGUgZ2VvbWV0cmllXG4gIHRoaXMuX2dlb21ldHJpZXNCdWZmZXIgPSB7fTtcbiAgXG4gIC8vIGJ1ZmZlciBkZWdsaSBhdHRyaWJ1dGlcbiAgdGhpcy5fYXR0cmlidXRlc0J1ZmZlciA9IHt9O1xuICBcbiAgLy8gYnVmZmVyIGRlZ2xpIGF0dHJpYnV0aSBkZWxsZSByZWxhemlvbmlcbiAgdGhpcy5fcmVsYXRpb25zQXR0cmlidXRlc0J1ZmZlciA9IHt9O1xufVxuaW5oZXJpdChFZGl0QnVmZmVyLEczV09iamVjdCk7XG5tb2R1bGUuZXhwb3J0cyA9IEVkaXRCdWZmZXI7XG5cbnZhciBwcm90byA9IEVkaXRCdWZmZXIucHJvdG90eXBlO1xuXG5wcm90by5jb21taXQgPSBmdW5jdGlvbigpe1xuICB2YXIgbmV3RmVhdHVyZXMgPSB0aGlzLl9lZGl0b3IuZ2V0RWRpdFZlY3RvckxheWVyKCkuZ2V0RmVhdHVyZXMoKTtcbiAgdGhpcy5fZWRpdG9yLmdldFZlY3RvckxheWVyKCkuYWRkRmVhdHVyZXMobmV3RmVhdHVyZXMpO1xuICB0aGlzLl9lZGl0b3IuZ2V0RWRpdFZlY3RvckxheWVyKCkuY2xlYXIoKTtcbiAgdGhpcy5fY2xlYXJCdWZmZXJzKCk7XG4gIHRoaXMuX2Nsb25lTGF5ZXIoKTtcbn07XG5cbnByb3RvLnVuZG9BbGwgPSBmdW5jdGlvbigpe1xuICB0aGlzLl9yZXNldFZlY3RvckxheWVyKCk7XG4gIHRoaXMuX2NsZWFyQnVmZmVycygpO1xufTtcblxucHJvdG8uZGVzdHJveSA9IGZ1bmN0aW9uKCl7XG4gIHRoaXMuX2NsZWFyQnVmZmVycygpO1xufTtcblxucHJvdG8uZ2VuZXJhdGVJZCA9IGZ1bmN0aW9uKCl7XG4gIHJldHVybiB0aGlzLl9lZGl0b3IuZ2VuZXJhdGVJZCgpO1xufTtcblxucHJvdG8uYWRkRmVhdHVyZSA9IGZ1bmN0aW9uKGZlYXR1cmUpe1xuICBpZighZmVhdHVyZS5nZXRJZCgpKXtcbiAgICBmZWF0dXJlLnNldElkKHRoaXMuZ2VuZXJhdGVJZCgpKTtcbiAgfVxuICB0aGlzLl9hZGRFZGl0VG9HZW9tZXRyeUJ1ZmZlcihmZWF0dXJlLCdhZGQnKTtcbiAgY29uc29sZS5sb2coXCJJbnNlcml0YSBudW92YSBmZWF0dXJlOiAoSUQ6IFwiK2ZlYXR1cmUuZ2V0SWQoKStcIiBcIitmZWF0dXJlLmdldEdlb21ldHJ5KCkuZ2V0Q29vcmRpbmF0ZXMoKStcIikgbmVsIGJ1ZmZlclwiKTtcbn07XG5cbnByb3RvLnVwZGF0ZUZlYXR1cmUgPSBmdW5jdGlvbihmZWF0dXJlKXtcbiAgdGhpcy5fYWRkRWRpdFRvR2VvbWV0cnlCdWZmZXIoZmVhdHVyZSwndXBkYXRlJyk7XG4gIGNvbnNvbGUubG9nKFwiTW9kaWZpY2F0YSBmZWF0dXJlOiAoSUQ6IFwiK2ZlYXR1cmUuZ2V0SWQoKStcIiBcIitmZWF0dXJlLmdldEdlb21ldHJ5KCkuZ2V0Q29vcmRpbmF0ZXMoKStcIikgbmVsIGJ1ZmZlclwiKTtcbn07XG5cbnByb3RvLmRlbGV0ZUZlYXR1cmUgPSBmdW5jdGlvbihmZWF0dXJlKXtcbiAgdGhpcy5fYWRkRWRpdFRvR2VvbWV0cnlCdWZmZXIoZmVhdHVyZSwnZGVsZXRlJyk7XG4gIGNvbnNvbGUubG9nKFwiUmltb3NzYSBmZWF0dXJlOiAoSUQ6IFwiK2ZlYXR1cmUuZ2V0SWQoKStcIiBcIitmZWF0dXJlLmdldEdlb21ldHJ5KCkuZ2V0Q29vcmRpbmF0ZXMoKStcIikgbmVsIGJ1ZmZlclwiKTtcbn07XG5cbnByb3RvLnVwZGF0ZUF0dHJpYnV0ZXMgPSBmdW5jdGlvbihmZWF0dXJlLHJlbGF0aW9uc0F0dHJpYnV0ZXMpe1xuICBpZighZmVhdHVyZS5nZXRJZCgpKXtcbiAgICBmZWF0dXJlLnNldElkKHRoaXMuZ2VuZXJhdGVJZCgpKTtcbiAgfVxuICB0aGlzLl9hZGRFZGl0VG9BdHRyaWJ1dGVzQnVmZmVyKGZlYXR1cmUscmVsYXRpb25zQXR0cmlidXRlcyk7XG4gIGNvbnNvbGUubG9nKFwiTW9kaWZpY2F0aSBhdHRyaWJ1dGkgZmVhdHVyZTogKElEOiBcIitmZWF0dXJlLmdldElkKCkrXCIpXCIpO1xufTtcblxucHJvdG8uZ2V0RmVhdHVyZUF0dHJpYnV0ZXMgPSBmdW5jdGlvbihmaWQpe1xuICBpZih0aGlzLl9hdHRyaWJ1dGVzQnVmZmVyW2ZpZF0pe1xuICAgIHJldHVybiB0aGlzLl9hdHRyaWJ1dGVzQnVmZmVyW2ZpZF0uc2xpY2UoLTEpWzBdO1xuICB9XG4gIHJldHVybiBudWxsO1xufTtcblxucHJvdG8uYXJlRmVhdHVyZUF0dHJpYnV0ZXNFZGl0ZWQgPSBmdW5jdGlvbihmaWQpe1xuICBpZiAodGhpcy5fYXR0cmlidXRlc0J1ZmZlcltmaWRdKXtcbiAgICByZXR1cm4gdGhpcy5fYXR0cmlidXRlc0J1ZmZlcltmaWRdLmxlbmd0aCA+IC0xO1xuICB9XG4gIHJldHVybiBmYWxzZTtcbn07XG5cbnByb3RvLmdldFJlbGF0aW9uc0F0dHJpYnV0ZXMgPSBmdW5jdGlvbihmaWQpe1xuICByZXR1cm4gdGhpcy5fcmVsYXRpb25zQXR0cmlidXRlc0J1ZmZlcltmaWRdLnNsaWNlKC0xKVswXTtcbn07XG5cbnByb3RvLmFyZUZlYXR1cmVSZWxhdGlvbnNFZGl0ZWQgPSBmdW5jdGlvbihmaWQpe1xuICBpZiAodGhpcy5fcmVsYXRpb25zQXR0cmlidXRlc0J1ZmZlcltmaWRdKXtcbiAgICByZXR1cm4gdGhpcy5fcmVsYXRpb25zQXR0cmlidXRlc0J1ZmZlcltmaWRdLmxlbmd0aCA+IC0xO1xuICB9XG4gIHJldHVybiBmYWxzZTtcbn07XG5cbnByb3RvLmNvbGxlY3RGZWF0dXJlSWRzID0gZnVuY3Rpb24oKXtcbiAgdmFyIGdlb21ldHJpZXNCdWZmZXJzID0gdGhpcy5fZ2VvbWV0cmllc0J1ZmZlcjtcbiAgdmFyIGF0dHJpYnV0ZXNCdWZmZXJzID0gdGhpcy5fYXR0cmlidXRlc0J1ZmZlcjtcbiAgXG4gIHZhciBtb2RpZmllZEZpZHMgPSBbXTtcblxuICBtb2RpZmllZEZpZHMgPSBfLmNvbmNhdChtb2RpZmllZEZpZHMsXy5rZXlzKGdlb21ldHJpZXNCdWZmZXJzKSk7XG4gIG1vZGlmaWVkRmlkcyA9IF8uY29uY2F0KG1vZGlmaWVkRmlkcyxfLmtleXMoYXR0cmlidXRlc0J1ZmZlcnMpKTtcbiAgXG4gIHJldHVybiBfLnVuaXEobW9kaWZpZWRGaWRzKTtcbn07XG5cbnByb3RvLmNvbGxlY3RGZWF0dXJlcyA9IGZ1bmN0aW9uKHN0YXRlLGFzR2VvSlNPTil7XG4gIHZhciBzZWxmID0gdGhpcztcbiAgdmFyIGdlb21ldHJpZXNCdWZmZXJzID0gdGhpcy5fZ2VvbWV0cmllc0J1ZmZlcjtcbiAgdmFyIGF0dHJpYnV0ZXNCdWZmZXJzID0gdGhpcy5fYXR0cmlidXRlc0J1ZmZlcjtcbiAgdmFyIGFzR2VvSlNPTiA9IGFzR2VvSlNPTiB8fCBmYWxzZTtcbiAgdmFyIEdlb0pTT05Gb3JtYXQgPSBuZXcgb2wuZm9ybWF0Lkdlb0pTT04oKTtcbiAgXG4gIHZhciBtb2RpZmllZEZpZHMgPSB0aGlzLmNvbGxlY3RGZWF0dXJlSWRzKCk7XG4gIFxuICB2YXIgbGF5ZXI7XG4gIGlmIChzdGF0ZSA9PSAnbmV3Jykge1xuICAgIGxheWVyID0gc2VsZi5fZWRpdG9yLmdldEVkaXRWZWN0b3JMYXllcigpO1xuICB9XG4gIGVsc2Uge1xuICAgIGxheWVyID0gc2VsZi5fZWRpdG9yLmdldFZlY3RvckxheWVyKCk7XG4gIH1cbiAgXG4gIHZhciBmZWF0dXJlcyA9IFtdO1xuICBfLmZvckVhY2gobW9kaWZpZWRGaWRzLGZ1bmN0aW9uKGZpZCl7XG4gICAgXG4gICAgdmFyIGZlYXR1cmUgPSBsYXllci5nZXRGZWF0dXJlQnlJZChmaWQpO1xuICAgIHZhciBpc05ldyA9IHNlbGYuX2lzTmV3RmVhdHVyZShmaWQpO1xuICAgIHZhciBhZGRlZEZlYXR1cmUgPSAoc3RhdGUgPT0gJ25ldycgJiYgaXNOZXcgJiYgZmVhdHVyZSk7XG4gICAgdmFyIHVwZGF0ZWRGZWF0dXJlID0gKHN0YXRlID09ICd1cGRhdGVkJyAmJiAhaXNOZXcgJiYgZmVhdHVyZSk7XG4gICAgdmFyIGRlbGV0ZWRGZWF0dXJlID0gKHN0YXRlID09ICdkZWxldGVkJyAmJiAhaXNOZXcgJiYgIWZlYXR1cmUpO1xuICAgIFxuICAgIGlmIChhZGRlZEZlYXR1cmUgfHwgdXBkYXRlZEZlYXR1cmUpe1xuICAgICAgaWYgKGFzR2VvSlNPTil7XG4gICAgICAgIGZlYXR1cmUgPSBHZW9KU09ORm9ybWF0LndyaXRlRmVhdHVyZU9iamVjdChmZWF0dXJlKTtcbiAgICAgIH1cbiAgICAgIGZlYXR1cmVzLnB1c2goZmVhdHVyZSk7XG4gICAgfVxuICAgIGVsc2UgaWYgKGRlbGV0ZWRGZWF0dXJlKSB7XG4gICAgICBmZWF0dXJlcy5wdXNoKGZpZCk7XG4gICAgfVxuICB9KTtcbiAgcmV0dXJuIGZlYXR1cmVzO1xufTtcblxucHJvdG8uY3JlYXRlRmVhdHVyZSA9IGZ1bmN0aW9uKGZpZCxnZW9tZXRyeSxhdHRyaWJ1dGVzKXtcbiAgdmFyIGZlYXR1cmUgPSBuZXcgb2wuRmVhdHVyZSgpO1xuICBmZWF0dXJlLnNldElkKGZpZCk7XG4gIGZlYXR1cmUuc2V0R2VvbWV0cnkoZ2VvbWV0cnkpO1xuICBmZWF0dXJlLnNldFByb3BlcnRpZXMoYXR0cmlidXRlcyk7XG4gIHJldHVybiBmZWF0dXJlO1xufTtcblxucHJvdG8uY29sbGVjdFJlbGF0aW9uc0F0dHJpYnV0ZXMgPSBmdW5jdGlvbigpe1xuICB2YXIgcmVsYXRpb25zQXR0cmlidXRlcyA9IHt9O1xuICBfLmZvckVhY2godGhpcy5fcmVsYXRpb25zQXR0cmlidXRlc0J1ZmZlcixmdW5jdGlvbihyZWxhdGlvbnNCdWZmZXIsZmlkKXtcbiAgICBsYXN0UmVsYXRpb25zQXR0cmlidXRlcyA9IHJlbGF0aW9uc0J1ZmZlcltyZWxhdGlvbnNCdWZmZXIubGVuZ3RoLTFdO1xuICAgIHJlbGF0aW9uc0F0dHJpYnV0ZXNbZmlkXSA9IGxhc3RSZWxhdGlvbnNBdHRyaWJ1dGVzO1xuICB9KVxuICByZXR1cm4gcmVsYXRpb25zQXR0cmlidXRlcztcbn07XG5cbnByb3RvLl9hZGRFZGl0VG9HZW9tZXRyeUJ1ZmZlciA9IGZ1bmN0aW9uKGZlYXR1cmUsb3BlcmF0aW9uKXtcbiAgdmFyIGdlb21ldHJpZXNCdWZmZXIgPSB0aGlzLl9nZW9tZXRyaWVzQnVmZmVyO1xuICBcbiAgdmFyIGlkID0gZmVhdHVyZS5nZXRJZCgpO1xuICB2YXIgZ2VvbWV0cnkgPSBmZWF0dXJlLmdldEdlb21ldHJ5KCk7XG4gIFxuICBpZiAob3BlcmF0aW9uID09ICdkZWxldGUnKXtcbiAgICAgIGdlb21ldHJ5ID0gbnVsbDtcbiAgICAgIHZhciBsYXllciA9IHRoaXMuX2lzTmV3RmVhdHVyZShpZCkgPyB0aGlzLl9lZGl0b3IuX2VkaXRWZWN0b3JMYXllciA6IHRoaXMuX2VkaXRvci5fdmVjdG9yTGF5ZXI7XG4gICAgICBsYXllci5nZXRTb3VyY2UoKS5yZW1vdmVGZWF0dXJlKGZlYXR1cmUpO1xuICB9IFxuICBcbiAgaWYgKCFfLmhhcyhnZW9tZXRyaWVzQnVmZmVyLGlkKSl7XG4gICAgZ2VvbWV0cmllc0J1ZmZlcltpZF0gPSBbXTtcbiAgfVxuICBnZW9tZXRyaWVzQnVmZmVyW2lkXS5wdXNoKGdlb21ldHJ5KTtcbiAgdGhpcy5fc2V0RGlydHkoKTtcbn07XG5cbnByb3RvLl9hZGRFZGl0VG9BdHRyaWJ1dGVzQnVmZmVyID0gZnVuY3Rpb24oZmVhdHVyZSxyZWxhdGlvbnNBdHRyaWJ1dGVzKXtcbiAgdmFyIGZpZCA9IGZlYXR1cmUuZ2V0SWQoKTtcbiAgdmFyIGF0dHJpYnV0ZXMgPSBmZWF0dXJlLmdldFByb3BlcnRpZXMoKTtcbiAgdmFyIGF0dHJpYnV0ZXNCdWZmZXIgPSB0aGlzLl9hdHRyaWJ1dGVzQnVmZmVyO1xuXG4gIGlmICghXy5oYXMoYXR0cmlidXRlc0J1ZmZlcixmaWQpKXtcbiAgICBhdHRyaWJ1dGVzQnVmZmVyW2ZpZF0gPSBbXTtcbiAgfVxuICBhdHRyaWJ1dGVzQnVmZmVyW2ZpZF0ucHVzaChhdHRyaWJ1dGVzKTtcbiAgXG4gIGlmIChyZWxhdGlvbnNBdHRyaWJ1dGVzKXtcbiAgICBpZiAoIV8uaGFzKHRoaXMuX3JlbGF0aW9uc0F0dHJpYnV0ZXNCdWZmZXIsZmlkKSl7XG4gICAgdGhpcy5fcmVsYXRpb25zQXR0cmlidXRlc0J1ZmZlcltmaWRdID0gW107XG4gIH1cbiAgICB0aGlzLl9yZWxhdGlvbnNBdHRyaWJ1dGVzQnVmZmVyW2ZpZF0ucHVzaChyZWxhdGlvbnNBdHRyaWJ1dGVzKTtcbiAgfVxuICB0aGlzLl9zZXREaXJ0eSgpO1xufTtcblxuLy8gZ3VhcmRvIHNlIMOoIHVuYSBmZWF0dXJlIGdpw6AgcHJlc2VudGUgbmVsIGJ1ZmZlciBkZWxsZSBudW92ZSBnZW9tZXRyaWVcbnByb3RvLl9pc05ld0ZlYXR1cmUgPSBmdW5jdGlvbihmaWQpe1xuICAvL3JldHVybiBpZC50b1N0cmluZygpLmluZGV4T2YoJ19uZXdfJykgPiAtMTtcbiAgcmV0dXJuIHRoaXMuX2VkaXRvci5pc05ld0ZlYXR1cmUoZmlkKTtcbn07XG5cbnByb3RvLl9zZXREaXJ0eSA9IGZ1bmN0aW9uKCl7XG4gIHRoaXMuX2VkaXRvci5fc2V0RGlydHkoKTtcbn07XG5cbnByb3RvLl9yZXNldFZlY3RvckxheWVyID0gZnVuY3Rpb24oKXtcbiAgdGhpcy5fZWRpdG9yLnZlY3RvTGF5ZXIgPSB0aGlzLl9vcmlnVmVjdG9yTGF5ZXI7XG4gIHRoaXMuX29yaWdWZWN0b3JMYXllci5nZXRTb3VyY2UoKS5jbGVhcigpO1xufTtcblxucHJvdG8uX2NsZWFyQnVmZmVycyA9IGZ1bmN0aW9uKCl7XG4gIHRoaXMuX2dlb21ldHJpZXNCdWZmZXIgPSB7fTtcbiAgdGhpcy5fYXR0cmlidXRlc0J1ZmZlciA9IHt9O1xuICB0aGlzLl9yZWxhdGlvbnNBdHRyaWJ1dGVzQnVmZmVyID0ge307XG4gIHRoaXMuX2VkaXRvci5fc2V0RGlydHkoZmFsc2UpO1xufTtcblxucHJvdG8uX2Nsb25lTGF5ZXIgPSBmdW5jdGlvbigpe1xuICB2YXIgY2xvbmVkRmVhdHVyZXMgPSBbXTtcbiAgdGhpcy5fZWRpdG9yLl92ZWN0b3JMYXllci5nZXRTb3VyY2UoKS5mb3JFYWNoRmVhdHVyZShmdW5jdGlvbihmZWF0dXJlKXtcbiAgICBjbG9uZWRGZWF0dXJlcy5wdXNoKGZlYXR1cmUuY2xvbmUoKSk7XG4gIH0sdGhpcyk7XG4gIHRoaXMuX29yaWdWZWN0b3JMYXllci5nZXRTb3VyY2UoKS5hZGRGZWF0dXJlcyhjbG9uZWRGZWF0dXJlcyk7XG59O1xuIiwidmFyIGluaGVyaXQgPSByZXF1aXJlKCdjb3JlL3V0aWxzL3V0aWxzJykuaW5oZXJpdDtcbnZhciBiYXNlID0gcmVxdWlyZSgnY29yZS91dGlscy91dGlscycpLmJhc2U7XG52YXIgcmVzb2x2ZSA9IHJlcXVpcmUoJ2NvcmUvdXRpbHMvdXRpbHMnKS5yZXNvbHZlO1xudmFyIHJlamVjdCA9IHJlcXVpcmUoJ2NvcmUvdXRpbHMvdXRpbHMnKS5yZWplY3Q7XG52YXIgRzNXT2JqZWN0ID0gcmVxdWlyZSgnY29yZS9nM3dvYmplY3QnKTtcbnZhciBHVUkgPSByZXF1aXJlKCdndWkvZ3VpJyk7XG52YXIgVmVjdG9yTGF5ZXIgPSByZXF1aXJlKCdjb3JlL2xheWVyL3ZlY3RvcmxheWVyJyk7XG5cbi8vdmFyIFNlcXVlbmNlciA9IHJlcXVpcmUoJy4vc3RlcHNlcXVlbmNlcicpO1xudmFyIEFkZEZlYXR1cmVUb29sID0gcmVxdWlyZSgnLi90b29scy9hZGRmZWF0dXJldG9vbCcpO1xudmFyIE1vdmVGZWF0dXJlVG9vbCA9IHJlcXVpcmUoJy4vdG9vbHMvbW92ZXBvaW50dG9vbCcpO1xudmFyIE1vZGlmeUZlYXR1cmVUb29sID0gcmVxdWlyZSgnLi90b29scy9tb2RpZnlmZWF0dXJldG9vbCcpO1xudmFyIERlbGV0ZUZlYXR1cmVUb29sID0gcmVxdWlyZSgnLi90b29scy9kZWxldGVmZWF0dXJldG9vbCcpO1xudmFyIFBpY2tGZWF0dXJlVG9vbCA9IHJlcXVpcmUoJy4vdG9vbHMvcGlja2ZlYXR1cmV0b29sJyk7XG52YXIgQ3V0TGluZVRvb2wgPSByZXF1aXJlKCcuL3Rvb2xzL2N1dGxpbmV0b29sJyk7XG52YXIgRWRpdEJ1ZmZlciA9IHJlcXVpcmUoJy4vZWRpdGJ1ZmZlcicpO1xuXG52YXIgRWRpdG9yR2VvbWV0cnlUeXBlcyA9IFtcbiAgJ1BvaW50JyxcbiAgLy8nTXVsdGlQb2ludCcsXG4gICdMaW5lU3RyaW5nJyxcbiAgJ011bHRpTGluZVN0cmluZycsXG4gIC8vJ1BvbHlnb24nLFxuICAvLydNdWx0aVBvbHlnb24nXG5dO1xuXG4vLyBFZGl0b3IgZGkgdmV0dG9yaSBwdW50dWFsaVxuZnVuY3Rpb24gRWRpdG9yKG9wdGlvbnMpe1xuICB0aGlzLl92ZWN0b3JMYXllciA9IG51bGw7XG4gIHRoaXMuX2VkaXRWZWN0b3JMYXllciA9IG51bGw7XG4gIHRoaXMuX2VkaXRCdWZmZXIgPSBudWxsO1xuICB0aGlzLl9hY3RpdmVUb29sID0gbnVsbDtcbiAgdGhpcy5fZGlydHkgPSBmYWxzZTtcbiAgdGhpcy5fbmV3UHJlZml4ID0gJ19uZXdfJztcbiAgXG4gIHRoaXMuX3dpdGhGZWF0dXJlTG9ja3MgPSBmYWxzZTtcbiAgdGhpcy5fZmVhdHVyZUxvY2tzID0gbnVsbDtcbiAgXG4gIHRoaXMuX3N0YXJ0ZWQgPSBmYWxzZTtcbiAgXG4gIHRoaXMuX3NldHRlcnNsaXN0ZW5lcnMgPSB7XG4gICAgICBiZWZvcmU6IHt9LFxuICAgICAgYWZ0ZXI6IHt9XG4gIH07XG4gIHRoaXMuX2dlb21ldHJ5dHlwZXMgPSBbXG4gICAgJ1BvaW50JyxcbiAgICAvLydNdWx0aVBvaW50JyxcbiAgICAnTGluZVN0cmluZycsXG4gICAgJ011bHRpTGluZVN0cmluZycsXG4gICAgLy8nUG9seWdvbicsXG4gICAgLy8nTXVsdGlQb2x5Z29uJ1xuICBdO1xuICBcbiAgLy8gZWxlbmNvIGRlaSB0b29sIGUgZGVsbGUgcmVsYXRpdmUgY2xhc3NpIHBlciB0aXBvIGRpIGdlb21ldHJpYSAoaW4gYmFzZSBhIHZlY3Rvci5nZW9tZXRyeXR5cGUpXG4gIHRoaXMuX3Rvb2xzRm9yR2VvbWV0cnlUeXBlcyA9IHtcbiAgICAgICdQb2ludCc6IHtcbiAgICAgICAgYWRkZmVhdHVyZTogQWRkRmVhdHVyZVRvb2wsXG4gICAgICAgIG1vdmVmZWF0dXJlOiBNb3ZlRmVhdHVyZVRvb2wsXG4gICAgICAgIGRlbGV0ZWZlYXR1cmU6IERlbGV0ZUZlYXR1cmVUb29sLFxuICAgICAgICBlZGl0YXR0cmlidXRlczogUGlja0ZlYXR1cmVUb29sXG4gICAgICB9LFxuICAgICAgJ0xpbmVTdHJpbmcnOiB7XG4gICAgICAgIGFkZGZlYXR1cmU6IEFkZEZlYXR1cmVUb29sLFxuICAgICAgICBtb2RpZnl2ZXJ0ZXg6IE1vZGlmeUZlYXR1cmVUb29sLFxuICAgICAgICBtb3ZlZmVhdHVyZTogTW92ZUZlYXR1cmVUb29sLFxuICAgICAgICBkZWxldGVmZWF0dXJlOiBEZWxldGVGZWF0dXJlVG9vbCxcbiAgICAgICAgZWRpdGF0dHJpYnV0ZXM6IFBpY2tGZWF0dXJlVG9vbCxcbiAgICAgICAgY3V0bGluZTogQ3V0TGluZVRvb2xcbiAgICAgIH1cbiAgfTtcbiAgXG4gIHRoaXMuX2FjdGl2ZVRvb2wgPSBuZXcgZnVuY3Rpb24oKXtcbiAgICB0aGlzLnR5cGUgPSBudWxsO1xuICAgIHRoaXMuaW5zdGFuY2UgPSBudWxsO1xuICAgIFxuICAgIHRoaXMuc2V0VG9vbCA9IGZ1bmN0aW9uKHR5cGUsaW5zdGFuY2Upe1xuICAgICAgdGhpcy50eXBlID0gdHlwZTtcbiAgICAgIHRoaXMuaW5zdGFuY2UgPSBpbnN0YW5jZTtcbiAgICB9O1xuICAgIFxuICAgIHRoaXMuZ2V0VHlwZSA9IGZ1bmN0aW9uKCl7XG4gICAgICByZXR1cm4gdGhpcy50eXBlO1xuICAgIH07XG4gICAgXG4gICAgdGhpcy5nZXRUb29sID0gZnVuY3Rpb24oKXtcbiAgICAgIHJldHVybiB0aGlzLmluc3RhbmNlO1xuICAgIH07XG4gICAgXG4gICAgdGhpcy5jbGVhciA9IGZ1bmN0aW9uKCl7XG4gICAgICB0aGlzLnR5cGUgPSBudWxsO1xuICAgICAgdGhpcy5pbnN0YW5jZSA9IG51bGw7XG4gICAgfTtcbiAgfVxuICBcbiAgdGhpcy5fdG9vbHMgPSB7fTtcbiAgXG4gIGJhc2UodGhpcyk7XG59XG5pbmhlcml0KEVkaXRvcixHM1dPYmplY3QpO1xubW9kdWxlLmV4cG9ydHMgPSBFZGl0b3I7XG5cbnZhciBwcm90byA9IEVkaXRvci5wcm90b3R5cGU7XG5cbi8vIGFzc29jaWEgbCdvZ2dldHRvIFZlY3RvckxheWVyIHN1IGN1aSBzaSB2dW9sZSBmYXJlIGwnZWRpdGluZ1xucHJvdG8uc2V0VmVjdG9yTGF5ZXIgPSBmdW5jdGlvbih2ZWN0b3JMYXllcil7XG4gIHZhciBnZW9tZXRyeXR5cGUgPSB2ZWN0b3JMYXllci5nZW9tZXRyeXR5cGU7XG4gIGlmICghZ2VvbWV0cnl0eXBlIHx8ICEgdGhpcy5faXNDb21wYXRpYmxlVHlwZShnZW9tZXRyeXR5cGUpKXtcbiAgICB0aHJvdyBFcnJvcihcIlZlY3RvciBnZW9tZXRyeSB0eXBlIFwiK2dlb21ldHJ5dHlwZStcIiBpcyBub3QgdmFsaWQgZm9yIGVkaXRpbmdcIik7XG4gIH1cbiAgdGhpcy5fc2V0VG9vbHNGb3JWZWN0b3JUeXBlKGdlb21ldHJ5dHlwZSk7XG4gIHRoaXMuX3ZlY3RvckxheWVyID0gdmVjdG9yTGF5ZXI7XG59O1xuXG4vLyBhdnZpYSBsYSBzZXNzaW9uZSBkaSBlZGl0YXppb25lIGNvbiB1biBkZXRlcm1pbmF0byB0b29sIChlcy4gYWRkZmVhdHVyZSlcbnByb3RvLnN0YXJ0ID0gZnVuY3Rpb24oKXtcbiAgLy8gVE9ETzogYWdnaXVuZ2VyZSBub3RpZmljYSBuZWwgY2FzbyBxdWVzdG8gaWYgbm9uIHNpIHZlcmlmaWNoaVxuICB2YXIgcmVzID0gZmFsc2U7XG4gIC8vIHNlIMOoIHN0YXRvIHNldHRhdG8gaWwgdmVjdG9yTGF5ZXJcbiAgaWYgKHRoaXMuX3ZlY3RvckxheWVyKXtcbiAgICAvLyBuZWwgY2FzbyBub24gc2lhIGdpw6AgYXZ2aWF0byBwcmltYSBsbyBzdG9wcG87XG4gICAgdGhpcy5zdG9wKCk7XG4gICAgXG4gICAgLy8gaXN0YW56aW8gbCdlZGl0VmVjdG9yTGF5ZXJcbiAgICB0aGlzLl9lZGl0VmVjdG9yTGF5ZXIgPSBuZXcgVmVjdG9yTGF5ZXIoe1xuICAgICAgbmFtZTogXCJlZGl0dmVjdG9yXCIsXG4gICAgICBnZW9tZXRyeXR5cGU6IHRoaXMuX3ZlY3RvckxheWVyLmdlb21ldHJ5dHlwZSxcbiAgICB9KVxuICAgIEdVSS5nZXRDb21wb25lbnQoJ21hcCcpLmdldFNlcnZpY2UoKS52aWV3ZXIubWFwLmFkZExheWVyKHRoaXMuX2VkaXRWZWN0b3JMYXllci5nZXRMYXllcigpKTtcbiAgICBcbiAgICAvLyBpc3RhbnppbyBsJ0VkaXRCdWZmZXJcbiAgICB0aGlzLl9lZGl0QnVmZmVyID0gbmV3IEVkaXRCdWZmZXIodGhpcyk7XG4gICAgdGhpcy5fc2V0U3RhcnRlZCh0cnVlKTtcbiAgICByZXMgPSB0cnVlO1xuICB9XG4gIHJldHVybiByZXM7XG59O1xuXG4vLyB0ZXJtaW5hIGwnZWRpdGF6aW9uZVxucHJvdG8uc3RvcCA9IGZ1bmN0aW9uKCl7XG4gIGlmICh0aGlzLmlzU3RhcnRlZCgpKXtcbiAgICBpZiAodGhpcy5zdG9wVG9vbCgpKSB7XG4gICAgICB0aGlzLl9lZGl0QnVmZmVyLmRlc3Ryb3koKTtcbiAgICAgIHRoaXMuX2VkaXRCdWZmZXIgPSBudWxsO1xuICAgICAgdGhpcy5yZW1vdmVBbGxMaXN0ZW5lcnMoKTtcbiAgICAgIEdVSS5nZXRDb21wb25lbnQoJ21hcCcpLmdldFNlcnZpY2UoKS52aWV3ZXIucmVtb3ZlTGF5ZXJCeU5hbWUodGhpcy5fZWRpdFZlY3RvckxheWVyLm5hbWUpO1xuICAgICAgdGhpcy5fc2V0U3RhcnRlZChmYWxzZSk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIHJldHVybiB0cnVlO1xufTtcblxucHJvdG8uc2V0VG9vbCA9IGZ1bmN0aW9uKHRvb2xUeXBlLG9wdGlvbnMpe1xuICBpZiAoIXRoaXMuc3RvcFRvb2woKSl7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIHZhciB0b29sQ2xhc3MgPSB0aGlzLl90b29sc1t0b29sVHlwZV07XG4gIFxuICAvLyBzZSBlc2lzdGUgaWwgdG9vbCByaWNoaWVzdG9cbiAgaWYgKHRvb2xDbGFzcyApe1xuICAgIHZhciB0b29sSW5zdGFuY2UgPSBuZXcgdG9vbENsYXNzKHRoaXMsb3B0aW9ucyk7XG4gICAgdGhpcy5fYWN0aXZlVG9vbC5zZXRUb29sKHRvb2xUeXBlLHRvb2xJbnN0YW5jZSk7XG4gICAgdGhpcy5fc2V0VG9vbFNldHRlcnNMaXN0ZW5lcnModG9vbEluc3RhbmNlLHRoaXMuX3NldHRlcnNsaXN0ZW5lcnMpO1xuICAgIHRvb2xJbnN0YW5jZS5ydW4oKTtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxufTtcblxucHJvdG8uc3RvcFRvb2wgPSBmdW5jdGlvbigpe1xuICBpZiAodGhpcy5fYWN0aXZlVG9vbC5pbnN0YW5jZSAmJiAhdGhpcy5fYWN0aXZlVG9vbC5pbnN0YW5jZS5zdG9wKCkpe1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICB0aGlzLl9hY3RpdmVUb29sLmNsZWFyKCk7XG4gIHJldHVybiB0cnVlO1xufTtcblxucHJvdG8uZ2V0QWN0aXZlVG9vbCA9IGZ1bmN0aW9uKCl7XG4gIHJldHVybiB0aGlzLl9hY3RpdmVUb29sO1xufTtcblxucHJvdG8uaXNTdGFydGVkID0gZnVuY3Rpb24oKXtcbiAgcmV0dXJuIHRoaXMuX3N0YXJ0ZWQ7XG59O1xuXG5wcm90by5oYXNBY3RpdmVUb29sID0gZnVuY3Rpb24oKXtcbiAgcmV0dXJuICFfLmlzTnVsbCh0aGlzLl9hY3RpdmVUb29sLmluc3RhbmNlKTtcbn07XG5cbnByb3RvLmlzVG9vbEFjdGl2ZSA9IGZ1bmN0aW9uKHRvb2xUeXBlKXtcbiAgIGlmICh0aGlzLl9hY3RpdmVUb29sLnRvb2xUeXBlKXtcbiAgICByZXR1cm4gdGhpcy5fYWN0aXZlVG9vbC50b29sVHlwZSA9PSB0b29sVHlwZTtcbiAgIH07XG4gICByZXR1cm4gZmFsc2U7XG59O1xuXG5wcm90by5nZW5lcmF0ZUlkID0gZnVuY3Rpb24oKXtcbiAgcmV0dXJuIHRoaXMuX2VkaXRCdWZmZXIuZ2VuZXJhdGVJZCgpO1xufTtcblxucHJvdG8uY29tbWl0ID0gZnVuY3Rpb24obmV3RmVhdHVyZXMpe1xuICB0aGlzLl9lZGl0QnVmZmVyLmNvbW1pdChuZXdGZWF0dXJlcyk7XG59O1xuXG5wcm90by51bmRvQWxsID0gZnVuY3Rpb24oKXtcbiAgdGhpcy5fZWRpdEJ1ZmZlci51bmRvQWxsKCk7XG59O1xuXG5wcm90by5zZXRGZWF0dXJlTG9ja3MgPSBmdW5jdGlvbihmZWF0dXJlTG9ja3Mpe1xuICB0aGlzLl93aXRoRmVhdHVyZUxvY2tzID0gdHJ1ZTtcbiAgdGhpcy5fZmVhdHVyZUxvY2tzID0gZmVhdHVyZUxvY2tzO1xufTtcblxucHJvdG8uZ2V0RmVhdHVyZUxvY2tzID0gZnVuY3Rpb24oZmVhdHVyZUxvY2tzKXtcbiAgcmV0dXJuIHRoaXMuX2ZlYXR1cmVMb2Nrcztcbn07XG5cbnByb3RvLmdldEZlYXR1cmVMb2NrSWRzID0gZnVuY3Rpb24oKXtcbiAgcmV0dXJuIF8ubWFwKHRoaXMuX2ZlYXR1cmVMb2NrcyxmdW5jdGlvbihmZWF0dXJlbG9jayl7XG4gICAgcmV0dXJuIGZlYXR1cmVsb2NrLmxvY2tpZDtcbiAgfSk7XG59O1xuXG5wcm90by5nZXRGZWF0dXJlTG9ja3NMb2NrSWRzID0gZnVuY3Rpb24oZmVhdHVyZUxvY2tzKXtcbiAgdmFyIGZlYXR1cmVMb2NrcyA9IGZlYXR1cmVMb2NrcyB8fCB0aGlzLl9mZWF0dXJlTG9ja3M7XG4gIHJldHVybiBfLm1hcChmZWF0dXJlTG9ja3MsZnVuY3Rpb24oZmVhdHVyZWxvY2spe1xuICAgIHJldHVybiBmZWF0dXJlbG9jay5sb2NraWQ7XG4gIH0pO1xufTtcblxucHJvdG8uZ2V0RmVhdHVyZUxvY2tzRmVhdHVyZUlkcyA9IGZ1bmN0aW9uKGZlYXR1cmVMb2Nrcyl7XG4gIHZhciBmZWF0dXJlTG9ja3MgPSBmZWF0dXJlTG9ja3MgfHwgdGhpcy5fZmVhdHVyZUxvY2tzO1xuICByZXR1cm4gXy5tYXAoZmVhdHVyZUxvY2tzLGZ1bmN0aW9uKGZlYXR1cmVsb2NrKXtcbiAgICByZXR1cm4gZmVhdHVyZWxvY2suZmVhdHVyZWlkO1xuICB9KTtcbn07XG5cbnByb3RvLmdldEZlYXR1cmVMb2NrSWRzRm9yRmVhdHVyZUlkcyA9IGZ1bmN0aW9uKGZpZHMpe1xuICB2YXIgZmVhdHVyZWxvY2tzRm9yRmlkcyA9IF8uZmlsdGVyKHRoaXMuX2ZlYXR1cmVMb2NrcyxmdW5jdGlvbihmZWF0dXJlbG9jayl7XG4gICAgcmV0dXJuIF8uaW5jbHVkZXMoZmlkcyxmZWF0dXJlbG9jay5mZWF0dXJlaWQpO1xuICB9KTtcbiAgXG4gIHJldHVybiB0aGlzLmdldEZlYXR1cmVMb2Nrc0xvY2tJZHMoZmVhdHVyZWxvY2tzRm9yRmlkcyk7XG59O1xuXG5wcm90by5nZXRFZGl0ZWRGZWF0dXJlcyA9IGZ1bmN0aW9uKCl7XG4gIHZhciBtb2RpZmllZEZpZHMgPSB0aGlzLl9lZGl0QnVmZmVyLmNvbGxlY3RGZWF0dXJlSWRzKCk7XG4gIHZhciBsb2NrSWRzID0gdGhpcy5nZXRGZWF0dXJlTG9ja0lkc0ZvckZlYXR1cmVJZHMobW9kaWZpZWRGaWRzKTtcbiAgcmV0dXJuIHtcbiAgICBhZGQ6IHRoaXMuX2VkaXRCdWZmZXIuY29sbGVjdEZlYXR1cmVzKCduZXcnLHRydWUpLFxuICAgIHVwZGF0ZTogdGhpcy5fZWRpdEJ1ZmZlci5jb2xsZWN0RmVhdHVyZXMoJ3VwZGF0ZWQnLHRydWUpLFxuICAgIGRlbGV0ZTogdGhpcy5fZWRpdEJ1ZmZlci5jb2xsZWN0RmVhdHVyZXMoJ2RlbGV0ZWQnLHRydWUpLFxuICAgIHJlbGF0aW9uc2F0dHJpYnV0ZXM6IHRoaXMuX2VkaXRCdWZmZXIuY29sbGVjdFJlbGF0aW9uc0F0dHJpYnV0ZXMoKSxcbiAgICBsb2NraWRzOiBsb2NrSWRzXG4gIH1cbn07XG5cbnByb3RvLnNldEZpZWxkc1dpdGhBdHRyaWJ1dGVzID0gZnVuY3Rpb24oZmVhdHVyZSxmaWVsZHMscmVsYXRpb25zKXtcbiAgdmFyIGF0dHJpYnV0ZXMgPSB7fTtcbiAgXy5mb3JFYWNoKGZpZWxkcyxmdW5jdGlvbihmaWVsZCl7XG4gICAgYXR0cmlidXRlc1tmaWVsZC5uYW1lXSA9IGZpZWxkLnZhbHVlO1xuICB9KTtcbiAgXG4gIHZhciByZWxhdGlvbnNBdHRyaWJ1dGVzID0gbnVsbDtcbiAgaWYgKHJlbGF0aW9ucyl7XG4gICAgdmFyIHJlbGF0aW9uc0F0dHJpYnV0ZXMgPSB7fTtcbiAgICBfLmZvckVhY2gocmVsYXRpb25zLGZ1bmN0aW9uKHJlbGF0aW9uLHJlbGF0aW9uS2V5KXtcbiAgICAgIHZhciBhdHRyaWJ1dGVzID0ge307XG4gICAgICBfLmZvckVhY2gocmVsYXRpb24uZmllbGRzLGZ1bmN0aW9uKGZpZWxkKXtcbiAgICAgICAgYXR0cmlidXRlc1tmaWVsZC5uYW1lXSA9IGZpZWxkLnZhbHVlO1xuICAgICAgfSk7XG4gICAgICByZWxhdGlvbnNBdHRyaWJ1dGVzW3JlbGF0aW9uS2V5XSA9IGF0dHJpYnV0ZXM7XG4gICAgfSk7XG4gIH1cbiAgZmVhdHVyZS5zZXRQcm9wZXJ0aWVzKGF0dHJpYnV0ZXMpO1xuICB0aGlzLl9lZGl0QnVmZmVyLnVwZGF0ZUF0dHJpYnV0ZXMoZmVhdHVyZSxyZWxhdGlvbnNBdHRyaWJ1dGVzKTtcbn07XG5cbnByb3RvLnNldEF0dHJpYnV0ZXMgPSBmdW5jdGlvbihmZWF0dXJlLGF0dHJpYnV0ZXMpe1xuICBmZWF0dXJlLnNldFByb3BlcnRpZXMoYXR0cmlidXRlcyk7XG4gIHRoaXMuX2VkaXRCdWZmZXIudXBkYXRlQXR0cmlidXRlcyhmZWF0dXJlKTtcbn07XG5cbnByb3RvLmdldFJlbGF0aW9uc1dpdGhBdHRyaWJ1dGVzID0gZnVuY3Rpb24oZmVhdHVyZSl7XG4gIHZhciBmaWQgPSBmZWF0dXJlLmdldElkKCk7XG4gIGlmICh0aGlzLl92ZWN0b3JMYXllci5oYXNSZWxhdGlvbnMoKSl7XG4gICAgdmFyIGZpZWxkc1Byb21pc2U7XG4gICAgLy8gc2Ugbm9uIGhhIGZpZCB2dW9sIGRpcmUgY2hlIMOoIG51b3ZvIGUgc2VuemEgYXR0cmlidXRpLCBxdWluZGkgcHJlbmRvIGkgZmllbGRzIHZ1b3RpXG4gICAgaWYgKCFmaWQpe1xuICAgICAgZmllbGRzUHJvbWlzZSA9IHRoaXMuX3ZlY3RvckxheWVyLmdldFJlbGF0aW9uc1dpdGhBdHRyaWJ1dGVzKCk7XG4gICAgfVxuICAgIC8vIHNlIHBlciBjYXNvIGhhIHVuIGZpZCBtYSDDqCB1biB2ZXR0b3JpYWxlIG51b3ZvXG4gICAgZWxzZSBpZiAoIXRoaXMuX3ZlY3RvckxheWVyLmdldEZlYXR1cmVCeUlkKGZpZCkpe1xuICAgICAgLy8gc2UgcXVlc3RhIGZlYXR1cmUsIGFuY29yYSBub24gcHJlc2VudGUgbmVsIHZlY3RvckxheWVyLCBoYSBjb211bnF1ZSBpIHZhbG9yaSBkZWxsZSBGS3MgcG9wb2xhdGUsIGFsbG9yYSBsZSBlc3RyYWdnb1xuICAgICAgaWYgKHRoaXMuX3ZlY3RvckxheWVyLmZlYXR1cmVIYXNSZWxhdGlvbnNGa3NXaXRoVmFsdWVzKGZlYXR1cmUpKXtcbiAgICAgICAgdmFyIGZrcyA9IHRoaXMuX3ZlY3RvckxheWVyLmdldFJlbGF0aW9uc0Zrc1dpdGhWYWx1ZXNGb3JGZWF0dXJlKGZlYXR1cmUpO1xuICAgICAgICBmaWVsZHNQcm9taXNlID0gdGhpcy5fdmVjdG9yTGF5ZXIuZ2V0UmVsYXRpb25zV2l0aEF0dHJpYnV0ZXNGcm9tRmtzKGZrcyk7XG4gICAgICB9XG4gICAgICAvLyBhbHRyaW1lbnRpIHByZW5kbyBpIGZpZWxkcyB2dW90aVxuICAgICAgZWxzZSB7XG4gICAgICAgIGZpZWxkc1Byb21pc2UgPSB0aGlzLl92ZWN0b3JMYXllci5nZXRSZWxhdGlvbnNXaXRoQXR0cmlidXRlcygpO1xuICAgICAgfVxuICAgIH1cbiAgICAvLyBzZSBpbnZlY2Ugw6ggdW4gdmV0dG9yaWFsZSBwcmVlc2lzdGVudGUgY29udHJvbGxvIGludGFudG8gc2UgaGEgZGF0aSBkZWxsZSByZWxhemlvbmkgZ2nDoCBlZGl0YXRpXG4gICAgZWxzZSB7ICAgIFxuICAgICAgdmFyIGhhc0VkaXRzID0gdGhpcy5fZWRpdEJ1ZmZlci5hcmVGZWF0dXJlUmVsYXRpb25zRWRpdGVkKGZpZCk7XG4gICAgICBpZiAoaGFzRWRpdHMpe1xuICAgICAgICB2YXIgcmVsYXRpb25zID0gdGhpcy5fdmVjdG9yTGF5ZXIuZ2V0UmVsYXRpb25zKCk7XG4gICAgICAgIHZhciByZWxhdGlvbnNBdHRyaWJ1dGVzID0gdGhpcy5fZWRpdEJ1ZmZlci5nZXRSZWxhdGlvbnNBdHRyaWJ1dGVzKGZpZCk7XG4gICAgICAgIF8uZm9yRWFjaChyZWxhdGlvbnNBdHRyaWJ1dGVzLGZ1bmN0aW9uKHJlbGF0aW9uLHJlbGF0aW9uS2V5KXtcbiAgICAgICAgICBfLmZvckVhY2gocmVsYXRpb25zW3JlbGF0aW9uS2V5XS5maWVsZHMsZnVuY3Rpb24oZmllbGQpe1xuICAgICAgICAgICAgZmllbGQudmFsdWUgPSByZWxhdGlvbnNBdHRyaWJ1dGVzW3JlbGF0aW9uS2V5XVtmaWVsZC5uYW1lXTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIFxuICAgICAgICBmaWVsZHNQcm9taXNlID0gcmVzb2x2ZShyZWxhdGlvbnMpO1xuICAgICAgfVxuICAgICAgLy8gc2Ugbm9uIGNlIGxpIGhhIHZ1b2wgZGlyZSBjaGUgZGV2byBjYXJpY2FyZSBpIGRhdGkgZGVsbGUgcmVsYXppb25pIGRhIHJlbW90b1xuICAgICAgZWxzZSB7XG4gICAgICAgIGZpZWxkc1Byb21pc2UgPSB0aGlzLl92ZWN0b3JMYXllci5nZXRSZWxhdGlvbnNXaXRoQXR0cmlidXRlcyhmaWQpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICBlbHNlIHtcbiAgICBmaWVsZHNQcm9taXNlID0gcmVzb2x2ZShudWxsKTtcbiAgfVxuICByZXR1cm4gZmllbGRzUHJvbWlzZTtcbn07XG5cbnByb3RvLmdldEZpZWxkID0gZnVuY3Rpb24obmFtZSxmaWVsZHMpe1xuICB2YXIgZmllbGRzID0gZmllbGRzIHx8IHRoaXMuZ2V0VmVjdG9yTGF5ZXIoKS5nZXRGaWVsZHNXaXRoQXR0cmlidXRlcygpO1xuICB2YXIgZmllbGQgPSBudWxsO1xuICBfLmZvckVhY2goZmllbGRzLGZ1bmN0aW9uKGYpe1xuICAgIGlmIChmLm5hbWUgPT0gbmFtZSl7XG4gICAgICBmaWVsZCA9IGY7XG4gICAgfVxuICB9KVxuICByZXR1cm4gZmllbGQ7XG59O1xuXG5wcm90by5pc0RpcnR5ID0gZnVuY3Rpb24oKXtcbiAgcmV0dXJuIHRoaXMuX2RpcnR5O1xufTtcblxucHJvdG8ub25hZnRlciA9IGZ1bmN0aW9uKHNldHRlcixsaXN0ZW5lcil7XG4gIHRoaXMuX29uYWZ0ZXJ0b29sYWN0aW9uKHNldHRlcixsaXN0ZW5lcik7XG59O1xuXG4vLyBwZXJtZXR0ZSBkaSBpbnNlcmlyZSB1biBzZXR0ZXIgbGlzdGVuZXIgc2luY3Jvbm8gcHJpbWEgY2hlIHZlbmdhIGVmZmV0dHVhdGEgdW5hIG9wZXJhemlvbmUgZGEgdW4gdG9vbCAoZXMuIGFkZGZlYXR1cmUpXG5wcm90by5vbmJlZm9yZSA9IGZ1bmN0aW9uKHNldHRlcixsaXN0ZW5lcil7XG4gIHRoaXMuX29uYmVmb3JldG9vbGFjdGlvbihzZXR0ZXIsbGlzdGVuZXIsZmFsc2UpO1xufTtcblxuLy8gY29tZSBvbmJlZm9yZSgpIG1hIHBlciBsaXN0ZW5lciBhc2luY3JvbmlcbnByb3RvLm9uYmVmb3JlYXN5bmMgPSBmdW5jdGlvbihzZXR0ZXIsbGlzdGVuZXIpe1xuICB0aGlzLl9vbmJlZm9yZXRvb2xhY3Rpb24oc2V0dGVyLGxpc3RlbmVyLHRydWUpO1xufTtcblxucHJvdG8uYWRkRmVhdHVyZSA9IGZ1bmN0aW9uKGZlYXR1cmUpe1xuICB0aGlzLl9lZGl0QnVmZmVyLmFkZEZlYXR1cmUoZmVhdHVyZSk7XG59O1xuXG5wcm90by51cGRhdGVGZWF0dXJlID0gZnVuY3Rpb24oZmVhdHVyZSl7XG4gIHRoaXMuX2VkaXRCdWZmZXIudXBkYXRlRmVhdHVyZShmZWF0dXJlKTtcbn07XG5cbnByb3RvLmRlbGV0ZUZlYXR1cmUgPSBmdW5jdGlvbihmZWF0dXJlKXtcbiAgdGhpcy5fZWRpdEJ1ZmZlci5kZWxldGVGZWF0dXJlKGZlYXR1cmUpO1xufTtcblxucHJvdG8uZ2V0VmVjdG9yTGF5ZXIgPSBmdW5jdGlvbigpe1xuICByZXR1cm4gdGhpcy5fdmVjdG9yTGF5ZXI7XG59O1xuXG5wcm90by5nZXRFZGl0VmVjdG9yTGF5ZXIgPSBmdW5jdGlvbigpe1xuICByZXR1cm4gdGhpcy5fZWRpdFZlY3RvckxheWVyO1xufTtcblxucHJvdG8uZ2VuZXJhdGVJZCA9IGZ1bmN0aW9uKCl7XG4gIHJldHVybiB0aGlzLl9uZXdQcmVmaXgrRGF0ZS5ub3coKTtcbn07XG5cbnByb3RvLmlzTmV3RmVhdHVyZSA9IGZ1bmN0aW9uKGZpZCl7XG4gIGlmIChmaWQpIHtcbiAgICByZXR1cm4gZmlkLnRvU3RyaW5nKCkuaW5kZXhPZih0aGlzLl9uZXdQcmVmaXgpID09IDA7XG4gIH1cbiAgcmV0dXJuIHRydWU7XG59O1xuXG4vKnByb3RvLmlzTmV3RmVhdHVyZSA9IGZ1bmN0aW9uKGZpZCl7XG4gIGlmIChmaWQpIHtcbiAgICBpZighdGhpcy5nZXRWZWN0b3JMYXllcigpLmdldEZlYXR1cmVCeUlkKGZpZCkpe1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICBlbHNlIHtcbiAgICByZXR1cm4gdHJ1ZVxuICB9XG59OyovXG5cbnByb3RvLl9pc0NvbXBhdGlibGVUeXBlID0gZnVuY3Rpb24oZ2VvbWV0cnl0eXBlKXtcbiAgcmV0dXJuIHRoaXMuX2dlb21ldHJ5dHlwZXMuaW5kZXhPZihnZW9tZXRyeXR5cGUpID4gLTE7XG59O1xuXG5wcm90by5fc2V0VG9vbHNGb3JWZWN0b3JUeXBlID0gZnVuY3Rpb24oZ2VvbWV0cnl0eXBlKXtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICB2YXIgdG9vbHMgPSB0aGlzLl90b29sc0Zvckdlb21ldHJ5VHlwZXNbZ2VvbWV0cnl0eXBlXTtcbiAgXy5mb3JFYWNoKHRvb2xzLGZ1bmN0aW9uKHRvb2xDbGFzcyx0b29sKXtcbiAgICBzZWxmLl90b29sc1t0b29sXSA9IHRvb2xDbGFzcztcbiAgfSlcbn07XG5cbnByb3RvLl9vbmFmdGVydG9vbGFjdGlvbiA9IGZ1bmN0aW9uKHNldHRlcixsaXN0ZW5lcil7XG4gIGlmICghXy5nZXQodGhpcy5fc2V0dGVyc2xpc3RlbmVycy5hZnRlcixzZXR0ZXIpKXtcbiAgICB0aGlzLl9zZXR0ZXJzbGlzdGVuZXJzLmFmdGVyW3NldHRlcl0gPSBbXTtcbiAgfVxuICB0aGlzLl9zZXR0ZXJzbGlzdGVuZXJzLmFmdGVyW3NldHRlcl0ucHVzaCh7XG4gICAgZm5jOiBsaXN0ZW5lclxuICB9KTtcbn1cblxucHJvdG8uX29uYmVmb3JldG9vbGFjdGlvbiA9IGZ1bmN0aW9uKHNldHRlcixsaXN0ZW5lcixhc3luYyl7XG4gIGlmICghXy5nZXQodGhpcy5fc2V0dGVyc2xpc3RlbmVycy5iZWZvcmUsc2V0dGVyKSl7XG4gICAgdGhpcy5fc2V0dGVyc2xpc3RlbmVycy5iZWZvcmVbc2V0dGVyXSA9IFtdO1xuICB9XG4gIHRoaXMuX3NldHRlcnNsaXN0ZW5lcnMuYmVmb3JlW3NldHRlcl0ucHVzaCh7XG4gICAgZm5jOiBsaXN0ZW5lcixcbiAgICBob3c6IGFzeW5jID8gJ2FzeW5jJyA6ICdzeW5jJ1xuICB9KTtcbn1cblxuLy8gdW5hIHZvbHRhIGlzdGFuemlhdG8gaWwgdG9vbCBhZ2dpdW5nbyBhIHF1ZXN0byB0dXR0aSBpIGxpc3RlbmVyIGRlZmluaXRpIGEgbGl2ZWxsbyBkaSBlZGl0b3JcbnByb3RvLl9zZXRUb29sU2V0dGVyc0xpc3RlbmVycyA9IGZ1bmN0aW9uKHRvb2wsc2V0dGVyc0xpc3RlbmVycyl7XG4gIF8uZm9yRWFjaChzZXR0ZXJzTGlzdGVuZXJzLmJlZm9yZSxmdW5jdGlvbihsaXN0ZW5lcnMsc2V0dGVyKXtcbiAgICBpZiAoXy5oYXNJbih0b29sLnNldHRlcnMsc2V0dGVyKSl7XG4gICAgICBfLmZvckVhY2gobGlzdGVuZXJzLGZ1bmN0aW9uKGxpc3RlbmVyKXtcbiAgICAgICAgaWYgKGxpc3RlbmVyLmhvdyA9PSAnc3luYycpe1xuICAgICAgICAgIHRvb2wub25iZWZvcmUoc2V0dGVyLGxpc3RlbmVyLmZuYyk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgdG9vbC5vbmJlZm9yZWFzeW5jKHNldHRlcixsaXN0ZW5lci5mbmMpO1xuICAgICAgICB9XG4gICAgICB9KVxuICAgIH1cbiAgfSk7XG4gIFxuICBfLmZvckVhY2goc2V0dGVyc0xpc3RlbmVycy5hZnRlcixmdW5jdGlvbihsaXN0ZW5lcnMsc2V0dGVyKXtcbiAgICBpZiAoXy5oYXNJbih0b29sLnNldHRlcnMsc2V0dGVyKSl7XG4gICAgICBfLmZvckVhY2gobGlzdGVuZXJzLGZ1bmN0aW9uKGxpc3RlbmVyKXtcbiAgICAgICAgICB0b29sLm9uYWZ0ZXIoc2V0dGVyLGxpc3RlbmVyLmZuYyk7XG4gICAgICB9KVxuICAgIH1cbiAgfSlcbn07XG5cbnByb3RvLl9zZXRTdGFydGVkID0gZnVuY3Rpb24oYm9vbCl7XG4gIHRoaXMuX3N0YXJ0ZWQgPSBib29sO1xufTtcblxucHJvdG8uX3NldERpcnR5ID0gZnVuY3Rpb24oYm9vbCl7XG4gIGlmIChfLmlzTmlsKGJvb2wpKXtcbiAgICB0aGlzLl9kaXJ0eSA9IHRydWU7XG4gIH1cbiAgZWxzZSB7XG4gICAgdGhpcy5fZGlydHkgPSBib29sO1xuICB9XG4gIHRoaXMuZW1pdChcImRpcnR5XCIsdGhpcy5fZGlydHkpO1xufTtcbiIsInZhciBpbmhlcml0ID0gcmVxdWlyZSgnY29yZS91dGlscy91dGlscycpLmluaGVyaXQ7XG52YXIgYmFzZSA9IHJlcXVpcmUoJ2NvcmUvdXRpbHMvdXRpbHMnKS5iYXNlO1xudmFyIEczV09iamVjdCA9IHJlcXVpcmUoJ2NvcmUvZzN3b2JqZWN0Jyk7XG52YXIgR1VJID0gcmVxdWlyZSgnZ3VpL2d1aScpO1xuXG5mdW5jdGlvbiBBZGRGZWF0dXJlVG9vbChlZGl0b3Isb3B0aW9ucyl7XG4gIHZhciBzZWxmID0gdGhpcztcbiAgdmFyIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuICB0aGlzLl9ydW5uaW5nID0gZmFsc2U7XG4gIHRoaXMuX2J1c3kgPSBmYWxzZTtcbiAgdGhpcy5lZGl0b3IgPSBlZGl0b3I7XG4gIHRoaXMuc291cmNlID0gZWRpdG9yLmdldEVkaXRWZWN0b3JMYXllcigpLmdldExheWVyKCkuZ2V0U291cmNlKCk7XG4gIHRoaXMuaXNQYXVzYWJsZSA9IHRydWU7XG4gIFxuICB0aGlzLmRyYXdJbnRlcmFjdGlvbiA9IG51bGw7XG4gIHRoaXMuX3NuYXAgPSBvcHRpb25zLnNuYXAgfHwgbnVsbDtcbiAgdGhpcy5fc25hcEludGVyYWN0aW9uID0gbnVsbDsgXG4gIFxuICB0aGlzLl9maW5pc2hDb25kaXRpb24gPSBvcHRpb25zLmZpbmlzaENvbmRpdGlvbiB8fCBfLmNvbnN0YW50KHRydWUpO1xuICBcbiAgdGhpcy5fY29uZGl0aW9uID0gb3B0aW9ucy5jb25kaXRpb24gfHwgXy5jb25zdGFudCh0cnVlKTtcbiAgXG4gIC8vIHF1aSBzaSBkZWZpbmlzY29ubyBpIG1ldG9kaSBjaGUgdm9nbGlhbW8gcG90ZXIgaW50ZXJjZXR0YXJlLCBlZCBldmVudHVhbG1lbnRlIGJsb2NjYXJlICh2ZWRpIEFQSSBHM1dPYmplY3QpXG4gIHRoaXMuc2V0dGVycyA9IHtcbiAgICBhZGRGZWF0dXJlOiB7XG4gICAgICBmbmM6IEFkZEZlYXR1cmVUb29sLnByb3RvdHlwZS5fYWRkRmVhdHVyZSxcbiAgICAgIGZhbGxiYWNrOiBBZGRGZWF0dXJlVG9vbC5wcm90b3R5cGUuX2ZhbGxCYWNrXG4gICAgfVxuICB9O1xuICBcbiAgYmFzZSh0aGlzKTtcbn1cbmluaGVyaXQoQWRkRmVhdHVyZVRvb2wsRzNXT2JqZWN0KTtcbm1vZHVsZS5leHBvcnRzID0gQWRkRmVhdHVyZVRvb2w7XG5cbnZhciBwcm90byA9IEFkZEZlYXR1cmVUb29sLnByb3RvdHlwZTtcblxuLy8gbWV0b2RvIGVzZWd1aXRvIGFsbCdhdnZpbyBkZWwgdG9vbFxucHJvdG8ucnVuID0gZnVuY3Rpb24oKXtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICB2YXIgbWFwID0gR1VJLmdldENvbXBvbmVudCgnbWFwJykuZ2V0U2VydmljZSgpLnZpZXdlci5tYXA7XG4gIFxuICB0aGlzLmRyYXdJbnRlcmFjdGlvbiA9IG5ldyBvbC5pbnRlcmFjdGlvbi5EcmF3KHtcbiAgICB0eXBlOiB0aGlzLmVkaXRvci5nZXRFZGl0VmVjdG9yTGF5ZXIoKS5nZW9tZXRyeXR5cGUsXG4gICAgc291cmNlOiB0aGlzLnNvdXJjZSxcbiAgICBjb25kaXRpb246IHRoaXMuX2NvbmRpdGlvbixcbiAgICBmaW5pc2hDb25kaXRpb246IHRoaXMuX2ZpbmlzaENvbmRpdGlvbiAvLyBkaXNwb25pYmlsZSBkYSBodHRwczovL2dpdGh1Yi5jb20vb3BlbmxheWVycy9vbDMvY29tbWl0L2Q0MjVmNzViZWEwNWNiNzc1NTk5MjNlNDk0ZjU0MTU2YzY2OTBjMGJcbiAgfSk7XG4gIG1hcC5hZGRJbnRlcmFjdGlvbih0aGlzLmRyYXdJbnRlcmFjdGlvbik7XG4gIHRoaXMuZHJhd0ludGVyYWN0aW9uLnNldEFjdGl2ZSh0cnVlKTtcbiAgXG4gIHRoaXMuZHJhd0ludGVyYWN0aW9uLm9uKCdkcmF3c3RhcnQnLGZ1bmN0aW9uKGUpe1xuICAgIHNlbGYuZWRpdG9yLmVtaXQoJ2RyYXdzdGFydCcsZSk7XG4gIH0pO1xuICBcbiAgdGhpcy5kcmF3SW50ZXJhY3Rpb24ub24oJ2RyYXdlbmQnLGZ1bmN0aW9uKGUpe1xuICAgIHNlbGYuZWRpdG9yLmVtaXQoJ2RyYXdlbmQnLGUpO1xuICAgIGlmICghc2VsZi5fYnVzeSl7XG4gICAgICBzZWxmLl9idXN5ID0gdHJ1ZTtcbiAgICAgIHNlbGYucGF1c2UoKTtcbiAgICAgIHNlbGYuYWRkRmVhdHVyZShlLmZlYXR1cmUpO1xuICAgIH1cbiAgfSk7XG4gIFxuICBpZiAodGhpcy5fc25hcCl7XG4gICAgdGhpcy5fc25hcEludGVyYWN0aW9uID0gbmV3IG9sLmludGVyYWN0aW9uLlNuYXAoe1xuICAgICAgc291cmNlOiB0aGlzLl9zbmFwLnZlY3RvckxheWVyLmdldFNvdXJjZSgpXG4gICAgfSk7XG4gICAgbWFwLmFkZEludGVyYWN0aW9uKHRoaXMuX3NuYXBJbnRlcmFjdGlvbik7XG4gIH1cbn07XG5cbnByb3RvLnBhdXNlID0gZnVuY3Rpb24ocGF1c2Upe1xuICBpZiAoXy5pc1VuZGVmaW5lZChwYXVzZSkgfHwgcGF1c2Upe1xuICAgIGlmICh0aGlzLl9zbmFwSW50ZXJhY3Rpb24pe1xuICAgICAgdGhpcy5fc25hcEludGVyYWN0aW9uLnNldEFjdGl2ZShmYWxzZSk7XG4gICAgfVxuICAgIHRoaXMuZHJhd0ludGVyYWN0aW9uLnNldEFjdGl2ZShmYWxzZSk7XG4gIH1cbiAgZWxzZSB7XG4gICAgaWYgKHRoaXMuX3NuYXBJbnRlcmFjdGlvbil7XG4gICAgICB0aGlzLl9zbmFwSW50ZXJhY3Rpb24uc2V0QWN0aXZlKHRydWUpO1xuICAgIH1cbiAgICB0aGlzLmRyYXdJbnRlcmFjdGlvbi5zZXRBY3RpdmUodHJ1ZSk7XG4gIH1cbn07XG5cbi8vIG1ldG9kbyBlc2VndWl0byBhbGxhIGRpc2F0dGl2YXppb25lIGRlbCB0b29sXG5wcm90by5zdG9wID0gZnVuY3Rpb24oKXtcbiAgdmFyIG1hcCA9IEdVSS5nZXRDb21wb25lbnQoJ21hcCcpLmdldFNlcnZpY2UoKS52aWV3ZXIubWFwO1xuICBpZiAodGhpcy5fc25hcEludGVyYWN0aW9uKXtcbiAgICAgbWFwLnJlbW92ZUludGVyYWN0aW9uKHRoaXMuX3NuYXBJbnRlcmFjdGlvbik7XG4gICAgIHRoaXMuX3NuYXBJbnRlcmFjdGlvbiA9IG51bGw7XG4gIH1cbiAgbWFwLnJlbW92ZUludGVyYWN0aW9uKHRoaXMuZHJhd0ludGVyYWN0aW9uKTtcbiAgdGhpcy5kcmF3SW50ZXJhY3Rpb24gPSBudWxsO1xuICByZXR1cm4gdHJ1ZTtcbn07XG5cbnByb3RvLnJlbW92ZUxhc3RQb2ludCA9IGZ1bmN0aW9uKCl7XG4gIGlmICh0aGlzLmRyYXdJbnRlcmFjdGlvbil7XG4gICAgLy8gcHJvdm8gYSByaW11b3ZlcmUgbCd1bHRpbW8gcHVudG8uIE5lbCBjYXNvIG5vbiBlc2lzdGEgbGEgZ2VvbWV0cmlhIGdlc3Rpc2NvIHNpbGVuemlvc2FtZW50ZSBsJ2Vycm9yZVxuICAgIHRyeXtcbiAgICAgIHRoaXMuZHJhd0ludGVyYWN0aW9uLnJlbW92ZUxhc3RQb2ludCgpO1xuICAgIH1cbiAgICBjYXRjaCAoZSl7XG4gICAgICAvL1xuICAgIH1cbiAgfVxufTtcblxucHJvdG8uX2FkZEZlYXR1cmUgPSBmdW5jdGlvbihmZWF0dXJlKXtcbiAgLy8gYWdnaXVuZ28gbGEgZ2VvbWV0cmlhIG5lbGwnZWRpdCBidWZmZXJcbiAgdGhpcy5lZGl0b3IuYWRkRmVhdHVyZShmZWF0dXJlKTtcbiAgdGhpcy5fYnVzeSA9IGZhbHNlO1xuICB0aGlzLnBhdXNlKGZhbHNlKTtcbiAgcmV0dXJuIHRydWU7XG59O1xuXG5wcm90by5fZmFsbEJhY2sgPSBmdW5jdGlvbihmZWF0dXJlKXtcbiAgdGhpcy5fYnVzeSA9IGZhbHNlO1xuICAvLyByaW11b3ZvIGwndWx0aW1hIGZlYXR1cmUgaW5zZXJpdGEsIG92dmVybyBxdWVsbGEgZGlzZWduYXRhIG1hIGNoZSBub24gc2kgdnVvbGUgc2FsdmFyZVxuICB0aGlzLnNvdXJjZS5nZXRGZWF0dXJlc0NvbGxlY3Rpb24oKS5wb3AoKTtcbiAgdGhpcy5wYXVzZShmYWxzZSk7XG59O1xuIiwidmFyIGluaGVyaXQgPSByZXF1aXJlKCdjb3JlL3V0aWxzL3V0aWxzJykuaW5oZXJpdDtcbnZhciBiYXNlID0gcmVxdWlyZSgnY29yZS91dGlscy91dGlscycpLmJhc2U7XG52YXIgZ2VvbSA9IHJlcXVpcmUoJ2NvcmUvZ2VvbWV0cnkvZ2VvbScpO1xudmFyIFBpY2tGZWF0dXJlSW50ZXJhY3Rpb24gPSByZXF1aXJlKCdnM3ctb2wzL3NyYy9pbnRlcmFjdGlvbnMvcGlja2ZlYXR1cmVpbnRlcmFjdGlvbicpO1xudmFyIFBpY2tDb29yZGluYXRlc0ludGVyYWN0aW9uID0gcmVxdWlyZSgnZzN3LW9sMy9zcmMvaW50ZXJhY3Rpb25zL3BpY2tjb29yZGluYXRlc2ludGVyYWN0aW9uJyk7XG52YXIgR1VJID0gcmVxdWlyZSgnZ3VpL2d1aScpO1xuXG52YXIgRWRpdGluZ1Rvb2wgPSByZXF1aXJlKCcuL3Rvb2wnKTtcblxuZnVuY3Rpb24gQ3V0TGluZVRvb2woZWRpdG9yLG9wdGlvbnMpe1xuICB0aGlzLnNldHRlcnMgPSB7XG4gICAgY3V0TGluZTogQ3V0TGluZVRvb2wucHJvdG90eXBlLl9jdXRMaW5lXG4gIH07XG4gIFxuICBiYXNlKHRoaXMsZWRpdG9yLG9wdGlvbnMpO1xuICBcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICB0aGlzLmlzUGF1c2FibGUgPSB0cnVlO1xuICB0aGlzLnN0ZXBzID0gbmV3IEVkaXRpbmdUb29sLlN0ZXBzKEN1dExpbmVUb29sLnN0ZXBzKTtcbiAgXG4gIHRoaXMuX29yaWdGZWF0dXJlID0gbnVsbDtcbiAgdGhpcy5fb3JpZ0dlb21ldHJ5ID0gbnVsbDtcbiAgdGhpcy5fbmV3RmVhdHVyZXMgPSBbXTtcbiAgdGhpcy5fbGluZVBpY2tJbnRlcmFjdGlvbiA9IG51bGw7XG4gIHRoaXMuX3BvaW50UGlja0ludGVyYWN0aW9uID0gbnVsbDtcbiAgdGhpcy5fc2VsZWN0TGluZVRvS2VlcEludGVyYWN0aW9uID0gbnVsbDtcbiAgdGhpcy5fcG9pbnRMYXllciA9IG9wdGlvbnMucG9pbnRMYXllciB8fCBudWxsO1xuICB0aGlzLl9taW5DdXRQb2ludERpc3RhbmNlID0gb3B0aW9ucy5taW5DdXRQb2ludERpc3RhbmNlIHx8IEluZmluaXR5O1xuICB0aGlzLl9tb2RUeXBlID0gb3B0aW9ucy5tb2RUeXBlIHx8ICdNT0RPTkNVVCc7IC8vICdORVdPTkNVVCcgfCAnTU9ET05DVVQnXG4gIFxuICB0aGlzLl9zZWxlY3RlZExpbmVPdmVybGF5ID0gbmV3IG9sLmxheWVyLlZlY3Rvcih7XG4gICAgc291cmNlOiBuZXcgb2wuc291cmNlLlZlY3RvcigpLFxuICAgIHN0eWxlOiBuZXcgb2wuc3R5bGUuU3R5bGUoe1xuICAgICAgc3Ryb2tlOiBuZXcgb2wuc3R5bGUuU3Ryb2tlKHtcbiAgICAgICAgY29sb3I6ICdyZ2IoMjU1LDI1NSwwKScsXG4gICAgICAgIHdpZHRoOiA0XG4gICAgICB9KVxuICAgIH0pXG4gIH0pO1xuICBcbiAgLy92YXIgY3V0TGluZUlkeCA9IDA7XG4gIC8vdmFyIGN1dExpbmVDb2xvcnMgPSBbJ3JnYigyNTUsMCwwKScsJ3JnYigwLDAsMjU1KSddXG4gIHRoaXMuX2xpbmVUb0tlZXBPdmVybGF5ID0gbmV3IG9sLmxheWVyLlZlY3Rvcih7XG4gICAgc291cmNlOiBuZXcgb2wuc291cmNlLlZlY3RvcigpLFxuICAgIC8qc3R5bGU6IGZ1bmN0aW9uKGZlYXR1cmUpeyBcbiAgICAgIGN1dExpbmVJZHggKz0gMTtcbiAgICAgIHJldHVybiBbbmV3IG9sLnN0eWxlLlN0eWxlKHtcbiAgICAgICAgc3Ryb2tlOiBuZXcgb2wuc3R5bGUuU3Ryb2tlKHtcbiAgICAgICAgICBjb2xvcjogY3V0TGluZUNvbG9yc1tjdXRMaW5lSWR4JTJdLFxuICAgICAgICAgIHdpZHRoOiA0XG4gICAgICAgIH0pXG4gICAgICB9KV1cbiAgICB9Ki9cbiAgfSk7XG5cbiAgXG59XG5pbmhlcml0KEN1dExpbmVUb29sLEVkaXRpbmdUb29sKTtcbm1vZHVsZS5leHBvcnRzID0gQ3V0TGluZVRvb2w7XG5cbnZhciBwcm90byA9IEN1dExpbmVUb29sLnByb3RvdHlwZTtcblxucHJvdG8ucnVuID0gZnVuY3Rpb24oKXtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICBcbiAgdGhpcy5fbGluZVBpY2tJbnRlcmFjdGlvbiA9IG5ldyBQaWNrRmVhdHVyZUludGVyYWN0aW9uKHtcbiAgICBsYXllcnM6IFt0aGlzLmxheWVyLHRoaXMuZWRpdGluZ0xheWVyXVxuICB9KTtcbiAgXG4gIHRoaXMubWFwLmFkZEludGVyYWN0aW9uKHRoaXMuX2xpbmVQaWNrSW50ZXJhY3Rpb24pO1xuICBcbiAgLy8gc2VsZXppb25vIGxhIGxpbmVhIGRhIHRhZ2xpYXJlXG4gIHNlbGYuc3RlcHMubmV4dCgpO1xuICB0aGlzLl9saW5lUGlja0ludGVyYWN0aW9uLm9uKCdwaWNrZWQnLGZ1bmN0aW9uKGUpe1xuICAgIHZhciBjdXRGZWF0dXJlO1xuICAgIHZhciBmZWF0dXJlID0gc2VsZi5fb3JpZ0ZlYXR1cmUgPSBlLmZlYXR1cmU7XG4gICAgc2VsZi5fb3JpZ0dlb21ldHJ5ID0gZmVhdHVyZS5nZXRHZW9tZXRyeSgpLmNsb25lKCk7XG4gICAgc2VsZi5fc2hvd1NlbGVjdGlvbihzZWxmLl9vcmlnR2VvbWV0cnksMzAwKTtcbiAgICBzZWxmLm1hcC5yZW1vdmVJbnRlcmFjdGlvbih0aGlzKTtcblxuICAgIFxuICAgIGlmIChzZWxmLl9wb2ludExheWVyKXtcbiAgICAgIHNlbGYuX3BvaW50UGlja0ludGVyYWN0aW9uID0gbmV3IFBpY2tGZWF0dXJlSW50ZXJhY3Rpb24oe1xuICAgICAgICBsYXllcnM6IFtzZWxmLl9wb2ludExheWVyXVxuICAgICAgfSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgc2VsZi5fcG9pbnRQaWNrSW50ZXJhY3Rpb24gPSBuZXcgUGlja0Nvb3JkaW5hdGVzSW50ZXJhY3Rpb24oKTtcbiAgICB9XG4gICAgXG4gICAgLy8gcGVzY28gY29vcmRpbmF0YSBvIGZlYXR1cmUgZGkgdGFnbGlvIHNlbGV6aW9uYXRhXG4gICAgc2VsZi5zdGVwcy5uZXh0KCk7XG4gICAgc2VsZi5fcG9pbnRQaWNrSW50ZXJhY3Rpb24ub24oJ3BpY2tlZCcsZnVuY3Rpb24oZSl7XG4gICAgICBzZWxmLm1hcC5yZW1vdmVJbnRlcmFjdGlvbih0aGlzKTtcbiAgICAgIHZhciBjb29yZGluYXRlO1xuICAgICAgaWYgKGUuZmVhdHVyZSl7XG4gICAgICAgIGN1dEZlYXR1cmUgPSBlLmZlYXR1cmU7XG4gICAgICAgIGNvb3JkaW5hdGUgPSBjdXRGZWF0dXJlLmdldEdlb21ldHJ5KCkuZ2V0Q29vcmRpbmF0ZXMoKTtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICBjb29yZGluYXRlID0gZS5jb29yZGluYXRlO1xuICAgICAgfVxuICAgICAgaWYgKGNvb3JkaW5hdGUpe1xuICAgICAgICAvLyBzbmFwcG8gc3VsbGEgbGluZWFcbiAgICAgICAgdmFyIGNsb3Nlc3RDb29yZGluYXRlID0gZmVhdHVyZS5nZXRHZW9tZXRyeSgpLmdldENsb3Nlc3RQb2ludChjb29yZGluYXRlKTtcbiAgICAgICAgdmFyIGRpc3RhbmNlID0gZ2VvbS5kaXN0YW5jZShjb29yZGluYXRlLGNsb3Nlc3RDb29yZGluYXRlKTtcbiAgICAgICAgLy8gc2UgbG8gc25hcCDDqCBlbnRybyBsYSB0b2xsZXJhbnphXG4gICAgICAgIGlmIChkaXN0YW5jZSA8IHNlbGYuX21pbkN1dFBvaW50RGlzdGFuY2Upe1xuICAgICAgICAgIC8vIHRhZ2xpbyBsYSBsaW5lYSBlIG90dGVuZ28gbCdhcnJheSBjb24gbGUgZHVlIG51b3ZlIGZlYXR1cmVcbiAgICAgICAgICB2YXIgc2xpY2VkTGluZXMgPSBzZWxmLl9jdXQoZmVhdHVyZS5nZXRHZW9tZXRyeSgpLGNsb3Nlc3RDb29yZGluYXRlKTtcbiAgICAgICAgICBpZiAoc2xpY2VkTGluZXMpe1xuICAgICAgICAgICAgdmFyIHByZXZMaW5lRmVhdHVyZSA9IHNsaWNlZExpbmVzWzBdO1xuICAgICAgICAgICAgdmFyIG5leHRMaW5lRmVhdHVyZSA9IHNsaWNlZExpbmVzWzFdO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICB2YXIgbmV3SWQgPSBzZWxmLmVkaXRvci5nZW5lcmF0ZUlkKCk7XG4gICAgICAgICAgICBwcmV2TGluZUZlYXR1cmUuc2V0SWQobmV3SWQrJ18xJyk7XG4gICAgICAgICAgICBuZXh0TGluZUZlYXR1cmUuc2V0SWQobmV3SWQrJ18yJyk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIHByZW5kbyBsZSBwcm9wcmlldMOgIGRlbGxhIGZlYXR1cmUgb3JpZ2luYWxlIChlc2NsdXNhIGxhIGdlb21ldHJpYSlcbiAgICAgICAgICAgIHZhciBvcmlnUHJvcGVydGllcyA9IGZlYXR1cmUuZ2V0UHJvcGVydGllcygpO1xuICAgICAgICAgICAgZGVsZXRlIG9yaWdQcm9wZXJ0aWVzW2ZlYXR1cmUuZ2V0R2VvbWV0cnlOYW1lKCldO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBzZWxmLl9zaG93U2VsZWN0aW9uKHByZXZMaW5lRmVhdHVyZS5nZXRHZW9tZXRyeSgpLDMwMCk7XG4gICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgIHNlbGYuX3Nob3dTZWxlY3Rpb24obmV4dExpbmVGZWF0dXJlLmdldEdlb21ldHJ5KCksMzAwKTtcbiAgICAgICAgICAgIH0sMzAwKVxuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBuZWwgY2FzbyBkaSBtb2RpZmljYSBzdSB0YWdsaW9cbiAgICAgICAgICAgIGlmIChzZWxmLl9tb2RUeXBlID09ICdNT0RPTkNVVCcpe1xuICAgICAgICAgICAgICAvLyBzZWxlemlvbm8gbGEgcG9yemlvbmUgZGEgbWFudGVuZXJlL21vZGlmaWNhcmVcbiAgICAgICAgICAgICAgc2VsZi5zdGVwcy5uZXh0KCk7XG4gICAgICAgICAgICAgIHNlbGYuX3NlbGVjdExpbmVUb0tlZXAocHJldkxpbmVGZWF0dXJlLG5leHRMaW5lRmVhdHVyZSlcbiAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oZmVhdHVyZVRvS2VlcCl7XG4gICAgICAgICAgICAgICAgLy8gYWdnaW9ybm8gbGEgZmVhdHVyZSBvcmlnaW5hbGUgY29uIGxhIGdlb21ldHJpYSBkZWxsYSBmZWF0dXJlIGNoZSBzaSDDqCBzZWxlemlvbmF0byBkYSBtYW50ZW5lcmVcbiAgICAgICAgICAgICAgICBmZWF0dXJlLnNldEdlb21ldHJ5KGZlYXR1cmVUb0tlZXAuZ2V0R2VvbWV0cnkoKS5jbG9uZSgpKTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICB2YXIgZmVhdHVyZVRvQWRkO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIC8vIHJpbXVvdm8gdW5hIGRlbGxlIGR1ZSBudW92ZSBmZWF0dXJlIGUgbWkgdGVuZ28gbCd1bmljYSBmZWF0dXJlIGRhIGFnZ2l1bmdlcmUgY29tZSBudW92YVxuICAgICAgICAgICAgICAgIGlmIChwcmV2TGluZUZlYXR1cmUuZ2V0SWQoKSA9PSBmZWF0dXJlVG9LZWVwLmdldElkKCkpe1xuICAgICAgICAgICAgICAgICAgZGVsZXRlIHByZXZMaW5lRmVhdHVyZTtcbiAgICAgICAgICAgICAgICAgIGZlYXR1cmVUb0FkZCA9IG5leHRMaW5lRmVhdHVyZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAobmV4dExpbmVGZWF0dXJlLmdldElkKCkgPT0gZmVhdHVyZVRvS2VlcC5nZXRJZCgpKXtcbiAgICAgICAgICAgICAgICAgIGRlbGV0ZSBuZXh0TGluZUZlYXR1cmU7XG4gICAgICAgICAgICAgICAgICBmZWF0dXJlVG9BZGQgPSBwcmV2TGluZUZlYXR1cmU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIHNlbGYuX25ld0ZlYXR1cmVzLnB1c2goZmVhdHVyZVRvQWRkKTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAvLyB0cmFtaXRlIGwnZWRpdG9yIGFzc2Vnbm8gYWxsYSBudW92YSBmZWF0dXJlIGdsaSBzdGVzc2kgYXR0cmlidXRpIGRlbGwnYWx0cmEsIG9yaWdpbmFsZSwgbW9kaWZpY2F0YVxuICAgICAgICAgICAgICAgIGZlYXR1cmVUb0FkZC5zZXRQcm9wZXJ0aWVzKG9yaWdQcm9wZXJ0aWVzKTtcbiAgICAgICAgICAgICAgICAvLyBlIGxhIGFnZ2l1bmdvIGFsIGxheWVyIGRpIGVkaXRpbmcsIGNvc8OsIG1pIHZpZW5lIG1vc3RyYXRhIGNvbWUgbnVvdmEgZmVhdHVyZSBzdWxsYSBtYXBwYVxuICAgICAgICAgICAgICAgIHNlbGYuZWRpdGluZ0xheWVyLmdldFNvdXJjZSgpLmFkZEZlYXR1cmVzKFtmZWF0dXJlVG9BZGRdKTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICB2YXIgZGF0YSA9IHtcbiAgICAgICAgICAgICAgICAgIGFkZGVkOiBbZmVhdHVyZVRvQWRkXSxcbiAgICAgICAgICAgICAgICAgIHVwZGF0ZWQ6IGZlYXR1cmUsXG4gICAgICAgICAgICAgICAgICBjdXRmZWF0dXJlOmN1dEZlYXR1cmVcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgLy8gYSBxdWVzdG8gcHVudG8gYXZ2aW8gaWwgc2V0dGVyLCBjaGUgc2kgb2NjdXBlcsOyIGRpIGFnZ2lvcm5hcmUgbCdlZGl0YnVmZmVyIGEgc2Vjb25kYSBkZWwgdGlwbyBkaSBtb2RpZmljYVxuICAgICAgICAgICAgICAgIHNlbGYuY3V0TGluZShkYXRhLHNlbGYuX21vZFR5cGUpXG4gICAgICAgICAgICAgICAgLmZhaWwoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgIHNlbGYuX3JvbGxCYWNrKCk7XG4gICAgICAgICAgICAgICAgICBzZWxmLnJlcnVuKCk7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAvLyBuZWwgY2FzbyBsYSBtb2RpZmljYSBzaWEgYWdnaXVuZ28gc3UgdGFnbGlhLCBhbGxvcmEgcmltdW92byBsJ29yaWdpbmFsZSBlIGFnZ2l1bmdvIGxlIGR1ZSBudW92ZSBmZWF0dXJlXG4gICAgICAgICAgICAgIHNlbGYubGF5ZXIuZ2V0U291cmNlKCkucmVtb3ZlRmVhdHVyZShmZWF0dXJlKTtcbiAgICAgICAgICAgICAgLy9zZWxmLmVkaXRvci5zZXRBdHRyaWJ1dGVzKHByZXZMaW5lRmVhdHVyZSxvcmlnUHJvcGVydGllcyk7XG4gICAgICAgICAgICAgIC8vc2VsZi5lZGl0b3Iuc2V0QXR0cmlidXRlcyhuZXh0TGluZUZlYXR1cmUsb3JpZ1Byb3BlcnRpZXMpO1xuICAgICAgICAgICAgICBzZWxmLl9uZXdGZWF0dXJlcy5wdXNoKHByZXZMaW5lRmVhdHVyZSk7XG4gICAgICAgICAgICAgIHNlbGYuX25ld0ZlYXR1cmVzLnB1c2gobmV4dExpbmVGZWF0dXJlKTtcbiAgICAgICAgICAgICAgc2VsZi5lZGl0aW5nTGF5ZXIuZ2V0U291cmNlKCkuYWRkRmVhdHVyZXMoW2ZlYXR1cmVUb0FkZCxwcmV2TGluZUZlYXR1cmVdKTtcbiAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgIHZhciBkYXRhID0ge1xuICAgICAgICAgICAgICAgIGFkZGVkOiBbcHJldkxpbmVGZWF0dXJlLG5leHRMaW5lRmVhdHVyZV0sXG4gICAgICAgICAgICAgICAgcmVtb3ZlZDogZmVhdHVyZVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIFxuICAgICAgICAgICAgICBzZWxmLmN1dExpbmUoZGF0YSxzZWxmLl9tb2RUeXBlKVxuICAgICAgICAgICAgICAuZmFpbChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHNlbGYuX3JvbGxCYWNrKCk7XG4gICAgICAgICAgICAgICAgc2VsZi5yZXJ1bigpO1xuICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHNlbGYucmVydW4oKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KVxuICAgIHNlbGYubWFwLmFkZEludGVyYWN0aW9uKHNlbGYuX3BvaW50UGlja0ludGVyYWN0aW9uKTtcbiAgfSk7XG59O1xuXG5wcm90by5wYXVzZSA9IGZ1bmN0aW9uKHBhdXNlKXtcbiAgaWYgKF8uaXNVbmRlZmluZWQocGF1c2UpIHx8IHBhdXNlKXtcbiAgICB0aGlzLl9saW5lUGlja0ludGVyYWN0aW9uLnNldEFjdGl2ZShmYWxzZSk7XG4gICAgdGhpcy5fcG9pbnRQaWNrSW50ZXJhY3Rpb24uc2V0QWN0aXZlKGZhbHNlKTtcbiAgfVxuICBlbHNlIHtcbiAgICB0aGlzLl9saW5lUGlja0ludGVyYWN0aW9uLnNldEFjdGl2ZSh0cnVlKTtcbiAgICB0aGlzLl9wb2ludFBpY2tJbnRlcmFjdGlvbi5zZXRBY3RpdmUodHJ1ZSk7XG4gIH1cbn07XG5cbnByb3RvLnJlcnVuID0gZnVuY3Rpb24oKXtcbiAgdGhpcy5zdG9wKCk7XG4gIHRoaXMucnVuKCk7XG59O1xuXG5wcm90by5zdG9wID0gZnVuY3Rpb24oKXtcbiAgdGhpcy5fY2xlYW5VcCgpO1xuICBcbiAgdmFyIHN0b3AgPSBFZGl0aW5nVG9vbC5wcm90b3R5cGUuc3RvcC5jYWxsKHRoaXMpO1xuICBcbiAgaWYgKHN0b3ApIHtcbiAgICB0aGlzLm1hcC5yZW1vdmVJbnRlcmFjdGlvbih0aGlzLl9saW5lUGlja0ludGVyYWN0aW9uKTtcbiAgICB0aGlzLm1hcC5yZW1vdmVJbnRlcmFjdGlvbih0aGlzLl9wb2ludFBpY2tJbnRlcmFjdGlvbik7XG4gICAgdGhpcy5fbGluZVBpY2tJbnRlcmFjdGlvbiA9IG51bGw7XG4gICAgdGhpcy5fcG9pbnRQaWNrSW50ZXJhY3Rpb24gPSBudWxsO1xuICB9XG5cbiAgcmV0dXJuIHN0b3A7XG59O1xuXG5wcm90by5fY2xlYW5VcCA9IGZ1bmN0aW9uKCl7XG4gIHRoaXMuX29yaWdGZWF0dXJlID0gbnVsbDtcbiAgdGhpcy5fb3JpZ0dlb21ldHJ5ID0gbnVsbDtcbiAgdGhpcy5fbmV3RmVhdHVyZXMgPSBbXTtcbiAgdGhpcy5fbGluZVRvS2VlcE92ZXJsYXkuc2V0TWFwKG51bGwpO1xuICB0aGlzLl9zZWxlY3RlZExpbmVPdmVybGF5LnNldE1hcChudWxsKTtcbn07XG5cbnByb3RvLl9yb2xsQmFjayA9IGZ1bmN0aW9uKCl7XG4gIC8vIHJpbWV0dG8gbGEgdmVjY2hpYSBnZW9tZXRyaWFcbiAgdGhpcy5fb3JpZ0ZlYXR1cmUuc2V0R2VvbWV0cnkodGhpcy5fb3JpZ0dlb21ldHJ5KTtcbiAgLy8gcmltdW92byBsZSBmZWF0dXJlIChudW92ZSkgZWRpdGF0ZSBkYWwgbGF5ZXIgZGkgZWRpdGF6aW9uZVxuICB0cnkge1xuICAgIF8uZm9yRWFjaCh0aGlzLl9uZXdGZWF0dXJlcyxmdW5jdGlvbihmZWF0dXJlKXtcbiAgICAgIHNlbGYuZWRpdGluZ0xheWVyLmdldFNvdXJjZSgpLnJlbW92ZUZlYXR1cmUoZmVhdHVyZSk7XG4gICAgfSk7XG4gIH1cbiAgY2F0Y2ggKGUpIHt9O1xufTtcblxucHJvdG8uX2N1dExpbmUgPSBmdW5jdGlvbihkYXRhLG1vZFR5cGUpe1xuICAvLyBzZSBtb2RpZmljbyBzdSB0YWdsaW8gYWdnaW9ybm8gbGEgdmVjY2hpYSBmZWF0dXJlIGUgYWdnaXVuZ28gbGEgbnVvdmFcbiAgaWYgKG1vZFR5cGUgPT0gJ01PRE9OQ1VUJyl7XG4gICAgdmFyIGZlYXR1cmVUb1VwZGF0ZSA9IGRhdGEudXBkYXRlZDtcbiAgICB2YXIgZmVhdHVyZVRvQWRkID0gZGF0YS5hZGRlZFswXTtcbiAgICB0aGlzLmVkaXRvci51cGRhdGVGZWF0dXJlKGZlYXR1cmVUb1VwZGF0ZSk7XG4gICAgdGhpcy5lZGl0b3IuYWRkRmVhdHVyZShmZWF0dXJlVG9BZGQpO1xuICB9XG4gIC8vIGFsdHJpbWVudGkgcmltdW92byBsYSB2ZWNjaGlhIGUgYWdnaXVuZ28gbGUgbnVvdmVcbiAgZWxzZXtcbiAgICB2YXIgZmVhdHVyZVRvUmVtb3ZlID0gZGF0YS5yZW1vdmVkO1xuICAgIHZhciBmZWF0dXJlVG9BZGQxID0gZGF0YS5hZGRlZFswXTtcbiAgICB2YXIgZmVhdHVyZVRvQWRkMiA9IGRhdGEuYWRkZWRbMV07XG4gICAgdGhpcy5lZGl0b3IuZGVsZXRlRmVhdHVyZShmZWF0dXJlVG9SZW1vdmUpO1xuICAgIHRoaXMuZWRpdG9yLmFkZEZlYXR1cmUoZmVhdHVyZVRvQWRkMSk7XG4gICAgdGhpcy5lZGl0b3IuYWRkRmVhdHVyZShmZWF0dXJlVG9BZGQyKTtcbiAgfVxuICB0aGlzLl9idXN5ID0gZmFsc2U7XG4gIHRoaXMucGF1c2UoZmFsc2UpO1xuICB0aGlzLnN0ZXBzLmNvbXBsZXRlZCgpO1xuICB0aGlzLnJlcnVuKCk7XG4gIHJldHVybiB0cnVlO1xufTtcblxucHJvdG8uX3NlbGVjdExpbmVUb0tlZXAgPSBmdW5jdGlvbihwcmV2TGluZUZlYXR1cmUsbmV4dExpbmVGZWF0dXJlKXtcbiAgdmFyIGQgPSAkLkRlZmVycmVkKCk7XG4gIHZhciBzZWxmID0gdGhpcztcbiAgdmFyIGxheWVyID0gdGhpcy5fbGluZVRvS2VlcE92ZXJsYXk7XG4gIGxheWVyLmdldFNvdXJjZSgpLmFkZEZlYXR1cmVzKFtwcmV2TGluZUZlYXR1cmUsbmV4dExpbmVGZWF0dXJlXSk7XG4gIGxheWVyLnNldE1hcCh0aGlzLm1hcCk7XG4gIFxuICB2YXIgc2VsZWN0TGluZUludGVyYWN0aW9uID0gbmV3IFBpY2tGZWF0dXJlSW50ZXJhY3Rpb24oe1xuICAgIGxheWVyczogW3RoaXMuX2xpbmVUb0tlZXBPdmVybGF5XSxcbiAgfSk7XG4gIHRoaXMubWFwLmFkZEludGVyYWN0aW9uKHNlbGVjdExpbmVJbnRlcmFjdGlvbik7XG4gIFxuICBzZWxlY3RMaW5lSW50ZXJhY3Rpb24ub24oJ3BpY2tlZCcsZnVuY3Rpb24oZSl7XG4gICAgbGF5ZXIuc2V0TWFwKG51bGwpO1xuICAgIHNlbGYubWFwLnJlbW92ZUludGVyYWN0aW9uKHRoaXMpO1xuICAgIGQucmVzb2x2ZShlLmZlYXR1cmUpO1xuICB9KTtcbiAgXG4gIHJldHVybiBkLnByb21pc2UoKTtcbn07XG5cbnByb3RvLl9mYWxsQmFjayA9IGZ1bmN0aW9uKGZlYXR1cmUpe1xuICB0aGlzLl9idXN5ID0gZmFsc2U7XG4gIHRoaXMucGF1c2UoZmFsc2UpO1xufTtcblxucHJvdG8uX2N1dCA9IGZ1bmN0aW9uKGdlb21ldHJ5LGN1dENvb3JkaW5hdGUpe1xuICB3aGlsZSAoY3V0Q29vcmRpbmF0ZS5sZW5ndGggPCBnZW9tZXRyeS5nZXRTdHJpZGUoKSkge1xuICAgIGN1dENvb3JkaW5hdGUucHVzaCgwKTtcbiAgfVxuXG4gIHZhciBtaW5EaXN0YW5jZSA9IEluZmluaXR5O1xuICB2YXIgY2xvc2VzdEluZGV4ID0gMDtcbiAgdmFyIGluZGV4ID0gMDtcbiAgLy8gY2VyY28gbCdpbmRpY2UgZGVsIHNlZ21lbnRvIGxpbmVhcmUgc3UgY3VpIHJpY2FkZSBsYSBjb29yZGluYXRhIGRpIHRhZ2xpb1xuICBnZW9tZXRyeS5mb3JFYWNoU2VnbWVudChmdW5jdGlvbih2MCx2MSl7XG4gICAgdmFyIHNlZ21lbnRQb2ludCA9IGdlb20uY2xvc2VzdE9uU2VnbWVudChjdXRDb29yZGluYXRlLFt2MCx2MV0pO1xuICAgIHZhciBkaXN0YW5jZSA9IGdlb20uZGlzdGFuY2UoY3V0Q29vcmRpbmF0ZSxzZWdtZW50UG9pbnQpO1xuICAgIGlmIChkaXN0YW5jZSA8IG1pbkRpc3RhbmNlKXtcbiAgICAgIG1pbkRpc3RhbmNlID0gZGlzdGFuY2U7XG4gICAgICBjbG9zZXN0SW5kZXggPSBpbmRleDtcbiAgICB9XG4gICAgaW5kZXggKz0gMTtcbiAgfSlcbiAgXG4gIHZhciBjb29yZGluYXRlcyA9IGdlb21ldHJ5LmdldENvb3JkaW5hdGVzKCk7XG4gIC8vIHByZW5kbyBsYSBwcmltYSBwb3J6aW9uZSBkaSBjb29yZGluYXRlXG4gIHZhciBwcmV2Q29vcmRzID0gY29vcmRpbmF0ZXMuc2xpY2UoMCxjbG9zZXN0SW5kZXgrMSk7XG4gIC8vIGFnZ2l1bmdvIGxhIGNvb3JkaW5hdGEgZGkgdGFnbGlvIGFsbGEgcHJpbWEgcG9yemlvbmVcbiAgcHJldkNvb3Jkcy5zcGxpY2UocHJldkNvb3Jkcy5sZW5ndGgsMCxjdXRDb29yZGluYXRlKTtcbiAgLy8gcHJlbmRvIGxhIHNlY29uZGEgcG9yemlvbmUgZGkgY29vcmRpbmF0ZVxuICB2YXIgbmV4dENvb3JkcyA9IGNvb3JkaW5hdGVzLnNsaWNlKGNsb3Nlc3RJbmRleCk7XG4gIC8vIGFnZ2l1bmdvIGxhIGNvb3JkaW5hdGEgZGkgdGFnbGlvIGFsbGEgc2Vjb25kYSBwb3J6aW9uZVxuICBuZXh0Q29vcmRzLnNwbGljZSgwLDEsY3V0Q29vcmRpbmF0ZSk7XG4gIFxuICBpZiAocHJldkNvb3Jkcy5sZW5ndGggPCAyIHx8IG5leHRDb29yZHMubGVuZ3RoIDwgMil7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIFxuICAvLyBjcmVvIGxlIGdlb21ldHJpZVxuICB2YXIgcHJldkxpbmUgPSBuZXcgb2wuZ2VvbS5MaW5lU3RyaW5nKCk7XG4gIHByZXZMaW5lLnNldENvb3JkaW5hdGVzKHByZXZDb29yZHMpO1xuICB2YXIgbmV4dExpbmUgPSBuZXcgb2wuZ2VvbS5MaW5lU3RyaW5nKCk7XG4gIG5leHRMaW5lLnNldENvb3JkaW5hdGVzKG5leHRDb29yZHMpO1xuICBcbiAgLy8gY3JlbyBsZSBudW92ZSBmZWF0dXJlXG4gIHZhciBwcmV2TGluZUZlYXQgPSBuZXcgb2wuRmVhdHVyZSh7XG4gICAgZ2VvbWV0cnk6IHByZXZMaW5lXG4gIH0pO1xuICB2YXIgbmV4dExpbmVGZWF0ID0gbmV3IG9sLkZlYXR1cmUoe1xuICAgIGdlb21ldHJ5OiBuZXh0TGluZVxuICB9KTtcbiAgXG4gIHJldHVybiBbcHJldkxpbmVGZWF0LG5leHRMaW5lRmVhdF07XG59O1xuXG5cbi8vIFRPRE8gcXVlc3RvIGFuZHLDoCBzcG9zdGF0byBkZW50cm8gTWFwU2VydmljZSBvIGNvbXVucXVlIGluIHVuYSBsaWJyZXJpYSBjb3JlXG5wcm90by5fc2hvd1NlbGVjdGlvbiA9IGZ1bmN0aW9uKGdlb21ldHJ5LGR1cmF0aW9uKXtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICB2YXIgZHVyYXRpb24gPSBkdXJhdGlvbiB8fCBudWxsO1xuICB2YXIgb3ZlcmxheSA9IHRoaXMuX3NlbGVjdGVkTGluZU92ZXJsYXk7XG4gIFxuICB2YXIgZmVhdHVyZSA9IG5ldyBvbC5GZWF0dXJlKCk7XG4gIGZlYXR1cmUuc2V0R2VvbWV0cnkoZ2VvbWV0cnkpO1xuICBvdmVybGF5LmdldFNvdXJjZSgpLmFkZEZlYXR1cmVzKFtmZWF0dXJlXSk7XG4gIG92ZXJsYXkuc2V0TWFwKHRoaXMubWFwKTtcbiAgaWYoZHVyYXRpb24pe1xuICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKXtcbiAgICAgIG92ZXJsYXkuc2V0TWFwKG51bGwpO1xuICAgICAgc2VsZi5fc2VsZWN0ZWRMaW5lT3ZlcmxheS5nZXRTb3VyY2UoKS5jbGVhcigpO1xuICAgIH0sZHVyYXRpb24pO1xuICB9XG59O1xuXG5wcm90by5faXNOZXcgPSBmdW5jdGlvbihmZWF0dXJlKXtcbiAgcmV0dXJuICghXy5pc05pbCh0aGlzLmVkaXRpbmdMYXllci5nZXRTb3VyY2UoKS5nZXRGZWF0dXJlQnlJZChmZWF0dXJlLmdldElkKCkpKSk7XG59O1xuXG5DdXRMaW5lVG9vbC5zdGVwcyA9IFtcbiAge1xuICAgIHR5cGU6IFwic2VsZWN0bGluZVwiXG4gIH0sXG4gIHtcbiAgICB0eXBlOiBcInNlbGVjdGN1dHBvaW50XCJcbiAgfSxcbiAge1xuICAgIHR5cGU6IFwic2VsZWN0cGFydHRva2VlcFwiXG4gIH1cbl1cbiIsInZhciBEZWxldGVJbnRlcmFjdGlvbkV2ZW50ID0gZnVuY3Rpb24odHlwZSwgZmVhdHVyZXMsIGNvb3JkaW5hdGUpIHtcblxuICB0aGlzLnR5cGUgPSB0eXBlO1xuICB0aGlzLmZlYXR1cmVzID0gZmVhdHVyZXM7XG4gIHRoaXMuY29vcmRpbmF0ZSA9IGNvb3JkaW5hdGU7XG59O1xuXG52YXIgRGVsZXRlSW50ZXJhY3Rpb24gPSBmdW5jdGlvbihvcHRpb25zKSB7XG4gIG9sLmludGVyYWN0aW9uLlBvaW50ZXIuY2FsbCh0aGlzLCB7XG4gICAgaGFuZGxlRG93bkV2ZW50OiBEZWxldGVJbnRlcmFjdGlvbi5oYW5kbGVEb3duRXZlbnRfLFxuICAgIGhhbmRsZU1vdmVFdmVudDogRGVsZXRlSW50ZXJhY3Rpb24uaGFuZGxlTW92ZUV2ZW50XyxcbiAgICBoYW5kbGVVcEV2ZW50OiBEZWxldGVJbnRlcmFjdGlvbi5oYW5kbGVVcEV2ZW50XyxcbiAgICBoYW5kbGVFdmVudDogRGVsZXRlSW50ZXJhY3Rpb24uaGFuZGxlRXZlbnRfLFxuICB9KTtcblxuICB0aGlzLnByZXZpb3VzQ3Vyc29yXyA9IHVuZGVmaW5lZDtcbiAgdGhpcy5sYXN0Q29vcmRpbmF0ZV8gPSBudWxsO1xuICB0aGlzLmZlYXR1cmVzXyA9IG9wdGlvbnMuZmVhdHVyZXMgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMuZmVhdHVyZXMgOiBudWxsO1xufTtcbm9sLmluaGVyaXRzKERlbGV0ZUludGVyYWN0aW9uLCBvbC5pbnRlcmFjdGlvbi5Qb2ludGVyKTtcblxuRGVsZXRlSW50ZXJhY3Rpb24uaGFuZGxlRXZlbnRfID0gZnVuY3Rpb24obWFwQnJvd3NlckV2ZW50KSB7XG4gIGlmIChtYXBCcm93c2VyRXZlbnQudHlwZSA9PSAna2V5ZG93bicpe1xuICAgIGlmKHRoaXMuZmVhdHVyZXNfLmdldEFycmF5KCkubGVuZ3RoICYmIG1hcEJyb3dzZXJFdmVudC5vcmlnaW5hbEV2ZW50LmtleUNvZGUgPT0gNDYpe1xuICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KFxuICAgICAgICAgIG5ldyBEZWxldGVJbnRlcmFjdGlvbkV2ZW50KFxuICAgICAgICAgICAgICAnZGVsZXRlZW5kJywgdGhpcy5mZWF0dXJlc18sXG4gICAgICAgICAgICAgIGV2ZW50LmNvb3JkaW5hdGUpKTtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgfVxuICBlbHNle1xuICAgIHJldHVybiBvbC5pbnRlcmFjdGlvbi5Qb2ludGVyLmhhbmRsZUV2ZW50LmNhbGwodGhpcyxtYXBCcm93c2VyRXZlbnQpO1xuICB9XG59O1xuXG5EZWxldGVJbnRlcmFjdGlvbi5oYW5kbGVEb3duRXZlbnRfID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgdGhpcy5sYXN0RmVhdHVyZV8gPSB0aGlzLmZlYXR1cmVzQXRQaXhlbF8oZXZlbnQucGl4ZWwsIGV2ZW50Lm1hcCk7XG4gIGlmICh0aGlzLmxhc3RGZWF0dXJlXykge1xuICAgIERlbGV0ZUludGVyYWN0aW9uLmhhbmRsZU1vdmVFdmVudF8uY2FsbCh0aGlzLCBldmVudCk7XG4gICAgdGhpcy5kaXNwYXRjaEV2ZW50KFxuICAgICAgICAgICAgbmV3IERlbGV0ZUludGVyYWN0aW9uRXZlbnQoXG4gICAgICAgICAgICAgICAgJ2RlbGV0ZWVuZCcsIHRoaXMuZmVhdHVyZXNfLFxuICAgICAgICAgICAgICAgIGV2ZW50LmNvb3JkaW5hdGUpKTtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICByZXR1cm4gZmFsc2U7XG59O1xuXG5EZWxldGVJbnRlcmFjdGlvbi5oYW5kbGVNb3ZlRXZlbnRfID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgdmFyIGVsZW0gPSBldmVudC5tYXAuZ2V0VGFyZ2V0RWxlbWVudCgpO1xuICB2YXIgaW50ZXJzZWN0aW5nRmVhdHVyZSA9IGV2ZW50Lm1hcC5mb3JFYWNoRmVhdHVyZUF0UGl4ZWwoZXZlbnQucGl4ZWwsXG4gICAgICBmdW5jdGlvbihmZWF0dXJlKSB7XG4gICAgICAgIHJldHVybiBmZWF0dXJlO1xuICAgICAgfSk7XG5cbiAgaWYgKGludGVyc2VjdGluZ0ZlYXR1cmUpIHtcbiAgICB0aGlzLnByZXZpb3VzQ3Vyc29yXyA9IGVsZW0uc3R5bGUuY3Vyc29yO1xuXG4gICAgZWxlbS5zdHlsZS5jdXJzb3IgPSAgJ3BvaW50ZXInO1xuXG4gIH0gZWxzZSB7XG4gICAgZWxlbS5zdHlsZS5jdXJzb3IgPSB0aGlzLnByZXZpb3VzQ3Vyc29yXyAhPT0gdW5kZWZpbmVkID9cbiAgICAgICAgdGhpcy5wcmV2aW91c0N1cnNvcl8gOiAnJztcbiAgICB0aGlzLnByZXZpb3VzQ3Vyc29yXyA9IHVuZGVmaW5lZDtcbiAgfVxufTtcblxuRGVsZXRlSW50ZXJhY3Rpb24ucHJvdG90eXBlLmZlYXR1cmVzQXRQaXhlbF8gPSBmdW5jdGlvbihwaXhlbCwgbWFwKSB7XG4gIHZhciBmb3VuZCA9IG51bGw7XG5cbiAgdmFyIGludGVyc2VjdGluZ0ZlYXR1cmUgPSBtYXAuZm9yRWFjaEZlYXR1cmVBdFBpeGVsKHBpeGVsLFxuICAgICAgZnVuY3Rpb24oZmVhdHVyZSkge1xuICAgICAgICByZXR1cm4gZmVhdHVyZTtcbiAgICAgIH0pO1xuXG4gIGlmICh0aGlzLmZlYXR1cmVzXyAmJlxuICAgICBfLmluY2x1ZGVzKHRoaXMuZmVhdHVyZXNfLmdldEFycmF5KCksIGludGVyc2VjdGluZ0ZlYXR1cmUpKSB7XG4gICAgZm91bmQgPSBpbnRlcnNlY3RpbmdGZWF0dXJlO1xuICB9XG5cbiAgcmV0dXJuIGZvdW5kO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBEZWxldGVJbnRlcmFjdGlvbjtcbiIsInZhciBpbmhlcml0ID0gcmVxdWlyZSgnY29yZS91dGlscy91dGlscycpLmluaGVyaXQ7XG52YXIgYmFzZSA9IHJlcXVpcmUoJ2NvcmUvdXRpbHMvdXRpbHMnKS5iYXNlO1xudmFyIEczV09iamVjdCA9IHJlcXVpcmUoJ2NvcmUvZzN3b2JqZWN0Jyk7XG52YXIgR1VJID0gcmVxdWlyZSgnZ3VpL2d1aScpO1xuXG52YXIgRGVsZXRlSW50ZXJhY3Rpb24gPSByZXF1aXJlKCcuL2RlbGV0ZWZlYXR1cmVpbnRlcmFjdGlvbicpO1xuXG5mdW5jdGlvbiBEZWxldGVGZWF0dXJlVG9vbChlZGl0b3Ipe1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIHRoaXMuZWRpdG9yID0gZWRpdG9yO1xuICB0aGlzLmlzUGF1c2FibGUgPSB0cnVlO1xuICB0aGlzLmRyYXdJbnRlcmFjdGlvbiA9IG51bGw7XG4gIHRoaXMubGF5ZXIgPSBudWxsO1xuICB0aGlzLmVkaXRpbmdMYXllciA9IG51bGw7XG5cbiAgdGhpcy5zZXR0ZXJzID0ge1xuICAgIGRlbGV0ZUZlYXR1cmU6IERlbGV0ZUZlYXR1cmVUb29sLnByb3RvdHlwZS5fZGVsZXRlRmVhdHVyZVxuICB9O1xuICBcbiAgYmFzZSh0aGlzKTtcbn1cbmluaGVyaXQoRGVsZXRlRmVhdHVyZVRvb2wsRzNXT2JqZWN0KTtcbm1vZHVsZS5leHBvcnRzID0gRGVsZXRlRmVhdHVyZVRvb2w7XG5cbnZhciBwcm90byA9IERlbGV0ZUZlYXR1cmVUb29sLnByb3RvdHlwZTtcblxuLyogQlJVVFRJU1NJTU8hIFRvY2NhIHJpZGVmaW5pcmUgdHV0dGUgbGUgcGFydGkgaW50ZXJuZSBkaSBPTDMgbm9uIGVzcG9zdGUgZGFsbGUgQVBJICovXG5cbm9sLmdlb20uR2VvbWV0cnlUeXBlID0ge1xuICBQT0lOVDogJ1BvaW50JyxcbiAgTElORV9TVFJJTkc6ICdMaW5lU3RyaW5nJyxcbiAgTElORUFSX1JJTkc6ICdMaW5lYXJSaW5nJyxcbiAgUE9MWUdPTjogJ1BvbHlnb24nLFxuICBNVUxUSV9QT0lOVDogJ011bHRpUG9pbnQnLFxuICBNVUxUSV9MSU5FX1NUUklORzogJ011bHRpTGluZVN0cmluZycsXG4gIE1VTFRJX1BPTFlHT046ICdNdWx0aVBvbHlnb24nLFxuICBHRU9NRVRSWV9DT0xMRUNUSU9OOiAnR2VvbWV0cnlDb2xsZWN0aW9uJyxcbiAgQ0lSQ0xFOiAnQ2lyY2xlJ1xufTtcblxudmFyIHN0eWxlcyA9IHt9O1xudmFyIHdoaXRlID0gWzI1NSwgMjU1LCAyNTUsIDFdO1xudmFyIGJsdWUgPSBbMCwgMTUzLCAyNTUsIDFdO1xudmFyIHJlZCA9IFsyNTUsIDAsIDAsIDFdO1xudmFyIHdpZHRoID0gMztcbnN0eWxlc1tvbC5nZW9tLkdlb21ldHJ5VHlwZS5QT0xZR09OXSA9IFtcbiAgbmV3IG9sLnN0eWxlLlN0eWxlKHtcbiAgICBmaWxsOiBuZXcgb2wuc3R5bGUuRmlsbCh7XG4gICAgICBjb2xvcjogWzI1NSwgMjU1LCAyNTUsIDAuNV1cbiAgICB9KVxuICB9KVxuXTtcbnN0eWxlc1tvbC5nZW9tLkdlb21ldHJ5VHlwZS5NVUxUSV9QT0xZR09OXSA9XG4gICAgc3R5bGVzW29sLmdlb20uR2VvbWV0cnlUeXBlLlBPTFlHT05dO1xuXG5zdHlsZXNbb2wuZ2VvbS5HZW9tZXRyeVR5cGUuTElORV9TVFJJTkddID0gW1xuICBuZXcgb2wuc3R5bGUuU3R5bGUoe1xuICAgIHN0cm9rZTogbmV3IG9sLnN0eWxlLlN0cm9rZSh7XG4gICAgICBjb2xvcjogd2hpdGUsXG4gICAgICB3aWR0aDogd2lkdGggKyAyXG4gICAgfSlcbiAgfSksXG4gIG5ldyBvbC5zdHlsZS5TdHlsZSh7XG4gICAgc3Ryb2tlOiBuZXcgb2wuc3R5bGUuU3Ryb2tlKHtcbiAgICAgIGNvbG9yOiByZWQsXG4gICAgICB3aWR0aDogd2lkdGhcbiAgICB9KVxuICB9KVxuXTtcbnN0eWxlc1tvbC5nZW9tLkdlb21ldHJ5VHlwZS5NVUxUSV9MSU5FX1NUUklOR10gPVxuICAgIHN0eWxlc1tvbC5nZW9tLkdlb21ldHJ5VHlwZS5MSU5FX1NUUklOR107XG5cbnN0eWxlc1tvbC5nZW9tLkdlb21ldHJ5VHlwZS5DSVJDTEVdID1cbiAgICBzdHlsZXNbb2wuZ2VvbS5HZW9tZXRyeVR5cGUuUE9MWUdPTl0uY29uY2F0KFxuICAgICAgICBzdHlsZXNbb2wuZ2VvbS5HZW9tZXRyeVR5cGUuTElORV9TVFJJTkddXG4gICAgKTtcblxuXG5zdHlsZXNbb2wuZ2VvbS5HZW9tZXRyeVR5cGUuUE9JTlRdID0gW1xuICBuZXcgb2wuc3R5bGUuU3R5bGUoe1xuICAgIGltYWdlOiBuZXcgb2wuc3R5bGUuQ2lyY2xlKHtcbiAgICAgIHJhZGl1czogd2lkdGggKiAyLFxuICAgICAgZmlsbDogbmV3IG9sLnN0eWxlLkZpbGwoe1xuICAgICAgICBjb2xvcjogcmVkXG4gICAgICB9KSxcbiAgICAgIHN0cm9rZTogbmV3IG9sLnN0eWxlLlN0cm9rZSh7XG4gICAgICAgIGNvbG9yOiB3aGl0ZSxcbiAgICAgICAgd2lkdGg6IHdpZHRoIC8gMlxuICAgICAgfSlcbiAgICB9KSxcbiAgICB6SW5kZXg6IEluZmluaXR5XG4gIH0pXG5dO1xuc3R5bGVzW29sLmdlb20uR2VvbWV0cnlUeXBlLk1VTFRJX1BPSU5UXSA9XG4gICAgc3R5bGVzW29sLmdlb20uR2VvbWV0cnlUeXBlLlBPSU5UXTtcblxuc3R5bGVzW29sLmdlb20uR2VvbWV0cnlUeXBlLkdFT01FVFJZX0NPTExFQ1RJT05dID1cbiAgICBzdHlsZXNbb2wuZ2VvbS5HZW9tZXRyeVR5cGUuUE9MWUdPTl0uY29uY2F0KFxuICAgICAgICBzdHlsZXNbb2wuZ2VvbS5HZW9tZXRyeVR5cGUuTElORV9TVFJJTkddLFxuICAgICAgICBzdHlsZXNbb2wuZ2VvbS5HZW9tZXRyeVR5cGUuUE9JTlRdXG4gICAgKTtcblxuXG5zdHlsZXNbb2wuZ2VvbS5HZW9tZXRyeVR5cGUuUE9MWUdPTl0gPSBfLmNvbmNhdChzdHlsZXNbb2wuZ2VvbS5HZW9tZXRyeVR5cGUuUE9MWUdPTl0sc3R5bGVzW29sLmdlb20uR2VvbWV0cnlUeXBlLkxJTkVfU1RSSU5HXSk7XG5zdHlsZXNbb2wuZ2VvbS5HZW9tZXRyeVR5cGUuR0VPTUVUUllfQ09MTEVDVElPTl0gPSBfLmNvbmNhdChzdHlsZXNbb2wuZ2VvbS5HZW9tZXRyeVR5cGUuR0VPTUVUUllfQ09MTEVDVElPTl0sc3R5bGVzW29sLmdlb20uR2VvbWV0cnlUeXBlLkxJTkVfU1RSSU5HXSk7XG4gICAgXG4vKiBGSU5FIEJSVVRUSVNTSU1PISAqL1xuXG5wcm90by5ydW4gPSBmdW5jdGlvbigpe1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIHZhciBtYXAgPSBHVUkuZ2V0Q29tcG9uZW50KCdtYXAnKS5nZXRTZXJ2aWNlKCkudmlld2VyLm1hcDtcbiAgdGhpcy5sYXllciA9IHRoaXMuZWRpdG9yLmdldFZlY3RvckxheWVyKCkuZ2V0TGF5ZXIoKTtcbiAgdGhpcy5lZGl0aW5nTGF5ZXIgPSB0aGlzLmVkaXRvci5nZXRFZGl0VmVjdG9yTGF5ZXIoKS5nZXRMYXllcigpO1xuICBcbiAgdGhpcy5fc2VsZWN0SW50ZXJhY3Rpb24gPSBuZXcgb2wuaW50ZXJhY3Rpb24uU2VsZWN0KHtcbiAgICBsYXllcnM6IFt0aGlzLmxheWVyLHRoaXMuZWRpdGluZ0xheWVyXSxcbiAgICBjb25kaXRpb246IG9sLmV2ZW50cy5jb25kaXRpb24uY2xpY2ssXG4gICAgc3R5bGU6IGZ1bmN0aW9uKGZlYXR1cmUsIHJlc29sdXRpb24pIHtcbiAgICAgIHJldHVybiBzdHlsZXNbZmVhdHVyZS5nZXRHZW9tZXRyeSgpLmdldFR5cGUoKV07XG4gICAgfVxuICB9KTtcbiAgbWFwLmFkZEludGVyYWN0aW9uKHRoaXMuX3NlbGVjdEludGVyYWN0aW9uKTtcbiAgXG4gIHRoaXMuX2RlbGV0ZUludGVyYWN0aW9uID0gbmV3IERlbGV0ZUludGVyYWN0aW9uKHtcbiAgICBmZWF0dXJlczogdGhpcy5fc2VsZWN0SW50ZXJhY3Rpb24uZ2V0RmVhdHVyZXMoKVxuICB9KTtcbiAgbWFwLmFkZEludGVyYWN0aW9uKHRoaXMuX2RlbGV0ZUludGVyYWN0aW9uKTtcbiAgXG4gIHZhciBvcmlnR2VvbWV0cnkgPSBudWxsO1xuICBcbiAgLyp0aGlzLl9zZWxlY3RJbnRlcmFjdGlvbi5vbignc2VsZWN0JyxmdW5jdGlvbihlKXtcbiAgICB2YXIgZmVhdHVyZSA9IGUuc2VsZWN0ZWRbMF07XG4gICAgb3JpZ0dlb21ldHJ5ID0gZmVhdHVyZS5nZXRHZW9tZXRyeSgpO1xuICB9KTsqL1xuICBcbiAgdGhpcy5fZGVsZXRlSW50ZXJhY3Rpb24ub24oJ2RlbGV0ZWVuZCcsZnVuY3Rpb24oZSl7XG4gICAgdmFyIGZlYXR1cmUgPSBlLmZlYXR1cmVzLmdldEFycmF5KClbMF07XG4gICAgdmFyIGlzTmV3ID0gc2VsZi5faXNOZXcoZmVhdHVyZSk7XG4gICAgLy90cnkge1xuICAgICAgaWYgKCFzZWxmLl9idXN5KXtcbiAgICAgICAgc2VsZi5fYnVzeSA9IHRydWU7XG4gICAgICAgIHNlbGYucGF1c2UodHJ1ZSk7XG4gICAgICAgIHNlbGYuZGVsZXRlRmVhdHVyZShmZWF0dXJlLGlzTmV3KVxuICAgICAgICAuYWx3YXlzKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgc2VsZi5fYnVzeSA9IGZhbHNlO1xuICAgICAgICAgIHNlbGYucGF1c2UoZmFsc2UpO1xuICAgICAgICB9KVxuICAgICAgfVxuICAgIC8vfVxuICAgIC8qY2F0Y2ggKGVycm9yKXtcbiAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcbiAgICAgIGZlYXR1cmUuc2V0R2VvbWV0cnkob3JpZ0dlb21ldHJ5KTtcbiAgICB9Ki9cbiAgfSk7XG5cbn07XG5cbnByb3RvLnBhdXNlID0gZnVuY3Rpb24ocGF1c2Upe1xuICBpZiAoXy5pc1VuZGVmaW5lZChwYXVzZSkgfHwgcGF1c2Upe1xuICAgIHRoaXMuX3NlbGVjdEludGVyYWN0aW9uLnNldEFjdGl2ZShmYWxzZSk7XG4gICAgdGhpcy5fZGVsZXRlSW50ZXJhY3Rpb24uc2V0QWN0aXZlKGZhbHNlKTtcbiAgfVxuICBlbHNlIHtcbiAgICB0aGlzLl9zZWxlY3RJbnRlcmFjdGlvbi5zZXRBY3RpdmUodHJ1ZSk7XG4gICAgdGhpcy5fZGVsZXRlSW50ZXJhY3Rpb24uc2V0QWN0aXZlKHRydWUpO1xuICB9XG59O1xuXG5wcm90by5zdG9wID0gZnVuY3Rpb24oKXtcbiAgdmFyIG1hcCA9IEdVSS5nZXRDb21wb25lbnQoJ21hcCcpLmdldFNlcnZpY2UoKS52aWV3ZXIubWFwO1xuICB0aGlzLl9zZWxlY3RJbnRlcmFjdGlvbi5nZXRGZWF0dXJlcygpLmNsZWFyKCk7XG4gIG1hcC5yZW1vdmVJbnRlcmFjdGlvbih0aGlzLl9zZWxlY3RJbnRlcmFjdGlvbik7XG4gIHRoaXMuX3NlbGVjdEludGVyYWN0aW9uID0gbnVsbDtcbiAgbWFwLnJlbW92ZUludGVyYWN0aW9uKHRoaXMuX2RlbGV0ZUludGVyYWN0aW9uKTtcbiAgdGhpcy5fZGVsZXRlSW50ZXJhY3Rpb24gPSBudWxsO1xuICByZXR1cm4gdHJ1ZTtcbn07XG5cbnByb3RvLl9kZWxldGVGZWF0dXJlID0gZnVuY3Rpb24oZmVhdHVyZSxpc05ldyl7XG4gIHRoaXMuZWRpdG9yLmRlbGV0ZUZlYXR1cmUoZmVhdHVyZSxpc05ldyk7XG4gIHRoaXMuX3NlbGVjdEludGVyYWN0aW9uLmdldEZlYXR1cmVzKCkuY2xlYXIoKTtcbiAgdGhpcy5fYnVzeSA9IGZhbHNlO1xuICB0aGlzLnBhdXNlKGZhbHNlKTtcbiAgcmV0dXJuIHRydWU7XG59O1xuXG5wcm90by5fZmFsbEJhY2sgPSBmdW5jdGlvbihmZWF0dXJlKXtcbiAgdGhpcy5fYnVzeSA9IGZhbHNlO1xuICB0aGlzLnBhdXNlKGZhbHNlKTtcbn07XG5cbnByb3RvLl9pc05ldyA9IGZ1bmN0aW9uKGZlYXR1cmUpe1xuICByZXR1cm4gKCFfLmlzTmlsKHRoaXMuZWRpdGluZ0xheWVyLmdldFNvdXJjZSgpLmdldEZlYXR1cmVCeUlkKGZlYXR1cmUuZ2V0SWQoKSkpKTtcbn07XG4iLCJ2YXIgaW5oZXJpdCA9IHJlcXVpcmUoJ2NvcmUvdXRpbHMvdXRpbHMnKS5pbmhlcml0O1xudmFyIGJhc2UgPSByZXF1aXJlKCdjb3JlL3V0aWxzL3V0aWxzJykuYmFzZTtcbnZhciBHM1dPYmplY3QgPSByZXF1aXJlKCdjb3JlL2czd29iamVjdCcpO1xudmFyIEdVSSA9IHJlcXVpcmUoJ2d1aS9ndWknKTtcblxuZnVuY3Rpb24gTW9kaWZ5RmVhdHVyZVRvb2woZWRpdG9yLG9wdGlvbnMpe1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIHRoaXMuZWRpdG9yID0gZWRpdG9yO1xuICB0aGlzLmlzUGF1c2FibGUgPSB0cnVlO1xuICB0aGlzLmRyYXdJbnRlcmFjdGlvbiA9IG51bGw7XG4gIHRoaXMubGF5ZXIgPSBudWxsO1xuICB0aGlzLmVkaXRpbmdMYXllciA9IG51bGw7XG4gIHRoaXMuX2RlbGV0ZUNvbmRpdGlvbiA9IG9wdGlvbnMuZGVsZXRlQ29uZGl0aW9uIHx8IHVuZGVmaW5lZDtcbiAgdGhpcy5fc25hcCA9IG9wdGlvbnMuc25hcCB8fCBudWxsO1xuICB0aGlzLl9zbmFwSW50ZXJhY3Rpb24gPSBudWxsOyBcblxuICB0aGlzLnNldHRlcnMgPSB7XG4gICAgbW9kaWZ5RmVhdHVyZTogTW9kaWZ5RmVhdHVyZVRvb2wucHJvdG90eXBlLl9tb2RpZnlGZWF0dXJlXG4gIH07XG4gIFxuICBiYXNlKHRoaXMpO1xufVxuaW5oZXJpdChNb2RpZnlGZWF0dXJlVG9vbCxHM1dPYmplY3QpO1xubW9kdWxlLmV4cG9ydHMgPSBNb2RpZnlGZWF0dXJlVG9vbDtcblxudmFyIHByb3RvID0gTW9kaWZ5RmVhdHVyZVRvb2wucHJvdG90eXBlO1xuXG5wcm90by5ydW4gPSBmdW5jdGlvbigpe1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIHZhciBtYXAgPSBHVUkuZ2V0Q29tcG9uZW50KCdtYXAnKS5nZXRTZXJ2aWNlKCkudmlld2VyLm1hcDtcbiAgdGhpcy5sYXllciA9IHRoaXMuZWRpdG9yLmdldFZlY3RvckxheWVyKCkuZ2V0TGF5ZXIoKTtcbiAgdGhpcy5lZGl0aW5nTGF5ZXIgPSB0aGlzLmVkaXRvci5nZXRFZGl0VmVjdG9yTGF5ZXIoKS5nZXRMYXllcigpO1xuICBcbiAgdGhpcy5fc2VsZWN0SW50ZXJhY3Rpb24gPSBuZXcgb2wuaW50ZXJhY3Rpb24uU2VsZWN0KHtcbiAgICBsYXllcnM6IFt0aGlzLmxheWVyLHRoaXMuZWRpdGluZ0xheWVyXSxcbiAgfSk7XG4gIG1hcC5hZGRJbnRlcmFjdGlvbih0aGlzLl9zZWxlY3RJbnRlcmFjdGlvbik7XG4gIFxuICB0aGlzLl9tb2RpZnlJbnRlcmFjdGlvbiA9IG5ldyBvbC5pbnRlcmFjdGlvbi5Nb2RpZnkoe1xuICAgIGZlYXR1cmVzOiB0aGlzLl9zZWxlY3RJbnRlcmFjdGlvbi5nZXRGZWF0dXJlcygpLFxuICAgIGRlbGV0ZUNvbmRpdGlvbjogdGhpcy5fZGVsZXRlQ29uZGl0aW9uLFxuICB9KTtcbiAgbWFwLmFkZEludGVyYWN0aW9uKHRoaXMuX21vZGlmeUludGVyYWN0aW9uKTtcbiAgXG4gIHZhciBvcmlnR2VvbWV0cnkgPSBudWxsO1xuICBcbiAgdGhpcy5fbW9kaWZ5SW50ZXJhY3Rpb24ub24oJ21vZGlmeXN0YXJ0JyxmdW5jdGlvbihlKXtcbiAgICB2YXIgZmVhdHVyZSA9IGUuZmVhdHVyZXMuZ2V0QXJyYXkoKVswXTtcbiAgICBvcmlnR2VvbWV0cnkgPSBmZWF0dXJlLmdldEdlb21ldHJ5KCkuY2xvbmUoKTtcbiAgfSk7XG4gIFxuICB0aGlzLl9tb2RpZnlJbnRlcmFjdGlvbi5vbignbW9kaWZ5ZW5kJyxmdW5jdGlvbihlKXtcbiAgICB2YXIgZmVhdHVyZSA9IGUuZmVhdHVyZXMuZ2V0QXJyYXkoKVswXTtcbiAgICB2YXIgaXNOZXcgPSBzZWxmLl9pc05ldyhmZWF0dXJlKTtcbiAgICAvL3RyeSB7XG4gICAgICBpZiAoIXNlbGYuX2J1c3kpe1xuICAgICAgICBzZWxmLl9idXN5ID0gdHJ1ZTtcbiAgICAgICAgc2VsZi5wYXVzZSh0cnVlKTtcbiAgICAgICAgc2VsZi5tb2RpZnlGZWF0dXJlKGZlYXR1cmUsaXNOZXcpXG4gICAgICAgIC5mYWlsKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgZmVhdHVyZS5zZXRHZW9tZXRyeShvcmlnR2VvbWV0cnkpO1xuICAgICAgICB9KVxuICAgICAgICAuYWx3YXlzKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgc2VsZi5fYnVzeSA9IGZhbHNlO1xuICAgICAgICAgIHNlbGYucGF1c2UoZmFsc2UpO1xuICAgICAgICB9KVxuICAgICAgfVxuICAgIC8vfVxuICAgIC8vY2F0Y2ggKGVycm9yKXtcbiAgICAvLyAgY29uc29sZS5sb2coZXJyb3IpO1xuICAgIC8vICBmZWF0dXJlLnNldEdlb21ldHJ5KG9yaWdHZW9tZXRyeSk7XG4gICAgLy99XG4gIH0pO1xuICBcbiAgaWYgKHRoaXMuX3NuYXApe1xuICAgIHRoaXMuX3NuYXBJbnRlcmFjdGlvbiA9IG5ldyBvbC5pbnRlcmFjdGlvbi5TbmFwKHtcbiAgICAgIHNvdXJjZTogdGhpcy5fc25hcC52ZWN0b3JMYXllci5nZXRTb3VyY2UoKVxuICAgIH0pO1xuICAgIG1hcC5hZGRJbnRlcmFjdGlvbih0aGlzLl9zbmFwSW50ZXJhY3Rpb24pO1xuICB9XG59O1xuXG5wcm90by5wYXVzZSA9IGZ1bmN0aW9uKHBhdXNlKXtcbiAgaWYgKF8uaXNVbmRlZmluZWQocGF1c2UpIHx8IHBhdXNlKXtcbiAgICBpZiAodGhpcy5fc25hcEludGVyYWN0aW9uKXtcbiAgICAgIHRoaXMuX3NuYXBJbnRlcmFjdGlvbi5zZXRBY3RpdmUoZmFsc2UpO1xuICAgIH1cbiAgICB0aGlzLl9zZWxlY3RJbnRlcmFjdGlvbi5zZXRBY3RpdmUoZmFsc2UpO1xuICAgIHRoaXMuX21vZGlmeUludGVyYWN0aW9uLnNldEFjdGl2ZShmYWxzZSk7XG4gIH1cbiAgZWxzZSB7XG4gICAgaWYgKHRoaXMuX3NuYXBJbnRlcmFjdGlvbil7XG4gICAgICB0aGlzLl9zbmFwSW50ZXJhY3Rpb24uc2V0QWN0aXZlKHRydWUpO1xuICAgIH1cbiAgICB0aGlzLl9zZWxlY3RJbnRlcmFjdGlvbi5zZXRBY3RpdmUodHJ1ZSk7XG4gICAgdGhpcy5fbW9kaWZ5SW50ZXJhY3Rpb24uc2V0QWN0aXZlKHRydWUpO1xuICB9XG59O1xuXG5wcm90by5zdG9wID0gZnVuY3Rpb24oKXtcbiAgdmFyIG1hcCA9IEdVSS5nZXRDb21wb25lbnQoJ21hcCcpLmdldFNlcnZpY2UoKS52aWV3ZXIubWFwO1xuICB0aGlzLl9zZWxlY3RJbnRlcmFjdGlvbi5nZXRGZWF0dXJlcygpLmNsZWFyKCk7XG4gIGlmICh0aGlzLl9zbmFwSW50ZXJhY3Rpb24pe1xuICAgICBtYXAucmVtb3ZlSW50ZXJhY3Rpb24odGhpcy5fc25hcEludGVyYWN0aW9uKTtcbiAgICAgdGhpcy5fc25hcEludGVyYWN0aW9uID0gbnVsbDtcbiAgfVxuICBtYXAucmVtb3ZlSW50ZXJhY3Rpb24odGhpcy5fc2VsZWN0SW50ZXJhY3Rpb24pO1xuICB0aGlzLl9zZWxlY3RJbnRlcmFjdGlvbiA9IG51bGw7XG4gIG1hcC5yZW1vdmVJbnRlcmFjdGlvbih0aGlzLl9tb2RpZnlJbnRlcmFjdGlvbik7XG4gIHRoaXMuX21vZGlmeUludGVyYWN0aW9uID0gbnVsbDtcbiAgcmV0dXJuIHRydWU7XG59O1xuXG5wcm90by5fbW9kaWZ5RmVhdHVyZSA9IGZ1bmN0aW9uKGZlYXR1cmUsaXNOZXcpe1xuICAvLyBhZ2dpb25ybyBsYSBnZW9tZXRyaWEgbmVsIGJ1ZmZlciBkaSBlZGl0aW5nXG4gIHRoaXMuZWRpdG9yLnVwZGF0ZUZlYXR1cmUoZmVhdHVyZSxpc05ldyk7XG4gIHRoaXMuX3NlbGVjdEludGVyYWN0aW9uLmdldEZlYXR1cmVzKCkuY2xlYXIoKTtcbiAgdGhpcy5fYnVzeSA9IGZhbHNlO1xuICB0aGlzLnBhdXNlKGZhbHNlKTtcbiAgcmV0dXJuIHRydWU7XG59O1xuXG5wcm90by5yZW1vdmVQb2ludCA9IGZ1bmN0aW9uKGNvb3JkaW5hdGUpe1xuICBpZiAodGhpcy5fbW9kaWZ5SW50ZXJhY3Rpb24pe1xuICAgIC8vIHByb3ZvIGEgcmltdW92ZXJlIGwndWx0aW1vIHB1bnRvLiBOZWwgY2FzbyBub24gZXNpc3RhIGxhIGdlb21ldHJpYSBnZXN0aXNjbyBzaWxlbnppb3NhbWVudGUgbCdlcnJvcmVcbiAgICB0cnl7XG4gICAgICB0aGlzLl9tb2RpZnlJbnRlcmFjdGlvbi5yZW1vdmVQb2ludCgpO1xuICAgIH1cbiAgICBjYXRjaCAoZSl7XG4gICAgICBjb25zb2xlLmxvZyhlKTtcbiAgICB9XG4gIH1cbn07XG5cbnByb3RvLl9mYWxsQmFjayA9IGZ1bmN0aW9uKGZlYXR1cmUpe1xuICB0aGlzLl9idXN5ID0gZmFsc2U7XG4gIHRoaXMucGF1c2UoZmFsc2UpO1xufTtcblxucHJvdG8uX2lzTmV3ID0gZnVuY3Rpb24oZmVhdHVyZSl7XG4gIHJldHVybiAoIV8uaXNOaWwodGhpcy5lZGl0aW5nTGF5ZXIuZ2V0U291cmNlKCkuZ2V0RmVhdHVyZUJ5SWQoZmVhdHVyZS5nZXRJZCgpKSkpO1xufTtcbiIsInZhciBpbmhlcml0ID0gcmVxdWlyZSgnY29yZS91dGlscy91dGlscycpLmluaGVyaXQ7XG52YXIgYmFzZSA9IHJlcXVpcmUoJ2NvcmUvdXRpbHMvdXRpbHMnKS5iYXNlO1xudmFyIEczV09iamVjdCA9IHJlcXVpcmUoJ2NvcmUvZzN3b2JqZWN0Jyk7XG52YXIgR1VJID0gcmVxdWlyZSgnZ3VpL2d1aScpO1xuXG5mdW5jdGlvbiBNb3ZlRmVhdHVyZVRvb2woZWRpdG9yKXtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICB0aGlzLmVkaXRvciA9IGVkaXRvcjtcbiAgdGhpcy5pc1BhdXNhYmxlID0gdHJ1ZTtcbiAgdGhpcy5kcmF3SW50ZXJhY3Rpb24gPSBudWxsO1xuICB0aGlzLmxheWVyID0gbnVsbDtcbiAgdGhpcy5lZGl0aW5nTGF5ZXIgPSBudWxsO1xuICBcbiAgdGhpcy5fb3JpZ0dlb21ldHJ5ID0gbnVsbDtcblxuICB0aGlzLnNldHRlcnMgPSB7XG4gICAgbW92ZUZlYXR1cmU6IHtcbiAgICAgIGZuYzogTW92ZUZlYXR1cmVUb29sLnByb3RvdHlwZS5fbW92ZUZlYXR1cmUsXG4gICAgICBmYWxsYmFjazogTW92ZUZlYXR1cmVUb29sLnByb3RvdHlwZS5fZmFsbEJhY2tcbiAgICB9XG4gIH07XG4gIFxuICBiYXNlKHRoaXMpO1xufVxuaW5oZXJpdChNb3ZlRmVhdHVyZVRvb2wsRzNXT2JqZWN0KTtcbm1vZHVsZS5leHBvcnRzID0gTW92ZUZlYXR1cmVUb29sO1xuXG52YXIgcHJvdG8gPSBNb3ZlRmVhdHVyZVRvb2wucHJvdG90eXBlO1xuXG5wcm90by5ydW4gPSBmdW5jdGlvbigpe1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIHZhciBtYXAgPSBHVUkuZ2V0Q29tcG9uZW50KCdtYXAnKS5nZXRTZXJ2aWNlKCkudmlld2VyLm1hcDtcbiAgdGhpcy5sYXllciA9IHRoaXMuZWRpdG9yLmdldFZlY3RvckxheWVyKCkuZ2V0TGF5ZXIoKTtcbiAgdGhpcy5lZGl0aW5nTGF5ZXIgPSB0aGlzLmVkaXRvci5nZXRFZGl0VmVjdG9yTGF5ZXIoKS5nZXRMYXllcigpO1xuICBcbiAgdGhpcy5fc2VsZWN0SW50ZXJhY3Rpb24gPSBuZXcgb2wuaW50ZXJhY3Rpb24uU2VsZWN0KHtcbiAgICBsYXllcnM6IFt0aGlzLmxheWVyLHRoaXMuZWRpdGluZ0xheWVyXSxcbiAgICBjb25kaXRpb246IG9sLmV2ZW50cy5jb25kaXRpb24uY2xpY2tcbiAgfSk7XG4gIG1hcC5hZGRJbnRlcmFjdGlvbih0aGlzLl9zZWxlY3RJbnRlcmFjdGlvbik7XG4gIFxuICB0aGlzLl90cmFuc2xhdGVJbnRlcmFjdGlvbiA9IG5ldyBvbC5pbnRlcmFjdGlvbi5UcmFuc2xhdGUoe1xuICAgIGZlYXR1cmVzOiB0aGlzLl9zZWxlY3RJbnRlcmFjdGlvbi5nZXRGZWF0dXJlcygpXG4gIH0pO1xuICBtYXAuYWRkSW50ZXJhY3Rpb24odGhpcy5fdHJhbnNsYXRlSW50ZXJhY3Rpb24pO1xuICBcbiAgdGhpcy5fdHJhbnNsYXRlSW50ZXJhY3Rpb24ub24oJ3RyYW5zbGF0ZXN0YXJ0JyxmdW5jdGlvbihlKXtcbiAgICB2YXIgZmVhdHVyZSA9IGUuZmVhdHVyZXMuZ2V0QXJyYXkoKVswXTtcbiAgICBzZWxmLl9vcmlnR2VvbWV0cnkgPSBmZWF0dXJlLmdldEdlb21ldHJ5KCkuY2xvbmUoKTtcbiAgICBzZWxmLmVkaXRvci5lbWl0KCdtb3Zlc3RhcnQnLGZlYXR1cmUpO1xuICB9KTtcbiAgXG4gIHRoaXMuX3RyYW5zbGF0ZUludGVyYWN0aW9uLm9uKCd0cmFuc2xhdGVlbmQnLGZ1bmN0aW9uKGUpe1xuICAgIHZhciBmZWF0dXJlID0gZS5mZWF0dXJlcy5nZXRBcnJheSgpWzBdO1xuICAgIC8vdHJ5IHtcbiAgICAgIGlmICghc2VsZi5fYnVzeSl7XG4gICAgICAgIHNlbGYuX2J1c3kgPSB0cnVlO1xuICAgICAgICBzZWxmLnBhdXNlKCk7XG4gICAgICAgIHNlbGYubW92ZUZlYXR1cmUoZmVhdHVyZSlcbiAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzKXtcbiAgICAgICAgICBzZWxmLnBhdXNlKGZhbHNlKTtcbiAgICAgICAgfSlcbiAgICAgICAgLmZhaWwoZnVuY3Rpb24oKXtcbiAgICAgICAgICBmZWF0dXJlLnNldEdlb21ldHJ5KHNlbGYuX29yaWdHZW9tZXRyeSk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIC8vfVxuICAgIC8qY2F0Y2ggKGVycm9yKXtcbiAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcbiAgICAgIGZlYXR1cmUuc2V0R2VvbWV0cnkoc2VsZi5fb3JpZ0dlb21ldHJ5KTtcbiAgICB9Ki9cbiAgfSk7XG5cbn07XG5cbnByb3RvLnBhdXNlID0gZnVuY3Rpb24ocGF1c2Upe1xuICBpZiAoXy5pc1VuZGVmaW5lZChwYXVzZSkgfHwgcGF1c2Upe1xuICAgIHRoaXMuX3NlbGVjdEludGVyYWN0aW9uLnNldEFjdGl2ZShmYWxzZSk7XG4gICAgdGhpcy5fdHJhbnNsYXRlSW50ZXJhY3Rpb24uc2V0QWN0aXZlKGZhbHNlKTtcbiAgfVxuICBlbHNlIHtcbiAgICB0aGlzLl9zZWxlY3RJbnRlcmFjdGlvbi5zZXRBY3RpdmUodHJ1ZSk7XG4gICAgdGhpcy5fdHJhbnNsYXRlSW50ZXJhY3Rpb24uc2V0QWN0aXZlKHRydWUpO1xuICB9XG59O1xuXG5wcm90by5zdG9wID0gZnVuY3Rpb24oKXtcbiAgdmFyIG1hcCA9IEdVSS5nZXRDb21wb25lbnQoJ21hcCcpLmdldFNlcnZpY2UoKS52aWV3ZXIubWFwO1xuICB0aGlzLl9zZWxlY3RJbnRlcmFjdGlvbi5nZXRGZWF0dXJlcygpLmNsZWFyKCk7XG4gIG1hcC5yZW1vdmVJbnRlcmFjdGlvbih0aGlzLl9zZWxlY3RJbnRlcmFjdGlvbik7XG4gIHRoaXMuX3NlbGVjdEludGVyYWN0aW9uID0gbnVsbDtcbiAgbWFwLnJlbW92ZUludGVyYWN0aW9uKHRoaXMuX3RyYW5zbGF0ZUludGVyYWN0aW9uKTtcbiAgdGhpcy5fdHJhbnNsYXRlSW50ZXJhY3Rpb24gPSBudWxsO1xuICByZXR1cm4gdHJ1ZTtcbn07XG5cbnByb3RvLl9tb3ZlRmVhdHVyZSA9IGZ1bmN0aW9uKGZlYXR1cmUpe1xuICB0aGlzLmVkaXRvci5lbWl0KCdtb3ZlZW5kJyxmZWF0dXJlKTtcbiAgdGhpcy5lZGl0b3IudXBkYXRlRmVhdHVyZShmZWF0dXJlKTtcbiAgdGhpcy5fc2VsZWN0SW50ZXJhY3Rpb24uZ2V0RmVhdHVyZXMoKS5jbGVhcigpO1xuICB0aGlzLl9idXN5ID0gZmFsc2U7XG4gIHRoaXMucGF1c2UoZmFsc2UpO1xuICByZXR1cm4gdHJ1ZTtcbn07XG5cbnByb3RvLl9mYWxsQmFjayA9IGZ1bmN0aW9uKGZlYXR1cmUpe1xuICB0aGlzLl9idXN5ID0gZmFsc2U7XG4gIHRoaXMucGF1c2UoZmFsc2UpO1xufTtcbiIsInZhciBpbmhlcml0ID0gcmVxdWlyZSgnY29yZS91dGlscy91dGlscycpLmluaGVyaXQ7XG52YXIgYmFzZSA9IHJlcXVpcmUoJ2NvcmUvdXRpbHMvdXRpbHMnKS5iYXNlO1xudmFyIG5vb3AgPSByZXF1aXJlKCdjb3JlL3V0aWxzL3V0aWxzJykubm9vcDtcbnZhciBHM1dPYmplY3QgPSByZXF1aXJlKCdjb3JlL2czd29iamVjdCcpO1xudmFyIFBpY2tGZWF0dXJlSW50ZXJhY3Rpb24gPSByZXF1aXJlKCdnM3ctb2wzL3NyYy9pbnRlcmFjdGlvbnMvcGlja2ZlYXR1cmVpbnRlcmFjdGlvbicpO1xudmFyIEdVSSA9IHJlcXVpcmUoJ2d1aS9ndWknKTtcblxuZnVuY3Rpb24gUGlja0ZlYXR1cmVUb29sKGVkaXRvcil7XG4gIHZhciBzZWxmID0gdGhpcztcbiAgdGhpcy5lZGl0b3IgPSBlZGl0b3I7XG4gIHRoaXMuaXNQYXVzYWJsZSA9IHRydWU7XG4gIHRoaXMucGlja0ZlYXR1cmVJbnRlcmFjdGlvbiA9IG51bGw7XG4gIHRoaXMuX3J1bm5pbmcgPSBmYWxzZTtcbiAgdGhpcy5fYnVzeSA9IGZhbHNlO1xuICBcbiAgLy8gcXVpIHNpIGRlZmluaXNjb25vIGkgbWV0b2RpIGNoZSB2b2dsaWFtbyBwb3RlciBpbnRlcmNldHRhcmUsIGVkIGV2ZW50dWFsbWVudGUgYmxvY2NhcmUgKHZlZGkgQVBJIEczV09iamVjdClcbiAgdGhpcy5zZXR0ZXJzID0ge1xuICAgIHBpY2tGZWF0dXJlOiBub29wLFxuICB9O1xuICBcbiAgYmFzZSh0aGlzKTtcbn1cbmluaGVyaXQoUGlja0ZlYXR1cmVUb29sLEczV09iamVjdCk7XG5tb2R1bGUuZXhwb3J0cyA9IFBpY2tGZWF0dXJlVG9vbDtcblxudmFyIHByb3RvID0gUGlja0ZlYXR1cmVUb29sLnByb3RvdHlwZTtcblxuLy8gbWV0b2RvIGVzZWd1aXRvIGFsbCdhdnZpbyBkZWwgdG9vbFxucHJvdG8ucnVuID0gZnVuY3Rpb24oKXtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICAvL3ZhciBtYXAgPSBNYXBTZXJ2aWNlLnZpZXdlci5tYXA7XG4gIHZhciBsYXllcnMgPSBbdGhpcy5lZGl0b3IuZ2V0VmVjdG9yTGF5ZXIoKS5nZXRMYXllcigpLHRoaXMuZWRpdG9yLmdldEVkaXRWZWN0b3JMYXllcigpLmdldExheWVyKCldO1xuICBcbiAgdGhpcy5waWNrRmVhdHVyZUludGVyYWN0aW9uID0gbmV3IFBpY2tGZWF0dXJlSW50ZXJhY3Rpb24oe1xuICAgIGxheWVyczogbGF5ZXJzXG4gIH0pO1xuICBcbiAgdGhpcy5waWNrRmVhdHVyZUludGVyYWN0aW9uLm9uKCdwaWNrZWQnLGZ1bmN0aW9uKGUpe1xuICAgIGlmICghc2VsZi5fYnVzeSl7XG4gICAgICBzZWxmLl9idXN5ID0gdHJ1ZTtcbiAgICAgIHNlbGYucGF1c2UodHJ1ZSk7XG4gICAgICBzZWxmLnBpY2tGZWF0dXJlKGUuZmVhdHVyZSlcbiAgICAgIC50aGVuKGZ1bmN0aW9uKHJlcyl7XG4gICAgICAgIHNlbGYuX2J1c3kgPSBmYWxzZTtcbiAgICAgICAgc2VsZi5wYXVzZShmYWxzZSk7XG4gICAgICB9KVxuICAgIH1cbiAgfSk7XG4gIFxuICAvL21hcC5hZGRJbnRlcmFjdGlvbih0aGlzLnBpY2tGZWF0dXJlSW50ZXJhY3Rpb24pO1xuICAvL3RoaXMucGlja0ZlYXR1cmVJbnRlcmFjdGlvbi5zZXRBY3RpdmUodHJ1ZSk7XG4gIHZhciBtYXBTZXJ2aWNlID0gR1VJLmdldENvbXBvbmVudCgnbWFwJykuZ2V0U2VydmljZSgpO1xuICBtYXBTZXJ2aWNlLnB1c2hJbnRlcmFjdGlvbih0aGlzLnBpY2tGZWF0dXJlSW50ZXJhY3Rpb24pO1xufTtcblxucHJvdG8ucGF1c2UgPSBmdW5jdGlvbihwYXVzZSl7XG4gIGlmIChfLmlzVW5kZWZpbmVkKHBhdXNlKSB8fCBwYXVzZSl7XG4gICAgdGhpcy5waWNrRmVhdHVyZUludGVyYWN0aW9uLnNldEFjdGl2ZShmYWxzZSk7XG4gIH1cbiAgZWxzZSB7XG4gICAgdGhpcy5waWNrRmVhdHVyZUludGVyYWN0aW9uLnNldEFjdGl2ZSh0cnVlKTtcbiAgfVxufTtcblxuLy8gbWV0b2RvIGVzZWd1aXRvIGFsbGEgZGlzYXR0aXZhemlvbmUgZGVsIHRvb2xcbnByb3RvLnN0b3AgPSBmdW5jdGlvbigpe1xuICBHVUkuZ2V0Q29tcG9uZW50KCdtYXAnKS5nZXRTZXJ2aWNlKCkucG9wSW50ZXJhY3Rpb24oKTtcbiAgcmV0dXJuIHRydWU7XG59O1xuXG5wcm90by5fZmFsbEJhY2sgPSBmdW5jdGlvbihmZWF0dXJlKXtcbiAgdGhpcy5fYnVzeSA9IGZhbHNlO1xuICB0aGlzLnBhdXNlKGZhbHNlKTtcbn07XG4iLCJ2YXIgaW5oZXJpdCA9IHJlcXVpcmUoJ2NvcmUvdXRpbHMvdXRpbHMnKS5pbmhlcml0O1xudmFyIGJhc2UgPSByZXF1aXJlKCdjb3JlL3V0aWxzL3V0aWxzJykuYmFzZTtcbnZhciBHM1dPYmplY3QgPSByZXF1aXJlKCdjb3JlL2czd29iamVjdCcpO1xuXG5mdW5jdGlvbiBFZGl0aW5nVG9vbChlZGl0b3Isb3B0aW9ucyl7XG4gIHRoaXMuZWRpdG9yID0gZWRpdG9yO1xuICB0aGlzLmxheWVyID0gdGhpcy5lZGl0b3IuZ2V0VmVjdG9yTGF5ZXIoKS5nZXRMYXllcigpO1xuICB0aGlzLmVkaXRpbmdMYXllciA9IHRoaXMuZWRpdG9yLmdldEVkaXRWZWN0b3JMYXllcigpLmdldExheWVyKCk7XG4gIHRoaXMubWFwID0gR1VJLmdldENvbXBvbmVudCgnbWFwJykuZ2V0U2VydmljZSgpLnZpZXdlci5tYXA7XG4gIHRoaXMuaXNQYXVzYWJsZSA9IGZhbHNlO1xuICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuICB0aGlzLnN0ZXBzID0gbnVsbDtcbiAgXG4gIGJhc2UodGhpcyk7XG59XG5pbmhlcml0KEVkaXRpbmdUb29sLEczV09iamVjdCk7XG5cbnZhciBwcm90byA9IEVkaXRpbmdUb29sLnByb3RvdHlwZTtcblxucHJvdG8uc3RvcCA9IGZ1bmN0aW9uKCl7XG4gIGlmICh0aGlzLnN0ZXBzKSB7XG4gICAgdGhpcy5zdGVwcy5kZXN0cm95KCk7XG4gIH1cbiAgcmV0dXJuIHRydWU7XG59XG5cbkVkaXRpbmdUb29sLlN0ZXBzID0gZnVuY3Rpb24oc3RlcHMpe1xuICB2YXIgaW5kZXggPSAtMTtcbiAgdmFyIHN0ZXBzID0gc3RlcHM7XG4gIFxuICB0aGlzLm5leHQgPSBmdW5jdGlvbigpe1xuICAgIGluZGV4ICs9IDE7XG4gICAgdmFyIHN0ZXAgPSBzdGVwc1tpbmRleF07XG4gICAgdGhpcy5lbWl0KCdzdGVwJyxpbmRleCxzdGVwKTtcbiAgfTtcbiAgXG4gIHRoaXMuY3VycmVudFN0ZXAgPSBmdW5jdGlvbigpe1xuICAgIHJldHVybiBzdGVwc1tpbmRleF07XG4gIH07XG4gIFxuICB0aGlzLmN1cnJlbnRTdGVwSW5kZXggPSBmdW5jdGlvbigpe1xuICAgIHJldHVybiBpbmRleDtcbiAgfTtcbiAgXG4gIHRoaXMudG90YWxTdGVwcyA9IGZ1bmN0aW9uKCl7XG4gICAgcmV0dXJuIHN0ZXBzLmxlbmd0aDtcbiAgfTtcbiAgXG4gIHRoaXMucmVzZXQgPSBmdW5jdGlvbigpe1xuICAgIGluZGV4ID0gMDtcbiAgfTtcbiAgXG4gIHRoaXMuZGVzdHJveSA9IGZ1bmN0aW9uKCl7XG4gICAgdGhpcy5yZW1vdmVBbGxMaXN0ZW5lcnMoKTtcbiAgfTtcbiAgXG4gIHRoaXMuY29tcGxldGVkID0gZnVuY3Rpb24oKXtcbiAgICB0aGlzLmVtaXQoJ2NvbXBsZXRlJyk7XG4gICAgdGhpcy5yZXNldCgpO1xuICB9O1xuICBcbiAgdGhpcy5pbnNlcnRTdGVwQXQgPSBmdW5jdGlvbihpZHgsc3RlcCl7XG4gICAgc3RlcHMuc3BsaWNlKGlkeCwwLHN0ZXApO1xuICB9XG59XG5pbmhlcml0KEVkaXRpbmdUb29sLlN0ZXBzLEczV09iamVjdCk7XG5cbm1vZHVsZS5leHBvcnRzID0gRWRpdGluZ1Rvb2xcbiIsInZhciBpbmhlcml0ID0gcmVxdWlyZSgnY29yZS91dGlscy91dGlscycpLmluaGVyaXQ7XG52YXIgbm9vcCA9IHJlcXVpcmUoJ2NvcmUvdXRpbHMvdXRpbHMnKS5ub29wO1xuXG4vKipcbiAqIFVuIG9nZ2V0dG8gYmFzZSBpbiBncmFkbyBkaSBnZXN0aXJlIGV2ZW50dWFsaSBzZXR0ZXIgZSByZWxhdGl2YSBjYXRlbmEgZGkgbGlzdGVuZXJzLlxuICogQGNvbnN0cnVjdG9yXG4gKi9cbnZhciBHM1dPYmplY3QgPSBmdW5jdGlvbigpe1xuICBpZiAodGhpcy5zZXR0ZXJzKXtcbiAgICB0aGlzLl9zZXR1cExpc3RlbmVyc0NoYWluKHRoaXMuc2V0dGVycyk7XG4gIH1cbn07XG5pbmhlcml0KEczV09iamVjdCxFdmVudEVtaXR0ZXIpO1xuXG52YXIgcHJvdG8gPSBHM1dPYmplY3QucHJvdG90eXBlO1xuXG4vKipcbiAqIEluc2VyaXNjZSB1biBsaXN0ZW5lciBkb3BvIGNoZSDDqCBzdGF0byBlc2VndWl0byBpbCBzZXR0ZXJcbiAqIEBwYXJhbSB7c3RyaW5nfSBzZXR0ZXIgLSBJbCBub21lIGRlbCBtZXRvZG8gc3UgY3VpIHNpIGN1b2xlIHJlZ2lzdHJhcmUgdW5hIGZ1bnppb25lIGxpc3RlbmVyXG4gKiBAcGFyYW0ge2Z1bmN0aW9ufSBsaXN0ZW5lciAtIFVuYSBmdW56aW9uZSBsaXN0ZW5lciAoc29sbyBzaW5jcm9uYSlcbiAqL1xucHJvdG8ub25hZnRlciA9IGZ1bmN0aW9uKHNldHRlcixsaXN0ZW5lcil7XG4gIHJldHVybiB0aGlzLl9vbnNldHRlcignYWZ0ZXInLHNldHRlcixsaXN0ZW5lcixmYWxzZSk7XG59O1xuXG4vLyB1biBsaXN0ZW5lciBwdcOyIHJlZ2lzdHJhcnNpIGluIG1vZG8gZGEgZXNzZXJlIGVzZWd1aXRvIFBSSU1BIGRlbGwnZXNlY3V6aW9uZSBkZWwgbWV0b2RvIHNldHRlci4gUHXDsiByaXRvcm5hcmUgdHJ1ZS9mYWxzZSBwZXJcbi8vIHZvdGFyZSBhIGZhdm9yZSBvIG1lbm8gZGVsbCdlc2VjdXppb25lIGRlbCBzZXR0ZXIuIFNlIG5vbiByaXRvcm5hIG51bGxhIG8gdW5kZWZpbmVkLCBub24gdmllbmUgY29uc2lkZXJhdG8gdm90YW50ZVxuLyoqXG4gKiBJbnNlcmlzY2UgdW4gbGlzdGVuZXIgcHJpbWEgY2hlIHZlbmdhIGVzZWd1aXRvIGlsIHNldHRlci4gU2Ugcml0b3JuYSBmYWxzZSBpbCBzZXR0ZXIgbm9uIHZpZW5lIGVzZWd1aXRvXG4gKiBAcGFyYW0ge3N0cmluZ30gc2V0dGVyIC0gSWwgbm9tZSBkZWwgbWV0b2RvIHN1IGN1aSBzaSBjdW9sZSByZWdpc3RyYXJlIHVuYSBmdW56aW9uZSBsaXN0ZW5lclxuICogQHBhcmFtIHtmdW5jdGlvbn0gbGlzdGVuZXIgLSBVbmEgZnVuemlvbmUgbGlzdGVuZXIsIGEgY3VpIHZpZW5lIHBhc3NhdG8gdW5hIGZ1bnppb25lIFwibmV4dFwiIGNvbWUgdWx0aW1vIHBhcmFtZXRybywgZGEgdXNhcmUgbmVsIGNhc28gZGkgbGlzdGVuZXIgYXNpbmNyb25pXG4gKi9cbnByb3RvLm9uYmVmb3JlID0gZnVuY3Rpb24oc2V0dGVyLGxpc3RlbmVyKXtcbiAgcmV0dXJuIHRoaXMuX29uc2V0dGVyKCdiZWZvcmUnLHNldHRlcixsaXN0ZW5lcixmYWxzZSk7XG59O1xuXG4vKipcbiAqIEluc2VyaXNjZSB1biBsaXN0ZW5lciBwcmltYSBjaGUgdmVuZ2EgZXNlZ3VpdG8gaWwgc2V0dGVyLiBBbCBsaXN0ZW5lciB2aWVuZSBwYXNzYXRvIHVuYSBmdW56aW9uZSBcIm5leHRcIiBjb21lIHVsdGltbyBwYXJhbWV0cm8sIGRhIGNoaWFtYXJlIGNvbiBwYXJhbWV0cm8gdHJ1ZS9mYWxzZSBwZXIgZmFyIHByb3NlZ3VpcmUgbyBtZW5vIGlsIHNldHRlclxuICogQHBhcmFtIHtzdHJpbmd9IHNldHRlciAtIElsIG5vbWUgZGVsIG1ldG9kbyBzdSBjdWkgc2kgY3VvbGUgcmVnaXN0cmFyZSB1bmEgZnVuemlvbmUgbGlzdGVuZXJcbiAqIEBwYXJhbSB7ZnVuY3Rpb259IGxpc3RlbmVyIC0gVW5hIGZ1bnppb25lIGxpc3RlbmVyLCBhIGN1aSBcbiAqL1xucHJvdG8ub25iZWZvcmVhc3luYyA9IGZ1bmN0aW9uKHNldHRlcixsaXN0ZW5lcil7XG4gIHJldHVybiB0aGlzLl9vbnNldHRlcignYmVmb3JlJyxzZXR0ZXIsbGlzdGVuZXIsdHJ1ZSk7XG59O1xuXG5wcm90by51biA9IGZ1bmN0aW9uKHNldHRlcixrZXkpe1xuICBfLmZvckVhY2godGhpcy5zZXR0ZXJzTGlzdGVuZXJzLGZ1bmN0aW9uKHNldHRlcnNMaXN0ZW5lcnMsd2hlbil7XG4gICAgXy5mb3JFYWNoKHNldHRlcnNMaXN0ZW5lcnNbc2V0dGVyXSxmdW5jdGlvbihzZXR0ZXJMaXN0ZW5lcil7XG4gICAgICBpZihzZXR0ZXJMaXN0ZW5lci5rZXkgPT0ga2V5KXtcbiAgICAgICAgZGVsZXRlIHNldHRlckxpc3RlbmVyO1xuICAgICAgfVxuICAgIH0pXG4gIH0pXG59O1xuXG5wcm90by5fb25zZXR0ZXIgPSBmdW5jdGlvbih3aGVuLHNldHRlcixsaXN0ZW5lcixhc3luYyl7IC8qd2hlbj1iZWZvcmV8YWZ0ZXIsIHR5cGU9c3luY3xhc3luYyovXG4gIHZhciBzZXR0ZXJzTGlzdGVuZXJzID0gdGhpcy5zZXR0ZXJzTGlzdGVuZXJzW3doZW5dO1xuICB2YXIgbGlzdGVuZXJLZXkgPSBcIlwiK01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSoxMDAwMDAwKStcIlwiK0RhdGUubm93KCk7XG4gIC8qaWYgKCh3aGVuID09ICdiZWZvcmUnKSAmJiAhYXN5bmMpe1xuICAgIGxpc3RlbmVyID0gdGhpcy5fbWFrZUNoYWluYWJsZShsaXN0ZW5lcik7XG4gIH0qL1xuICBzZXR0ZXJzTGlzdGVuZXJzW3NldHRlcl0ucHVzaCh7XG4gICAga2V5OiBsaXN0ZW5lcktleSxcbiAgICBmbmM6IGxpc3RlbmVyLFxuICAgIGFzeW5jOiBhc3luY1xuICB9KTtcbiAgcmV0dXJuIGxpc3RlbmVyS2V5O1xuICAvL3JldHVybiB0aGlzLmdlbmVyYXRlVW5MaXN0ZW5lcihzZXR0ZXIsbGlzdGVuZXJLZXkpO1xufTtcblxuLy8gdHJhc2Zvcm1vIHVuIGxpc3RlbmVyIHNpbmNyb25vIGluIG1vZG8gZGEgcG90ZXIgZXNzZXJlIHVzYXRvIG5lbGxhIGNhdGVuYSBkaSBsaXN0ZW5lcnMgKHJpY2hpYW1hbmRvIG5leHQgY29sIHZhbG9yZSBkaSByaXRvcm5vIGRlbCBsaXN0ZW5lcilcbi8qcHJvdG8uX21ha2VDaGFpbmFibGUgPSBmdW5jdGlvbihsaXN0ZW5lcil7XG4gIHZhciBzZWxmID0gdGhpc1xuICByZXR1cm4gZnVuY3Rpb24oKXtcbiAgICB2YXIgYXJncyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cyk7XG4gICAgLy8gcmltdW92byBuZXh0IGRhaSBwYXJhbWV0cmkgcHJpbWEgZGkgY2hpYW1hcmUgaWwgbGlzdGVuZXJcbiAgICB2YXIgbmV4dCA9IGFyZ3MucG9wKCk7XG4gICAgdmFyIGNhblNldCA9IGxpc3RlbmVyLmFwcGx5KHNlbGYsYXJndW1lbnRzKTtcbiAgICB2YXIgX2NhblNldCA9IHRydWU7XG4gICAgaWYgKF8uaXNCb29sZWFuKGNhblNldCkpe1xuICAgICAgX2NhblNldCA9IGNhblNldDtcbiAgICB9XG4gICAgbmV4dChjYW5TZXQpO1xuICB9XG59OyovXG5cbnByb3RvLl9zZXR1cExpc3RlbmVyc0NoYWluID0gZnVuY3Rpb24oc2V0dGVycyl7XG4gIC8vIGluaXppYWxpenphIHR1dHRpIGkgbWV0b2RpIGRlZmluaXRpIG5lbGwnb2dnZXR0byBcInNldHRlcnNcIiBkZWxsYSBjbGFzc2UgZmlnbGlhLlxuICB2YXIgc2VsZiA9IHRoaXM7XG4gIHRoaXMuc2V0dGVyc0xpc3RlbmVycyA9IHtcbiAgICBhZnRlcjp7fSxcbiAgICBiZWZvcmU6e31cbiAgfTtcbiAgLy8gcGVyIG9nbmkgc2V0dGVyIHZpZW5lIGRlZmluaXRvIGwnYXJyYXkgZGVpIGxpc3RlbmVycyBlIGZpZW5lIHNvc3RpdHVpdG8gaWwgbWV0b2RvIG9yaWdpbmFsZSBjb24gbGEgZnVuemlvbmkgY2hlIGdlc3Rpc2NlIGxhIGNvZGEgZGkgbGlzdGVuZXJzXG4gIF8uZm9yRWFjaChzZXR0ZXJzLGZ1bmN0aW9uKHNldHRlck9wdGlvbixzZXR0ZXIpe1xuICAgIHZhciBzZXR0ZXJGbmMgPSBub29wO1xuICAgIHZhciBzZXR0ZXJGYWxsYmFjayA9IG5vb3A7XG4gICAgaWYgKF8uaXNGdW5jdGlvbihzZXR0ZXJPcHRpb24pKXtcbiAgICAgIHNldHRlckZuYyA9IHNldHRlck9wdGlvblxuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIHNldHRlckZuYyA9IHNldHRlck9wdGlvbi5mbmM7XG4gICAgICBzZXR0ZXJGYWxsYmFjayA9IHNldHRlck9wdGlvbi5mYWxsYmFjayB8fCBub29wO1xuICAgIH1cbiAgICBzZWxmLnNldHRlcnNMaXN0ZW5lcnMuYWZ0ZXJbc2V0dGVyXSA9IFtdO1xuICAgIHNlbGYuc2V0dGVyc0xpc3RlbmVycy5iZWZvcmVbc2V0dGVyXSA9IFtdO1xuICAgIC8vIHNldHRlciBzb3N0aXR1aXRvXG4gICAgc2VsZltzZXR0ZXJdID0gZnVuY3Rpb24oKXtcbiAgICAgIHZhciBhcmdzID0gYXJndW1lbnRzO1xuICAgICAgLy8gZXNlZ3VvIGkgbGlzdGVuZXIgcmVnaXN0cmF0aSBwZXIgaWwgYmVmb3JlXG4gICAgICB2YXIgZGVmZXJyZWQgPSAkLkRlZmVycmVkKCk7XG4gICAgICB2YXIgcmV0dXJuVmFsID0gbnVsbDtcbiAgICAgIHZhciBjb3VudGVyID0gMDtcbiAgICAgIHZhciBjYW5TZXQgPSB0cnVlO1xuICAgICAgXG4gICAgICAvLyByaWNoaWFtYXRhIGFsbGEgZmluZSBkZWxsYSBjYXRlbmEgZGkgbGlzdGVuZXJzXG4gICAgICBmdW5jdGlvbiBkb25lKCl7XG4gICAgICAgIGlmKGNhblNldCl7XG4gICAgICAgICAgLy8gZXNlZ3VvIGxhIGZ1bnppb25lXG4gICAgICAgICAgcmV0dXJuVmFsID0gc2V0dGVyRm5jLmFwcGx5KHNlbGYsYXJncyk7XG4gICAgICAgICAgLy8gZSByaXNvbHZvIGxhIHByb21lc3NhIChldmVudHVhbG1lbnRlIHV0aWxpenphdGEgZGEgY2hpIGhhIGludm9jYXRvIGlsIHNldHRlclxuICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmV0dXJuVmFsKTtcbiAgICAgICAgICBcbiAgICAgICAgICB2YXIgYWZ0ZXJMaXN0ZW5lcnMgPSBzZWxmLnNldHRlcnNMaXN0ZW5lcnMuYWZ0ZXJbc2V0dGVyXTtcbiAgICAgICAgICBfLmZvckVhY2goYWZ0ZXJMaXN0ZW5lcnMsZnVuY3Rpb24obGlzdGVuZXIsIGtleSl7XG4gICAgICAgICAgICBsaXN0ZW5lci5mbmMuYXBwbHkoc2VsZixhcmdzKTtcbiAgICAgICAgICB9KVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgIC8vIHNlIG5vbiBwb3NzbyBwcm9zZWd1aXJlIFxuICAgICAgICAgIC8vIGNoaWFtbyBsJ2V2ZW50dWFsZSBmdW56aW9uZSBkaSBmYWxsYmFja1xuICAgICAgICAgIHNldHRlckZhbGxiYWNrLmFwcGx5KHNlbGYsYXJncyk7XG4gICAgICAgICAgLy8gZSByaWdldHRvIGxhIHByb21lc3NhXG4gICAgICAgICAgZGVmZXJyZWQucmVqZWN0KCk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICBcbiAgICAgIGZ1bmN0aW9uIGNvbXBsZXRlKCl7XG4gICAgICAgIC8vIGVzZWd1byBsYSBmdW56aW9uZVxuICAgICAgICByZXR1cm5WYWwgPSBzZXR0ZXJGbmMuYXBwbHkoc2VsZixhcmdzKTtcbiAgICAgICAgLy8gZSByaXNvbHZvIGxhIHByb21lc3NhIChldmVudHVhbG1lbnRlIHV0aWxpenphdGEgZGEgY2hpIGhhIGludm9jYXRvIGlsIHNldHRlclxuICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJldHVyblZhbCk7XG4gICAgICAgIFxuICAgICAgICB2YXIgYWZ0ZXJMaXN0ZW5lcnMgPSBzZWxmLnNldHRlcnNMaXN0ZW5lcnMuYWZ0ZXJbc2V0dGVyXTtcbiAgICAgICAgXy5mb3JFYWNoKGFmdGVyTGlzdGVuZXJzLGZ1bmN0aW9uKGxpc3RlbmVyLCBrZXkpe1xuICAgICAgICAgIGxpc3RlbmVyLmZuYy5hcHBseShzZWxmLGFyZ3MpO1xuICAgICAgICB9KVxuICAgICAgfVxuICAgICAgXG4gICAgICBmdW5jdGlvbiBhYm9ydCgpe1xuICAgICAgICAgIC8vIHNlIG5vbiBwb3NzbyBwcm9zZWd1aXJlIC4uLlxuICAgICAgICAgIC8vIGNoaWFtbyBsJ2V2ZW50dWFsZSBmdW56aW9uZSBkaSBmYWxsYmFja1xuICAgICAgICAgIHNldHRlckZhbGxiYWNrLmFwcGx5KHNlbGYsYXJncyk7XG4gICAgICAgICAgLy8gZSByaWdldHRvIGxhIHByb21lc3NhXG4gICAgICAgICAgZGVmZXJyZWQucmVqZWN0KCk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIHZhciBiZWZvcmVMaXN0ZW5lcnMgPSB0aGlzLnNldHRlcnNMaXN0ZW5lcnNbJ2JlZm9yZSddW3NldHRlcl07XG4gICAgICAvLyBjb250YXRvcmUgZGVpIGxpc3RlbmVyIGNoZSB2ZXJyw6AgZGVjcmVtZW50YXRvIGFkIG9nbmkgY2hpYW1hdGEgYSBuZXh0KClcbiAgICAgIGNvdW50ZXIgPSAwO1xuICAgICAgXG4gICAgICAvLyBmdW56aW9uZSBwYXNzYXRhIGNvbWUgdWx0aW1vIHBhcmFtZXRybyBhaSBsaXN0ZW5lcnMsIGNoZSAqKipTRSBTT05PIFNUQVRJIEFHR0lVTlRJIENPTUUgQVNJTkNST05JIGxhIERFVk9OTyoqKiByaWNoaWFtYXJlIHBlciBwb3RlciBwcm9zZWd1aXJlIGxhIGNhdGVuYVxuICAgICAgZnVuY3Rpb24gbmV4dChib29sKXtcbiAgICAgICAgdmFyIGNvbnQgPSB0cnVlO1xuICAgICAgICBpZiAoXy5pc0Jvb2xlYW4oYm9vbCkpe1xuICAgICAgICAgIGNvbnQgPSBib29sO1xuICAgICAgICB9XG4gICAgICAgIHZhciBfYXJncyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3MpO1xuICAgICAgICAvLyBzZSBsYSBjYXRlbmEgw6ggc3RhdGEgYmxvY2NhdGEgbyBzZSBzaWFtbyBhcnJpdmF0aSBhbGxhIGZpbmUgZGVpIGJlZm9yZWxpc3RlbmVyc1xuICAgICAgICBpZiAoY29udCA9PT0gZmFsc2UgfHwgKGNvdW50ZXIgPT0gYmVmb3JlTGlzdGVuZXJzLmxlbmd0aCkpe1xuICAgICAgICAgIGlmKGNvbnQgPT09IGZhbHNlKVxuICAgICAgICAgICAgYWJvcnQuYXBwbHkoc2VsZixhcmdzKTtcbiAgICAgICAgICBlbHNle1xuICAgICAgICAgICAgY29tcGxldGVkID0gY29tcGxldGUuYXBwbHkoc2VsZixhcmdzKTtcbiAgICAgICAgICAgIGlmKF8uaXNVbmRlZmluZWQoY29tcGxldGVkKSB8fCBjb21wbGV0ZWQgPT09IHRydWUpe1xuICAgICAgICAgICAgICBzZWxmLmVtaXRFdmVudCgnc2V0Oicrc2V0dGVyLGFyZ3MpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICBpZiAoY29udCl7XG4gICAgICAgICAgICB2YXIgbGlzdGVuZXJGbmMgPSBiZWZvcmVMaXN0ZW5lcnNbY291bnRlcl0uZm5jO1xuICAgICAgICAgICAgaWYgKGJlZm9yZUxpc3RlbmVyc1tjb3VudGVyXS5hc3luYyl7XG4gICAgICAgICAgICAgIC8vIGFnZ2l1bmdvIG5leHQgY29tZSB1bGl0bW8gcGFyYW1ldHJvXG4gICAgICAgICAgICAgIF9hcmdzLnB1c2gobmV4dCk7XG4gICAgICAgICAgICAgIGNvdW50ZXIgKz0gMTtcbiAgICAgICAgICAgICAgbGlzdGVuZXJGbmMuYXBwbHkoc2VsZixfYXJncylcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICB2YXIgX2NvbnQgPSBsaXN0ZW5lckZuYy5hcHBseShzZWxmLF9hcmdzKTtcbiAgICAgICAgICAgICAgY291bnRlciArPSAxO1xuICAgICAgICAgICAgICBuZXh0KF9jb250KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIFxuICAgICAgbmV4dCgpO1xuICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2UoKTtcbiAgICB9XG4gIH0pXG59O1xuXG4vKlxucHJvdG8uZ2VuZXJhdGVVbkxpc3RlbmVyID0gZnVuY3Rpb24oc2V0dGVyc0xpc3RlbmVycyxzZXR0ZXIsbGlzdGVuZXJLZXkpe1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIHJldHVybiBmdW5jdGlvbigpe1xuICAgIHNldHRlcnNMaXN0ZW5lcnNbc2V0dGVyXVtsaXN0ZW5lcktleV0gPSBudWxsO1xuICAgIGRlbGV0ZSBzZXR0ZXJzTGlzdGVuZXJzW3NldHRlcl1bbGlzdGVuZXJLZXldO1xuICB9XG59O1xuKi9cblxubW9kdWxlLmV4cG9ydHMgPSBHM1dPYmplY3Q7XG4iLCJ2YXIgZ2VvbSA9IHtcbiAgZGlzdGFuY2U6IGZ1bmN0aW9uKGMxLGMyKXtcbiAgICByZXR1cm4gTWF0aC5zcXJ0KGdlb20uc3F1YXJlZERpc3RhbmNlKGMxLGMyKSk7XG4gIH0sXG4gIHNxdWFyZWREaXN0YW5jZTogZnVuY3Rpb24oYzEsYzIpe1xuICAgIHZhciB4MSA9IGMxWzBdO1xuICAgIHZhciB5MSA9IGMxWzFdO1xuICAgIHZhciB4MiA9IGMyWzBdO1xuICAgIHZhciB5MiA9IGMyWzFdO1xuICAgIHZhciBkeCA9IHgyIC0geDE7XG4gICAgdmFyIGR5ID0geTIgLSB5MTtcbiAgICByZXR1cm4gZHggKiBkeCArIGR5ICogZHk7XG4gIH0sXG4gIGNsb3Nlc3RPblNlZ21lbnQ6IGZ1bmN0aW9uKGNvb3JkaW5hdGUsIHNlZ21lbnQpIHtcbiAgICB2YXIgeDAgPSBjb29yZGluYXRlWzBdO1xuICAgIHZhciB5MCA9IGNvb3JkaW5hdGVbMV07XG4gICAgdmFyIHN0YXJ0ID0gc2VnbWVudFswXTtcbiAgICB2YXIgZW5kID0gc2VnbWVudFsxXTtcbiAgICB2YXIgeDEgPSBzdGFydFswXTtcbiAgICB2YXIgeTEgPSBzdGFydFsxXTtcbiAgICB2YXIgeDIgPSBlbmRbMF07XG4gICAgdmFyIHkyID0gZW5kWzFdO1xuICAgIHZhciBkeCA9IHgyIC0geDE7XG4gICAgdmFyIGR5ID0geTIgLSB5MTtcbiAgICB2YXIgYWxvbmcgPSAoZHggPT09IDAgJiYgZHkgPT09IDApID8gMCA6XG4gICAgICAgICgoZHggKiAoeDAgLSB4MSkpICsgKGR5ICogKHkwIC0geTEpKSkgLyAoKGR4ICogZHggKyBkeSAqIGR5KSB8fCAwKTtcbiAgICB2YXIgeCwgeTtcbiAgICBpZiAoYWxvbmcgPD0gMCkge1xuICAgICAgeCA9IHgxO1xuICAgICAgeSA9IHkxO1xuICAgIH0gZWxzZSBpZiAoYWxvbmcgPj0gMSkge1xuICAgICAgeCA9IHgyO1xuICAgICAgeSA9IHkyO1xuICAgIH0gZWxzZSB7XG4gICAgICB4ID0geDEgKyBhbG9uZyAqIGR4O1xuICAgICAgeSA9IHkxICsgYWxvbmcgKiBkeTtcbiAgICB9XG4gICAgcmV0dXJuIFt4LCB5XTtcbiAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IGdlb207XG4iLCJ2YXIgR2VvbWV0cnkgPSB7fTtcblxuR2VvbWV0cnkuR2VvbWV0cnlUeXBlcyA9IHtcbiAgUE9JTlQ6IFwiUG9pbnRcIixcbiAgTVVMVElQT0lOVDogXCJNdWx0aVBvaW50XCIsXG4gIExJTkVTVFJJTkc6IFwiTGluZVwiLCAvLyBwZXIgc2VndWlyZSBsYSBkZWZpbml6aW9uZSBkaSBRR2lzLkdlb21ldHJ5VHlwZSwgY2hlIGRlZmluaXNjZSBMaW5lIGludmVjZSBkaSBMaW5lc3RyaW5nLlxuICBNVUxUSUxJTkVTVFJJTkc6IFwiTXVsdGlMaW5lXCIsXG4gIFBPTFlHT046IFwiUG9seWdvblwiLFxuICBNVUxUSVBPTFlHT046IFwiTXVsdGlQb2x5Z29uXCIsXG4gIEdFT01FVFJZQ09MTEVDVElPTjogXCJHZW9tZXRyeUNvbGxlY3Rpb25cIlxufTtcblxuR2VvbWV0cnkuU3VwcG9ydGVkR2VvbWV0cnlUeXBlcyA9IFtcbiAgR2VvbWV0cnkuR2VvbWV0cnlUeXBlcy5QT0lOVCxcbiAgR2VvbWV0cnkuR2VvbWV0cnlUeXBlcy5NVUxUSVBPSU5ULFxuICBHZW9tZXRyeS5HZW9tZXRyeVR5cGVzLkxJTkVTVFJJTkcsXG4gIEdlb21ldHJ5Lkdlb21ldHJ5VHlwZXMuTVVMVElMSU5FU1RSSU5HLFxuICBHZW9tZXRyeS5HZW9tZXRyeVR5cGVzLlBPTFlHT04sXG4gIEdlb21ldHJ5Lkdlb21ldHJ5VHlwZXMuTVVMVElQT0xZR09OXG5dXG5cbm1vZHVsZS5leHBvcnRzID0gR2VvbWV0cnk7XG4iLCJmdW5jdGlvbiBpbml0KGNvbmZpZykge1xuICBpMThuZXh0XG4gIC51c2UoaTE4bmV4dFhIUkJhY2tlbmQpXG4gIC5pbml0KHsgXG4gICAgICBsbmc6ICdpdCcsXG4gICAgICBuczogJ2FwcCcsXG4gICAgICBmYWxsYmFja0xuZzogJ2l0JyxcbiAgICAgIHJlc291cmNlczogY29uZmlnLnJlc291cmNlc1xuICB9KTtcbiAgXG4gIGpxdWVyeUkxOG5leHQuaW5pdChpMThuZXh0LCAkLCB7XG4gICAgdE5hbWU6ICd0JywgLy8gLS0+IGFwcGVuZHMgJC50ID0gaTE4bmV4dC50XG4gICAgaTE4bk5hbWU6ICdpMThuJywgLy8gLS0+IGFwcGVuZHMgJC5pMThuID0gaTE4bmV4dFxuICAgIGhhbmRsZU5hbWU6ICdsb2NhbGl6ZScsIC8vIC0tPiBhcHBlbmRzICQoc2VsZWN0b3IpLmxvY2FsaXplKG9wdHMpO1xuICAgIHNlbGVjdG9yQXR0cjogJ2RhdGEtaTE4bicsIC8vIHNlbGVjdG9yIGZvciB0cmFuc2xhdGluZyBlbGVtZW50c1xuICAgIHRhcmdldEF0dHI6ICdkYXRhLWkxOG4tdGFyZ2V0JywgLy8gZWxlbWVudCBhdHRyaWJ1dGUgdG8gZ3JhYiB0YXJnZXQgZWxlbWVudCB0byB0cmFuc2xhdGUgKGlmIGRpZmZyZW50IHRoZW4gaXRzZWxmKVxuICAgIG9wdGlvbnNBdHRyOiAnZGF0YS1pMThuLW9wdGlvbnMnLCAvLyBlbGVtZW50IGF0dHJpYnV0ZSB0aGF0IGNvbnRhaW5zIG9wdGlvbnMsIHdpbGwgbG9hZC9zZXQgaWYgdXNlT3B0aW9uc0F0dHIgPSB0cnVlXG4gICAgdXNlT3B0aW9uc0F0dHI6IGZhbHNlLCAvLyBzZWUgb3B0aW9uc0F0dHJcbiAgICBwYXJzZURlZmF1bHRWYWx1ZUZyb21Db250ZW50OiB0cnVlIC8vIHBhcnNlcyBkZWZhdWx0IHZhbHVlcyBmcm9tIGNvbnRlbnQgZWxlLnZhbCBvciBlbGUudGV4dFxuICB9KTtcbn1cbiAgICBcbnZhciB0ID0gZnVuY3Rpb24odGV4dCl7XG4gICAgdmFyIHRyYWQgPSBpMThuZXh0LnQodGV4dCk7XG4gICAgcmV0dXJuIHRyYWQ7XG59O1xuICAgIFxubW9kdWxlLmV4cG9ydHMgPSB7XG4gIGluaXQ6IGluaXQsXG4gIHQ6IHRcbn1cbiIsInZhciBQaWNrQ29vcmRpbmF0ZXNFdmVudFR5cGUgPSB7XG4gIFBJQ0tFRDogJ3BpY2tlZCdcbn07XG5cbnZhciBQaWNrQ29vcmRpbmF0ZXNFdmVudCA9IGZ1bmN0aW9uKHR5cGUsIGNvb3JkaW5hdGUpIHtcbiAgdGhpcy50eXBlID0gdHlwZTtcbiAgdGhpcy5jb29yZGluYXRlID0gY29vcmRpbmF0ZTtcbn07XG5cbnZhciBQaWNrQ29vcmRpbmF0ZXNJbnRlcmFjdGlvbiA9IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgdGhpcy5wcmV2aW91c0N1cnNvcl8gPSBudWxsO1xuICBcbiAgb2wuaW50ZXJhY3Rpb24uUG9pbnRlci5jYWxsKHRoaXMsIHtcbiAgICBoYW5kbGVEb3duRXZlbnQ6IFBpY2tDb29yZGluYXRlc0ludGVyYWN0aW9uLmhhbmRsZURvd25FdmVudF8sXG4gICAgaGFuZGxlVXBFdmVudDogUGlja0Nvb3JkaW5hdGVzSW50ZXJhY3Rpb24uaGFuZGxlVXBFdmVudF8sXG4gICAgaGFuZGxlTW92ZUV2ZW50OiBQaWNrQ29vcmRpbmF0ZXNJbnRlcmFjdGlvbi5oYW5kbGVNb3ZlRXZlbnRfLFxuICB9KTtcbn07XG5vbC5pbmhlcml0cyhQaWNrQ29vcmRpbmF0ZXNJbnRlcmFjdGlvbiwgb2wuaW50ZXJhY3Rpb24uUG9pbnRlcik7XG5cblBpY2tDb29yZGluYXRlc0ludGVyYWN0aW9uLmhhbmRsZURvd25FdmVudF8gPSBmdW5jdGlvbihldmVudCkge1xuICByZXR1cm4gdHJ1ZTtcbn07XG5cblBpY2tDb29yZGluYXRlc0ludGVyYWN0aW9uLmhhbmRsZVVwRXZlbnRfID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgdGhpcy5kaXNwYXRjaEV2ZW50KFxuICAgICAgICAgIG5ldyBQaWNrQ29vcmRpbmF0ZXNFdmVudChcbiAgICAgICAgICAgICAgUGlja0Nvb3JkaW5hdGVzRXZlbnRUeXBlLlBJQ0tFRCxcbiAgICAgICAgICAgICAgZXZlbnQuY29vcmRpbmF0ZSkpO1xuICByZXR1cm4gdHJ1ZTtcbn07XG5cblBpY2tDb29yZGluYXRlc0ludGVyYWN0aW9uLmhhbmRsZU1vdmVFdmVudF8gPSBmdW5jdGlvbihldmVudCkge1xuICB2YXIgZWxlbSA9IGV2ZW50Lm1hcC5nZXRUYXJnZXRFbGVtZW50KCk7XG4gIGVsZW0uc3R5bGUuY3Vyc29yID0gICdwb2ludGVyJztcbn07XG5cblBpY2tDb29yZGluYXRlc0ludGVyYWN0aW9uLnByb3RvdHlwZS5zaG91bGRTdG9wRXZlbnQgPSBmdW5jdGlvbigpe1xuICByZXR1cm4gdHJ1ZTtcbn07XG5cblBpY2tDb29yZGluYXRlc0ludGVyYWN0aW9uLnByb3RvdHlwZS5zZXRNYXAgPSBmdW5jdGlvbihtYXApe1xuICBpZiAoIW1hcCkge1xuICAgIHZhciBlbGVtID0gdGhpcy5nZXRNYXAoKS5nZXRUYXJnZXRFbGVtZW50KCk7XG4gICAgZWxlbS5zdHlsZS5jdXJzb3IgPSAnJztcbiAgfVxuICBvbC5pbnRlcmFjdGlvbi5Qb2ludGVyLnByb3RvdHlwZS5zZXRNYXAuY2FsbCh0aGlzLG1hcCk7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFBpY2tDb29yZGluYXRlc0ludGVyYWN0aW9uO1xuIiwidmFyIFBpY2tGZWF0dXJlRXZlbnRUeXBlID0ge1xuICBQSUNLRUQ6ICdwaWNrZWQnXG59O1xuXG52YXIgUGlja0ZlYXR1cmVFdmVudCA9IGZ1bmN0aW9uKHR5cGUsIGNvb3JkaW5hdGUsIGZlYXR1cmUpIHtcbiAgdGhpcy50eXBlID0gdHlwZTtcbiAgdGhpcy5mZWF0dXJlID0gZmVhdHVyZTtcbiAgdGhpcy5jb29yZGluYXRlID0gY29vcmRpbmF0ZTtcbn07XG5cblxuXG52YXIgUGlja0ZlYXR1cmVJbnRlcmFjdGlvbiA9IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgb2wuaW50ZXJhY3Rpb24uUG9pbnRlci5jYWxsKHRoaXMsIHtcbiAgICBoYW5kbGVEb3duRXZlbnQ6IFBpY2tGZWF0dXJlSW50ZXJhY3Rpb24uaGFuZGxlRG93bkV2ZW50XyxcbiAgICBoYW5kbGVVcEV2ZW50OiBQaWNrRmVhdHVyZUludGVyYWN0aW9uLmhhbmRsZVVwRXZlbnRfLFxuICAgIGhhbmRsZU1vdmVFdmVudDogUGlja0ZlYXR1cmVJbnRlcmFjdGlvbi5oYW5kbGVNb3ZlRXZlbnRfLFxuICB9KTtcbiAgXG4gIHRoaXMuZmVhdHVyZXNfID0gb3B0aW9ucy5mZWF0dXJlcyB8fCBudWxsO1xuICBcbiAgdGhpcy5sYXllcnNfID0gb3B0aW9ucy5sYXllcnMgfHwgbnVsbDtcbiAgXG4gIHRoaXMucGlja2VkRmVhdHVyZV8gPSBudWxsO1xuICBcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICB0aGlzLmxheWVyRmlsdGVyXyA9IGZ1bmN0aW9uKGxheWVyKSB7XG4gICAgcmV0dXJuIF8uaW5jbHVkZXMoc2VsZi5sYXllcnNfLCBsYXllcik7XG4gIH07XG59O1xub2wuaW5oZXJpdHMoUGlja0ZlYXR1cmVJbnRlcmFjdGlvbiwgb2wuaW50ZXJhY3Rpb24uUG9pbnRlcik7XG5cblBpY2tGZWF0dXJlSW50ZXJhY3Rpb24uaGFuZGxlRG93bkV2ZW50XyA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gIHRoaXMucGlja2VkRmVhdHVyZV8gPSB0aGlzLmZlYXR1cmVzQXRQaXhlbF8oZXZlbnQucGl4ZWwsIGV2ZW50Lm1hcCk7XG4gIHJldHVybiB0cnVlO1xufTtcblxuUGlja0ZlYXR1cmVJbnRlcmFjdGlvbi5oYW5kbGVVcEV2ZW50XyA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gIGlmKHRoaXMucGlja2VkRmVhdHVyZV8pe1xuICAgIHRoaXMuZGlzcGF0Y2hFdmVudChcbiAgICAgICAgICAgIG5ldyBQaWNrRmVhdHVyZUV2ZW50KFxuICAgICAgICAgICAgICAgIFBpY2tGZWF0dXJlRXZlbnRUeXBlLlBJQ0tFRCxcbiAgICAgICAgICAgICAgICBldmVudC5jb29yZGluYXRlLFxuICAgICAgICAgICAgICAgIHRoaXMucGlja2VkRmVhdHVyZV8pKTtcbiAgfVxuICByZXR1cm4gdHJ1ZTtcbn07XG5cblBpY2tGZWF0dXJlSW50ZXJhY3Rpb24uaGFuZGxlTW92ZUV2ZW50XyA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gIHZhciBlbGVtID0gZXZlbnQubWFwLmdldFRhcmdldEVsZW1lbnQoKTtcbiAgdmFyIGludGVyc2VjdGluZ0ZlYXR1cmUgPSB0aGlzLmZlYXR1cmVzQXRQaXhlbF8oZXZlbnQucGl4ZWwsIGV2ZW50Lm1hcCk7XG5cbiAgaWYgKGludGVyc2VjdGluZ0ZlYXR1cmUpIHtcbiAgICBlbGVtLnN0eWxlLmN1cnNvciA9ICAncG9pbnRlcic7XG4gIH0gZWxzZSB7XG4gICAgZWxlbS5zdHlsZS5jdXJzb3IgPSAnJztcbiAgfVxufTtcblxuUGlja0ZlYXR1cmVJbnRlcmFjdGlvbi5wcm90b3R5cGUuZmVhdHVyZXNBdFBpeGVsXyA9IGZ1bmN0aW9uKHBpeGVsLCBtYXApIHtcbiAgdmFyIGZvdW5kID0gbnVsbDtcblxuICB2YXIgaW50ZXJzZWN0aW5nRmVhdHVyZSA9IG1hcC5mb3JFYWNoRmVhdHVyZUF0UGl4ZWwocGl4ZWwsXG4gICAgICBmdW5jdGlvbihmZWF0dXJlKSB7XG4gICAgICAgIGlmICh0aGlzLmZlYXR1cmVzXykge1xuICAgICAgICAgIGlmICh0aGlzLmZlYXR1cmVzXy5pbmRleE9mKGZlYXR1cmUpID4gLTEpe1xuICAgICAgICAgICAgcmV0dXJuIGZlYXR1cmVcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZXtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmVhdHVyZTtcbiAgICAgIH0sdGhpcyx0aGlzLmxheWVyRmlsdGVyXyk7XG4gIFxuICBpZihpbnRlcnNlY3RpbmdGZWF0dXJlKXtcbiAgICBmb3VuZCA9IGludGVyc2VjdGluZ0ZlYXR1cmU7XG4gIH1cbiAgcmV0dXJuIGZvdW5kO1xufTtcblxuUGlja0ZlYXR1cmVJbnRlcmFjdGlvbi5wcm90b3R5cGUuc2hvdWxkU3RvcEV2ZW50ID0gZnVuY3Rpb24oKXtcbiAgcmV0dXJuIGZhbHNlO1xufTtcblxuUGlja0ZlYXR1cmVJbnRlcmFjdGlvbi5wcm90b3R5cGUuc2V0TWFwID0gZnVuY3Rpb24obWFwKXtcbiAgaWYgKCFtYXApIHtcbiAgICB2YXIgZWxlbSA9IHRoaXMuZ2V0TWFwKCkuZ2V0VGFyZ2V0RWxlbWVudCgpO1xuICAgIGVsZW0uc3R5bGUuY3Vyc29yID0gJyc7XG4gIH1cbiAgb2wuaW50ZXJhY3Rpb24uUG9pbnRlci5wcm90b3R5cGUuc2V0TWFwLmNhbGwodGhpcyxtYXApO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBQaWNrRmVhdHVyZUludGVyYWN0aW9uO1xuIiwidmFyIGluaGVyaXQgPSByZXF1aXJlKCdjb3JlL3V0aWxzL3V0aWxzJykuaW5oZXJpdDtcbnZhciBiYXNlID0gcmVxdWlyZSgnY29yZS91dGlscy91dGlscycpLmJhc2U7XG52YXIgRzNXT2JqZWN0ID0gcmVxdWlyZSgnY29yZS9nM3dvYmplY3QnKTtcbnZhciBHZW9tZXRyeVR5cGVzID0gcmVxdWlyZSgnY29yZS9nZW9tZXRyeS9nZW9tZXRyeScpLkdlb21ldHJ5VHlwZXM7XG5cbnZhciBDQVBBQklMSVRJRVMgPSB7XG4gIFFVRVJZOiAxLFxuICBFRElUOiAyXG59O1xuXG52YXIgRURJVE9QUyA9IHtcbiAgSU5TRVJUOiAxLFxuICBVUERBVEU6IDIsXG4gIERFTEVURTogNFxufTtcblxuTGF5ZXJTdGF0ZSA9IHt9O1xuXG5MYXllclN0YXRlLlNlcnZlclR5cGVzID0ge1xuICBPR0M6IFwiT0dDXCIsXG4gIFFHSVM6IFwiUUdJU1wiLFxuICBNYXBzZXJ2ZXI6IFwiTWFwc2VydmVyXCIsXG4gIEdlb3NlcnZlcjogXCJHZW9zZXJ2ZXJcIixcbiAgQXJjR0lTOiBcIkFyY0dJU1wiXG59O1xuXG5MYXllclN0YXRlLmdldEdlb21ldHJ5VHlwZSA9IGZ1bmN0aW9uKGxheWVyU3RhdGUpIHtcbiAgcmV0dXJuIGxheWVyU3RhdGUuZ2VvbWV0cnl0eXBlO1xufTtcblxuTGF5ZXJTdGF0ZS5nZXRBdHRyaWJ1dGVzID0gZnVuY3Rpb24obGF5ZXJTdGF0ZSkge1xuICB2YXIgYXR0cmlidXRlcyA9IFtdO1xuICBpZiAobGF5ZXJTdGF0ZS5hdHRyaWJ1dGVzKSB7XG4gICAgYXR0cmlidXRlcyA9IF8ubWFwKGxheWVyU3RhdGUuYXR0cmlidXRlcyxmdW5jdGlvbihhdHRyaWJ1dGUpIHtcbiAgICAgIHJldHVybiBhdHRyaWJ1dGUubmFtZTtcbiAgICB9KVxuICB9XG4gIHJldHVybiBhdHRyaWJ1dGVzO1xufTtcblxuTGF5ZXJTdGF0ZS5pc1F1ZXJ5YWJsZSA9IGZ1bmN0aW9uKGxheWVyU3RhdGUpe1xuICB2YXIgcXVlcnlFbmFibGVkID0gZmFsc2U7XG4gIHZhciBxdWVyeWFibGVGb3JDYWJhYmlsaXRpZXMgPSAobGF5ZXJTdGF0ZS5jYXBhYmlsaXRpZXMgJiYgKGxheWVyU3RhdGUuY2FwYWJpbGl0aWVzICYmIENBUEFCSUxJVElFUy5RVUVSWSkpID8gdHJ1ZSA6IGZhbHNlO1xuICBpZiAocXVlcnlhYmxlRm9yQ2FiYWJpbGl0aWVzKSB7XG4gICAgLy8gw6ggaW50ZXJyb2dhYmlsZSBzZSB2aXNpYmlsZSBlIG5vbiBkaXNhYmlsaXRhdG8gKHBlciBzY2FsYSkgb3BwdXJlIHNlIGludGVycm9nYWJpbGUgY29tdW5xdWUgKGZvcnphdG8gZGFsbGEgcHJvcHJpZXTDoCBpbmZvd2hlbm5vdHZpc2libGUpXG4gICAgdmFyIHF1ZXJ5RW5hYmxlZCA9IChsYXllclN0YXRlLnZpc2libGUgJiYgIWxheWVyU3RhdGUuZGlzYWJsZWQpIHx8IChsYXllclN0YXRlLmluZm93aGVubm90dmlzaWJsZSAmJiAobGF5ZXJTdGF0ZS5pbmZvd2hlbm5vdHZpc2libGUgPT09IHRydWUpKTtcbiAgfVxuICByZXR1cm4gcXVlcnlFbmFibGVkO1xufTtcblxuTGF5ZXJTdGF0ZS5nZXRRdWVyeUxheWVyTmFtZSA9IGZ1bmN0aW9uKGxheWVyU3RhdGUpIHtcbiAgdmFyIHF1ZXJ5TGF5ZXJOYW1lO1xuICBpZiAobGF5ZXJTdGF0ZS5pbmZvbGF5ZXIgJiYgbGF5ZXJTdGF0ZS5pbmZvbGF5ZXIgIT0gJycpIHtcbiAgICBxdWVyeUxheWVyTmFtZSA9IGxheWVyU3RhdGUuaW5mb2xheWVyO1xuICB9XG4gIGVsc2Uge1xuICAgIHF1ZXJ5TGF5ZXJOYW1lID0gbGF5ZXJTdGF0ZS5uYW1lO1xuICB9XG4gIHJldHVybiBxdWVyeUxheWVyTmFtZTtcbn07XG5cbkxheWVyU3RhdGUuZ2V0U2VydmVyVHlwZSA9IGZ1bmN0aW9uKGxheWVyU3RhdGUpIHtcbiAgaWYgKGxheWVyU3RhdGUuc2VydmVydHlwZSAmJiBsYXllclN0YXRlLnNlcnZlcnR5cGUgIT0gJycpIHtcbiAgICByZXR1cm4gbGF5ZXJTdGF0ZS5zZXJ2ZXJ0eXBlO1xuICB9XG4gIGVsc2Uge1xuICAgIHJldHVybiBMYXllclN0YXRlLlNlcnZlclR5cGVzLlFHSVM7XG4gIH1cbn07XG5cbkxheWVyU3RhdGUuaXNFeHRlcm5hbFdNUyA9IGZ1bmN0aW9uKGxheWVyU3RhdGUpIHtcbiAgcmV0dXJuIChsYXllclN0YXRlLnNvdXJjZSAmJiBsYXllclN0YXRlLnNvdXJjZS51cmwpO1xufTtcblxuTGF5ZXJTdGF0ZS5nZXRXTVNMYXllck5hbWUgPSBmdW5jdGlvbihsYXllclN0YXRlKSB7XG4gIHZhciBsYXllck5hbWUgPSBsYXllclN0YXRlLm5hbWU7XG4gIGlmIChsYXllclN0YXRlLnNvdXJjZSAmJiBsYXllclN0YXRlLnNvdXJjZS5sYXllcnMpe1xuICAgIGxheWVyTmFtZSA9IGxheWVyU3RhdGUuc291cmNlLmxheWVyc1xuICB9O1xuICByZXR1cm4gbGF5ZXJOYW1lO1xufTtcblxuTGF5ZXJTdGF0ZS5nZXRPcmlnaW5VUkwgPSBmdW5jdGlvbihsYXllclN0YXRlKSB7XG4gIHZhciB1cmw7XG4gIGlmIChsYXllclN0YXRlLnNvdXJjZSAmJiBsYXllclN0YXRlLnNvdXJjZS50eXBlID09ICd3bXMnICYmIGxheWVyU3RhdGUuc291cmNlLnVybCl7XG4gICAgdXJsID0gbGF5ZXJTdGF0ZS5zb3VyY2UudXJsXG4gIH07XG4gIHJldHVybiB1cmw7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IExheWVyU3RhdGU7XG4iLCJ2YXIgaW5oZXJpdCA9IHJlcXVpcmUoJ2NvcmUvdXRpbHMvdXRpbHMnKS5pbmhlcml0O1xudmFyIHRydWVmbmMgPSByZXF1aXJlKCdjb3JlL3V0aWxzL3V0aWxzJykudHJ1ZWZuYztcbnZhciByZXNvbHZlID0gcmVxdWlyZSgnY29yZS91dGlscy91dGlscycpLnJlc29sdmU7XG52YXIgcmVqZWN0ID0gcmVxdWlyZSgnY29yZS91dGlscy91dGlscycpLnJlamVjdDtcbnZhciBHM1dPYmplY3QgPSByZXF1aXJlKCdjb3JlL2czd29iamVjdCcpO1xuXG5mdW5jdGlvbiBWZWN0b3JMYXllcihjb25maWcpe1xuICB2YXIgY29uZmlnID0gY29uZmlnIHx8IHt9O1xuICB0aGlzLmdlb21ldHJ5dHlwZSA9IGNvbmZpZy5nZW9tZXRyeXR5cGUgfHwgbnVsbDtcbiAgdGhpcy5mb3JtYXQgPSBjb25maWcuZm9ybWF0IHx8IG51bGw7XG4gIHRoaXMuY3JzID0gY29uZmlnLmNycyAgfHwgbnVsbDtcbiAgdGhpcy5pZCA9IGNvbmZpZy5pZCB8fCBudWxsO1xuICB0aGlzLm5hbWUgPSBjb25maWcubmFtZSB8fCBcIlwiO1xuICB0aGlzLnBrID0gY29uZmlnLnBrIHx8IFwiaWRcIjsgLy8gVE9ETzogaWwgR2VvSlNPTiBzZXR0YSBsJ2lkIGRlbGxhIGZlYXR1cmUgZGEgc8OpLCBlIG5hc2NvbmRlIGlsIGNhbXBvIFBLIGRhbGxlIHByb3BlcnRpZXMuIEluIGFsdHJpIGZvcm1hdGkgdmEgdmVyaWZpY2F0bywgZSBjYXNvbWFpIHVzYXJlIGZlYXR1cmUuc2V0SWQoKVxuICBcbiAgdGhpcy5fb2xTb3VyY2UgPSBuZXcgb2wuc291cmNlLlZlY3Rvcih7XG4gICAgZmVhdHVyZXM6IG5ldyBvbC5Db2xsZWN0aW9uKClcbiAgfSk7XG4gIHRoaXMuX29sTGF5ZXIgPSBuZXcgb2wubGF5ZXIuVmVjdG9yKHtcbiAgICBuYW1lOiB0aGlzLm5hbWUsXG4gICAgc291cmNlOiB0aGlzLl9vbFNvdXJjZVxuICB9KTtcbiAgXG4gIC8qXG4gICAqIEFycmF5IGRpIG9nZ2V0dGk6XG4gICAqIHtcbiAgICogIG5hbWU6IE5vbWUgZGVsbCdhdHRyaWJ1dG8sXG4gICAqICB0eXBlOiBpbnRlZ2VyIHwgZmxvYXQgfCBzdHJpbmcgfCBib29sZWFuIHwgZGF0ZSB8IHRpbWUgfCBkYXRldGltZSxcbiAgICogIGlucHV0OiB7XG4gICAqICAgIGxhYmVsOiBOb21lIGRlbCBjYW1wbyBkaSBpbnB1dCxcbiAgICogICAgdHlwZTogc2VsZWN0IHwgY2hlY2sgfCByYWRpbyB8IGNvb3Jkc3BpY2tlciB8IGJveHBpY2tlciB8IGxheWVycGlja2VyIHwgZmllbGRkZXBlbmQsXG4gICAqICAgIG9wdGlvbnM6IHtcbiAgICogICAgICBMZSBvcHppb25pIHBlciBsbyBzcGNpZmljbyB0aXBvIGRpIGlucHV0IChlcy4gXCJ2YWx1ZXNcIiBwZXIgbGEgbGlzdGEgZGkgdmFsb3JpIGRpIHNlbGVjdCwgY2hlY2sgZSByYWRpbylcbiAgICogICAgfVxuICAgKiAgfVxuICAgKiB9XG4gICovXG4gIHRoaXMuX1BLaW5BdHRyaWJ1dGVzID0gZmFsc2U7XG4gIHRoaXMuX2ZlYXR1cmVzRmlsdGVyID0gbnVsbDtcbiAgdGhpcy5fZmllbGRzID0gbnVsbFxuICB0aGlzLmxhenlSZWxhdGlvbnMgPSB0cnVlO1xuICB0aGlzLl9yZWxhdGlvbnMgPSBudWxsO1xufVxuaW5oZXJpdChWZWN0b3JMYXllcixHM1dPYmplY3QpO1xubW9kdWxlLmV4cG9ydHMgPSBWZWN0b3JMYXllcjtcblxudmFyIHByb3RvID0gVmVjdG9yTGF5ZXIucHJvdG90eXBlO1xuXG5wcm90by5zZXREYXRhID0gZnVuY3Rpb24oZmVhdHVyZXNEYXRhKXtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICB2YXIgZmVhdHVyZXM7XG4gIGlmICh0aGlzLmZvcm1hdCkge1xuICAgIHN3aXRjaCAodGhpcy5mb3JtYXQpe1xuICAgICAgY2FzZSBcIkdlb0pTT05cIjpcbiAgICAgICAgdmFyIGdlb2pzb24gPSBuZXcgb2wuZm9ybWF0Lkdlb0pTT04oe1xuICAgICAgICAgIGRlZmF1bHREYXRhUHJvamVjdGlvbjogdGhpcy5jcnMsXG4gICAgICAgICAgZ2VvbWV0cnlOYW1lOiBcImdlb21ldHJ5XCJcbiAgICAgICAgfSk7XG4gICAgICAgIGZlYXR1cmVzID0gZ2VvanNvbi5yZWFkRmVhdHVyZXMoZmVhdHVyZXNEYXRhKTtcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuICAgIFxuICAgIGlmIChmZWF0dXJlcyAmJiBmZWF0dXJlcy5sZW5ndGgpIHtcbiAgICAgIGlmICghXy5pc051bGwodGhpcy5fZmVhdHVyZXNGaWx0ZXIpKXtcbiAgICAgICAgdmFyIGZlYXR1cmVzID0gXy5tYXAoZmVhdHVyZXMsZnVuY3Rpb24oZmVhdHVyZSl7XG4gICAgICAgICAgcmV0dXJuIHNlbGYuX2ZlYXR1cmVzRmlsdGVyKGZlYXR1cmUpO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgdmFyIGFscmVhZHlMb2FkZWRJZHMgPSB0aGlzLmdldEZlYXR1cmVJZHMoKTtcbiAgICAgIHZhciBmZWF0dXJlc1RvTG9hZCA9IF8uZmlsdGVyKGZlYXR1cmVzLGZ1bmN0aW9uKGZlYXR1cmUpe1xuICAgICAgICByZXR1cm4gIV8uaW5jbHVkZXMoYWxyZWFkeUxvYWRlZElkcyxmZWF0dXJlLmdldElkKCkpO1xuICAgICAgfSlcbiAgICAgIFxuICAgICAgdGhpcy5fb2xTb3VyY2UuYWRkRmVhdHVyZXMoZmVhdHVyZXNUb0xvYWQpO1xuICAgICAgXG4gICAgICAvLyB2ZXJpZmljbywgcHJlbmRlbmRvIGxhIHByaW1hIGZlYXR1cmUsIHNlIGxhIFBLIMOoIHByZXNlbnRlIG8gbWVubyB0cmEgZ2xpIGF0dHJpYnV0aVxuICAgICAgdmFyIGF0dHJpYnV0ZXMgPSB0aGlzLmdldFNvdXJjZSgpLmdldEZlYXR1cmVzKClbMF0uZ2V0UHJvcGVydGllcygpO1xuICAgICAgdGhpcy5fUEtpbkF0dHJpYnV0ZXMgPSBfLmdldChhdHRyaWJ1dGVzLHRoaXMucGspID8gdHJ1ZSA6IGZhbHNlO1xuICAgIH1cbiAgfVxuICBlbHNlIHtcbiAgICBjb25zb2xlLmxvZyhcIlZlY3RvckxheWVyIGZvcm1hdCBub3QgZGVmaW5lZFwiKTtcbiAgfVxufTtcblxucHJvdG8uc2V0RmVhdHVyZURhdGEgPSBmdW5jdGlvbihvbGRmaWQsZmlkLGdlb21ldHJ5LGF0dHJpYnV0ZXMpe1xuICB2YXIgZmVhdHVyZSA9IHRoaXMuZ2V0RmVhdHVyZUJ5SWQob2xkZmlkKTtcbiAgaWYgKGZpZCl7XG4gICAgZmVhdHVyZS5zZXRJZChmaWQpO1xuICB9XG4gIFxuICBpZiAoZ2VvbWV0cnkpe1xuICAgIGZlYXR1cmUuc2V0R2VvbWV0cnkoZ2VvbWV0cnkpO1xuICB9XG4gIFxuICBpZiAoYXR0cmlidXRlcyl7XG4gICAgdmFyIG9sZEF0dHJpYnV0ZXMgPSBmZWF0dXJlLmdldFByb3BlcnRpZXMoKTtcbiAgICB2YXIgbmV3QXR0cmlidXRlcyA9Xy5hc3NpZ24ob2xkQXR0cmlidXRlcyxhdHRyaWJ1dGVzKTtcbiAgICBmZWF0dXJlLnNldFByb3BlcnRpZXMobmV3QXR0cmlidXRlcyk7XG4gIH1cbiAgXG4gIHJldHVybiBmZWF0dXJlO1xufTtcblxucHJvdG8uYWRkRmVhdHVyZXMgPSBmdW5jdGlvbihmZWF0dXJlcyl7XG4gIHRoaXMuZ2V0U291cmNlKCkuYWRkRmVhdHVyZXMoZmVhdHVyZXMpO1xufTtcblxucHJvdG8uc2V0RmVhdHVyZXNGaWx0ZXIgPSBmdW5jdGlvbihmZWF0dXJlc0ZpbHRlcil7XG4gIHRoaXMuX2ZlYXR1cmVzRmlsdGVyID0gZmVhdHVyZXNGaWx0ZXI7XG59O1xuXG5wcm90by5zZXRGaWVsZHMgPSBmdW5jdGlvbihmaWVsZHMpe1xuICB0aGlzLl9maWVsZHMgPSBmaWVsZHM7XG59O1xuXG5wcm90by5zZXRQa0ZpZWxkID0gZnVuY3Rpb24oKXtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICB2YXIgcGtmaWVsZFNldCA9IGZhbHNlO1xuICBfLmZvckVhY2godGhpcy5fZmllbGRzLGZ1bmN0aW9uKGZpZWxkKXtcbiAgICBpZiAoZmllbGQubmFtZSA9PSBzZWxmLnBrICl7XG4gICAgICBwa2ZpZWxkU2V0ID0gdHJ1ZTtcbiAgICB9XG4gIH0pO1xuICBcbiAgaWYgKCFwa2ZpZWxkU2V0KXtcbiAgICB0aGlzLl9maWVsZHNcbiAgfVxufTtcblxucHJvdG8uZ2V0RmVhdHVyZXMgPSBmdW5jdGlvbigpe1xuICByZXR1cm4gdGhpcy5nZXRTb3VyY2UoKS5nZXRGZWF0dXJlcygpO1xufTtcblxucHJvdG8uZ2V0RmVhdHVyZUlkcyA9IGZ1bmN0aW9uKCl7XG4gIHZhciBmZWF0dXJlSWRzID0gXy5tYXAodGhpcy5nZXRTb3VyY2UoKS5nZXRGZWF0dXJlcygpLGZ1bmN0aW9uKGZlYXR1cmUpe1xuICAgIHJldHVybiBmZWF0dXJlLmdldElkKCk7XG4gIH0pXG4gIHJldHVybiBmZWF0dXJlSWRzXG59O1xuXG5wcm90by5nZXRGaWVsZHMgPSBmdW5jdGlvbigpe1xuICByZXR1cm4gXy5jbG9uZURlZXAodGhpcy5fZmllbGRzKTtcbn07XG5cbnByb3RvLmdldEZpZWxkc05hbWVzID0gZnVuY3Rpb24oKXtcbiAgcmV0dXJuIF8ubWFwKHRoaXMuX2ZpZWxkcyxmdW5jdGlvbihmaWVsZCl7XG4gICAgcmV0dXJuIGZpZWxkLm5hbWU7XG4gIH0pO1xufTtcblxucHJvdG8uZ2V0RmllbGRzV2l0aEF0dHJpYnV0ZXMgPSBmdW5jdGlvbihvYmope1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIC8qdmFyIGZpZWxkcyA9IF8uY2xvbmVEZWVwKF8uZmlsdGVyKHRoaXMuX2ZpZWxkcyxmdW5jdGlvbihmaWVsZCl7XG4gICAgcmV0dXJuICgoZmllbGQubmFtZSAhPSBzZWxmLnBrKSAmJiBmaWVsZC5lZGl0YWJsZSk7XG4gIH0pKTsqL1xuICB2YXIgZmllbGRzID0gXy5jbG9uZURlZXAodGhpcy5fZmllbGRzKTtcbiAgXG4gIHZhciBmZWF0dXJlLCBhdHRyaWJ1dGVzO1xuICBcbiAgLy8gaWwgbWV0b2RvIGFjY2V0dGEgc2lhIGZlYXR1cmUgY2hlIGZpZFxuICBpZiAob2JqIGluc3RhbmNlb2Ygb2wuRmVhdHVyZSl7XG4gICAgZmVhdHVyZSA9IG9iajtcbiAgfVxuICBlbHNlIGlmIChvYmope1xuICAgIGZlYXR1cmUgPSB0aGlzLmdldEZlYXR1cmVCeUlkKG9iaik7XG4gIH1cbiAgaWYgKGZlYXR1cmUpe1xuICAgIGF0dHJpYnV0ZXMgPSBmZWF0dXJlLmdldFByb3BlcnRpZXMoKTtcbiAgfVxuICBcbiAgXy5mb3JFYWNoKGZpZWxkcyxmdW5jdGlvbihmaWVsZCl7XG4gICAgaWYgKGZlYXR1cmUpe1xuICAgICAgaWYgKCF0aGlzLl9QS2luQXR0cmlidXRlcyAmJiBmaWVsZC5uYW1lID09IHNlbGYucGspe1xuICAgICAgICBmaWVsZC52YWx1ZSA9IGZlYXR1cmUuZ2V0SWQoKTtcbiAgICAgIH1cbiAgICAgIGVsc2V7XG4gICAgICAgIGZpZWxkLnZhbHVlID0gYXR0cmlidXRlc1tmaWVsZC5uYW1lXTtcbiAgICAgIH1cbiAgICB9XG4gICAgZWxzZXtcbiAgICAgIGZpZWxkLnZhbHVlID0gbnVsbDtcbiAgICB9XG4gIH0pO1xuICByZXR1cm4gZmllbGRzO1xufTtcblxucHJvdG8uc2V0UmVsYXRpb25zID0gZnVuY3Rpb24ocmVsYXRpb25zKXtcbiAgXy5mb3JFYWNoKHJlbGF0aW9ucyxmdW5jdGlvbihyZWxhdGlvbixyZWxhdGlvbktleSl7XG4gICAgcmVsYXRpb24ubmFtZSA9IHJlbGF0aW9uS2V5O1xuICB9KTtcbiAgdGhpcy5fcmVsYXRpb25zID0gcmVsYXRpb25zO1xufTtcblxucHJvdG8uZ2V0UmVsYXRpb25zID0gZnVuY3Rpb24oKXtcbiAgcmV0dXJuIHRoaXMuX3JlbGF0aW9ucztcbn07XG5cbnByb3RvLmhhc1JlbGF0aW9ucyA9IGZ1bmN0aW9uKCl7XG4gIHJldHVybiAhXy5pc051bGwodGhpcy5fcmVsYXRpb25zKTtcbn07XG5cbnByb3RvLmdldFJlbGF0aW9uc05hbWVzID0gZnVuY3Rpb24oKXtcbiAgcmV0dXJuIF8ua2V5cyh0aGlzLl9yZWxhdGlvbnMpO1xufTtcblxucHJvdG8uZ2V0UmVsYXRpb25zRmtzS2V5cyA9IGZ1bmN0aW9uKCl7XG4gIHZhciBma3MgPSBbXTtcbiAgXy5mb3JFYWNoKHRoaXMuX3JlbGF0aW9ucyxmdW5jdGlvbihyZWxhdGlvbil7XG4gICAgZmtzLnB1c2gocmVsYXRpb24uZmspO1xuICB9KVxuICByZXR1cm4gZmtzO1xufTtcblxucHJvdG8uZ2V0UmVsYXRpb25GaWVsZHNOYW1lcyA9IGZ1bmN0aW9uKHJlbGF0aW9uKXtcbiAgdmFyIHJlbGF0aW9uRmllbGRzID0gdGhpcy5fcmVsYXRpb25zW3JlbGF0aW9uXTtcbiAgaWYgKHJlbGF0aW9uRmllbGRzKXtcbiAgICByZXR1cm4gXy5tYXAocmVsYXRpb25GaWVsZHMsZnVuY3Rpb24oZmllbGQpe1xuICAgICAgcmV0dXJuIGZpZWxkLm5hbWU7XG4gICAgfSk7XG4gIH1cbiAgcmV0dXJuIG51bGw7XG59O1xuXG4vLyBvdHRlbmdvIGxlIHJlbGF6aW9uaSBhIHBhcnRpcmUgZGFsIGZpZCBkaSB1bmEgZmVhdHVyZSBlc2lzdGVudGVcbnByb3RvLmdldFJlbGF0aW9uc1dpdGhBdHRyaWJ1dGVzID0gZnVuY3Rpb24oZmlkKXtcbiAgdmFyIHJlbGF0aW9ucyA9IF8uY2xvbmVEZWVwKHRoaXMuX3JlbGF0aW9ucyk7XG4gIHZhciBzZWxmID0gdGhpcztcbiAgaWYgKCFmaWQgfHwgIXRoaXMuZ2V0RmVhdHVyZUJ5SWQoZmlkKSl7XG4gICAgXy5mb3JFYWNoKHJlbGF0aW9ucyxmdW5jdGlvbihyZWxhdGlvbixyZWxhdGlvbktleSl7XG4gICAgICAgIC8vIGluaXppYWxtZW50ZSBzZXR0byBhIG51bGwgaSB2YWxvcmlcbiAgICAgIF8uZm9yRWFjaChyZWxhdGlvbi5maWVsZHMsZnVuY3Rpb24oZmllbGQpe1xuICAgICAgICBmaWVsZC52YWx1ZSA9IG51bGw7XG4gICAgICB9KVxuICAgIH0pO1xuICAgIHJldHVybiByZXNvbHZlKHJlbGF0aW9ucyk7XG4gIH1cbiAgZWxzZSB7XG4gICAgaWYgKHRoaXMubGF6eVJlbGF0aW9ucyl7XG4gICAgICB2YXIgZGVmZXJyZWQgPSAkLkRlZmVycmVkKCk7XG4gICAgICB2YXIgYXR0cmlidXRlcyA9IHRoaXMuZ2V0RmVhdHVyZUJ5SWQoZmlkKS5nZXRQcm9wZXJ0aWVzKCk7XG4gICAgICB2YXIgZmtzID0ge307XG4gICAgICBfLmZvckVhY2gocmVsYXRpb25zLGZ1bmN0aW9uKHJlbGF0aW9uLHJlbGF0aW9uS2V5KXtcbiAgICAgICAgdmFyIHVybCA9IHJlbGF0aW9uLnVybDtcbiAgICAgICAgdmFyIGtleVZhbHMgPSBbXTtcbiAgICAgICAgXy5mb3JFYWNoKHJlbGF0aW9uLmZrLGZ1bmN0aW9uKGZrS2V5KXtcbiAgICAgICAgICBma3NbZmtLZXldID0gYXR0cmlidXRlc1tma0tleV07XG4gICAgICAgIH0pO1xuICAgICAgfSlcbiAgICAgIFxuICAgICAgdGhpcy5nZXRSZWxhdGlvbnNXaXRoQXR0cmlidXRlc0Zyb21Ga3MoZmtzKVxuICAgICAgLnRoZW4oZnVuY3Rpb24ocmVsYXRpb25zUmVzcG9uc2Upe1xuICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlbGF0aW9uc1Jlc3BvbnNlKTtcbiAgICAgIH0pXG4gICAgICAuZmFpbChmdW5jdGlvbigpe1xuICAgICAgICBkZWZlcnJlZC5yZWplY3QoKTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2UoKTtcbiAgICB9XG4gIH1cbn07XG5cbi8vIG90dGVuZ28gbGUgcmVsYXppb25pIHZhbG9yaXp6YXRlIGEgcGFydGlyZSBkYSB1biBvZ2dldHRvIGNvbiBsZSBjaGlhdmkgRksgY29tZSBrZXlzIGUgaSBsb3JvIHZhbG9yaSBjb21lIHZhbHVlc1xucHJvdG8uZ2V0UmVsYXRpb25zV2l0aEF0dHJpYnV0ZXNGcm9tRmtzID0gZnVuY3Rpb24oZmtzKXtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICB2YXIgcmVsYXRpb25zID0gXy5jbG9uZURlZXAodGhpcy5fcmVsYXRpb25zKTtcbiAgdmFyIHJlbGF0aW9uc1JlcXVlc3RzID0gW107XG5cbiAgXy5mb3JFYWNoKHJlbGF0aW9ucyxmdW5jdGlvbihyZWxhdGlvbixyZWxhdGlvbktleSl7XG4gICAgdmFyIHVybCA9IHJlbGF0aW9uLnVybDtcbiAgICB2YXIga2V5VmFscyA9IFtdO1xuICAgIF8uZm9yRWFjaChyZWxhdGlvbi5mayxmdW5jdGlvbihma0tleSl7XG4gICAgICB2YXIgZmtWYWx1ZSA9IGZrc1tma0tleV07XG4gICAgICBrZXlWYWxzLnB1c2goZmtLZXkrXCI9XCIrZmtWYWx1ZSk7XG4gICAgfSk7XG4gICAgdmFyIGZrUGFyYW1zID0gXy5qb2luKGtleVZhbHMsXCImXCIpO1xuICAgIHVybCArPSBcIj9cIitma1BhcmFtcztcbiAgICByZWxhdGlvbnNSZXF1ZXN0cy5wdXNoKCQuZ2V0KHVybClcbiAgICAgIC50aGVuKGZ1bmN0aW9uKHJlbGF0aW9uQXR0cmlidXRlcyl7XG4gICAgICAgIF8uZm9yRWFjaChyZWxhdGlvbi5maWVsZHMsZnVuY3Rpb24oZmllbGQpe1xuICAgICAgICAgIGZpZWxkLnZhbHVlID0gcmVsYXRpb25BdHRyaWJ1dGVzWzBdW2ZpZWxkLm5hbWVdO1xuICAgICAgICB9KTtcbiAgICAgIH0pXG4gICAgKVxuICB9KVxuICBcbiAgcmV0dXJuICQud2hlbi5hcHBseSh0aGlzLHJlbGF0aW9uc1JlcXVlc3RzKVxuICAudGhlbihmdW5jdGlvbigpe1xuICAgIHJldHVybiByZWxhdGlvbnM7XG4gIH0pO1xufVxuXG5wcm90by5zZXRTdHlsZSA9IGZ1bmN0aW9uKHN0eWxlKXtcbiAgdGhpcy5fb2xMYXllci5zZXRTdHlsZShzdHlsZSk7XG59O1xuXG5wcm90by5nZXRMYXllciA9IGZ1bmN0aW9uKCl7XG4gIHJldHVybiB0aGlzLl9vbExheWVyO1xufTtcblxucHJvdG8uZ2V0U291cmNlID0gZnVuY3Rpb24oKXtcbiAgcmV0dXJuIHRoaXMuX29sTGF5ZXIuZ2V0U291cmNlKCk7XG59O1xuXG5wcm90by5nZXRGZWF0dXJlQnlJZCA9IGZ1bmN0aW9uKGlkKXtcbiAgcmV0dXJuIHRoaXMuX29sTGF5ZXIuZ2V0U291cmNlKCkuZ2V0RmVhdHVyZUJ5SWQoaWQpO1xufTtcblxucHJvdG8uY2xlYXIgPSBmdW5jdGlvbigpe1xuICB0aGlzLmdldFNvdXJjZSgpLmNsZWFyKCk7XG59O1xuXG5wcm90by5hZGRUb01hcCA9IGZ1bmN0aW9uKG1hcCl7XG4gIG1hcC5hZGRMYXllcih0aGlzLl9vbExheWVyKTtcbn07XG5cbi8vIGRhdGEgdW5hIGZlYXR1cmUgdmVyaWZpY28gc2UgaGEgdHJhIGdsaSBhdHRyaWJ1dGkgaSB2YWxvcmkgZGVsbGUgRksgZGVsbGUgKGV2ZW50dWFsaSkgcmVsYXppb25pXG5wcm90by5mZWF0dXJlSGFzUmVsYXRpb25zRmtzV2l0aFZhbHVlcyA9IGZ1bmN0aW9uKGZlYXR1cmUpe1xuICB2YXIgYXR0cmlidXRlcyA9IGZlYXR1cmUuZ2V0UHJvcGVydGllcygpO1xuICB2YXIgZmtzS2V5cyA9IHRoaXMuZ2V0UmVsYXRpb25zRmtzS2V5cygpO1xuICByZXR1cm4gXy5ldmVyeShma3NLZXlzLGZ1bmN0aW9uKGZrS2V5KXtcbiAgICB2YXIgdmFsdWUgPSBhdHRyaWJ1dGVzW2ZrS2V5XTtcbiAgICByZXR1cm4gKCFfLmlzTmlsKHZhbHVlKSAmJiB2YWx1ZSAhPSAnJyk7XG4gIH0pXG59O1xuXG4vLyBkYXRhIHVuYSBmZWF0dXJlIHBvcG9sbyB1biBvZ2dldHRvIGNvbiBjaGlhdmkvdmFsb3JpIGRlbGxlIEZLIGRlbGxlIChldmVudHVhbGkpIHJlbGF6aW9uZVxucHJvdG8uZ2V0UmVsYXRpb25zRmtzV2l0aFZhbHVlc0ZvckZlYXR1cmUgPSBmdW5jdGlvbihmZWF0dXJlKXtcbiAgdmFyIGF0dHJpYnV0ZXMgPSBmZWF0dXJlLmdldFByb3BlcnRpZXMoKTtcbiAgdmFyIGZrcyA9IHt9O1xuICB2YXIgZmtzS2V5cyA9IHRoaXMuZ2V0UmVsYXRpb25zRmtzS2V5cygpO1xuICBfLmZvckVhY2goZmtzS2V5cyxmdW5jdGlvbihma0tleSl7XG4gICAgZmtzW2ZrS2V5XSA9IGF0dHJpYnV0ZXNbZmtLZXldO1xuICB9KVxuICByZXR1cm4gZmtzO1xufTtcbiIsInZhciBpbmhlcml0ID0gcmVxdWlyZSgnY29yZS91dGlscy91dGlscycpLmluaGVyaXQ7XG52YXIgYmFzZSA9IHJlcXVpcmUoJ2NvcmUvdXRpbHMvdXRpbHMnKS5iYXNlO1xudmFyIGdlbyA9IHJlcXVpcmUoJ2NvcmUvdXRpbHMvZ2VvJyk7XG52YXIgTGF5ZXJTdGF0ZSA9IHJlcXVpcmUoJ2NvcmUvbGF5ZXIvbGF5ZXJzdGF0ZScpO1xudmFyIE1hcExheWVyID0gcmVxdWlyZSgnY29yZS9tYXAvbWFwbGF5ZXInKTtcbnZhciBSYXN0ZXJMYXllcnMgPSByZXF1aXJlKCdnM3ctb2wzL3NyYy9sYXllcnMvcmFzdGVycycpO1xuXG5mdW5jdGlvbiBXTVNMYXllcihvcHRpb25zLGV4dHJhUGFyYW1zKXtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICB0aGlzLkxBWUVSVFlQRSA9IHtcbiAgICBMQVlFUjogJ2xheWVyJyxcbiAgICBNVUxUSUxBWUVSOiAnbXVsdGlsYXllcidcbiAgfTtcblxuICB0aGlzLmV4dHJhUGFyYW1zID0gZXh0cmFQYXJhbXNcbiAgdGhpcy5sYXllcnMgPSBbXTtcbiAgXG4gIGJhc2UodGhpcyxvcHRpb25zKTtcbn1cbmluaGVyaXQoV01TTGF5ZXIsTWFwTGF5ZXIpXG52YXIgcHJvdG8gPSBXTVNMYXllci5wcm90b3R5cGU7XG5cbnByb3RvLmdldE9MTGF5ZXIgPSBmdW5jdGlvbigpe1xuICB2YXIgb2xMYXllciA9IHRoaXMuX29sTGF5ZXI7XG4gIGlmICghb2xMYXllcil7XG4gICAgb2xMYXllciA9IHRoaXMuX29sTGF5ZXIgPSB0aGlzLl9tYWtlT2xMYXllcigpO1xuICB9XG4gIHJldHVybiBvbExheWVyO1xufTtcblxucHJvdG8uZ2V0U291cmNlID0gZnVuY3Rpb24oKXtcbiAgcmV0dXJuIHRoaXMuZ2V0T0xMYXllcigpLmdldFNvdXJjZSgpO1xufTtcblxucHJvdG8uZ2V0SW5mb0Zvcm1hdCA9IGZ1bmN0aW9uKCkge1xuICByZXR1cm4gJ2FwcGxpY2F0aW9uL3ZuZC5vZ2MuZ21sJztcbn07XG5cbnByb3RvLmdldEdldEZlYXR1cmVJbmZvVXJsID0gZnVuY3Rpb24oY29vcmRpbmF0ZSxyZXNvbHV0aW9uLGVwc2cscGFyYW1zKXtcbiAgcmV0dXJuIHRoaXMuZ2V0T0xMYXllcigpLmdldFNvdXJjZSgpLmdldEdldEZlYXR1cmVJbmZvVXJsKGNvb3JkaW5hdGUscmVzb2x1dGlvbixlcHNnLHBhcmFtcyk7XG59O1xuXG5wcm90by5nZXRMYXllckNvbmZpZ3MgPSBmdW5jdGlvbigpe1xuICByZXR1cm4gdGhpcy5sYXllcnM7XG59O1xuXG5wcm90by5hZGRMYXllciA9IGZ1bmN0aW9uKGxheWVyQ29uZmlnKXtcbiAgdGhpcy5sYXllcnMucHVzaChsYXllckNvbmZpZyk7XG59O1xuXG5wcm90by50b2dnbGVMYXllciA9IGZ1bmN0aW9uKGxheWVyKXtcbiAgXy5mb3JFYWNoKHRoaXMubGF5ZXJzLGZ1bmN0aW9uKF9sYXllcil7XG4gICAgaWYgKF9sYXllci5pZCA9PSBsYXllci5pZCl7XG4gICAgICBfbGF5ZXIudmlzaWJsZSA9IGxheWVyLnZpc2libGU7XG4gICAgfVxuICB9KTtcbiAgdGhpcy5fdXBkYXRlTGF5ZXJzKCk7XG59O1xuICBcbnByb3RvLnVwZGF0ZSA9IGZ1bmN0aW9uKG1hcFN0YXRlLGV4dHJhUGFyYW1zKXtcbiAgdGhpcy5fdXBkYXRlTGF5ZXJzKG1hcFN0YXRlLGV4dHJhUGFyYW1zKTtcbn07XG5cbnByb3RvLmlzVmlzaWJsZSA9IGZ1bmN0aW9uKCl7XG4gIHJldHVybiB0aGlzLl9nZXRWaXNpYmxlTGF5ZXJzKCkubGVuZ3RoID4gMDtcbn07XG5cbnByb3RvLmdldFF1ZXJ5VXJsID0gZnVuY3Rpb24oKXtcbiAgdmFyIGxheWVyID0gdGhpcy5sYXllcnNbMF07XG4gIGlmIChsYXllci5pbmZvdXJsICYmIGxheWVyLmluZm91cmwgIT0gJycpIHtcbiAgICByZXR1cm4gbGF5ZXIuaW5mb3VybDtcbiAgfVxuICByZXR1cm4gdGhpcy5jb25maWcudXJsO1xufTtcblxucHJvdG8uZ2V0UXVlcnlMYXllcnMgPSBmdW5jdGlvbigpeyBcbiAgdmFyIGxheWVyID0gdGhpcy5sYXllcnNbMF07XG4gIHZhciBxdWVyeUxheWVycyA9IFtdO1xuICBfLmZvckVhY2godGhpcy5sYXllcnMsZnVuY3Rpb24obGF5ZXIpe1xuICAgIGlmIChMYXllclN0YXRlLmlzUXVlcnlhYmxlKGxheWVyKSkge1xuICAgICAgcXVlcnlMYXllcnMucHVzaCh7XG4gICAgICAgIGxheWVyTmFtZTogTGF5ZXJTdGF0ZS5nZXRXTVNMYXllck5hbWUobGF5ZXIpLFxuICAgICAgICBxdWVyeUxheWVyTmFtZTogTGF5ZXJTdGF0ZS5nZXRRdWVyeUxheWVyTmFtZShsYXllciksXG4gICAgICAgIGdlb21ldHJ5VHlwZTogTGF5ZXJTdGF0ZS5nZXRHZW9tZXRyeVR5cGUobGF5ZXIpLFxuICAgICAgICBhdHRyaWJ1dGVzOiBMYXllclN0YXRlLmdldEF0dHJpYnV0ZXMobGF5ZXIpXG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuICByZXR1cm4gcXVlcnlMYXllcnM7XG59O1xuXG5wcm90by5fbWFrZU9sTGF5ZXIgPSBmdW5jdGlvbigpe1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIHZhciB3bXNDb25maWcgPSB7XG4gICAgdXJsOiB0aGlzLmNvbmZpZy51cmwsXG4gICAgaWQ6IHRoaXMuY29uZmlnLmlkXG4gIH07XG4gIFxuICB2YXIgcmVwcmVzZW50YXRpdmVMYXllciA9IHRoaXMubGF5ZXJzWzBdOyAvL0JSVVRUTywgREVWTyBQUkVOREVSRSBVTiBMQVlFUiBBIENBU08gKElMIFBSSU1PKSBQRVIgVkVERVJFIFNFIFBVTlRBIEFEIFVOIFNPVVJDRSBESVZFUlNPIChkb3ZyZWJiZSBhY2NhZGVyZSBzb2xvIHBlciBpIGxheWVyIHNpbmdvbGksIFdNUyBlc3Rlcm5pKVxuICBcbiAgaWYgKHJlcHJlc2VudGF0aXZlTGF5ZXIuc291cmNlICYmIHJlcHJlc2VudGF0aXZlTGF5ZXIuc291cmNlLnR5cGUgPT0gJ3dtcycgJiYgcmVwcmVzZW50YXRpdmVMYXllci5zb3VyY2UudXJsKXtcbiAgICB3bXNDb25maWcudXJsID0gcmVwcmVzZW50YXRpdmVMYXllci5zb3VyY2UudXJsO1xuICB9O1xuICBcbiAgdmFyIG9sTGF5ZXIgPSBuZXcgUmFzdGVyTGF5ZXJzLldNU0xheWVyKHdtc0NvbmZpZyx0aGlzLmV4dHJhUGFyYW1zKTtcbiAgXG4gIG9sTGF5ZXIuZ2V0U291cmNlKCkub24oJ2ltYWdlbG9hZHN0YXJ0JywgZnVuY3Rpb24oKSB7XG4gICAgICAgIHNlbGYuZW1pdChcImxvYWRzdGFydFwiKTtcbiAgICAgIH0pO1xuICBvbExheWVyLmdldFNvdXJjZSgpLm9uKCdpbWFnZWxvYWRlbmQnLCBmdW5jdGlvbigpIHtcbiAgICAgIHNlbGYuZW1pdChcImxvYWRlbmRcIik7XG4gIH0pO1xuICBcbiAgcmV0dXJuIG9sTGF5ZXJcbn07XG5cbnByb3RvLl9nZXRWaXNpYmxlTGF5ZXJzID0gZnVuY3Rpb24obWFwU3RhdGUpe1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIHZhciB2aXNpYmxlTGF5ZXJzID0gW107XG4gIF8uZm9yRWFjaCh0aGlzLmxheWVycyxmdW5jdGlvbihsYXllcil7XG4gICAgdmFyIHJlc29sdXRpb25CYXNlZFZpc2liaWxpdHkgPSBsYXllci5tYXhyZXNvbHV0aW9uID8gKGxheWVyLm1heHJlc29sdXRpb24gJiYgbGF5ZXIubWF4cmVzb2x1dGlvbiA+IG1hcFN0YXRlLnJlc29sdXRpb24pIDogdHJ1ZTtcbiAgICBpZiAobGF5ZXIudmlzaWJsZSAmJiByZXNvbHV0aW9uQmFzZWRWaXNpYmlsaXR5KSB7XG4gICAgICB2aXNpYmxlTGF5ZXJzLnB1c2gobGF5ZXIpO1xuICAgIH0gICAgXG4gIH0pXG4gIHJldHVybiB2aXNpYmxlTGF5ZXJzO1xufTtcblxucHJvdG8uY2hlY2tMYXllckRpc2FibGVkID0gZnVuY3Rpb24obGF5ZXIscmVzb2x1dGlvbikge1xuICB2YXIgc2NhbGUgPSBnZW8ucmVzVG9TY2FsZShyZXNvbHV0aW9uKTtcbiAgdmFyIGVuYWJsZWQgPSB0cnVlO1xuICBpZiAobGF5ZXIubWF4cmVzb2x1dGlvbil7XG4gICAgZW5hYmxlZCA9IGVuYWJsZWQgJiYgKGxheWVyLm1heHJlc29sdXRpb24gPiByZXNvbHV0aW9uKTtcbiAgfVxuICBpZiAobGF5ZXIubWlucmVzb2x1dGlvbil7XG4gICAgZW5hYmxlZCA9IGVuYWJsZWQgJiYgKGxheWVyLm1pbnJlc29sdXRpb24gPCByZXNvbHV0aW9uKTtcbiAgfVxuICBpZiAobGF5ZXIubWluc2NhbGUpIHtcbiAgICBlbmFibGVkID0gZW5hYmxlZCAmJiAobGF5ZXIubWluc2NhbGUgPiBzY2FsZSk7XG4gIH1cbiAgaWYgKGxheWVyLm1heHNjYWxlKSB7XG4gICAgZW5hYmxlZCA9IGVuYWJsZWQgJiYgKGxheWVyLm1heHNjYWxlIDwgc2NhbGUpO1xuICB9XG4gIGxheWVyLmRpc2FibGVkID0gIWVuYWJsZWQ7XG59O1xuXG5wcm90by5jaGVja0xheWVyc0Rpc2FibGVkID0gZnVuY3Rpb24ocmVzb2x1dGlvbil7XG4gIHZhciBzZWxmID0gdGhpcztcbiAgXy5mb3JFYWNoKHRoaXMubGF5ZXJzLGZ1bmN0aW9uKGxheWVyKXtcbiAgICBzZWxmLmNoZWNrTGF5ZXJEaXNhYmxlZChsYXllcixyZXNvbHV0aW9uKTtcbiAgfSk7XG59O1xuXG5wcm90by5fdXBkYXRlTGF5ZXJzID0gZnVuY3Rpb24obWFwU3RhdGUsZXh0cmFQYXJhbXMpe1xuICB0aGlzLmNoZWNrTGF5ZXJzRGlzYWJsZWQobWFwU3RhdGUucmVzb2x1dGlvbik7XG4gIHZhciB2aXNpYmxlTGF5ZXJzID0gdGhpcy5fZ2V0VmlzaWJsZUxheWVycyhtYXBTdGF0ZSk7XG4gIGlmICh2aXNpYmxlTGF5ZXJzLmxlbmd0aCA+IDApIHtcbiAgICB2YXIgcGFyYW1zID0ge1xuICAgICAgTEFZRVJTOiBfLmpvaW4oXy5tYXAodmlzaWJsZUxheWVycyxmdW5jdGlvbihsYXllcil7XG4gICAgICAgIHJldHVybiBMYXllclN0YXRlLmdldFdNU0xheWVyTmFtZShsYXllcik7XG4gICAgICB9KSwnLCcpXG4gICAgfTtcbiAgICBpZiAoZXh0cmFQYXJhbXMpIHtcbiAgICAgIHBhcmFtcyA9IF8uYXNzaWduKHBhcmFtcyxleHRyYVBhcmFtcyk7XG4gICAgfVxuICAgIHRoaXMuX29sTGF5ZXIuc2V0VmlzaWJsZSh0cnVlKTtcbiAgICB0aGlzLl9vbExheWVyLmdldFNvdXJjZSgpLnVwZGF0ZVBhcmFtcyhwYXJhbXMpO1xuICB9XG4gIGVsc2Uge1xuICAgIHRoaXMuX29sTGF5ZXIuc2V0VmlzaWJsZShmYWxzZSk7XG4gIH1cbn07XG5cbm1vZHVsZS5leHBvcnRzID0gV01TTGF5ZXI7XG4iLCJ2YXIgaW5oZXJpdCA9IHJlcXVpcmUoJ2NvcmUvdXRpbHMvdXRpbHMnKS5pbmhlcml0O1xudmFyIGJhc2UgPSByZXF1aXJlKCdjb3JlL3V0aWxzL3V0aWxzJykuYmFzZTtcbnZhciBHM1dPYmplY3QgPSByZXF1aXJlKCdjb3JlL2czd29iamVjdCcpO1xuXG5cbmZ1bmN0aW9uIE1hcExheWVyKGNvbmZpZyl7XG4gIHRoaXMuY29uZmlnID0gY29uZmlnIHx8IHt9O1xuICB0aGlzLmlkID0gY29uZmlnLmlkO1xuICBcbiAgdGhpcy5fb2xMYXllciA9IG51bGw7XG4gIFxuICBiYXNlKHRoaXMpO1xufVxuaW5oZXJpdChNYXBMYXllcixHM1dPYmplY3QpO1xuXG52YXIgcHJvdG8gPSBNYXBMYXllci5wcm90b3R5cGU7XG5cbnByb3RvLmdldElkID0gZnVuY3Rpb24oKXtcbiAgcmV0dXJuIHRoaXMuaWQ7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IE1hcExheWVyO1xuIiwidmFyIGluaGVyaXQgPSByZXF1aXJlKCdjb3JlL3V0aWxzL3V0aWxzJykuaW5oZXJpdDtcbnZhciBiYXNlID0gcmVxdWlyZSgnY29yZS91dGlscy91dGlscycpLmJhc2U7XG52YXIgRzNXT2JqZWN0ID0gcmVxdWlyZSgnY29yZS9nM3dvYmplY3QnKTtcblxuZnVuY3Rpb24gTWFwc1JlZ2lzdHJ5KCkge1xuICBiYXNlKHRoaXMpO1xuICBcbiAgdGhpcy5fbWFwc1NlcnZpY2VzID0ge1xuICB9O1xuICBcbiAgdGhpcy5hZGRNYXAgPSBmdW5jdGlvbihtYXBTZXJ2aWNlKSB7XG4gICAgdGhpcy5fcmVnaXN0ZXJNYXBTZXJ2aWNlKG1hcFNlcnZpY2UpO1xuICB9O1xuICBcbiAgdGhpcy5fcmVnaXN0ZXJNYXBTZXJ2aWNlID0gZnVuY3Rpb24obWFwU2VydmljZSkge1xuICAgIHZhciBtYXBTZXJ2aWNlID0gdGhpcy5fbWFwc1NlcnZpY2VzW21hcFNlcnZpY2UuaWRdXG4gICAgaWYgKF8uaXNVbmRlZmluZWQobWFwU2VydmljZSkpIHtcbiAgICAgIHRoaXMuX21hcHNTZXJ2aWNlc1ttYXBTZXJ2aWNlLmlkXSA9IG1hcFNlcnZpY2U7XG4gICAgfVxuICB9O1xufSBcbmluaGVyaXQoTWFwc1JlZ2lzdHJ5LEczV09iamVjdCk7XG5cbm1vZHVsZS5leHBvcnRzID0gTWFwc1JlZ2lzdHJ5O1xuIiwidmFyIGluaGVyaXQgPSByZXF1aXJlKCdjb3JlL3V0aWxzL3V0aWxzJykuaW5oZXJpdDtcbnZhciBiYXNlID0gcmVxdWlyZSgnY29yZS91dGlscy91dGlscycpLmJhc2U7XG52YXIgRzNXT2JqZWN0ID0gcmVxdWlyZSgnY29yZS9nM3dvYmplY3QnKTtcblxudmFyIFBsdWdpbiA9IGZ1bmN0aW9uKCkge1xuICB0aGlzLm5hbWUgPSAnKG5vIG5hbWUpJztcbiAgdGhpcy5jb25maWcgPSBudWxsO1xuICBcbiAgYmFzZSh0aGlzKTtcbn1cbmluaGVyaXQoUGx1Z2luLEczV09iamVjdCk7XG5cbnZhciBwcm90byA9IFBsdWdpbi5wcm90b3R5cGU7XG5cbm1vZHVsZS5leHBvcnRzID0gUGx1Z2luO1xuIiwidmFyIGJhc2UgPSByZXF1aXJlKCdjb3JlL3V0aWxzL3V0aWxzJykuYmFzZTtcbnZhciBpbmhlcml0ID0gcmVxdWlyZSgnY29yZS91dGlscy91dGlscycpLmluaGVyaXQ7XG52YXIgRzNXT2JqZWN0ID0gcmVxdWlyZSgnY29yZS9nM3dvYmplY3QnKTtcbnZhciBBcHBsaWNhdGlvblNlcnZpY2UgPSByZXF1aXJlKCdjb3JlL2FwcGxpY2F0aW9uc2VydmljZScpO1xuXG4vL3ZhciBQbHVnaW4gPSByZXF1aXJlKCcuL3BsdWdpbicpO1xuLy92YXIgVG9vbHNTZXJ2aWNlID0gcmVxdWlyZSgnY29yZS9wbHVnaW4vdG9vbHNzZXJ2aWNlJyk7XG5cbmZ1bmN0aW9uIFBsdWdpbnNSZWdpc3RyeSgpe1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIHRoaXMuY29uZmlnID0gbnVsbDtcbiAgLy8gdW4gZG9tYW5pIHF1ZXN0byBzYXLDoCBkaW5hbWljb1xuICB0aGlzLl9wbHVnaW5zID0ge307XG5cbiAgdGhpcy5zZXR0ZXJzID0ge1xuICAgIHJlZ2lzdGVyUGx1Z2luOiBmdW5jdGlvbihwbHVnaW4pe1xuICAgICAgaWYgKCFzZWxmLl9wbHVnaW5zW3BsdWdpbi5uYW1lXSkge1xuICAgICAgICBzZWxmLl9wbHVnaW5zW3BsdWdpbi5uYW1lXSA9IHBsdWdpbjtcbiAgICAgICAgY29uc29sZS5sb2coXCJSZWdpc3RyYXRvIHBsdWdpbiBcIitwbHVnaW4ubmFtZSk7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIFxuICBiYXNlKHRoaXMpO1xuICBcbiAgdGhpcy5pbml0ID0gZnVuY3Rpb24ob3B0aW9ucyl7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIHRoaXMucGx1Z2luc0Jhc2VVcmwgPSBvcHRpb25zLnBsdXNpbmdCYXNlVXJsXG4gICAgdGhpcy5wbHVnaW5zQ29uZmlncyA9IG9wdGlvbnMucGx1Z2luc0NvbmZpZ3M7XG4gICAgXy5mb3JFYWNoKHRoaXMucGx1Z2luc0NvbmZpZ3MsZnVuY3Rpb24ocGx1Z2luQ29uZmlnLG5hbWUpe1xuICAgICAgc2VsZi5fc2V0dXAobmFtZSxwbHVnaW5Db25maWcpO1xuICAgIH0pXG4gIH07XG4gIFxuICB0aGlzLl9zZXR1cCA9IGZ1bmN0aW9uKG5hbWUscGx1Z2luQ29uZmlnKSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIGlmIChwbHVnaW5Db25maWcpe1xuICAgICAgdmFyIHVybCA9IHRoaXMucGx1Z2luc0Jhc2VVcmwrJ3BsdWdpbnMvJytuYW1lKycvcGx1Z2luLmpzJztcbiAgICAgICRzY3JpcHQodXJsKTtcbiAgICB9XG4gIH07XG4gIFxuICB0aGlzLmdldFBsdWdpbkNvbmZpZyA9IGZ1bmN0aW9uKHBsdWdpbk5hbWUpIHtcbiAgICByZXR1cm4gdGhpcy5wbHVnaW5zQ29uZmlnc1twbHVnaW5OYW1lXTtcbiAgfTtcbiAgXG4gIHRoaXMuYWN0aXZhdGUgPSBmdW5jdGlvbihwbHVnaW4pIHtcbiAgICB2YXIgdG9vbHMgPSBwbHVnaW4uZ2V0VG9vbHMoKTtcbiAgICBpZiAodG9vbHMubGVuZ3RoKSB7XG4gICAgICBUb29sc1NlcnZpY2UucmVnaXN0ZXJUb29sc1Byb3ZpZGVyKHBsdWdpbik7XG4gICAgfVxuICB9O1xufTtcblxuaW5oZXJpdChQbHVnaW5zUmVnaXN0cnksRzNXT2JqZWN0KTtcblxubW9kdWxlLmV4cG9ydHMgPSBuZXcgUGx1Z2luc1JlZ2lzdHJ5XG4iLCJ2YXIgaW5oZXJpdCA9IHJlcXVpcmUoJ2NvcmUvdXRpbHMvdXRpbHMnKS5pbmhlcml0O1xudmFyIGJhc2UgPSByZXF1aXJlKCdjb3JlL3V0aWxzLy91dGlscycpLmJhc2U7XG52YXIgRzNXT2JqZWN0ID0gcmVxdWlyZSgnY29yZS9nM3dvYmplY3QnKTtcbnZhciBBcHBsaWNhdGlvblNlcnZpY2UgPSByZXF1aXJlKCdjb3JlL2FwcGxpY2F0aW9uc2VydmljZScpO1xuXG5mdW5jdGlvbiBQcm9qZWN0KHByb2plY3RDb25maWcpIHtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICBcbiAgLyogc3RydXR0dXJhIG9nZ2V0dG8gJ3Byb2plY3QnXG4gIHtcbiAgICBpZCxcbiAgICB0eXBlLFxuICAgIGdpZCxcbiAgICBuYW1lLFxuICAgIGNycyxcbiAgICBleHRlbnQsXG4gICAgbGF5ZXJzdHJlZVxuICB9XG4gICovXG4gIHRoaXMuc3RhdGUgPSBwcm9qZWN0Q29uZmlnO1xuICBcbiAgdGhpcy5fbGF5ZXJzID0ge307XG4gIGZ1bmN0aW9uIHRyYXZlcnNlKG9iail7XG4gICAgXy5mb3JJbihvYmosIGZ1bmN0aW9uIChsYXllciwga2V5KSB7XG4gICAgICAgIC8vdmVyaWZpY2EgY2hlIGlsIHZhbG9yZSBkZWxsJ2lkIG5vbiBzaWEgbnVsbG9cbiAgICAgICAgaWYgKCFfLmlzTmlsKGxheWVyLmlkKSkge1xuICAgICAgICAgICAgc2VsZi5fbGF5ZXJzW2xheWVyLmlkXSA9IGxheWVyO1xuICAgICAgICB9XG4gICAgICAgIGlmICghXy5pc05pbChsYXllci5ub2RlcykpIHtcbiAgICAgICAgICAgIHRyYXZlcnNlKGxheWVyLm5vZGVzKTtcbiAgICAgICAgfVxuICAgIH0pO1xuICB9XG4gIHRyYXZlcnNlKHByb2plY3RDb25maWcubGF5ZXJzdHJlZSk7XG4gIFxuICAvKnZhciBldmVudFR5cGUgPSAncHJvamVjdHNldCc7XG4gIGlmIChkb3N3aXRjaCAmJiBkb3N3aXRjaCA9PT0gdHJ1ZSkge1xuICAgIGV2ZW50VHlwZSA9ICdwcm9qZWN0c3dpdGNoJztcbiAgfVxuICB0aGlzLmVtaXQoZXZlbnRUeXBlKTsqL1xuICBcbiAgdGhpcy5zZXR0ZXJzID0ge1xuICAgIHNldExheWVyc1Zpc2libGU6IGZ1bmN0aW9uKGxheWVycyx2aXNpYmxlKXtcbiAgICAgIF8uZm9yRWFjaChsYXllcnMsZnVuY3Rpb24obGF5ZXIpe1xuICAgICAgICBzZWxmLl9sYXllcnNbbGF5ZXIuaWRdLnZpc2libGUgPSB2aXNpYmxlO1xuICAgICAgfSlcbiAgICB9LFxuICAgIHNldEJhc2VMYXllcjogZnVuY3Rpb24oaWQpe1xuICAgICAgXy5mb3JFYWNoKHNlbGYuc3RhdGUuYmFzZUxheWVycyxmdW5jdGlvbihiYXNlTGF5ZXIpe1xuICAgICAgICBiYXNlTGF5ZXIudmlzaWJsZSA9IChiYXNlTGF5ZXIuaWQgPT0gaWQpO1xuICAgICAgfSlcbiAgICB9LFxuICAgIHNldExheWVyU2VsZWN0ZWQ6IGZ1bmN0aW9uKGxheWVyKXtcbiAgICAgIF8uZm9yRWFjaCh0aGlzLl9sYXllcnMsZnVuY3Rpb24oX2xheWVyKXtcbiAgICAgICAgX2xheWVyLnNlbGVjdGVkID0gKGxheWVyLmlkID09IF9sYXllci5pZCk7XG4gICAgICB9KVxuICAgIH1cbiAgfTtcblxuICBiYXNlKHRoaXMpO1xufVxuaW5oZXJpdChQcm9qZWN0LEczV09iamVjdCk7XG5cbnZhciBwcm90byA9IFByb2plY3QucHJvdG90eXBlO1xuXG5wcm90by5nZXRHaWQgPSBmdW5jdGlvbigpIHtcbiAgcmV0dXJuIHRoaXMuc3RhdGUuZ2lkO1xufVxuXG5wcm90by5nZXRMYXllciA9IGZ1bmN0aW9uKGlkKXtcbiAgcmV0dXJuIHRoaXMuX2xheWVyc1tpZF07XG59O1xuXG5wcm90by5nZXRMYXllcnMgPSBmdW5jdGlvbigpe1xuICByZXR1cm4gdGhpcy5fbGF5ZXJzO1xufTtcblxucHJvdG8uZ2V0TGF5ZXJCeUlkID0gZnVuY3Rpb24oaWQpIHtcbiAgdmFyIGxheWVyID0gbnVsbDtcbiAgXy5mb3JFYWNoKHRoaXMuZ2V0TGF5ZXJzKCksZnVuY3Rpb24oX2xheWVyKXtcbiAgICBpZiAoX2xheWVyLmlkID09IGlkKXtcbiAgICAgIGxheWVyID0gX2xheWVyO1xuICAgIH1cbiAgfSk7XG4gIHJldHVybiBsYXllcjtcbn07XG5cbnByb3RvLmdldExheWVyQnlOYW1lID0gZnVuY3Rpb24obmFtZSkge1xuICB2YXIgbGF5ZXIgPSBudWxsO1xuICBfLmZvckVhY2godGhpcy5nZXRMYXllcnMoKSxmdW5jdGlvbihfbGF5ZXIpe1xuICAgIGlmIChfbGF5ZXIubmFtZSA9PSBuYW1lKXtcbiAgICAgIGxheWVyID0gX2xheWVyO1xuICAgIH1cbiAgfSk7XG4gIHJldHVybiBsYXllcjtcbn07XG5cbnByb3RvLmdldFF1ZXJ5YWJsZUxheWVycyA9IGZ1bmN0aW9uKCl7XG4gIHZhciBxdWVyeWFibGVMYXllcnMgPSBbXTtcbiAgXy5mb3JFYWNoKHRoaXMuZ2V0TGF5ZXJzKCksZnVuY3Rpb24obGF5ZXIpe1xuICAgIGlmIChMYXllclN0YXRlLmlzUXVlcnlhYmxlKGxheWVyKSl7XG4gICAgICBxdWVyeWFibGVMYXllcnMucHVzaChsYXllcik7XG4gICAgfVxuICB9KTtcbiAgcmV0dXJuIHF1ZXJ5YWJsZUxheWVycztcbn07XG5cbnByb3RvLmdldExheWVyQXR0cmlidXRlcyA9IGZ1bmN0aW9uKGlkKXtcbiAgcmV0dXJuIHRoaXMuX2xheWVyc1tpZF0uYXR0cmlidXRlcztcbn07XG5cbnByb3RvLmdldExheWVyQXR0cmlidXRlTGFiZWwgPSBmdW5jdGlvbihpZCxuYW1lKXtcbiAgdmFyIGxhYmVsID0gJyc7XG4gIF8uZm9yRWFjaCh0aGlzLl9sYXllcnNbaWRdLmF0dHJpYnV0ZXMsZnVuY3Rpb24oYXR0cmlidXRlKXtcbiAgICBpZiAoYXR0cmlidXRlLm5hbWUgPT0gbmFtZSl7XG4gICAgICBsYWJlbCA9IGF0dHJpYnV0ZS5sYWJlbDtcbiAgICB9XG4gIH0pXG4gIHJldHVybiBsYWJlbDtcbn07XG5cbnByb3RvLnRvZ2dsZUxheWVyID0gZnVuY3Rpb24obGF5ZXIsdmlzaWJsZSl7XG4gIHZhciB2aXNpYmxlID0gdmlzaWJsZSB8fCAhbGF5ZXIudmlzaWJsZTtcbiAgdGhpcy5zZXRMYXllcnNWaXNpYmxlKFtsYXllcl0sdmlzaWJsZSk7XG59O1xuXG5wcm90by50b2dnbGVMYXllcnMgPSBmdW5jdGlvbihsYXllcnMsdmlzaWJsZSl7XG4gIHRoaXMuc2V0TGF5ZXJzVmlzaWJsZShsYXllcnMsdmlzaWJsZSk7XG59O1xuXG5wcm90by5zZWxlY3RMYXllciA9IGZ1bmN0aW9uKGxheWVyKXtcbiAgdGhpcy5zZXRMYXllclNlbGVjdGVkKGxheWVyKTtcbn07XG5cbnByb3RvLnVuc2VsZWN0TGF5ZXIgPSBmdW5jdGlvbihsYXllcikge1xuICBfLmZvckVhY2godGhpcy5nZXRMYXllcnMoKSxmdW5jdGlvbihfbGF5ZXIpe1xuICAgIGlmIChfbGF5ZXIgPT0gbGF5ZXIpIHtcbiAgICAgIF9sYXllci5zZWxlY3RlZCA9IGZhbHNlO1xuICAgIH1cbiAgfSk7XG59XG5cbnByb3RvLmdldFNlbGVjdGVkTGF5ZXJzID0gZnVuY3Rpb24oKSB7XG4gIHZhciBzZWxlY3RlZExheWVycyA9IFtdO1xuICBfLmZvckVhY2godGhpcy5nZXRMYXllcnMoKSxmdW5jdGlvbihfbGF5ZXIpe1xuICAgIGlmIChfbGF5ZXIuc2VsZWN0ZWQpIHtcbiAgICAgIHNlbGVjdGVkTGF5ZXJzLnB1c2goX2xheWVyKTtcbiAgICB9XG4gIH0pO1xuICByZXR1cm4gc2VsZWN0ZWRMYXllcnM7XG59XG5cbnByb3RvLnNldEdldFdtc1VybCA9IGZ1bmN0aW9uKGdldFdtc1VybEZuYyl7XG4gIHRoaXMuX2dldFdtc1VybEZuYyA9IGdldFdtc1VybEZuYztcbn07XG5cbnByb3RvLmdldFdtc1VybCA9IGZ1bmN0aW9uKCl7XG4gIHJldHVybiB0aGlzLl9nZXRXbXNVcmxGbmModGhpcy5zdGF0ZSk7XG59O1xuXG5wcm90by5nZXRMZWdlbmRVcmwgPSBmdW5jdGlvbihsYXllcil7XG4gIHZhciB1cmwgPSB0aGlzLmdldFdtc1VybCgpO1xuICBzZXAgPSAodXJsLmluZGV4T2YoJz8nKSA+IC0xKSA/ICcmJyA6ICc/JztcbiAgcmV0dXJuIHRoaXMuZ2V0V21zVXJsKCkrc2VwKydTRVJWSUNFPVdNUyZWRVJTSU9OPTEuMy4wJlJFUVVFU1Q9R2V0TGVnZW5kR3JhcGhpYyZTTERfVkVSU0lPTj0xLjEuMCZGT1JNQVQ9aW1hZ2UvcG5nJlRSQU5TUEFSRU5UPXRydWUmSVRFTUZPTlRDT0xPUj13aGl0ZSZMQVlFUlRJVExFPUZhbHNlJklURU1GT05UU0laRT0xMCZMQVlFUj0nK2xheWVyLm5hbWU7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFByb2plY3Q7XG4iLCJ2YXIgaW5oZXJpdCA9IHJlcXVpcmUoJ2NvcmUvdXRpbHMvdXRpbHMnKS5pbmhlcml0O1xudmFyIGJhc2UgPSByZXF1aXJlKCdjb3JlL3V0aWxzL3V0aWxzJykuYmFzZTtcbnZhciByZXNvbHZlID0gcmVxdWlyZSgnY29yZS91dGlscy91dGlscycpLnJlc29sdmU7XG52YXIgcmVqZWN0ID0gcmVxdWlyZSgnY29yZS91dGlscy91dGlscycpLnJlamVjdDtcbnZhciBHM1dPYmplY3QgPSByZXF1aXJlKCdjb3JlL2czd29iamVjdCcpO1xudmFyIFByb2plY3QgPSByZXF1aXJlKCdjb3JlL3Byb2plY3QvcHJvamVjdCcpO1xuXG5cbi8qIHNlcnZpY2VcbkZ1bnppb25lIGNvc3RydXR0b3JlIGNvbnRlbnRlbnRlIHRyZSBwcm9wcmlldGEnOlxuICAgIHNldHVwOiBtZXRvZG8gZGkgaW5pemlhbGl6emF6aW9uZVxuICAgIGdldExheWVyc1N0YXRlOiByaXRvcm5hIGwnb2dnZXR0byBMYXllcnNTdGF0ZVxuICAgIGdldExheWVyc1RyZWU6IHJpdG9ybmEgbCdhcnJheSBsYXllcnNUcmVlIGRhbGwnb2dnZXR0byBMYXllcnNTdGF0ZVxuKi9cblxuLy8gUHVibGljIGludGVyZmFjZVxuZnVuY3Rpb24gUHJvamVjdHNSZWdpc3RyeSgpe1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIHRoaXMuY29uZmlnID0gbnVsbDtcbiAgdGhpcy5pbml0aWFsaXplZCA9IGZhbHNlO1xuICB0aGlzLnByb2plY3RUeXBlID0gbnVsbDtcbiAgXG4gIHRoaXMuc2V0dGVycyA9IHtcbiAgICBzZXRDdXJyZW50UHJvamVjdDogZnVuY3Rpb24ocHJvamVjdCl7XG4gICAgICB0aGlzLnN0YXRlLmN1cnJlbnRQcm9qZWN0ID0gcHJvamVjdDtcbiAgICB9XG4gIH07XG4gIFxuICB0aGlzLnN0YXRlID0ge1xuICAgIGJhc2VMYXllcnM6IHt9LFxuICAgIG1pblNjYWxlOiBudWxsLFxuICAgIG1heHNjYWxlOiBudWxsLFxuICAgIGN1cnJlbnRQcm9qZWN0OiBudWxsXG4gIH07XG4gIFxuICAvLyB0dXR0ZSBsZSBjb25maWd1cmF6aW9uaSBkaSBiYXNlIGRlaSBwcm9nZXR0aSwgbWEgZGkgY3VpIG5vbiDDqCBkZXR0byBjaGUgc2lhIGFuY29yYSBkaXNwb25pYmlsZSBsJ2lzdGFuemEgKGxhenkgbG9hZGluZylcbiAgdGhpcy5fcGVuZGluZ1Byb2plY3RzID0gW107XG4gIHRoaXMuX3Byb2plY3RzID0ge307XG4gIFxuICBiYXNlKHRoaXMpO1xufVxuaW5oZXJpdChQcm9qZWN0c1JlZ2lzdHJ5LCBHM1dPYmplY3QpO1xuXG52YXIgcHJvdG8gPSBQcm9qZWN0c1JlZ2lzdHJ5LnByb3RvdHlwZTtcblxucHJvdG8uaW5pdCA9IGZ1bmN0aW9uKGNvbmZpZyl7XG4gIHZhciBzZWxmID0gdGhpcztcbiAgaWYgKCF0aGlzLmluaXRpYWxpemVkKXtcbiAgICB0aGlzLmluaXRpYWxpemVkID0gdHJ1ZTtcbiAgICB0aGlzLmNvbmZpZyA9IGNvbmZpZztcbiAgICB0aGlzLnNldHVwU3RhdGUoKTtcbiAgICByZXR1cm4gdGhpcy5nZXRQcm9qZWN0KGNvbmZpZy5pbml0cHJvamVjdClcbiAgICAudGhlbihmdW5jdGlvbihwcm9qZWN0KXtcbiAgICAgIHNlbGYuc2V0Q3VycmVudFByb2plY3QocHJvamVjdCk7XG4gICAgICAvL2FnZ2l1bnRvIHRpcG8gcHJvZ2V0dG9cbiAgICAgIHNlbGYuc2V0UHJvamVjdFR5cGUocHJvamVjdC5zdGF0ZS50eXBlKTtcbiAgICB9KTtcbiAgfVxufTtcblxucHJvdG8uc2V0UHJvamVjdFR5cGUgPSBmdW5jdGlvbihwcm9qZWN0VHlwZSkge1xuICAgdGhpcy5wcm9qZWN0VHlwZSA9IHByb2plY3RUeXBlO1xufTtcblxucHJvdG8uc2V0dXBTdGF0ZSA9IGZ1bmN0aW9uKCl7XG4gIHZhciBzZWxmID0gdGhpcztcbiAgXG4gIHNlbGYuc3RhdGUuYmFzZUxheWVycyA9IHNlbGYuY29uZmlnLmJhc2VsYXllcnM7XG4gIHNlbGYuc3RhdGUubWluU2NhbGUgPSBzZWxmLmNvbmZpZy5taW5zY2FsZTtcbiAgc2VsZi5zdGF0ZS5tYXhTY2FsZSA9IHNlbGYuY29uZmlnLm1heHNjYWxlO1xuICBzZWxmLnN0YXRlLmNycyA9IHNlbGYuY29uZmlnLmNycztcbiAgc2VsZi5zdGF0ZS5wcm9qNCA9IHNlbGYuY29uZmlnLnByb2o0O1xuICBzZWxmLmNvbmZpZy5wcm9qZWN0cy5mb3JFYWNoKGZ1bmN0aW9uKHByb2plY3Qpe1xuICAgIHByb2plY3QuYmFzZWxheWVycyA9IHNlbGYuY29uZmlnLmJhc2VsYXllcnM7XG4gICAgcHJvamVjdC5taW5zY2FsZSA9IHNlbGYuY29uZmlnLm1pbnNjYWxlO1xuICAgIHByb2plY3QubWF4c2NhbGUgPSBzZWxmLmNvbmZpZy5tYXhzY2FsZTtcbiAgICBwcm9qZWN0LmNycyA9IHNlbGYuY29uZmlnLmNycztcbiAgICBwcm9qZWN0LnByb2o0ID0gc2VsZi5jb25maWcucHJvajQ7XG4gICAgc2VsZi5fcGVuZGluZ1Byb2plY3RzLnB1c2gocHJvamVjdCk7XG4gIH0pXG4gIC8vdGhpcy5zdGF0ZS5wcm9qZWN0cyA9IGNvbmZpZy5ncm91cC5wcm9qZWN0cztcbn07XG5cbnByb3RvLmdldFByb2plY3RUeXBlID0gZnVuY3Rpb24oKSB7XG4gIHJldHVybiB0aGlzLnByb2plY3RUeXBlO1xufTtcblxucHJvdG8uZ2V0UGVuZGluZ1Byb2plY3RzID0gZnVuY3Rpb24oKSB7XG4gIHJldHVybiB0aGlzLl9wZW5kaW5nUHJvamVjdHMoKTtcbn07XG5cbnByb3RvLmdldEN1cnJlbnRQcm9qZWN0ID0gZnVuY3Rpb24oKXtcbiAgcmV0dXJuIHRoaXMuc3RhdGUuY3VycmVudFByb2plY3Q7XG59O1xuXG4vLyBvdHRlbmdvIGlsIHByb2dldHRvIGRhbCBzdW8gZ2lkOyByaXRvcm5hIHVuYSBwcm9taXNlIG5lbCBjYXNvIG5vbiBmb3NzZSBzdGF0byBhbmNvcmEgc2NhcmljYXRvIGlsIGNvbmZpZyBjb21wbGV0byAoZSBxdWluZGkgbm9uIHNpYSBhbmNvcmEgaXN0YW56aWF0byBQcm9qZWN0KVxucHJvdG8uZ2V0UHJvamVjdCA9IGZ1bmN0aW9uKHByb2plY3RHaWQpe1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIHZhciBkID0gJC5EZWZlcnJlZCgpO1xuICB2YXIgcGVuZGluZ1Byb2plY3QgPSBmYWxzZTtcbiAgdmFyIHByb2plY3QgPSBudWxsO1xuICB0aGlzLl9wZW5kaW5nUHJvamVjdHMuZm9yRWFjaChmdW5jdGlvbihfcGVuZGluZ1Byb2plY3Qpe1xuICAgIGlmIChfcGVuZGluZ1Byb2plY3QuZ2lkID09IHByb2plY3RHaWQpIHtcbiAgICAgIHBlbmRpbmdQcm9qZWN0ID0gX3BlbmRpbmdQcm9qZWN0O1xuICAgICAgcHJvamVjdCA9IHNlbGYuX3Byb2plY3RzW3Byb2plY3RHaWRdO1xuICAgIH1cbiAgfSlcbiAgaWYgKCFwZW5kaW5nUHJvamVjdCkge1xuICAgIHJldHVybiByZWplY3QoXCJQcm9qZWN0IGRvZXNuJ3QgZXhpc3RcIik7XG4gIH1cblxuICBpZiAocHJvamVjdCl7XG4gICAgcmV0dXJuIGQucmVzb2x2ZShwcm9qZWN0KTtcbiAgfVxuICBlbHNle1xuICAgIHJldHVybiB0aGlzLl9nZXRQcm9qZWN0RnVsbENvbmZpZyhwZW5kaW5nUHJvamVjdClcbiAgICAudGhlbihmdW5jdGlvbihwcm9qZWN0RnVsbENvbmZpZyl7XG4gICAgICB2YXIgcHJvamVjdENvbmZpZyA9IF8ubWVyZ2UocGVuZGluZ1Byb2plY3QscHJvamVjdEZ1bGxDb25maWcpO1xuICAgICAgc2VsZi5fYnVpbGRQcm9qZWN0VHJlZShwcm9qZWN0Q29uZmlnKTtcbiAgICAgIHZhciBwcm9qZWN0ID0gbmV3IFByb2plY3QocHJvamVjdENvbmZpZyk7XG4gICAgICBwcm9qZWN0LnNldEdldFdtc1VybChzZWxmLmNvbmZpZy5nZXRXbXNVcmwpOyAvLyBCUlVUVE8gTUEgUEVSIE9SQSBTSSBUSUVORSBDT1NJJ1xuICAgICAgc2VsZi5fcHJvamVjdHNbcHJvamVjdENvbmZpZy5naWRdID0gcHJvamVjdDtcbiAgICAgIHJldHVybiBkLnJlc29sdmUocHJvamVjdCk7XG4gICAgfSk7XG4gIH1cbiAgXG4gIHJldHVybiBkLnByb21pc2UoKTtcbn07XG4gIFxuLy9yaXRvcm5hIHVuYSBwcm9taXNlc1xucHJvdG8uX2dldFByb2plY3RGdWxsQ29uZmlnID0gZnVuY3Rpb24ocHJvamVjdEJhc2VDb25maWcpe1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIHZhciBkZWZlcnJlZCA9ICQuRGVmZXJyZWQoKTtcbiAgdmFyIHVybCA9IHRoaXMuY29uZmlnLmdldFByb2plY3RDb25maWdVcmwocHJvamVjdEJhc2VDb25maWcpO1xuICAkLmdldCh1cmwpLmRvbmUoZnVuY3Rpb24ocHJvamVjdEZ1bGxDb25maWcpe1xuICAgICAgZGVmZXJyZWQucmVzb2x2ZShwcm9qZWN0RnVsbENvbmZpZyk7XG4gIH0pXG4gIHJldHVybiBkZWZlcnJlZC5wcm9taXNlKCk7XG59O1xuXG5wcm90by5fYnVpbGRQcm9qZWN0VHJlZSA9IGZ1bmN0aW9uKHByb2plY3Qpe1xuICB2YXIgbGF5ZXJzID0gXy5rZXlCeShwcm9qZWN0LmxheWVycywnaWQnKTtcbiAgdmFyIGxheWVyc1RyZWUgPSBfLmNsb25lRGVlcChwcm9qZWN0LmxheWVyc3RyZWUpO1xuICBcbiAgZnVuY3Rpb24gdHJhdmVyc2Uob2JqKXtcbiAgICBfLmZvckluKG9iaiwgZnVuY3Rpb24gKGxheWVyLCBrZXkpIHtcbiAgICAgIC8vdmVyaWZpY2EgY2hlIGlsIG5vZG8gc2lhIHVuIGxheWVyIGUgbm9uIHVuIGZvbGRlclxuICAgICAgaWYgKCFfLmlzTmlsKGxheWVyLmlkKSkge1xuICAgICAgICAgIHZhciBmdWxsbGF5ZXIgPSBfLm1lcmdlKGxheWVyLGxheWVyc1tsYXllci5pZF0pO1xuICAgICAgICAgIG9ialtwYXJzZUludChrZXkpXSA9IGZ1bGxsYXllcjtcbiAgICAgICAgICBsYXllci5zZWxlY3RlZCA9IGZhbHNlO1xuICAgICAgICAgIGxheWVyLmRpc2FibGVkID0gZmFsc2U7XG4gICAgICB9XG4gICAgICBpZiAoIV8uaXNOaWwobGF5ZXIubm9kZXMpKXtcbiAgICAgICAgLy8gYWdnaXVuZ28gcHJvcHJpZXTDoCB0aXRsZSBwZXIgbCdhbGJlcm9cbiAgICAgICAgbGF5ZXIudGl0bGUgPSBsYXllci5uYW1lO1xuICAgICAgICB0cmF2ZXJzZShsYXllci5ub2Rlcyk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cbiAgdHJhdmVyc2UobGF5ZXJzVHJlZSk7XG4gIHByb2plY3QubGF5ZXJzdHJlZSA9IGxheWVyc1RyZWU7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IG5ldyBQcm9qZWN0c1JlZ2lzdHJ5KCk7XG4iLCJ2YXIgUHJvamVjdFR5cGVzID0ge1xuICBRREpBTkdPOiAncWRqYW5nbycsXG4gIE9HUjogJ29ncidcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gUHJvamVjdFR5cGVzOyIsInZhciBpbmhlcml0ID0gcmVxdWlyZSgnY29yZS91dGlscy91dGlscycpLmluaGVyaXQ7XG52YXIgYmFzZSA9IHJlcXVpcmUoJ2NvcmUvdXRpbHMvdXRpbHMnKS5iYXNlO1xudmFyIEczV09iamVjdCA9IHJlcXVpcmUoJ2NvcmUvZzN3b2JqZWN0Jyk7XG52YXIgcmVzb2x2ZSA9IHJlcXVpcmUoJ2NvcmUvdXRpbHMvdXRpbHMnKS5yZXNvbHZlO1xudmFyIFByb2plY3RzUmVnaXN0cnkgPSByZXF1aXJlKCdjb3JlL3Byb2plY3QvcHJvamVjdHNyZWdpc3RyeScpO1xuXG4vLyBGSUxUUklcbnZhciBGaWx0ZXJzID0ge1xuICBlcTogJz0nLFxuICBndDogJz4nLFxuICBndGU6ICc+PScsXG4gIGx0OiAnPCcsXG4gIGx0ZTogJz08JyxcbiAgTElLRTogJ0xJS0UnLFxuICBJTElLRTogJ0lMSUtFJyxcbiAgQU5EOiAnQU5EJyxcbiAgT1I6ICdPUicsXG4gIE5PVDogJyE9J1xufTtcblxuZnVuY3Rpb24gUXVlcnlRR0lTV01TUHJvdmlkZXIoKSB7XG5cbiAgc2VsZiA9IHRoaXM7XG4gIC8vZnVuemlvbmUgY2hlIGZhIGxhIHJpY2hpZXN0YSB2ZXJhIGUgcHJvcHJpYSBhbCBzZXJ2ZXIgcWdpc1xuICB0aGlzLnN1Ym1pdEdldEZlYXR1cmVJbmZvID0gZnVuY3Rpb24ob3B0aW9ucykge1xuXG4gICAgdmFyIHVybCA9IG9wdGlvbnMudXJsIHx8ICcnO1xuICAgIHZhciBxdWVyeWxheWVyID0gb3B0aW9ucy5xdWVyeWxheWVyIHx8IG51bGw7XG4gICAgdmFyIGZpbHRlciA9IG9wdGlvbnMuZmlsdGVyIHx8IG51bGw7XG4gICAgdmFyIGJib3ggPSBvcHRpb25zLmJib3ggfHwgUHJvamVjdHNSZWdpc3RyeS5nZXRDdXJyZW50UHJvamVjdCgpLnN0YXRlLmV4dGVudC5qb2luKCcsJyk7XG4gICAgdmFyIHNpbXBsZVdtc1NlYXJjaE1heFJlc3VsdHMgPSBudWxsO1xuICAgIHZhciBjcnMgPSBvcHRpb25zLmNycyB8fCAnNDMyNjsnXG4gICAgcmV0dXJuICQuZ2V0KCB1cmwsIHtcbiAgICAgICAgJ1NFUlZJQ0UnOiAnV01TJyxcbiAgICAgICAgJ1ZFUlNJT04nOiAnMS4zLjAnLFxuICAgICAgICAnUkVRVUVTVCc6ICdHZXRGZWF0dXJlSW5mbycsXG4gICAgICAgICdMQVlFUlMnOiBxdWVyeWxheWVyLFxuICAgICAgICAnUVVFUllfTEFZRVJTJzogcXVlcnlsYXllcixcbiAgICAgICAgJ0ZFQVRVUkVfQ09VTlQnOiBzaW1wbGVXbXNTZWFyY2hNYXhSZXN1bHRzIHx8ICA1MCxcbiAgICAgICAgJ0lORk9fRk9STUFUJzogJ2FwcGxpY2F0aW9uL3ZuZC5vZ2MuZ21sJyxcbiAgICAgICAgJ0NSUyc6ICdFUFNHOicrIGNycyxcbiAgICAgICAgJ0ZJTFRFUic6IGZpbHRlcixcbiAgICAgICAgLy8gVGVtcG9yYXJ5IGZpeCBmb3IgaHR0cHM6Ly9odWIucWdpcy5vcmcvaXNzdWVzLzg2NTYgKGZpeGVkIGluIFFHSVMgbWFzdGVyKVxuICAgICAgICAnQkJPWCc6IGJib3ggLy8gUVVJIENJIFZBIElMIEJCT1ggREVMTEEgTUFQUEFcbiAgICAgIH1cbiAgICApO1xuICAgfTtcblxuICAvL2Z1bnppb25lIGNoZSBmYSBsYSByaWNlcmNhXG4gIHRoaXMuZG9TZWFyY2ggPSBmdW5jdGlvbihxdWVyeUZpbHRlck9iamVjdCkge1xuXG4gICAgdmFyIHVybCA9IHF1ZXJ5RmlsdGVyT2JqZWN0LnVybDtcbiAgICB2YXIgcXVlcnlsYXllciA9IHF1ZXJ5RmlsdGVyT2JqZWN0LnF1ZXJ5bGF5ZXI7XG4gICAgdmFyIGZpbHRlck9iamVjdCA9IHF1ZXJ5RmlsdGVyT2JqZWN0LmZpbHRlck9iamVjdDtcbiAgICB2YXIgY3JzID0gcXVlcnlGaWx0ZXJPYmplY3QuY3JzO1xuICAgIC8vY3JlbyBpbCBmaWx0cm9cbiAgICB2YXIgZmlsdGVyID0gdGhpcy5jcmVhdGVGaWx0ZXIoZmlsdGVyT2JqZWN0LCBxdWVyeWxheWVyKTtcbiAgICAvL2VzZWd1byBsYSByaWNoaWVzdGEgZSByZXN0aXR1aXNjbyBjb21lIHJpc3Bvc3RhIGxhIHByb21pc2UgZGVsICQuZ2V0XG4gICAgdmFyIHJlc3BvbnNlID0gdGhpcy5zdWJtaXRHZXRGZWF0dXJlSW5mbyh7XG4gICAgICB1cmw6IHVybCxcbiAgICAgIGNyczogY3JzLFxuICAgICAgZmlsdGVyOiBmaWx0ZXIsXG4gICAgICBxdWVyeWxheWVyOiBxdWVyeWxheWVyXG4gICAgfSk7XG4gICAgcmV0dXJuIHJlc3BvbnNlO1xuICB9O1xuXG4gIHRoaXMuY3JlYXRlRmlsdGVyID0gZnVuY3Rpb24oZmlsdGVyT2JqZWN0LCBxdWVyeWxheWVyKSB7XG5cbiAgICAvLy8vL2luc2VyaXNjbyBpbCBub21lIGRlbCBsYXllciAodHlwZW5hbWUpIC8vL1xuICAgIHZhciBmaWx0ZXIgPSBbXTtcbiAgICBmdW5jdGlvbiBjcmVhdGVTaW5nbGVGaWx0ZXIoYm9vbGVhbk9iamVjdCkge1xuICAgICAgdmFyIGZpbHRlckVsZW1lbnRzID0gW107XG4gICAgICB2YXIgZmlsdGVyRWxlbWVudCA9ICcnO1xuICAgICAgdmFyIHZhbHVlRXh0cmEgPSBcIlwiO1xuICAgICAgdmFyIHZhbHVlUXVvdGVzID0gXCJcIjtcbiAgICAgIHZhciByb290RmlsdGVyO1xuICAgICAgXy5mb3JFYWNoKGJvb2xlYW5PYmplY3QsIGZ1bmN0aW9uKHYsIGssIG9iaikge1xuICAgICAgICAvL2NyZW8gaWwgZmlsdHJvIHJvb3QgY2hlIHNhcsOgIEFORCBPUlxuICAgICAgICByb290RmlsdGVyID0gRmlsdGVyc1trXTtcbiAgICAgICAgLy9xdWkgYyfDqCBhcnJheSBkZWdsaSBlbGVtZW50aSBkaSB1biBib29sZWFub1xuICAgICAgICBfLmZvckVhY2godiwgZnVuY3Rpb24oaW5wdXQpe1xuICAgICAgICAgIC8vc2NvcnJvIHN1IG9nZ2V0dG9cbiAgICAgICAgICBfLmZvckVhY2goaW5wdXQsIGZ1bmN0aW9uKHYsIGssIG9iaikge1xuICAgICAgICAgIC8vdmVyaWZpY28gc2UgaWwgdmFsb3JlIGRlbGwnb2dnZXR0byDDqCBhcnJheSBlIHF1aW5kaSDDqCBhbHRybyBvZ2dldHRvIHBhZHJlIGJvb2xlYW5vXG4gICAgICAgICAgICBpZiAoXy5pc0FycmF5KHYpKSB7XG4gICAgICAgICAgICAgIGZpbHRlckVsZW1lbnQgPSBjcmVhdGVTaW5nbGVGaWx0ZXIob2JqKTtcbiAgICAgICAgICAgIH0gZWxzZSB7IC8vIMOoIHVuIG9nZ2V0dG8gb3BlcmF0b3JlXG4gICAgICAgICAgICAgIGlmIChrID09ICdMSUtFJyB8fCBrID09ICdJTElLRScpIHtcbiAgICAgICAgICAgICAgICB2YWx1ZUV4dHJhID0gXCIlXCI7XG4gICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgIGZpbHRlck9wID0gRmlsdGVyc1trXTtcbiAgICAgICAgICAgICAgXy5mb3JFYWNoKGlucHV0LCBmdW5jdGlvbih2LCBrLCBvYmopIHtcbiAgICAgICAgICAgICAgICBfLmZvckVhY2godiwgZnVuY3Rpb24odiwgaywgb2JqKSB7XG4gICAgICAgICAgICAgICAgICAvL3ZlcmlmaWNvIHNlIGlsIHZhbG9yZSBub24gw6ggdW4gbnVtZXJvIGUgcXVpbmRpIGFnZ2l1bmdvIHNpbmdvbG8gYXBpY2VcbiAgICAgICAgICAgICAgICAgIGlmKGlzTmFOKHYpKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlUXVvdGVzID0gXCInXCI7XG4gICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZVF1b3RlcyA9IFwiXCI7XG4gICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgZmlsdGVyRWxlbWVudCA9IFwiXFxcIlwiICsgayArIFwiXFxcIiBcIisgZmlsdGVyT3AgK1wiIFwiICsgdmFsdWVRdW90ZXMgKyB2YWx1ZUV4dHJhICsgdiArIHZhbHVlRXh0cmEgKyB2YWx1ZVF1b3RlcztcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgZmlsdGVyRWxlbWVudHMucHVzaChmaWx0ZXJFbGVtZW50KTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJvb3RGaWx0ZXIgPSBmaWx0ZXJFbGVtZW50cy5qb2luKFwiIFwiKyByb290RmlsdGVyICsgXCIgXCIpO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gcm9vdEZpbHRlcjtcbiAgICB9O1xuICAgIC8vYXNzZWdubyBpbCBmaWx0cm8gY3JlYXRvXG4gICAgZmlsdGVyID0gcXVlcnlsYXllciArIFwiOlwiICsgY3JlYXRlU2luZ2xlRmlsdGVyKGZpbHRlck9iamVjdCk7XG4gICAgcmV0dXJuIGZpbHRlcjtcbiAgfTtcblxufTtcblxuaW5oZXJpdChRdWVyeVFHSVNXTVNQcm92aWRlciwgRzNXT2JqZWN0KTtcblxubW9kdWxlLmV4cG9ydHMgPSAgbmV3IFF1ZXJ5UUdJU1dNU1Byb3ZpZGVyKCk7XG4iLCJ2YXIgaW5oZXJpdCA9IHJlcXVpcmUoJ2NvcmUvdXRpbHMvdXRpbHMnKS5pbmhlcml0O1xudmFyIGJhc2UgPSByZXF1aXJlKCdjb3JlL3V0aWxzL3V0aWxzJykuYmFzZTtcbnZhciBHM1dPYmplY3QgPSByZXF1aXJlKCdjb3JlL2czd29iamVjdCcpO1xudmFyIHJlc29sdmUgPSByZXF1aXJlKCdjb3JlL3V0aWxzL3V0aWxzJykucmVzb2x2ZTtcbi8vZGVmaW5pc2NvIGlsIGZpbHRybyBvbDNcbnZhciBvbDNPR0NGaWx0ZXIgPSBvbC5mb3JtYXQub2djLmZpbHRlcjtcblxuLy9vZ2dldHRvIGNoZSB2aWVuZSBwYXNzYXRvIHBlciBlZmZldHR1cmFyZSBpbCBsYSBzZWFyY2hcbnZhciBvbDNHZXRGZWF0dXJlUmVxdWVzdE9iamVjdCA9IHtcbiAgc3JzTmFtZTogJ0VQU0c6JyxcbiAgZmVhdHVyZU5TOiAnJyxcbiAgZmVhdHVyZVByZWZpeDogJycsXG4gIGZlYXR1cmVUeXBlczogW10sXG4gIG91dHB1dEZvcm1hdDogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICBmaWx0ZXI6IG51bGwgLy8gZXNlbXBpbyBmaWx0cm8gY29tcG9zdG8gb2wzT0dDRmlsdGVyLmFuZChvbDNPR0NGaWx0ZXIuYmJveCgndGhlX2dlb20nLCBbMSwgMiwgMywgNF0sICd1cm46b2djOmRlZjpjcnM6RVBTRzo6NDMyNicpLG9sM09HQ0ZpbHRlci5saWtlKCduYW1lJywgJ05ldyonKSlcbn07XG5cbi8vIEZJTFRSSSBPTDNcbnZhciBvbDNGaWx0ZXJzID0ge1xuICBlcTogb2wzT0dDRmlsdGVyLmVxdWFsVG8sXG4gIGd0OiBvbDNPR0NGaWx0ZXIuZ3JlYXRlclRoYW4sXG4gIGd0ZTogb2wzT0dDRmlsdGVyLmdyZWF0ZXJUaGFuT3JFcXVhbFRvLFxuICBsdDogb2wzT0dDRmlsdGVyLmxlc3NUaGFuLFxuICBsdGU6IG9sM09HQ0ZpbHRlci5sZXNzVGhhbk9yRXF1YWxUbyxcbiAgbGlrZTogb2wzT0dDRmlsdGVyLmxpa2UsXG4gIGlsaWtlOiBcIlwiLFxuICBiYm94OiBvbDNPR0NGaWx0ZXIuYmJveCxcbiAgQU5EOiBvbDNPR0NGaWx0ZXIuYW5kLFxuICBPUjogb2wzT0dDRmlsdGVyLm9yLFxuICBOT1Q6IG9sM09HQ0ZpbHRlci5ub3Rcbn07XG5cblxuLy8gQ1JFQVRPIFVOIEZJTFRSTyBESSBFU0VNUElPIFBFUiBWRVJJRklDQVJFIExBIENPUlJFVFRFWlpBIERFTExBIEZVTlpJT05FIENSRUFaSU9ORSBGSUxUUk9cbnZhciB0ZXN0RmlsdGVyID0ge1xuICAnQU5EJzpcbiAgICBbXG4gICAgICB7XG4gICAgICAgIGVxOlxuICAgICAgICAgIHtcbiAgICAgICAgICAgIGdpZCA6IDEwXG4gICAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgJ09SJzpcbiAgICAgICAgICBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIGVxOiB7XG4gICAgICAgICAgICAgICAgcGlwcG8gOiAnbGFsbG8nXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIGd0OiB7XG4gICAgICAgICAgICAgICAgaWQgOiA1XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgIF1cbiAgICAgIH1cbiAgIF1cbn1cbi8vLy8vLy8vLy8vLy8vXG5cbi8vL0ZJTFRSSSBDVVNUT01cbnZhciBzdGFuZGFyZEZpbHRlclRlbXBsYXRlcyA9IGZ1bmN0aW9uKCkge1xuICB2YXIgY29tbW9uID0ge1xuICAgIHByb3BlcnR5TmFtZTpcbiAgICAgICAgICBcIjxQcm9wZXJ0eU5hbWU+XCIgK1xuICAgICAgICAgICAgXCJbUFJPUF1cIiArXG4gICAgICAgICAgXCI8L1Byb3BlcnR5TmFtZT5cIixcbiAgICBsaXRlcmFsOlxuICAgICAgICAgIFwiPExpdGVyYWw+XCIgK1xuICAgICAgICAgICAgXCJbVkFMVUVdXCIgK1xuICAgICAgICAgIFwiPC9MaXRlcmFsPlwiXG4gIH07XG4gIHJldHVybiB7XG4gICAgZXE6IFwiPFByb3BlcnR5SXNFcXVhbFRvPlwiICtcbiAgICAgICAgICAgIGNvbW1vbi5wcm9wZXJ0eU5hbWUgK1xuICAgICAgICAgICAgY29tbW9uLmxpdGVyYWwgK1xuICAgICAgICBcIjwvUHJvcGVydHlJc0VxdWFsVG8+XCIsXG4gICAgZ3Q6IFwiPFByb3BlcnR5SXNHcmVhdGVyVGhhbj5cIiArXG4gICAgICAgICAgICBjb21tb24ucHJvcGVydHlOYW1lICtcbiAgICAgICAgICAgIGNvbW1vbi5saXRlcmFsICtcbiAgICAgICAgIFwiPC9Qcm9wZXJ0eUlzR3JlYXRlclRoYW4+XCIsXG4gICAgZ3RlOlwiXCIsXG4gICAgbHQ6IFwiXCIsXG4gICAgbHRlOiBcIlwiLFxuICAgIGxpa2U6IFwiXCIsXG4gICAgaWxpa2U6IFwiXCIsXG4gICAgQU5EOiBcIjxBbmQ+W0FORF08L0FuZD5cIixcbiAgICBPUjogXCI8T3I+W09SXTwvT3I+XCIsXG4gIH1cbn0oKTtcblxuLy8vLy9cbnZhciBxZ2lzRmlsdGVyVGVtcGxhdGVzID0ge1xuICAvLyBjb2RpY2UgcXVpXG59O1xuXG52YXIgbWFwc2VydmVyRmlsdGVyVGVtcGxhdGVzID0ge1xuICAvLyBjb2RpY2UgcXVpXG59O1xuXG52YXIgZ2Vvc2VydmVyRmlsdGVyVGVtcGxhdGVzID0ge1xuICAvLyBjb2RpY2UgcXVpXG59O1xuXG5mdW5jdGlvbiBRdWVyeVdGU1Byb3ZpZGVyKCl7XG4gIHZhciBzZWxmID0gdGhpcztcbiAgdmFyIGQgPSAkLkRlZmVycmVkKCk7XG4gIHZhciByZXN1bHRzID0ge1xuICAgIGhlYWRlcnM6W10sXG4gICAgdmFsdWVzOltdXG4gIH07XG5cbiAgdGhpcy5kb1NlYXJjaCA9IGZ1bmN0aW9uKHF1ZXJ5RmlsdGVyT2JqZWN0KXtcbiAgICB2YXIgb2djc2VydmVydHlwZSA9IHF1ZXJ5RmlsdGVyT2JqZWN0LnNlcnZlcnR5cGU7XG4gICAgdmFyIHVybCA9IHF1ZXJ5RmlsdGVyT2JqZWN0LnVybDtcbiAgICB2YXIgcXVlcnlsYXllciA9IHF1ZXJ5RmlsdGVyT2JqZWN0LnF1ZXJ5bGF5ZXI7XG4gICAgdmFyIGZpbHRlck9iamVjdCA9IHF1ZXJ5RmlsdGVyT2JqZWN0LmZpbHRlck9iamVjdDtcbiAgICB2YXIgY3JzID0gcXVlcnlGaWx0ZXJPYmplY3QuY3JzO1xuICAgIC8vc2V0dG8gaWwgc3JzXG4gICAgb2wzR2V0RmVhdHVyZVJlcXVlc3RPYmplY3Quc3JzTmFtZSs9Y3JzIHx8ICc0MzI2JztcbiAgICB2YXIgcmVzcG9uc2UsIGZpbHRlcjtcbiAgICBzd2l0Y2ggKG9nY3NlcnZlcnR5cGUpIHtcbiAgICAgIGNhc2UgJ09HQyc6XG4gICAgICAgIGZpbHRlciA9IHRoaXMuY3JlYXRlU3RhbmRhcmRGaWx0ZXIoZmlsdGVyT2JqZWN0LCBxdWVyeWxheWVyKTtcbiAgICAgICAgcmVzcG9uc2UgPSB0aGlzLnN0YW5kYXJkU2VhcmNoKHVybCwgZmlsdGVyKTtcbiAgICAgICAgcmV0dXJuIHJlc29sdmUocmVzcG9uc2UpXG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAncWdpcyc6XG4gICAgICAgIGZpbHRlciA9IHRoaXMuY3JlYXRlUWdpc0ZpbHRlcihmaWx0ZXJPYmplY3QpO1xuICAgICAgICByZXNwb25zZSA9IHRoaXMucWdpc1NlYXJjaChxdWVyeWxheWVyLCB1cmwsIGZpbHRlcik7XG4gICAgICAgIHJldHVybiByZXNvbHZlKHJlc3BvbnNlKVxuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ21hcHNlcnZlcic6XG4gICAgICAgIGZpbHRlciA9IHRoaXMuY3JlYXRlTWFwc2VydmVyRmlsdGVyKGZpbHRlck9iamVjdCk7XG4gICAgICAgIHJlc3BvbnNlID0gdGhpcy5tYXBzZXJ2ZXJTZWFyY2gocXVlcnlsYXllciwgdXJsLCBmaWx0ZXIpO1xuICAgICAgICByZXR1cm4gcmVzb2x2ZShyZXNwb25zZSlcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdnZW9zZXJ2ZXInOlxuICAgICAgICBmaWx0ZXIgPSB0aGlzLmNyZWF0ZUdlb3NlcnZlckZpbHRlcihmaWx0ZXJPYmplY3QpO1xuICAgICAgICByZXNwb25zZSA9IHRoaXMuZ2Vvc2VydmVyU2VhcmNoKHF1ZXJ5bGF5ZXIsIHVybCwgZmlsdGVyKTtcbiAgICAgICAgcmV0dXJuIHJlc29sdmUocmVzcG9uc2UpXG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgcmV0dXJuIGZhbHNlXG4gICAgfVxuICB9O1xuXG4gIHRoaXMuc3RhbmRhcmRTZWFyY2ggPSBmdW5jdGlvbih1cmwsIGZpbHRlcil7XG4gICAgY29uc29sZS5sb2coZmlsdGVyKVxuICB9O1xuICB0aGlzLmNyZWF0ZVN0YW5kYXJkRmlsdGVyID0gZnVuY3Rpb24oZmlsdGVyT2JqZWN0LCBxdWVyeWxheWVyKSB7XG4gICAgLy8vLy9pbnNlcmlzY28gaWwgbm9tZSBkZWwgbGF5ZXIgKHR5cGVuYW1lKSAvLy9cbiAgICBvbDNHZXRGZWF0dXJlUmVxdWVzdE9iamVjdC5mZWF0dXJlVHlwZXMucHVzaChxdWVyeWxheWVyKTtcbiAgICB2YXIgZmlsdGVyID0gW107XG4gICAgZnVuY3Rpb24gY3JlYXRlU2luZ2xlRmlsdGVyKGJvb2xlYW5PYmplY3QpIHtcbiAgICAgIHZhciBmaWx0ZXJFbGVtZW50cyA9IFtdO1xuICAgICAgdmFyIGZpbHRlckVsZW1lbnQgPSAnJztcbiAgICAgIHZhciByb290RmlsdGVyO1xuICAgICAgXy5mb3JFYWNoKGJvb2xlYW5PYmplY3QsIGZ1bmN0aW9uKHYsIGssIG9iaikge1xuICAgICAgICAvL2NyZW8gaWwgZmlsdHJvIHJvb3QgY2hlIHNhcsOgIEFORCBPUlxuICAgICAgICByb290RmlsdGVyID0gb2wzRmlsdGVyc1trXTtcbiAgICAgICAgLy9xdWkgYyfDqCBhcnJheSBkZWdsaSBlbGVtZW50aSBkaSB1biBib29sZWFub1xuICAgICAgICBfLmZvckVhY2godiwgZnVuY3Rpb24oaW5wdXQpe1xuICAgICAgICAgIC8vc2NvcnJvIHN1IG9nZ2V0dG8gb3BlcmF0b3JlXG4gICAgICAgICAgXy5mb3JFYWNoKGlucHV0LCBmdW5jdGlvbih2LCBrLCBvYmopIHtcbiAgICAgICAgICAvL8OoIHVuIGFycmF5IGUgcXVpbmRpIMOoIGFsdHJvIG9nZ2V0dG8gcGFkcmUgYm9vbGVhbm9cbiAgICAgICAgICAgIGlmIChfLmlzQXJyYXkodikpIHtcbiAgICAgICAgICAgICAgZmlsdGVyRWxlbWVudCA9IGNyZWF0ZVNpbmdsZUZpbHRlcihvYmopO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgZmlsdGVyRWxlbWVudCA9IG9sM0ZpbHRlcnNba107XG4gICAgICAgICAgICAgIF8uZm9yRWFjaChpbnB1dCwgZnVuY3Rpb24odiwgaywgb2JqKSB7XG4gICAgICAgICAgICAgICAgXy5mb3JFYWNoKHYsIGZ1bmN0aW9uKHYsIGssIG9iaikge1xuICAgICAgICAgICAgICAgICAgZmlsdGVyRWxlbWVudCA9IGZpbHRlckVsZW1lbnQoaywgdik7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGZpbHRlckVsZW1lbnRzLnB1c2goZmlsdGVyRWxlbWVudCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgICAvL3ZlcmlmaWNvIGNoZSBjaSBzaWFubyBhbG1lbm8gZHVlIGNvbmRpemlvbmUgbmVsIGZpbHRybyBBTkQuIE5lbCBjYXNvIGRpIHVuYSBzb2xhIGNvbmRpemlvbmUgKGVzZW1waW8gOiB1biBzb2xvIGlucHV0KVxuICAgICAgICAvL2VzdHJhZ2dvIHNvbG8gbCdlbGVtZW50byBmaWx0cm8gYWx0cmltZW50aSBkYSBlcnJvcmUgLS0gREEgVkVSSUZJQ0FSRSBTRSBDQU1CSUFSTE9cbiAgICAgICAgaWYgKGZpbHRlckVsZW1lbnRzLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICByb290RmlsdGVyID0gcm9vdEZpbHRlci5hcHBseSh0aGlzLCBmaWx0ZXJFbGVtZW50cyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcm9vdEZpbHRlciA9IGZpbHRlckVsZW1lbnRzWzBdO1xuICAgICAgICB9O1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gcm9vdEZpbHRlcjtcbiAgICB9O1xuICAgIC8vYXNzZWdubyBpbCBmaWx0cm8gY3JlYXRvXG4gICAgb2wzR2V0RmVhdHVyZVJlcXVlc3RPYmplY3QuZmlsdGVyID0gY3JlYXRlU2luZ2xlRmlsdGVyKGZpbHRlck9iamVjdCk7XG4gICAgLy9jcmVvIGlsIGZpbHRybyB1dGlsaXp6YW5kbyBvbDNcbiAgICBmaWx0ZXIgPSBuZXcgb2wuZm9ybWF0LldGUygpLndyaXRlR2V0RmVhdHVyZShvbDNHZXRGZWF0dXJlUmVxdWVzdE9iamVjdCk7XG4gICAgcmV0dXJuIGZpbHRlcjtcbiAgfTtcblxuICB0aGlzLnFnaXNTZWFyY2ggPSBmdW5jdGlvbih1cmxzLCBmaWx0ZXIpe1xuICAgICQuZ2V0KHNlYXJjaFVybCkudGhlbihmdW5jdGlvbihyZXN1bHQpe1xuICAgICAgc2VsZi5lbWl0KFwic2VhcmNoZG9uZVwiLHJlc3VsdCk7XG4gICAgfSk7XG4gICAgcmV0dXJuIGQucHJvbWlzZSgpO1xuICB9O1xuICB0aGlzLmNyZWF0ZVFHaXNGaWx0ZXIgPSBmdW5jdGlvbihmaWx0ZXJPYmplY3QpIHtcbiAgICB2YXIgZmlsdGVyO1xuICAgIHJldHVybiBmaWx0ZXJcbiAgfTtcbiAgdGhpcy5tYXBzZXJ2ZXJTZWFyY2ggPSBmdW5jdGlvbihxdWVyeWxheWVyLCB1cmwsIGZpbHRlcil7XG4gICAgcmV0dXJuIGQucHJvbWlzZSgpO1xuICB9O1xuICB0aGlzLmNyZWF0ZU1hcHNlcnZlckZpbHRlciA9IGZ1bmN0aW9uKGZpbHRlck9iamVjdCkge1xuICAgIHZhciBmaWx0ZXI7XG4gICAgcmV0dXJuIGZpbHRlclxuICB9O1xuICB0aGlzLmdlb3NlcnZlclNlYXJjaCA9IGZ1bmN0aW9uKHF1ZXJ5bGF5ZXIsIHVybCwgZmlsdGVyKXtcbiAgICByZXR1cm4gZC5wcm9taXNlKCk7XG4gIH07XG4gIHRoaXMuY3JlYXRlR2Vvc2VydmVyRmlsdGVyID0gZnVuY3Rpb24oZmlsdGVyT2JqZWN0KSB7XG4gICAgdmFyIGZpbHRlcjtcbiAgICByZXR1cm4gZmlsdGVyXG4gIH07XG4gIGJhc2UodGhpcyk7XG59XG5pbmhlcml0KFF1ZXJ5V0ZTUHJvdmlkZXIsRzNXT2JqZWN0KTtcblxubW9kdWxlLmV4cG9ydHMgPSAgbmV3IFF1ZXJ5V0ZTUHJvdmlkZXIoKVxuXG4iLCJ2YXIgaW5oZXJpdCA9IHJlcXVpcmUoJ2NvcmUvdXRpbHMvdXRpbHMnKS5pbmhlcml0O1xudmFyIGJhc2UgPSByZXF1aXJlKCdjb3JlL3V0aWxzL3V0aWxzJykuYmFzZTtcbnZhciBHM1dPYmplY3QgPSByZXF1aXJlKCdjb3JlL2czd29iamVjdCcpO1xudmFyIFByb2plY3RzUmVnaXN0cnkgPSByZXF1aXJlKCdjb3JlL3Byb2plY3QvcHJvamVjdHNyZWdpc3RyeScpO1xudmFyIFF1ZXJ5V0ZTUHJvdmlkZXIgPSByZXF1aXJlKCcuL3F1ZXJ5V0ZTUHJvdmlkZXInKTtcbnZhciBRdWVyeVFHSVNXTVNQcm92aWRlciA9IHJlcXVpcmUoJy4vcXVlcnlRR0lTV01TUHJvdmlkZXInKTtcbnZhciBDb21wb25lbnRzUmVnaXN0cnkgPSByZXF1aXJlKCdzZGsvZ3VpL2NvbXBvbmVudHNyZWdpc3RyeScpO1xuXG52YXIgUHJvdmlkZXIgPSB7XG4gICdRR0lTJzogUXVlcnlRR0lTV01TUHJvdmlkZXIsXG4gICdPR0MnOiBRdWVyeVdGU1Byb3ZpZGVyXG59O1xuLy9vZ2dldHRvIHF1ZXJ5IHNlcnZpY2VcbmZ1bmN0aW9uIFF1ZXJ5U2VydmljZSgpe1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIHRoaXMudXJsID0gXCJcIjtcbiAgdGhpcy5maWx0ZXJPYmplY3QgPSB7fTtcbiAgdGhpcy5xdWVyeUZpbHRlck9iamVjdCA9IHt9O1xuICAvL21lIGxvIHBvcnRvIGRhIG1hcHF1ZXJ5c2VydmljZSBtYSB2ZWRpYW1vIGNvc2Egc3VjY2VkZVxuICB0aGlzLmluaXQgPSBmdW5jdGlvbihtYXApe1xuICAgIHRoaXMubWFwID0gbWFwO1xuICB9XG4gIHRoaXMuc2V0RmlsdGVyT2JqZWN0ID0gZnVuY3Rpb24oZmlsdGVyT2JqZWN0KXtcbiAgICB0aGlzLmZpbHRlck9iamVjdCA9IGZpbHRlck9iamVjdDtcbiAgfTtcblxuICB0aGlzLmdldEZpbHRlck9iamVjdCA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLmZpbHRlck9iamVjdDtcbiAgfTtcbiAgLy9kYXRvIGwnb2dnZXR0byBmaWx0ZXIgcmVzdGl0dWl0byBkYWwgc2VydmVyIHJpY29zdHJ1aXNjbyBsYSBzdHJ1dHR1cmEgZGVsIGZpbHRlck9iamVjdFxuICAvL2ludGVycHJldGF0byBkYSBxdWVyeVdNU1Byb3ZpZGVyXG4gIHRoaXMuY3JlYXRlUXVlcnlGaWx0ZXJGcm9tQ29uZmlnID0gZnVuY3Rpb24oZmlsdGVyKSB7XG5cbiAgICB2YXIgcXVlcnlGaWx0ZXIgPSB7fTtcbiAgICB2YXIgYXR0cmlidXRlO1xuICAgIHZhciBvcGVyYXRvcjtcbiAgICB2YXIgZmllbGQ7XG4gICAgdmFyIG9wZXJhdG9yT2JqZWN0ID0ge307XG4gICAgdmFyIGJvb2xlYW5PYmplY3QgPSB7fTtcbiAgICAvL2Z1bnppb25lIGNoZSBjb3N0cnVpc2NlIGwnb2dnZXR0byBvcGVyYXRvcmUgZXMuIHsnPSc6eydub21lY2FtcG8nOm51bGx9fVxuICAgIGZ1bmN0aW9uIGNyZWF0ZU9wZXJhdG9yT2JqZWN0KG9iaikge1xuICAgICAgLy9yaW5pemlhbGl6em8gYSBvZ2dldHRvIHZ1b3RvXG4gICAgICBldmFsT2JqZWN0ID0ge307XG4gICAgICAvL3ZlcmlmaWNvIGNoZSBsJ29nZ2V0dG8gcGFzc2F0byBub24gc2lhIGEgc3VhIHZvbHRhIHVuIG9nZ2V0dG8gJ0JPT0xFQU5PJ1xuICAgICAgXy5mb3JFYWNoKG9iaiwgZnVuY3Rpb24odixrKSB7XG4gICAgICAgIGlmIChfLmlzQXJyYXkodikpIHtcbiAgICAgICAgICByZXR1cm4gY3JlYXRlQm9vbGVhbk9iamVjdChrLHYpO1xuICAgICAgICB9O1xuICAgICAgfSk7XG4gICAgICBmaWVsZCA9IG9iai5hdHRyaWJ1dGU7XG4gICAgICBvcGVyYXRvciA9IG9iai5vcDtcbiAgICAgIGV2YWxPYmplY3Rbb3BlcmF0b3JdID0ge307XG4gICAgICBldmFsT2JqZWN0W29wZXJhdG9yXVtmaWVsZF0gPSBudWxsO1xuICAgICAgcmV0dXJuIGV2YWxPYmplY3Q7XG4gICAgfTtcbiAgICAvL2Z1bmN0aW9uZSBjaGUgY29zdHJ1aXNjZSBvZ2dldHRpIEJPT0xFQU5JIGNhc28gQU5EIE9SIGNvbnRlbmVudGUgYXJyYXkgZGkgb2dnZXR0aSBmb3JuaXQgZGFsbGEgZnVuemlvbmUgY3JlYXRlT3BlcmF0b3JPYmplY3RcbiAgICBmdW5jdGlvbiBjcmVhdGVCb29sZWFuT2JqZWN0KGJvb2xlYW5PcGVyYXRvciwgb3BlcmF0aW9ucykge1xuICAgICAgYm9vbGVhbk9iamVjdCA9IHt9O1xuICAgICAgYm9vbGVhbk9iamVjdFtib29sZWFuT3BlcmF0b3JdID0gW107XG4gICAgICBfLmZvckVhY2gob3BlcmF0aW9ucywgZnVuY3Rpb24ob3BlcmF0aW9uKXtcbiAgICAgICAgYm9vbGVhbk9iamVjdFtib29sZWFuT3BlcmF0b3JdLnB1c2goY3JlYXRlT3BlcmF0b3JPYmplY3Qob3BlcmF0aW9uKSk7XG4gICAgICB9KVxuICAgICAgcmV0dXJuIGJvb2xlYW5PYmplY3Q7XG4gICAgfTtcbiAgICAvKlxuICAgIC8vIHZhZG8gYSBjcmVhcmUgbCdvZ2dldHRvIGZpbHRybyBwcmluY2lwYWxlLiBRdWVzdG8gw6ggdW4gb2dnZXR0byBjaGUgY29udGllbmUgbCdvcGVyYXRvcmUgYm9vbGVhbm8gY29tZSByb290IChjaGlhdmUpXG4gICAgLy8gY29tZSB2YWxvcmUgdW4gYXJyYXkgZGkgb2dnZXR0aSBvcGVyYXRvcmkgY2hlIGNvbnRlbmdvbm8gaWwgdGlwbyBkaSBvcGVyYXRvcmUgY29tZSBjaGlhdmUgZSBjb21lIHZhbG9yZSB1biBvZ2dldHRvIGNvbnRlbmV0ZVxuICAgIC8vIG5vbWUgY2FtcG8gZSB2YWxvcmUgcGFzc2F0b1xuICAgICovXG4gICAgXy5mb3JFYWNoKGZpbHRlciwgZnVuY3Rpb24odixrLG9iaikge1xuICAgICAgcXVlcnlGaWx0ZXIgPSBjcmVhdGVCb29sZWFuT2JqZWN0KGssdik7XG4gICAgfSk7XG4gICAgcmV0dXJuIHF1ZXJ5RmlsdGVyO1xuICB9O1xuXG4gIHRoaXMuY3JlYXRlUXVlcnlGaWx0ZXJPYmplY3QgPSBmdW5jdGlvbihsYXllcklkLCBmaWx0ZXJPYmplY3Qpe1xuICAgIHZhciBwcm9qZWN0ID0gUHJvamVjdHNSZWdpc3RyeS5nZXRDdXJyZW50UHJvamVjdCgpO1xuICAgIHZhciBsYXllckluZm8gPSB0aGlzLmdldExheWVySW5mb1VybEZyb21Qcm9qZWN0Q29uZmlnKGxheWVySWQpO1xuICAgIHJldHVybiB7XG4gICAgICB0eXBlOiAnc3RhbmRhcmQnLFxuICAgICAgdXJsOiBsYXllckluZm8udXJsLFxuICAgICAgcXVlcnlsYXllcjogbGF5ZXJJbmZvLm5hbWUsXG4gICAgICBzZXJ2ZXJ0eXBlOiBsYXllckluZm8uc2VydmVydHlwZSxcbiAgICAgIGNyczogbGF5ZXJJbmZvLmNycyxcbiAgICAgIGZpbHRlck9iamVjdCA6IGZpbHRlck9iamVjdFxuICAgIH07XG4gIH07XG5cbiAgdGhpcy5nZXRMYXllckluZm9VcmxGcm9tUHJvamVjdENvbmZpZyA9IGZ1bmN0aW9uKGxheWVySWQpIHtcbiAgICB2YXIgbGF5ZXJGaWx0ZXJJbmZvID0ge307XG4gICAgdmFyIHByb2plY3QgPSBQcm9qZWN0c1JlZ2lzdHJ5LmdldEN1cnJlbnRQcm9qZWN0KCk7XG4gICAgdmFyIGxheWVySW5mbyA9IHByb2plY3QuZ2V0TGF5ZXJCeUlkKGxheWVySWQpO1xuICAgIGlmIChsYXllckluZm8pIHtcbiAgICAgIGxheWVyRmlsdGVySW5mby5uYW1lID0gbGF5ZXJJbmZvLm5hbWU7XG4gICAgICBsYXllckZpbHRlckluZm8uY3JzID0gcHJvamVjdC5zdGF0ZS5jcnM7XG4gICAgICBsYXllckZpbHRlckluZm8uc2VydmVydHlwZSA9IGxheWVySW5mby5zZXJ2ZXJ0eXBlO1xuICAgICAgaWYgKGxheWVySW5mby5zb3VyY2UgJiYgbGF5ZXJJbmZvLnNvdXJjZS51cmwpe1xuICAgICAgICBsYXllckZpbHRlckluZm8udXJsID0gbGF5ZXJJbmZvLnNvdXJjZS51cmw7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBsYXllckZpbHRlckluZm8udXJsID0gcHJvamVjdC5nZXRXbXNVcmwoKTtcbiAgICAgIH07XG4gICAgfTtcbiAgICByZXR1cm4gbGF5ZXJGaWx0ZXJJbmZvO1xuICB9O1xuXG4gIC8vLy8vUEFSU0VSUyAvLy8vLy8vLy8vLy8vLy8vLy9cblxuICAvLyBCcnV0dG8gbWEgcGVyIG9yYSB1bmljYSBzb2x1emlvbmUgdHJvdmF0YSBwZXIgZGl2aWRlcmUgcGVyIGxheWVyIGkgcmlzdWx0YXRpIGRpIHVuIGRvYyB4bWwgd2ZzLkZlYXR1cmVDb2xsZWN0aW9uLlxuICAvLyBPTDMgbGkgcGFyc2VyaXp6YSB0dXR0aSBpbnNpZW1lIG5vbiBkaXN0aW5ndWVuZG8gbGUgZmVhdHVyZXMgZGVpIGRpdmVyc2kgbGF5ZXJzXG4gIHRoaXMuX3BhcnNlTGF5ZXJGZWF0dXJlQ29sbGVjdGlvbiA9IGZ1bmN0aW9uKHF1ZXJ5TGF5ZXIsIGRhdGEpIHtcbiAgICB2YXIgZmVhdHVyZXMgPSBbXTtcbiAgICB2YXIgbGF5ZXJOYW1lID0gcXVlcnlMYXllci5xdWVyeUxheWVyTmFtZTtcbiAgICB2YXIgbGF5ZXJEYXRhID0gXy5jbG9uZURlZXAoZGF0YSk7XG4gICAgbGF5ZXJEYXRhLkZlYXR1cmVDb2xsZWN0aW9uLmZlYXR1cmVNZW1iZXIgPSBbXTtcbiAgICBcbiAgICB2YXIgZmVhdHVyZU1lbWJlcnMgPSBkYXRhLkZlYXR1cmVDb2xsZWN0aW9uLmZlYXR1cmVNZW1iZXI7XG4gICAgZmVhdHVyZU1lbWJlcnMgPSBfLmlzQXJyYXkoZmVhdHVyZU1lbWJlcnMpID8gZmVhdHVyZU1lbWJlcnMgOiBbZmVhdHVyZU1lbWJlcnNdO1xuICAgIF8uZm9yRWFjaChmZWF0dXJlTWVtYmVycyxmdW5jdGlvbihmZWF0dXJlTWVtYmVyKXtcbiAgICAgIGxheWVyTmFtZSA9IGxheWVyTmFtZS5yZXBsYWNlKC8gL2csJycpOyAvLyBRR0lTIFNFUlZFUiByaW11b3ZlIGdsaSBzcGF6aSBkYWwgbm9tZSBkZWwgbGF5ZXIgcGVyIGNyZWFyZSBsJ2VsZW1lbnRvIEZlYXR1cmVNZW1iZXJcbiAgICAgIHZhciBpc0xheWVyTWVtYmVyID0gXy5nZXQoZmVhdHVyZU1lbWJlcixsYXllck5hbWUpXG5cbiAgICAgIGlmIChpc0xheWVyTWVtYmVyKSB7XG4gICAgICAgIGxheWVyRGF0YS5GZWF0dXJlQ29sbGVjdGlvbi5mZWF0dXJlTWVtYmVyLnB1c2goZmVhdHVyZU1lbWJlcik7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICB2YXIgeDJqcyA9IG5ldyBYMkpTKCk7XG4gICAgdmFyIGxheWVyRmVhdHVyZUNvbGxlY3Rpb25YTUwgPSB4MmpzLmpzb24yeG1sX3N0cihsYXllckRhdGEpO1xuICAgIHZhciBwYXJzZXIgPSBuZXcgb2wuZm9ybWF0LldNU0dldEZlYXR1cmVJbmZvKCk7XG4gICAgcmV0dXJuIHBhcnNlci5yZWFkRmVhdHVyZXMobGF5ZXJGZWF0dXJlQ29sbGVjdGlvblhNTCk7XG4gIH07XG5cbiAgLy8gbWVudHJlIGNvbiBpIHJpc3VsdGF0aSBpbiBtc0dMTU91dHB1dCAoZGEgTWFwc2VydmVyKSBpbCBwYXJzZXIgcHXDsiBlc3NlcmUgaXN0cnVpdG8gcGVyIHBhcnNlcml6emFyZSBpbiBiYXNlIGFkIHVuIGxheWVyIGRpIGZpbHRyb1xuICB0aGlzLl9wYXJzZUxheWVybXNHTUxPdXRwdXQgPSBmdW5jdGlvbihxdWVyeUxheWVyLCBkYXRhKXtcbiAgICB2YXIgcGFyc2VyID0gbmV3IG9sLmZvcm1hdC5XTVNHZXRGZWF0dXJlSW5mbyh7XG4gICAgICBsYXllcnM6IFtxdWVyeUxheWVyLnF1ZXJ5TGF5ZXJOYW1lXVxuICAgIH0pO1xuICAgIHJldHVybiBwYXJzZXIucmVhZEZlYXR1cmVzKGRhdGEpO1xuICB9O1xuXG4gIC8vLy8gRklORSBQQVJTRVIgLy8vL1xuXG4gIHRoaXMuZ2V0R2V0RmVhdHVyZUluZm9VcmwgPSBmdW5jdGlvbihtYXBMYXllcixjb29yZGluYXRlKXtcbiAgICAvL3ZhciBwYXJzZXIgPSBuZXcgb2wuZm9ybWF0LldNU0dldEZlYXR1cmVJbmZvKCk7XG4gICAgdmFyIHJlc29sdXRpb24gPSB0aGlzLm1hcC5nZXRWaWV3KCkuZ2V0UmVzb2x1dGlvbigpO1xuICAgIHZhciBlcHNnID0gdGhpcy5tYXAuZ2V0VmlldygpLmdldFByb2plY3Rpb24oKS5nZXRDb2RlKCk7XG4gICAgdmFyIHBhcmFtcyA9IHtcbiAgICAgIFFVRVJZX0xBWUVSUzogXy5tYXAobWFwTGF5ZXIuZ2V0UXVlcnlMYXllcnMoKSwncXVlcnlMYXllck5hbWUnKSxcbiAgICAgIElORk9fRk9STUFUOiBtYXBMYXllci5nZXRJbmZvRm9ybWF0KCksXG4gICAgICAvLyBQQVJBTUVUUkkgREkgVE9MTEVSQU5aQSBQRVIgUUdJUyBTRVJWRVJcbiAgICAgIEZJX1BPSU5UX1RPTEVSQU5DRTogMTAsXG4gICAgICBGSV9MSU5FX1RPTEVSQU5DRTogMTAsXG4gICAgICBGSV9QT0xZR09OX1RPTEVSQU5DRTogMTBcbiAgICB9XG4gICAgdmFyIHVybCA9IG1hcExheWVyLmdldEdldEZlYXR1cmVJbmZvVXJsKGNvb3JkaW5hdGUscmVzb2x1dGlvbixlcHNnLHBhcmFtcyk7XG4gICAgcmV0dXJuIHVybDtcbiAgfTtcblxuICAvL0lOSVpPIFNFWklPTkUgUVVFUklFUyAvLy9cblxuICAvLyBNZXNzbyBxdWkgZ2VuZXJhbGUgbGEgZnVuemlvbmUgY2hlIHNpIHByZW5kZSBjdXJhIGRlbGxhIHRyYXNmb3JtYXppb25lIGRlbGwneG1sIGRpIHJpc3Bvc3RhXG4gIC8vIGRhbCBzZXJ2ZXIgY29zw6wgZGEgYXZlcmUgdW5hIHJpc3Bvc3RhIGNvZXJlbnRlIGluIHRlcm1pbmkgZGkgZm9ybWF0byByaXN1bHRhdGkgZGEgcHJlc2VudGFyZVxuICAvLyBuZWwgY29tcG9uZW50ZSBRdWVyeVJlc3VsdHNcbiAgdGhpcy5oYW5kbGVRdWVyeVJlc3BvbnNlRnJvbVNlcnZlciA9IGZ1bmN0aW9uKHJlc3BvbnNlLCBxdWVyeUxheWVycykge1xuICAgIHZhciBqc29ucmVzcG9uc2U7XG4gICAgdmFyIGZlYXR1cmVzRm9yTGF5ZXJOYW1lcyA9IHt9O1xuICAgIHZhciBkID0gJC5EZWZlcnJlZCgpO1xuICAgIHZhciB4MmpzID0gbmV3IFgySlMoKTtcbiAgICB0cnkge1xuICAgICAgaWYgKF8uaXNTdHJpbmcocmVzcG9uc2UpKSB7XG4gICAgICAgIGpzb25yZXNwb25zZSA9IHgyanMueG1sX3N0cjJqc29uKHJlc3BvbnNlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGpzb25yZXNwb25zZSA9IHgyanMueG1sMmpzb24ocmVzcG9uc2UpO1xuICAgICAgfVxuICAgIH1cbiAgICBjYXRjaCAoZSkge1xuICAgICAgZC5yZWplY3QoZSk7XG4gICAgfVxuICAgIHZhciByb290Tm9kZSA9IF8ua2V5cyhqc29ucmVzcG9uc2UpWzBdO1xuICAgIHZhciBwYXJzZXIsIGRhdGE7XG4gICAgc3dpdGNoIChyb290Tm9kZSkge1xuICAgICAgY2FzZSAnRmVhdHVyZUNvbGxlY3Rpb24nOlxuICAgICAgICBwYXJzZXIgPSB0aGlzLl9wYXJzZUxheWVyRmVhdHVyZUNvbGxlY3Rpb247XG4gICAgICAgIGRhdGEgPSBqc29ucmVzcG9uc2U7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBcIm1zR01MT3V0cHV0XCI6XG4gICAgICAgIHBhcnNlciA9IHRoaXMuX3BhcnNlTGF5ZXJtc0dNTE91dHB1dDtcbiAgICAgICAgZGF0YSA9IHJlc3BvbnNlO1xuICAgICAgICBicmVhaztcbiAgICB9O1xuICAgIHZhciBuZmVhdHVyZXMgPSAwXG4gICAgXy5mb3JFYWNoKHF1ZXJ5TGF5ZXJzLGZ1bmN0aW9uKHF1ZXJ5TGF5ZXIpIHtcbiAgICAgIHZhciBmZWF0dXJlcyA9IHBhcnNlci5jYWxsKHNlbGYsIHF1ZXJ5TGF5ZXIsIGRhdGEpXG4gICAgICBuZmVhdHVyZXMgKz0gZmVhdHVyZXMubGVuZ3RoO1xuICAgICAgZmVhdHVyZXNGb3JMYXllck5hbWVzW3F1ZXJ5TGF5ZXIubGF5ZXJOYW1lXSA9IGZlYXR1cmVzO1xuICAgIH0pO1xuICAgIHZhciBwcm9qZWN0TGF5ZXJzID0gUHJvamVjdHNSZWdpc3RyeS5nZXRDdXJyZW50UHJvamVjdCgpLmdldExheWVycygpO1xuICAgIHZhciBmZWF0dXJlc0ZvckxheWVycyA9IFtdO1xuICAgIHZhciBsYXllcjtcbiAgICBfLmZvckVhY2goZmVhdHVyZXNGb3JMYXllck5hbWVzLGZ1bmN0aW9uKGZlYXR1cmVzLCBsYXllck5hbWUpe1xuICAgICAgXy5mb3JFYWNoKHByb2plY3RMYXllcnMsIGZ1bmN0aW9uKGxheWVyT2JqLCBsYXllcklkKSB7XG4gICAgICAgIC8vIGNhc28gbGF5ZXJzIFFHSVNcbiAgICAgICAgaWYgKGxheWVyT2JqLm5hbWUgPT0gbGF5ZXJOYW1lKSB7XG4gICAgICAgICAgbGF5ZXIgPSBsYXllck9iajtcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIGlmIChsYXllck9iai5zb3VyY2UpIHtcbiAgICAgICAgICAvL2Nhc28gV01TIGxheWVyXG4gICAgICAgICAgaWYgKGxheWVyT2JqLnNvdXJjZS5sYXllcnMgPT0gbGF5ZXJOYW1lKSB7XG4gICAgICAgICAgICBsYXllciA9IGxheWVyT2JqO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIGZlYXR1cmVzRm9yTGF5ZXJzLnB1c2goe1xuICAgICAgICBsYXllcjogbGF5ZXIsXG4gICAgICAgIGZlYXR1cmVzOiBmZWF0dXJlc1xuICAgICAgfSlcbiAgICB9KTtcbiAgICBkLnJlc29sdmUoZmVhdHVyZXNGb3JMYXllcnMpO1xuICAgIHJldHVybiBkLnByb21pc2UoKTtcbiAgfTtcbiAgLy8gcXVlcnkgYmFzYXRvIHN1bCBmaWx0cm9cblxuICB0aGlzLnF1ZXJ5QnlGaWx0ZXIgPSBmdW5jdGlvbihxdWVyeUZpbHRlck9iamVjdCkge1xuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICB2YXIgZCA9ICQuRGVmZXJyZWQoKTtcbiAgICAvL3BhcnRlIGRhIHJpdmVkZXJlIG5lbCBmaWx0cm9cbiAgICB2YXIgcHJvdmlkZXIgPSBQcm92aWRlcltxdWVyeUZpbHRlck9iamVjdC5zZXJ2ZXJ0eXBlXTtcbiAgICAvL3JpdG9ybmEgdW5hIHByb21pc2UgcG9pIGdlc3RpdGEgZGEgY2hlIGxhIGNoaWVkZVxuICAgIHByb3ZpZGVyLmRvU2VhcmNoKHF1ZXJ5RmlsdGVyT2JqZWN0KS5cbiAgICB0aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAvL2FsIG1vbWVudG8gcXVpIHJlcGxpY28gc3RydXR0dXJhIHBlciBpIHBhcnNlclxuICAgICAgdmFyIHF1ZXJ5TGF5ZXJzID0gW107XG4gICAgICB2YXIgcXVlcnlMYXllciA9IHt9O1xuICAgICAgcXVlcnlMYXllci5xdWVyeUxheWVyTmFtZSA9IHF1ZXJ5TGF5ZXIubGF5ZXJOYW1lID0gcXVlcnlGaWx0ZXJPYmplY3QucXVlcnlsYXllcjtcbiAgICAgIHF1ZXJ5TGF5ZXJzLnB1c2gocXVlcnlMYXllcik7XG4gICAgICBzZWxmLmhhbmRsZVF1ZXJ5UmVzcG9uc2VGcm9tU2VydmVyKHJlc3BvbnNlLCBxdWVyeUxheWVycylcbiAgICAgIC50aGVuKGZ1bmN0aW9uKGZlYXR1cmVzRm9yTGF5ZXJzKSB7XG4gICAgICAgICAgICBkLnJlc29sdmUoe1xuICAgICAgICAgICAgICBkYXRhOiBmZWF0dXJlc0ZvckxheWVycyxcbiAgICAgICAgICAgICAgcXVlcnk6IHtcbiAgICAgICAgICAgICAgICBmaWx0ZXI6IHF1ZXJ5RmlsdGVyT2JqZWN0XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgfSlcbiAgICB9KVxuICAgIC5mYWlsKGZ1bmN0aW9uKGUpe1xuICAgICAgICAgIGQucmVqZWN0KGUpO1xuICAgIH0pXG4gICAgcmV0dXJuIGQucHJvbWlzZSgpO1xuICB9O1xuXG4gIC8vcXVlcnkgYmFzYXRvIGNsaWNrL3Bvc2l6aW9uZSBuZWxsYSBtYXBwYVxuICB0aGlzLnF1ZXJ5QnlMb2NhdGlvbiA9IGZ1bmN0aW9uKGNvb3JkaW5hdGVzLCBtYXBMYXllcnMpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgdmFyIGQgPSAkLkRlZmVycmVkKCk7XG4gICAgdmFyIHVybHNGb3JMYXllcnMgPSB7fTtcbiAgICBfLmZvckVhY2gobWFwTGF5ZXJzLCBmdW5jdGlvbihtYXBMYXllcikge1xuICAgICAgdmFyIHVybCA9IG1hcExheWVyLmdldFF1ZXJ5VXJsKCk7XG4gICAgICB2YXIgdXJsSGFzaCA9IHVybC5oYXNoQ29kZSgpLnRvU3RyaW5nKCk7XG4gICAgICAvLyBjcmVvIHVuIG9nZ2V0dG8gY29udGVudGVudGUgbGF5ZXJzIGNoZSBmYW5ubyByaWZlcmltZW50b1xuICAgICAgLy8gYWQgdW4gdWd1YWxlIHVybCBpbiBtb2RvIGRhIHNlbXBsaWZpY2FyZSBsYSBjaGlhbWF0YSAoZmFybGEgdW5hIHNvbGEgc3UgcGnDuSBsYXllclxuICAgICAgLy8gaW52ZWNlIGRpIGZhcm5lIG4gc3Ugb2duaSBzaW5nb2xvIGxheWVyXG4gICAgICBpZiAoXy5rZXlzKHVybHNGb3JMYXllcnMpLmluZGV4T2YodXJsSGFzaCkgPT0gLTEpIHtcbiAgICAgICAgdXJsc0ZvckxheWVyc1t1cmxIYXNoXSA9IHtcbiAgICAgICAgICB1cmw6IHVybCxcbiAgICAgICAgICBtYXBMYXllcnM6IFtdXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgICB1cmxzRm9yTGF5ZXJzW3VybEhhc2hdLm1hcExheWVycy5wdXNoKG1hcExheWVyKTtcbiAgICB9KTtcbiAgICB2YXIgcXVlcnlVcmxzRm9yTGF5ZXJzID0gW107XG4gICAgXy5mb3JFYWNoKHVybHNGb3JMYXllcnMsZnVuY3Rpb24odXJsRm9yTGF5ZXJzKXtcbiAgICAgIHZhciBmaXJzdExheWVyID0gdXJsRm9yTGF5ZXJzLm1hcExheWVyc1swXTtcbiAgICAgIHZhciBfZ2V0RmVhdHVyZUluZm9VcmwgPSBzZWxmLmdldEdldEZlYXR1cmVJbmZvVXJsKGZpcnN0TGF5ZXIsY29vcmRpbmF0ZXMpO1xuICAgICAgdmFyIHF1ZXJ5QmFzZSA9IF9nZXRGZWF0dXJlSW5mb1VybC5zcGxpdCgnPycpWzBdO1xuICAgICAgdmFyIHF1ZXJ5U3RyaW5nID0gX2dldEZlYXR1cmVJbmZvVXJsLnNwbGl0KCc/JylbMV07XG4gICAgICB2YXIgcXVlcnlQYXJhbXMgPSB7fTtcbiAgICAgIF8uZm9yRWFjaChxdWVyeVN0cmluZy5zcGxpdCgnJicpLGZ1bmN0aW9uKHF1ZXJ5U3RyaW5nUGFpcil7XG4gICAgICAgIHZhciBxdWVyeVBhaXIgPSBxdWVyeVN0cmluZ1BhaXIuc3BsaXQoJz0nKTtcbiAgICAgICAgdmFyIGtleSA9IHF1ZXJ5UGFpclswXTtcbiAgICAgICAgdmFyIHZhbHVlID0gcXVlcnlQYWlyWzFdO1xuICAgICAgICBxdWVyeVBhcmFtc1trZXldID0gdmFsdWU7XG4gICAgICB9KTtcblxuICAgICAgdmFyIGxheWVyTmFtZXMgPSBbXTtcbiAgICAgIHZhciBxdWVyeUxheWVycyA9IFtdO1xuICAgICAgXy5mb3JFYWNoKHVybEZvckxheWVycy5tYXBMYXllcnMsZnVuY3Rpb24obWFwTGF5ZXIpe1xuICAgICAgICB2YXIgbWFwTGF5ZXJRdWVyeUxheWVycyA9IG1hcExheWVyLmdldFF1ZXJ5TGF5ZXJzKCk7XG4gICAgICAgIGlmIChtYXBMYXllclF1ZXJ5TGF5ZXJzLmxlbmd0aCkge1xuICAgICAgICAgIHF1ZXJ5TGF5ZXJzID0gXy5jb25jYXQocXVlcnlMYXllcnMsbWFwTGF5ZXJRdWVyeUxheWVycyk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgaWYgKHF1ZXJ5TGF5ZXJzLmxlbmd0aCkge1xuXG4gICAgICAgIGRlbGV0ZSBxdWVyeVBhcmFtc1snU1RZTEVTJ107XG4gICAgICAgIHF1ZXJ5UGFyYW1zWydMQVlFUlMnXSA9IF8ubWFwKHF1ZXJ5TGF5ZXJzLCdxdWVyeUxheWVyTmFtZScpO1xuICAgICAgICBxdWVyeVBhcmFtc1snUVVFUllfTEFZRVJTJ10gPSBfLm1hcChxdWVyeUxheWVycywncXVlcnlMYXllck5hbWUnKTtcbiAgICAgICAgcXVlcnlQYXJhbXNbJ0ZFQVRVUkVfQ09VTlQnXSA9IDEwMDA7XG5cbiAgICAgICAgdmFyIGdldEZlYXR1cmVJbmZvVXJsID0gcXVlcnlCYXNlO1xuICAgICAgICB2YXIgbmV3UXVlcnlQYWlycyA9IFtdO1xuICAgICAgICBfLmZvckVhY2gocXVlcnlQYXJhbXMsZnVuY3Rpb24odmFsdWUsa2V5KXtcbiAgICAgICAgICBuZXdRdWVyeVBhaXJzLnB1c2goa2V5Kyc9Jyt2YWx1ZSk7XG4gICAgICAgIH0pO1xuICAgICAgICBnZXRGZWF0dXJlSW5mb1VybCA9IHF1ZXJ5QmFzZSsnPycrbmV3UXVlcnlQYWlycy5qb2luKCcmJyk7XG4gICAgICAgIHF1ZXJ5VXJsc0ZvckxheWVycy5wdXNoKHtcbiAgICAgICAgICB1cmw6IGdldEZlYXR1cmVJbmZvVXJsLFxuICAgICAgICAgIHF1ZXJ5TGF5ZXJzOiBxdWVyeUxheWVyc1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICBpZiAocXVlcnlVcmxzRm9yTGF5ZXJzLmxlbmd0aCA+IDApIHtcbiAgICAgIF8uZm9yRWFjaChxdWVyeVVybHNGb3JMYXllcnMsZnVuY3Rpb24ocXVlcnlVcmxGb3JMYXllcnMpe1xuICAgICAgICB2YXIgdXJsID0gcXVlcnlVcmxGb3JMYXllcnMudXJsO1xuICAgICAgICB2YXIgcXVlcnlMYXllcnMgPSBxdWVyeVVybEZvckxheWVycy5xdWVyeUxheWVycztcbiAgICAgICAgJC5nZXQodXJsKS5cbiAgICAgICAgdGhlbihmdW5jdGlvbihyZXNwb25zZSl7XG4gICAgICAgICAgc2VsZi5oYW5kbGVRdWVyeVJlc3BvbnNlRnJvbVNlcnZlcihyZXNwb25zZSwgcXVlcnlMYXllcnMsIGNvb3JkaW5hdGVzKVxuICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGZlYXR1cmVzRm9yTGF5ZXJzKXtcbiAgICAgICAgICAgIGQucmVzb2x2ZSh7XG4gICAgICAgICAgICAgIGRhdGE6IGZlYXR1cmVzRm9yTGF5ZXJzLFxuICAgICAgICAgICAgICBxdWVyeToge1xuICAgICAgICAgICAgICAgIGNvb3JkaW5hdGVzOiBjb29yZGluYXRlc1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9KVxuICAgICAgICB9KVxuICAgICAgICAuZmFpbChmdW5jdGlvbihlKXtcbiAgICAgICAgICBkLnJlamVjdChlKTtcbiAgICAgICAgfSlcbiAgICAgIH0pO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIGQucmVzb2x2ZShjb29yZGluYXRlcywwLHt9KTtcbiAgICB9XG4gICAgcmV0dXJuIGQucHJvbWlzZSgpO1xuICB9O1xuXG4gIC8vcXVlcnkgYnkgQkJPWFxuICB0aGlzLnF1ZXJ5QnlCb3VuZGluZ0JveCA9IGZ1bmN0aW9uKGJib3gpIHtcbiAgICAvL2NvZGljZSBxdWlcbiAgfTtcblxuICAvL2ltcG9ydGF0dGEgcXVlcnkgZ2VuZXJpY2FcbiAgdGhpcy5fcXVlcnkgPSBmdW5jdGlvbihyZWN0LGxheWVySWQpIHtcbiAgICB2YXIgUHJvamVjdCA9IFByb2plY3RzUmVnaXN0cnkuZ2V0Q3VycmVudFByb2plY3QoKTtcbiAgICB2YXIgbGF5ZXJzO1xuICAgIGlmIChsYXllcklkKSB7XG4gICAgICBsYXllcnMgPSBbUHJvamVjdC5nZXRMYXllcihsYXllcklkKV07XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgbGF5ZXJzID0gUHJvamVjdC5nZXRMYXllcnMoKTtcbiAgICB9XG4gIH07XG5cbiAgdGhpcy5zaG93UXVlcnlSZXN1bHRzID0gZnVuY3Rpb24ocmVzdWx0cykge1xuXG4gICAgICAvL2NvZGljZSBxdWlcblxuICB9O1xuXG5cbiAgYmFzZSh0aGlzKTtcbn1cbmluaGVyaXQoUXVlcnlTZXJ2aWNlLEczV09iamVjdCk7XG5cbm1vZHVsZS5leHBvcnRzID0gIG5ldyBRdWVyeVNlcnZpY2VcblxuIiwidmFyIGluaGVyaXQgPSByZXF1aXJlKCdjb3JlL3V0aWxzL3V0aWxzJykuaW5oZXJpdDtcbnZhciBiYXNlID0gcmVxdWlyZSgnY29yZS91dGlscy91dGlscycpLmJhc2U7XG52YXIgQmFzZTY0ID0gcmVxdWlyZSgnY29yZS91dGlscy91dGlscycpLkJhc2U2NDtcbnZhciBHM1dPYmplY3QgPSByZXF1aXJlKCdjb3JlL2czd29iamVjdCcpO1xuXG52YXIgUm91dGVyU2VydmljZSA9IGZ1bmN0aW9uKCl7XG4gIHZhciBzZWxmID0gdGhpcztcbiAgdGhpcy5fcm91dGUgPSAnJztcbiAgdGhpcy5zZXR0ZXJzID0ge1xuICAgIHNldFJvdXRlOiBmdW5jdGlvbihwYXRoKXtcbiAgICAgIHRoaXMuX3JvdXRlID0gcGF0aDtcbiAgICB9XG4gIH1cbiAgXG4gIEhpc3RvcnkuQWRhcHRlci5iaW5kKHdpbmRvdywnc3RhdGVjaGFuZ2UnLGZ1bmN0aW9uKCl7IC8vIE5vdGU6IFdlIGFyZSB1c2luZyBzdGF0ZWNoYW5nZSBpbnN0ZWFkIG9mIHBvcHN0YXRlXG4gICAgICB2YXIgc3RhdGUgPSBIaXN0b3J5LmdldFN0YXRlKCk7IC8vIE5vdGU6IFdlIGFyZSB1c2luZyBIaXN0b3J5LmdldFN0YXRlKCkgaW5zdGVhZCBvZiBldmVudC5zdGF0ZVxuICAgICAgdmFyIGhhc2ggPSBzdGF0ZS5oYXNoO1xuICAgICAgc2VsZi5zZXRSb3V0ZUZyb21IYXNoKGhhc2gpO1xuICB9KTtcbiAgXG4gIGJhc2UodGhpcyk7XG59O1xuaW5oZXJpdChSb3V0ZXJTZXJ2aWNlLEczV09iamVjdCk7XG5cbnZhciBwcm90byA9IFJvdXRlclNlcnZpY2UucHJvdG90eXBlO1xuXG5wcm90by5pbml0Um91dGUgPSBmdW5jdGlvbigpe1xuICB2YXIgZmlyc3RIYXNoID0gd2luZG93LmxvY2F0aW9uLnNlYXJjaDtcbiAgdGhpcy5zZXRSb3V0ZUZyb21IYXNoKGZpcnN0SGFzaCk7XG59XG5cbnByb3RvLmdvdG8gPSBmdW5jdGlvbihwYXRoKXtcbiAgdmFyIHBhdGhiNjQgPSBCYXNlNjQuZW5jb2RlKHBhdGgpO1xuICBIaXN0b3J5LnB1c2hTdGF0ZSh7cGF0aDpwYXRofSxudWxsLCc/cD0nK3BhdGhiNjQpO1xuICAvL3RoaXMuc2V0Um91dGUocGF0aCk7XG59O1xuXG5wcm90by5zZXRSb3V0ZUZyb21IYXNoID0gZnVuY3Rpb24oaGFzaCkge1xuICB2YXIgcGF0aGI2NCA9IHRoaXMuZ2V0UXVlcnlQYXJhbXMoaGFzaClbJ3AnXTtcbiAgdmFyIHBhdGggPSBwYXRoYjY0ID8gQmFzZTY0LmRlY29kZShwYXRoYjY0KSA6ICcnO1xuICB0aGlzLnNldFJvdXRlKHBhdGgpO1xufVxuXG5wcm90by5zbGljZVBhdGggPSBmdW5jdGlvbihwYXRoKXtcbiAgcmV0dXJuIHBhdGguc3BsaXQoJz8nKVswXS5zcGxpdCgnLycpO1xufTtcbiAgXG5wcm90by5zbGljZUZpcnN0ID0gZnVuY3Rpb24ocGF0aCl7XG4gIHZhciBwYXRoQW5kUXVlcnkgPSBwYXRoLnNwbGl0KCc/Jyk7XG4gIHZhciBxdWVyeVN0cmluZyA9IHBhdGhBbmRRdWVyeVsxXTtcbiAgdmFyIHBhdGhBcnIgPSBwYXRoQW5kUXVlcnlbMF0uc3BsaXQoJy8nKVxuICB2YXIgZmlyc3RQYXRoID0gcGF0aEFyclswXTtcbiAgcGF0aCA9IHBhdGhBcnIuc2xpY2UoMSkuam9pbignLycpO1xuICBwYXRoID0gW3BhdGgscXVlcnlTdHJpbmddLmpvaW4oJz8nKVxuICByZXR1cm4gW2ZpcnN0UGF0aCxwYXRoXTtcbn07XG4gIFxucHJvdG8uZ2V0UXVlcnlQYXJhbXMgPSBmdW5jdGlvbihwYXRoKXtcbiAgdmFyIHF1ZXJ5UGFyYW1zID0ge307XG4gIHRyeSB7XG4gICAgdmFyIHF1ZXJ5U3RyaW5nID0gcGF0aC5zcGxpdCgnPycpWzFdO1xuICAgIHZhciBxdWVyeVBhaXJzID0gcXVlcnlTdHJpbmcuc3BsaXQoJyYnKTtcbiAgICB2YXIgcXVlcnlQYXJhbXMgPSB7fTtcbiAgICBfLmZvckVhY2gocXVlcnlQYWlycyxmdW5jdGlvbihxdWVyeVBhaXIpe1xuICAgICAgdmFyIHBhaXIgPSBxdWVyeVBhaXIuc3BsaXQoJz0nKTtcbiAgICAgIHZhciBrZXkgPSBwYWlyWzBdO1xuICAgICAgdmFyIHZhbHVlID0gcGFpclsxXTtcbiAgICAgIHF1ZXJ5UGFyYW1zW2tleV0gPSB2YWx1ZTtcbiAgICB9KTtcbiAgfVxuICBjYXRjaCAoZSkge31cbiAgcmV0dXJuIHF1ZXJ5UGFyYW1zO1xufTtcblxucHJvdG8uZ2V0UXVlcnlTdHJpbmcgPSBmdW5jdGlvbihwYXRoKXtcbiAgcmV0dXJuIHBhdGguc3BsaXQoJz8nKVsxXTtcbn07XG4gIFxucHJvdG8ubWFrZVF1ZXJ5U3RyaW5nID0gZnVuY3Rpb24ocXVlcnlQYXJhbXMpe307XG5cbm1vZHVsZS5leHBvcnRzID0gbmV3IFJvdXRlclNlcnZpY2U7XG4iLCJ2YXIgT0dDX1BJWEVMX1dJRFRIID0gMC4yODtcbnZhciBPR0NfRFBJID0gMjUuNC9PR0NfUElYRUxfV0lEVEg7XG5cbm1vZHVsZS5leHBvcnRzID0ge1xuICByZXNUb1NjYWxlOiBmdW5jdGlvbihyZXMsIG1ldHJpYykge1xuICAgIHZhciBtZXRyaWMgPSBtZXRyaWMgfHwgJ20nO1xuICAgIHZhciBzY2FsZTtcbiAgICBzd2l0Y2ggKG1ldHJpYykge1xuICAgICAgY2FzZSAnbSc6XG4gICAgICAgIHZhciBzY2FsZSA9IChyZXMqMTAwMCkgLyBPR0NfUElYRUxfV0lEVEg7XG4gICAgICAgIGJyZWFrXG4gICAgfVxuICAgIHJldHVybiBzY2FsZTtcbiAgfVxufTtcbiIsIlxuLyoqXG4gKiBEZWNpbWFsIGFkanVzdG1lbnQgb2YgYSBudW1iZXIuXG4gKlxuICogQHBhcmFtIHtTdHJpbmd9ICB0eXBlICBUaGUgdHlwZSBvZiBhZGp1c3RtZW50LlxuICogQHBhcmFtIHtOdW1iZXJ9ICB2YWx1ZSBUaGUgbnVtYmVyLlxuICogQHBhcmFtIHtJbnRlZ2VyfSBleHAgICBUaGUgZXhwb25lbnQgKHRoZSAxMCBsb2dhcml0aG0gb2YgdGhlIGFkanVzdG1lbnQgYmFzZSkuXG4gKiBAcmV0dXJucyB7TnVtYmVyfSBUaGUgYWRqdXN0ZWQgdmFsdWUuXG4gKi9cbmZ1bmN0aW9uIGRlY2ltYWxBZGp1c3QodHlwZSwgdmFsdWUsIGV4cCkge1xuICAvLyBJZiB0aGUgZXhwIGlzIHVuZGVmaW5lZCBvciB6ZXJvLi4uXG4gIGlmICh0eXBlb2YgZXhwID09PSAndW5kZWZpbmVkJyB8fCArZXhwID09PSAwKSB7XG4gICAgcmV0dXJuIE1hdGhbdHlwZV0odmFsdWUpO1xuICB9XG4gIHZhbHVlID0gK3ZhbHVlO1xuICBleHAgPSArZXhwO1xuICAvLyBJZiB0aGUgdmFsdWUgaXMgbm90IGEgbnVtYmVyIG9yIHRoZSBleHAgaXMgbm90IGFuIGludGVnZXIuLi5cbiAgaWYgKGlzTmFOKHZhbHVlKSB8fCAhKHR5cGVvZiBleHAgPT09ICdudW1iZXInICYmIGV4cCAlIDEgPT09IDApKSB7XG4gICAgcmV0dXJuIE5hTjtcbiAgfVxuICAvLyBTaGlmdFxuICB2YWx1ZSA9IHZhbHVlLnRvU3RyaW5nKCkuc3BsaXQoJ2UnKTtcbiAgdmFsdWUgPSBNYXRoW3R5cGVdKCsodmFsdWVbMF0gKyAnZScgKyAodmFsdWVbMV0gPyAoK3ZhbHVlWzFdIC0gZXhwKSA6IC1leHApKSk7XG4gIC8vIFNoaWZ0IGJhY2tcbiAgdmFsdWUgPSB2YWx1ZS50b1N0cmluZygpLnNwbGl0KCdlJyk7XG4gIHJldHVybiArKHZhbHVlWzBdICsgJ2UnICsgKHZhbHVlWzFdID8gKCt2YWx1ZVsxXSArIGV4cCkgOiBleHApKTtcbn1cblxuLy8gRGVjaW1hbCByb3VuZFxuaWYgKCFNYXRoLnJvdW5kMTApIHtcbiAgTWF0aC5yb3VuZDEwID0gZnVuY3Rpb24odmFsdWUsIGV4cCkge1xuICAgIHJldHVybiBkZWNpbWFsQWRqdXN0KCdyb3VuZCcsIHZhbHVlLCBleHApO1xuICB9O1xufVxuLy8gRGVjaW1hbCBmbG9vclxuaWYgKCFNYXRoLmZsb29yMTApIHtcbiAgTWF0aC5mbG9vcjEwID0gZnVuY3Rpb24odmFsdWUsIGV4cCkge1xuICAgIHJldHVybiBkZWNpbWFsQWRqdXN0KCdmbG9vcicsIHZhbHVlLCBleHApO1xuICB9O1xufVxuLy8gRGVjaW1hbCBjZWlsXG5pZiAoIU1hdGguY2VpbDEwKSB7XG4gIE1hdGguY2VpbDEwID0gZnVuY3Rpb24odmFsdWUsIGV4cCkge1xuICAgIHJldHVybiBkZWNpbWFsQWRqdXN0KCdjZWlsJywgdmFsdWUsIGV4cCk7XG4gIH07XG59XG5cblN0cmluZy5wcm90b3R5cGUuaGFzaENvZGUgPSBmdW5jdGlvbigpIHtcbiAgdmFyIGhhc2ggPSAwLCBpLCBjaHIsIGxlbjtcbiAgaWYgKHRoaXMubGVuZ3RoID09PSAwKSByZXR1cm4gaGFzaDtcbiAgZm9yIChpID0gMCwgbGVuID0gdGhpcy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgIGNociAgID0gdGhpcy5jaGFyQ29kZUF0KGkpO1xuICAgIGhhc2ggID0gKChoYXNoIDw8IDUpIC0gaGFzaCkgKyBjaHI7XG4gICAgaGFzaCB8PSAwO1xuICB9XG4gIHJldHVybiBoYXNoO1xufTtcblxudmFyIEJhc2U2NCA9IHtfa2V5U3RyOlwiQUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVphYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejAxMjM0NTY3ODkrLz1cIixlbmNvZGU6ZnVuY3Rpb24oZSl7dmFyIHQ9XCJcIjt2YXIgbixyLGkscyxvLHUsYTt2YXIgZj0wO2U9QmFzZTY0Ll91dGY4X2VuY29kZShlKTt3aGlsZShmPGUubGVuZ3RoKXtuPWUuY2hhckNvZGVBdChmKyspO3I9ZS5jaGFyQ29kZUF0KGYrKyk7aT1lLmNoYXJDb2RlQXQoZisrKTtzPW4+PjI7bz0obiYzKTw8NHxyPj40O3U9KHImMTUpPDwyfGk+PjY7YT1pJjYzO2lmKGlzTmFOKHIpKXt1PWE9NjR9ZWxzZSBpZihpc05hTihpKSl7YT02NH10PXQrdGhpcy5fa2V5U3RyLmNoYXJBdChzKSt0aGlzLl9rZXlTdHIuY2hhckF0KG8pK3RoaXMuX2tleVN0ci5jaGFyQXQodSkrdGhpcy5fa2V5U3RyLmNoYXJBdChhKX1yZXR1cm4gdH0sZGVjb2RlOmZ1bmN0aW9uKGUpe3ZhciB0PVwiXCI7dmFyIG4scixpO3ZhciBzLG8sdSxhO3ZhciBmPTA7ZT1lLnJlcGxhY2UoL1teQS1aYS16MC05Ky89XS9nLFwiXCIpO3doaWxlKGY8ZS5sZW5ndGgpe3M9dGhpcy5fa2V5U3RyLmluZGV4T2YoZS5jaGFyQXQoZisrKSk7bz10aGlzLl9rZXlTdHIuaW5kZXhPZihlLmNoYXJBdChmKyspKTt1PXRoaXMuX2tleVN0ci5pbmRleE9mKGUuY2hhckF0KGYrKykpO2E9dGhpcy5fa2V5U3RyLmluZGV4T2YoZS5jaGFyQXQoZisrKSk7bj1zPDwyfG8+PjQ7cj0obyYxNSk8PDR8dT4+MjtpPSh1JjMpPDw2fGE7dD10K1N0cmluZy5mcm9tQ2hhckNvZGUobik7aWYodSE9NjQpe3Q9dCtTdHJpbmcuZnJvbUNoYXJDb2RlKHIpfWlmKGEhPTY0KXt0PXQrU3RyaW5nLmZyb21DaGFyQ29kZShpKX19dD1CYXNlNjQuX3V0ZjhfZGVjb2RlKHQpO3JldHVybiB0fSxfdXRmOF9lbmNvZGU6ZnVuY3Rpb24oZSl7ZT1lLnJlcGxhY2UoL3JuL2csXCJuXCIpO3ZhciB0PVwiXCI7Zm9yKHZhciBuPTA7bjxlLmxlbmd0aDtuKyspe3ZhciByPWUuY2hhckNvZGVBdChuKTtpZihyPDEyOCl7dCs9U3RyaW5nLmZyb21DaGFyQ29kZShyKX1lbHNlIGlmKHI+MTI3JiZyPDIwNDgpe3QrPVN0cmluZy5mcm9tQ2hhckNvZGUocj4+NnwxOTIpO3QrPVN0cmluZy5mcm9tQ2hhckNvZGUociY2M3wxMjgpfWVsc2V7dCs9U3RyaW5nLmZyb21DaGFyQ29kZShyPj4xMnwyMjQpO3QrPVN0cmluZy5mcm9tQ2hhckNvZGUocj4+NiY2M3wxMjgpO3QrPVN0cmluZy5mcm9tQ2hhckNvZGUociY2M3wxMjgpfX1yZXR1cm4gdH0sX3V0ZjhfZGVjb2RlOmZ1bmN0aW9uKGUpe3ZhciB0PVwiXCI7dmFyIG49MDt2YXIgcj1jMT1jMj0wO3doaWxlKG48ZS5sZW5ndGgpe3I9ZS5jaGFyQ29kZUF0KG4pO2lmKHI8MTI4KXt0Kz1TdHJpbmcuZnJvbUNoYXJDb2RlKHIpO24rK31lbHNlIGlmKHI+MTkxJiZyPDIyNCl7YzI9ZS5jaGFyQ29kZUF0KG4rMSk7dCs9U3RyaW5nLmZyb21DaGFyQ29kZSgociYzMSk8PDZ8YzImNjMpO24rPTJ9ZWxzZXtjMj1lLmNoYXJDb2RlQXQobisxKTtjMz1lLmNoYXJDb2RlQXQobisyKTt0Kz1TdHJpbmcuZnJvbUNoYXJDb2RlKChyJjE1KTw8MTJ8KGMyJjYzKTw8NnxjMyY2Myk7bis9M319cmV0dXJuIHR9fTtcblxuXG52YXIgdXRpbHMgPSB7XG4gIG1peGluOiBmdW5jdGlvbiBtaXhpbihkZXN0aW5hdGlvbiwgc291cmNlKSB7XG4gICAgICByZXR1cm4gdXRpbHMubWVyZ2UoZGVzdGluYXRpb24ucHJvdG90eXBlLCBzb3VyY2UpO1xuICB9LFxuICBcbiAgbWl4aW5pbnN0YW5jZTogZnVuY3Rpb24gbWl4aW5pbnN0YW5jZShkZXN0aW5hdGlvbixzb3VyY2Upe1xuICAgICAgdmFyIHNvdXJjZUluc3RhbmNlID0gbmV3IHNvdXJjZTtcbiAgICAgIHV0aWxzLm1lcmdlKGRlc3RpbmF0aW9uLCBzb3VyY2VJbnN0YW5jZSk7XG4gICAgICB1dGlscy5tZXJnZShkZXN0aW5hdGlvbi5wcm90b3R5cGUsIHNvdXJjZS5wcm90b3R5cGUpO1xuICB9LFxuXG5cbiAgbWVyZ2U6IGZ1bmN0aW9uIG1lcmdlKGRlc3RpbmF0aW9uLCBzb3VyY2UpIHtcbiAgICAgIHZhciBrZXk7XG5cbiAgICAgIGZvciAoa2V5IGluIHNvdXJjZSkge1xuICAgICAgICAgIGlmICh1dGlscy5oYXNPd24oc291cmNlLCBrZXkpKSB7XG4gICAgICAgICAgICAgIGRlc3RpbmF0aW9uW2tleV0gPSBzb3VyY2Vba2V5XTtcbiAgICAgICAgICB9XG4gICAgICB9XG4gIH0sXG5cbiAgaGFzT3duOiBmdW5jdGlvbiBoYXNPd24ob2JqZWN0LCBrZXkpIHtcbiAgICAgIHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBrZXkpO1xuICB9LFxuICBcbiAgaW5oZXJpdDpmdW5jdGlvbihjaGlsZEN0b3IsIHBhcmVudEN0b3IpIHtcbiAgICBmdW5jdGlvbiB0ZW1wQ3RvcigpIHt9O1xuICAgIHRlbXBDdG9yLnByb3RvdHlwZSA9IHBhcmVudEN0b3IucHJvdG90eXBlO1xuICAgIGNoaWxkQ3Rvci5zdXBlckNsYXNzXyA9IHBhcmVudEN0b3IucHJvdG90eXBlO1xuICAgIGNoaWxkQ3Rvci5wcm90b3R5cGUgPSBuZXcgdGVtcEN0b3IoKTtcbiAgICBjaGlsZEN0b3IucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gY2hpbGRDdG9yO1xuICB9LFxuICBcbiAgYmFzZTogZnVuY3Rpb24obWUsIG9wdF9tZXRob2ROYW1lLCB2YXJfYXJncykge1xuICAgIHZhciBjYWxsZXIgPSBhcmd1bWVudHMuY2FsbGVlLmNhbGxlcjtcbiAgICBpZiAoY2FsbGVyLnN1cGVyQ2xhc3NfKSB7XG4gICAgICAvLyBUaGlzIGlzIGEgY29uc3RydWN0b3IuIENhbGwgdGhlIHN1cGVyY2xhc3MgY29uc3RydWN0b3IuXG4gICAgICByZXR1cm4gY2FsbGVyLnN1cGVyQ2xhc3NfLmNvbnN0cnVjdG9yLmFwcGx5KFxuICAgICAgICAgIG1lLCBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpKTtcbiAgICB9XG5cbiAgICB2YXIgYXJncyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMik7XG4gICAgdmFyIGZvdW5kQ2FsbGVyID0gZmFsc2U7XG4gICAgZm9yICh2YXIgY3RvciA9IG1lLmNvbnN0cnVjdG9yO1xuICAgICAgICAgY3RvcjsgY3RvciA9IGN0b3Iuc3VwZXJDbGFzc18gJiYgY3Rvci5zdXBlckNsYXNzXy5jb25zdHJ1Y3Rvcikge1xuICAgICAgaWYgKGN0b3IucHJvdG90eXBlW29wdF9tZXRob2ROYW1lXSA9PT0gY2FsbGVyKSB7XG4gICAgICAgIGZvdW5kQ2FsbGVyID0gdHJ1ZTtcbiAgICAgIH0gZWxzZSBpZiAoZm91bmRDYWxsZXIpIHtcbiAgICAgICAgcmV0dXJuIGN0b3IucHJvdG90eXBlW29wdF9tZXRob2ROYW1lXS5hcHBseShtZSwgYXJncyk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gSWYgd2UgZGlkIG5vdCBmaW5kIHRoZSBjYWxsZXIgaW4gdGhlIHByb3RvdHlwZSBjaGFpbixcbiAgICAvLyB0aGVuIG9uZSBvZiB0d28gdGhpbmdzIGhhcHBlbmVkOlxuICAgIC8vIDEpIFRoZSBjYWxsZXIgaXMgYW4gaW5zdGFuY2UgbWV0aG9kLlxuICAgIC8vIDIpIFRoaXMgbWV0aG9kIHdhcyBub3QgY2FsbGVkIGJ5IHRoZSByaWdodCBjYWxsZXIuXG4gICAgaWYgKG1lW29wdF9tZXRob2ROYW1lXSA9PT0gY2FsbGVyKSB7XG4gICAgICByZXR1cm4gbWUuY29uc3RydWN0b3IucHJvdG90eXBlW29wdF9tZXRob2ROYW1lXS5hcHBseShtZSwgYXJncyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRocm93IEVycm9yKFxuICAgICAgICAgICdiYXNlIGNhbGxlZCBmcm9tIGEgbWV0aG9kIG9mIG9uZSBuYW1lICcgK1xuICAgICAgICAgICd0byBhIG1ldGhvZCBvZiBhIGRpZmZlcmVudCBuYW1lJyk7XG4gICAgfVxuICB9LFxuICBcbiAgbm9vcDogZnVuY3Rpb24oKXt9LFxuICBcbiAgdHJ1ZWZuYzogZnVuY3Rpb24oKXtyZXR1cm4gdHJ1ZX0sXG4gIFxuICBmYWxzZWZuYzogZnVuY3Rpb24oKXtyZXR1cm4gdHJ1ZX0sXG4gIFxuICByZXNvbHZlOiBmdW5jdGlvbih2YWx1ZSl7XG4gICAgdmFyIGRlZmVycmVkID0gJC5EZWZlcnJlZCgpO1xuICAgIGRlZmVycmVkLnJlc29sdmUodmFsdWUpO1xuICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlKCk7XG4gIH0sXG4gIFxuICByZWplY3Q6IGZ1bmN0aW9uKHZhbHVlKXtcbiAgICB2YXIgZGVmZXJyZWQgPSAkLkRlZmVycmVkKCk7XG4gICAgZGVmZXJyZWQucmVqZWN0KHZhbHVlKTtcbiAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZSgpO1xuICB9LFxuICBcbiAgQmFzZTY0OiBCYXNlNjRcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gdXRpbHM7XG4iLCJ2YXIgQ29udHJvbCA9IGZ1bmN0aW9uKG9wdGlvbnMpe1xuICB2YXIgbmFtZSA9IG9wdGlvbnMubmFtZSB8fCBcIj9cIjtcbiAgdGhpcy5uYW1lID0gbmFtZS5zcGxpdCgnICcpLmpvaW4oJy0nKS50b0xvd2VyQ2FzZSgpO1xuICB0aGlzLmlkID0gdGhpcy5uYW1lKydfJysoTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTAwMDAwMCkpO1xuICBcbiAgaWYgKCFvcHRpb25zLmVsZW1lbnQpIHtcbiAgICB2YXIgY2xhc3NOYW1lID0gXCJvbC1cIit0aGlzLm5hbWUuc3BsaXQoJyAnKS5qb2luKCctJykudG9Mb3dlckNhc2UoKTtcbiAgICB2YXIgdGlwTGFiZWwgPSBvcHRpb25zLnRpcExhYmVsIHx8IHRoaXMubmFtZTtcbiAgICB2YXIgbGFiZWwgPSBvcHRpb25zLmxhYmVsIHx8IFwiP1wiO1xuICAgIFxuICAgIG9wdGlvbnMuZWxlbWVudCA9ICQoJzxkaXYgY2xhc3M9XCInK2NsYXNzTmFtZSsnIG9sLXVuc2VsZWN0YWJsZSBvbC1jb250cm9sXCI+PGJ1dHRvbiB0eXBlPVwiYnV0dG9uXCIgdGl0bGU9XCInK3RpcExhYmVsKydcIj4nK2xhYmVsKyc8L2J1dHRvbj48L2Rpdj4nKVswXTtcbiAgfVxuICBcbiAgdmFyIGJ1dHRvbkNsaWNrSGFuZGxlciA9IG9wdGlvbnMuYnV0dG9uQ2xpY2tIYW5kbGVyIHx8IENvbnRyb2wucHJvdG90eXBlLl9oYW5kbGVDbGljay5iaW5kKHRoaXMpO1xuICBcbiAgJChvcHRpb25zLmVsZW1lbnQpLm9uKCdjbGljaycsYnV0dG9uQ2xpY2tIYW5kbGVyKTtcbiAgXG4gIG9sLmNvbnRyb2wuQ29udHJvbC5jYWxsKHRoaXMsb3B0aW9ucyk7XG4gIFxuICB0aGlzLl9wb3N0UmVuZGVyKCk7XG59XG5vbC5pbmhlcml0cyhDb250cm9sLCBvbC5jb250cm9sLkNvbnRyb2wpO1xuXG5cbnZhciBwcm90byA9IENvbnRyb2wucHJvdG90eXBlO1xuXG5wcm90by5faGFuZGxlQ2xpY2sgPSBmdW5jdGlvbigpe1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIHZhciBtYXAgPSB0aGlzLmdldE1hcCgpO1xuICBcbiAgdmFyIHJlc2V0Q29udHJvbCA9IG51bGw7XG4gIC8vIHJlbW92ZSBhbGwgdGhlIG90aGVyLCBldmVudHVhbGx5IHRvZ2dsZWQsIGludGVyYWN0aW9uY29udHJvbHNcbiAgdmFyIGNvbnRyb2xzID0gbWFwLmdldENvbnRyb2xzKCk7XG4gIGNvbnRyb2xzLmZvckVhY2goZnVuY3Rpb24oY29udHJvbCl7XG4gICAgaWYoY29udHJvbC5pZCAmJiBjb250cm9sLnRvZ2dsZSAmJiAoY29udHJvbC5pZCAhPSBzZWxmLmlkKSkge1xuICAgICAgY29udHJvbC50b2dnbGUoZmFsc2UpO1xuICAgICAgaWYgKGNvbnRyb2wubmFtZSA9PSAncmVzZXQnKSB7XG4gICAgICAgIHJlc2V0Q29udHJvbCA9IGNvbnRyb2w7XG4gICAgICB9XG4gICAgfVxuICB9KTtcbiAgaWYgKCFzZWxmLl90b2dnbGVkICYmIHJlc2V0Q29udHJvbCkge1xuICAgIHJlc2V0Q29udHJvbC50b2dnbGUodHJ1ZSk7XG4gIH1cbn07XG5cbnByb3RvLl9wb3N0UmVuZGVyID0gZnVuY3Rpb24oKXt9O1xuXG5tb2R1bGUuZXhwb3J0cyA9IENvbnRyb2w7XG4iLCJ2YXIgQ29udHJvbCA9IHJlcXVpcmUoJy4vY29udHJvbCcpO1xuXG52YXIgSW50ZXJhY3Rpb25Db250cm9sID0gZnVuY3Rpb24ob3B0aW9ucyl7XG4gIHRoaXMuX3RvZ2dsZWQgPSB0aGlzLl90b2dnbGVkIHx8IGZhbHNlO1xuICB0aGlzLl9pbnRlcmFjdGlvbkNsYXNzID0gb3B0aW9ucy5pbnRlcmFjdGlvbkNsYXNzIHx8IG51bGw7XG4gIHRoaXMuX2ludGVyYWN0aW9uID0gbnVsbDtcbiAgdGhpcy5fYXV0b3VudG9nZ2xlID0gb3B0aW9ucy5hdXRvdW50b2dnbGUgfHwgZmFsc2U7XG5cbiAgXG4gIG9wdGlvbnMuYnV0dG9uQ2xpY2tIYW5kbGVyID0gSW50ZXJhY3Rpb25Db250cm9sLnByb3RvdHlwZS5faGFuZGxlQ2xpY2suYmluZCh0aGlzKTtcbiAgXG4gIENvbnRyb2wuY2FsbCh0aGlzLG9wdGlvbnMpO1xufTtcbm9sLmluaGVyaXRzKEludGVyYWN0aW9uQ29udHJvbCwgQ29udHJvbCk7XG5cbnZhciBwcm90byA9IEludGVyYWN0aW9uQ29udHJvbC5wcm90b3R5cGU7XG5cbnByb3RvLnRvZ2dsZSA9IGZ1bmN0aW9uKHRvZ2dsZSl7XG4gIHZhciB0b2dnbGUgPSB0b2dnbGUgIT09IHVuZGVmaW5lZCA/IHRvZ2dsZSA6ICF0aGlzLl90b2dnbGVkXG4gIHRoaXMuX3RvZ2dsZWQgPSB0b2dnbGU7XG4gIHZhciBtYXAgPSB0aGlzLmdldE1hcCgpO1xuICB2YXIgY29udHJvbEJ1dHRvbiA9ICQodGhpcy5lbGVtZW50KS5maW5kKCdidXR0b24nKS5maXJzdCgpO1xuICBcbiAgaWYgKHRvZ2dsZSkge1xuICAgIGlmICh0aGlzLl9pbnRlcmFjdGlvbikge1xuICAgICAgLy9tYXAuYWRkSW50ZXJhY3Rpb24odGhpcy5faW50ZXJhY3Rpb24pO1xuICAgICAgdGhpcy5faW50ZXJhY3Rpb24uc2V0QWN0aXZlKHRydWUpO1xuICAgIH1cbiAgICBjb250cm9sQnV0dG9uLmFkZENsYXNzKCdnM3ctb2wtdG9nZ2xlZCcpO1xuICB9XG4gIGVsc2Uge1xuICAgIGlmICh0aGlzLl9pbnRlcmFjdGlvbikge1xuICAgICAgLy9tYXAucmVtb3ZlSW50ZXJhY3Rpb24odGhpcy5faW50ZXJhY3Rpb24pO1xuICAgICAgdGhpcy5faW50ZXJhY3Rpb24uc2V0QWN0aXZlKGZhbHNlKTtcbiAgICB9XG4gICAgY29udHJvbEJ1dHRvbi5yZW1vdmVDbGFzcygnZzN3LW9sLXRvZ2dsZWQnKTtcbiAgfVxufTtcblxucHJvdG8uc2V0TWFwID0gZnVuY3Rpb24obWFwKSB7XG4gIGlmICghdGhpcy5faW50ZXJhY3Rpb24pIHtcbiAgICB0aGlzLl9pbnRlcmFjdGlvbiA9IG5ldyB0aGlzLl9pbnRlcmFjdGlvbkNsYXNzO1xuICAgIG1hcC5hZGRJbnRlcmFjdGlvbih0aGlzLl9pbnRlcmFjdGlvbik7XG4gICAgdGhpcy5faW50ZXJhY3Rpb24uc2V0QWN0aXZlKGZhbHNlKTtcbiAgfVxuICBDb250cm9sLnByb3RvdHlwZS5zZXRNYXAuY2FsbCh0aGlzLG1hcCk7XG59O1xuXG5wcm90by5faGFuZGxlQ2xpY2sgPSBmdW5jdGlvbihlKXtcbiAgdGhpcy50b2dnbGUoKTtcbiAgQ29udHJvbC5wcm90b3R5cGUuX2hhbmRsZUNsaWNrLmNhbGwodGhpcyxlKTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gSW50ZXJhY3Rpb25Db250cm9sO1xuIiwidmFyIHV0aWxzID0gcmVxdWlyZSgnLi4vdXRpbHMnKTtcbnZhciBJbnRlcmFjdGlvbkNvbnRyb2wgPSByZXF1aXJlKCcuL2ludGVyYWN0aW9uY29udHJvbCcpO1xuXG52YXIgUGlja0Nvb3JkaW5hdGVzSW50ZXJhY3Rpb24gPSByZXF1aXJlKCcuLi9pbnRlcmFjdGlvbnMvcGlja2Nvb3JkaW5hdGVzaW50ZXJhY3Rpb24nKTtcblxudmFyIFF1ZXJ5Q29udHJvbCA9IGZ1bmN0aW9uKG9wdGlvbnMpe1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIHZhciBfb3B0aW9ucyA9IHtcbiAgICBuYW1lOiBcInF1ZXJ5bGF5ZXJcIixcbiAgICB0aXBMYWJlbDogXCJRdWVyeSBsYXllclwiLFxuICAgIGxhYmVsOiBcIlxcdWVhMGZcIixcbiAgICBpbnRlcmFjdGlvbkNsYXNzOiBQaWNrQ29vcmRpbmF0ZXNJbnRlcmFjdGlvblxuICB9O1xuICBcbiAgb3B0aW9ucyA9IHV0aWxzLm1lcmdlKG9wdGlvbnMsX29wdGlvbnMpO1xuICBcbiAgSW50ZXJhY3Rpb25Db250cm9sLmNhbGwodGhpcyxvcHRpb25zKTtcbn1cbm9sLmluaGVyaXRzKFF1ZXJ5Q29udHJvbCwgSW50ZXJhY3Rpb25Db250cm9sKTtcblxudmFyIHByb3RvID0gUXVlcnlDb250cm9sLnByb3RvdHlwZTtcblxucHJvdG8uc2V0TWFwID0gZnVuY3Rpb24obWFwKSB7XG4gIHZhciBzZWxmID0gdGhpcztcbiAgSW50ZXJhY3Rpb25Db250cm9sLnByb3RvdHlwZS5zZXRNYXAuY2FsbCh0aGlzLG1hcCk7XG4gIHRoaXMuX2ludGVyYWN0aW9uLm9uKCdib3hzdGFydCcsZnVuY3Rpb24oZSl7XG4gICAgc2VsZi5fc3RhcnRDb29yZGluYXRlID0gZS5jb29yZGluYXRlO1xuICB9KTtcbiAgXG4gIHRoaXMuX2ludGVyYWN0aW9uLm9uKCdwaWNrZWQnLGZ1bmN0aW9uKGUpe1xuICAgIHNlbGYuZGlzcGF0Y2hFdmVudCh7XG4gICAgICB0eXBlOiAncGlja2VkJyxcbiAgICAgIGNvb3JkaW5hdGVzOiBlLmNvb3JkaW5hdGVcbiAgICB9KTtcbiAgICBpZiAoc2VsZi5fYXV0b3VudG9nZ2xlKSB7XG4gICAgICBzZWxmLnRvZ2dsZSgpO1xuICAgIH1cbiAgfSk7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFF1ZXJ5Q29udHJvbDtcbiIsInZhciB1dGlscyA9IHJlcXVpcmUoJy4uL3V0aWxzJyk7XG52YXIgSW50ZXJhY3Rpb25Db250cm9sID0gcmVxdWlyZSgnLi9pbnRlcmFjdGlvbmNvbnRyb2wnKTtcblxudmFyIFJlc2V0Q29udHJvbCA9IGZ1bmN0aW9uKG9wdGlvbnMpe1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIHRoaXMuX3RvZ2dsZWQgPSB0cnVlO1xuICB0aGlzLl9zdGFydENvb3JkaW5hdGUgPSBudWxsO1xuICB2YXIgX29wdGlvbnMgPSB7XG4gICAgICBuYW1lOiBcInJlc2V0XCIsXG4gICAgICB0aXBMYWJlbDogXCJQYW5cIixcbiAgICAgIGxhYmVsOiBcIlxcdWU5MDFcIixcbiAgICB9O1xuICBcbiAgb3B0aW9ucyA9IHV0aWxzLm1lcmdlKG9wdGlvbnMsX29wdGlvbnMpO1xuICBcbiAgSW50ZXJhY3Rpb25Db250cm9sLmNhbGwodGhpcyxvcHRpb25zKTtcbn1cbm9sLmluaGVyaXRzKFJlc2V0Q29udHJvbCwgSW50ZXJhY3Rpb25Db250cm9sKTtcbm1vZHVsZS5leHBvcnRzID0gUmVzZXRDb250cm9sO1xuXG52YXIgcHJvdG8gPSBSZXNldENvbnRyb2wucHJvdG90eXBlO1xuXG5wcm90by5fcG9zdFJlbmRlciA9IGZ1bmN0aW9uKCl7XG4gIHRoaXMudG9nZ2xlKHRydWUpO1xufTtcbiIsInZhciB1dGlscyA9IHJlcXVpcmUoJy4uL3V0aWxzJyk7XG52YXIgSW50ZXJhY3Rpb25Db250cm9sID0gcmVxdWlyZSgnLi9pbnRlcmFjdGlvbmNvbnRyb2wnKTtcblxudmFyIFpvb21Cb3hDb250cm9sID0gZnVuY3Rpb24ob3B0aW9ucyl7XG4gIHZhciBzZWxmID0gdGhpcztcbiAgdGhpcy5fc3RhcnRDb29yZGluYXRlID0gbnVsbDtcbiAgdmFyIF9vcHRpb25zID0ge1xuICAgICAgbmFtZTogXCJ6b29tYm94XCIsXG4gICAgICB0aXBMYWJlbDogXCJab29tIHRvIGJveFwiLFxuICAgICAgbGFiZWw6IFwiXFx1ZTkwMFwiLFxuICAgICAgaW50ZXJhY3Rpb25DbGFzczogb2wuaW50ZXJhY3Rpb24uRHJhZ0JveFxuICAgIH07XG4gIFxuICBvcHRpb25zID0gdXRpbHMubWVyZ2Uob3B0aW9ucyxfb3B0aW9ucyk7XG4gIFxuICBJbnRlcmFjdGlvbkNvbnRyb2wuY2FsbCh0aGlzLG9wdGlvbnMpO1xufVxub2wuaW5oZXJpdHMoWm9vbUJveENvbnRyb2wsIEludGVyYWN0aW9uQ29udHJvbCk7XG5tb2R1bGUuZXhwb3J0cyA9IFpvb21Cb3hDb250cm9sO1xuXG52YXIgcHJvdG8gPSBab29tQm94Q29udHJvbC5wcm90b3R5cGU7XG5cbnByb3RvLnNldE1hcCA9IGZ1bmN0aW9uKG1hcCkge1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIEludGVyYWN0aW9uQ29udHJvbC5wcm90b3R5cGUuc2V0TWFwLmNhbGwodGhpcyxtYXApO1xuICB0aGlzLl9pbnRlcmFjdGlvbi5vbignYm94c3RhcnQnLGZ1bmN0aW9uKGUpe1xuICAgIHNlbGYuX3N0YXJ0Q29vcmRpbmF0ZSA9IGUuY29vcmRpbmF0ZTtcbiAgfSk7XG4gIFxuICB0aGlzLl9pbnRlcmFjdGlvbi5vbignYm94ZW5kJyxmdW5jdGlvbihlKXtcbiAgICB2YXIgc3RhcnRfY29vcmRpbmF0ZSA9IHNlbGYuX3N0YXJ0Q29vcmRpbmF0ZTtcbiAgICB2YXIgZW5kX2Nvb3JkaW5hdGUgPSBlLmNvb3JkaW5hdGU7XG4gICAgdmFyIGV4dGVudCA9IG9sLmV4dGVudC5ib3VuZGluZ0V4dGVudChbc3RhcnRfY29vcmRpbmF0ZSxlbmRfY29vcmRpbmF0ZV0pO1xuICAgIHNlbGYuZGlzcGF0Y2hFdmVudCh7XG4gICAgICB0eXBlOiAnem9vbWVuZCcsXG4gICAgICBleHRlbnQ6IGV4dGVudFxuICAgIH0pO1xuICAgIHNlbGYuX3N0YXJ0Q29vcmRpbmF0ZSA9IG51bGw7XG4gICAgaWYgKHNlbGYuX2F1dG91bnRvZ2dsZSkge1xuICAgICAgc2VsZi50b2dnbGUoKTtcbiAgICB9XG4gIH0pXG59O1xuIiwidmFyIHV0aWxzID0gcmVxdWlyZSgnLi91dGlscycpO1xudmFyIG1hcGhlbHBlcnMgPSByZXF1aXJlKCcuL21hcC9tYXBoZWxwZXJzJyk7XG5cbihmdW5jdGlvbiAobmFtZSwgcm9vdCwgZmFjdG9yeSkge1xuICBpZiAodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKSB7XG4gICAgZGVmaW5lKGZhY3RvcnkpO1xuICB9XG4gIGVsc2UgaWYgKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0Jykge1xuICAgIG1vZHVsZS5leHBvcnRzID0gZmFjdG9yeSgpO1xuICB9XG4gIGVsc2Uge1xuICAgIHJvb3RbbmFtZV0gPSBmYWN0b3J5KCk7XG4gIH1cbn0pKCdnM3dvbDMnLCB0aGlzLCBmdW5jdGlvbiAoKSB7XG4gICd1c2Ugc3RyaWN0JztcbiAgXG4gIHZhciBoZWxwZXJzID0gdXRpbHMubWVyZ2Uoe30sbWFwaGVscGVycyk7XG4gIFxuICByZXR1cm4ge1xuICAgIGhlbHBlcnM6IGhlbHBlcnNcbiAgfVxufSk7XG4iLCJ2YXIgUGlja0Nvb3JkaW5hdGVzRXZlbnRUeXBlID0ge1xuICBQSUNLRUQ6ICdwaWNrZWQnXG59O1xuXG52YXIgUGlja0Nvb3JkaW5hdGVzRXZlbnQgPSBmdW5jdGlvbih0eXBlLCBjb29yZGluYXRlKSB7XG4gIHRoaXMudHlwZSA9IHR5cGU7XG4gIHRoaXMuY29vcmRpbmF0ZSA9IGNvb3JkaW5hdGU7XG59O1xuXG52YXIgUGlja0Nvb3JkaW5hdGVzSW50ZXJhY3Rpb24gPSBmdW5jdGlvbihvcHRpb25zKSB7XG4gIHRoaXMucHJldmlvdXNDdXJzb3JfID0gbnVsbDtcbiAgXG4gIG9sLmludGVyYWN0aW9uLlBvaW50ZXIuY2FsbCh0aGlzLCB7XG4gICAgaGFuZGxlRG93bkV2ZW50OiBQaWNrQ29vcmRpbmF0ZXNJbnRlcmFjdGlvbi5oYW5kbGVEb3duRXZlbnRfLFxuICAgIGhhbmRsZVVwRXZlbnQ6IFBpY2tDb29yZGluYXRlc0ludGVyYWN0aW9uLmhhbmRsZVVwRXZlbnRfLFxuICAgIGhhbmRsZU1vdmVFdmVudDogUGlja0Nvb3JkaW5hdGVzSW50ZXJhY3Rpb24uaGFuZGxlTW92ZUV2ZW50XyxcbiAgfSk7XG59O1xub2wuaW5oZXJpdHMoUGlja0Nvb3JkaW5hdGVzSW50ZXJhY3Rpb24sIG9sLmludGVyYWN0aW9uLlBvaW50ZXIpO1xuXG5QaWNrQ29vcmRpbmF0ZXNJbnRlcmFjdGlvbi5oYW5kbGVEb3duRXZlbnRfID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgcmV0dXJuIHRydWU7XG59O1xuXG5QaWNrQ29vcmRpbmF0ZXNJbnRlcmFjdGlvbi5oYW5kbGVVcEV2ZW50XyA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gIHRoaXMuZGlzcGF0Y2hFdmVudChcbiAgICAgICAgICBuZXcgUGlja0Nvb3JkaW5hdGVzRXZlbnQoXG4gICAgICAgICAgICAgIFBpY2tDb29yZGluYXRlc0V2ZW50VHlwZS5QSUNLRUQsXG4gICAgICAgICAgICAgIGV2ZW50LmNvb3JkaW5hdGUpKTtcbiAgcmV0dXJuIHRydWU7XG59O1xuXG5QaWNrQ29vcmRpbmF0ZXNJbnRlcmFjdGlvbi5oYW5kbGVNb3ZlRXZlbnRfID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgdmFyIGVsZW0gPSBldmVudC5tYXAuZ2V0VGFyZ2V0RWxlbWVudCgpO1xuICBlbGVtLnN0eWxlLmN1cnNvciA9ICAncG9pbnRlcic7XG59O1xuXG5QaWNrQ29vcmRpbmF0ZXNJbnRlcmFjdGlvbi5wcm90b3R5cGUuc2hvdWxkU3RvcEV2ZW50ID0gZnVuY3Rpb24oKXtcbiAgcmV0dXJuIGZhbHNlO1xufTtcblxuUGlja0Nvb3JkaW5hdGVzSW50ZXJhY3Rpb24ucHJvdG90eXBlLnNldE1hcCA9IGZ1bmN0aW9uKG1hcCl7XG4gIGlmICghbWFwKSB7XG4gICAgdmFyIGVsZW0gPSB0aGlzLmdldE1hcCgpLmdldFRhcmdldEVsZW1lbnQoKTtcbiAgICBlbGVtLnN0eWxlLmN1cnNvciA9ICcnO1xuICB9XG4gIG9sLmludGVyYWN0aW9uLlBvaW50ZXIucHJvdG90eXBlLnNldE1hcC5jYWxsKHRoaXMsbWFwKTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gUGlja0Nvb3JkaW5hdGVzSW50ZXJhY3Rpb247XG4iLCIgIHZhciBQaWNrRmVhdHVyZUV2ZW50VHlwZSA9IHtcbiAgUElDS0VEOiAncGlja2VkJ1xufTtcblxudmFyIFBpY2tGZWF0dXJlRXZlbnQgPSBmdW5jdGlvbih0eXBlLCBjb29yZGluYXRlLCBmZWF0dXJlKSB7XG4gIHRoaXMudHlwZSA9IHR5cGU7XG4gIHRoaXMuZmVhdHVyZSA9IGZlYXR1cmU7XG4gIHRoaXMuY29vcmRpbmF0ZSA9IGNvb3JkaW5hdGU7XG59O1xuXG52YXIgUGlja0ZlYXR1cmVJbnRlcmFjdGlvbiA9IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgb2wuaW50ZXJhY3Rpb24uUG9pbnRlci5jYWxsKHRoaXMsIHtcbiAgICBoYW5kbGVEb3duRXZlbnQ6IFBpY2tGZWF0dXJlSW50ZXJhY3Rpb24uaGFuZGxlRG93bkV2ZW50XyxcbiAgICBoYW5kbGVVcEV2ZW50OiBQaWNrRmVhdHVyZUludGVyYWN0aW9uLmhhbmRsZVVwRXZlbnRfLFxuICAgIGhhbmRsZU1vdmVFdmVudDogUGlja0ZlYXR1cmVJbnRlcmFjdGlvbi5oYW5kbGVNb3ZlRXZlbnRfLFxuICB9KTtcbiAgXG4gIHRoaXMuZmVhdHVyZXNfID0gb3B0aW9ucy5mZWF0dXJlcyB8fCBudWxsO1xuICBcbiAgdGhpcy5sYXllcnNfID0gb3B0aW9ucy5sYXllcnMgfHwgbnVsbDtcbiAgXG4gIHRoaXMucGlja2VkRmVhdHVyZV8gPSBudWxsO1xuICBcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICB0aGlzLmxheWVyRmlsdGVyXyA9IGZ1bmN0aW9uKGxheWVyKSB7XG4gICAgcmV0dXJuIF8uaW5jbHVkZXMoc2VsZi5sYXllcnNfLCBsYXllcik7XG4gIH07XG59O1xub2wuaW5oZXJpdHMoUGlja0ZlYXR1cmVJbnRlcmFjdGlvbiwgb2wuaW50ZXJhY3Rpb24uUG9pbnRlcik7XG5cblBpY2tGZWF0dXJlSW50ZXJhY3Rpb24uaGFuZGxlRG93bkV2ZW50XyA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gIHRoaXMucGlja2VkRmVhdHVyZV8gPSB0aGlzLmZlYXR1cmVzQXRQaXhlbF8oZXZlbnQucGl4ZWwsIGV2ZW50Lm1hcCk7XG4gIHJldHVybiB0cnVlO1xufTtcblxuUGlja0ZlYXR1cmVJbnRlcmFjdGlvbi5oYW5kbGVVcEV2ZW50XyA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gIGlmKHRoaXMucGlja2VkRmVhdHVyZV8pe1xuICAgIHRoaXMuZGlzcGF0Y2hFdmVudChcbiAgICAgICAgICAgIG5ldyBQaWNrRmVhdHVyZUV2ZW50KFxuICAgICAgICAgICAgICAgIFBpY2tGZWF0dXJlRXZlbnRUeXBlLlBJQ0tFRCxcbiAgICAgICAgICAgICAgICBldmVudC5jb29yZGluYXRlLFxuICAgICAgICAgICAgICAgIHRoaXMucGlja2VkRmVhdHVyZV8pKTtcbiAgfVxuICByZXR1cm4gdHJ1ZTtcbn07XG5cblBpY2tGZWF0dXJlSW50ZXJhY3Rpb24uaGFuZGxlTW92ZUV2ZW50XyA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gIHZhciBlbGVtID0gZXZlbnQubWFwLmdldFRhcmdldEVsZW1lbnQoKTtcbiAgdmFyIGludGVyc2VjdGluZ0ZlYXR1cmUgPSB0aGlzLmZlYXR1cmVzQXRQaXhlbF8oZXZlbnQucGl4ZWwsIGV2ZW50Lm1hcCk7XG5cbiAgaWYgKGludGVyc2VjdGluZ0ZlYXR1cmUpIHtcbiAgICBlbGVtLnN0eWxlLmN1cnNvciA9ICAncG9pbnRlcic7XG4gIH0gZWxzZSB7XG4gICAgZWxlbS5zdHlsZS5jdXJzb3IgPSAnJztcbiAgfVxufTtcblxuUGlja0ZlYXR1cmVJbnRlcmFjdGlvbi5wcm90b3R5cGUuZmVhdHVyZXNBdFBpeGVsXyA9IGZ1bmN0aW9uKHBpeGVsLCBtYXApIHtcbiAgdmFyIGZvdW5kID0gbnVsbDtcblxuICB2YXIgaW50ZXJzZWN0aW5nRmVhdHVyZSA9IG1hcC5mb3JFYWNoRmVhdHVyZUF0UGl4ZWwocGl4ZWwsXG4gICAgICBmdW5jdGlvbihmZWF0dXJlKSB7XG4gICAgICAgIGlmICh0aGlzLmZlYXR1cmVzXykge1xuICAgICAgICAgIGlmICh0aGlzLmZlYXR1cmVzXy5pbmRleE9mKGZlYXR1cmUpID4gLTEpe1xuICAgICAgICAgICAgcmV0dXJuIGZlYXR1cmVcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZXtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmVhdHVyZTtcbiAgICAgIH0sdGhpcyx0aGlzLmxheWVyRmlsdGVyXyk7XG4gIFxuICBpZihpbnRlcnNlY3RpbmdGZWF0dXJlKXtcbiAgICBmb3VuZCA9IGludGVyc2VjdGluZ0ZlYXR1cmU7XG4gIH1cbiAgcmV0dXJuIGZvdW5kO1xufTtcblxuUGlja0ZlYXR1cmVJbnRlcmFjdGlvbi5wcm90b3R5cGUuc2hvdWxkU3RvcEV2ZW50ID0gZnVuY3Rpb24oKXtcbiAgcmV0dXJuIGZhbHNlO1xufTtcblxuUGlja0ZlYXR1cmVJbnRlcmFjdGlvbi5wcm90b3R5cGUuc2V0TWFwID0gZnVuY3Rpb24obWFwKXtcbiAgaWYgKCFtYXApIHtcbiAgICB2YXIgZWxlbSA9IHRoaXMuZ2V0TWFwKCkuZ2V0VGFyZ2V0RWxlbWVudCgpO1xuICAgIGVsZW0uc3R5bGUuY3Vyc29yID0gJyc7XG4gIH1cbiAgb2wuaW50ZXJhY3Rpb24uUG9pbnRlci5wcm90b3R5cGUuc2V0TWFwLmNhbGwodGhpcyxtYXApO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBQaWNrRmVhdHVyZUludGVyYWN0aW9uO1xuIiwidmFyIEJhc2VMYXllcnMgPSB7fTtcblxuQmFzZUxheWVycy5PU00gPSBuZXcgb2wubGF5ZXIuVGlsZSh7XG4gIHNvdXJjZTogbmV3IG9sLnNvdXJjZS5PU00oe1xuICAgIGF0dHJpYnV0aW9uczogW1xuICAgICAgbmV3IG9sLkF0dHJpYnV0aW9uKHtcbiAgICAgICAgaHRtbDogJ0FsbCBtYXBzICZjb3B5OyAnICtcbiAgICAgICAgICAgICc8YSBocmVmPVwiaHR0cDovL3d3dy5vcGVuc3RyZWV0bWFwLm9yZy9cIj5PcGVuU3RyZWV0TWFwPC9hPidcbiAgICAgIH0pLFxuICAgICAgb2wuc291cmNlLk9TTS5BVFRSSUJVVElPTlxuICAgIF0sXG4gICAgdXJsOiAnaHR0cDovL3thLWN9LnRpbGUub3BlbnN0cmVldG1hcC5vcmcve3p9L3t4fS97eX0ucG5nJyxcbiAgICBjcm9zc09yaWdpbjogbnVsbFxuICB9KSxcbiAgaWQ6ICdvc20nLFxuICB0aXRsZTogJ09TTScsXG4gIGJhc2VtYXA6IHRydWVcbn0pO1xuXG5CYXNlTGF5ZXJzLkJJTkcgPSB7fTtcblxuQmFzZUxheWVycy5CSU5HLlJvYWQgPSBuZXcgb2wubGF5ZXIuVGlsZSh7XG4gIG5hbWU6J1JvYWQnLFxuICB2aXNpYmxlOiBmYWxzZSxcbiAgcHJlbG9hZDogSW5maW5pdHksXG4gIHNvdXJjZTogbmV3IG9sLnNvdXJjZS5CaW5nTWFwcyh7XG4gICAga2V5OiAnQW1fbUFTblVBLWp0VzNPM014SVltT09QTE92TDM5ZHdNdlJueW9IeGZLZl9FUE5ZZ2ZXTTlpbXFHRVRXS0dWbicsXG4gICAgaW1hZ2VyeVNldDogJ1JvYWQnXG4gICAgICAvLyB1c2UgbWF4Wm9vbSAxOSB0byBzZWUgc3RyZXRjaGVkIHRpbGVzIGluc3RlYWQgb2YgdGhlIEJpbmdNYXBzXG4gICAgICAvLyBcIm5vIHBob3RvcyBhdCB0aGlzIHpvb20gbGV2ZWxcIiB0aWxlc1xuICAgICAgLy8gbWF4Wm9vbTogMTlcbiAgfSksXG4gIGJhc2VtYXA6IHRydWVcbn0pO1xuXG5CYXNlTGF5ZXJzLkJJTkcuQWVyaWFsV2l0aExhYmVscyA9IG5ldyBvbC5sYXllci5UaWxlKHtcbiAgbmFtZTogJ0FlcmlhbFdpdGhMYWJlbHMnLFxuICB2aXNpYmxlOiB0cnVlLFxuICBwcmVsb2FkOiBJbmZpbml0eSxcbiAgc291cmNlOiBuZXcgb2wuc291cmNlLkJpbmdNYXBzKHtcbiAgICBrZXk6ICdBbV9tQVNuVUEtanRXM08zTXhJWW1PT1BMT3ZMMzlkd012Um55b0h4ZktmX0VQTllnZldNOWltcUdFVFdLR1ZuJyxcbiAgICBpbWFnZXJ5U2V0OiAnQWVyaWFsV2l0aExhYmVscydcbiAgICAgIC8vIHVzZSBtYXhab29tIDE5IHRvIHNlZSBzdHJldGNoZWQgdGlsZXMgaW5zdGVhZCBvZiB0aGUgQmluZ01hcHNcbiAgICAgIC8vIFwibm8gcGhvdG9zIGF0IHRoaXMgem9vbSBsZXZlbFwiIHRpbGVzXG4gICAgICAvLyBtYXhab29tOiAxOVxuICB9KSxcbiAgYmFzZW1hcDogdHJ1ZVxufSk7XG5cbkJhc2VMYXllcnMuQklORy5BZXJpYWwgPSBuZXcgb2wubGF5ZXIuVGlsZSh7XG4gIG5hbWU6ICdBZXJpYWwnLFxuICB2aXNpYmxlOiBmYWxzZSxcbiAgcHJlbG9hZDogSW5maW5pdHksXG4gIHNvdXJjZTogbmV3IG9sLnNvdXJjZS5CaW5nTWFwcyh7XG4gICAga2V5OiAnQW1fbUFTblVBLWp0VzNPM014SVltT09QTE92TDM5ZHdNdlJueW9IeGZLZl9FUE5ZZ2ZXTTlpbXFHRVRXS0dWbicsXG4gICAgaW1hZ2VyeVNldDogJ0FlcmlhbCdcbiAgICAgIC8vIHVzZSBtYXhab29tIDE5IHRvIHNlZSBzdHJldGNoZWQgdGlsZXMgaW5zdGVhZCBvZiB0aGUgQmluZ01hcHNcbiAgICAgIC8vIFwibm8gcGhvdG9zIGF0IHRoaXMgem9vbSBsZXZlbFwiIHRpbGVzXG4gICAgICAvLyBtYXhab29tOiAxOVxuICB9KSxcbiAgYmFzZW1hcDogdHJ1ZVxufSk7XG5cbm1vZHVsZS5leHBvcnRzID0gQmFzZUxheWVycztcbiIsInZhciB1dGlscyA9IHJlcXVpcmUoJy4uL3V0aWxzJyk7XG52YXIgUmFzdGVyTGF5ZXJzID0ge307XG5cblJhc3RlckxheWVycy5UaWxlZFdNU0xheWVyID0gZnVuY3Rpb24obGF5ZXJPYmosZXh0cmFQYXJhbXMpe1xuICB2YXIgb3B0aW9ucyA9IHtcbiAgICBsYXllck9iajogbGF5ZXJPYmosXG4gICAgZXh0cmFQYXJhbXM6IGV4dHJhUGFyYW1zIHx8IHt9LFxuICAgIHRpbGVkOiB0cnVlXG4gIH1cbiAgcmV0dXJuIFJhc3RlckxheWVycy5fV01TTGF5ZXIob3B0aW9ucyk7XG59O1xuXG5SYXN0ZXJMYXllcnMuV01TTGF5ZXIgPSBmdW5jdGlvbihsYXllck9iaixleHRyYVBhcmFtcyl7XG4gIHZhciBvcHRpb25zID0ge1xuICAgIGxheWVyT2JqOiBsYXllck9iaixcbiAgICBleHRyYVBhcmFtczogZXh0cmFQYXJhbXMgfHwge31cbiAgfVxuICByZXR1cm4gUmFzdGVyTGF5ZXJzLl9XTVNMYXllcihvcHRpb25zKTtcbn07XG5cblJhc3RlckxheWVycy5fV01TTGF5ZXIgPSBmdW5jdGlvbihvcHRpb25zKXtcbiAgdmFyIGxheWVyT2JqID0gb3B0aW9ucy5sYXllck9iajtcbiAgdmFyIGV4dHJhUGFyYW1zID0gb3B0aW9ucy5leHRyYVBhcmFtcztcbiAgdmFyIHRpbGVkID0gb3B0aW9ucy50aWxlZCB8fCBmYWxzZTtcbiAgXG4gIHZhciBwYXJhbXMgPSB7XG4gICAgTEFZRVJTOiBsYXllck9iai5sYXllcnMgfHwgJycsXG4gICAgVkVSU0lPTjogJzEuMy4wJyxcbiAgICBUUkFOU1BBUkVOVDogdHJ1ZSxcbiAgICBTTERfVkVSU0lPTjogJzEuMS4wJ1xuICB9O1xuICBcbiAgcGFyYW1zID0gdXRpbHMubWVyZ2UocGFyYW1zLGV4dHJhUGFyYW1zKTtcbiAgXG4gIHZhciBzb3VyY2VPcHRpb25zID0ge1xuICAgIHVybDogbGF5ZXJPYmoudXJsLFxuICAgIHBhcmFtczogcGFyYW1zLFxuICAgIHJhdGlvOiAxXG4gIH07XG4gIFxuICB2YXIgaW1hZ2VPcHRpb25zID0ge1xuICAgIGlkOiBsYXllck9iai5pZCxcbiAgICBuYW1lOiBsYXllck9iai5uYW1lLFxuICAgIG9wYWNpdHk6IGxheWVyT2JqLm9wYWNpdHkgfHwgMS4wLFxuICAgIHZpc2libGU6bGF5ZXJPYmoudmlzaWJsZSxcbiAgICBtYXhSZXNvbHV0aW9uOiBsYXllck9iai5tYXhSZXNvbHV0aW9uXG4gIH1cbiAgXG4gIHZhciBpbWFnZUNsYXNzO1xuICB2YXIgc291cmNlO1xuICBpZiAodGlsZWQpIHtcbiAgICBzb3VyY2UgPSBuZXcgb2wuc291cmNlLlRpbGVXTVMoc291cmNlT3B0aW9ucyk7XG4gICAgaW1hZ2VDbGFzcyA9IG9sLmxheWVyLlRpbGU7XG4gICAgLy9pbWFnZU9wdGlvbnMuZXh0ZW50ID0gWzExMzQ4NjcsMzg3MzAwMiwyNTA1OTY0LDU1OTY5NDRdO1xuICB9XG4gIGVsc2Uge1xuICAgIHNvdXJjZSA9IG5ldyBvbC5zb3VyY2UuSW1hZ2VXTVMoc291cmNlT3B0aW9ucylcbiAgICBpbWFnZUNsYXNzID0gb2wubGF5ZXIuSW1hZ2U7XG4gIH1cbiAgXG4gIGltYWdlT3B0aW9ucy5zb3VyY2UgPSBzb3VyY2U7XG4gIFxuICB2YXIgbGF5ZXIgPSBuZXcgaW1hZ2VDbGFzcyhpbWFnZU9wdGlvbnMpO1xuICBcbiAgcmV0dXJuIGxheWVyO1xufTtcblxuLypSYXN0ZXJMYXllcnMuVGlsZWRXTVNMYXllciA9IGZ1bmN0aW9uKGxheWVyT2JqKXtcbiAgdmFyIGxheWVyID0gbmV3IG9sLmxheWVyLlRpbGUoe1xuICAgIG5hbWU6IGxheWVyT2JqLm5hbWUsXG4gICAgb3BhY2l0eTogMS4wLFxuICAgIHNvdXJjZTogbmV3IG9sLnNvdXJjZS5UaWxlV01TKHtcbiAgICAgIHVybDogbGF5ZXJPYmoudXJsLFxuICAgICAgcGFyYW1zOiB7XG4gICAgICAgIExBWUVSUzogbGF5ZXJPYmoubGF5ZXJzIHx8ICcnLFxuICAgICAgICBWRVJTSU9OOiAnMS4zLjAnLFxuICAgICAgICBUUkFOU1BBUkVOVDogdHJ1ZVxuICAgICAgfVxuICAgIH0pLFxuICAgIHZpc2libGU6IGxheWVyT2JqLnZpc2libGVcbiAgfSk7XG4gIFxuICByZXR1cm4gbGF5ZXI7XG59OyovXG5cbm1vZHVsZS5leHBvcnRzID0gUmFzdGVyTGF5ZXJzO1xuXG4iLCJCYXNlTGF5ZXJzID0gcmVxdWlyZSgnLi4vbGF5ZXJzL2Jhc2VzJyk7XG5cbnZhciBNYXBIZWxwZXJzID0ge1xuICBjcmVhdGVWaWV3ZXI6IGZ1bmN0aW9uKG9wdHMpe1xuICAgIHJldHVybiBuZXcgX1ZpZXdlcihvcHRzKTtcbiAgfVxufTtcblxudmFyIF9WaWV3ZXIgPSBmdW5jdGlvbihvcHRzKXtcbiAgdmFyIGNvbnRyb2xzID0gb2wuY29udHJvbC5kZWZhdWx0cyh7XG4gICAgYXR0cmlidXRpb25PcHRpb25zOiB7XG4gICAgICBjb2xsYXBzaWJsZTogZmFsc2VcbiAgICB9LFxuICAgIHpvb206IGZhbHNlLFxuICAgIGF0dHJpYnV0aW9uOiBmYWxzZVxuICB9KTsvLy5leHRlbmQoW25ldyBvbC5jb250cm9sLlpvb20oKV0pO1xuICBcbiAgdmFyIGludGVyYWN0aW9ucyA9IG9sLmludGVyYWN0aW9uLmRlZmF1bHRzKClcbiAgICAuZXh0ZW5kKFtcbiAgICAgIG5ldyBvbC5pbnRlcmFjdGlvbi5EcmFnUm90YXRlKClcbiAgICBdKTtcbiAgaW50ZXJhY3Rpb25zLnJlbW92ZUF0KDEpIC8vIHJpbXVvdm8gZG91Y2xpY2t6b29tXG4gIFxuICB2YXIgdmlldztcbiAgaWYgKG9wdHMudmlldyBpbnN0YW5jZW9mIG9sLlZpZXcpIHtcbiAgICB2aWV3ID0gb3B0cy52aWV3O1xuICB9XG4gIGVsc2Uge1xuICAgIHZpZXcgPSBuZXcgb2wuVmlldyhvcHRzLnZpZXcpO1xuICB9XG4gIHZhciBvcHRpb25zID0ge1xuICAgIGNvbnRyb2xzOiBjb250cm9scyxcbiAgICBpbnRlcmFjdGlvbnM6IGludGVyYWN0aW9ucyxcbiAgICBvbDNMb2dvOiBmYWxzZSxcbiAgICB2aWV3OiB2aWV3LFxuICAgIGtleWJvYXJkRXZlbnRUYXJnZXQ6IGRvY3VtZW50XG4gIH07XG4gIGlmIChvcHRzLmlkKXtcbiAgICBvcHRpb25zLnRhcmdldCA9IG9wdHMuaWQ7XG4gIH1cbiAgdmFyIG1hcCAgPSBuZXcgb2wuTWFwKG9wdGlvbnMpO1xuICB0aGlzLm1hcCA9IG1hcDtcbn07XG5cbl9WaWV3ZXIucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbigpe1xuICBpZiAodGhpcy5tYXApIHtcbiAgICB0aGlzLm1hcC5kaXNwb3NlKCk7XG4gICAgdGhpcy5tYXAgPSBudWxsXG4gIH1cbn07XG5cbl9WaWV3ZXIucHJvdG90eXBlLmdldFZpZXcgPSBmdW5jdGlvbigpIHtcbiAgcmV0dXJuIHRoaXMubWFwLmdldFZpZXcoKTtcbn1cblxuX1ZpZXdlci5wcm90b3R5cGUudXBkYXRlTWFwID0gZnVuY3Rpb24obWFwT2JqZWN0KXt9O1xuXG5fVmlld2VyLnByb3RvdHlwZS51cGRhdGVWaWV3ID0gZnVuY3Rpb24oKXt9O1xuXG5fVmlld2VyLnByb3RvdHlwZS5nZXRNYXAgPSBmdW5jdGlvbigpe1xuICByZXR1cm4gdGhpcy5tYXA7XG59O1xuXG5fVmlld2VyLnByb3RvdHlwZS5zZXRUYXJnZXQgPSBmdW5jdGlvbihpZCl7XG4gIHRoaXMubWFwLnNldFRhcmdldChpZCk7XG59O1xuXG5fVmlld2VyLnByb3RvdHlwZS5nb1RvID0gZnVuY3Rpb24oY29vcmRpbmF0ZXMsIHpvb20pe1xuICB2YXIgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307XG4gIHZhciBhbmltYXRlID0gb3B0aW9ucy5hbmltYXRlIHx8IHRydWU7XG4gIHZhciB2aWV3ID0gdGhpcy5tYXAuZ2V0VmlldygpO1xuICBcbiAgaWYgKGFuaW1hdGUpIHtcbiAgICB2YXIgcGFuID0gb2wuYW5pbWF0aW9uLnBhbih7XG4gICAgICBkdXJhdGlvbjogNTAwLFxuICAgICAgc291cmNlOiB2aWV3LmdldENlbnRlcigpXG4gICAgfSk7XG4gICAgdmFyIHpvb20gPSBvbC5hbmltYXRpb24uem9vbSh7XG4gICAgICBkdXJhdGlvbjogNTAwLFxuICAgICAgcmVzb2x1dGlvbjogdmlldy5nZXRSZXNvbHV0aW9uKClcbiAgICB9KTtcbiAgICB0aGlzLm1hcC5iZWZvcmVSZW5kZXIocGFuLHpvb20pO1xuICB9XG4gIFxuICB2aWV3LnNldENlbnRlcihjb29yZGluYXRlcyk7XG4gIHZpZXcuc2V0Wm9vbSh6b29tKTtcbn07XG5cbl9WaWV3ZXIucHJvdG90eXBlLmdvVG9SZXMgPSBmdW5jdGlvbihjb29yZGluYXRlcywgcmVzb2x1dGlvbil7XG4gIHZhciBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcbiAgdmFyIGFuaW1hdGUgPSBvcHRpb25zLmFuaW1hdGUgfHwgdHJ1ZTtcbiAgdmFyIHZpZXcgPSB0aGlzLm1hcC5nZXRWaWV3KCk7XG4gIFxuICBpZiAoYW5pbWF0ZSkge1xuICAgIHZhciBwYW4gPSBvbC5hbmltYXRpb24ucGFuKHtcbiAgICAgIGR1cmF0aW9uOiA1MDAsXG4gICAgICBzb3VyY2U6IHZpZXcuZ2V0Q2VudGVyKClcbiAgICB9KTtcbiAgICB2YXIgem9vbSA9IG9sLmFuaW1hdGlvbi56b29tKHtcbiAgICAgIGR1cmF0aW9uOiA1MDAsXG4gICAgICByZXNvbHV0aW9uOiB2aWV3LmdldFJlc29sdXRpb24oKVxuICAgIH0pO1xuICAgIHRoaXMubWFwLmJlZm9yZVJlbmRlcihwYW4sem9vbSk7XG4gIH1cblxuICB2aWV3LnNldENlbnRlcihjb29yZGluYXRlcyk7XG4gIHZpZXcuc2V0UmVzb2x1dGlvbihyZXNvbHV0aW9uKTtcbn07XG5cbl9WaWV3ZXIucHJvdG90eXBlLmZpdCA9IGZ1bmN0aW9uKGdlb21ldHJ5LCBvcHRpb25zKXtcbiAgdmFyIHZpZXcgPSB0aGlzLm1hcC5nZXRWaWV3KCk7XG4gIFxuICB2YXIgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307XG4gIHZhciBhbmltYXRlID0gb3B0aW9ucy5hbmltYXRlIHx8IHRydWU7XG4gIFxuICBpZiAoYW5pbWF0ZSkge1xuICAgIHZhciBwYW4gPSBvbC5hbmltYXRpb24ucGFuKHtcbiAgICAgIGR1cmF0aW9uOiA1MDAsXG4gICAgICBzb3VyY2U6IHZpZXcuZ2V0Q2VudGVyKClcbiAgICB9KTtcbiAgICB2YXIgem9vbSA9IG9sLmFuaW1hdGlvbi56b29tKHtcbiAgICAgIGR1cmF0aW9uOiA1MDAsXG4gICAgICByZXNvbHV0aW9uOiB2aWV3LmdldFJlc29sdXRpb24oKVxuICAgIH0pO1xuICAgIHRoaXMubWFwLmJlZm9yZVJlbmRlcihwYW4sem9vbSk7XG4gIH1cbiAgXG4gIGlmIChvcHRpb25zLmFuaW1hdGUpIHtcbiAgICBkZWxldGUgb3B0aW9ucy5hbmltYXRlOyAvLyBub24gbG8gcGFzc28gYWwgbWV0b2RvIGRpIE9MMyBwZXJjaMOpIMOoIHVuJ29wemlvbmUgaW50ZXJuYVxuICB9XG4gIG9wdGlvbnMuY29uc3RyYWluUmVzb2x1dGlvbiA9IG9wdGlvbnMuY29uc3RyYWluUmVzb2x1dGlvbiB8fCBmYWxzZTtcbiAgXG4gIHZpZXcuZml0KGdlb21ldHJ5LHRoaXMubWFwLmdldFNpemUoKSxvcHRpb25zKTtcbn07XG5cbl9WaWV3ZXIucHJvdG90eXBlLmdldFpvb20gPSBmdW5jdGlvbigpe1xuICB2YXIgdmlldyA9IHRoaXMubWFwLmdldFZpZXcoKTtcbiAgcmV0dXJuIHZpZXcuZ2V0Wm9vbSgpO1xufTtcblxuX1ZpZXdlci5wcm90b3R5cGUuZ2V0UmVzb2x1dGlvbiA9IGZ1bmN0aW9uKCl7XG4gIHZhciB2aWV3ID0gdGhpcy5tYXAuZ2V0VmlldygpO1xuICByZXR1cm4gdmlldy5nZXRSZXNvbHV0aW9uKCk7XG59O1xuXG5fVmlld2VyLnByb3RvdHlwZS5nZXRDZW50ZXIgPSBmdW5jdGlvbigpe1xuICB2YXIgdmlldyA9IHRoaXMubWFwLmdldFZpZXcoKTtcbiAgcmV0dXJuIHZpZXcuZ2V0Q2VudGVyKCk7XG59O1xuXG5fVmlld2VyLnByb3RvdHlwZS5nZXRCQk9YID0gZnVuY3Rpb24oKXtcbiAgcmV0dXJuIHRoaXMubWFwLmdldFZpZXcoKS5jYWxjdWxhdGVFeHRlbnQodGhpcy5tYXAuZ2V0U2l6ZSgpKTtcbn07XG5cbl9WaWV3ZXIucHJvdG90eXBlLmdldExheWVyQnlOYW1lID0gZnVuY3Rpb24obGF5ZXJOYW1lKSB7XG4gIHZhciBsYXllcnMgPSB0aGlzLm1hcC5nZXRMYXllcnMoKTtcbiAgdmFyIGxlbmd0aCA9IGxheWVycy5nZXRMZW5ndGgoKTtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgIGlmIChsYXllck5hbWUgPT09IGxheWVycy5pdGVtKGkpLmdldCgnbmFtZScpKSB7XG4gICAgICByZXR1cm4gbGF5ZXJzLml0ZW0oaSk7XG4gICAgfVxuICB9XG4gIHJldHVybiBudWxsO1xufTtcblxuX1ZpZXdlci5wcm90b3R5cGUucmVtb3ZlTGF5ZXJCeU5hbWUgPSBmdW5jdGlvbihsYXllck5hbWUpe1xuICB2YXIgbGF5ZXIgPSB0aGlzLmdldExheWVyQnlOYW1lKGxheWVyTmFtZSk7XG4gIGlmIChsYXllcil7XG4gICAgdGhpcy5tYXAucmVtb3ZlTGF5ZXIobGF5ZXIpO1xuICAgIGRlbGV0ZSBsYXllcjtcbiAgfVxufTtcblxuX1ZpZXdlci5wcm90b3R5cGUuZ2V0QWN0aXZlTGF5ZXJzID0gZnVuY3Rpb24oKXtcbiAgdmFyIGFjdGl2ZWxheWVycyA9IFtdO1xuICB0aGlzLm1hcC5nZXRMYXllcnMoKS5mb3JFYWNoKGZ1bmN0aW9uKGxheWVyKSB7XG4gICAgdmFyIHByb3BzID0gbGF5ZXIuZ2V0UHJvcGVydGllcygpO1xuICAgIGlmIChwcm9wcy5iYXNlbWFwICE9IHRydWUgJiYgcHJvcHMudmlzaWJsZSl7XG4gICAgICAgYWN0aXZlbGF5ZXJzLnB1c2gobGF5ZXIpO1xuICAgIH1cbiAgfSk7XG4gIFxuICByZXR1cm4gYWN0aXZlbGF5ZXJzO1xufTtcblxuX1ZpZXdlci5wcm90b3R5cGUucmVtb3ZlTGF5ZXJzID0gZnVuY3Rpb24oKXtcbiAgdGhpcy5tYXAuZ2V0TGF5ZXJzKCkuY2xlYXIoKTtcbn07XG5cbl9WaWV3ZXIucHJvdG90eXBlLmdldExheWVyc05vQmFzZSA9IGZ1bmN0aW9uKCl7XG4gIHZhciBsYXllcnMgPSBbXTtcbiAgdGhpcy5tYXAuZ2V0TGF5ZXJzKCkuZm9yRWFjaChmdW5jdGlvbihsYXllcikge1xuICAgIHZhciBwcm9wcyA9IGxheWVyLmdldFByb3BlcnRpZXMoKTtcbiAgICBpZiAocHJvcHMuYmFzZW1hcCAhPSB0cnVlKXtcbiAgICAgIGxheWVycy5wdXNoKGxheWVyKTtcbiAgICB9XG4gIH0pO1xuICBcbiAgcmV0dXJuIGxheWVycztcbn07XG5cbl9WaWV3ZXIucHJvdG90eXBlLmFkZEJhc2VMYXllciA9IGZ1bmN0aW9uKHR5cGUpe1xuICB2YXIgbGF5ZXI7XG4gIHR5cGUgPyBsYXllciA9IEJhc2VMYXllcnNbdHlwZV06ICBsYXllciA9IEJhc2VMYXllcnMuQklORy5BZXJpYWw7XG4gIHRoaXMubWFwLmFkZExheWVyKGxheWVyKTtcbn07XG5cbl9WaWV3ZXIucHJvdG90eXBlLmNoYW5nZUJhc2VMYXllciA9IGZ1bmN0aW9uKGxheWVyTmFtZSl7XG4gIHZhciBiYXNlTGF5ZXIgPSB0aGlzLmdldExheWVyQnlOYW1lKGxheWVybmFtZSk7XG4gIHZhciBsYXllcnMgPSB0aGlzLm1hcC5nZXRMYXllcnMoKTtcbiAgbGF5ZXJzLmluc2VydEF0KDAsIGJhc2VMYXllcik7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IE1hcEhlbHBlcnM7XG4iLCJ2YXIgdXRpbHMgPSB7XG4gIG1lcmdlOiBmdW5jdGlvbihvYmoxLG9iajIpe1xuICAgIHZhciBvYmozID0ge307XG4gICAgZm9yICh2YXIgYXR0cm5hbWUgaW4gb2JqMSkgeyBvYmozW2F0dHJuYW1lXSA9IG9iajFbYXR0cm5hbWVdOyB9XG4gICAgZm9yICh2YXIgYXR0cm5hbWUgaW4gb2JqMikgeyBvYmozW2F0dHJuYW1lXSA9IG9iajJbYXR0cm5hbWVdOyB9XG4gICAgcmV0dXJuIG9iajM7XG4gIH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSB1dGlscztcbiIsIm1vZHVsZS5leHBvcnRzID0gXCI8IS0tIGl0ZW0gdGVtcGxhdGUgLS0+XFxuPGRpdiBpZD1cXFwiY2F0YWxvZ1xcXCIgY2xhc3M9XFxcInRhYmJhYmxlLXBhbmVsIGNhdGFsb2dcXFwiPlxcbiAgPGRpdiBjbGFzcz1cXFwidGFiYmFibGUtbGluZVxcXCI+XFxuICAgIDx1bCBjbGFzcz1cXFwibmF2IG5hdi10YWJzXFxcIiByb2xlPVxcXCJ0YWJsaXN0XFxcIj5cXG4gICAgICA8bGkgcm9sZT1cXFwicHJlc2VudGF0aW9uXFxcIiBjbGFzcz1cXFwiYWN0aXZlXFxcIj48YSBocmVmPVxcXCIjdHJlZVxcXCIgYXJpYS1jb250cm9scz1cXFwidHJlZVxcXCIgcm9sZT1cXFwidGFiXFxcIiBkYXRhLXRvZ2dsZT1cXFwidGFiXFxcIiBkYXRhLWkxOG49XFxcInRyZWVcXFwiPkRhdGE8L2E+PC9saT5cXG4gICAgICA8bGkgdi1pZj1cXFwiaGFzQmFzZUxheWVyc1xcXCIgcm9sZT1cXFwicHJlc2VudGF0aW9uXFxcIj48YSBocmVmPVxcXCIjYmFzZWxheWVyc1xcXCIgYXJpYS1jb250cm9scz1cXFwiYmFzZWxheWVyc1xcXCIgcm9sZT1cXFwidGFiXFxcIiBkYXRhLXRvZ2dsZT1cXFwidGFiXFxcIiBkYXRhLWkxOG49XFxcImJhc2VsYXllcnNcXFwiPkxheWVyIEJhc2U8L2E+PC9saT5cXG4gICAgICA8bGkgcm9sZT1cXFwicHJlc2VudGF0aW9uXFxcIj48YSBocmVmPVxcXCIjbGVnZW5kXFxcIiBhcmlhLWNvbnRyb2xzPVxcXCJsZWdlbmRcXFwiIHJvbGU9XFxcInRhYlxcXCIgZGF0YS10b2dnbGU9XFxcInRhYlxcXCIgZGF0YS1pMThuPVxcXCJsZWdlbmRcXFwiPkxlZ2VuZGE8L2E+PC9saT5cXG4gICAgPC91bD5cXG4gICAgPGRpdiAgY2xhc3M9XFxcInRhYi1jb250ZW50XFxcIj5cXG4gICAgICA8ZGl2IHJvbGU9XFxcInRhYnBhbmVsXFxcIiBjbGFzcz1cXFwidGFiLXBhbmUgYWN0aXZlIHRyZWVcXFwiIGlkPVxcXCJ0cmVlXFxcIj5cXG4gICAgICAgIDx1bCBjbGFzcz1cXFwidHJlZS1yb290XFxcIj5cXG4gICAgICAgICAgPHRyaXN0YXRlLXRyZWUgdi1pZj1cXFwiIWlzSGlkZGVuXFxcIiA6bGF5ZXJzdHJlZT1cXFwibGF5ZXJzdHJlZVxcXCIgY2xhc3M9XFxcIml0ZW1cXFwiIHYtZm9yPVxcXCJsYXllcnN0cmVlIGluIGxheWVyc3RyZWVcXFwiPlxcbiAgICAgICAgICA8L3RyaXN0YXRlLXRyZWU+XFxuICAgICAgICA8L3VsPlxcbiAgICAgIDwvZGl2PlxcbiAgICAgIDxkaXYgdi1pZj1cXFwiaGFzQmFzZUxheWVyc1xcXCIgcm9sZT1cXFwidGFicGFuZWxcXFwiIGNsYXNzPVxcXCJ0YWItcGFuZSBiYXNlbGF5ZXJzXFxcIiBpZD1cXFwiYmFzZWxheWVyc1xcXCI+XFxuICAgICAgICA8Zm9ybT5cXG4gICAgICAgICAgPHVsPlxcbiAgICAgICAgICAgIDxsaSB2LWlmPVxcXCIhYmFzZWxheWVyLmZpeGVkXFxcIiB2LWZvcj1cXFwiYmFzZWxheWVyIGluIGJhc2VsYXllcnNcXFwiPlxcbiAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cXFwicmFkaW9cXFwiPlxcbiAgICAgICAgICAgICAgICA8bGFiZWw+PGlucHV0IHR5cGU9XFxcInJhZGlvXFxcIiBuYW1lPVxcXCJiYXNlbGF5ZXJcXFwiIHYtY2hlY2tlZD1cXFwiYmFzZWxheWVyLnZpc2libGVcXFwiIEBjbGljaz1cXFwic2V0QmFzZUxheWVyKGJhc2VsYXllci5pZClcXFwiPnt7IGJhc2VsYXllci50aXRsZSB9fTwvbGFiZWw+XFxuICAgICAgICAgICAgICA8L2Rpdj5cXG4gICAgICAgICAgICA8L2xpPlxcbiAgICAgICAgICA8L3VsPlxcbiAgICAgICAgPC9mb3JtPlxcbiAgICAgIDwvZGl2PlxcbiAgICAgIDxsZWdlbmQgOmxheWVyc3RyZWU9XFxcImxheWVyc3RyZWVcXFwiPjwvbGVnZW5kPlxcbiAgICA8L2Rpdj5cXG4gIDwvZGl2PlxcbjwvZGl2PlxcblwiO1xuIiwidmFyIGluaGVyaXQgPSByZXF1aXJlKCdjb3JlL3V0aWxzL3V0aWxzJykuaW5oZXJpdDtcbnZhciBiYXNlID0gcmVxdWlyZSgnY29yZS91dGlscy91dGlscycpLmJhc2U7XG52YXIgbWVyZ2UgPSByZXF1aXJlKCdjb3JlL3V0aWxzL3V0aWxzJykubWVyZ2U7XG52YXIgdCA9IHJlcXVpcmUoJ2NvcmUvaTE4bi9pMThuLnNlcnZpY2UnKS50O1xudmFyIHJlc29sdmUgPSByZXF1aXJlKCdjb3JlL3V0aWxzL3V0aWxzJykucmVzb2x2ZTtcbnZhciBDb21wb25lbnQgPSByZXF1aXJlKCdndWkvdnVlL2NvbXBvbmVudCcpO1xudmFyIEdVSSA9IHJlcXVpcmUoJ2d1aS9ndWknKTtcbnZhciBQcm9qZWN0c1JlZ2lzdHJ5ID0gcmVxdWlyZSgnY29yZS9wcm9qZWN0L3Byb2plY3RzcmVnaXN0cnknKTtcblxudmFyIHZ1ZUNvbXBvbmVudE9wdGlvbnMgPSB7XG4gIHRlbXBsYXRlOiByZXF1aXJlKCcuL2NhdGFsb2cuaHRtbCcpLFxuICBkYXRhOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4ge1xuICAgICAgcHJvamVjdDogUHJvamVjdHNSZWdpc3RyeS5nZXRDdXJyZW50UHJvamVjdCgpXG4gICAgfVxuICB9LFxuICBjb21wdXRlZDoge1xuICAgIGxheWVyc3RyZWU6IGZ1bmN0aW9uKCl7XG4gICAgICByZXR1cm4gdGhpcy5wcm9qZWN0LnN0YXRlLmxheWVyc3RyZWU7XG4gICAgfSxcbiAgICBiYXNlbGF5ZXJzOiBmdW5jdGlvbigpe1xuICAgICAgcmV0dXJuIHRoaXMucHJvamVjdC5zdGF0ZS5iYXNlbGF5ZXJzO1xuICAgIH0sXG4gICAgaGFzQmFzZUxheWVyczogZnVuY3Rpb24oKXtcbiAgICAgIHJldHVybiB0aGlzLnByb2plY3Quc3RhdGUuYmFzZWxheWVycy5sZW5ndGg+MDtcbiAgICB9XG4gIH0sXG4gIG1ldGhvZHM6IHtcbiAgICBzZXRCYXNlTGF5ZXI6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICB0aGlzLnByb2plY3Quc2V0QmFzZUxheWVyKGlkKTtcbiAgICB9XG4gIH0sXG4gIHJlYWR5OiBmdW5jdGlvbigpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgdGhpcy4kb24oJ3RyZWVub2RldG9vZ2xlZCcsZnVuY3Rpb24obm9kZSl7XG4gICAgICBzZWxmLnByb2plY3QudG9nZ2xlTGF5ZXIobm9kZSk7XG4gICAgfSk7XG5cbiAgICB0aGlzLiRvbigndHJlZW5vZGVzdG9vZ2xlZCcsZnVuY3Rpb24obm9kZXMscGFyZW50Q2hlY2tlZCl7XG4gICAgICBzZWxmLnByb2plY3QudG9nZ2xlTGF5ZXJzKG5vZGVzLHBhcmVudENoZWNrZWQpO1xuICAgIH0pO1xuICAgIFxuICAgIHRoaXMuJG9uKCd0cmVlbm9kZXNlbGVjdGVkJyxmdW5jdGlvbihub2RlKXtcbiAgICAgIGlmICghbm9kZS5zZWxlY3RlZCkge1xuICAgICAgICBzZWxmLnByb2plY3Quc2VsZWN0TGF5ZXIobm9kZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBzZWxmLnByb2plY3QudW5zZWxlY3RMYXllcihub2RlKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxufVxuXG4vLyBzZSBsbyB2b2dsaW8gaXN0YW56aWFyZSBtYW51YWxtZW50ZVxudmFyIEludGVybmFsQ29tcG9uZW50ID0gVnVlLmV4dGVuZCh2dWVDb21wb25lbnRPcHRpb25zKTtcblxuLy8gc2UgbG8gdm9nbGlvIHVzYXJlIGNvbWUgY29tcG9uZW50ZSBjb21lIGVsZW1lbnRvIGh0bWxcblZ1ZS5jb21wb25lbnQoJ2czdy1jYXRhbG9nJywgdnVlQ29tcG9uZW50T3B0aW9ucyk7XG5cblxuLyogQ09NUE9ORU5USSBGSUdMSSAqL1xuXG4vLyB0cmVlIGNvbXBvbmVudFxuXG5cblZ1ZS5jb21wb25lbnQoJ3RyaXN0YXRlLXRyZWUnLCB7XG4gIHRlbXBsYXRlOiByZXF1aXJlKCcuL3RyaXN0YXRlLXRyZWUuaHRtbCcpLFxuICBwcm9wczoge1xuICAgIGxheWVyc3RyZWU6IFtdLFxuICAgIC8vZXJlZGl0byBpbCBudW1lcm8gZGkgY2hpbGRzIGRhbCBwYXJlbnRcbiAgICBuX3BhcmVudENoaWxkcyA6IDAsXG4gICAgY2hlY2tlZDogZmFsc2VcbiAgfSxcbiAgZGF0YTogZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB7XG4gICAgICBleHBhbmRlZDogdGhpcy5sYXllcnN0cmVlLmV4cGFuZGVkLFxuICAgICAgcGFyZW50Q2hlY2tlZDogZmFsc2UsXG4gICAgICAvL3Byb3ByaWV0YSBjaGUgc2VydmUgcGVyIGZhcmUgY29uZnJvbnRvIHBlciBpbCB0cmlzdGF0ZVxuICAgICAgbl9jaGlsZHM6IHRoaXMubGF5ZXJzdHJlZS5ub2RlcyA/IHRoaXMubGF5ZXJzdHJlZS5ub2Rlcy5sZW5ndGggOiAwXG4gICAgfVxuICB9LFxuICB3YXRjaDoge1xuICAgICAgJ2NoZWNrZWQnOiBmdW5jdGlvbiAodmFsKXtcbiAgICAgICAgdGhpcy5sYXllcnN0cmVlLnZpc2libGUgPSB2YWw7XG4gICAgICB9XG4gIH0sXG4gIGNvbXB1dGVkOiB7XG4gICAgaXNGb2xkZXI6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBpc0ZvbGRlciA9IHRoaXMubl9jaGlsZHMgPyB0cnVlIDogZmFsc2U7XG4gICAgICBpZiAoaXNGb2xkZXIpIHtcbiAgICAgICAgdmFyIF92aXNpYmxlQ2hpbGRzID0gMDtcbiAgICAgICAgXy5mb3JFYWNoKHRoaXMubGF5ZXJzdHJlZS5ub2RlcyxmdW5jdGlvbihsYXllcil7XG4gICAgICAgICAgaWYgKGxheWVyLnZpc2libGUpe1xuICAgICAgICAgICAgX3Zpc2libGVDaGlsZHMgKz0gMTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLm5fcGFyZW50Q2hpbGRzID0gdGhpcy5uX2NoaWxkcyAtIF92aXNpYmxlQ2hpbGRzO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGlzRm9sZGVyXG4gICAgfSxcbiAgICBpc0hpZGRlbjogZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gdGhpcy5sYXllcnN0cmVlLmhpZGRlbiAmJiAodGhpcy5sYXllcnN0cmVlLmhpZGRlbiA9PT0gdHJ1ZSk7XG4gICAgfSxcbiAgICBzZWxlY3RlZDogZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgaXNTZWxlY3RlZCA9IHRoaXMubGF5ZXJzdHJlZS5zZWxlY3RlZCA/IFwiU0lcIiA6IFwiTk9cIjtcbiAgICAgIGNvbnNvbGUubG9nKGlzU2VsZWN0ZWQpO1xuICAgICAgcmV0dXJuIGlzU2VsZWN0ZWQ7XG4gICAgfVxuICB9LFxuICBtZXRob2RzOiB7XG4gICAgdG9nZ2xlOiBmdW5jdGlvbiAoY2hlY2tBbGxMYXllcnMpIHtcbiAgICAgIHZhciBjaGVja0FsbCA9IGNoZWNrQWxsTGF5ZXJzID09ICd0cnVlJyA/IHRydWUgOiBmYWxzZTtcbiAgICAgIGlmICh0aGlzLmlzRm9sZGVyICYmICFjaGVja0FsbCkge1xuICAgICAgICB0aGlzLmxheWVyc3RyZWUuZXhwYW5kZWQgPSAhdGhpcy5sYXllcnN0cmVlLmV4cGFuZGVkO1xuICAgICAgfVxuICAgICAgZWxzZSBpZiAoY2hlY2tBbGwpe1xuICAgICAgICBpZiAodGhpcy5wYXJlbnRDaGVja2VkICYmICF0aGlzLm5fcGFyZW50Q2hpbGRzKXtcbiAgICAgICAgICB0aGlzLnBhcmVudENoZWNrZWQgPSBmYWxzZTtcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLnBhcmVudENoZWNrZWQgJiYgdGhpcy5uX3BhcmVudENoaWxkcykge1xuICAgICAgICAgIHRoaXMucGFyZW50Q2hlY2tlZCA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgdGhpcy5wYXJlbnRDaGVja2VkID0gIXRoaXMucGFyZW50Q2hlY2tlZDtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLiRkaXNwYXRjaCgndHJlZW5vZGVzdG9vZ2xlZCcsdGhpcy5sYXllcnN0cmVlLm5vZGVzLHRoaXMucGFyZW50Q2hlY2tlZCk7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgdGhpcy4kZGlzcGF0Y2goJ3RyZWVub2RldG9vZ2xlZCcsdGhpcy5sYXllcnN0cmVlKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIHNlbGVjdDogZnVuY3Rpb24gKCkge1xuICAgICAgaWYgKCF0aGlzLmlzRm9sZGVyKSB7XG4gICAgICAgIHRoaXMuJGRpc3BhdGNoKCd0cmVlbm9kZXNlbGVjdGVkJyx0aGlzLmxheWVyc3RyZWUpO1xuICAgICAgfVxuICAgIH0sXG4gICAgdHJpQ2xhc3M6IGZ1bmN0aW9uICgpIHtcbiAgICAgIGlmICghdGhpcy5uX3BhcmVudENoaWxkcykge1xuICAgICAgICByZXR1cm4gJ2ZhLWNoZWNrLXNxdWFyZS1vJztcbiAgICAgIH0gZWxzZSBpZiAoKHRoaXMubl9wYXJlbnRDaGlsZHMgPiAwKSAmJiAodGhpcy5uX3BhcmVudENoaWxkcyA8IHRoaXMubl9jaGlsZHMpKSB7XG4gICAgICAgIHJldHVybiAnZmEtc3F1YXJlJztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiAnZmEtc3F1YXJlLW8nO1xuICAgICAgfVxuICAgIH1cbiAgfVxufSlcblxuVnVlLmNvbXBvbmVudCgnbGVnZW5kJyx7XG4gICAgdGVtcGxhdGU6IHJlcXVpcmUoJy4vbGVnZW5kLmh0bWwnKSxcbiAgICBwcm9wczogWydsYXllcnN0cmVlJ10sXG4gICAgZGF0YTogZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICAvL2RhdGEgcXVpXG4gICAgICB9XG4gICAgfSxcbiAgICBjb21wdXRlZDoge1xuICAgICAgdmlzaWJsZWxheWVyczogZnVuY3Rpb24oKXtcbiAgICAgICAgdmFyIF92aXNpYmxlbGF5ZXJzID0gW107XG4gICAgICAgIHZhciBsYXllcnN0cmVlID0gdGhpcy5sYXllcnN0cmVlO1xuICAgICAgICBmdW5jdGlvbiB0cmF2ZXJzZShvYmope1xuICAgICAgICBfLmZvckluKG9iaiwgZnVuY3Rpb24gKGxheWVyLCBrZXkpIHtcbiAgICAgICAgICAgICAgLy92ZXJpZmljYSBjaGUgaWwgdmFsb3JlIGRlbGwnaWQgbm9uIHNpYSBudWxsb1xuICAgICAgICAgICAgICBpZiAoIV8uaXNOaWwobGF5ZXIuaWQpICYmIGxheWVyLnZpc2libGUpIHtcbiAgICAgICAgICAgICAgICAgIF92aXNpYmxlbGF5ZXJzLnB1c2gobGF5ZXIpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGlmICghXy5pc05pbChsYXllci5ub2RlcykpIHtcbiAgICAgICAgICAgICAgICAgIHRyYXZlcnNlKGxheWVyLm5vZGVzKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIHRyYXZlcnNlKGxheWVyc3RyZWUpO1xuICAgICAgICByZXR1cm4gX3Zpc2libGVsYXllcnM7XG4gICAgICB9XG4gICAgfSxcbiAgICB3YXRjaDoge1xuICAgICAgJ2xheWVyc3RyZWUnOiB7XG4gICAgICAgIGhhbmRsZXI6IGZ1bmN0aW9uKHZhbCwgb2xkKXtcbiAgICAgICAgICAvL2NvZGljZSBxdWlcbiAgICAgICAgfSxcbiAgICAgICAgZGVlcDogdHJ1ZVxuICAgICAgfVxuICAgIH0sXG4gICAgcmVhZHk6IGZ1bmN0aW9uKCkge1xuICAgICAgLy9jb2RpY2UgcXVpXG4gICAgfVxufSk7XG5cblZ1ZS5jb21wb25lbnQoJ2xlZ2VuZC1pdGVtJyx7XG4gIHRlbXBsYXRlOiByZXF1aXJlKCcuL2xlZ2VuZF9pdGVtLmh0bWwnKSxcbiAgcHJvcHM6IFsnbGF5ZXInXSxcbiAgY29tcHV0ZWQ6IHtcbiAgICBsZWdlbmR1cmw6IGZ1bmN0aW9uKCl7XG4gICAgICAvLyBpbiBhdHRlc2EgZGkgcmlzb2x2ZXJlIGxvIHNjaGlhbnRvIGRpIFFHU0kgU2VydmVyLi4uXG4gICAgICAvL3JldHVybiBcImh0dHA6Ly9sb2NhbGhvc3QvY2dpLWJpbi9xZ2lzX21hcHNlcnYuZmNnaT9tYXA9L2hvbWUvZ2lvaGFwcHkvU2NyaXZhbmlhL0Rldi9HM1cvZzN3LWNsaWVudC90ZXN0L3Byb2dldHRvL3Rlc3QucWdzJlNFUlZJQ0U9V01TJlZFUlNJT049MS4zLjAmUkVRVUVTVD1HZXRMZWdlbmRHcmFwaGljJkZPUk1BVD1pbWFnZS9wbmcmTEFZRVJUSVRMRT1GYWxzZSZJVEVNRk9OVFNJWkU9MTAmTEFZRVI9XCIrdGhpcy5sYXllci5uYW1lO1xuICAgICAgcmV0dXJuIFByb2plY3RzUmVnaXN0cnkuZ2V0Q3VycmVudFByb2plY3QoKS5nZXRMZWdlbmRVcmwodGhpcy5sYXllcik7XG4gICAgfVxuICB9LFxuICBtZXRob2RzOiB7XG4gICAgLy8gZXNlbXBpbyB1dGlsaXp6byBkZWwgc2Vydml6aW8gR1VJXG4gICAgb3BlbmZvcm06IGZ1bmN0aW9uKCl7XG4gICAgICAvL0dVSS5ub3RpZnkuc3VjY2VzcyhcIkFwcm8gdW4gZm9ybVwiKTtcbiAgICAgIC8vR1VJLnNob3dGb3JtKCk7XG4gICAgfVxuICB9XG59KTtcblxuLyogRklORSBDT01QT05FTlRJIEZJR0xJICovXG5cbi8qIElOVEVSRkFDQ0lBIFBVQkJMSUNBICovXG5mdW5jdGlvbiBDYXRhbG9nQ29tcG9uZW50KG9wdGlvbnMpe1xuICBiYXNlKHRoaXMpO1xuICB0aGlzLmlkID0gXCJjYXRhbG9nLWNvbXBvbmVudFwiO1xuICB0aGlzLnRpdGxlID0gXCJjYXRhbG9nXCI7XG4gIHRoaXMuaW50ZXJuYWxDb21wb25lbnQgPSBuZXcgSW50ZXJuYWxDb21wb25lbnQ7XG4gIC8vbWVyZ2lvIG9wemlvbmkgY29uIHByb3ByaXTDoCBkaSBkZWZhdWx0IGRlbCBjb21wb25lbnRlXG4gIG1lcmdlKHRoaXMsIG9wdGlvbnMpO1xufVxuXG5pbmhlcml0KENhdGFsb2dDb21wb25lbnQsIENvbXBvbmVudCk7XG5cbm1vZHVsZS5leHBvcnRzID0gQ2F0YWxvZ0NvbXBvbmVudDtcbiIsIm1vZHVsZS5leHBvcnRzID0gXCI8ZGl2IHJvbGU9XFxcInRhYnBhbmVsXFxcIiBjbGFzcz1cXFwidGFiLXBhbmVcXFwiIGlkPVxcXCJsZWdlbmRcXFwiPlxcbiAgPGxlZ2VuZC1pdGVtIDpsYXllcj1cXFwibGF5ZXJcXFwiIHYtZm9yPVxcXCJsYXllciBpbiB2aXNpYmxlbGF5ZXJzXFxcIj48L2xlZ2VuZC1pdGVtPlxcbjwvZGl2PlxcblwiO1xuIiwibW9kdWxlLmV4cG9ydHMgPSBcIjxkaXYgQGNsaWNrPVxcXCJvcGVuZm9ybSgpXFxcIj57eyBsYXllci50aXRsZSB9fTwvZGl2PlxcbjxkaXY+PGltZyA6c3JjPVxcXCJsZWdlbmR1cmxcXFwiPjwvZGl2PlxcblwiO1xuIiwibW9kdWxlLmV4cG9ydHMgPSBcIjxsaSBjbGFzcz1cXFwidHJlZS1pdGVtXFxcIiA6Y2xhc3M9XFxcIntzZWxlY3RlZDogbGF5ZXJzdHJlZS5zZWxlY3RlZH1cXFwiPlxcbiAgPHNwYW4gOmNsYXNzPVxcXCJ7Ym9sZDogaXNGb2xkZXIsICdmYS1jaGV2cm9uLWRvd24nOiBsYXllcnN0cmVlLmV4cGFuZGVkLCAnZmEtY2hldnJvbi1yaWdodCc6ICFsYXllcnN0cmVlLmV4cGFuZGVkfVxcXCIgQGNsaWNrPVxcXCJ0b2dnbGVcXFwiIHYtaWY9XFxcImlzRm9sZGVyXFxcIiBjbGFzcz1cXFwiZmFcXFwiPjwvc3Bhbj5cXG4gIDxzcGFuIHYtaWY9XFxcImlzRm9sZGVyXFxcIiBAY2xpY2s9XFxcInRvZ2dsZSgndHJ1ZScpXFxcIiA6Y2xhc3M9XFxcIlt0cmlDbGFzcygpXVxcXCIgY2xhc3M9XFxcImZhXFxcIj48L3NwYW4+XFxuICA8c3BhbiB2LWVsc2UgQGNsaWNrPVxcXCJ0b2dnbGVcXFwiIDpjbGFzcz1cXFwiW2xheWVyc3RyZWUudmlzaWJsZSAgPyAnZmEtY2hlY2stc3F1YXJlLW8nOiAnZmEtc3F1YXJlLW8nLGxheWVyc3RyZWUuZGlzYWJsZWQgID8gJ2Rpc2FibGVkJzogJyddXFxcIiBjbGFzcz1cXFwiZmFcXFwiIHN0eWxlPVxcXCJjdXJzb3I6ZGVmYXVsdFxcXCI+PC9zcGFuPlxcbiAgPHNwYW4gaWQ9XFxcInRyZWUtbm9kZS10aXRsZVxcXCIgOmNsYXNzPVxcXCJ7Ym9sZDogaXNGb2xkZXIsIGRpc2FibGVkOiBsYXllcnN0cmVlLmRpc2FibGVkfVxcXCIgQGNsaWNrPVxcXCJzZWxlY3RcXFwiPnt7bGF5ZXJzdHJlZS50aXRsZX19PC9zcGFuPlxcbiAgPHVsIHYtc2hvdz1cXFwibGF5ZXJzdHJlZS5leHBhbmRlZFxcXCIgdi1pZj1cXFwiaXNGb2xkZXJcXFwiPlxcbiAgICA8dHJpc3RhdGUtdHJlZSA6bl9wYXJlbnQtY2hpbGRzLnN5bmM9XFxcIm5fcGFyZW50Q2hpbGRzXFxcIiA6bGF5ZXJzdHJlZT1cXFwibGF5ZXJzdHJlZVxcXCIgOmNoZWNrZWQ9XFxcInBhcmVudENoZWNrZWRcXFwiIHYtZm9yPVxcXCJsYXllcnN0cmVlIGluIGxheWVyc3RyZWUubm9kZXNcXFwiPlxcbiAgICA8L3RyaXN0YXRlLXRyZWU+XFxuICA8L3VsPlxcbjwvbGk+XFxuXFxuXFxuXFxuXFxuXCI7XG4iLCJ2YXIgaW5oZXJpdCA9IHJlcXVpcmUoJ2NvcmUvdXRpbHMvdXRpbHMnKS5pbmhlcml0O1xudmFyIEczV09iamVjdCA9IHJlcXVpcmUoJ2NvcmUvZzN3b2JqZWN0Jyk7XG5cbnZhciBDb21wb25lbnQgPSBmdW5jdGlvbihvcHRpb25zKSB7XG4gIHZhciBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcbiAgdGhpcy5pbnRlcm5hbENvbXBvbmVudCA9IG51bGw7XG4gIHRoaXMuaWQgPSBvcHRpb25zLmlkIHx8IE1hdGgucmFuZG9tKCkgKiAxMDAwO1xuICB0aGlzLnRpdGxlID0gb3B0aW9ucy50aXRsZSB8fCAnJ1xuICB0aGlzLnN0YXRlID0ge1xuICAgIHZpc2libGU6IG9wdGlvbnMudmlzaWJsZSB8fCB0cnVlLFxuICAgIG9wZW46IG9wdGlvbnMub3BlbiB8fCBmYWxzZVxuICB9XG59O1xuaW5oZXJpdChDb21wb25lbnQsRzNXT2JqZWN0KTtcblxudmFyIHByb3RvID0gQ29tcG9uZW50LnByb3RvdHlwZTtcblxucHJvdG8uZ2V0SWQgPSBmdW5jdGlvbigpe1xuICByZXR1cm4gdGhpcy5pZDtcbn07XG5cbnByb3RvLmdldFRpdGxlID0gZnVuY3Rpb24oKXtcbiAgcmV0dXJuIHRoaXMuc3RhdGUudGl0bGU7XG59O1xuXG5wcm90by5zZXRUaXRsZSA9IGZ1bmN0aW9uKHRpdGxlKSB7XG4gIHRoaXMuc3RhdGUudGl0bGUgPSB0aXRsZTtcbn07XG5cbi8vaW1wbGVtZW50YXRpIGR1ZSBtZXRvZGkgcGVyIHBvdGVyIHVuaWZpY2FyZSBpbCBtZXRvZG8gZGkgcmVjdXBlcm8gZGVsIHNlcnZpemlvXG4vL2xlZ2F0byBhbCBjb21wb25lbnRlXG5cbnByb3RvLmdldFNlcnZpY2UgPSBmdW5jdGlvbigpIHtcbiAgcmV0dXJuIHRoaXMuX3NlcnZpY2U7XG59O1xuXG5wcm90by5zZXRTZXJ2aWNlID0gZnVuY3Rpb24oc2VydmljZUluc3RhbmNlKSB7XG4gIHRoaXMuX3NlcnZpY2UgPSBzZXJ2aWNlSW5zdGFuY2U7XG59O1xuXG4vLy8vLy8vLy8vIGZpbmUgbWV0b2RpIFNlcnZpY2UgQ29tcG9uZW50cyAvLy8vLy8vLy8vXG5cbi8qIEhPT0tTICovXG5cbi8qIFxuICogSWwgbWV0b2RvIHBlcm1ldHRlIGFsIGNvbXBvbmVudGUgZGkgbW9udGFyc2kgbmVsIERPTVxuICogcGFyZW50RWw6IGVsZW1lbnRvIERPTSBwYWRyZSwgc3UgY3VpIGluc2VyaXJzaTsgXG4gKiByaXRvcm5hIHVuYSBwcm9taXNlLCByaXNvbHRhIG5lbCBtb21lbnRvIGluIGN1aSBzYXLDoCB0ZXJtaW5hdG8gaWwgbW9udGFnZ2lvXG4qL1xucHJvdG8ubW91bnQgPSBmdW5jdGlvbihwYXJlbnQpe307XG5cbi8qXG4gKiBNZXRvZG8gcmljaGlhbWF0byBxdWFuZG8gc2kgdnVvbGUgcmltdW92ZXJlIGlsIGNvbXBvbmVudGUuXG4gKiBSaXRvcm5hIHVuYSBwcm9tZXNzYSBjaGUgc2Fyw6Agcmlzb2x0YSBuZWwgbW9tZW50byBpbiBjdWkgaWwgY29tcG9uZW50ZSBhdnLDoCBjb21wbGV0YXRvIGxhIHByb3ByaWEgcmltb3ppb25lIChlZCBldmVudHVhbGUgcmlsYXNjaW8gZGkgcmlzb3JzZSBkaXBlbmRlbnRpKVxuKi9cbnByb3RvLnVubW91bnQgPSBmdW5jdGlvbigpe307XG5cbi8qIFxuICogTWV0b2RvIChvcHppb25hbGUpIGNoZSBvZmZyZSBsJ29wcG9ydHVuaXTDoCBkaSByaWNhbGNvbGFyZSBwcm9wcmlldMOgIGRpcGVuZGVudGkgZGFsbGUgZGltZW5zaW9uaSBkZWwgcGFkcmVcbiAqIHBhcmVudEhlaWdodDogbnVvdmEgYWx0ZXp6YSBkZWwgcGFyZW50XG4gKiBwYXJlbnRXaWR0aDogbnVvdmEgbGFyZ2hlenphIGRlbCBwYXJlbnRcbiAqIHJpY2hpYW1hdG8gb2duaSB2b2x0YSBjaGUgaWwgcGFyZW50IHN1YmlzY2UgdW4gcmlkaW1lbnNpb25hbWVudG9cbiovXG5wcm90by5sYXlvdXQgPSBmdW5jdGlvbihwYXJlbnRXaWR0aCxwYXJlbnRIZWlnaHQpe307XG5cblxubW9kdWxlLmV4cG9ydHMgPSBDb21wb25lbnQ7XG4iLCJ2YXIgRzNXT2JqZWN0ID0gcmVxdWlyZSgnY29yZS9nM3dvYmplY3QnKTtcbnZhciBpbmhlcml0ID0gcmVxdWlyZSgnY29yZS91dGlscy91dGlscycpLmluaGVyaXQ7XG52YXIgYmFzZSA9IHJlcXVpcmUoJ2NvcmUvdXRpbHMvdXRpbHMnKS5iYXNlO1xuXG5mdW5jdGlvbiBDb21wb25lbnRzUmVnaXN0cnkoKSB7XG4gIHRoaXMuY29tcG9uZW50cyA9IHt9O1xuICBcbiAgdGhpcy5yZWdpc3RlckNvbXBvbmVudCA9IGZ1bmN0aW9uKGNvbXBvbmVudCkge1xuICAgIHZhciBpZCA9IGNvbXBvbmVudC5nZXRJZCgpO1xuICAgIGlmICghdGhpcy5jb21wb25lbnRzW2lkXSkge1xuICAgICAgdGhpcy5jb21wb25lbnRzW2lkXSA9IGNvbXBvbmVudDtcbiAgICB9XG4gIH07IFxuICBcbiAgdGhpcy5nZXRDb21wb25lbnQgPSBmdW5jdGlvbihpZCkge1xuICAgIHJldHVybiB0aGlzLmNvbXBvbmVudHNbaWRdO1xuICB9O1xuICBcbiAgdGhpcy51bnJlZ2lzdGVyQ29tcG9uZW50ID0gZnVuY3Rpb24oaWQpIHtcbiAgICB2YXIgY29tcG9uZW50ID0gdGhpcy5fY29tcG9uZW50c1tpZF07XG4gICAgaWYgKGNvbXBvbmVudCkge1xuICAgICAgaWYgKF8uaXNGdW5jdGlvbihjb21wb25lbnQuZGVzdHJveSkpIHtcbiAgICAgICAgY29tcG9uZW50LmRlc3Ryb3koKTtcbiAgICAgIH1cbiAgICAgIGRlbGV0ZSBjb21wb25lbnQ7XG4gICAgICB0aGlzLl9jb21wb25lbnRzW2lkXSA9IG51bGw7XG4gICAgfVxuICB9O1xufVxuaW5oZXJpdChDb21wb25lbnRzUmVnaXN0cnksRzNXT2JqZWN0KTtcblxubW9kdWxlLmV4cG9ydHMgPSBuZXcgQ29tcG9uZW50c1JlZ2lzdHJ5O1xuIiwidmFyIGluaGVyaXQgPSByZXF1aXJlKCdjb3JlL3V0aWxzL3V0aWxzJykuaW5oZXJpdDtcbnZhciByZXNvbHZlID0gcmVxdWlyZSgnY29yZS91dGlscy91dGlscycpLnJlc29sdmU7XG52YXIgcmVqZWN0ID0gcmVxdWlyZSgnY29yZS91dGlscy91dGlscycpLnJlamVjdDtcbnZhciBHVUkgPSByZXF1aXJlKCdndWkvZ3VpJyk7XG52YXIgUGFuZWwgPSAgcmVxdWlyZSgnZ3VpL3BhbmVsJyk7XG52YXIgUHJvamVjdHNSZWdpc3RyeSA9IHJlcXVpcmUoJ2NvcmUvcHJvamVjdC9wcm9qZWN0c3JlZ2lzdHJ5Jyk7XG5cblZ1ZS5maWx0ZXIoJ3N0YXJ0Y2FzZScsIGZ1bmN0aW9uICh2YWx1ZSkge1xuICByZXR1cm4gXy5zdGFydENhc2UodmFsdWUpO1xufSk7XG5cblZ1ZS52YWxpZGF0b3IoJ2VtYWlsJywgZnVuY3Rpb24gKHZhbCkge1xuICByZXR1cm4gL14oKFtePD4oKVtcXF1cXFxcLiw7Olxcc0BcXFwiXSsoXFwuW148PigpW1xcXVxcXFwuLDs6XFxzQFxcXCJdKykqKXwoXFxcIi4rXFxcIikpQCgoXFxbWzAtOV17MSwzfVxcLlswLTldezEsM31cXC5bMC05XXsxLDN9XFwuWzAtOV17MSwzfVxcXSl8KChbYS16QS1aXFwtMC05XStcXC4pK1thLXpBLVpdezIsfSkpJC8udGVzdCh2YWwpXG59KTtcblxuVnVlLnZhbGlkYXRvcignaW50ZWdlcicsIGZ1bmN0aW9uICh2YWwpIHtcbiAgcmV0dXJuIC9eKC0/WzEtOV1cXGQqfDApJC8udGVzdCh2YWwpO1xufSlcblxudmFyIEZvcm1QYW5lbCA9IFZ1ZS5leHRlbmQoe1xuICB0ZW1wbGF0ZTogcmVxdWlyZSgnLi9mb3JtcGFuZWwuaHRtbCcpLFxuICBtZXRob2RzOiB7XG4gICAgZXhlYzogZnVuY3Rpb24oY2JrKXtcbiAgICAgIHZhciByZWxhdGlvbnMgPSB0aGlzLnN0YXRlLnJlbGF0aW9ucyB8fCBudWxsO1xuICAgICAgY2JrKHRoaXMuc3RhdGUuZmllbGRzLHJlbGF0aW9ucyk7XG4gICAgICBHVUkuY2xvc2VGb3JtKCk7XG4gICAgfSxcbiAgICBidG5FbmFibGVkOiBmdW5jdGlvbihidXR0b24pIHtcbiAgICAgIHJldHVybiBidXR0b24udHlwZSAhPSAnc2F2ZScgfHwgKGJ1dHRvbi50eXBlID09ICdzYXZlJyAmJiB0aGlzLiR2YWxpZGF0aW9uLnZhbGlkKTtcbiAgICB9LFxuICAgIGhhc0ZpZWxkc1JlcXVpcmVkOiBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiB0aGlzLiRvcHRpb25zLmZvcm0uX2hhc0ZpZWxkc1JlcXVpcmVkKCk7XG4gICAgfSxcbiAgICBpc0VkaXRhYmxlOiBmdW5jdGlvbihmaWVsZCl7XG4gICAgICByZXR1cm4gdGhpcy4kb3B0aW9ucy5mb3JtLl9pc0VkaXRhYmxlKGZpZWxkKTtcbiAgICB9LFxuICAgIGlzU2ltcGxlOiBmdW5jdGlvbihmaWVsZCl7XG4gICAgICByZXR1cm4gdGhpcy4kb3B0aW9ucy5mb3JtLl9pc1NpbXBsZShmaWVsZCk7XG4gICAgfSxcbiAgICBpc1NlbGVjdDogZnVuY3Rpb24oZmllbGQpe1xuICAgICAgcmV0dXJuIHRoaXMuJG9wdGlvbnMuZm9ybS5faXNTZWxlY3QoZmllbGQpO1xuICAgIH0sXG4gICAgaXNMYXllclBpY2tlcjogZnVuY3Rpb24oZmllbGQpe1xuICAgICAgcmV0dXJuIHRoaXMuJG9wdGlvbnMuZm9ybS5faXNMYXllclBpY2tlcihmaWVsZCk7XG4gICAgfSxcbiAgICBsYXllclBpY2tlclBsYWNlSG9sZGVyOiBmdW5jdGlvbihmaWVsZCl7XG4gICAgICByZXR1cm4gdGhpcy4kb3B0aW9ucy5mb3JtLl9nZXRsYXllclBpY2tlckxheWVyTmFtZShmaWVsZC5pbnB1dC5vcHRpb25zLmxheWVyaWQpO1xuICAgIH0sXG4gICAgcGlja0xheWVyOiBmdW5jdGlvbihmaWVsZCl7XG4gICAgICB0aGlzLiRvcHRpb25zLmZvcm0uX3BpY2tMYXllcihmaWVsZCk7XG4gICAgfSxcbiAgICBpc1Zpc2libGU6IGZ1bmN0aW9uKGZpZWxkKXtcbiAgICAgIHJldHVybiB0aGlzLiRvcHRpb25zLmZvcm0uX2lzVmlzaWJsZShmaWVsZCk7XG4gICAgfSxcbiAgICBzaG93UmVsYXRpb246IGZ1bmN0aW9uKHJlbGF0aW9uKXtcbiAgICAgIHJldHVybiB0aGlzLiRvcHRpb25zLmZvcm0uX3Nob3VsZFNob3dSZWxhdGlvbihyZWxhdGlvbik7XG4gICAgfVxuICB9LFxuICBjb21wdXRlZDoge1xuICAgIGlzVmFsaWQ6IGZ1bmN0aW9uKGZpZWxkKSB7XG4gICAgICByZXR1cm4gdGhpcy4kdmFsaWRhdGUoZmllbGQubmFtZSk7XG4gICAgfSxcbiAgfVxufSk7XG5cbnZhciBJbnB1dHMgPSB7fTtcbklucHV0cy5TVFJJTkcgPSAnc3RyaW5nJztcbklucHV0cy5JTlRFR0VSID0gJ2ludGVnZXInO1xuSW5wdXRzLkZMT0FUID0gJ2Zsb2F0JztcblxuSW5wdXRzLmRlZmF1bHRzID0ge307XG5JbnB1dHMuZGVmYXVsdHNbSW5wdXRzLlNUUklOR10gPSBcIlwiO1xuSW5wdXRzLmRlZmF1bHRzW0lucHV0cy5JTlRFR0VSXSA9IDA7XG5JbnB1dHMuZGVmYXVsdHNbSW5wdXRzLkZMT0FUXSA9IDAuMDtcbklucHV0cy5zaW1wbGVGaWVsZFR5cGVzID0gW0lucHV0cy5TVFJJTkcsSW5wdXRzLklOVEVHRVIsSW5wdXRzLkZMT0FUXTtcblxuSW5wdXRzLlNFTEVDVCA9ICdzZWxlY3QnO1xuSW5wdXRzLkxBWUVSUElDS0VSID0gJ2xheWVycGlja2VyJztcblxuSW5wdXRzLnNwZWNpYWxJbnB1dHMgPSBbSW5wdXRzLlNFTEVDVCxJbnB1dHMuTEFZRVJQSUNLRVJdO1xuXG5mdW5jdGlvbiBGb3JtKG9wdGlvbnMpe1xuICAvLyBwcm9wcmlldMOgIG5lY2Vzc2FyaWUuIEluIGZ1dHVybyBsZSBtZXR0ZXJtbyBpbiB1bmEgY2xhc3NlIFBhbmVsIGRhIGN1aSBkZXJpdmVyYW5ubyB0dXR0aSBpIHBhbm5lbGxpIGNoZSB2b2dsaW9ubyBlc3NlcmUgbW9zdHJhdGkgbmVsbGEgc2lkZWJhclxuICB0aGlzLmludGVybmFsQ29tcG9uZW50ID0gbnVsbDtcbiAgdGhpcy5vcHRpb25zID0gIG9wdGlvbnMgfHwge307XG4gIHRoaXMuaWQgPSBvcHRpb25zLmlkOyAvLyBpZCBkZWwgZm9ybVxuICB0aGlzLm5hbWUgPSBvcHRpb25zLm5hbWU7IC8vIG5vbWUgZGVsIGZvcm1cbiAgdGhpcy5kYXRhaWQgPSBvcHRpb25zLmRhdGFpZDsgLy8gXCJhY2Nlc3NpXCIsIFwiZ2l1bnppb25pXCIsIGVjYy5cbiAgdGhpcy5wayA9IG9wdGlvbnMucGsgfHwgbnVsbCwgLy8gZXZlbnR1YWxlIGNoaWF2ZSBwcmltYXJpYSAobm9uIHR1dHRpIGkgZm9ybSBwb3RyZWJiZXJvIGF2ZXJjZWxhIG8gYXZlcm5lIGJpc29nbm9cbiAgdGhpcy5pc25ldyA9ICghXy5pc05pbChvcHRpb25zLmlzbmV3KSAmJiBfLmlzQm9vbGVhbihvcHRpb25zLmlzbmV3KSkgPyBvcHRpb25zLmlzbmV3IDogdHJ1ZTtcbiAgXG4gIHRoaXMuc3RhdGUgPSB7XG4gICAgLy8gaSBkYXRpIGRlbCBmb3JtIHBvc3Nvbm8gYXZlcmUgbyBtZW5vIHVuYSBwcmltYXJ5IGtleVxuICAgIGZpZWxkczogb3B0aW9ucy5maWVsZHMsXG4gICAgcmVsYXRpb25zOiBvcHRpb25zLnJlbGF0aW9uc1xuICB9XG4gIFxuICB0aGlzLl9mb3JtUGFuZWwgPSBvcHRpb25zLmZvcm1QYW5lbCB8fCBGb3JtUGFuZWw7XG4gIHRoaXMuX2RlZmF1bHRzID0gb3B0aW9ucy5kZWZhdWx0cyB8fCBJbnB1dHMuZGVmYXVsdHM7XG59XG5pbmhlcml0KEZvcm0sUGFuZWwpO1xuXG52YXIgcHJvdG8gPSBGb3JtLnByb3RvdHlwZTtcblxuLy8gdmllbmUgcmljaGlhbWF0byBkYWxsYSB0b29sYmFyIHF1YW5kbyBpbCBwbHVnaW4gY2hpZWRlIGRpIG1vc3RyYXJlIHVuIHByb3ByaW8gcGFubmVsbG8gbmVsbGEgR1VJIChHVUkuc2hvd1BhbmVsKVxucHJvdG8ubW91bnQgPSBmdW5jdGlvbihjb250YWluZXIpe1xuICB0aGlzLl9zZXR1cEZpZWxkcygpO1xuICB2YXIgcGFuZWwgPSB0aGlzLl9zZXR1cFBhbmVsKCk7XG4gIHRoaXMuX21vdW50UGFuZWwocGFuZWwsY29udGFpbmVyKTtcbiAgcmV0dXJuIHJlc29sdmUodHJ1ZSk7XG59O1xuXG4vLyByaWNoaWFtYXRvIHF1YW5kbyBsYSBHVUkgY2hpZWRlIGRpIGNoaXVkZXJlIGlsIHBhbm5lbGxvLiBTZSByaXRvcm5hIGZhbHNlIGlsIHBhbm5lbGxvIG5vbiB2aWVuZSBjaGl1c29cbnByb3RvLnVubW91bnQgPSBmdW5jdGlvbigpe1xuICB0aGlzLmludGVybmFsQ29tcG9uZW50LiRkZXN0cm95KHRydWUpO1xuICB0aGlzLmludGVybmFsQ29tcG9uZW50ID0gbnVsbDtcbiAgcmV0dXJuIHJlc29sdmUodHJ1ZSk7XG59O1xuXG5wcm90by5faXNOZXcgPSBmdW5jdGlvbigpe1xuICByZXR1cm4gdGhpcy5pc25ldztcbn07XG5cbnByb3RvLl9oYXNGaWVsZHNSZXF1aXJlZCA9IGZ1bmN0aW9uKCkge1xuICB2YXIgc29tZUZpZWxkc1JlcXVpcmVkID0gXy5zb21lKHRoaXMuc3RhdGUuZmllbGRzLGZ1bmN0aW9uKGZpZWxkKXtcbiAgICByZXR1cm4gZmllbGQudmFsaWRhdGUgJiYgZmllbGQudmFsaWRhdGUucmVxdWlyZWQ7XG4gIH0pO1xuICB2YXIgc29tZVJlbGF0aW9uc1JlcXVpcmVkID0gXy5zb21lKHRoaXMuc3RhdGUucmVsYXRpb25zLGZ1bmN0aW9uKHJlbGF0aW9uKXtcbiAgICByZXR1cm4gcmVsYXRpb24udmFsaWRhdGUgJiYgcmVsYXRpb24udmFsaWRhdGUucmVxdWlyZWQ7XG4gIH0pO1xuICByZXR1cm4gc29tZUZpZWxkc1JlcXVpcmVkIHx8IHNvbWVSZWxhdGlvbnNSZXF1aXJlZDtcbn07XG5cbnByb3RvLl9pc1Zpc2libGUgPSBmdW5jdGlvbihmaWVsZCl7XG4gIGlmKCFmaWVsZC5lZGl0YWJsZSAmJiAoZmllbGQudmFsdWUgPT0gXCJcIiB8fCBfLmlzTnVsbChmaWVsZC52YWx1ZSkpKXtcbiAgICByZXR1cm4gZmFsc2VcbiAgfVxuICByZXR1cm4gdHJ1ZTtcbn07XG5cbnByb3RvLl9pc0VkaXRhYmxlID0gZnVuY3Rpb24oZmllbGQpe1xuICByZXR1cm4gZmllbGQuZWRpdGFibGU7XG59O1xuXG5wcm90by5faXNTaW1wbGUgPSBmdW5jdGlvbihmaWVsZCl7XG4gIGlmIChfLmluY2x1ZGVzKElucHV0cy5zcGVjaWFsSW5wdXRzLGZpZWxkLmlucHV0LnR5cGUpKXtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgcmV0dXJuIF8uaW5jbHVkZXMoSW5wdXRzLnNpbXBsZUZpZWxkVHlwZXMsZmllbGQudHlwZSlcbn07XG5cbnByb3RvLl9pc1NlbGVjdCA9IGZ1bmN0aW9uKGZpZWxkKXtcbiAgcmV0dXJuIChfLmluY2x1ZGVzKElucHV0cy5zcGVjaWFsSW5wdXRzLGZpZWxkLmlucHV0LnR5cGUpICYmIGZpZWxkLmlucHV0LnR5cGUgPT0gSW5wdXRzLlNFTEVDVCk7XG59O1xuXG5wcm90by5faXNMYXllclBpY2tlciA9IGZ1bmN0aW9uKGZpZWxkKXtcbiAgcmV0dXJuIChfLmluY2x1ZGVzKElucHV0cy5zcGVjaWFsSW5wdXRzLGZpZWxkLmlucHV0LnR5cGUpICYmIGZpZWxkLmlucHV0LnR5cGUgPT0gSW5wdXRzLkxBWUVSUElDS0VSKTtcbn07XG5cbnByb3RvLl9waWNrTGF5ZXIgPSBmdW5jdGlvbihmaWVsZCl7XG4gIC8vIHJpdG9ybm8gdW5hIHByb21lc3NhLCBzZSBxdWFsY3VuIGFsdHJvIHZvbGVzc2UgdXNhcmUgaWwgcmlzdWx0YXRvIChlcy4gcGVyIHNldHRhcmUgYWx0cmkgY2FtcGkgaW4gYmFzZSBhbGxhIGZlYXR1cmUgc2VsZXppb25hdGEpXG4gIHZhciBkID0gJC5EZWZlcnJlZCgpO1xuICAvLyBkaXNhYmlsaXRvIHRlbXBvcmFuZW1hbnRlIGxvIHN0cmF0byBtb2RhbGUgcGVyIHBlcm1ldHRlcmUgbCdpbnRlcmF6aW9uZSBjb24gbGEgbWFwcGFcbiAgR1VJLnNldE1vZGFsKGZhbHNlKTtcbiAgdmFyIGxheWVySWQgPSBmaWVsZC5pbnB1dC5vcHRpb25zLmxheWVyaWQ7XG4gIHZhciByZWxGaWVsZE5hbWUgPSBmaWVsZC5pbnB1dC5vcHRpb25zLmZpZWxkO1xuICB2YXIgcmVsRmllbGRMYWJlbCA9IFByb2plY3RzUmVnaXN0cnkuZ2V0Q3VycmVudFByb2plY3QoKS5nZXRMYXllckF0dHJpYnV0ZUxhYmVsKGxheWVySWQsZmllbGQuaW5wdXQub3B0aW9ucy5maWVsZCk7XG4gIHZhciBtYXBTZXJ2aWNlID0gR1VJLmdldENvbXBvbmVudCgnbWFwJykuZ2V0U2VydmljZSgpO1xuICBtYXBTZXJ2aWNlLmdldEZlYXR1cmVJbmZvKGxheWVySWQpXG4gIC50aGVuKGZ1bmN0aW9uKGF0dHJpYnV0ZXMpe1xuICAgIHZhciB2YWx1ZSA9IGF0dHJpYnV0ZXNbcmVsRmllbGROYW1lXSA/IGF0dHJpYnV0ZXNbcmVsRmllbGROYW1lXSA6IGF0dHJpYnV0ZXNbcmVsRmllbGRMYWJlbF07XG4gICAgZmllbGQudmFsdWUgPSB2YWx1ZTtcbiAgICBkLnJlc29sdmUoYXR0cmlidXRlcyk7XG4gIH0pXG4gIC5hbHdheXMoZnVuY3Rpb24oKXtcbiAgICBHVUkuc2V0TW9kYWwodHJ1ZSk7XG4gICAgZC5yZWplY3QoKTtcbiAgfSk7XG4gIHJldHVybiBkLnByb21pc2UoKTtcbn07XG5cbnByb3RvLl9nZXREZWZhdWx0VmFsdWUgPSBmdW5jdGlvbihmaWVsZCl7XG4gIHZhciBkZWZhdWx0VmFsdWUgPSBudWxsO1xuICBpZiAoZmllbGQuaW5wdXQgJiYgZmllbGQuaW5wdXQub3B0aW9ucyAmJiBmaWVsZC5pbnB1dC5vcHRpb25zLmRlZmF1bHQpe1xuICAgIGRlZmF1bHRWYWx1ZSA9IGZpZWxkLmlucHV0Lm9wdGlvbnMuZGVmYXVsdDtcbiAgfVxuICBlbHNlIGlmICh0aGlzLl9pc1NlbGVjdChmaWVsZCkpe1xuICAgIGRlZmF1bHRWYWx1ZSA9IGZpZWxkLmlucHV0Lm9wdGlvbnMudmFsdWVzWzBdLmtleTtcbiAgfVxuICAvKmVsc2Uge1xuICAgIGRlZmF1bHRWYWx1ZSA9IHRoaXMuX2RlZmF1bHRzW2ZpZWxkLnR5cGVdO1xuICB9Ki9cbiAgcmV0dXJuIGRlZmF1bHRWYWx1ZTtcbn07XG5cbnByb3RvLl9nZXRsYXllclBpY2tlckxheWVyTmFtZSA9IGZ1bmN0aW9uKGlkKXtcbiAgdmFyIGxheWVyID0gUHJvamVjdHNSZWdpc3RyeS5nZXRDdXJyZW50UHJvamVjdCgpLmdldExheWVyKGlkKTtcbiAgaWYgKGxheWVyKXtcbiAgICByZXR1cm4gbGF5ZXIubmFtZTtcbiAgfVxuICByZXR1cm4gXCJcIjtcbn07XG5cbnByb3RvLl9zaG91bGRTaG93UmVsYXRpb24gPSBmdW5jdGlvbihyZWxhdGlvbil7XG4gIHJldHVybiB0cnVlO1xufTtcblxuLy8gcGVyIGRlZmluaXJlIGkgdmFsb3JpIGRpIGRlZmF1bHQgbmVsIGNhc28gc2kgdHJhdHRhIGRpIHVuIG51b3ZvIGluc2VyaW1lbnRvXG5wcm90by5fc2V0dXBGaWVsZHMgPSBmdW5jdGlvbigpe1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIFxuICB2YXIgZmllbGRzID0gXy5maWx0ZXIodGhpcy5zdGF0ZS5maWVsZHMsZnVuY3Rpb24oZmllbGQpe1xuICAgIC8vIHR1dHRpIGkgY2FtcGkgZWNjZXR0byBsYSBQSyAoc2Ugbm9uIG51bGxhKVxuICAgIGlmIChzZWxmLnBrICYmIGZpZWxkLnZhbHVlPT1udWxsKXtcbiAgICAgIHJldHVybiAoKGZpZWxkLm5hbWUgIT0gc2VsZi5waykpO1xuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfSk7XG4gIFxuICBfLmZvckVhY2goZmllbGRzLGZ1bmN0aW9uKGZpZWxkKXtcbiAgICBpZihfLmlzTmlsKGZpZWxkLnZhbHVlKSl7XG4gICAgICB2YXIgZGVmYXVsdFZhbHVlID0gc2VsZi5fZ2V0RGVmYXVsdFZhbHVlKGZpZWxkKTtcbiAgICAgIGlmIChkZWZhdWx0VmFsdWUpe1xuICAgICAgICBmaWVsZC52YWx1ZSA9IGRlZmF1bHRWYWx1ZTtcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xuICBcbiAgaWYgKHRoaXMuc3RhdGUucmVsYXRpb25zKXtcbiAgICB2YXIgcmVsYXRpb25zID0gdGhpcy5zdGF0ZS5yZWxhdGlvbnM7XG4gICAgXy5mb3JFYWNoKHJlbGF0aW9ucyxmdW5jdGlvbihyZWxhdGlvbil7XG4gICAgICBfLmZvckVhY2gocmVsYXRpb24uZmllbGRzLGZ1bmN0aW9uKGZpZWxkKXtcbiAgICAgICAgaWYoXy5pc05pbChmaWVsZC52YWx1ZSkpe1xuICAgICAgICAgIHZhciBkZWZhdWx0VmFsdWUgPSBzZWxmLl9nZXREZWZhdWx0VmFsdWUoZmllbGQpO1xuICAgICAgICAgIGlmIChkZWZhdWx0VmFsdWUpe1xuICAgICAgICAgICAgZmllbGQudmFsdWUgPSBkZWZhdWx0VmFsdWU7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9KVxuICB9XG59O1xuXG5wcm90by5fc2V0dXBQYW5lbCA9IGZ1bmN0aW9uKCl7XG4gIHZhciBwYW5lbCA9IHRoaXMuaW50ZXJuYWxDb21wb25lbnQgPSBuZXcgdGhpcy5fZm9ybVBhbmVsKHtcbiAgICBmb3JtOiB0aGlzXG4gIH0pO1xuICBpZiAodGhpcy5vcHRpb25zLmJ1dHRvbnMpIHtcbiAgICBwYW5lbC5idXR0b25zID0gdGhpcy5vcHRpb25zLmJ1dHRvbnM7XG4gIH1cbiAgcGFuZWwuc3RhdGUgPSB0aGlzLnN0YXRlO1xuICByZXR1cm4gcGFuZWxcbn07XG5cbnByb3RvLl9tb3VudFBhbmVsID0gZnVuY3Rpb24ocGFuZWwsY29udGFpbmVyKXtcbiAgcGFuZWwuJG1vdW50KCkuJGFwcGVuZFRvKGNvbnRhaW5lcik7XG59O1xuXG5wcm90by5fZ2V0RmllbGQgPSBmdW5jdGlvbihmaWVsZE5hbWUpe1xuICB2YXIgZmllbGQgPSBudWxsO1xuICBfLmZvckVhY2godGhpcy5zdGF0ZS5maWVsZHMsZnVuY3Rpb24oZil7XG4gICAgaWYgKGYubmFtZSA9PSBmaWVsZE5hbWUpe1xuICAgICAgZmllbGQgPSBmO1xuICAgIH1cbiAgfSlcbiAgcmV0dXJuIGZpZWxkO1xufTtcblxucHJvdG8uX2dldFJlbGF0aW9uRmllbGQgPSBmdW5jdGlvbihmaWVsZE5hbWUscmVsYXRpb25OYW1lKXtcbiAgdmFyIGZpZWxkID0gbnVsbDtcbiAgXy5mb3JFYWNoKHRoaXMuc3RhdGUucmVsYXRpb25zLGZ1bmN0aW9uKHJlbGF0aW9uLG5hbWUpe1xuICAgIGlmIChyZWxhdGlvbk5hbWUgPT0gbmFtZSl7XG4gICAgICBfLmZvckVhY2gocmVsYXRpb24uZmllbGRzLGZ1bmN0aW9uKGYpe1xuICAgICAgICBpZiAoZi5uYW1lID09IGZpZWxkTmFtZSl7XG4gICAgICAgICAgZmllbGQgPSBmO1xuICAgICAgICB9XG4gICAgICB9KVxuICAgIH1cbiAgfSlcbiAgcmV0dXJuIGZpZWxkO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSB7XG4gIEZvcm06IEZvcm0sXG4gIEZvcm1QYW5lbDogRm9ybVBhbmVsXG59XG4iLCJtb2R1bGUuZXhwb3J0cyA9IFwiPGRpdj5cXG4gIDx2YWxpZGF0b3IgbmFtZT1cXFwidmFsaWRhdGlvblxcXCI+XFxuICAgIDxmb3JtIG5vdmFsaWRhdGUgY2xhc3M9XFxcImZvcm0taG9yaXpvbnRhbCBnM3ctZm9ybVxcXCI+XFxuICAgICAgPHRlbXBsYXRlIHYtZm9yPVxcXCJmaWVsZCBpbiBzdGF0ZS5maWVsZHNcXFwiPlxcbiAgICAgICAgPGRpdiB2LWlmPVxcXCJpc1Zpc2libGUoZmllbGQpXFxcIiBjbGFzcz1cXFwiZm9ybS1ncm91cCBoYXMtZmVlZGJhY2tcXFwiPlxcbiAgICAgICAgICA8bGFiZWwgOmZvcj1cXFwiZmllbGQubmFtZVxcXCIgY2xhc3M9XFxcImNvbC1zbS00IGNvbnRyb2wtbGFiZWxcXFwiPnt7IGZpZWxkLmxhYmVsIH19PHNwYW4gdi1pZj1cXFwiZmllbGQudmFsaWRhdGUgJiYgZmllbGQudmFsaWRhdGUucmVxdWlyZWRcXFwiPio8L3NwYW4+PC9sYWJlbD5cXG4gICAgICAgICAgPGRpdiBjbGFzcz1cXFwiY29sLXNtLThcXFwiPlxcbiAgICAgICAgICAgIDxpbnB1dCB2LWlmPVxcXCJpc1NpbXBsZShmaWVsZClcXFwiIDpmaWVsZD1cXFwiZmllbGQubmFtZVxcXCIgdi12YWxpZGF0ZT1cXFwiZmllbGQudmFsaWRhdGVcXFwiIHYtZGlzYWJsZWQ9XFxcIiFpc0VkaXRhYmxlKGZpZWxkKVxcXCIgY2xhc3M9XFxcImZvcm0tY29udHJvbFxcXCIgdi1tb2RlbD1cXFwiZmllbGQudmFsdWVcXFwiIDppZD1cXFwiZmllbGQubmFtZVxcXCIgOnBsYWNlaG9sZGVyPVxcXCJmaWVsZC5pbnB1dC5sYWJlbFxcXCI+XFxuICAgICAgICAgICAgPHNlbGVjdCB2LWlmPVxcXCJpc1NlbGVjdChmaWVsZClcXFwiIDpmaWVsZD1cXFwiZmllbGQubmFtZVxcXCIgdi12YWxpZGF0ZT1cXFwiZmllbGQudmFsaWRhdGVcXFwiIHYtZGlzYWJsZWQ9XFxcIiFpc0VkaXRhYmxlKGZpZWxkKVxcXCIgY2xhc3M9XFxcImZvcm0tY29udHJvbFxcXCIgdi1tb2RlbD1cXFwiZmllbGQudmFsdWVcXFwiIDppZD1cXFwiZmllbGQubmFtZVxcXCIgOnBsYWNlaG9sZGVyPVxcXCJmaWVsZC5pbnB1dC5sYWJlbFxcXCI+XFxuICAgICAgICAgICAgICA8b3B0aW9uIHYtZm9yPVxcXCJ2YWx1ZSBpbiBmaWVsZC5pbnB1dC5vcHRpb25zLnZhbHVlc1xcXCIgdmFsdWU9XFxcInt7IHZhbHVlLmtleSB9fVxcXCI+e3sgdmFsdWUudmFsdWUgfX08L29wdGlvbj5cXG4gICAgICAgICAgICA8L3NlbGVjdD5cXG4gICAgICAgICAgICA8ZGl2IHYtaWY9XFxcImlzTGF5ZXJQaWNrZXIoZmllbGQpXFxcIj5cXG4gICAgICAgICAgICAgIDxpbnB1dCBjbGFzcz1cXFwiZm9ybS1jb250cm9sXFxcIiBAY2xpY2s9XFxcInBpY2tMYXllcihmaWVsZClcXFwiIDpmaWVsZD1cXFwiZmllbGQubmFtZVxcXCIgdi12YWxpZGF0ZT1cXFwiZmllbGQudmFsaWRhdGVcXFwiIHYtZGlzYWJsZWQ9XFxcIiFpc0VkaXRhYmxlKGZpZWxkKVxcXCIgb25mb2N1cz1cXFwiYmx1cigpXFxcIiBkYXRhLXRvZ2dsZT1cXFwidG9vbHRpcFxcXCIgdGl0bGU9XFxcIk90dGllbmkgaWwgZGF0byBkYSB1biBlbGVtZW50byBkZWwgbGF5ZXIgJ3t7IGxheWVyUGlja2VyUGxhY2VIb2xkZXIoZmllbGQpIH19J1xcXCIgdi1tb2RlbD1cXFwiZmllbGQudmFsdWVcXFwiIDppZD1cXFwiZmllbGQubmFtZVxcXCIgOnBsYWNlaG9sZGVyPVxcXCInWycrbGF5ZXJQaWNrZXJQbGFjZUhvbGRlcihmaWVsZCkrJ10nXFxcIj5cXG4gICAgICAgICAgICAgIDxpIGNsYXNzPVxcXCJnbHlwaGljb24gZ2x5cGhpY29uLXNjcmVlbnNob3QgZm9ybS1jb250cm9sLWZlZWRiYWNrXFxcIj48L2k+XFxuICAgICAgICAgICAgPC9kaXY+XFxuICAgICAgICAgIDwvZGl2PlxcbiAgICAgICAgPC9kaXY+XFxuICAgICAgPC90ZW1wbGF0ZT5cXG4gICAgICA8ZGl2IHYtZm9yPVxcXCJyZWxhdGlvbiBpbiBzdGF0ZS5yZWxhdGlvbnNcXFwiPlxcbiAgICAgICAgPGRpdiB2LWlmPVxcXCJzaG93UmVsYXRpb24ocmVsYXRpb24pXFxcIiB0cmFuc2l0aW9uPVxcXCJleHBhbmRcXFwiPlxcbiAgICAgICAgICA8ZGl2IGNsYXNzPVxcXCJnM3ctcmVsYXRpb25uYW1lXFxcIj57eyByZWxhdGlvbi5uYW1lIHwgc3RhcnRjYXNlIH19PC9kaXY+XFxuICAgICAgICAgIDx0ZW1wbGF0ZSB2LWZvcj1cXFwicmVsZmllbGQgaW4gcmVsYXRpb24uZmllbGRzXFxcIj5cXG4gICAgICAgICAgICA8ZGl2IHYtaWY9XFxcImlzVmlzaWJsZShyZWxmaWVsZClcXFwiIGNsYXNzPVxcXCJmb3JtLWdyb3VwIGhhcy1mZWVkYmFja1xcXCI+XFxuICAgICAgICAgICAgICA8bGFiZWwgOmZvcj1cXFwicmVsZmllbGQubmFtZVxcXCIgY2xhc3M9XFxcImNvbC1zbS00IGNvbnRyb2wtbGFiZWxcXFwiPnt7cmVsZmllbGQubGFiZWx9fTxzcGFuIHYtaWY9XFxcInJlbGZpZWxkLnZhbGlkYXRlICYmIHJlbGZpZWxkLnZhbGlkYXRlLnJlcXVpcmVkXFxcIj4qPC9zcGFuPjwvbGFiZWw+XFxuICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVxcXCJjb2wtc20tOFxcXCI+XFxuICAgICAgICAgICAgICAgIDxpbnB1dCB2LWlmPVxcXCJpc1NpbXBsZShyZWxmaWVsZClcXFwiIDpmaWVsZD1cXFwicmVsZmllbGQubmFtZVxcXCIgdi12YWxpZGF0ZT1cXFwicmVsZmllbGQudmFsaWRhdGVcXFwiIHYtZGlzYWJsZWQ9XFxcIiFpc0VkaXRhYmxlKHJlbGZpZWxkKVxcXCIgY2xhc3M9XFxcImZvcm0tY29udHJvbFxcXCIgdi1tb2RlbD1cXFwicmVsZmllbGQudmFsdWVcXFwiIDppZD1cXFwicmVsZmllbGQubmFtZVxcXCIgOnBsYWNlaG9sZGVyPVxcXCJyZWxmaWVsZC5pbnB1dC5sYWJlbFxcXCI+XFxuICAgICAgICAgICAgICAgIDxzZWxlY3Qgdi1pZj1cXFwiaXNTZWxlY3QocmVsZmllbGQpXFxcIiA6ZmllbGQ9XFxcInJlbGZpZWxkLm5hbWVcXFwiIHYtdmFsaWRhdGU9XFxcInJlbGZpZWxkLnZhbGlkYXRlXFxcIiB2LWRpc2FibGVkPVxcXCIhaXNFZGl0YWJsZShyZWxmaWVsZClcXFwiIGNsYXNzPVxcXCJmb3JtLWNvbnRyb2xcXFwiIHYtbW9kZWw9XFxcInJlbGZpZWxkLnZhbHVlXFxcIiA6aWQ9XFxcInJlbGZpZWxkLm5hbWVcXFwiIDpwbGFjZWhvbGRlcj1cXFwicmVsZmllbGQuaW5wdXQubGFiZWxcXFwiPlxcbiAgICAgICAgICAgICAgICAgIDxvcHRpb24gdi1mb3I9XFxcInJlbHZhbHVlIGluIHJlbGZpZWxkLmlucHV0Lm9wdGlvbnMudmFsdWVzXFxcIiB2YWx1ZT1cXFwie3sgcmVsdmFsdWUua2V5IH19XFxcIj57eyByZWx2YWx1ZS52YWx1ZSB9fTwvb3B0aW9uPlxcbiAgICAgICAgICAgICAgICA8L3NlbGVjdD5cXG4gICAgICAgICAgICAgICAgPGRpdiB2LWlmPVxcXCJpc0xheWVyUGlja2VyKHJlbGZpZWxkKVxcXCI+XFxuICAgICAgICAgICAgICAgICAgPGlucHV0IGNsYXNzPVxcXCJmb3JtLWNvbnRyb2xcXFwiIEBjbGljaz1cXFwicGlja0xheWVyKHJlbGZpZWxkKVxcXCIgOmZpZWxkPVxcXCJyZWxmaWVsZC5uYW1lXFxcIiB2LXZhbGlkYXRlPVxcXCJyZWxmaWVsZC52YWxpZGF0ZVxcXCIgdi1kaXNhYmxlZD1cXFwiIWlzRWRpdGFibGUocmVsZmllbGQpXFxcIiBvbmZvY3VzPVxcXCJibHVyKClcXFwiIHN0eWxlPVxcXCJjdXJzb3I6cG9pbnRlclxcXCIgZGF0YS10b2dnbGU9XFxcInRvb2x0aXBcXFwiIHRpdGxlPVxcXCJPdHRpZW5pIGlsIGRhdG8gZGEgdW4gZWxlbWVudG8gZGVsIGxheWVyICd7eyBsYXllclBpY2tlclBsYWNlSG9sZGVyKHJlbGZpZWxkKSB9fSdcXFwiIHYtbW9kZWw9XFxcInJlbGZpZWxkLnZhbHVlXFxcIiA6aWQ9XFxcInJlbGZpZWxkLm5hbWVcXFwiIDpwbGFjZWhvbGRlcj1cXFwiJ1snK2xheWVyUGlja2VyUGxhY2VIb2xkZXIocmVsZmllbGQpKyddJ1xcXCI+XFxuICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9XFxcImdseXBoaWNvbiBnbHlwaGljb24tc2NyZWVuc2hvdCBmb3JtLWNvbnRyb2wtZmVlZGJhY2tcXFwiPjwvaT5cXG4gICAgICAgICAgICAgICAgPC9kaXY+XFxuICAgICAgICAgICAgICA8L2Rpdj5cXG4gICAgICAgICAgICA8L2Rpdj5cXG4gICAgICAgICAgPC90ZW1wbGF0ZT5cXG4gICAgICAgIDwvZGl2PlxcbiAgICAgIDwvZGl2PlxcbiAgICAgIDxkaXYgY2xhc3M9XFxcImZvcm0tZ3JvdXBcXFwiPlxcbiAgICAgICAgPGRpdiBjbGFzcz1cXFwiY29sLXNtLW9mZnNldC00IGNvbC1zbS04XFxcIj5cXG4gICAgICAgICAgPGRpdiB2LWlmPVxcXCJoYXNGaWVsZHNSZXF1aXJlZFxcXCIgc3R5bGU9XFxcIm1hcmdpbi1ib3R0b206MTBweFxcXCI+XFxuICAgICAgICAgICAgPHNwYW4+KiBDYW1waSByaWNoaWVzdGk8L3NwYW4+XFxuICAgICAgICAgIDwvZGl2PlxcbiAgICAgICAgICA8c3BhbiB2LWZvcj1cXFwiYnV0dG9uIGluIGJ1dHRvbnNcXFwiPlxcbiAgICAgICAgICAgIDxidXR0b24gY2xhc3M9XFxcImJ0biBcXFwiIDpjbGFzcz1cXFwiW2J1dHRvbi5jbGFzc11cXFwiIEBjbGljay5zdG9wLnByZXZlbnQ9XFxcImV4ZWMoYnV0dG9uLmNiaylcXFwiIHYtZGlzYWJsZWQ9XFxcIiFidG5FbmFibGVkKGJ1dHRvbilcXFwiPnt7IGJ1dHRvbi50aXRsZSB9fTwvYnV0dG9uPlxcbiAgICAgICAgICA8L3NwYW4+XFxuICAgICAgICA8L2Rpdj5cXG4gICAgICA8L2Rpdj5cXG4gICAgPC9mb3JtPlxcbiAgPC92YWxpZGF0b3I+XFxuPC9kaXY+XFxuXCI7XG4iLCJ2YXIgbm9vcCA9IHJlcXVpcmUoJ2NvcmUvdXRpbHMvdXRpbHMnKS5ub29wO1xudmFyIGluaGVyaXQgPSByZXF1aXJlKCdjb3JlL3V0aWxzL3V0aWxzJykuaW5oZXJpdDtcbnZhciBHM1dPYmplY3QgPSByZXF1aXJlKCdjb3JlL2czd29iamVjdCcpO1xudmFyIENvbXBvbmVudHNSZWdpc3RyeSA9IHJlcXVpcmUoJ2d1aS9jb21wb25lbnRzcmVnaXN0cnknKTtcblxuLy8gcmFwcHJlc2VudGEgbCdpbnRlcmZhY2NpYSBnbG9iYWxlIGRlbGwnQVBJIGRlbGxhIEdVSS4gXG4vLyBtZXRvZGkgZGV2b25vIGVzc2VyZSBpbXBsZW1lbnRhdGkgKGRlZmluaXRpKSBkYWxsJ2FwcGxpY2F6aW9uZSBvc3BpdGVcbi8vIGwnYXBwIG9zcGl0ZSBkb3ZyZWJiZSBjaGlhbWFyZSBhbmNoZSBsYSBmdW56aW9uZSBHVUkucmVhZHkoKSBxdWFuZG8gbGEgVUkgw6ggcHJvbnRhXG5mdW5jdGlvbiBHVUkoKXtcbiAgdGhpcy5yZWFkeSA9IGZhbHNlO1xuICAvLyB1cmwgZGVsbGUgcmlzb3JzZSAoaW1tYWdpbmksIGVjYy4pXG4gIHRoaXMuZ2V0UmVzb3VyY2VzVXJsID0gbm9vcDtcbiAgLy8gc2hvdyBhIFZ1ZSBmb3JtXG4gIHRoaXMuc2hvd0Zvcm0gPSBub29wO1xuICB0aGlzLmNsb3NlRm9ybSA9IG5vb3A7XG4gIFxuICAvLyBtb3N0cmEgdW5hIGxpc3RhIGRpIG9nZ2V0dGkgKGVzLiBsaXN0YSBkaSByaXN1bHRhdGkpXG4gIHRoaXMuc2hvd0xpc3RpbmcgPSBub29wO1xuICB0aGlzLmNsb3NlTGlzdGluZyA9IG5vb3A7XG4gIHRoaXMuaGlkZUxpc3RpbmcgPSBub29wO1xuICBcbiAgLy8gb3B0aW9ucyBjb250ZXJyw6AgaSB2YXJpIGRhdGkgc3VpIHJpc3VsdGF0aS4gU2ljdXJhbWVudGUgYXZyw6AgbGEgcHJwcmlldMOgIG9wdGlvbnMuZmVhdHVyZXNcbiAgLy8gbmVsIGNhc28gZGkgcXVlcnlCeUxvY2F0aW9uIGF2csOgIGFuY2hlIG9wdGlvbnMuY29vcmRpbmF0ZVxuICB0aGlzLnNob3dRdWVyeVJlc3VsdHMgPSBmdW5jdGlvbihvcHRpb25zKSB7fTtcbiAgdGhpcy5oaWRlUXVlcnlSZXN1bHRzID0gbm9vcDtcblxuICAvKiBwYW5lbCAqL1xuICB0aGlzLnNob3dQYW5lbCA9IG5vb3A7XG4gIHRoaXMuaGlkZVBhbmVsID0gbm9vcDtcblxuICAvL21ldG9kaSBjb21wb25lbnRlXG4gIC8vIGFnZ2l1bmdlIChlIHJlZ2lzdHJhKSB1biBjb21wb25lbnRlIGluIHVuIHBsYWNlaG9sZGVyIGRlbCB0ZW1wbGF0ZSAtIE1ldG9kbyBpbXBsZW1lbnRhdG8gZGFsIHRlbXBsYXRlXG4gIHRoaXMuYWRkQ29tcG9uZW50ID0gZnVuY3Rpb24oY29tcG9uZW50LHBsYWNlaG9sZGVyKSB7fTtcbiAgdGhpcy5yZW1vdmVDb21wb25lbnQgPSBmdW5jdGlvbihpZCkge307XG4gIC8vIHJlZ2lzdHJhIGdsb2JhbG1lbnRlIHVuIGNvbXBvbmVudGUgKG5vbiBsZWdhdG8gYWQgdW5vIHNwZWNpZmljbyBwbGFjZWhvbGRlci4gRXMuIGNvbXBvbmVudGUgcGVyIG1vc3RyYXJlIHJpc3VsdGF0aSBpbnRlcnJvZ2F6aW9uKVxuICB0aGlzLnNldENvbXBvbmVudCA9IGZ1bmN0aW9uKGNvbXBvbmVudCkge1xuICAgIENvbXBvbmVudHNSZWdpc3RyeS5yZWdpc3RlckNvbXBvbmVudChjb21wb25lbnQpO1xuICB9O1xuICB0aGlzLmdldENvbXBvbmVudCA9IGZ1bmN0aW9uKGlkKSB7XG4gICAgcmV0dXJuIENvbXBvbmVudHNSZWdpc3RyeS5nZXRDb21wb25lbnQoaWQpO1xuICB9O1xuICAvL2ZpbmUgbWV0b2RpIGNvbXBvbmVudGVcblxuICB0aGlzLnJlYWR5ID0gZnVuY3Rpb24oKXtcbiAgICB0aGlzLmVtaXQoJ3JlYWR5Jyk7XG4gICAgdGhpcy5yZWFkeSA9IHRydWU7XG4gIH07XG4gIFxuICB0aGlzLmd1aVJlc2l6ZWQgPSBmdW5jdGlvbigpe1xuICAgIHRoaXMuZW1pdCgnZ3VpcmVzaXplZCcpO1xuICB9O1xuXG4gIC8qIHNwaW5uZXIgKi9cbiAgR1VJLnNob3dTcGlubmVyID0gZnVuY3Rpb24ob3B0aW9ucyl7fTtcblxuICBHVUkuaGlkZVNwaW5uZXIgPSBmdW5jdGlvbihpZCl7fTtcblxuICBcbiAgdGhpcy5ub3RpZnkgPSBub29wO1xuICB0aGlzLmRpYWxvZyA9IG5vb3A7XG59XG5cbmluaGVyaXQoR1VJLEczV09iamVjdCk7XG5cbm1vZHVsZS5leHBvcnRzID0gbmV3IEdVSTtcbiIsIm1vZHVsZS5leHBvcnRzID0gXCI8ZGl2PlxcbiAgTGlzdGEgZGkgb2dnZXR0aVxcbjwvZGl2PlxcblwiO1xuIiwidmFyIHJlc29sdmUgPSByZXF1aXJlKCdjb3JlL3V0aWxzL3V0aWxzJykucmVzb2x2ZTtcbnZhciByZWplY3QgPSByZXF1aXJlKCdjb3JlL3V0aWxzL3V0aWxzJykucmVqZWN0O1xudmFyIEdVSSA9IHJlcXVpcmUoJ2d1aS9ndWknKTtcbi8vdmFyIE1hcFNlcnZpY2UgPSByZXF1aXJlKCdjb3JlL21hcC9tYXBzZXJ2aWNlJyk7XG5cbnZhciBMaXN0UGFuZWxDb21wb25lbnQgPSBWdWUuZXh0ZW5kKHtcbiAgdGVtcGxhdGU6IHJlcXVpcmUoJy4vbGlzdHBhbmVsLmh0bWwnKSxcbiAgbWV0aG9kczoge1xuICAgIGV4ZWM6IGZ1bmN0aW9uKGNiayl7XG4gICAgICB2YXIgcmVsYXRpb25zID0gdGhpcy5zdGF0ZS5yZWxhdGlvbnMgfHwgbnVsbDtcbiAgICAgIGNiayh0aGlzLnN0YXRlLmZpZWxkcyxyZWxhdGlvbnMpO1xuICAgICAgR1VJLmNsb3NlRm9ybSgpO1xuICAgIH1cbiAgfVxufSk7XG5cblxuZnVuY3Rpb24gTGlzdFBhbmVsKG9wdGlvbnMpe1xuICAvLyBwcm9wcmlldMOgIG5lY2Vzc2FyaWUuIEluIGZ1dHVybyBsZSBtZXR0ZXJtbyBpbiB1bmEgY2xhc3NlIFBhbmVsIGRhIGN1aSBkZXJpdmVyYW5ubyB0dXR0aSBpIHBhbm5lbGxpIGNoZSB2b2dsaW9ubyBlc3NlcmUgbW9zdHJhdGkgbmVsbGEgc2lkZWJhclxuICB0aGlzLnBhbmVsQ29tcG9uZW50ID0gbnVsbDtcbiAgdGhpcy5vcHRpb25zID0gIG9wdGlvbnMgfHwge307XG4gIHRoaXMuaWQgPSBvcHRpb25zLmlkIHx8IG51bGw7IC8vIGlkIGRlbCBmb3JtXG4gIHRoaXMubmFtZSA9IG9wdGlvbnMubmFtZSB8fCBudWxsOyAvLyBub21lIGRlbCBmb3JtXG4gIFxuICB0aGlzLnN0YXRlID0ge1xuICAgIGxpc3Q6IG9wdGlvbnMubGlzdCB8fCBbXVxuICB9XG4gIFxuICB0aGlzLl9saXN0UGFuZWxDb21wb25lbnQgPSBvcHRpb25zLmxpc3RQYW5lbENvbXBvbmVudCB8fCBMaXN0UGFuZWxDb21wb25lbnQ7XG59XG5cbnZhciBwcm90byA9IExpc3RQYW5lbC5wcm90b3R5cGU7XG5cbi8vIHZpZW5lIHJpY2hpYW1hdG8gZGFsbGEgdG9vbGJhciBxdWFuZG8gaWwgcGx1Z2luIGNoaWVkZSBkaSBtb3N0cmFyZSB1biBwcm9wcmlvIHBhbm5lbGxvIG5lbGxhIEdVSSAoR1VJLnNob3dQYW5lbClcbnByb3RvLm9uU2hvdyA9IGZ1bmN0aW9uKGNvbnRhaW5lcil7XG4gIHZhciBwYW5lbCA9IHRoaXMuX3NldHVwUGFuZWwoKTtcbiAgdGhpcy5fbW91bnRQYW5lbChwYW5lbCxjb250YWluZXIpO1xuICByZXR1cm4gcmVzb2x2ZSh0cnVlKTtcbn07XG5cbi8vIHJpY2hpYW1hdG8gcXVhbmRvIGxhIEdVSSBjaGllZGUgZGkgY2hpdWRlcmUgaWwgcGFubmVsbG8uIFNlIHJpdG9ybmEgZmFsc2UgaWwgcGFubmVsbG8gbm9uIHZpZW5lIGNoaXVzb1xucHJvdG8ub25DbG9zZSA9IGZ1bmN0aW9uKCl7XG4gIHRoaXMucGFuZWxDb21wb25lbnQuJGRlc3Ryb3kodHJ1ZSk7XG4gIHRoaXMucGFuZWxDb21wb25lbnQgPSBudWxsO1xuICByZXR1cm4gcmVzb2x2ZSh0cnVlKTtcbn07XG5cbnByb3RvLl9zZXR1cFBhbmVsID0gZnVuY3Rpb24oKXtcbiAgdmFyIHBhbmVsID0gdGhpcy5wYW5lbENvbXBvbmVudCA9IG5ldyB0aGlzLl9saXN0UGFuZWxDb21wb25lbnQoe1xuICAgIHBhbmVsOiB0aGlzXG4gIH0pO1xuICBwYW5lbC5zdGF0ZSA9IHRoaXMuc3RhdGU7XG4gIHJldHVybiBwYW5lbFxufTtcblxucHJvdG8uX21vdW50UGFuZWwgPSBmdW5jdGlvbihwYW5lbCxjb250YWluZXIpe1xuICBwYW5lbC4kbW91bnQoKS4kYXBwZW5kVG8oY29udGFpbmVyKTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0ge1xuICBMaXN0UGFuZWxDb21wb25lbnQ6IExpc3RQYW5lbENvbXBvbmVudCxcbiAgTGlzdFBhbmVsOiBMaXN0UGFuZWxcbn1cbiIsInZhciBpbmhlcml0ID0gcmVxdWlyZSgnY29yZS91dGlscy91dGlscycpLmluaGVyaXQ7XG52YXIgYmFzZSA9IHJlcXVpcmUoJ2NvcmUvdXRpbHMvdXRpbHMnKS5iYXNlO1xudmFyIEczV09iamVjdCA9IHJlcXVpcmUoJ2NvcmUvZzN3b2JqZWN0Jyk7XG52YXIgR1VJID0gcmVxdWlyZSgnZ3VpL2d1aScpO1xudmFyIEFwcGxpY2F0aW9uU2VydmljZSA9IHJlcXVpcmUoJ2NvcmUvYXBwbGljYXRpb25zZXJ2aWNlJyk7XG52YXIgUHJvamVjdHNSZWdpc3RyeSA9IHJlcXVpcmUoJ2NvcmUvcHJvamVjdC9wcm9qZWN0c3JlZ2lzdHJ5Jyk7XG52YXIgUHJvamVjdFR5cGVzID0gcmVxdWlyZSgnY29yZS9wcm9qZWN0L3Byb2plY3R0eXBlcycpO1xudmFyIEdlb21ldHJ5VHlwZXMgPSByZXF1aXJlKCdjb3JlL2dlb21ldHJ5L2dlb21ldHJ5JykuR2VvbWV0cnlUeXBlcztcbnZhciBvbDNoZWxwZXJzID0gcmVxdWlyZSgnZzN3LW9sMy9zcmMvZzN3Lm9sMycpLmhlbHBlcnM7XG52YXIgUmVzZXRDb250cm9sID0gcmVxdWlyZSgnZzN3LW9sMy9zcmMvY29udHJvbHMvcmVzZXRjb250cm9sJyk7XG52YXIgUXVlcnlDb250cm9sID0gcmVxdWlyZSgnZzN3LW9sMy9zcmMvY29udHJvbHMvcXVlcnljb250cm9sJyk7XG52YXIgWm9vbUJveENvbnRyb2wgPSByZXF1aXJlKCdnM3ctb2wzL3NyYy9jb250cm9scy96b29tYm94Y29udHJvbCcpO1xudmFyIFBpY2tDb29yZGluYXRlc0ludGVyYWN0aW9uID0gcmVxdWlyZSgnZzN3LW9sMy9zcmMvaW50ZXJhY3Rpb25zL3BpY2tjb29yZGluYXRlc2ludGVyYWN0aW9uJyk7XG52YXIgV01TTGF5ZXIgPSByZXF1aXJlKCdjb3JlL2xheWVyL3dtc2xheWVyJyk7XG52YXIgUXVlcnlTZXJ2aWNlID0gcmVxdWlyZSgnY29yZS9xdWVyeS9xdWVyeXNlcnZpY2UnKTtcblxuXG4vL3ZhciBHVUkgPSByZXF1aXJlKCdndWkvZ3VpJyk7IC8vIFFVRVNUTyBOT04gQ0kgREVWRSBFU1NFUkUhISFcblxudmFyIFBpY2tUb2xlcmFuY2VQYXJhbXMgPSB7fTtcblBpY2tUb2xlcmFuY2VQYXJhbXNbUHJvamVjdFR5cGVzLlFESkFOR09dID0ge307XG5QaWNrVG9sZXJhbmNlUGFyYW1zW1Byb2plY3RUeXBlcy5RREpBTkdPXVtHZW9tZXRyeVR5cGVzLlBPSU5UXSA9IFwiRklfUE9JTlRfVE9MRVJBTkNFXCI7XG5QaWNrVG9sZXJhbmNlUGFyYW1zW1Byb2plY3RUeXBlcy5RREpBTkdPXVtHZW9tZXRyeVR5cGVzLkxJTkVTVFJJTkddID0gXCJGSV9MSU5FX1RPTEVSQU5DRVwiO1xuUGlja1RvbGVyYW5jZVBhcmFtc1tQcm9qZWN0VHlwZXMuUURKQU5HT11bR2VvbWV0cnlUeXBlcy5QT0xZR09OXSA9IFwiRklfUE9MWUdPTl9UT0xFUkFOQ0VcIjtcblxudmFyIFBpY2tUb2xlcmFuY2VWYWx1ZXMgPSB7fVxuUGlja1RvbGVyYW5jZVZhbHVlc1tHZW9tZXRyeVR5cGVzLlBPSU5UXSA9IDU7XG5QaWNrVG9sZXJhbmNlVmFsdWVzW0dlb21ldHJ5VHlwZXMuTElORVNUUklOR10gPSA1O1xuUGlja1RvbGVyYW5jZVZhbHVlc1tHZW9tZXRyeVR5cGVzLlBPTFlHT05dID0gNTtcblxuZnVuY3Rpb24gTWFwU2VydmljZShwcm9qZWN0KXtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICB0aGlzLmNvbmZpZztcbiAgdGhpcy52aWV3ZXI7XG4gIHRoaXMudGFyZ2V0O1xuICB0aGlzLl9tYXBDb250cm9scyA9IFtdLFxuICB0aGlzLm1hcExheWVycyA9IHt9O1xuICB0aGlzLm1hcEJhc2VMYXllcnMgPSB7fTtcbiAgdGhpcy5sYXllcnNBc3NvY2lhdGlvbiA9IHt9O1xuICB0aGlzLmxheWVyc0V4dHJhUGFyYW1zID0ge307XG4gIHRoaXMuc3RhdGUgPSB7XG4gICAgICBiYm94OiBbXSxcbiAgICAgIHJlc29sdXRpb246IG51bGwsXG4gICAgICBjZW50ZXI6IG51bGwsXG4gICAgICBsb2FkaW5nOiBmYWxzZVxuICB9O1xuICB0aGlzLmNvbmZpZyA9IEFwcGxpY2F0aW9uU2VydmljZS5nZXRDb25maWcoKS5tYXA7XG4gIFxuICB0aGlzLl9ob3dNYW55QXJlTG9hZGluZyA9IDA7XG4gIHRoaXMuX2luY3JlbWVudExvYWRlcnMgPSBmdW5jdGlvbigpe1xuICAgIGlmICh0aGlzLl9ob3dNYW55QXJlTG9hZGluZyA9PSAwKXtcbiAgICAgIHRoaXMuZW1pdCgnbG9hZHN0YXJ0Jyk7XG4gICAgfVxuICAgIHRoaXMuX2hvd01hbnlBcmVMb2FkaW5nICs9IDE7XG4gIH07XG4gIFxuICB0aGlzLl9kZWNyZW1lbnRMb2FkZXJzID0gZnVuY3Rpb24oKXtcbiAgICB0aGlzLl9ob3dNYW55QXJlTG9hZGluZyAtPSAxO1xuICAgIGlmICh0aGlzLl9ob3dNYW55QXJlTG9hZGluZyA9PSAwKXtcbiAgICAgIHRoaXMuZW1pdCgnbG9hZGVuZCcpO1xuICAgIH1cbiAgfTtcbiAgXG4gIHRoaXMuX2ludGVyYWN0aW9uc1N0YWNrID0gW107XG4gIGlmKCFfLmlzTmlsKHByb2plY3QpKSB7XG4gICAgdGhpcy5wcm9qZWN0ID0gcHJvamVjdDtcbiAgfVxuICBlbHNlIHtcbiAgICB0aGlzLnByb2plY3QgPSBQcm9qZWN0c1JlZ2lzdHJ5LmdldEN1cnJlbnRQcm9qZWN0KCk7XG4gIH1cblxuICBcbiAgdGhpcy5zZXR0ZXJzID0ge1xuICAgIHNldE1hcFZpZXc6IGZ1bmN0aW9uKGJib3gscmVzb2x1dGlvbixjZW50ZXIpe1xuICAgICAgdGhpcy5zdGF0ZS5iYm94ID0gYmJveDtcbiAgICAgIHRoaXMuc3RhdGUucmVzb2x1dGlvbiA9IHJlc29sdXRpb247XG4gICAgICB0aGlzLnN0YXRlLmNlbnRlciA9IGNlbnRlcjtcbiAgICAgIHRoaXMudXBkYXRlTWFwTGF5ZXJzKHRoaXMubWFwTGF5ZXJzKTtcbiAgICB9LFxuICAgIHNldHVwVmlld2VyOiBmdW5jdGlvbihpbml0aWFsUmVzb2x1dGlvbil7XG4gICAgICAvLyRzY3JpcHQoXCJodHRwOi8vZXBzZy5pby9cIitQcm9qZWN0U2VydmljZS5zdGF0ZS5wcm9qZWN0LmNycytcIi5qc1wiKTtcbiAgICAgIHByb2o0LmRlZnMoXCJFUFNHOlwiK3NlbGYucHJvamVjdC5zdGF0ZS5jcnMsdGhpcy5wcm9qZWN0LnN0YXRlLnByb2o0KTtcbiAgICAgIGlmIChzZWxmLnZpZXdlcikge1xuICAgICAgICBzZWxmLnZpZXdlci5kZXN0cm95KCk7XG4gICAgICAgIHNlbGYudmlld2VyID0gbnVsbDtcbiAgICAgIH1cbiAgICAgIHNlbGYuX3NldHVwVmlld2VyKGluaXRpYWxSZXNvbHV0aW9uKTtcbiAgICAgIHNlbGYuc2V0dXBDb250cm9scygpO1xuICAgICAgc2VsZi5zZXR1cExheWVycygpO1xuICAgICAgc2VsZi5lbWl0KCd2aWV3ZXJzZXQnKTtcbiAgICB9XG4gIH07XG4gIFxuICB0aGlzLl9zZXR1cFZpZXdlciA9IGZ1bmN0aW9uKGluaXRpYWxSZXNvbHV0aW9uKXtcbiAgICB2YXIgZXh0ZW50ID0gdGhpcy5wcm9qZWN0LnN0YXRlLmV4dGVudDtcbiAgICB2YXIgcHJvamVjdGlvbiA9IG5ldyBvbC5wcm9qLlByb2plY3Rpb24oe1xuICAgICAgY29kZTogXCJFUFNHOlwiK3RoaXMucHJvamVjdC5zdGF0ZS5jcnMsXG4gICAgICBleHRlbnQ6IGV4dGVudFxuICAgIH0pO1xuICAgIFxuICAgIC8qdmFyIGNvbnN0cmFpbl9leHRlbnQ7XG4gICAgaWYgKHRoaXMuY29uZmlnLmNvbnN0cmFpbnRleHRlbnQpIHtcbiAgICAgIHZhciBleHRlbnQgPSB0aGlzLmNvbmZpZy5jb25zdHJhaW50ZXh0ZW50O1xuICAgICAgdmFyIGR4ID0gZXh0ZW50WzJdLWV4dGVudFswXTtcbiAgICAgIHZhciBkeSA9IGV4dGVudFszXS1leHRlbnRbMV07XG4gICAgICB2YXIgZHg0ID0gZHgvNDtcbiAgICAgIHZhciBkeTQgPSBkeS80O1xuICAgICAgdmFyIGJib3hfeG1pbiA9IGV4dGVudFswXSArIGR4NDtcbiAgICAgIHZhciBiYm94X3htYXggPSBleHRlbnRbMl0gLSBkeDQ7XG4gICAgICB2YXIgYmJveF95bWluID0gZXh0ZW50WzFdICsgZHk0O1xuICAgICAgdmFyIGJib3hfeW1heCA9IGV4dGVudFszXSAtIGR5NDtcbiAgICAgIFxuICAgICAgY29uc3RyYWluX2V4dGVudCA9IFtiYm94X3htaW4sYmJveF95bWluLGJib3hfeG1heCxiYm94X3ltYXhdO1xuICAgIH0qL1xuICAgIFxuICAgIHRoaXMudmlld2VyID0gb2wzaGVscGVycy5jcmVhdGVWaWV3ZXIoe1xuICAgICAgaWQ6IHRoaXMudGFyZ2V0LFxuICAgICAgdmlldzoge1xuICAgICAgICBwcm9qZWN0aW9uOiBwcm9qZWN0aW9uLFxuICAgICAgICAvKmNlbnRlcjogdGhpcy5jb25maWcuaW5pdGNlbnRlciB8fCBvbC5leHRlbnQuZ2V0Q2VudGVyKGV4dGVudCksXG4gICAgICAgIHpvb206IHRoaXMuY29uZmlnLmluaXR6b29tIHx8IDAsXG4gICAgICAgIGV4dGVudDogdGhpcy5jb25maWcuY29uc3RyYWludGV4dGVudCB8fCBleHRlbnQsXG4gICAgICAgIG1pblpvb206IHRoaXMuY29uZmlnLm1pbnpvb20gfHwgMCwgLy8gZGVmYXVsdCBkaSBPTDMgMy4xNi4wXG4gICAgICAgIG1heFpvb206IHRoaXMuY29uZmlnLm1heHpvb20gfHwgMjggLy8gZGVmYXVsdCBkaSBPTDMgMy4xNi4wKi9cbiAgICAgICAgY2VudGVyOiBvbC5leHRlbnQuZ2V0Q2VudGVyKGV4dGVudCksXG4gICAgICAgIGV4dGVudDogZXh0ZW50LFxuICAgICAgICAvL21pblpvb206IDAsIC8vIGRlZmF1bHQgZGkgT0wzIDMuMTYuMFxuICAgICAgICAvL21heFpvb206IDI4IC8vIGRlZmF1bHQgZGkgT0wzIDMuMTYuMFxuICAgICAgICBtYXhSZXNvbHV0aW9uOiBpbml0aWFsUmVzb2x1dGlvblxuICAgICAgfVxuICAgIH0pO1xuICAgIFxuICAgIHRoaXMudmlld2VyLm1hcC5nZXRJbnRlcmFjdGlvbnMoKS5mb3JFYWNoKGZ1bmN0aW9uKGludGVyYWN0aW9uKXtcbiAgICAgIHNlbGYuX3dhdGNoSW50ZXJhY3Rpb24oaW50ZXJhY3Rpb24pO1xuICAgIH0pO1xuICAgIFxuICAgIHRoaXMudmlld2VyLm1hcC5nZXRJbnRlcmFjdGlvbnMoKS5vbignYWRkJyxmdW5jdGlvbihpbnRlcmFjdGlvbil7XG4gICAgICBzZWxmLl93YXRjaEludGVyYWN0aW9uKGludGVyYWN0aW9uLmVsZW1lbnQpO1xuICAgIH0pXG4gICAgXG4gICAgdGhpcy52aWV3ZXIubWFwLmdldEludGVyYWN0aW9ucygpLm9uKCdyZW1vdmUnLGZ1bmN0aW9uKGludGVyYWN0aW9uKXtcbiAgICAgIC8vc2VsZi5fb25SZW1vdmVJbnRlcmFjdGlvbihpbnRlcmFjdGlvbik7XG4gICAgfSk7XG4gIFxuICAgIFxuICAgIHRoaXMudmlld2VyLm1hcC5nZXRWaWV3KCkuc2V0UmVzb2x1dGlvbihpbml0aWFsUmVzb2x1dGlvbik7XG4gICAgXG4gICAgdGhpcy52aWV3ZXIubWFwLm9uKCdtb3ZlZW5kJyxmdW5jdGlvbihlKXtcbiAgICAgIHNlbGYuX3NldE1hcFZpZXcoKTtcbiAgICB9KTtcblxuICAgIC8vQUwgTU9NRU5UTyBMQVNDSU8gQ09Tw4wgUE9JIFZFRElBTU9cbiAgICBRdWVyeVNlcnZpY2UuaW5pdCh0aGlzLnZpZXdlci5tYXApO1xuXG4gICAgdGhpcy5lbWl0KCdyZWFkeScpO1xuICB9O1xuICBcbiAgdGhpcy5wcm9qZWN0Lm9uKCdwcm9qZWN0c3dpdGNoJyxmdW5jdGlvbigpe1xuICAgIHNlbGYuc2V0dXBMYXllcnMoKTtcbiAgfSk7XG4gIFxuICB0aGlzLnByb2plY3Qub25hZnRlcignc2V0TGF5ZXJzVmlzaWJsZScsZnVuY3Rpb24obGF5ZXJzKXtcbiAgICB2YXIgbWFwTGF5ZXJzID0gXy5tYXAobGF5ZXJzLGZ1bmN0aW9uKGxheWVyKXtcbiAgICAgIHJldHVybiBzZWxmLmdldE1hcExheWVyRm9yTGF5ZXIobGF5ZXIpO1xuICAgIH0pXG4gICAgc2VsZi51cGRhdGVNYXBMYXllcnMobWFwTGF5ZXJzKTtcbiAgfSk7XG4gIFxuICB0aGlzLnByb2plY3Qub25hZnRlcignc2V0QmFzZUxheWVyJyxmdW5jdGlvbigpe1xuICAgIHNlbGYudXBkYXRlTWFwTGF5ZXJzKHNlbGYubWFwQmFzZUxheWVycyk7XG4gIH0pO1xuICBcbiAgYmFzZSh0aGlzKTtcbn07XG5cbmluaGVyaXQoTWFwU2VydmljZSxHM1dPYmplY3QpO1xuXG52YXIgcHJvdG8gPSBNYXBTZXJ2aWNlLnByb3RvdHlwZTtcblxuLy8gcmVuZGUgcXVlc3RvIG1hcHNlcnZpY2Ugc2xhdmUgZGkgdW4gYWx0cm8gTWFwU2VydmljZVxucHJvdG8uc2xhdmVPZiA9IGZ1bmN0aW9uKG1hcFNlcnZpY2UsIHNhbWVMYXllcnMpe1xuICAvLyBzZSBpbXBvc3RhcmUgaSBsYXllciBpbml6aWFsaSB1Z3VhbGkgYSBxdWVsbGkgZGVsIG1hcFNlcnZpY2UgbWFzdGVyXG4gIHZhciBzYW1lTGF5ZXJzID0gc2FtZUxheWVycyB8fCBmYWxzZTtcbn07XG5cbnByb3RvLnNldExheWVyc0V4dHJhUGFyYW1zID0gZnVuY3Rpb24ocGFyYW1zLHVwZGF0ZSl7XG4gIHRoaXMubGF5ZXJzRXh0cmFQYXJhbXMgPSBfLmFzc2lnbih0aGlzLmxheWVyc0V4dHJhUGFyYW1zLHBhcmFtcyk7XG4gIHRoaXMuZW1pdCgnZXh0cmFQYXJhbXNTZXQnLHBhcmFtcyx1cGRhdGUpO1xufTtcblxucHJvdG8uZ2V0TWFwID0gZnVuY3Rpb24oKSB7XG4gIHJldHVybiB0aGlzLnZpZXdlci5tYXA7XG59O1xuXG5wcm90by5nZXRWaWV3ZXJFbGVtZW50ID0gZnVuY3Rpb24oKXtcbiAgcmV0dXJuIHRoaXMudmlld2VyLm1hcC5nZXRUYXJnZXRFbGVtZW50KCk7XG59O1xuXG5wcm90by5nZXRWaWV3cG9ydCA9IGZ1bmN0aW9uKCl7XG4gIHJldHVybiB0aGlzLnZpZXdlci5tYXAuZ2V0Vmlld3BvcnQoKTtcbn07XG5cbnByb3RvLnNldHVwQ29udHJvbHMgPSBmdW5jdGlvbigpe1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIHZhciBtYXAgPSBzZWxmLnZpZXdlci5tYXA7XG4gIGlmICh0aGlzLmNvbmZpZyAmJiB0aGlzLmNvbmZpZy5jb250cm9scykge1xuICAgIF8uZm9yRWFjaCh0aGlzLmNvbmZpZy5jb250cm9scyxmdW5jdGlvbihjb250cm9sVHlwZSl7XG4gICAgICB2YXIgY29udHJvbDtcbiAgICAgIHN3aXRjaCAoY29udHJvbFR5cGUpIHtcbiAgICAgICAgY2FzZSAncmVzZXQnOlxuICAgICAgICAgIGlmICghaXNNb2JpbGUuYW55KSB7XG4gICAgICAgICAgICBjb250cm9sID0gbmV3IFJlc2V0Q29udHJvbCgpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnem9vbSc6XG4gICAgICAgICAgY29udHJvbCA9IG5ldyBvbC5jb250cm9sLlpvb20oe1xuICAgICAgICAgICAgem9vbUluTGFiZWw6IFwiXFx1ZTk4YVwiLFxuICAgICAgICAgICAgem9vbU91dExhYmVsOiBcIlxcdWU5OGJcIlxuICAgICAgICAgIH0pO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICd6b29tYm94JzogXG4gICAgICAgICAgaWYgKCFpc01vYmlsZS5hbnkpIHtcbiAgICAgICAgICAgIGNvbnRyb2wgPSBuZXcgWm9vbUJveENvbnRyb2woKTtcbiAgICAgICAgICAgIGNvbnRyb2wub24oJ3pvb21lbmQnLGZ1bmN0aW9uKGUpe1xuICAgICAgICAgICAgICBzZWxmLnZpZXdlci5maXQoZS5leHRlbnQpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICB9XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgJ3pvb210b2V4dGVudCc6XG4gICAgICAgICAgY29udHJvbCA9IG5ldyBvbC5jb250cm9sLlpvb21Ub0V4dGVudCh7XG4gICAgICAgICAgICBsYWJlbDogIFwiXFx1ZTk4Y1wiLFxuICAgICAgICAgICAgZXh0ZW50OiBzZWxmLmNvbmZpZy5jb25zdHJhaW50ZXh0ZW50XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgJ3F1ZXJ5JzpcbiAgICAgICAgICBjb250cm9sID0gbmV3IFF1ZXJ5Q29udHJvbCgpO1xuICAgICAgICAgIGNvbnRyb2wub24oJ3BpY2tlZCcsZnVuY3Rpb24oZSl7XG4gICAgICAgICAgICB2YXIgY29vcmRpbmF0ZXMgPSBlLmNvb3JkaW5hdGVzO1xuICAgICAgICAgICAgdmFyIHNob3dRdWVyeVJlc3VsdHMgPSBHVUkuc2hvd1Jlc3VsdHNGYWN0b3J5KCdxdWVyeScpO1xuICAgICAgICAgICAgLy9CcnV0dG8gbWEgcmVpbXBvc3RvIG1hcExheWVycyB0dXR0ZSBsZSB2b2x0ZVxuICAgICAgICAgICAgdmFyIG1hcExheWVycyA9IHNlbGYubWFwTGF5ZXJzO1xuICAgICAgICAgICAgLy92ZXJpZmljbyBzZSBjaSBzb25vIGxheWVycyBzZWxlemlvbmF0aVxuICAgICAgICAgICAgdmFyIHNlbGVjdGVkTGF5ZXJzID0gc2VsZi5wcm9qZWN0LmdldFNlbGVjdGVkTGF5ZXJzKCk7XG4gICAgICAgICAgICBpZiAoc2VsZWN0ZWRMYXllcnMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgIF8uZm9yRWFjaChzZWxlY3RlZExheWVycywgZnVuY3Rpb24oc2VsZWN0ZWRMYXllcikge1xuICAgICAgICAgICAgICAgIF8uZm9yRWFjaChtYXBMYXllcnMsIGZ1bmN0aW9uKG1hcExheWVyKSB7XG4gICAgICAgICAgICAgICAgICBpZiAoXy5maW5kKG1hcExheWVyLmxheWVycywgc2VsZWN0ZWRMYXllcikpXHR7XG4gICAgICAgICAgICAgICAgICAgIG1hcExheWVyLmxheWVycyA9IHNlbGVjdGVkTGF5ZXJzO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZVxuICAgICAgICAgICAgICAgICAgfVx0XHRcbiAgICAgICAgICAgICAgICB9KTtcdFx0XG4gICAgICAgICAgICAgIH0pO1x0XHRcdFx0XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgLy9mYWNjaW8gcXVlcnkgYnkgbG9jYXRpb24gc3UgaSBsYXllcnMgc2VsZXppb25hdGkgbyB0dXR0aVxuICAgICAgICAgICAgdmFyIHF1ZXJ5UmVzdWx0c1BhbmVsID0gc2hvd1F1ZXJ5UmVzdWx0cygnaW50ZXJyb2dhemlvbmUnKTtcbiAgICAgICAgICAgIFF1ZXJ5U2VydmljZS5xdWVyeUJ5TG9jYXRpb24oY29vcmRpbmF0ZXMsIG1hcExheWVycywgc2VsZWN0ZWRMYXllcnMpXG4gICAgICAgICAgICAvL01hcFF1ZXJ5U2VydmljZS5xdWVyeVBvaW50KGNvb3JkaW5hdGVzLHNlbGYubWFwTGF5ZXJzKVxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzdWx0cyl7XG4gICAgICAgICAgICAgIHF1ZXJ5UmVzdWx0c1BhbmVsLnNldFF1ZXJ5UmVzcG9uc2UocmVzdWx0cyk7XG4gICAgICAgICAgICAgIC8vcml0cmFjY2lvIGkgTGF5ZXJzXG4gICAgICAgICAgICAgIC8vc2VsZi5zZXR1cExheWVycygpOyA/Pz8gYSBjaGUgc2VydmU/XG4gICAgICAgICAgICAgIC8vc2VsZi5lbWl0KCdtYXBxdWVyeWVuZCcsZmVhdHVyZXNGb3JMYXllcnMsbmZlYXR1cmVzLGNvb3JkaW5hdGVzLHNlbGYuc3RhdGUucmVzb2x1dGlvbik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlICdzY2FsZWxpbmUnOlxuICAgICAgICAgICAgLy9jb250cm9sID0gbmV3IG9sLmNvbnRyb2wuU2NhbGVMaW5lKClcbiAgICAgICAgICBicmVhaztcbiAgICAgIH07XG4gICAgICBpZiAoY29udHJvbCkge1xuICAgICAgICBzZWxmLmFkZENvbnRyb2woY29udHJvbCk7XG4gICAgICB9O1xuICAgIH0pO1xuICB9XG59O1xuXG5wcm90by5hZGRDb250cm9sID0gZnVuY3Rpb24oY29udHJvbCl7XG4gIHRoaXMudmlld2VyLm1hcC5hZGRDb250cm9sKGNvbnRyb2wpO1xuICB0aGlzLl9tYXBDb250cm9scy5wdXNoKGNvbnRyb2wpO1xufTtcblxucHJvdG8uc2V0dXBCYXNlTGF5ZXJzID0gZnVuY3Rpb24oKXtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICBpZiAoIXRoaXMucHJvamVjdC5zdGF0ZS5iYXNlbGF5ZXJzKXtcbiAgICByZXR1cm47XG4gIH1cbiAgdmFyIHNlbGYgPSB0aGlzO1xuICB0aGlzLm1hcEJhc2VMYXllcnMgPSB7fTtcbiAgXG4gIHZhciBpbml0QmFzZUxheWVyID0gUHJvamVjdHNSZWdpc3RyeS5jb25maWcuaW5pdGJhc2VsYXllcjtcbiAgdmFyIGJhc2VMYXllcnNBcnJheSA9IHRoaXMucHJvamVjdC5zdGF0ZS5iYXNlbGF5ZXJzO1xuICBcbiAgXy5mb3JFYWNoKGJhc2VMYXllcnNBcnJheSxmdW5jdGlvbihiYXNlTGF5ZXIpe1xuICAgIHZhciB2aXNpYmxlID0gdHJ1ZTtcbiAgICBpZiAoc2VsZi5wcm9qZWN0LnN0YXRlLmluaXRiYXNlbGF5ZXIpIHtcbiAgICAgIHZpc2libGUgPSBiYXNlTGF5ZXIuaWQgPT0gKHNlbGYucHJvamVjdC5zdGF0ZS5pbml0YmFzZWxheWVyKTtcbiAgICB9XG4gICAgaWYgKGJhc2VMYXllci5maXhlZCkge1xuICAgICAgdmlzaWJsZSA9IGJhc2VMYXllci5maXhlZDtcbiAgICB9XG4gICAgYmFzZUxheWVyLnZpc2libGUgPSB2aXNpYmxlO1xuICB9KVxuICBcbiAgYmFzZUxheWVyc0FycmF5LmZvckVhY2goZnVuY3Rpb24obGF5ZXIpeyAgICAgXG4gICAgdmFyIGNvbmZpZyA9IHtcbiAgICAgIHVybDogc2VsZi5wcm9qZWN0LmdldFdtc1VybCgpLFxuICAgICAgaWQ6IGxheWVyLmlkLFxuICAgICAgdGlsZWQ6IHRydWVcbiAgICB9O1xuICAgIFxuICAgIHZhciBtYXBMYXllciA9IG5ldyBXTVNMYXllcihjb25maWcpO1xuICAgIHNlbGYucmVnaXN0ZXJMaXN0ZW5lcnMobWFwTGF5ZXIpO1xuICAgIFxuICAgIG1hcExheWVyLmFkZExheWVyKGxheWVyKTtcbiAgICBzZWxmLm1hcEJhc2VMYXllcnNbbGF5ZXIuaWRdID0gbWFwTGF5ZXI7XG4gIH0pO1xuICBcbiAgXy5mb3JFYWNoKF8udmFsdWVzKHRoaXMubWFwQmFzZUxheWVycykucmV2ZXJzZSgpLGZ1bmN0aW9uKG1hcExheWVyKXtcbiAgICBzZWxmLnZpZXdlci5tYXAuYWRkTGF5ZXIobWFwTGF5ZXIuZ2V0T0xMYXllcigpKTtcbiAgICBtYXBMYXllci51cGRhdGUoc2VsZi5zdGF0ZSk7XG4gIH0pXG59O1xuXG5wcm90by5zZXR1cExheWVycyA9IGZ1bmN0aW9uKCl7XG4gIHZhciBzZWxmID0gdGhpcztcbiAgdGhpcy52aWV3ZXIucmVtb3ZlTGF5ZXJzKCk7XG4gIHRoaXMuc2V0dXBCYXNlTGF5ZXJzKCk7XG4gIHRoaXMubWFwTGF5ZXJzID0ge307XG4gIHRoaXMubGF5ZXJzQXNzb2NpYXRpb24gPSB7fTtcbiAgdmFyIGxheWVyc0FycmF5ID0gdGhpcy50cmF2ZXJzZUxheWVyc1RyZWUodGhpcy5wcm9qZWN0LnN0YXRlLmxheWVyc3RyZWUpO1xuICAvLyBwcmVuZG8gc29sbyBpIGxheWVyIHZlcmkgZSBub24gaSBmb2xkZXJcbiAgdmFyIGxlYWZMYXllcnNBcnJheSA9IF8uZmlsdGVyKGxheWVyc0FycmF5LGZ1bmN0aW9uKGxheWVyKXtcbiAgICByZXR1cm4gIV8uZ2V0KGxheWVyLCdub2RlcycpO1xuICB9KTtcbiAgLy9yYWdncnVwcG8gcGVyIHZhbG9yZSBkZWwgbXVsdGlsYXllciBjb24gY2hpYXZlIHZhbG9yZSBtdWx0aWxheWVyIGUgdmFsb3JlIGFycmF5XG4gIHZhciBtdWx0aUxheWVycyA9IF8uZ3JvdXBCeShsZWFmTGF5ZXJzQXJyYXksZnVuY3Rpb24obGF5ZXIpe1xuICAgIHJldHVybiBsYXllci5tdWx0aWxheWVyO1xuICB9KTtcbiAgXy5mb3JFYWNoKG11bHRpTGF5ZXJzLGZ1bmN0aW9uKGxheWVycyxpZCl7XG4gICAgdmFyIGxheWVySWQgPSAnbGF5ZXJfJytpZFxuICAgIHZhciBtYXBMYXllciA9IF8uZ2V0KHNlbGYubWFwTGF5ZXJzLCBsYXllcklkKTtcbiAgICAvLyBCUlVUVE8sIGRhIHNpc3RlbWFyZSBxdWFuZG8gcmlvcmdhbml6emVyZW1vIGkgbWV0YWxheWVyIChkYSBmYXIgZGl2ZW50YXJlIG11bHRpbGF5ZXIpLlxuICAgIC8vUGVyIG9yYSBwb3NzbyBjb25maWd1cmFyZSB0aWxlZCBzb2xvIGkgbGF5ZXIgc2luZ29saS5cbiAgICB2YXIgdGlsZWQgPSBsYXllcnNbMF0udGlsZWQ7XG4gICAgdmFyIGNvbmZpZyA9IHtcbiAgICAgIHVybDogc2VsZi5wcm9qZWN0LmdldFdtc1VybCgpLFxuICAgICAgaWQ6IGxheWVySWQsXG4gICAgICB0aWxlZDogdGlsZWRcbiAgICB9O1xuICAgIG1hcExheWVyID0gc2VsZi5tYXBMYXllcnNbbGF5ZXJJZF0gPSBuZXcgV01TTGF5ZXIoY29uZmlnLHNlbGYubGF5ZXJzRXh0cmFQYXJhbXMpO1xuICAgIHNlbGYucmVnaXN0ZXJMaXN0ZW5lcnMobWFwTGF5ZXIpO1xuICAgIGxheWVycy5mb3JFYWNoKGZ1bmN0aW9uKGxheWVyKXtcbiAgICAgIG1hcExheWVyLmFkZExheWVyKGxheWVyKTtcbiAgICAgIHNlbGYubGF5ZXJzQXNzb2NpYXRpb25bbGF5ZXIuaWRdID0gbGF5ZXJJZDtcbiAgICB9KTtcbiAgfSlcbiAgXG4gIF8uZm9yRWFjaChfLnZhbHVlcyh0aGlzLm1hcExheWVycykucmV2ZXJzZSgpLGZ1bmN0aW9uKG1hcExheWVyKXtcbiAgICBzZWxmLnZpZXdlci5tYXAuYWRkTGF5ZXIobWFwTGF5ZXIuZ2V0T0xMYXllcigpKTtcbiAgICBtYXBMYXllci51cGRhdGUoc2VsZi5zdGF0ZSxzZWxmLmxheWVyc0V4dHJhUGFyYW1zKTtcbiAgfSlcbiAgcmV0dXJuIHRoaXMubWFwTGF5ZXJzO1xufTtcblxucHJvdG8udXBkYXRlTWFwTGF5ZXJzID0gZnVuY3Rpb24obWFwTGF5ZXJzKSB7XG4gIHZhciBzZWxmID0gdGhpcztcbiAgXy5mb3JFYWNoKF8udmFsdWVzKG1hcExheWVycyksZnVuY3Rpb24obWFwTGF5ZXIpe1xuICAgIG1hcExheWVyLnVwZGF0ZShzZWxmLnN0YXRlLHNlbGYubGF5ZXJzRXh0cmFQYXJhbXMpO1xuICB9KVxufTtcblxucHJvdG8uZ2V0TWFwTGF5ZXJGb3JMYXllciA9IGZ1bmN0aW9uKGxheWVyKXtcbiAgcmV0dXJuIHRoaXMubWFwTGF5ZXJzWydsYXllcl8nK2xheWVyLm11bHRpbGF5ZXJdO1xufTtcblxucHJvdG8udHJhdmVyc2VMYXllcnNUcmVlID0gZnVuY3Rpb24obGF5ZXJzVHJlZSl7XG4gIHZhciBzZWxmID0gdGhpcztcbiAgdmFyIGxheWVyc0FycmF5ID0gW107XG4gIGZ1bmN0aW9uIHRyYXZlcnNlKG9iail7XG4gICAgXy5mb3JJbihvYmosIGZ1bmN0aW9uICh2YWwsIGtleSkge1xuICAgICAgICBpZiAoIV8uaXNOaWwodmFsLmlkKSkge1xuICAgICAgICAgICAgbGF5ZXJzQXJyYXkudW5zaGlmdCh2YWwpO1xuICAgICAgICB9XG4gICAgICAgIGlmICghXy5pc05pbCh2YWwubm9kZXMpKSB7XG4gICAgICAgICAgICB0cmF2ZXJzZSh2YWwubm9kZXMpO1xuICAgICAgICB9XG4gICAgfSk7XG4gIH1cbiAgdHJhdmVyc2UobGF5ZXJzVHJlZSk7XG4gIHJldHVybiBsYXllcnNBcnJheTtcbn07XG5cbnByb3RvLnJlZ2lzdGVyTGlzdGVuZXJzID0gZnVuY3Rpb24obWFwTGF5ZXIpe1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIG1hcExheWVyLm9uKCdsb2Fkc3RhcnQnLGZ1bmN0aW9uKCl7XG4gICAgc2VsZi5faW5jcmVtZW50TG9hZGVycygpO1xuICB9KTtcbiAgbWFwTGF5ZXIub24oJ2xvYWRlbmQnLGZ1bmN0aW9uKCl7XG4gICAgc2VsZi5fZGVjcmVtZW50TG9hZGVycyhmYWxzZSk7XG4gIH0pO1xuICBcbiAgdGhpcy5vbignZXh0cmFQYXJhbXNTZXQnLGZ1bmN0aW9uKGV4dHJhUGFyYW1zLHVwZGF0ZSl7XG4gICAgaWYgKHVwZGF0ZSkge1xuICAgICAgbWFwTGF5ZXIudXBkYXRlKHRoaXMuc3RhdGUsZXh0cmFQYXJhbXMpO1xuICAgIH1cbiAgfSlcbn07XG5cbnByb3RvLnNldFRhcmdldCA9IGZ1bmN0aW9uKGVsSWQpe1xuICB0aGlzLnRhcmdldCA9IGVsSWQ7XG59O1xuXG5cbi8vIHBlciBjcmVhcmUgdW5hIHBpbGEgZGkgb2wuaW50ZXJhY3Rpb24gaW4gY3VpIGwndWx0aW1vIGNoZSBzaSBhZ2dpdW5nZSBkaXNhdHRpdmEgdGVtcG9yYWVtZW50ZSBpIHByZWNlZGVudGkgKHBlciBwb2kgdG9nbGllcnNpIGRpIG1lenpvIGNvbiBwb3BJbnRlcmFjdGlvbiEpXG4vLyBVc2F0byBhZCBlcy4gZGEgcGlja2ZlYXR1cmV0b29sIGUgZ2V0ZmVhdHVyZWluZm9cbnByb3RvLnB1c2hJbnRlcmFjdGlvbiA9IGZ1bmN0aW9uKGludGVyYWN0aW9uKXtcbiAgdGhpcy5fdW5zZXRDb250cm9scygpO1xuICBpZiAodGhpcy5faW50ZXJhY3Rpb25zU3RhY2subGVuZ3RoKXtcbiAgICB2YXIgcHJldkludGVyYWN0aW9uID0gdGhpcy5faW50ZXJhY3Rpb25zU3RhY2suc2xpY2UoLTEpWzBdO1xuICAgIGlmIChfLmlzQXJyYXkocHJldkludGVyYWN0aW9uKSl7XG4gICAgICBfLmZvckVhY2gocHJldkludGVyYWN0aW9uLGZ1bmN0aW9uKGludGVyYWN0aW9uKXtcbiAgICAgICAgaW50ZXJhY3Rpb24uc2V0QWN0aXZlKGZhbHNlKTtcbiAgICAgIH0pXG4gICAgfVxuICAgIGVsc2V7XG4gICAgICBwcmV2SW50ZXJhY3Rpb24uc2V0QWN0aXZlKGZhbHNlKTtcbiAgICB9O1xuICB9XG4gIFxuICB0aGlzLnZpZXdlci5tYXAuYWRkSW50ZXJhY3Rpb24oaW50ZXJhY3Rpb24pO1xuICBpbnRlcmFjdGlvbi5zZXRBY3RpdmUodHJ1ZSk7XG4gIHRoaXMuX2ludGVyYWN0aW9uc1N0YWNrLnB1c2goaW50ZXJhY3Rpb24pXG59O1xuXG5wcm90by5wb3BJbnRlcmFjdGlvbiA9IGZ1bmN0aW9uKCl7XG4gIHZhciBpbnRlcmFjdGlvbiA9IHRoaXMuX2ludGVyYWN0aW9uc1N0YWNrLnBvcCgpO1xuICB0aGlzLnZpZXdlci5tYXAucmVtb3ZlSW50ZXJhY3Rpb24oaW50ZXJhY3Rpb24pO1xuICBcbiAgaWYgKHRoaXMuX2ludGVyYWN0aW9uc1N0YWNrLmxlbmd0aCl7XG4gICAgdmFyIHByZXZJbnRlcmFjdGlvbiA9IHRoaXMuX2ludGVyYWN0aW9uc1N0YWNrLnNsaWNlKC0xKVswXTtcbiAgICBpZiAoXy5pc0FycmF5KHByZXZJbnRlcmFjdGlvbikpe1xuICAgICAgXy5mb3JFYWNoKHByZXZJbnRlcmFjdGlvbixmdW5jdGlvbihpbnRlcmFjdGlvbil7XG4gICAgICAgIGludGVyYWN0aW9uLnNldEFjdGl2ZSh0cnVlKTtcbiAgICAgIH0pXG4gICAgfVxuICAgIGVsc2V7XG4gICAgICBwcmV2SW50ZXJhY3Rpb24uc2V0QWN0aXZlKHRydWUpO1xuICAgIH07XG4gIH1cbn07XG5cbnByb3RvLl93YXRjaEludGVyYWN0aW9uID0gZnVuY3Rpb24oaW50ZXJhY3Rpb24pIHtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICBpbnRlcmFjdGlvbi5vbignY2hhbmdlOmFjdGl2ZScsZnVuY3Rpb24oZSl7XG4gICAgLy9jb25zb2xlLmxvZygoZS50YXJnZXQgaW5zdGFuY2VvZiBvbC5pbnRlcmFjdGlvbi5Qb2ludGVyKSArICctJyArIGUudGFyZ2V0LmdldEFjdGl2ZSgpKTtcbiAgICBpZiAoKGUudGFyZ2V0IGluc3RhbmNlb2Ygb2wuaW50ZXJhY3Rpb24uUG9pbnRlcikgJiYgZS50YXJnZXQuZ2V0QWN0aXZlKCkpIHtcbiAgICAgIHNlbGYuZW1pdCgncG9pbnRlckludGVyYWN0aW9uU2V0JyxlLnRhcmdldCk7XG4gICAgfVxuICB9KVxufTtcblxucHJvdG8uZ29UbyA9IGZ1bmN0aW9uKGNvb3JkaW5hdGVzLHpvb20pe1xuICB2YXIgem9vbSA9IHpvb20gfHwgNjtcbiAgdGhpcy52aWV3ZXIuZ29Ubyhjb29yZGluYXRlcyx6b29tKTtcbn07XG5cbnByb3RvLmdvVG9XR1M4NCA9IGZ1bmN0aW9uKGNvb3JkaW5hdGVzLHpvb20pe1xuICB2YXIgY29vcmRpbmF0ZXMgPSBvbC5wcm9qLnRyYW5zZm9ybShjb29yZGluYXRlcywnRVBTRzo0MzI2JywnRVBTRzonK3RoaXMucHJvamVjdC5zdGF0ZS5jcnMpO1xuICB0aGlzLmdvVG8oY29vcmRpbmF0ZXMsem9vbSk7XG59O1xuXG5wcm90by5leHRlbnRUb1dHUzg0ID0gZnVuY3Rpb24oZXh0ZW50KXtcbiAgcmV0dXJuIG9sLnByb2oudHJhbnNmb3JtRXh0ZW50KGV4dGVudCwnRVBTRzonK3RoaXMucHJvamVjdC5zdGF0ZS5jcnMsJ0VQU0c6NDMyNicpO1xufTtcblxucHJvdG8uZ2V0RmVhdHVyZUluZm8gPSBmdW5jdGlvbihsYXllcklkKXtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICB2YXIgZGVmZXJyZWQgPSAkLkRlZmVycmVkKCk7XG4gIHRoaXMuX3BpY2tJbnRlcmFjdGlvbiA9IG5ldyBQaWNrQ29vcmRpbmF0ZXNJbnRlcmFjdGlvbigpO1xuICAvL3RoaXMudmlld2VyLm1hcC5hZGRJbnRlcmFjdGlvbih0aGlzLl9waWNrSW50ZXJhY3Rpb24pO1xuICAvL3RoaXMuX3BpY2tJbnRlcmFjdGlvbi5zZXRBY3RpdmUodHJ1ZSk7XG4gIHRoaXMucHVzaEludGVyYWN0aW9uKHRoaXMuX3BpY2tJbnRlcmFjdGlvbik7XG4gIHRoaXMuX3BpY2tJbnRlcmFjdGlvbi5vbigncGlja2VkJyxmdW5jdGlvbihlKXtcbiAgICBzZWxmLl9jb21wbGV0ZUdldEZlYXR1cmVJbmZvKGxheWVySWQsZS5jb29yZGluYXRlLGRlZmVycmVkKTtcbiAgfSlcbiAgcmV0dXJuIGRlZmVycmVkLnByb21pc2UoKTtcbn07XG5cbnByb3RvLl9jb21wbGV0ZUdldEZlYXR1cmVJbmZvID0gZnVuY3Rpb24obGF5ZXJJZCxjb29yZGluYXRlLGRlZmVycmVkKXtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICB2YXIgcHJvamVjdFR5cGUgPSB0aGlzLnByb2plY3Quc3RhdGUudHlwZTtcbiAgXG4gIHZhciBtYXBMYXllciA9IHRoaXMubWFwTGF5ZXJzW3RoaXMubGF5ZXJzQXNzb2NpYXRpb25bbGF5ZXJJZF1dO1xuICB2YXIgcmVzb2x1dGlvbiA9IHRoaXMudmlld2VyLmdldFJlc29sdXRpb24oKTtcbiAgdmFyIGVwc2cgPSBzZWxmLnZpZXdlci5tYXAuZ2V0VmlldygpLmdldFByb2plY3Rpb24oKS5nZXRDb2RlKCk7XG4gIHZhciBwYXJhbXMgPSB7XG4gICAgUVVFUllfTEFZRVJTOiB0aGlzLnByb2plY3QuZ2V0TGF5ZXIobGF5ZXJJZCkubmFtZSxcbiAgICBJTkZPX0ZPUk1BVDogXCJ0ZXh0L3htbFwiXG4gIH1cbiAgXG4gIGlmIChwcm9qZWN0VHlwZSA9PSBQcm9qZWN0VHlwZXMuUURKQU5HTyl7XG4gICAgdmFyIHRvbGVyYW5jZVBhcmFtcyA9IFBpY2tUb2xlcmFuY2VQYXJhbXNbcHJvamVjdFR5cGVdO1xuICAgIGlmICh0b2xlcmFuY2VQYXJhbXMpe1xuICAgICAgdmFyIGdlb21ldHJ5dHlwZSA9IHRoaXMucHJvamVjdC5nZXRMYXllcihsYXllcklkKS5nZW9tZXRyeXR5cGU7XG4gICAgICBwYXJhbXNbdG9sZXJhbmNlUGFyYW1zW2dlb21ldHJ5dHlwZV1dID0gUGlja1RvbGVyYW5jZVZhbHVlc1tnZW9tZXRyeXR5cGVdO1xuICAgIH1cbiAgfVxuICBcbiAgdmFyIGdldEZlYXR1cmVJbmZvVXJsID0gbWFwTGF5ZXIuZ2V0U291cmNlKCkuZ2V0R2V0RmVhdHVyZUluZm9VcmwoY29vcmRpbmF0ZSxyZXNvbHV0aW9uLGVwc2cscGFyYW1zKTtcbiAgJC5nZXQoZ2V0RmVhdHVyZUluZm9VcmwpXG4gIC50aGVuKGZ1bmN0aW9uKGRhdGEpe1xuICAgIHZhciB4MmpzID0gbmV3IFgySlMoKTtcbiAgICB2YXIganNvbkRhdGEgPSB4MmpzLnhtbDJqc29uKGRhdGEpO1xuICAgIGlmIChqc29uRGF0YS5HZXRGZWF0dXJlSW5mb1Jlc3BvbnNlLkxheWVyLkZlYXR1cmUpe1xuICAgICAgdmFyIGF0dHJpYnV0ZXMgPSBqc29uRGF0YS5HZXRGZWF0dXJlSW5mb1Jlc3BvbnNlLkxheWVyLkZlYXR1cmUuQXR0cmlidXRlO1xuICAgICAgdmFyIGF0dHJpYnV0ZXNPYmogPSB7fTtcbiAgICAgIF8uZm9yRWFjaChhdHRyaWJ1dGVzLGZ1bmN0aW9uKGF0dHJpYnV0ZSl7XG4gICAgICAgIGF0dHJpYnV0ZXNPYmpbYXR0cmlidXRlLl9uYW1lXSA9IGF0dHJpYnV0ZS5fdmFsdWU7IC8vIFgySlMgYWdnaXVuZ2UgXCJfXCIgY29tZSBwcmVmaXNzbyBkZWdsaSBhdHRyaWJ1dGlcbiAgICAgIH0pXG4gICAgICBcbiAgICAgIGRlZmVycmVkLnJlc29sdmUoYXR0cmlidXRlc09iaik7XG4gICAgfVxuICAgIGRlZmVycmVkLnJlamVjdCgpOztcbiAgfSlcbiAgLmZhaWwoZnVuY3Rpb24oKXtcbiAgICBkZWZlcnJlZC5yZWplY3QoKTtcbiAgfSlcbiAgLmFsd2F5cyhmdW5jdGlvbigpe1xuICAgIC8vc2VsZi52aWV3ZXIubWFwLnJlbW92ZUludGVyYWN0aW9uKHNlbGYuX3BpY2tJbnRlcmFjdGlvbik7XG4gICAgc2VsZi5wb3BJbnRlcmFjdGlvbigpO1xuICAgIHNlbGYuX3BpY2tJbnRlcmFjdGlvbiA9IG51bGw7XG4gIH0pXG59O1xuXG5wcm90by5oaWdobGlnaHRHZW9tZXRyeSA9IGZ1bmN0aW9uKGdlb21ldHJ5T2JqLG9wdGlvbnMpeyAgICBcbiAgdmFyIGdlb21ldHJ5O1xuICBpZiAoZ2VvbWV0cnlPYmogaW5zdGFuY2VvZiBvbC5nZW9tLkdlb21ldHJ5KXtcbiAgICBnZW9tZXRyeSA9IGdlb21ldHJ5T2JqO1xuICB9XG4gIGVsc2Uge1xuICAgIGZvcm1hdCA9IG5ldyBvbC5mb3JtYXQuR2VvSlNPTjtcbiAgICBnZW9tZXRyeSA9IGZvcm1hdC5yZWFkR2VvbWV0cnkoZ2VvbWV0cnlPYmopO1xuICB9XG4gIFxuICBpZiAob3B0aW9ucy56b29tKSB7XG4gICAgdGhpcy52aWV3ZXIuZml0KGdlb21ldHJ5KTtcbiAgfVxuICBcbiAgdmFyIGR1cmF0aW9uID0gb3B0aW9ucy5kdXJhdGlvbiB8fCA0MDAwO1xuICBcbiAgaWYgKG9wdGlvbnMuZnJvbVdHUzg0KSB7XG4gICAgZ2VvbWV0cnkudHJhbnNmb3JtKCdFUFNHOjQzMjYnLCdFUFNHOicrdGhpcy5wcm9qZWN0LnByb2plY3QuY3JzKTtcbiAgfVxuICBcbiAgdmFyIGZlYXR1cmUgPSBuZXcgb2wuRmVhdHVyZSh7XG4gICAgZ2VvbWV0cnk6IGdlb21ldHJ5XG4gIH0pO1xuICB2YXIgc291cmNlID0gbmV3IG9sLnNvdXJjZS5WZWN0b3IoKTtcbiAgc291cmNlLmFkZEZlYXR1cmVzKFtmZWF0dXJlXSk7XG4gIHZhciBsYXllciA9IG5ldyBvbC5sYXllci5WZWN0b3Ioe1xuICAgIHNvdXJjZTogc291cmNlLFxuICAgIHN0eWxlOiBmdW5jdGlvbihmZWF0dXJlKXtcbiAgICAgIHZhciBzdHlsZXMgPSBbXTtcbiAgICAgIHZhciBnZW9tZXRyeVR5cGUgPSBmZWF0dXJlLmdldEdlb21ldHJ5KCkuZ2V0VHlwZSgpO1xuICAgICAgaWYgKGdlb21ldHJ5VHlwZSA9PSAnTGluZVN0cmluZycpIHtcbiAgICAgICAgdmFyIHN0eWxlID0gbmV3IG9sLnN0eWxlLlN0eWxlKHtcbiAgICAgICAgICBzdHJva2U6IG5ldyBvbC5zdHlsZS5TdHJva2Uoe1xuICAgICAgICAgICAgY29sb3I6ICdyZ2IoMjU1LDI1NSwwKScsXG4gICAgICAgICAgICB3aWR0aDogNFxuICAgICAgICAgIH0pXG4gICAgICAgIH0pXG4gICAgICAgIHN0eWxlcy5wdXNoKHN0eWxlKTtcbiAgICAgIH1cbiAgICAgIGVsc2UgaWYgKGdlb21ldHJ5VHlwZSA9PSAnUG9pbnQnKXtcbiAgICAgICAgdmFyIHN0eWxlID0gbmV3IG9sLnN0eWxlLlN0eWxlKHtcbiAgICAgICAgICBpbWFnZTogbmV3IG9sLnN0eWxlLkNpcmNsZSh7XG4gICAgICAgICAgICByYWRpdXM6IDYsXG4gICAgICAgICAgICBmaWxsOiBuZXcgb2wuc3R5bGUuRmlsbCh7XG4gICAgICAgICAgICAgIGNvbG9yOiAncmdiKDI1NSwyNTUsMCknLFxuICAgICAgICAgICAgfSlcbiAgICAgICAgICB9KSxcbiAgICAgICAgICB6SW5kZXg6IEluZmluaXR5XG4gICAgICAgIH0pO1xuICAgICAgICBzdHlsZXMucHVzaChzdHlsZSk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIHJldHVybiBzdHlsZXM7XG4gICAgfVxuICB9KVxuICBsYXllci5zZXRNYXAodGhpcy52aWV3ZXIubWFwKTtcbiAgXG4gIHNldFRpbWVvdXQoZnVuY3Rpb24oKXtcbiAgICBsYXllci5zZXRNYXAobnVsbCk7XG4gIH0sZHVyYXRpb24pO1xufTtcblxucHJvdG8ucmVmcmVzaE1hcCA9IGZ1bmN0aW9uKCl7XG4gIF8uZm9yRWFjaCh0aGlzLm1hcExheWVycyxmdW5jdGlvbih3bXNMYXllcil7XG4gICAgd21zTGF5ZXIuZ2V0T0xMYXllcigpLmdldFNvdXJjZSgpLnVwZGF0ZVBhcmFtcyh7XCJ0aW1lXCI6IERhdGUubm93KCl9KTtcbiAgfSlcbn07XG5cbnByb3RvLnJlc2l6ZSA9IGZ1bmN0aW9uKHdpZHRoLGhlaWdodCkge1xuICBpZiAoIXRoaXMudmlld2VyKSB7XG4gICAgdmFyIGluaXRpYWxFeHRlbnQgPSB0aGlzLnByb2plY3Quc3RhdGUuZXh0ZW50O1xuICAgIHZhciB4UmVzID0gb2wuZXh0ZW50LmdldFdpZHRoKGluaXRpYWxFeHRlbnQpIC8gd2lkdGg7XG4gICAgdmFyIHlSZXMgPSBvbC5leHRlbnQuZ2V0SGVpZ2h0KGluaXRpYWxFeHRlbnQpIC8gaGVpZ2h0O1xuICAgIHZhciByZXMgPSBNYXRoLm1heCh4UmVzLHlSZXMpO1xuICAgIHRoaXMuc2V0dXBWaWV3ZXIocmVzKTtcbiAgfVxuICB0aGlzLmdldE1hcCgpLnVwZGF0ZVNpemUoKTtcbiAgdGhpcy5fc2V0TWFwVmlldygpO1xufTtcblxucHJvdG8uX3Vuc2V0Q29udHJvbHMgPSBmdW5jdGlvbigpIHtcbiAgXy5mb3JFYWNoKHRoaXMuX21hcENvbnRyb2xzLGZ1bmN0aW9uKGNvbnRyb2wpe1xuICAgIGlmIChjb250cm9sLnRvZ2dsZSkge1xuICAgICAgY29udHJvbC50b2dnbGUoZmFsc2UpO1xuICAgIH1cbiAgfSlcbn07XG5cbnByb3RvLl9zZXRNYXBWaWV3ID0gZnVuY3Rpb24oKXtcbiAgdmFyIGJib3ggPSB0aGlzLnZpZXdlci5nZXRCQk9YKCk7XG4gIHZhciByZXNvbHV0aW9uID0gdGhpcy52aWV3ZXIuZ2V0UmVzb2x1dGlvbigpO1xuICB2YXIgY2VudGVyID0gdGhpcy52aWV3ZXIuZ2V0Q2VudGVyKCk7XG4gIHRoaXMuc2V0TWFwVmlldyhiYm94LHJlc29sdXRpb24sY2VudGVyKTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gTWFwU2VydmljZVxuIiwibW9kdWxlLmV4cG9ydHMgPSBcIjxkaXYgaWQ9XFxcIm1hcFxcXCIgc3R5bGU9XFxcIndpZHRoOjEwMCU7aGVpZ2h0OjEwMCVcXFwiPjwvZGl2PlxcblwiO1xuIiwidmFyIGluaGVyaXQgPSByZXF1aXJlKCdjb3JlL3V0aWxzL3V0aWxzJykuaW5oZXJpdDtcbnZhciBiYXNlID0gcmVxdWlyZSgnY29yZS91dGlscy91dGlscycpLmJhc2U7XG52YXIgbWVyZ2UgPSByZXF1aXJlKCdjb3JlL3V0aWxzL3V0aWxzJykubWVyZ2U7XG52YXIgdCA9IHJlcXVpcmUoJ2NvcmUvaTE4bi9pMThuLnNlcnZpY2UnKS50O1xudmFyIHJlc29sdmUgPSByZXF1aXJlKCdjb3JlL3V0aWxzL3V0aWxzJykucmVzb2x2ZTtcbnZhciBHVUkgPSByZXF1aXJlKCdndWkvZ3VpJyk7ICAgXG52YXIgQ29tcG9uZW50ID0gcmVxdWlyZSgnZ3VpL3Z1ZS9jb21wb25lbnQnKTtcbnZhciBSb3V0ZXJTZXJ2aWNlID0gcmVxdWlyZSgnY29yZS9yb3V0ZXInKTtcbnZhciBvbDNoZWxwZXJzID0gcmVxdWlyZSgnZzN3LW9sMy9zcmMvZzN3Lm9sMycpLmhlbHBlcnM7XG52YXIgTWFwc1JlZ2lzdHJ5ID0gcmVxdWlyZSgnY29yZS9tYXAvbWFwc3JlZ2lzdHJ5Jyk7XG52YXIgTWFwU2VydmljZSA9IHJlcXVpcmUoJy4uL21hcHNlcnZpY2UnKTtcblxudmFyIHZ1ZUNvbXBvbmVudE9wdGlvbnMgPSB7XG4gIHRlbXBsYXRlOiByZXF1aXJlKCcuL21hcC5odG1sJyksXG4gIHJlYWR5OiBmdW5jdGlvbigpe1xuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICBcbiAgICB2YXIgbWFwU2VydmljZSA9IHRoaXMuJG9wdGlvbnMubWFwU2VydmljZTtcbiAgICBcbiAgICBtYXBTZXJ2aWNlLnNldFRhcmdldCh0aGlzLiRlbC5pZCk7XG4gICAgXG4gICAgLy8gcXVlc3RvIHNlcnZlIHBlciBxdWFuZG8gdmllbmUgY2FtYmlhdG8gcHJvZ2V0dG8vdmlzdGEgY2FydG9ncmFmaWNhLCBpbiBjdWkgdmllbmUgcmljcmVhdG8gaWwgdmlld2VyIChlIHF1aW5kaSBsYSBtYXBwYSlcbiAgICBtYXBTZXJ2aWNlLm9uYWZ0ZXIoJ3NldHVwVmlld2VyJyxmdW5jdGlvbigpe1xuICAgICAgbWFwU2VydmljZS5zZXRUYXJnZXQoc2VsZi4kZWwuaWQpO1xuICAgIH0pO1xuICB9XG59XG5cbnZhciBJbnRlcm5hbENvbXBvbmVudCA9IFZ1ZS5leHRlbmQodnVlQ29tcG9uZW50T3B0aW9ucyk7XG5cblZ1ZS5jb21wb25lbnQoJ2czdy1tYXAnLCB2dWVDb21wb25lbnRPcHRpb25zKTtcblxuZnVuY3Rpb24gTWFwQ29tcG9uZW50KG9wdGlvbnMpe1xuICBiYXNlKHRoaXMsb3B0aW9ucyk7XG4gIHRoaXMuaWQgPSBcIm1hcC1jb21wb25lbnRcIjtcbiAgdGhpcy50aXRsZSA9IFwiQ2F0YWxvZ28gZGF0aVwiO1xuICB0aGlzLl9zZXJ2aWNlID0gbmV3IE1hcFNlcnZpY2U7XG4gIG1lcmdlKHRoaXMsIG9wdGlvbnMpO1xuICB0aGlzLmludGVybmFsQ29tcG9uZW50ID0gbmV3IEludGVybmFsQ29tcG9uZW50KHtcbiAgICBtYXBTZXJ2aWNlOiB0aGlzLl9zZXJ2aWNlXG4gIH0pO1xufTtcblxuaW5oZXJpdChNYXBDb21wb25lbnQsIENvbXBvbmVudCk7XG52YXIgcHJvdG8gPSBNYXBDb21wb25lbnQucHJvdG90eXBlO1xuXG5wcm90by5sYXlvdXQgPSBmdW5jdGlvbih3aWR0aCxoZWlnaHQpIHtcbiAgJChcIiNtYXBcIikuaGVpZ2h0KGhlaWdodCk7XG4gICQoXCIjbWFwXCIpLndpZHRoKHdpZHRoKTtcbiAgdGhpcy5fc2VydmljZS5yZXNpemUod2lkdGgsaGVpZ2h0KTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gIE1hcENvbXBvbmVudDtcbiIsInZhciBpbmhlcml0ID0gcmVxdWlyZSgnY29yZS91dGlscy91dGlscycpLmluaGVyaXQ7XG52YXIgcmVzb2x2ZWRWYWx1ZSA9IHJlcXVpcmUoJ2NvcmUvdXRpbHMvdXRpbHMnKS5yZXNvbHZlO1xudmFyIEczV09iamVjdCA9IHJlcXVpcmUoJ2NvcmUvZzN3b2JqZWN0Jyk7XG5cbnZhciBQYW5lbCA9IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgc2VsZiA9IHRoaXM7XG4gIHRoaXMuaW50ZXJuYWxQYW5lbCA9IG51bGw7XG4gIHZhciBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcbiAgc2VsZi5pZCA9IG9wdGlvbnMuaWQgfHwgbnVsbDtcbiAgc2VsZi50aXRsZSA9IG9wdGlvbnMudGl0bGUgfHwgJyc7XG59O1xuXG5pbmhlcml0KFBhbmVsLCBHM1dPYmplY3QpO1xuXG52YXIgcHJvdG8gPSBQYW5lbC5wcm90b3R5cGU7XG5cbnByb3RvLmdldElkID0gZnVuY3Rpb24oKXtcbiAgcmV0dXJuIHRoaXMuaWQ7XG59O1xuXG5wcm90by5nZXRUaXRsZSA9IGZ1bmN0aW9uKCl7XG4gIHJldHVybiB0aGlzLnRpdGxlO1xufTtcblxuLyogSE9PS1MgKi9cblxuLypcbiAqIElsIG1ldG9kbyBwZXJtZXR0ZSBhbCBwYW5uZWxsbyBkaSBtb250YXJzaSBuZWwgRE9NXG4gKiBwYXJlbnQ6IGVsZW1lbnRvIERPTSBwYWRyZSwgc3UgY3VpIGluc2VyaXJzaTtcbiAqIHJpdG9ybmEgdW5hIHByb21pc2UsIHJpc29sdGEgbmVsIG1vbWVudG8gaW4gY3VpIHNhcsOgIHRlcm1pbmF0byBpbCBtb250YWdnaW9cbiovXG5cbi8vIFNPTk8gRFVFIFRJUE9MT0dJRSBESSBNT05UQUdHSU8gQ09OIElMIFFVQUxFIElMIFBBTk5FTExPXG4vLyBDSEUgVkVSUkEnIE1PTlRBVE8gQUwgVk9MTyBDT04gSUwgTUVUT0RPIE1PVU5UIEEgU0VDT05EQSBERUwgVElQTyBESSBQQU5ORUxMTyBSSUNISUVTVE9cblxuLy8gcmljaGlhbWF0byBxdWFuZG8gbGEgR1VJIGNoaWVkZSBkaSBjaGl1ZGVyZSBpbCBwYW5uZWxsby4gU2Ugcml0b3JuYSBmYWxzZSBpbCBwYW5uZWxsbyBub24gdmllbmUgY2hpdXNvXG5cbnByb3RvLm1vdW50ID0gZnVuY3Rpb24ocGFyZW50KSB7XG4gIHZhciBwYW5lbCA9IHRoaXMuaW50ZXJuYWxQYW5lbDtcbiAgcGFuZWwuJG1vdW50KCkuJGFwcGVuZFRvKHBhcmVudCk7XG4gICQocGFyZW50KS5sb2NhbGl6ZSgpO1xuICByZXR1cm4gcmVzb2x2ZWRWYWx1ZSh0cnVlKTtcbn07XG5cbi8qXG4gKiBNZXRvZG8gcmljaGlhbWF0byBxdWFuZG8gc2kgdnVvbGUgcmltdW92ZXJlIGlsIHBhbmVsbG8uXG4gKiBSaXRvcm5hIHVuYSBwcm9tZXNzYSBjaGUgc2Fyw6Agcmlzb2x0YSBuZWwgbW9tZW50byBpbiBjdWkgaWwgcGFubmVsbG8gYXZyw6AgY29tcGxldGF0byBsYSBwcm9wcmlhIHJpbW96aW9uZSAoZWQgZXZlbnR1YWxlIHJpbGFzY2lvIGRpIHJpc29yc2UgZGlwZW5kZW50aSlcbiovXG5wcm90by51bm1vdW50ID0gZnVuY3Rpb24oKXtcbiAgdmFyIHBhbmVsID0gdGhpcy5pbnRlcm5hbFBhbmVsO1xuICB2YXIgZGVmZXJyZWQgPSAkLkRlZmVycmVkKCk7XG4gIHBhbmVsLiRkZXN0cm95KHRydWUpO1xuICBkZWZlcnJlZC5yZXNvbHZlKCk7XG4gIHJldHVybiBkZWZlcnJlZC5wcm9taXNlKCk7XG59O1xuXG4vKlxuICogTWV0b2RvIChvcHppb25hbGUpIGNoZSBvZmZyZSBsJ29wcG9ydHVuaXTDoCBkaSByaWNhbGNvbGFyZSBwcm9wcmlldMOgIGRpcGVuZGVudGkgZGFsbGUgZGltZW5zaW9uaSBkZWwgcGFkcmVcbiAqIHBhcmVudEhlaWdodDogbnVvdmEgYWx0ZXp6YSBkZWwgcGFyZW50XG4gKiBwYXJlbnRXaWR0aDogbnVvdmEgbGFyZ2hlenphIGRlbCBwYXJlbnRcbiAqIHJpY2hpYW1hdG8gb2duaSB2b2x0YSBjaGUgaWwgcGFyZW50IHN1YmlzY2UgdW4gcmlkaW1lbnNpb25hbWVudG9cbiovXG5wcm90by5vblJlc2l6ZSA9IGZ1bmN0aW9uKHBhcmVudFdpZHRoLHBhcmVudEhlaWdodCl7fTtcblxuXG5tb2R1bGUuZXhwb3J0cyA9IFBhbmVsO1xuIiwidmFyIGluaGVyaXQgPSByZXF1aXJlKCdjb3JlL3V0aWxzL3V0aWxzJykuaW5oZXJpdDtcbnZhciBiYXNlID0gcmVxdWlyZSgnY29yZS91dGlscy91dGlscycpLmJhc2U7XG52YXIgR1VJID0gcmVxdWlyZSgnZ3VpL2d1aScpO1xudmFyIEczV09iamVjdCA9IHJlcXVpcmUoJ2NvcmUvZzN3b2JqZWN0Jyk7XG52YXIgUHJvamVjdHNSZWdpc3RyeSA9IHJlcXVpcmUoJ2NvcmUvcHJvamVjdC9wcm9qZWN0c3JlZ2lzdHJ5Jyk7XG5cbmZ1bmN0aW9uIFF1ZXJ5UmVzdWx0c1NlcnZpY2UoKXtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICB0aGlzLl9hY3Rpb25zID0ge1xuICAgICd6b29tdG8nOiBRdWVyeVJlc3VsdHNTZXJ2aWNlLnpvb21Ub0VsZW1lbnRcbiAgfTtcbiAgXG4gIHRoaXMuaW5pdCA9IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgICB0aGlzLmNsZWFyU3RhdGUoKTtcbiAgfTtcbiAgXG4gIHRoaXMuc3RhdGUgPSB7XG4gICAgbGF5ZXJzOiBbXSxcbiAgICBxdWVyeToge30sXG4gICAgcXVlcnl0aXRsZTogXCJcIixcbiAgICBsb2FkaW5nOiB0cnVlXG4gIH07XG4gIFxuICB0aGlzLnNldHRlcnMgPSB7XG4gICAgc2V0UXVlcnlSZXNwb25zZTogZnVuY3Rpb24ocXVlcnlSZXNwb25zZSkge1xuICAgICAgdGhpcy5zdGF0ZS5sYXllcnMgPSBbXTtcbiAgICAgIHRoaXMuc3RhdGUucXVlcnkgPSBxdWVyeVJlc3BvbnNlLnF1ZXJ5O1xuICAgICAgdGhpcy5fZGlnZXN0RmVhdHVyZXNGb3JMYXllcnMocXVlcnlSZXNwb25zZS5kYXRhKTtcbiAgICAgIHRoaXMuc3RhdGUubG9hZGluZyA9IGZhbHNlO1xuICAgIH1cbiAgfTtcbiAgXG4gIHRoaXMuY2xlYXJTdGF0ZSA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuc3RhdGUgPSB7XG4gICAgICBsYXllcnM6IFtdLFxuICAgICAgcXVlcnk6IHt9LFxuICAgICAgcXVlcnl0aXRsZTogXCJcIixcbiAgICAgIGxvYWRpbmc6IHRydWVcbiAgICB9O1xuICB9O1xuICBcbiAgdGhpcy5zZXRUaXRsZSA9IGZ1bmN0aW9uKHF1ZXJ5dGl0bGUpIHtcbiAgICB0aGlzLnN0YXRlLnF1ZXJ5dGl0bGUgPSBxdWVyeXRpdGxlIHx8IFwiXCI7XG4gIH07XG4gIFxuICB0aGlzLnJlc2V0ID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5jbGVhclN0YXRlKCk7XG4gIH07XG4gIFxuICB0aGlzLl9kaWdlc3RGZWF0dXJlc0ZvckxheWVycyA9IGZ1bmN0aW9uKGZlYXR1cmVzRm9yTGF5ZXJzKSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIF8uZm9yRWFjaChmZWF0dXJlc0ZvckxheWVycyxmdW5jdGlvbihmZWF0dXJlc0ZvckxheWVyKXtcbiAgICAgIHZhciBsYXllciA9IGZlYXR1cmVzRm9yTGF5ZXIubGF5ZXI7XG4gICAgICBpZiAoZmVhdHVyZXNGb3JMYXllci5mZWF0dXJlcy5sZW5ndGgpIHtcbiAgICAgICAgdmFyIGxheWVyT2JqID0ge1xuICAgICAgICAgIHRpdGxlOiBsYXllci50aXRsZSxcbiAgICAgICAgICBpZDogbGF5ZXIuaWQsXG4gICAgICAgICAgYXR0cmlidXRlczogc2VsZi5fcGFyc2VBdHRyaWJ1dGVzKGxheWVyLmF0dHJpYnV0ZXMsZmVhdHVyZXNGb3JMYXllci5mZWF0dXJlc1swXS5nZXRQcm9wZXJ0aWVzKCkpLCAvLyBwcmVuZG8gc29sbyBnbGkgYXR0cmlidXRpIGVmZmV0dGl2YW1lbnRlIHJpdG9ybmF0aSBkYWwgV01TICh1c2FuZG8gbGEgcHJpbWEgZmVhdHVyZSBkaXNwb25pYmlsZSlcbiAgICAgICAgICBmZWF0dXJlczogW11cbiAgICAgICAgfTtcbiAgICAgICAgXy5mb3JFYWNoKGZlYXR1cmVzRm9yTGF5ZXIuZmVhdHVyZXMsZnVuY3Rpb24oZmVhdHVyZSl7ICAgICAgXG4gICAgICAgICAgdmFyIGZlYXR1cmVPYmogPSB7XG4gICAgICAgICAgICBpZDogZmVhdHVyZS5nZXRJZCgpLFxuICAgICAgICAgICAgYXR0cmlidXRlczogZmVhdHVyZS5nZXRQcm9wZXJ0aWVzKCksXG4gICAgICAgICAgICBnZW9tZXRyeTogZmVhdHVyZS5nZXRHZW9tZXRyeSgpXG4gICAgICAgICAgfVxuICAgICAgICAgIGxheWVyT2JqLmZlYXR1cmVzLnB1c2goZmVhdHVyZU9iaik7XG4gICAgICAgIH0pXG4gICAgICAgIHNlbGYuc3RhdGUubGF5ZXJzLnB1c2gobGF5ZXJPYmopO1xuICAgICAgfVxuICAgIH0pXG4gIH07XG4gIFxuICB0aGlzLl9wYXJzZUF0dHJpYnV0ZXMgPSBmdW5jdGlvbihsYXllckF0dHJpYnV0ZXMsZmVhdHVyZUF0dHJpYnV0ZXMpIHtcbiAgICB2YXIgZmVhdHVyZUF0dHJpYnV0ZXNOYW1lcyA9IF8ua2V5cyhmZWF0dXJlQXR0cmlidXRlcyk7XG4gICAgcmV0dXJuIF8uZmlsdGVyKGxheWVyQXR0cmlidXRlcyxmdW5jdGlvbihhdHRyaWJ1dGUpe1xuICAgICAgcmV0dXJuIGZlYXR1cmVBdHRyaWJ1dGVzTmFtZXMuaW5kZXhPZihhdHRyaWJ1dGUubmFtZSkgPiAtMTtcbiAgICB9KVxuICB9XG4gIFxuICB0aGlzLnRyaWdnZXIgPSBmdW5jdGlvbihhY3Rpb24sbGF5ZXIsZmVhdHVyZSkge1xuICAgIHZhciBhY3Rpb25NZXRob2QgPSB0aGlzLl9hY3Rpb25zW2FjdGlvbl07XG4gICAgaWYgKGFjdGlvbk1ldGhvZCkge1xuICAgICAgYWN0aW9uTWV0aG9kKGxheWVyLGZlYXR1cmUpO1xuICAgIH1cbiAgfTtcbiAgXG4gIGJhc2UodGhpcyk7XG59O1xuXG5RdWVyeVJlc3VsdHNTZXJ2aWNlLnpvb21Ub0VsZW1lbnQgPSBmdW5jdGlvbihsYXllcixmZWF0dXJlKSB7XG4gIGNvbnNvbGUubG9nKGZlYXR1cmUuZ2VvbWV0cnkpO1xufTtcblxuLy8gTWFrZSB0aGUgcHVibGljIHNlcnZpY2UgZW4gRXZlbnQgRW1pdHRlclxuaW5oZXJpdChRdWVyeVJlc3VsdHNTZXJ2aWNlLCBHM1dPYmplY3QpO1xuXG5tb2R1bGUuZXhwb3J0cyA9IFF1ZXJ5UmVzdWx0c1NlcnZpY2U7XG4iLCJtb2R1bGUuZXhwb3J0cyA9IFwiPCEtLTxkaXYgaWQ9XFxcInNlYXJjaC1yZXN1bHRzXFxcIj5cXG4gIDxkaXYgdi1mb3I9XFxcImxheWVyIGluIHN0YXRlLmxheWVyc1xcXCIgc3R5bGU9XFxcImN1cnNvcjpwb2ludGVyXFxcIj5cXG4gICAgPGg0Pnt7IGxheWVyLnRpdGxlIH19PC9oND5cXG4gICAgPHA+TnVtZXJvIGRpIGZlYXR1cmVzOiB7eyBsYXllci5mZWF0dXJlcy5sZW5ndGggfX08L3A+XFxuICA8L2Rpdj5cXG48L2Rpdj4tLT5cXG48ZGl2IGlkPVxcXCJzZWFyY2gtcmVzdWx0c1xcXCIgY2xhc3M9XFxcInF1ZXJ5cmVzdWx0cy1jb250YWluZXJcXFwiPlxcbiAgPGgzPlJpc3VsdGF0aSB7e3N0YXRlLnF1ZXJ5dGl0bGUgfCBsb3dlcmNhc2V9fTwvaDM+XFxuICA8ZGl2IHYtc2hvdz1cXFwic3RhdGUubG9hZGluZ1xcXCIgY2xhc3M9XFxcImJhci1sb2FkZXJcXFwiPjwvZGl2PlxcbiAgPHVsIGNsYXNzPVxcXCJxdWVyeXJlc3VsdHNcXFwiIGlkPVxcXCJxdWVyeXJlc3VsdHNcXFwiPlxcbiAgICA8bGkgdi1pZj1cXFwibGF5ZXJIYXNGZWF0dXJlcyhsYXllcilcXFwiIHYtZm9yPVxcXCJsYXllciBpbiBzdGF0ZS5sYXllcnNcXFwiPlxcbiAgICAgIDxkaXYgY2xhc3M9XFxcImJveCBib3gtcHJpbWFyeVxcXCI+XFxuICAgICAgICA8ZGl2IGNsYXNzPVxcXCJib3gtaGVhZGVyIHdpdGgtYm9yZGVyXFxcIj5cXG4gICAgICAgICAgPGgzIGNsYXNzPVxcXCJib3gtdGl0bGVcXFwiPnt7IGxheWVyLnRpdGxlIH19ICh7e2xheWVyLmZlYXR1cmVzLmxlbmd0aH19KTwvaDM+XFxuICAgICAgICAgIDxkaXYgY2xhc3M9XFxcImJveC10b29scyBwdWxsLXJpZ2h0XFxcIj5cXG4gICAgICAgICAgICA8YnV0dG9uIGNsYXNzPVxcXCJidG4gYnRuLWJveC10b29sXFxcIiBkYXRhLXdpZGdldD1cXFwiY29sbGFwc2VcXFwiPjxpIGNsYXNzPVxcXCJmYSBmYS1taW51c1xcXCI+PC9pPjwvYnV0dG9uPlxcbiAgICAgICAgICA8L2Rpdj5cXG4gICAgICAgIDwvZGl2PlxcbiAgICAgICAgPGRpdiBjbGFzcz1cXFwiYm94LWJvZHlcXFwiPlxcbiAgICAgICAgICA8dGFibGUgY2xhc3M9XFxcInRhYmxlIHRhYmxlLXN0cmlwZWRcXFwiPlxcbiAgICAgICAgICAgIDx0aGVhZD5cXG4gICAgICAgICAgICAgIDx0cj5cXG4gICAgICAgICAgICAgICAgPHRoIHYtZm9yPVxcXCJhdHRyaWJ1dGUgaW4gYXR0cmlidXRlc1N1YnNldChsYXllci5hdHRyaWJ1dGVzKVxcXCI+e3thdHRyaWJ1dGUubGFiZWx9fTwvdGg+XFxuICAgICAgICAgICAgICA8L3RyPlxcbiAgICAgICAgICAgIDwvdGhlYWQ+XFxuICAgICAgICAgICAgPHRib2R5PlxcbiAgICAgICAgICAgICAgPHRlbXBsYXRlIHYtZm9yPVxcXCJmZWF0dXJlIGluIGxheWVyLmZlYXR1cmVzXFxcIj5cXG4gICAgICAgICAgICAgICAgPHRyIGNsYXNzPVxcXCJhdHRyaWJ1dGVzLXByZXZpZXdcXFwiIEBjbGljaz1cXFwidG9nZ2xlRmVhdHVyZUJveChsYXllcixmZWF0dXJlKVxcXCI+XFxuICAgICAgICAgICAgICAgICAgPHRkIHYtZm9yPVxcXCJhdHRyaWJ1dGUgaW4gYXR0cmlidXRlc1N1YnNldChsYXllci5hdHRyaWJ1dGVzKVxcXCI+XFxuICAgICAgICAgICAgICAgICAgICA8c3Bhbj57e2ZlYXR1cmUuYXR0cmlidXRlc1thdHRyaWJ1dGUubmFtZV19fTwvc3Bhbj5cXG4gICAgICAgICAgICAgICAgICAgIDwhLS08c3BhbiB2LWlmPVxcXCJpc1NpbXBsZShsYXllcixmZWF0dXJlLGF0dHJpYnV0ZSlcXFwiPnt7ZmVhdHVyZS5hdHRyaWJ1dGVzW2F0dHJpYnV0ZS5uYW1lXX19PC9zcGFuPi0tPlxcbiAgICAgICAgICAgICAgICAgICAgPCEtLTxzcGFuIHYtaWY9XFxcImlzUm91dGUobGF5ZXIsZmVhdHVyZSxhdHRyaWJ1dGUpXFxcIiBjbGFzcz1cXFwibGluayBkYXNoYm9hcmRsaW5rXFxcIiBAY2xpY2s9XFxcImdvdG8obGF5ZXIsZmVhdHVyZS5hdHRyaWJ1dGVzW2F0dHJpYnV0ZS5uYW1lXSlcXFwiPnt7IGZlYXR1cmUuYXR0cmlidXRlc1thdHRyaWJ1dGUubmFtZV0gfX08L3NwYW4+LS0+XFxuICAgICAgICAgICAgICAgICAgICA8IS0tPGltZyB2LWlmPVxcXCJpc1Bob3RvKGxheWVyLGZlYXR1cmUsYXR0cmlidXRlKVxcXCIgZGF0YS11cmw9XFxcInt7Z2V0UGhvdG9VcmwoZmVhdHVyZS5hdHRyaWJ1dGVzW2F0dHJpYnV0ZS5uYW1lXSl9fVxcXCIgc3R5bGU9XFxcIm1heC13aWR0aDo1MHB4XFxcIiA6c3JjPVxcXCJnZXRQaG90b1VybChmZWF0dXJlLmF0dHJpYnV0ZXNbYXR0cmlidXRlLm5hbWVdLHRodW1iKVxcXCIgLz4tLT5cXG4gICAgICAgICAgICAgICAgICAgIDwhLS08YSB2LWlmPVxcXCJpc0xpbmsobGF5ZXIsZmVhdHVyZSxhdHRyaWJ1dGUpXFxcIiBocmVmPVxcXCJsYXllci5mZWF0dXJlLmF0dHJpYnV0ZXNbYXR0cmlidXRlLm5hbWVdXFxcIiBjbGFzcz1cXFwiZ2x5cGhpY29uIGdseXBoaWNvbi1saW5rXFxcIj48L2E+LS0+XFxuICAgICAgICAgICAgICAgICAgPC90ZD5cXG4gICAgICAgICAgICAgICAgICA8dGQ+PHNwYW4gY2xhc3M9XFxcImdseXBoaWNvbiBnbHlwaGljb24tb3B0aW9uLWhvcml6b250YWwgbGluayBtb3JlbGlua1xcXCI+PC9zcGFuPjwvdGQ+XFxuICAgICAgICAgICAgICA8L3RyPlxcbiAgICAgICAgICAgICAgPHRyIHYtc2hvdz1cXFwiY29sbGFwc2VGZWF0dXJlQm94KGxheWVyLGZlYXR1cmUpXFxcIiBjbGFzcz1cXFwicXVlcnlyZXN1bHRzLWZlYXR1cmVib3hcXFwiPlxcbiAgICAgICAgICAgICAgICA8dGQgOmNvbHNwYW49XFxcImF0dHJpYnV0ZXNTdWJzZXRMZW5ndGgobGF5ZXIuYXR0cmlidXRlcykrMVxcXCI+XFxuICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cXFwiYWN0aW9uLWJ1dHRvbnMtY29udGFpbmVyXFxcIj5cXG4gICAgICAgICAgICAgICAgICAgIDxkaXYgdi1pZj1cXFwiZ2VvbWV0cnlBdmFpbGFibGUoZmVhdHVyZSlcXFwiIGNsYXNzPVxcXCJhY3Rpb24tYnV0dG9uIGhpbnQtLXRvcC1yaWdodFxcXCIgYXJpYS1sYWJlbD1cXFwiVmlzdWFsaXp6YSBzdWxsYSBtYXBwYVxcXCI+XFxuICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPVxcXCJhY3Rpb24tYnV0dG9uLWljb24gZ2x5cGhpY29uIGdseXBoaWNvbi1tYXAtbWFya2VyXFxcIiBAY2xpY2s9XFxcInRyaWdnZXIoJ3pvb210bycsbGF5ZXIsZmVhdHVyZSlcXFwiPjwvc3Bhbj5cXG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PlxcbiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cXFwiYWN0aW9uLWJ1dHRvbiBoaW50LS10b3AtcmlnaHRcXFwiIGFyaWEtbGFiZWw9XFxcIkxpbmsgYWxsJ2VsZW1lbnRvXFxcIj5cXG4gICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9XFxcImFjdGlvbi1idXR0b24taWNvbiBnbHlwaGljb24gZ2x5cGhpY29uLWxpbmtcXFwiPjwvc3Bhbj5cXG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PlxcbiAgICAgICAgICAgICAgICAgIDwvZGl2PlxcbiAgICAgICAgICAgICAgICAgIDx0YWJsZT5cXG4gICAgICAgICAgICAgICAgICAgIDx0ciB2LWZvcj1cXFwiYXR0cmlidXRlIGluIGxheWVyLmF0dHJpYnV0ZXNcXFwiPlxcbiAgICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3M9XFxcImF0dHItbGFiZWxcXFwiPnt7YXR0cmlidXRlLmxhYmVsfX08L3RkPlxcbiAgICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3M9XFxcImF0dHItdmFsdWVcXFwiPnt7ZmVhdHVyZS5hdHRyaWJ1dGVzW2F0dHJpYnV0ZS5uYW1lXX19PC90ZD5cXG4gICAgICAgICAgICAgICAgICAgIDwvdHI+XFxuICAgICAgICAgICAgICAgICAgPC90YWJsZT5cXG4gICAgICAgICAgICAgICAgPC90ZD5cXG4gICAgICAgICAgICAgIDwvdHI+XFxuICAgICAgICAgICAgICA8L3RlbXBsYXRlPlxcbiAgICAgICAgICAgIDwvdGJvZHk+XFxuICAgICAgICAgIDwvdGFibGU+XFxuICAgICAgICA8L2Rpdj5cXG4gICAgICA8L2Rpdj5cXG4gICAgPC9saT5cXG4gIDwvdWw+XFxuPC9kaXY+XFxuXFxuXCI7XG4iLCJ2YXIgaW5oZXJpdCA9IHJlcXVpcmUoJ2NvcmUvdXRpbHMvdXRpbHMnKS5pbmhlcml0O1xudmFyIGJhc2UgPSByZXF1aXJlKCdjb3JlL3V0aWxzL3V0aWxzJykuYmFzZTtcbnZhciBtZXJnZSA9IHJlcXVpcmUoJ2NvcmUvdXRpbHMvdXRpbHMnKS5tZXJnZTtcbnZhciBDb21wb25lbnQgPSByZXF1aXJlKCdndWkvdnVlL2NvbXBvbmVudCcpO1xudmFyIEczV09iamVjdCA9IHJlcXVpcmUoJ2NvcmUvZzN3b2JqZWN0Jyk7XG52YXIgUXVlcnlSZXN1bHRzU2VydmljZSA9IHJlcXVpcmUoJ2d1aS9xdWVyeXJlc3VsdHMvcXVlcnlyZXN1bHRzc2VydmljZScpO1xuXG52YXIgdnVlQ29tcG9uZW50T3B0aW9ucyA9IHtcbiAgdGVtcGxhdGU6IHJlcXVpcmUoJy4vcXVlcnlyZXN1bHRzLmh0bWwnKSxcbiAgZGF0YTogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHN0YXRlOiB0aGlzLiRvcHRpb25zLnF1ZXJ5UmVzdWx0c1NlcnZpY2Uuc3RhdGUsXG4gICAgICBsYXllcnNGZWF0dXJlc0JveGVzOiB7fSxcbiAgICB9XG4gIH0sXG4gIHJlcGxhY2U6IGZhbHNlLFxuICBtZXRob2RzOiB7XG4gICAgbGF5ZXJIYXNGZWF0dXJlczogZnVuY3Rpb24obGF5ZXIpIHtcbiAgICAgIGlmIChsYXllci5mZWF0dXJlcykge1xuICAgICAgICByZXR1cm4gbGF5ZXIuZmVhdHVyZXMubGVuZ3RoID4gMDtcbiAgICAgIH1cbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9LFxuICAgIGdlb21ldHJ5QXZhaWxhYmxlOiBmdW5jdGlvbihmZWF0dXJlKSB7XG4gICAgICByZXR1cm4gZmVhdHVyZS5nZW9tZXRyeSA/IHRydWUgOiBmYWxzZTtcbiAgICB9LFxuICAgIGF0dHJpYnV0ZXNTdWJzZXQ6IGZ1bmN0aW9uKGF0dHJpYnV0ZXMpIHtcbiAgICAgIHZhciBlbmQgPSBNYXRoLm1pbigzLGF0dHJpYnV0ZXMubGVuZ3RoKTtcbiAgICAgIHJldHVybiBhdHRyaWJ1dGVzLnNsaWNlKDAsZW5kKTtcbiAgICB9LFxuICAgIGF0dHJpYnV0ZXNTdWJzZXRMZW5ndGg6IGZ1bmN0aW9uKGF0dHJpYnV0ZXMpIHtcbiAgICAgIHJldHVybiB0aGlzLmF0dHJpYnV0ZXNTdWJzZXQoYXR0cmlidXRlcykubGVuZ3RoO1xuICAgIH0sXG4gICAgY29sbGFwc2VGZWF0dXJlQm94OiBmdW5jdGlvbihsYXllcixmZWF0dXJlKSB7XG4gICAgICB2YXIgY29sbGFwc2VkID0gdHJ1ZTtcbiAgICAgIHZhciBib3hpZCA9IGxheWVyLmlkKydfJytmZWF0dXJlLmlkO1xuICAgICAgaWYgKHRoaXMubGF5ZXJzRmVhdHVyZXNCb3hlc1tib3hpZF0pIHtcbiAgICAgICAgY29sbGFwc2VkID0gdGhpcy5sYXllcnNGZWF0dXJlc0JveGVzW2JveGlkXS5jb2xsYXBzZWQ7XG4gICAgICB9XG4gICAgICByZXR1cm4gY29sbGFwc2VkO1xuICAgIH0sXG4gICAgdG9nZ2xlRmVhdHVyZUJveDogZnVuY3Rpb24obGF5ZXIsZmVhdHVyZSkge1xuICAgICAgdmFyIGJveGlkID0gbGF5ZXIuaWQrJ18nK2ZlYXR1cmUuaWQ7XG4gICAgICB0aGlzLmxheWVyc0ZlYXR1cmVzQm94ZXNbYm94aWRdLmNvbGxhcHNlZCA9ICF0aGlzLmxheWVyc0ZlYXR1cmVzQm94ZXNbYm94aWRdLmNvbGxhcHNlZDtcbiAgICB9LFxuICAgIHRyaWdnZXI6IGZ1bmN0aW9uKGFjdGlvbixsYXllcixmZWF0dXJlKSB7XG4gICAgICB0aGlzLiRvcHRpb25zLnF1ZXJ5UmVzdWx0c1NlcnZpY2UudHJpZ2dlcihhY3Rpb24sbGF5ZXIsZmVhdHVyZSk7XG4gICAgfVxuICB9XG59O1xuXG4vLyBzZSBsbyB2b2dsaW8gaXN0YW56aWFyZSBtYW51YWxtZW50ZVxudmFyIEludGVybmFsQ29tcG9uZW50ID0gVnVlLmV4dGVuZCh2dWVDb21wb25lbnRPcHRpb25zKTtcblxuZnVuY3Rpb24gUXVlcnlSZXN1bHRzQ29tcG9uZW50KG9wdGlvbnMpe1xuICBiYXNlKHRoaXMsb3B0aW9ucyk7XG4gIHZhciBzZWxmID0gdGhpcztcbiAgdGhpcy5pZCA9IFwicXVlcnlyZXN1bHRzXCI7XG4gIHRoaXMudGl0bGUgPSBcIlF1ZXJ5IFJlc3VsdHNcIjtcbiAgdGhpcy5fc2VydmljZSA9IG5ldyBRdWVyeVJlc3VsdHNTZXJ2aWNlKCk7XG4gIC8vdXNhdG8gcXVhbmRvIMOoIHN0YXRvIGRpc3RydXR0b1xuICB0aGlzLnNldEludGVybmFsQ29tcG9uZW50ID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5pbnRlcm5hbENvbXBvbmVudCA9IG5ldyBJbnRlcm5hbENvbXBvbmVudCh7XG4gICAgICBxdWVyeVJlc3VsdHNTZXJ2aWNlOiB0aGlzLl9zZXJ2aWNlXG4gICAgfSk7XG4gICAgdGhpcy5jcmVhdGVMYXllcnNGZWF0dXJlc0JveGVzKCk7XG4gICAgdGhpcy5pbnRlcm5hbENvbXBvbmVudC5xdWVyeXRpdGxlID0gdGhpcy5fc2VydmljZS5zdGF0ZS5xdWVyeXRpdGxlO1xuICB9XG4gIFxuICB0aGlzLl9zZXJ2aWNlLm9uYWZ0ZXIoJ3NldFF1ZXJ5UmVzcG9uc2UnLGZ1bmN0aW9uKCl7XG4gICAgc2VsZi5jcmVhdGVMYXllcnNGZWF0dXJlc0JveGVzKCk7XG4gIH0pXG4gIG1lcmdlKHRoaXMsIG9wdGlvbnMpO1xuICBcbiAgdGhpcy5jcmVhdGVMYXllcnNGZWF0dXJlc0JveGVzID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIGxheWVyc0ZlYXR1cmVzQm94ZXMgPSB7fVxuICAgIHZhciBsYXllcnMgPSB0aGlzLl9zZXJ2aWNlLnN0YXRlLmxheWVycztcbiAgICBfLmZvckVhY2gobGF5ZXJzLGZ1bmN0aW9uKGxheWVyKXtcbiAgICAgIF8uZm9yRWFjaChsYXllci5mZWF0dXJlcyxmdW5jdGlvbihmZWF0dXJlKXtcbiAgICAgICAgdmFyIGJveGlkID0gbGF5ZXIuaWQrJ18nK2ZlYXR1cmUuaWRcbiAgICAgICAgbGF5ZXJzRmVhdHVyZXNCb3hlc1tib3hpZF0gPSB7XG4gICAgICAgICAgY29sbGFwc2VkOiBmYWxzZVxuICAgICAgICB9XG4gICAgICB9KVxuICAgIH0pXG4gICAgdGhpcy5pbnRlcm5hbENvbXBvbmVudC5sYXllcnNGZWF0dXJlc0JveGVzID0gbGF5ZXJzRmVhdHVyZXNCb3hlcztcbiAgfTtcbn07XG5cbmluaGVyaXQoUXVlcnlSZXN1bHRzQ29tcG9uZW50LCBDb21wb25lbnQpO1xuXG5tb2R1bGUuZXhwb3J0cyA9IFF1ZXJ5UmVzdWx0c0NvbXBvbmVudDtcblxuLypcblxudmFyIHJlc29sdmVkVmFsdWUgPSByZXF1aXJlKCdnM3cvY29yZS91dGlscycpLnJlc29sdmVkVmFsdWU7XG52YXIgaW5oZXJpdCA9IHJlcXVpcmUoJ2czdy9jb3JlL3V0aWxzJykuaW5oZXJpdDtcbnZhciBiYXNlID0gcmVxdWlyZSgnZzN3L2NvcmUvdXRpbHMnKS5iYXNlO1xudmFyIEczV09iamVjdCA9IHJlcXVpcmUoJ2czdy9jb3JlL2czd29iamVjdCcpO1xudmFyIEdVSSA9IHJlcXVpcmUoJ2czdy9ndWkvZ3VpJyk7XG52YXIgQXBpU2VydmljZSA9IHJlcXVpcmUoJ2czdy9jb3JlL2FwaXNlcnZpY2UnKTtcbnZhciBQcm9qZWN0U2VydmljZSA9IHJlcXVpcmUoJ2czdy9jb3JlL3Byb2plY3RzZXJ2aWNlJykuUHJvamVjdFNlcnZpY2U7XG52YXIgTWFwU2VydmljZSA9IHJlcXVpcmUoJ2czdy9jb3JlL21hcHNlcnZpY2UnKTtcbnZhciBSb3V0ZXJTZXJ2aWNlID0gcmVxdWlyZSgnZzN3L2NvcmUvcm91dGVyJyk7XG5cbnZhciBUcGxTZXJ2aWNlID0gcmVxdWlyZSgnLi90cGxzZXJ2aWNlJyk7XG5cbnZhciBGaWVsZHMgPSB7fTtcbkZpZWxkcy5TVFJJTkcgPSAnc3RyaW5nJztcbkZpZWxkcy5JTlRFR0VSID0gJ2ludGVnZXInO1xuRmllbGRzLkZMT0FUID0gJ2Zsb2F0JztcblxuXG5GaWVsZHMuc2ltcGxlRmllbGRUeXBlcyA9IFtGaWVsZHMuU1RSSU5HLEZpZWxkcy5JTlRFR0VSLEZpZWxkcy5GTE9BVF07XG5GaWVsZHMuTElOSyA9ICdsaW5rJztcbkZpZWxkcy5QSE9UTyA9ICdwaG90byc7XG5GaWVsZHMuUE9JTlRMSU5LID0gJ3BvaW50bGluayc7XG5GaWVsZHMuUk9VVEUgPSAncm91dGUnO1xuXG52YXIgRmllbGRzUnVsZXMgPSB7XG4gIHZhcmlhbnRpOiB7XG4gICAgaWQ6IEZpZWxkcy5ST1VURVxuICB9LFxuICBwYWxpbmU6IHtcbiAgICBpZDogRmllbGRzLlJPVVRFXG4gIH1cbn07XG5cbmZ1bmN0aW9uIGdldEZpZWxkVHlwZShsYXllcixmZWF0dXJlLGF0dHJpYnV0ZSkge1xuICB2YXIgZmllbGRUeXBlRnJvbVJ1bGVzID0gXy5nZXQoRmllbGRzUnVsZXMsbGF5ZXIuaWQrJy4nK2F0dHJpYnV0ZS5uYW1lKTtcbiAgaWYgKGZpZWxkVHlwZUZyb21SdWxlcykge1xuICAgIHJldHVybiBmaWVsZFR5cGVGcm9tUnVsZXM7XG4gIH1cbiAgXG4gIHZhciBVUkxQYXR0ZXJuID0gL14oaHR0cHM/OlxcL1xcL1teXFxzXSspL2c7XG4gIHZhciBQaG90b1BhdHRlcm4gPSAvW15cXHNdKy4ocG5nfGpwZ3xqcGVnKSQvZztcbiAgdmFyIHZhbHVlID0gZmVhdHVyZS5hdHRyaWJ1dGVzW2F0dHJpYnV0ZS5uYW1lXS50b1N0cmluZygpO1xuICBcbiAgdmFyIGV4dGVuc2lvbiA9IHZhbHVlLnNwbGl0KCcuJykucG9wKCk7XG4gIGlmICh2YWx1ZS5tYXRjaChVUkxQYXR0ZXJuKSkge1xuICAgIHJldHVybiBGaWVsZHMuTElOSztcbiAgfVxuICBcbiAgaWYgKHZhbHVlLm1hdGNoKFBob3RvUGF0dGVybikpIHtcbiAgICByZXR1cm4gRmllbGRzLlBIT1RPO1xuICB9XG4gIFxuICBpZiAoRmllbGRzLnNpbXBsZUZpZWxkVHlwZXMuaW5kZXhPZihhdHRyaWJ1dGUudHlwZSkgPiAtMSkge1xuICAgIHJldHVybiBhdHRyaWJ1dGUudHlwZTtcbiAgfVxufTtcblxuZnVuY3Rpb24gaXNTaW1wbGUobGF5ZXIsZmVhdHVyZSxhdHRyaWJ1dGUpIHtcbiAgdmFyIGZpZWxkVHlwZSA9IGdldEZpZWxkVHlwZShsYXllcixmZWF0dXJlLGF0dHJpYnV0ZSk7XG4gIHJldHVybiBGaWVsZHMuc2ltcGxlRmllbGRUeXBlcy5pbmRleE9mKGZpZWxkVHlwZSkgPiAtMTtcbn07XG5cbmZ1bmN0aW9uIGlzTGluayhsYXllcixmZWF0dXJlLGF0dHJpYnV0ZSkge1xuICB2YXIgZmllbGRUeXBlID0gZ2V0RmllbGRUeXBlKGxheWVyLGZlYXR1cmUsYXR0cmlidXRlKTtcbiAgcmV0dXJuIEZpZWxkcy5MSU5LID09IGZpZWxkVHlwZTtcbn07XG5cbmZ1bmN0aW9uIGlzUGhvdG8obGF5ZXIsZmVhdHVyZSxhdHRyaWJ1dGUpIHtcbiAgdmFyIGZpZWxkVHlwZSA9IGdldEZpZWxkVHlwZShsYXllcixmZWF0dXJlLGF0dHJpYnV0ZSk7XG4gIHJldHVybiBGaWVsZHMuUEhPVE8gPT0gZmllbGRUeXBlO1xufTtcblxuZnVuY3Rpb24gaXNSb3V0ZShsYXllcixmZWF0dXJlLGF0dHJpYnV0ZSkge1xuICB2YXIgZmllbGRUeXBlID0gZ2V0RmllbGRUeXBlKGxheWVyLGZlYXR1cmUsYXR0cmlidXRlKTtcbiAgcmV0dXJuIEZpZWxkcy5ST1VURSA9PSBmaWVsZFR5cGU7XG59O1xuXG52YXIgVHBsUXVlcnlSZXN1bHRzQ29tcG9uZW50ID0gVnVlLmV4dGVuZCh7XG4gIHRlbXBsYXRlOiByZXF1aXJlKCcuL3RwbHF1ZXJ5cmVzdWx0cy5odG1sJyksXG4gIGRhdGE6IGZ1bmN0aW9uKCl7XG4gICAgcmV0dXJuIHtcbiAgICAgIGxvdHRvOiBudWxsLFxuICAgICAgZGF5OiBudWxsLFxuICAgICAgdGVycml0b3JpYWxfZGV0YWlsczoge30sXG4gICAgICBsYXllcnM6IFtdLFxuICAgICAgYmFzZVBob3RvVXJsOiAnJ1xuICAgIH1cbiAgfSxcbiAgcmVhZHk6IGZ1bmN0aW9uKCl7XG4gICAgdHJ5IHtcbiAgICAgIHZhciB2aWV3ZXIgPSBuZXcgVmlld2VyKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0cGwtbWFwcXVlcnlyZXN1bHRzJyksIHtcbiAgICAgICAgdXJsOiAnZGF0YS11cmwnLFxuICAgICAgICB6SW5kZXg6IDEwMDAwXG4gICAgICB9KTtcbiAgICB9XG4gICAgY2F0Y2goZXJyKXtcbiAgICB9XG4gIH0sXG4gIG1ldGhvZHM6IHtcbiAgICBsYXllckhhc0ZlYXR1cmVzOiBmdW5jdGlvbihsYXllcikge1xuICAgICAgaWYgKGxheWVyLmZlYXR1cmVzKSB7XG4gICAgICAgIHJldHVybiBsYXllci5mZWF0dXJlcy5sZW5ndGggPiAwO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0sXG4gICAgY2FsY0ttOiBmdW5jdGlvbihtZXRlcnMpIHtcbiAgICAgIHJldHVybiBNYXRoLnJvdW5kMTAoKG1ldGVycy8xMDAwKSwtMik7XG4gICAgfSxcbiAgICBzaG93RmVhdHVyZTogZnVuY3Rpb24oZmVhdHVyZSkge1xuICAgICAgR1VJLmhpZGVMaXN0aW5nKCk7XG4gICAgICBNYXBTZXJ2aWNlLmhpZ2hsaWdodEdlb21ldHJ5KGZlYXR1cmUuZ2VvbWV0cnkse3pvb206IHRydWV9KTtcbiAgICB9LFxuICAgIGhhc0dlb21ldHJ5OiBmdW5jdGlvbihmZWF0dXJlKSB7XG4gICAgICByZXR1cm4gXy5pc05pbChmZWF0dXJlLmdldEdlb21ldHJ5KTtcbiAgICB9LFxuICAgIGlzU2ltcGxlOiBmdW5jdGlvbihsYXllcixmZWF0dXJlLGF0dHJpYnV0ZSkge1xuICAgICAgcmV0dXJuIGlzU2ltcGxlKGxheWVyLGZlYXR1cmUsYXR0cmlidXRlKTtcbiAgICB9LFxuICAgIGlzUGhvdG86IGZ1bmN0aW9uKGxheWVyLGZlYXR1cmUsYXR0cmlidXRlKSB7XG4gICAgICByZXR1cm4gaXNQaG90byhsYXllcixmZWF0dXJlLGF0dHJpYnV0ZSk7XG4gICAgfSxcbiAgICBpc0xpbms6IGZ1bmN0aW9uKGxheWVyLGZlYXR1cmUsYXR0cmlidXRlKSB7XG4gICAgICByZXR1cm4gaXNMaW5rKGxheWVyLGZlYXR1cmUsYXR0cmlidXRlKTtcbiAgICB9LFxuICAgIGlzUm91dGU6IGZ1bmN0aW9uKGxheWVyLGZlYXR1cmUsYXR0cmlidXRlKSB7XG4gICAgICByZXR1cm4gaXNSb3V0ZShsYXllcixmZWF0dXJlLGF0dHJpYnV0ZSk7XG4gICAgfSxcbiAgICBnZXRQaG90b1VybDogZnVuY3Rpb24ocGF0aCx0aHVtYikge1xuICAgICAgdmFyIHBhdGhzcGxpdCA9IHBhdGguc3BsaXQoJy8nKTtcbiAgICAgIHZhciBwaG90b05hbWUgPSBwYXRoc3BsaXRbcGF0aHNwbGl0Lmxlbmd0aCAtIDFdO1xuICAgICAgdmFyIHBob3RvU3BsaXQgPSBwaG90b05hbWUuc3BsaXQoJ18nKS5zbGljZSgxKTtcbiAgICAgIHZhciBwcmVmaXggPSAnZm90byc7XG4gICAgICBpZiAodGh1bWIpIHtcbiAgICAgICAgcHJlZml4ID0gJ3RodW1iJztcbiAgICAgIH1cbiAgICAgIHZhciB0aHVtYk5hbWUgPSBwcmVmaXgrXCJfXCIrcGhvdG9TcGxpdC5qb2luKCdfJyk7XG4gICAgICByZXR1cm4gdGhpcy5iYXNlUGhvdG9VcmwgKyAnLycgKyB0aHVtYk5hbWU7XG4gICAgfSxcbiAgICBnZXRMYWJlbDogZnVuY3Rpb24obGF5ZXJOYW1lKXtcbiAgICAgIHJldHVybiB0aGlzLmxhYmVsc190ZXJyaXRvcmlvW2xheWVyTmFtZV0uZGVub21pbmF6aW9uZTtcbiAgICB9LFxuICAgIGdldE9yQmxhbms6IGZ1bmN0aW9uKHBhdGgpIHtcbiAgICAgIHZhciB2YWx1ZSA9IF8uZ2V0KHRoaXMscGF0aCk7XG4gICAgICByZXR1cm4gKHZhbHVlICYmIHZhbHVlICE9ICcnKSA/IHZhbHVlIDogJy0nO1xuICAgIH0sXG4gICAgZ290bzogZnVuY3Rpb24obGF5ZXIsdmFsdWUpIHtcbiAgICAgIHN3aXRjaCAobGF5ZXIuaWQpIHtcbiAgICAgICAgY2FzZSAndmFyaWFudGknOlxuICAgICAgICAgIEdVSS5oaWRlTGlzdGluZygpO1xuICAgICAgICAgIHZhciBsb3R0byA9IHRoaXMubG90dG87XG4gICAgICAgICAgdmFyIGRheSA9IHRoaXMuZGF5O1xuICAgICAgICAgIFJvdXRlclNlcnZpY2UuZ290bygnZGFzaGJvYXJkL2NvcnNldmFyaWFudGUvJyt2YWx1ZSsnP2RheT0nK3RoaXMuZGF5KTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAncGFsaW5lJzpcbiAgICAgICAgICBHVUkuaGlkZUxpc3RpbmcoKTtcbiAgICAgICAgICB2YXIgZGF5ID0gdGhpcy5kYXk7XG4gICAgICAgICAgUm91dGVyU2VydmljZS5nb3RvKCdkYXNoYm9hcmQvZmVybWF0YS8nK3ZhbHVlKyc/ZGF5PScrZGF5KTtcbiAgICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9LFxuICAgIHNob3dWYXJpYW50ZTogZnVuY3Rpb24oaWRfdmFyaWFudGUpIHtcbiAgICAgIEdVSS5oaWRlTGlzdGluZygpO1xuICAgICAgdmFyIGxvdHRvID0gdGhpcy5sb3R0bztcbiAgICAgIHZhciBkYXkgPSB0aGlzLmRheTtcbiAgICAgIFJvdXRlclNlcnZpY2UuZ290bygnZGFzaGJvYXJkL3ZhcmlhbnRpLycrdGhpcy5sb3R0bysnLyMjIy8nK2lkX3ZhcmlhbnRlKyc/ZGF5PScrdGhpcy5kYXkpO1xuICAgIH0sXG4gICAgc2hvd0Zlcm1hdGE6IGZ1bmN0aW9uKGlkX2Zlcm1hdGEpIHtcbiAgICAgIEdVSS5oaWRlTGlzdGluZygpO1xuICAgICAgdmFyIGRheSA9IHRoaXMuZGF5O1xuICAgICAgUm91dGVyU2VydmljZS5nb3RvKCdkYXNoYm9hcmQvZmVybWF0YS8nK2lkX2Zlcm1hdGErJz9kYXk9JytkYXkpO1xuICAgIH1cbiAgfVxufSlcblxudmFyIFRwbFF1ZXJ5UmVzdWx0c1BhbmVsID0gZnVuY3Rpb24oY29udGV4dCl7XG4gIHRoaXMucGFuZWxDb21wb25lbnQgPSBudWxsO1xuICB0aGlzLmNvbnRleHQgPSBjb250ZXh0O1xuICBcbiAgdGhpcy5vblNob3cgPSBmdW5jdGlvbihjb250YWluZXIpe1xuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICB2YXIgcGFuZWwgPSB0aGlzLnBhbmVsQ29tcG9uZW50ID0gbmV3IFRwbFF1ZXJ5UmVzdWx0c0NvbXBvbmVudCgpO1xuICAgIHBhbmVsLmxheWVycyA9IFtdO1xuICAgIHBhbmVsLmxhYmVsc190ZXJyaXRvcmlvID0gbnVsbDtcbiAgICBcbiAgICB2YXIgbGF5ZXJEYXRhID0gXy5rZXlCeShjb250ZXh0LmxheWVyc1Jlc3VsdHMsJ2lkJyk7XG4gICAgXG4gICAgdmFyIHRlcnJpdG9yaWFsX2RldGFpbHMgPSB7fTtcbiAgICB2YXIgbGF5ZXJzX2xhYmVsc190ZXJyaXRvcmlvID0gWydwcm92aW5jZScsJ2NvbXVuaScsJ2JhY2luaScsJ2xvY2FsaXRhJ107XG4gICAgXG4gICAgXy5mb3JFYWNoKGxheWVyc19sYWJlbHNfdGVycml0b3JpbyxmdW5jdGlvbihsYXllck5hbWUpe1xuICAgICAgaWYgKGxheWVyRGF0YVtsYXllck5hbWVdLmZlYXR1cmVzICYmIGxheWVyRGF0YVtsYXllck5hbWVdLmZlYXR1cmVzLmxlbmd0aCkge1xuICAgICAgICB0ZXJyaXRvcmlhbF9kZXRhaWxzW2xheWVyTmFtZV0gPSAgbGF5ZXJEYXRhW2xheWVyTmFtZV0uZmVhdHVyZXNbMF0uYXR0cmlidXRlc1xuICAgICAgfVxuICAgIH0pO1xuICAgIFxuICAgIHBhbmVsLmxvdHRvID0gY29udGV4dC5sb3R0b0lkO1xuICAgIHBhbmVsLmRheSA9IGNvbnRleHQuZGF5O1xuICAgIHBhbmVsLnRlcnJpdG9yaWFsX2RldGFpbHMgPSB0ZXJyaXRvcmlhbF9kZXRhaWxzOyAgIFxuICAgIFxuICAgIHZhciBsYXllcnNGcm9tQXBpID0gWyd2YXJpYW50aSddO1xuICAgIFxuICAgIHRoaXMucXVlcnlWYXJpYW50aSh0aGlzLmNvbnRleHQpXG4gICAgLnRoZW4oZnVuY3Rpb24oZmVhdHVyZXMpe1xuICAgICAgcGFuZWwubGF5ZXJzLnB1c2goe1xuICAgICAgICB0aXRsZTogJ1ZhcmlhbnRpJyxcbiAgICAgICAgaWQ6ICd2YXJpYW50aScsXG4gICAgICAgIGF0dHJpYnV0ZXM6IFByb2plY3RTZXJ2aWNlLmdldExheWVyQnlOYW1lKCd2YXJpYW50aScpLmF0dHJpYnV0ZXMsXG4gICAgICAgIGZlYXR1cmVzOiBmZWF0dXJlc1xuICAgICAgfSlcbiAgICB9KTtcbiAgICBcbiAgICB2YXIgZXhjbHVkZWRMYXllcnMgPSBfLmNvbmNhdChsYXllcnNfbGFiZWxzX3RlcnJpdG9yaW8sbGF5ZXJzRnJvbUFwaSk7XG4gICAgdmFyIHF1ZXJ5YWJsZUxheWVycyA9IF8uZmlsdGVyKHRoaXMuY29udGV4dC5xdWVyeWFibGVMYXllcnMsZnVuY3Rpb24obGF5ZXIpe1xuICAgICAgcmV0dXJuIGV4Y2x1ZGVkTGF5ZXJzLmluZGV4T2YobGF5ZXIubmFtZSkgPT0gLTE7XG4gICAgfSk7XG4gICAgXG4gICAgXy5mb3JFYWNoKHF1ZXJ5YWJsZUxheWVycyxmdW5jdGlvbihxdWVyeWFibGVMYXllcil7XG4gICAgICAgIHZhciBmZWF0dXJlcyA9IHNlbGYucHJvY2Vzc1Jlc3VsdHMocXVlcnlhYmxlTGF5ZXIubmFtZSxzZWxmLmNvbnRleHQpXG4gICAgICAgIHBhbmVsLmxheWVycy5wdXNoKHtcbiAgICAgICAgICB0aXRsZTogcXVlcnlhYmxlTGF5ZXIudGl0bGUsXG4gICAgICAgICAgaWQ6IHF1ZXJ5YWJsZUxheWVyLm5hbWUsXG4gICAgICAgICAgYXR0cmlidXRlczogcXVlcnlhYmxlTGF5ZXIuYXR0cmlidXRlcyxcbiAgICAgICAgICBmZWF0dXJlczogZmVhdHVyZXNcbiAgICAgICAgfSk7XG4gICAgfSlcblxuICAgIHBhbmVsLmJhc2VQaG90b1VybCA9IGNvbnRleHQudXJscy5iYXNlUGhvdG9Vcmw7XG4gICAgXG4gICAgcGFuZWwuJG1vdW50KCkuJGFwcGVuZFRvKGNvbnRhaW5lcik7XG4gICAgXG4gICAgcmV0dXJuIHJlc29sdmVkVmFsdWUodHJ1ZSk7XG4gIH07XG4gIFxuICB0aGlzLm9uQ2xvc2UgPSBmdW5jdGlvbigpe1xuICAgIHRoaXMucGFuZWxDb21wb25lbnQuJGRlc3Ryb3kodHJ1ZSk7XG4gICAgdGhpcy5wYW5lbENvbXBvbmVudCA9IG51bGw7XG4gICAgcmV0dXJuIHJlc29sdmVkVmFsdWUodHJ1ZSk7XG4gIH07XG4gIFxuICB0aGlzLnByb2Nlc3NSZXN1bHRzID0gZnVuY3Rpb24obGF5ZXJOYW1lLGNvbnRleHQpIHtcbiAgICB2YXIgbGF5ZXJEYXRhID0gXy5rZXlCeShjb250ZXh0LmxheWVyc1Jlc3VsdHMsJ2lkJyk7XG4gICAgdmFyIGZlYXR1cmVzID0gW107XG4gICAgaWYgKGxheWVyRGF0YVtsYXllck5hbWVdKSB7XG4gICAgICBmZWF0dXJlcyA9IGxheWVyRGF0YVtsYXllck5hbWVdLmZlYXR1cmVzO1xuICAgIH1cbiAgICByZXR1cm4gZmVhdHVyZXM7XG4gIH07XG4gIFxuICB0aGlzLnF1ZXJ5VmFyaWFudGkgPSBmdW5jdGlvbihjb250ZXh0KXtcbiAgICByZXR1cm4gQXBpU2VydmljZS5nZXQoJ1ZBUklBTlRJUVVFUllNQVAnLHtcbiAgICAgIHBhcmFtczoge1xuICAgICAgICBkYXk6IGNvbnRleHQuZGF5LFxuICAgICAgICBsb3R0bzogY29udGV4dC5sb3R0b0lkLFxuICAgICAgICBjb29yZHM6IGNvbnRleHQuY29vcmRpbmF0ZXMuam9pbignLCcpLFxuICAgICAgICByZXM6IGNvbnRleHQucmVzb2x1dGlvblxuICAgICAgfVxuICAgIH0pXG4gICAgLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2Upe1xuICAgICAgcmV0dXJuIF8ubWFwKHJlc3BvbnNlLGZ1bmN0aW9uKHJvd0RhdGEpe1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGF0dHJpYnV0ZXM6IHJvd0RhdGFcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICB9KTtcbiAgfVxufVxuaW5oZXJpdChUcGxRdWVyeVJlc3VsdHNQYW5lbCxHM1dPYmplY3QpO1xuXG5tb2R1bGUuZXhwb3J0cyA9IFRwbFF1ZXJ5UmVzdWx0c1BhbmVsO1xuXG4qL1xuIiwidmFyIGluaGVyaXQgPSByZXF1aXJlKCdjb3JlL3V0aWxzL3V0aWxzJykuaW5oZXJpdDtcbnZhciBHVUkgPSByZXF1aXJlKCdndWkvZ3VpJyk7XG52YXIgUHJvamVjdHNSZWdpc3RyeSA9IHJlcXVpcmUoJ2NvcmUvcHJvamVjdC9wcm9qZWN0c3JlZ2lzdHJ5Jyk7XG52YXIgRzNXT2JqZWN0ID0gcmVxdWlyZSgnY29yZS9nM3dvYmplY3QnKTtcbnZhciBTZWFyY2hQYW5lbCA9IHJlcXVpcmUoJ2d1aS9zZWFyY2gvdnVlL3BhbmVsL3NlYXJjaHBhbmVsJyk7XG5cbmZ1bmN0aW9uIFNlYXJjaGVzU2VydmljZSgpe1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIC8vdGhpcy5fc2VhcmNoUGFuZWxTZXJ2aWNlID0gbmV3IFNlYXJjaFBhbmVsU2VydmljZSgpO1xuICB0aGlzLmluaXQgPSBmdW5jdGlvbihzZWFyY2hlc09iamVjdCkge1xuICAgIHZhciBzZWFyY2hlcyA9IHNlYXJjaGVzT2JqZWN0IHx8IFByb2plY3RzUmVnaXN0cnkuZ2V0Q3VycmVudFByb2plY3QoKS5zdGF0ZS5zZWFyY2g7XG4gICAgdGhpcy5zdGF0ZS5zZWFyY2hlcyA9IHNlYXJjaGVzO1xuICB9O1xuICB0aGlzLnN0YXRlID0ge1xuICAgIHNlYXJjaGVzOiBbXVxuICB9O1xuXG4gIHRoaXMuc2hvd1NlYXJjaFBhbmVsID0gZnVuY3Rpb24ocGFuZWxDb25maWcpIHtcbiAgICB2YXIgcGFuZWwgPSAgbmV3IFNlYXJjaFBhbmVsKCk7Ly8gY3JlbyBwYW5lbGxvIHNlYXJjaFxuICAgIHBhbmVsLmluaXQocGFuZWxDb25maWcpOy8vaW5pemlhbGl6em8gcGFubmVsbG8gc2VcbiAgICBHVUkuc2hvd1BhbmVsKHBhbmVsKTtcbiAgICByZXR1cm4gcGFuZWw7XG4gIH07XG5cbiAgdGhpcy5jbGVhblNlYXJjaFBhbmVscyA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuc3RhdGUucGFuZWxzID0ge307XG4gIH07XG5cbiAgdGhpcy5zdG9wID0gZnVuY3Rpb24oKXtcbiAgICB2YXIgZGVmZXJyZWQgPSAkLkRlZmVycmVkKCk7XG4gICAgZGVmZXJyZWQucmVzb2x2ZSgpO1xuICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlKCk7XG4gIH07XG5cbn07XG5cbi8vIE1ha2UgdGhlIHB1YmxpYyBzZXJ2aWNlIGVuIEV2ZW50IEVtaXR0ZXJcbmluaGVyaXQoU2VhcmNoZXNTZXJ2aWNlLCBHM1dPYmplY3QpO1xuXG5tb2R1bGUuZXhwb3J0cyA9IFNlYXJjaGVzU2VydmljZTtcbiIsIm1vZHVsZS5leHBvcnRzID0gXCI8ZGl2IGNsYXNzPVxcXCJnM3ctc2VhcmNoLXBhbmVsIGZvcm0tZ3JvdXBcXFwiPlxcbiAgPGgzPnt7dGl0bGV9fTwvaDM+XFxuICA8Zm9ybSBpZD1cXFwiZzN3LXNlYXJjaC1mb3JtXFxcIj5cXG4gICAgPHRlbXBsYXRlIHYtZm9yPVxcXCJmb3JtaW5wdXQgaW4gZm9ybWlucHV0c1xcXCI+XFxuICAgICAgPGRpdiB2LWlmPVxcXCJmb3JtaW5wdXQuaW5wdXQudHlwZSA9PSAnbnVtYmVyZmllbGQnXFxcIiBjbGFzcz1cXFwiZm9ybS1ncm91cCBudW1lcmljXFxcIj5cXG4gICAgICAgIDxsYWJlbCBmb3I9XFxcInt7IGZvcm1pbnB1dC5pZCB9fSBcXFwiPnt7IGZvcm1pbnB1dC5sYWJlbCB9fTwvbGFiZWw+XFxuICAgICAgICA8aW5wdXQgdHlwZT1cXFwibnVtYmVyXFxcIiB2LW1vZGVsPVxcXCJmb3JtSW5wdXRWYWx1ZXNbJGluZGV4XS52YWx1ZVxcXCIgY2xhc3M9XFxcImZvcm0tY29udHJvbFxcXCIgaWQ9XFxcInt7IGZvcm1pbnB1dC5pZCB9fVxcXCI+XFxuICAgICAgPC9kaXY+XFxuICAgICAgPGRpdiB2LWlmPVxcXCJmb3JtaW5wdXQuaW5wdXQudHlwZSA9PSAndGV4dGZpZWxkJ1xcXCIgY2xhc3M9XFxcImZvcm0tZ3JvdXAgdGV4dFxcXCI+XFxuICAgICAgICA8bGFiZWwgZm9yPVxcXCJ7eyBmb3JtaW5wdXQuaWQgfX1cXFwiPnt7IGZvcm1pbnB1dC5sYWJlbCB9fTwvbGFiZWw+XFxuICAgICAgICA8aW5wdXQgdHlwZT1cXFwidGV4dFxcXCIgdi1tb2RlbD1cXFwiZm9ybUlucHV0VmFsdWVzWyRpbmRleF0udmFsdWVcXFwiIGNsYXNzPVxcXCJmb3JtLWNvbnRyb2xcXFwiIGlkPVxcXCJ7eyBmb3JtaW5wdXQuaWQgfX1cXFwiPlxcbiAgICAgIDwvZGl2PlxcbiAgICA8L3RlbXBsYXRlPlxcbiAgICA8ZGl2IGNsYXNzPVxcXCJmb3JtLWdyb3VwXFxcIj5cXG4gICAgICA8YnV0dG9uIGNsYXNzPVxcXCJidG4gYnRuLXByaW1hcnkgcHVsbC1yaWdodFxcXCIgQGNsaWNrPVxcXCJkb1NlYXJjaCgkZXZlbnQpXFxcIiBkYXRhLWkxOG49XFxcImRvc2VhcmNoXFxcIj5TZWFyY2g8L2J1dHRvbj5cXG4gICAgPC9kaXY+XFxuICA8L2Zvcm0+XFxuPC9kaXY+XFxuXCI7XG4iLCJ2YXIgaW5oZXJpdCA9IHJlcXVpcmUoJ2NvcmUvdXRpbHMvdXRpbHMnKS5pbmhlcml0O1xudmFyIGxvY2FsaXplID0gcmVxdWlyZSgnY29yZS9pMThuL2kxOG4uc2VydmljZScpLnQ7XG52YXIgcmVzb2x2ZSA9IHJlcXVpcmUoJ2NvcmUvdXRpbHMvdXRpbHMnKS5yZXNvbHZlO1xudmFyIEdVSSA9IHJlcXVpcmUoJ2d1aS9ndWknKTtcbnZhciBRdWVyeVNlcnZpY2UgPSByZXF1aXJlKCdjb3JlL3F1ZXJ5L3F1ZXJ5c2VydmljZScpO1xudmFyIExpc3RQYW5lbCA9IHJlcXVpcmUoJ2d1aS9saXN0cGFuZWwnKS5MaXN0UGFuZWw7XG52YXIgUGFuZWwgPSByZXF1aXJlKCdndWkvcGFuZWwnKTtcbnZhciBQcm9qZWN0c1JlZ2lzdHJ5ID0gcmVxdWlyZSgnY29yZS9wcm9qZWN0L3Byb2plY3RzcmVnaXN0cnknKTtcblxuLy9jb21wb25lbnRlIHZ1ZSBwYW5uZWxsbyBzZWFyY2hcbnZhciBTZWFyY2hQYW5lbENvbXBvbmV0ID0gVnVlLmV4dGVuZCh7XG4gIHRlbXBsYXRlOiByZXF1aXJlKCcuL3NlYXJjaHBhbmVsLmh0bWwnKSxcbiAgZGF0YTogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHRpdGxlOiBcIlwiLFxuICAgICAgZm9ybWlucHV0czogW10sXG4gICAgICBmaWx0ZXJPYmplY3Q6IHt9LFxuICAgICAgZm9ybUlucHV0VmFsdWVzIDogW11cbiAgICB9XG4gIH0sXG4gIG1ldGhvZHM6IHtcbiAgICBkb1NlYXJjaDogZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAvL2FsIG1vbWVudG8gbW9sdG8gZmFycmFnZ2lub3NvIG1hIGRhIHJpdmVkZXJlXG4gICAgICAvL3BlciBhc3NvY2lhemlvbmUgdmFsb3JlIGlucHV0XG4gICAgICB2YXIgc2hvd1F1ZXJ5UmVzdWx0cyA9IEdVSS5zaG93UmVzdWx0c0ZhY3RvcnkoJ3F1ZXJ5Jyk7XG4gICAgICB2YXIgcXVlcnlSZXN1bHRzUGFuZWwgPSBzaG93UXVlcnlSZXN1bHRzKHNlbGYudGl0bGUpO1xuICAgICAgdGhpcy5maWx0ZXJPYmplY3QgPSB0aGlzLmZpbGxGaWx0ZXJJbnB1dHNXaXRoVmFsdWVzKHRoaXMuZmlsdGVyT2JqZWN0LCB0aGlzLmZvcm1JbnB1dFZhbHVlcyk7XG4gICAgICBRdWVyeVNlcnZpY2UucXVlcnlCeUZpbHRlcih0aGlzLmZpbHRlck9iamVjdClcbiAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3VsdHMpe1xuICAgICAgICBxdWVyeVJlc3VsdHNQYW5lbC5zZXRRdWVyeVJlc3BvbnNlKHJlc3VsdHMpO1xuICAgICAgfSlcbiAgICB9XG4gIH1cbn0pO1xuXG4vL2Nvc3RydXR0b3JlIGRlbCBwYW5uZWxsbyBlIGRlbCBzdW8gY29tcG9uZW50ZSB2dWVcbmZ1bmN0aW9uIFNlYXJjaFBhbmVsKCkge1xuICBzZWxmID0gdGhpcztcbiAgdGhpcy5jb25maWcgPSB7fTtcbiAgdGhpcy5maWx0ZXIgPSB7fTtcbiAgdGhpcy5pZCA9IG51bGw7XG4gIHRoaXMucXVlcnlsYXllcmlkID0gbnVsbDtcbiAgdGhpcy5pbnRlcm5hbFBhbmVsID0gbmV3IFNlYXJjaFBhbmVsQ29tcG9uZXQoKTtcbiAgLy9mdW56aW9uZSBpbml6aWFsaXp6YXppb25lXG4gIHRoaXMuaW5pdCA9IGZ1bmN0aW9uKGNvbmZpZykge1xuICAgIHRoaXMuY29uZmlnID0gY29uZmlnIHx8IHt9O1xuICAgIHRoaXMubmFtZSA9IHRoaXMuY29uZmlnLm5hbWUgfHwgdGhpcy5uYW1lO1xuICAgIHRoaXMuaWQgPSB0aGlzLmNvbmZpZy5pZCB8fCB0aGlzLmlkO1xuICAgIHRoaXMuZmlsdGVyID0gdGhpcy5jb25maWcub3B0aW9ucy5maWx0ZXIgfHwgdGhpcy5maWx0ZXI7XG4gICAgdGhpcy5xdWVyeWxheWVyaWQgPSB0aGlzLmNvbmZpZy5vcHRpb25zLnF1ZXJ5bGF5ZXJpZCB8fCB0aGlzLnF1ZXJ5bGF5ZXJpZDtcbiAgICAvL3ZhZG8gYSByaWVtcGlyZSBnbGkgaW5wdXQgZGVsIGZvcm0gZGVsIHBhbm5lbGxvXG4gICAgdGhpcy5maWxsSW5wdXRzRm9ybUZyb21GaWx0ZXIoKTtcbiAgICAvL2NyZW8gZSBhc3NlZ25vIGwnb2dnZXR0byBmaWx0cm9cbiAgICB2YXIgZmlsdGVyT2JqRnJvbUNvbmZpZyA9IFF1ZXJ5U2VydmljZS5jcmVhdGVRdWVyeUZpbHRlckZyb21Db25maWcodGhpcy5maWx0ZXIpO1xuICAgIC8vYWxsYSBmaW5lIGNyZW8gbCdnZ2V0dG8gZmluYWxlIGRlbCBmaWx0cm8gZGEgcGFzc2FyZSBwb2kgYWwgcHJvdmlkZXIgUUdJU1dNUyBvIFdGUyBldGMuLiBjaGUgY29udGllbmUgc2lhXG4gICAgLy9pbCBmaWx0cm8gY2hlIHVybCwgaWwgbm9tZSBkZWwgbGF5ZXIgaWwgdGlwbyBkaSBzZXJ2ZXIgZXRjIC4uXG4gICAgdGhpcy5pbnRlcm5hbFBhbmVsLmZpbHRlck9iamVjdCA9IFF1ZXJ5U2VydmljZS5jcmVhdGVRdWVyeUZpbHRlck9iamVjdCh0aGlzLnF1ZXJ5bGF5ZXJpZCwgZmlsdGVyT2JqRnJvbUNvbmZpZyk7XG4gICAgLy9zb2x1emlvbmUgbW9tZW50YW5lYSBhc3NlZ25vICBsYSBmdW56aW9uZSBkZWwgU2VhcmNoUGFubGUgbWEgY29tZSBwYXR0ZXJuIMOoIHNiYWdsaWF0b1xuICAgIC8vdm9ycmVpIGRlbGVnYXJsbyBhIFNlYXJjaGVzU2VydmljZSBtYSBsbyBzdGVzc28gc3RhbnppYSBxdWVzdG8gKGxvb3ApIGNvbWUgdXNjaXJuZT8/P1xuICAgIC8vY3JlYXJlIHVuIHNlYXJjaHBhbmVsc2VydmljZT9cbiAgICB0aGlzLmludGVybmFsUGFuZWwuZmlsbEZpbHRlcklucHV0c1dpdGhWYWx1ZXMgPSB0aGlzLmZpbGxGaWx0ZXJJbnB1dHNXaXRoVmFsdWVzO1xuICAgIHRoaXMuaW50ZXJuYWxQYW5lbC50aXRsZSA9IHRoaXMubmFtZTtcbiAgfTtcbiAgLy9mdW56aW9uZSBjaGUgcG9wb2xhIGdsaSBpbnB1dHMgY2hlIGNpIHNhcmFubm8gbmVsIGZvcm0gZGVsIHBhbm5lbGxvIHJpY2VyY2FcbiAgLy9vbHRyZSBjb3N0cnVpcmUgdW4gb2dnZXR0byBjaGUgbGVnaGVyw6AgaSB2YWxvcmkgZGVnbGkgaW5wdXRzIGRlbCBmb3JtIGNvbiBnbGkgb2dnZXR0aVxuICAvLydvcGVyYXppb25hbGknIGRlbCBmaWx0cm9cbiAgdGhpcy5maWxsSW5wdXRzRm9ybUZyb21GaWx0ZXIgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgaWQgPSAwO1xuICAgIHZhciBmb3JtVmFsdWU7XG4gICAgXy5mb3JFYWNoKHRoaXMuZmlsdGVyLGZ1bmN0aW9uKHYsayxvYmopIHtcbiAgICAgIF8uZm9yRWFjaCh2LCBmdW5jdGlvbihpbnB1dCl7XG4gICAgICAgIC8vc2VtcHJlIG51b3ZvIG9nZ2V0dG9cbiAgICAgICAgZm9ybVZhbHVlID0ge307XG4gICAgICAgIC8vaW5zZXJpc2NvIGwnaWQgYWxsJ2lucHV0XG4gICAgICAgIGlucHV0LmlkID0gaWRcbiAgICAgICAgLy9hZ2dpdW5nbyBpbCB0aXBvIGFsIHZhbG9yZSBwZXIgZmFyZSBjb252ZXJzaW9uZSBkYSBzdHJpbmdhIGEgdGlwbyBpbnB1dFxuICAgICAgICBmb3JtVmFsdWUudHlwZSA9IGlucHV0LmlucHV0LnR5cGU7XG4gICAgICAgIC8vLy9URU1QT1JBTkVPICEhISBERVZPIFBSRU5ERVJFIElMIFZFUk8gVkFMT1JFIERJIERFRkFVTFRcbiAgICAgICAgZm9ybVZhbHVlLnZhbHVlID0gbnVsbDtcbiAgICAgICAgLy9wb3BvbG8gZ2xpIGlucHV0czpcbiAgICAgICAgLy8gdmFsb3JpXG4gICAgICAgIHNlbGYuaW50ZXJuYWxQYW5lbC5mb3JtSW5wdXRWYWx1ZXMucHVzaChmb3JtVmFsdWUpO1xuICAgICAgICAvL2lucHV0XG4gICAgICAgIHNlbGYuaW50ZXJuYWxQYW5lbC5mb3JtaW5wdXRzLnB1c2goaW5wdXQpO1xuICAgICAgICBpZCs9MTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9O1xuICAvL2Z1bnppb25lIGNoZSBhc3NvY2lhIGkgdmFsb3JpIGRlbGwnaW5wdXRzIGZvcm0gYWwgcmVsYXRpdm8gb2dnZXR0byBcIm9wZXJhemlvbmRlIGRlbCBmaWx0cm9cIlxuICB0aGlzLmZpbGxGaWx0ZXJJbnB1dHNXaXRoVmFsdWVzID0gZnVuY3Rpb24oZmlsdGVyT2JqZWN0LCBmb3JtSW5wdXRWYWx1ZXMsIGdsb2JhbEluZGV4KSB7XG4gICAgLy9mdW56aW9uZSBjb252ZXJzaW9uZSBkYSB2YWxvcmUgcmVzdGl0dWl0byBkYWxsJ2lucHV0IChzZW1wcmUgc3RyaW5nYSkgYWwgdmVybyB0aXBvIGRpIHZhbG9yZVxuICAgIGZ1bmN0aW9uIGNvbnZlcnRJbnB1dFZhbHVlVG9JbnB1dFR5cGUodHlwZSwgdmFsdWUpIHtcbiAgICAgIHN3aXRjaCh0eXBlKSB7XG4gICAgICAgIGNhc2UgJ251bWJlcmZpZWxkJzpcbiAgICAgICAgICAgICB2YWx1ZSA9IHBhcnNlSW50KHZhbHVlKTtcbiAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIHJldHVybiB2YWx1ZTtcbiAgICB9XG4gICAgLy9jaWNsbyBzdWxsJ29nZ2V0dG8gZmlsdHJvIGNoZSBoYSBjb21lIGNoaWF2ZSByb290ICdBTkQnIG8gJ09SJ1xuICAgIF8uZm9yRWFjaChmaWx0ZXJPYmplY3QuZmlsdGVyT2JqZWN0LCBmdW5jdGlvbih2LGspIHtcbiAgICAgIC8vc2NvcnJvIGF0dHJhdmVyc28gbCdhcnJheSBkaSBlbGVtZW50aSBvcGVyYXppb25hbGkgZGEgY29uZnJvbnRhcmVcbiAgICAgIF8uZm9yRWFjaCh2LCBmdW5jdGlvbihpbnB1dCwgaWR4KSB7XG4gICAgICAgIC8vZWxlbWVudG8gb3BlcmF6aW9uYWxlIHsnPSc6e319XG4gICAgICAgIF8uZm9yRWFjaChpbnB1dCwgZnVuY3Rpb24odiwgaywgb2JqKSB7XG4gICAgICAgICAgLy92YWRvIGEgbGVnZ2VyZSBsJ29nZ2V0dG8gYXR0cmlidXRvXG4gICAgICAgICAgaWYgKF8uaXNBcnJheSh2KSkge1xuICAgICAgICAgICAgLy9yaWNoaWFtYSBsYSBmdW56aW9uZSByaWNvcnNpdmFtZW50ZSAuLiBhbmRyw6AgYmVuZSA/XG4gICAgICAgICAgICBmaWxsRmlsdGVySW5wdXRzV2l0aFZhbHVlcyhpbnB1dCwgZm9ybUlucHV0VmFsdWVzLCBpZHgpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBfLmZvckVhY2godiwgZnVuY3Rpb24odiwgaywgb2JqKSB7XG4gICAgICAgICAgICAgIC8vY29uc2lkZXJvIGwnaW5kZXggZ2xvYmFsZSBpbiBtb2RvIGNoZSBpbnB1dHMgZGkgb3BlcmF6aW9uaSBib29sZWFuZSBpbnRlcm5lXG4gICAgICAgICAgICAgIC8vdmVuZ29ubyBjb25zaWRlcmF0ZVxuICAgICAgICAgICAgICBpbmRleCA9IChnbG9iYWxJbmRleCkgPyBnbG9iYWxJbmRleCArIGlkeCA6IGlkeDtcbiAgICAgICAgICAgICAgb2JqW2tdID0gY29udmVydElucHV0VmFsdWVUb0lucHV0VHlwZShmb3JtSW5wdXRWYWx1ZXNbaW5kZXhdLnR5cGUsIGZvcm1JbnB1dFZhbHVlc1tpbmRleF0udmFsdWUpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgICByZXR1cm4gZmlsdGVyT2JqZWN0O1xuICB9O1xufTtcblxuaW5oZXJpdChTZWFyY2hQYW5lbCwgUGFuZWwpO1xubW9kdWxlLmV4cG9ydHMgPSBTZWFyY2hQYW5lbDtcbiIsIm1vZHVsZS5leHBvcnRzID0gXCI8ZGl2IGlkPVxcXCJnM3ctc2VhcmNoXFxcIiBjbGFzcz1cXFwiZzN3LXNlYXJjaCBnM3ctdG9vbHNcXFwiPlxcbiAgPHVsPlxcbiAgICA8bGkgdi1mb3I9XFxcInNlYXJjaCBpbiBwcm9qZWN0LnNlYXJjaFxcXCI+XFxuICAgICAgPGRpdiBjbGFzcz1cXFwic2VhcmNoLWhlYWRlciB0b29sLWhlYWRlclxcXCIgQGNsaWNrPVxcXCJzaG93U2VhcmNoUGFuZWwoc2VhcmNoKVxcXCI+XFxuICAgICAgICA8c3BhbiBzdHlsZT1cXFwiXFxcIj57eyBzZWFyY2gubmFtZSB9fTwvc3Bhbj5cXG4gICAgICA8L2Rpdj5cXG4gICAgPC9saT5cXG4gIDwvdWw+XFxuPC9kaXY+XFxuXCI7XG4iLCJ2YXIgaW5oZXJpdCA9IHJlcXVpcmUoJ2NvcmUvdXRpbHMvdXRpbHMnKS5pbmhlcml0O1xudmFyIGJhc2UgPSByZXF1aXJlKCdjb3JlL3V0aWxzL3V0aWxzJykuYmFzZTtcbnZhciBtZXJnZSA9IHJlcXVpcmUoJ2NvcmUvdXRpbHMvdXRpbHMnKS5tZXJnZTtcbnZhciB0ID0gcmVxdWlyZSgnY29yZS9pMThuL2kxOG4uc2VydmljZScpLnQ7XG52YXIgcmVzb2x2ZSA9IHJlcXVpcmUoJ2NvcmUvdXRpbHMvdXRpbHMnKS5yZXNvbHZlO1xudmFyIENvbXBvbmVudCA9IHJlcXVpcmUoJ2d1aS92dWUvY29tcG9uZW50Jyk7XG52YXIgR1VJID0gcmVxdWlyZSgnZ3VpL2d1aScpO1xudmFyIFByb2plY3RzUmVnaXN0cnkgPSByZXF1aXJlKCdjb3JlL3Byb2plY3QvcHJvamVjdHNyZWdpc3RyeScpO1xudmFyIEczV09iamVjdCA9IHJlcXVpcmUoJ2NvcmUvZzN3b2JqZWN0Jyk7XG52YXIgU2VhcmNoUGFuZWwgPSByZXF1aXJlKCdndWkvc2VhcmNoL3Z1ZS9wYW5lbC9zZWFyY2hwYW5lbCcpO1xudmFyIFByb2plY3RzUmVnaXN0cnkgPSByZXF1aXJlKCdjb3JlL3Byb2plY3QvcHJvamVjdHNyZWdpc3RyeScpO1xudmFyIFNlYXJjaGVzU2VydmljZSA9IHJlcXVpcmUoJ2d1aS9zZWFyY2gvc2VhcmNoZXNzZXJ2aWNlJyk7XG5cbnZhciB2dWVDb21wb25lbnRPcHRpb25zID0ge1xuICAgdGVtcGxhdGU6IHJlcXVpcmUoJy4vc2VhcmNoLmh0bWwnKSxcbiAgIGRhdGE6IGZ1bmN0aW9uKCkge1xuICAgIFx0cmV0dXJuIHtcbiAgICBcdCAgcHJvamVjdDogUHJvamVjdHNSZWdpc3RyeS5nZXRDdXJyZW50UHJvamVjdCgpLnN0YXRlXG4gICAgXHR9O1xuICAgfSxcbiAgIG1ldGhvZHM6IHtcbiAgICBzaG93U2VhcmNoUGFuZWw6IGZ1bmN0aW9uKHNlYXJjaCkge1xuICAgICAgICB2YXIgcGFuZWwgPSB0aGlzLiRvcHRpb25zLnNlYXJjaGVzU2VydmljZS5zaG93U2VhcmNoUGFuZWwoc2VhcmNoKTtcbiAgICB9XG4gIH1cbn07XG5cbi8vIHNlIGxvIHZvZ2xpbyBpc3RhbnppYXJlIG1hbnVhbG1lbnRlXG52YXIgSW50ZXJuYWxDb21wb25lbnQgPSBWdWUuZXh0ZW5kKHZ1ZUNvbXBvbmVudE9wdGlvbnMpO1xuLy8gc2UgbG8gdm9nbGlvIHVzYXJlIGNvbWUgY29tcG9uZW50ZSBjb21lIGVsZW1lbnRvIGh0bWxcbi8vVnVlLmNvbXBvbmVudCgnZzN3LXNlYXJjaCcsdnVlQ29tcG9uZW50T3B0aW9ucyk7XG5cbi8qIENPTVBPTkVOVEkgRklHTEkgKi9cbi8qIEZJTkUgQ09NUE9ORU5USSBGSUdMSSAqL1xuXG4vKiBJTlRFUkZBQ0NJQSBQVUJCTElDQSAqL1xuZnVuY3Rpb24gU2VhcmNoQ29tcG9uZW50KG9wdGlvbnMpe1xuICBiYXNlKHRoaXMsb3B0aW9ucyk7XG4gIHRoaXMuaWQgPSBcInNlYXJjaC1jb21wb25lbnRcIjtcbiAgdGhpcy50aXRsZSA9IFwic2VhcmNoXCI7XG4gIHRoaXMuX3NlcnZpY2UgPSBuZXcgU2VhcmNoZXNTZXJ2aWNlKCk7XG4gIHRoaXMuaW50ZXJuYWxDb21wb25lbnQgPSBuZXcgSW50ZXJuYWxDb21wb25lbnQoe1xuICAgIHNlYXJjaGVzU2VydmljZTogdGhpcy5fc2VydmljZVxuICB9KTtcbiAgdGhpcy5zdGF0ZS52aXNpYmxlID0gUHJvamVjdHNSZWdpc3RyeS5nZXRDdXJyZW50UHJvamVjdCgpLnN0YXRlLnNlYXJjaC5sZW5ndGggPiAwO1xuICBtZXJnZSh0aGlzLCBvcHRpb25zKTtcbiAgdGhpcy5pbml0U2VydmljZSA9IGZ1bmN0aW9uKCkge1xuICAgIC8vaW5pemlhbGl6em8gaWwgc2Vydml6aW9cbiAgICB0aGlzLl9zZXJ2aWNlLmluaXQoKTtcbiAgfTtcbn07XG5cbmluaGVyaXQoU2VhcmNoQ29tcG9uZW50LCBDb21wb25lbnQpO1xubW9kdWxlLmV4cG9ydHMgPSBTZWFyY2hDb21wb25lbnQ7XG4iLCJ2YXIgaW5oZXJpdCA9IHJlcXVpcmUoJ2NvcmUvdXRpbHMvdXRpbHMnKS5pbmhlcml0O1xudmFyIGJhc2UgPSByZXF1aXJlKCdjb3JlL3V0aWxzL3V0aWxzJykuYmFzZTtcbnZhciBHM1dPYmplY3QgPSByZXF1aXJlKCdjb3JlL2czd29iamVjdCcpO1xuXG5mdW5jdGlvbiBUb29sc1NlcnZpY2UoKXtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICB0aGlzLmNvbmZpZyA9IG51bGw7XG4gIHRoaXMuX2FjdGlvbnMgPSB7fTtcbiAgdGhpcy5zdGF0ZSA9IHtcbiAgICB0b29sc0dyb3VwczogW11cbiAgfTtcbiAgXG4gIHRoaXMuc2V0dGVycyA9IHtcbiAgICBhZGRUb29sR3JvdXA6IGZ1bmN0aW9uKGdyb3VwKSB7XG4gICAgICB0aGlzLnN0YXRlLnRvb2xzR3JvdXBzLnB1c2goZ3JvdXApO1xuICAgIH1cbiAgfVxuICBcbiAgdGhpcy5hZGRUb29scyA9IGZ1bmN0aW9uKGdyb3VwTmFtZSx0b29scykge1xuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICB2YXIgZ3JvdXAgPSB0aGlzLl9nZXRUb29sc0dyb3VwKGdyb3VwTmFtZSk7XG4gICAgaWYgKCFncm91cCkge1xuICAgICAgZ3JvdXAgPSB7XG4gICAgICAgIG5hbWU6IGdyb3VwTmFtZSxcbiAgICAgICAgdG9vbHM6IFtdXG4gICAgICB9O1xuICAgICAgdGhpcy5hZGRUb29sR3JvdXAoZ3JvdXApO1xuICAgIH1cbiAgICBfLmZvckVhY2godG9vbHMsZnVuY3Rpb24odG9vbCl7XG4gICAgICBncm91cC50b29scy5wdXNoKHRvb2wpO1xuICAgICAgc2VsZi5fYWRkQWN0aW9uKHRvb2wpO1xuICAgIH0pO1xuICB9O1xuICBcbiAgdGhpcy5yZW1vdmVUb29sID0gZnVuY3Rpb24odG9vbElkKSB7XG4gIH07XG4gIFxuICB0aGlzLmZpcmVBY3Rpb24gPSBmdW5jdGlvbihhY3Rpb25pZCl7XG4gICAgdmFyIGFjdGlvbiA9IHRoaXMuX2FjdGlvbnNbYWN0aW9uaWRdO1xuICAgIGFjdGlvbigpO1xuICB9O1xuICBcbiAgdGhpcy5fZ2V0VG9vbHNHcm91cCA9IGZ1bmN0aW9uKGdyb3VwTmFtZSkge1xuICAgIHZhciBncm91cCA9IG51bGw7XG4gICAgXy5mb3JFYWNoKHRoaXMuc3RhdGUudG9vbHNHcm91cHMsZnVuY3Rpb24oX2dyb3VwKXtcbiAgICAgIGlmIChfZ3JvdXAubmFtZSA9PSBncm91cE5hbWUpIHtcbiAgICAgICAgZ3JvdXAgPSBfZ3JvdXA7XG4gICAgICB9XG4gICAgfSlcbiAgICByZXR1cm4gZ3JvdXA7XG4gIH1cbiAgXG4gIHRoaXMuX2FkZEFjdGlvbiA9IGZ1bmN0aW9uKHRvb2wpIHtcbiAgICB2YXIgYWN0aW9uSWQgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMDAwMDAwKSsxO1xuICAgIHRvb2wuYWN0aW9uSWQgPSBhY3Rpb25JZDtcbiAgICB0aGlzLl9hY3Rpb25zW2FjdGlvbklkXSA9IHRvb2wuYWN0aW9uO1xuICB9XG4gIFxuICBiYXNlKHRoaXMpO1xufTtcbmluaGVyaXQoVG9vbHNTZXJ2aWNlLEczV09iamVjdCk7XG5cbm1vZHVsZS5leHBvcnRzID0gVG9vbHNTZXJ2aWNlO1xuIiwibW9kdWxlLmV4cG9ydHMgPSBcIjxkaXYgY2xhc3M9XFxcImczdy10b29sc1xcXCI+XFxuICA8dWw+XFxuICAgIDxsaSB2LWZvcj1cXFwiZ3JvdXAgaW4gc3RhdGUudG9vbHNHcm91cHNcXFwiPlxcbiAgICAgIDxkaXYgZGF0YS10b2dnbGU9XFxcImNvbGxhcHNlXFxcIiBkYXRhLXRhcmdldD1cXFwiI3t7IGdyb3VwLm5hbWUgfX0tdG9vbHNcXFwiIGNsYXNzPVxcXCJ0b29sLWhlYWRlclxcXCI+XFxuICAgICAgICA8c3BhbiBzdHlsZT1cXFwiXFxcIj57eyBncm91cC5uYW1lIH19PC9zcGFuPlxcbiAgICAgIDwvZGl2PlxcbiAgICAgIDxkaXYgaWQ9XFxcInt7IGdyb3VwLm5hbWUgfX0tdG9vbHNcXFwiIGNsYXNzPVxcXCJ0b29sLWJveCBjb2xsYXBzZVxcXCI+XFxuICAgICAgICA8dGVtcGxhdGUgdi1mb3I9XFxcInRvb2wgaW4gZ3JvdXAudG9vbHNcXFwiPlxcbiAgICAgICAgICA8aSBjbGFzcz1cXFwiZ2x5cGhpY29uIGdseXBoaWNvbi1jb2dcXFwiPjwvaT5cXG4gICAgICAgICAgPHNwYW4gQGNsaWNrPVxcXCJmaXJlQWN0aW9uKHRvb2wuYWN0aW9uSWQpXFxcIj57eyB0b29sLm5hbWUgfX08L3NwYW4+XFxuICAgICAgICA8L3RlbXBsYXRlPlxcbiAgICAgIDwvZGl2PlxcbiAgICA8L2xpPlxcbiAgPC91bD5cXG48L2Rpdj5cXG5cIjtcbiIsInZhciB0ID0gcmVxdWlyZSgnY29yZS9pMThuL2kxOG4uc2VydmljZScpLnQ7XG52YXIgaW5oZXJpdCA9IHJlcXVpcmUoJ2NvcmUvdXRpbHMvdXRpbHMnKS5pbmhlcml0O1xudmFyIGJhc2UgPSByZXF1aXJlKCdjb3JlL3V0aWxzL3V0aWxzJykuYmFzZTtcbnZhciBtZXJnZSA9IHJlcXVpcmUoJ2NvcmUvdXRpbHMvdXRpbHMnKS5tZXJnZTtcbnZhciBDb21wb25lbnQgPSByZXF1aXJlKCdndWkvdnVlL2NvbXBvbmVudCcpO1xudmFyIFRvb2xzU2VydmljZSA9IHJlcXVpcmUoJ2d1aS90b29scy90b29sc3NlcnZpY2UnKTtcblxudmFyIEludGVybmFsQ29tcG9uZW50ID0gVnVlLmV4dGVuZCh7XG4gICAgdGVtcGxhdGU6IHJlcXVpcmUoJy4vdG9vbHMuaHRtbCcpLFxuICAgIGRhdGE6IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3RhdGU6IG51bGxcbiAgICAgIH1cbiAgICB9LFxuICAgIG1ldGhvZHM6IHtcbiAgICAgIGZpcmVBY3Rpb246IGZ1bmN0aW9uKGFjdGlvbmlkKXtcbiAgICAgICAgdGhpcy4kb3B0aW9ucy50b29sc1NlcnZpY2UuZmlyZUFjdGlvbihhY3Rpb25pZCk7XG4gICAgICB9XG4gICAgfVxufSk7XG5cbmZ1bmN0aW9uIFRvb2xzQ29tcG9uZW50KG9wdGlvbnMpe1xuICBiYXNlKHRoaXMsb3B0aW9ucyk7XG4gIHZhciBzZWxmID0gdGhpcztcbiAgdGhpcy5fc2VydmljZSA9IG5ldyBUb29sc1NlcnZpY2UoKTtcbiAgdGhpcy5pZCA9IFwidG9vbHMtY29tcG9uZW50XCI7XG4gIHRoaXMudGl0bGUgPSBcInRvb2xzXCI7XG4gIHRoaXMuc3RhdGUudmlzaWJsZSA9IGZhbHNlO1xuICB0aGlzLl9zZXJ2aWNlLm9uYWZ0ZXIoJ2FkZFRvb2xHcm91cCcsZnVuY3Rpb24oKXtcbiAgICBzZWxmLnN0YXRlLnZpc2libGUgPSBzZWxmLl9zZXJ2aWNlLnN0YXRlLnRvb2xzR3JvdXBzLmxlbmd0aCA+IDA7XG4gIH0pXG4gIG1lcmdlKHRoaXMsIG9wdGlvbnMpO1xuICB0aGlzLmludGVybmFsQ29tcG9uZW50ID0gbmV3IEludGVybmFsQ29tcG9uZW50KHtcbiAgICB0b29sc1NlcnZpY2U6IHRoaXMuX3NlcnZpY2VcbiAgfSk7XG4gIHRoaXMuaW50ZXJuYWxDb21wb25lbnQuc3RhdGUgPSB0aGlzLl9zZXJ2aWNlLnN0YXRlXG59O1xuXG5pbmhlcml0KFRvb2xzQ29tcG9uZW50LCBDb21wb25lbnQpO1xuXG52YXIgcHJvdG8gPSBUb29sc0NvbXBvbmVudC5wcm90b3R5cGU7XG5cbm1vZHVsZS5leHBvcnRzID0gVG9vbHNDb21wb25lbnQ7XG4iLCJ2YXIgaW5oZXJpdCA9IHJlcXVpcmUoJ2NvcmUvdXRpbHMvdXRpbHMnKS5pbmhlcml0O1xudmFyIGJhc2UgPSByZXF1aXJlKCdjb3JlL3V0aWxzL3V0aWxzJykuYmFzZTtcbnZhciByZXNvbHZlID0gcmVxdWlyZSgnY29yZS91dGlscy91dGlscycpLnJlc29sdmU7XG52YXIgcmVqZWN0ID0gcmVxdWlyZSgnY29yZS91dGlscy91dGlscycpLnJlamVjdDtcbnZhciBCYXNlQ29tcG9uZW50ID0gcmVxdWlyZSgnZ3VpL2NvbXBvbmVudCcpO1xuXG52YXIgQ29tcG9uZW50ID0gZnVuY3Rpb24ob3B0aW9ucykge1xuICBiYXNlKHRoaXMsb3B0aW9ucyk7XG59O1xuXG5pbmhlcml0KENvbXBvbmVudCwgQmFzZUNvbXBvbmVudCk7XG5cbnZhciBwcm90byA9IENvbXBvbmVudC5wcm90b3R5cGU7XG5cbi8vIHZpZW5lIHJpY2hpYW1hdG8gZGFsbGEgdG9vbGJhciBxdWFuZG8gaWwgcGx1Z2luIGNoaWVkZSBkaSBtb3N0cmFyZSB1biBwcm9wcmlvIHBhbm5lbGxvIG5lbGxhIEdVSSAoR1VJLnNob3dQYW5lbClcbnByb3RvLm1vdW50ID0gZnVuY3Rpb24ocGFyZW50LGFwcGVuZCkge1xuICBpZiAoIXRoaXMuaW50ZXJuYWxDb21wb25lbnQpIHtcbiAgICB0aGlzLnNldEludGVybmFsQ29tcG9uZW50KCk7XG4gIH07XG4gIGlmKGFwcGVuZCkge1xuICAgIHRoaXMuaW50ZXJuYWxDb21wb25lbnQuJG1vdW50KCkuJGFwcGVuZFRvKHBhcmVudCk7XG4gIH1cbiAgZWxzZSB7XG4gICAgdGhpcy5pbnRlcm5hbENvbXBvbmVudC4kbW91bnQocGFyZW50KTtcbiAgfVxuICAkKHBhcmVudCkubG9jYWxpemUoKTtcbiAgcmV0dXJuIHJlc29sdmUodHJ1ZSk7XG59O1xuXG4vLyByaWNoaWFtYXRvIHF1YW5kbyBsYSBHVUkgY2hpZWRlIGRpIGNoaXVkZXJlIGlsIHBhbm5lbGxvLiBTZSByaXRvcm5hIGZhbHNlIGlsIHBhbm5lbGxvIG5vbiB2aWVuZSBjaGl1c29cbnByb3RvLnVubW91bnQgPSBmdW5jdGlvbigpIHtcbiAgLy8gaWwgcHJvYmxlbWEgY2hlIGRpc3RydWdnZXJlXG4gIHRoaXMuaW50ZXJuYWxDb21wb25lbnQuJGRlc3Ryb3kodHJ1ZSk7XG4gIHRoaXMuaW50ZXJuYWxDb21wb25lbnQgPSBudWxsO1xuICByZXR1cm4gcmVzb2x2ZSgpO1xufTtcblxucHJvdG8uaGlkZSA9IGZ1bmN0aW9uKCkge1xuICBjb25zb2xlLmxvZyh0aGlzLmludGVybmFsQ29tcG9uZW50LiRlbCk7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IENvbXBvbmVudDtcbiIsIlZ1ZS5kaXJlY3RpdmUoXCJkaXNhYmxlZFwiLGZ1bmN0aW9uKHZhbHVlKXtcbiAgICBpZiAodmFsdWUpe1xuICAgICAgdGhpcy5lbC5zZXRBdHRyaWJ1dGUoJ2Rpc2FibGVkJywnZGlzYWJsZWQnKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICB0aGlzLmVsLnJlbW92ZUF0dHJpYnV0ZSgnZGlzYWJsZWQnKTtcbiAgICB9XG4gIH1cbik7XG5cblZ1ZS5kaXJlY3RpdmUoXCJjaGVja2VkXCIsZnVuY3Rpb24odmFsdWUpe1xuICAgIGlmICh2YWx1ZSl7XG4gICAgICB0aGlzLmVsLnNldEF0dHJpYnV0ZSgnY2hlY2tlZCcsJ2NoZWNrZWQnKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICB0aGlzLmVsLnJlbW92ZUF0dHJpYnV0ZSgnY2hlY2tlZCcpO1xuICAgIH1cbiAgfVxuKTtcblxuVnVlLmRpcmVjdGl2ZShcInNlbGVjdGVkLWZpcnN0XCIsZnVuY3Rpb24odmFsdWUpe1xuICAgIGlmICh2YWx1ZT09MCl7XG4gICAgICB0aGlzLmVsLnNldEF0dHJpYnV0ZSgnc2VsZWN0ZWQnLCcnKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICB0aGlzLmVsLnJlbW92ZUF0dHJpYnV0ZSgnc2VsZWN0ZWQnKTtcbiAgICB9XG4gIH1cbik7XG4iLCJ2YXIgZzN3ID0gZzN3IHx8IHt9O1xuXG5nM3cuY29yZSA9IHtcbiAgIEczV09iamVjdDogcmVxdWlyZSgnY29yZS9nM3dvYmplY3QnKSxcbiAgIHV0aWxzOiByZXF1aXJlKCdjb3JlL3V0aWxzL3V0aWxzJyksXG4gICBBcHBsaWNhdGlvblNlcnZpY2U6IHJlcXVpcmUoJ2NvcmUvYXBwbGljYXRpb25zZXJ2aWNlJyksXG4gICBBcGlTZXJ2aWNlOiByZXF1aXJlKCdjb3JlL2FwaXNlcnZpY2UnKSxcbiAgIFJvdXRlcjogcmVxdWlyZSgnY29yZS9yb3V0ZXInKSxcbiAgIFByb2plY3RzUmVnaXN0cnk6IHJlcXVpcmUoJ2NvcmUvcHJvamVjdC9wcm9qZWN0c3JlZ2lzdHJ5JyksXG4gICBQcm9qZWN0OiByZXF1aXJlKCdjb3JlL3Byb2plY3QvcHJvamVjdCcpLFxuICAgUXVlcnlTZXJ2aWNlOiByZXF1aXJlKCdjb3JlL3F1ZXJ5L3F1ZXJ5c2VydmljZScpLFxuICAgTWFwTGF5ZXI6IHJlcXVpcmUoJ2NvcmUvbWFwL21hcGxheWVyJyksXG4gICBMYXllclN0YXRlOiByZXF1aXJlKCdjb3JlL2xheWVyL2xheWVyc3RhdGUnKSxcbiAgIFZlY3RvckxheWVyOiByZXF1aXJlKCdjb3JlL2xheWVyL3ZlY3RvcmxheWVyJyksXG4gICBXbXNMYXllcjogcmVxdWlyZSgnY29yZS9sYXllci93bXNsYXllcicpLFxuICAgR2VvbWV0cnk6IHJlcXVpcmUoJ2NvcmUvZ2VvbWV0cnkvZ2VvbWV0cnknKSxcbiAgIGdlb206IHJlcXVpcmUoJ2NvcmUvZ2VvbWV0cnkvZ2VvbScpLFxuICAgUGlja0Nvb3JkaW5hdGVzSW50ZXJhY3Rpb246IHJlcXVpcmUoJ2NvcmUvaW50ZXJhY3Rpb25zL3BpY2tjb29yZGluYXRlc2ludGVyYWN0aW9uJyksXG4gICBQaWNrRmVhdHVyZUludGVyYWN0aW9uOiByZXF1aXJlKCdjb3JlL2ludGVyYWN0aW9ucy9waWNrZmVhdHVyZWludGVyYWN0aW9uJyksXG4gICBpMThuOiByZXF1aXJlKCdjb3JlL2kxOG4vaTE4bi5zZXJ2aWNlJyksXG4gICBQbHVnaW46IHJlcXVpcmUoJ2NvcmUvcGx1Z2luL3BsdWdpbicpLFxuICAgUGx1Z2luc1JlZ2lzdHJ5OiByZXF1aXJlKCdjb3JlL3BsdWdpbi9wbHVnaW5zcmVnaXN0cnknKSxcbiAgIEVkaXRvcjogcmVxdWlyZSgnY29yZS9lZGl0aW5nL2VkaXRvcicpXG59O1xuXG5nM3cuZ3VpID0ge1xuICBHVUk6IHJlcXVpcmUoJ2d1aS9ndWknKSxcbiAgRm9ybTogcmVxdWlyZSgnZ3VpL2Zvcm0nKS5Gb3JtLFxuICBGb3JtUGFuZWw6IHJlcXVpcmUoJ2d1aS9mb3JtJykuRm9ybVBhbmVsLFxuICBQYW5lbDogcmVxdWlyZSgnZ3VpL3BhbmVsJyksXG4gIHZ1ZToge1xuICAgIC8vR2VvY29kaW5nQ29tcG9uZW50OiByZXF1aXJlKCdndWkvdnVlL2dlb2NvZGluZy9nZW9jb2RpbmcnKSxcbiAgICBTZWFyY2hDb21wb25lbnQ6IHJlcXVpcmUoJ2d1aS9zZWFyY2gvdnVlL3NlYXJjaCcpLFxuICAgIENhdGFsb2dDb21wb25lbnQ6IHJlcXVpcmUoJ2d1aS9jYXRhbG9nL3Z1ZS9jYXRhbG9nJyksXG4gICAgTWFwQ29tcG9uZW50OiByZXF1aXJlKCdndWkvbWFwL3Z1ZS9tYXAnKSxcbiAgICBUb29sc0NvbXBvbmVudDogcmVxdWlyZSgnZ3VpL3Rvb2xzL3Z1ZS90b29scycpLFxuICAgIFF1ZXJ5UmVzdWx0c0NvbXBvbmVudCA6IHJlcXVpcmUoJ2d1aS9xdWVyeXJlc3VsdHMvdnVlL3F1ZXJ5cmVzdWx0cycpXG4gIH1cbn07XG5cbm1vZHVsZS5leHBvcnRzID0ge1xuICBjb3JlOiBnM3cuY29yZSxcbiAgZ3VpOiBnM3cuZ3VpXG59O1xuIl19
