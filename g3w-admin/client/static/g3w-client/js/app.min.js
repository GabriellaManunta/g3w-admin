!function e(t,i,n){function r(s,a){if(!i[s]){if(!t[s]){var l="function"==typeof require&&require;if(!a&&l)return l(s,!0);if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var u=i[s]={exports:{}};t[s][0].call(u.exports,function(e){var i=t[s][1][e];return r(i?i:e)},u,u.exports,e,t,i,n)}return i[s].exports}for(var o="function"==typeof require&&require,s=0;s<n.length;s++)r(n[s]);return r}({1:[function(e,t,i){var n="G3W Client",r={},o={tools:[]},s={resources:e("./locales/app.js")},a={debug:!0,local:!1},l={urls:{ows:"/ows",api:"/api",initconfig:"/api/initconfig",config:"/api/config"}};t.exports={apptitle:n,client:a,server:l,plugins:r,tools:o,i18n:s}},{"./locales/app.js":2}],2:[function(e,t,i){var n={it:{translation:{component:"Componente Generico",search:"Ricerche",dosearch:"Cerca",catalog:"Mappa",baselayers:"Basi",tools:"Strumenti",tree:"Strati",legend:"Legenda",street_search:"Cerca indirizzo",show:"Mostra",hide:"Nascondi",street_search:"Cerca indirizzo",copy_form_data:"Copia i dati del modulo",paste_form_data:"Incolla",copy_form_data_from_feature:"Copia i dati dalla mappa",could_not_load_vector_layers:"Errore del server: non Ã¨ satto possibile caricare i vettoriali richiesti"}}};t.exports=n},{}],3:[function(e,t,i){function n(){return{apptitle:c.apptitle||"",logo_img:c.group.header_logo_img,logo_link:c.group.header_logo_link,terms_of_use_text:c.group.header_terms_of_use_text,terms_of_use_link:c.group.terms_of_use_link,debug:c.client.debug||!1,group:c.group,urls:c.server.urls,mediaurl:c.server.urls.mediaurl,resourcesurl:c.server.urls.clienturl,projects:c.group.projects,initproject:c.group.initproject,overviewproject:c.group.overviewproject,baselayers:c.group.baselayers,mapcontrols:c.group.mapcontrols,background_color:c.group.background_color,crs:c.group.crs,proj4:c.group.proj4,minscale:c.group.minscale,maxscale:c.group.maxscale,getWmsUrl:function(e){return c.server.urls.ows+"/"+c.group.id+"/"+e.type+"/"+e.id},getProjectConfigUrl:function(e){return c.server.urls.config+"/"+c.group.id+"/"+e.type+"/"+e.id},plugins:c.group.plugins,tools:c.tools,views:c.views||{}}}function r(){var t=e("sdk").gui.vue.CatalogComponent,i=e("sdk").gui.vue.SearchComponent,n=e("sdk").gui.vue.ToolsComponent,r=e("sdk").gui.vue.MapComponent,o=e("./template/js/contentsviewer"),s=e("sdk").gui.vue.QueryResultsComponent;return{title:c.apptitle,placeholders:{navbar:{components:[]},sidebar:{components:[new i({id:"search",open:!1,icon:"fa fa-search"}),new t({id:"catalog",open:!0,icon:"fa fa-database"}),new n({id:"tools",open:!1,icon:"fa fa-gear"})]},floatbar:{components:[]}},othercomponents:[new s({id:"queryresults"})],viewport:{components:{map:new r({id:"map"}),content:new o({id:"contents"})}}}}function o(e){var t=$.Deferred();if(window.initConfig)return t.resolve(window.initConfig);var i,n=location.search.substring(1).split("&");if(_.forEach(n,function(e){e.indexOf("project")>-1&&(i=e.split("=")[1])}),i){var r=e;i&&(r=r+"/"+i),$.get(r,function(e){e.staticurl="../dist/",e.clienturl="../dist/",t.resolve(e)})}return t.promise()}var s=e("sdk").core.i18n.init,a=e("sdk/sdk").core.ApplicationService,l=e("./template/js/template"),c=e("./config/config.js");window.g3wsdk=e("sdk"),a.on("ready",function(){var e=r();applicationTemplate=new l(e,this),applicationTemplate.init(),applicationTemplate.on("ready",function(){a.postBootstrap()})}),bootstrap=function(){s(c.i18n),o(c.server.urls.initconfig).then(function(e){c.server.urls.staticurl=e.staticurl,c.server.urls.clienturl=e.staticurl+e.client,c.server.urls.mediaurl=e.mediaurl,c.group=e.group;var t=n();a.init(t,!0)})}()},{"./config/config.js":1,"./template/js/contentsviewer":12,"./template/js/template":16,sdk:100,"sdk/sdk":100}],4:[function(e,t,i){t.exports='<div class="wrapper">\n  <header class="main-header">\n    <!-- Logo -->\n    <!-- Header Navbar: style can be found in header.less -->\n    <nav class="navbar navbar-static-top" role="navigation">\n      <!-- Toggle button on navbar only for mobile -->\n      <a v-if="isMobile()" href="#" class="sidebar-toggle" data-toggle="offcanvas" role="button">\n        <span class="sr-only">Expand</span>\n      </a>\n      <div class="logo-wrapper">\n        <a v-if="logo_url" :href="logo_link" :target="logo_link_target" class=""><img :src="logo_url" style="height:40px"></a>\n        <span class="">{{project_title}}</span>\n      </div>\n    </nav>\n  </header>\n  <!-- Left side column. contains the logo and sidebar -->\n  <sidebar></sidebar>\n  <!-- Content Wrapper. Contains page content -->\n  <div class="content-wrapper" style="background-color:white">\n    <viewport></viewport>\n  </div>\n  <!-- /.content-wrapper -->\n  <!-- Control Sidebar -->\n  <floatbar></floatbar>\n  <!-- /.control-sidebar -->\n  <!-- Add the sidebar\'s background. This div must be placed\n       immediately after the control sidebar -->\n  <div class="control-sidebar-bg"></div>\n</div>\n'},{}],5:[function(e,t,i){t.exports='<div id="contents" class="contents"></div>\n'},{}],6:[function(e,t,i){t.exports='<aside class="control-sidebar control-sidebar-light" >\n  <a v-show="panelsinstack" href="#" class="floatbar-aside-toggle" data-toggle="control-sidebar" role="button">\n    <span class="sr-only">Expand</span>\n  </a>\n  <div id="floatbar-spinner" style="position:absolute"></div>\n  <div v-show="panelsinstack" class="g3w-sidebarpanel">\n    <div v-if="stack.closable" class="close-panel-block">\n      <button class="glyphicon glyphicon-remove pull-right close-panel-button" @click="closePanel"></button>\n    </div>\n    <div v-if="panelname">\n      <h4 class="g3w-floatbarpanel-name">{{ panelname }}</h4>\n    </div>\n    <div id="g3w-floatbarpanel-placeholder" class="g3w-floatbarpanel-placeholder"></div>\n  </div>\n</aside>\n'},{}],7:[function(e,t,i){t.exports='<li v-show="state.visible" class="treeview sidebaritem" :class="{\'active\': open}">\n  <a href="#">\n    <i :class="icon"></i>\n    <span class="treeview-label">{{title | t}}</span>\n    <i class="fa fa-angle-left pull-right"></i>\n  </a>\n  <div id="g3w-sidebarcomponent-placeholder" class="treeview-menu"></div>\n</li>\n'},{}],8:[function(e,t,i){t.exports='<aside class="main-sidebar">\n  <!-- sidebar: style can be found in sidebar.less -->\n  <!-- Sidebar toggle button-->\n  <!-- Toggle button on the left side of main sidebar only if not mobile -->\n  <a v-if="!isMobile()" href="#" class="sidebar-aside-toggle" data-toggle="offcanvas" role="button">\n    <span class="sr-only">Expand</span>\n  </a>\n  <!--<div class="quick-actions-menu">\n    <button class="btn btn-default btn-circle-medium glyphicon glyphicon-share-alt"></button>\n    <button class="btn btn-default btn-circle-medium glyphicon glyphicon-modal-window"></button>\n    <button class="btn btn-default btn-circle-medium glyphicon glyphicon-print"></button>\n    <button class="btn btn-default btn-circle-medium glyphicon glyphicon-search"></button>\n  </div>-->\n\t<section class="sidebar">\n    <div v-show="panelsinstack" class="g3w-sidebarpanel">\n      <div style="overflow: hidden;line-height: 14px;margin-top: 4px; font-size:1.5em">\n          <button class="glyphicon glyphicon-remove pull-right close-panel-button" @click="closePanel"></button>\n      </div>\n      <div id="g3w-sidebarpanel-placeholder" class="g3w-sidebarpanel-placeholder"></div>\n    </div>\n\t  <ul id="g3w-sidebarcomponents" v-show="showmainpanel" class="sidebar-menu"></ul>\n\t</section>\n\t<!-- /.sidebar -->\n</aside>\n'},{}],9:[function(e,t,i){t.exports='<div class="g3w-viewport">\n  <div id="g3w-view-map" class="g3w-view map" :style="{width:state.map.sizes.width+\'px\',height:state.map.sizes.height+\'px\'}">\n  </div>\n  <div id="g3w-view-content" class="g3w-view content" :style="{width:state.content.sizes.width+\'px\',height:state.content.sizes.height+\'px\'}">\n    <div v-if="contentSmallerThenPreferred" @click="closeMap" style="\n    position: absolute;\n    left: -50px;\n    top: 7px;\n    line-height: 1;\n    padding: 7px 2px;\n    font-size: 1.5em;\n    background-color: #3c8dbc;\n    color: white;\n    height: 39px;\n    width: 39px;\n    ">\n      <button class="glyphicon glyphicon-remove pull-right close-panel-button" style="background-color: transparent;border: 0px;"></button>\n    </div>\n    <div v-if="state.content.closable" class="close-panel-block">\n      <span v-if="contentTitle">{{ contentTitle }}</span><button v-if="state.content.aside" class="glyphicon glyphicon-remove pull-right close-panel-button" @click="closeContent"></button>\n    </div>\n    <div v-if="previousTitle" class="g3w_contents_back">\n      <span @click="gotoPreviousContent()">Torna a {{ previousTitle }}</span>\n    </div>\n  </div>\n</div>\n'},{}],10:[function(e,t,i){var n=e("core/applicationservice"),r=e("core/project/projectsregistry"),o=e("./layout"),s=Vue.extend({template:e("../html/app.html"),ready:function(){function e(){$(i).css("max-height",$(window).innerHeight()),$(".g3w-sidebarpanel").css("height",$(window).height()-$(".main-header").height())}function t(){$("#g3w-modal-overlay").css("height",$(window).height())}o.loading(!1),o.setup(),o.pushMenu.expandOnHover(),o.controlSidebar._fix($(".control-sidebar-bg")),o.controlSidebar._fix($(".control-sidebar"));var i=o.options.controlSidebarOptions.selector;e(),$(window).resize(function(){e(),t()})},computed:{logo_url:function(){var e,t=n.getConfig();return t.logo_img&&""!=t.logo_img&&(e=t.mediaurl+t.logo_img),e},logo_link:function(){var e=this.getLogoLink();return e?e:"#"},logo_link_target:function(){var e=this.getLogoLink();return e?"_blank":""},project_title:function(){var e=r.getCurrentProject();return e.state.name}},methods:{closePanel:function(){sidebarService.closePanel()},isMobile:function(){return isMobile.any},getLogoLink:function(){var e=null;return n.getConfig().logo_link&&(e=n.getConfig().logo_link),e}}});t.exports=s},{"../html/app.html":4,"./layout":14,"core/applicationservice":19,"core/project/projectsregistry":45}],11:[function(e,t,i){function n(){this._parent=null,this.state={panels:[]}}var r=e("sdk/core/utils/utils").inherit,o=e("sdk/core/g3wobject"),s=e("gui/vue/component");r(n,o);var a=n.prototype;a.push=function(e,t,i){return this._parent=t,i=i||!1,this._mount(e,i)},a.pop=function(){if(this.state.panels.length){var e=this.state.panels.slice(-1)[0];this._unmount(e)}},a.clear=function(){var e=this,t=$.Deferred(),i=[];return _.forEach(this.state.panels,function(t,n){i.push(e._unmount(t))}),$.when(i).then(function(){t.resolve()}),t.promise()},a._mount=function(e,t){var i=$.Deferred();if(e instanceof jQuery)this._setJqueryContent(e),i.resolve();else if(_.isString(e)){var n=$(e);n.length||(n=$("<div>"+e+"</div>")),this._setJqueryContent(n),i.resolve()}else e.mount&&"function"==typeof e.mount?(this._checkDuplicateVueContent(e),this._setVueContent(e,t).then(function(){i.resolve()})):(this._setDOMContent(e),i.resolve());return i.promise()},a._setJqueryContent=function(e){$(this._parent).append(e),this.state.panels.push(e)},a._setDOMContent=function(e){this._parent.appendChild(e),this.state.panels.push(e)},a._setVueContent=function(e,t){var i=this;return e.mount(this._parent,t).then(function(){$(parent).localize(),i.state.panels.push(e)})},a._checkDuplicateVueContent=function(e){var t=this,i=null,n=e.getId();if(_.forEach(this.state.panels,function(e,t){e.getId&&e.getId()==n&&(i=t)}),!_.isNull(i)){var r=t.state.panels[i];r.unmount().then(function(){t.state.panels.splice(i,1)})}},a._unmount=function(e){var t=this,i=$.Deferred();return e instanceof s?e.unmount().then(function(){t.state.panels.pop(),i.resolve()}):($(this._parent).empty(),this.state.panels.pop(),i.resolve()),i.promise()},a.getLength=function(){return this.state.panels.length},t.exports=n},{"gui/vue/component":98,"sdk/core/g3wobject":31,"sdk/core/utils/utils":51}],12:[function(e,t,i){function n(e){o(this,e),this.stack=new s,this.setService(this),this.title="contents",this.state.visible=!0,this._content=null,this.setInternalComponent(new l({service:this})),this.internalComponent.state=this.state}var r=e("core/utils/utils").inherit,o=e("core/utils/utils").base,s=e("./barstack.js"),a=e("gui/vue/component"),l=Vue.extend({template:e("../html/contentsviewer.html"),data:function(){return{state:null}}});r(n,a);var c=n.prototype;c.setContent=function(e){var t=this,i=$.Deferred();return this.clearContents().then(function(){t.stack.push(e,t.internalComponent.$el,!0).then(function(){i.resolve()})}),i.promise()},c.removeContent=function(){return this.stack.pop()},c.popContent=function(){return this.removeContent()},c.clearContents=function(){return this.stack.clear()},t.exports=n},{"../html/contentsviewer.html":5,"./barstack.js":11,"core/utils/utils":51,"gui/vue/component":98}],13:[function(e,t,i){function n(){this.stack=new r,this.init=function(e){this.layout=e,this.sidebarEl=$(this.layout.options.controlSidebarOptions.selector),this._zindex=this.sidebarEl.css("z-index"),this._modalOverlay=null,this._modal=!1,this._isopen=!1},this.isOpen=function(){return this._isopen},this.open=function(){this.layout.floatBar.open(this.sidebarEl,!0),this._isopen=!0},this.close=function(){this.layout.floatBar.close(this.sidebarEl,!0),this._isopen=!1},this.showPanel=function(e,t){var t=t||{};t.append||!1,t.modal||!1;this.stack.push(e,"#g3w-floatbarpanel-placeholder",t),this._isopen||this.open()},this.closePanel=function(e){e?this.stack.remove(e):this.stack.pop(),this.stack.getLength()||(this._modal?(o.setModal(!1),this.close(),$(".control-sidebar-bg").toggleClass("control-sidebar-bg-shadow"),this.sidebarEl.css("z-index",""),this.sidebarEl.css("padding-top","50px"),$(".control-sidebar-bg").css("z-index",""),this._modal=!1):this.close())},this.hidePanel=function(){this.close()}}var r=(e("sdk/core/i18n/i18n.service").t,e("./barstack.js")),o=e("sdk/gui/gui"),s=new n,a=Vue.extend({template:e("../html/floatbar.html"),data:function(){return{stack:s.stack.state}},computed:{panelsinstack:function(){return this.stack.panels.length>0},panelname:function(){var e;return this.stack.panels.length&&(e=this.stack.panels.slice(-1)[0].getTitle()),e},closable:function(){return s.closable}},watch:{"stack.panels":function(){var e=$("#g3w-floatbarpanel-placeholder").children();_.forEach(e,function(t,i){i==e.length-1?$(t).show():$(t).hide()})}},methods:{closePanel:function(){s.closePanel()}}});t.exports={FloatbarService:s,FloatbarComponent:a}},{"../html/floatbar.html":6,"./barstack.js":11,"sdk/core/i18n/i18n.service":34,"sdk/gui/gui":79}],14:[function(e,t,i){if("undefined"==typeof jQuery)throw new Error("LayoutManager requires jQuery");$.LayoutManager={},$.LayoutManager.options={navbarMenuSlimscroll:!0,navbarMenuSlimscrollWidth:"0px",navbarMenuHeight:"200px",animationSpeed:"fast",sidebarToggleSelector:"[data-toggle='offcanvas']",sidebarPushMenu:!0,sidebarSlimScroll:!0,sidebarExpandOnHover:!1,enableBoxRefresh:!0,enableBSToppltip:!0,BSTooltipSelector:"[data-toggle='tooltip']",enableFastclick:!0,enableControlSidebar:!0,controlSidebarOptions:{toggleBtnSelector:"[data-toggle='control-sidebar']",selector:".control-sidebar",slide:!0},enableBoxWidget:!0,boxWidgetOptions:{boxWidgetIcons:{collapse:"fa-minus",open:"fa-plus",remove:"fa-times"},boxWidgetSelectors:{remove:'[data-widget="remove"]',collapse:'[data-widget="collapse"]'}},directChat:{enable:!0,contactToggleSelector:'[data-widget="chat-pane-toggle"]'},colors:{lightBlue:"#3c8dbc",red:"#f56954",green:"#00a65a",aqua:"#00c0ef",yellow:"#f39c12",blue:"#0073b7",navy:"#001F3F",teal:"#39CCCC",olive:"#3D9970",lime:"#01FF70",orange:"#FF851B",fuchsia:"#F012BE",purple:"#8E24AA",maroon:"#D81B60",black:"#222222",gray:"#d2d6de"},screenSizes:{xs:480,sm:768,md:992,lg:1200}},$.LayoutManager._init=function(){"use strict";return $.LayoutManager.layout={activate:function(){var e=this;e.fix(),e.fixSidebar(),$(window,".wrapper").resize(function(){e.fix(),e.fixSidebar()})},fix:function(){var e=$(".main-header").outerHeight()+$(".main-footer").outerHeight(),t=$(window).height(),i=$(".sidebar").height();if($("body").hasClass("fixed"))$(".content-wrapper, .right-side").css("min-height",t-$(".main-footer").outerHeight()),$(".content-wrapper, .right-side").css("height",t-$(".main-footer").outerHeight());else{var n;t>=i?($(".content-wrapper, .right-side").css("min-height",t-e),n=t-e):($(".content-wrapper, .right-side").css("min-height",i),n=i);var r=$($.LayoutManager.options.controlSidebarOptions.selector);"undefined"!=typeof r&&r.height()>n&&$(".content-wrapper, .right-side").css("min-height",r.height())}},fixSidebar:function(){return $("body").hasClass("fixed")?("undefined"==typeof $.fn.slimScroll&&window.console&&window.console.error("Error: the fixed layout requires the slimscroll plugin!"),void($.LayoutManager.options.sidebarSlimScroll?"undefined"!=typeof $.fn.slimScroll&&($(".sidebar").slimScroll({destroy:!0}).height("auto"),$(".sidebar").slimscroll({height:$(window).height()-$(".main-header").height()+"px",color:"rgba(255,255,255,0.7)",size:"3px"})):$(".sidebar").css({height:$(window).height()-$(".main-header").height()+"px"}))):void("undefined"!=typeof $.fn.slimScroll&&$(".sidebar").slimScroll({destroy:!0}).height("auto"))}},$.LayoutManager.pushMenu={activate:function(e){var t=$.LayoutManager.options.screenSizes;$(e).on("click",function(e){e.preventDefault(),$(window).width()>t.sm-1?$("body").hasClass("sidebar-collapse")?$("body").removeClass("sidebar-collapse").trigger("expanded.pushMenu"):$("body").addClass("sidebar-collapse").trigger("collapsed.pushMenu"):$("body").hasClass("sidebar-open")?$("body").removeClass("sidebar-open").removeClass("sidebar-collapse").trigger("collapsed.pushMenu"):$("body").addClass("sidebar-open").trigger("expanded.pushMenu")}),($.LayoutManager.options.sidebarExpandOnHover||$("body").hasClass("fixed")&&$("body").hasClass("sidebar-mini"))&&this.expandOnHover()},expandOnHover:function(){var e=this,t=$.LayoutManager.options.screenSizes.sm-1;$(".main-sidebar").hover(function(){$("body").hasClass("sidebar-mini")&&$("body").hasClass("sidebar-collapse")&&$(window).width()>t&&e.expand()},function(){$("body").hasClass("sidebar-mini")&&$("body").hasClass("sidebar-expanded-on-hover")&&$(window).width()>t&&e.collapse()})},expand:function(){$("body").removeClass("sidebar-collapse").addClass("sidebar-expanded-on-hover")},collapse:function(){$("body").hasClass("sidebar-expanded-on-hover")&&$("body").removeClass("sidebar-expanded-on-hover").addClass("sidebar-collapse")}},$.LayoutManager.tree=function(e){var t=this,i=$.LayoutManager.options.animationSpeed;$(document).on("click",e+" li a",function(e){var n=$(this),r=n.next();if(r.is(".treeview-menu")&&r.is(":visible"))r.slideUp(i,function(){r.parent("li.treeview").removeClass("active"),r.removeClass("menu-open")});else if(r.is(".treeview-menu")&&!r.is(":visible")){var o,s=n.parents("ul").first(),a=n.parent("li"),l=a.siblings(),c=(s.height()-s.find("li.header").outerHeight(),a.outerHeight());l.not(".header").each(function(e,t){c+=$(t).find("a").outerHeight()});var u=s.find("ul.treeview-menu:visible").slideUp(i);u.removeClass("menu-open"),r.slideDown(i,function(){r.addClass("menu-open"),o=s.find("li.treeview.active"),o.removeClass("active"),a.addClass("active"),t.layout.fix()})}r.is(".treeview-menu")&&e.preventDefault()})},$.LayoutManager.floatBar=$.LayoutManager.controlSidebar={activate:function(){var e=this,t=$.LayoutManager.options.controlSidebarOptions,i=$(t.selector),n=$(t.toggleBtnSelector);n.on("click",function(n){n.preventDefault(),i.hasClass("control-sidebar-open")||$("body").hasClass("control-sidebar-open")?e.close(i,t.slide):e.open(i,t.slide)});var r=$(".control-sidebar-bg");e._fix(r),$("body").hasClass("fixed")?e._fixForFixed(i):$(".content-wrapper, .right-side").height()<i.height()&&e._fixForContent(i)},open:function(e,t){t?e.addClass("control-sidebar-open"):$("body").addClass("control-sidebar-open")},close:function(e,t){t?e.removeClass("control-sidebar-open"):$("body").removeClass("control-sidebar-open")},_fix:function(e){var t=this;$("body").hasClass("layout-boxed")?(e.css("position","absolute"),e.height($(".wrapper").height()),$(window).resize(function(){t._fix(e)})):e.css({position:"fixed",height:"auto"})},_fixForFixed:function(e){e.css({position:"fixed","max-height":"100%","padding-bottom":"50px"})},_fixForContent:function(e){$(".content-wrapper, .right-side").css("min-height",e.height())}},$.LayoutManager.boxWidget={selectors:$.LayoutManager.options.boxWidgetOptions.boxWidgetSelectors,icons:$.LayoutManager.options.boxWidgetOptions.boxWidgetIcons,animationSpeed:$.LayoutManager.options.animationSpeed,activate:function(e){var t=this;e||(e=document),$(e).on("click",t.selectors.collapse,function(e){e.preventDefault(),t.collapse($(this))}),$(e).on("click",t.selectors.remove,function(e){e.preventDefault(),t.remove($(this))})},collapse:function(e){var t=this,i=e.parents(".box").first(),n=i.find("> .box-body, > .box-footer, > form  >.box-body, > form > .box-footer");i.hasClass("collapsed-box")?(e.find(".btn-collapser").removeClass(t.icons.open).addClass(t.icons.collapse),n.slideDown(t.animationSpeed,function(){i.removeClass("collapsed-box")})):(e.find(".btn-collapser").removeClass(t.icons.collapse).addClass(t.icons.open),n.slideUp(t.animationSpeed,function(){i.addClass("collapsed-box")}))},remove:function(e){var t=e.parents(".box").first();t.slideUp(this.animationSpeed)}},$.LayoutManager},$.LayoutManager.addRefreshButton=function(){"use strict";return $.fn.boxRefresh=function(e){function t(e){e.append(r),n.onLoadStart.call(e)}function i(e){e.find(r).remove(),n.onLoadDone.call(e)}var n=$.extend({trigger:".refresh-btn",source:"",onLoadStart:function(e){return e},onLoadDone:function(e){return e}},e),r=$('<div class="overlay"><div class="fa fa-refresh fa-spin"></div></div>');return this.each(function(){if(""===n.source)return void(window.console&&window.console.log("Please specify a source first - boxRefresh()"));var e=$(this),r=e.find(n.trigger).first();r.on("click",function(r){r.preventDefault(),t(e),e.find(".box-body").load(n.source,function(){i(e)})})})},$.LayoutManager},$.LayoutManager.activateBox=function(){"use strict";return $.fn.activateBox=function(){$.LayoutManager.boxWidget.activate(this)},$.LayoutManager},$.LayoutManager.listCustomPlugin=function(){"use strict";return $.fn.todolist=function(e){var t=$.extend({onCheck:function(e){return e},onUncheck:function(e){return e}},e);return this.each(function(){"undefined"!=typeof $.fn.iCheck?($("input",this).on("ifChecked",function(){var e=$(this).parents("li").first();e.toggleClass("done"),t.onCheck.call(e)}),$("input",this).on("ifUnchecked",function(){var e=$(this).parents("li").first();e.toggleClass("done"),t.onUncheck.call(e)})):$("input",this).on("change",function(){var e=$(this).parents("li").first();e.toggleClass("done"),$("input",e).is(":checked")?t.onCheck.call(e):t.onUncheck.call(e)})})},$.LayoutManager},$.LayoutManager.setup=function(){"use strict";$("body").removeClass("hold-transition"),"undefined"!=typeof LayoutManagerOptions&&$.extend(!0,$.LayoutManager.options,LayoutManagerOptions);var e=$.LayoutManager.options;return $.LayoutManager._init(),$.LayoutManager.layout.activate(),$.LayoutManager.tree(".sidebar"),e.enableControlSidebar&&$.LayoutManager.controlSidebar.activate(),e.navbarMenuSlimscroll&&"undefined"!=typeof $.fn.slimscroll&&$(".navbar .menu").slimscroll({height:e.navbarMenuHeight,alwaysVisible:!1,size:e.navbarMenuSlimscrollWidth}).css("width","100%"),e.sidebarPushMenu&&$.LayoutManager.pushMenu.activate(e.sidebarToggleSelector),e.enableBSToppltip&&$("body").tooltip({selector:e.BSTooltipSelector}),e.enableBoxWidget&&$.LayoutManager.boxWidget.activate(),e.enableFastclick&&"undefined"!=typeof FastClick&&FastClick.attach(document.body),e.directChat.enable&&$(document).on("click",e.directChat.contactToggleSelector,function(){var e=$(this).parents(".direct-chat").first();e.toggleClass("direct-chat-contacts-open")}),$('.btn-group[data-toggle="btn-toggle"]').each(function(){var e=$(this);$(this).find(".btn").on("click",function(t){e.find(".btn.active").removeClass("active"),$(this).addClass("active"),t.preventDefault()})}),$.LayoutManager.addRefreshButton().activateBox().listCustomPlugin()},$.LayoutManager.loading=function(e){var e=!_.isBoolean(e)||e;e?$("body").append('<div id="loadspinner" class="loading"></div>'):$("#loadspinner").remove()},t.exports=$.LayoutManager},{}],15:[function(e,t,i){function n(){this.stack=new s,this.setters={closeSidebarPanel:function(){}},this.state={components:[]},this.init=function(e){this.layout=e},this.addComponents=function(e){var t=this;return _.forEach(e,function(e){t.addComponent(e)}),!0},this.addComponent=function(e){this.state.components.push(e);var t=new c;return t.title=e.title||t.title,t.open=void 0===e.open?t.open:e.open,t.icon=e.icon||t.icon,t.state=e.state||!0,t.$mount().$appendTo("#g3w-sidebarcomponents"),e.mount("#g3w-sidebarcomponent-placeholder"),_.has(e,"initService")&&e.initService(),!0},this.removeComponent=function(){},this.showPanel=function(e){var t="#g3w-sidebarpanel-placeholder";this.stack.push(e,t)},this.closePanel=function(){this.closeSidebarPanel();this.stack.pop()},l(this)}var r=e("sdk/core/i18n/i18n.service").t,o=e("sdk/core/utils/utils").inherit,s=e("./barstack.js"),a=e("sdk/core/g3wobject"),l=e("sdk/core/utils/utils").base,c=Vue.extend({template:e("../html/sidebar-item.html"),data:function(){return{main:!0,component:null,active:!1,title:"component",icon:null,open:!0,state:null}}});o(n,a);var u=new n,h=Vue.extend({template:e("../html/sidebar.html"),data:function(){return{components:u.state.components,panels:u.stack.state.panels,bOpen:!0,bPageMode:!1,header:r("main navigation")}},computed:{panelsinstack:function(){return this.panels.length>0},showmainpanel:function(){return this.components.length>0&&!this.panelsinstack},componentname:function(){var e="";return this.components.length&&(e=this.components.slice(-1)[0].getTitle()),e},panelname:function(){var e="";return this.panels.length&&(e=this.panels.slice(-1)[0].getTitle()),e}},methods:{closePanel:function(){u.closePanel()},isMobile:function(){return isMobile.any}},ready:function(){}});t.exports={SidebarService:u,SidebarComponent:h}},{"../html/sidebar-item.html":7,"../html/sidebar.html":8,"./barstack.js":11,"sdk/core/g3wobject":31,"sdk/core/i18n/i18n.service":34,"sdk/core/utils/utils":51}],16:[function(e,t,i){var n=e("sdk/core/i18n/i18n.service").t;e("sdk/gui/vue/vue.directives");var r=e("core/utils/utils").inherit,o=e("core/utils/utils").base,s=e("core/g3wobject"),a=e("sdk/gui/componentsregistry"),l=e("sdk/gui/gui"),c=e("./sidebar"),u=e("./floatbar"),h=e("./viewport"),d=e("./applicationui"),f=e("./layout");f.loading();var p=function(t,i){self=this,this.templateConfig=t,this.init=function(){var e=i.getConfig();e.debug&&(Vue.config.debug=!0),this._setupInterface(),this._setupLayout(),this._setUpServices()},this._setupLayout=function(){Vue.filter("t",function(e){return n(e)}),Vue.component("sidebar",c.SidebarComponent),Vue.component("viewport",h.ViewportComponent),Vue.component("floatbar",u.FloatbarComponent),Vue.component("app",d);new Vue({el:"body",ready:function(){self._buildTemplate(),$(document).localize()}})},this._setUpServices=function(){_.forEach(p.Services,function(e,t){i.registerService(t,e)})},this._buildTemplate=function(){var e=this;u.FloatbarService.init(f);var t=this.templateConfig.placeholders;_.forEach(t,function(t,i){e._addComponents(t.components,i)}),this._addOtherComponents(),this._setViewport(this.templateConfig.viewport),this.emit("ready"),l.ready()},this._addOtherComponents=function(){var e=this;this.templateConfig.othercomponents&&e._addComponents(this.templateConfig.othercomponents)},this._setViewport=function(e){e&&(p.Services.viewport.init(e),this._addComponents(e.components))},this._addComponent=function(e,t){this._addComponents([e],t)},this._addComponents=function(e,t){var i=!0;if(t&&p.PLACEHOLDERS.indexOf(t)>-1){var n=p.Services[t];n&&(i=n.addComponents(e))}_.forEach(e,function(e){i&&a.registerComponent(e)})},this._removeComponent=function(e){a.unregisterComponent(e)},this._showModalOverlay=function(e){var t=l.getComponent("map").getService();e?t.startDrawGreyCover():t.stopDrawGreyCover()},this._showSidebar=function(){},this._hideSidebar=function(){},this._setupInterface=function(){l.layout=f,l.addComponent=_.bind(this._addComponent,this),l.removeComponent=_.bind(this._removeComponent,this),l.getResourcesUrl=_.bind(function(){return i.getConfig().resourcesurl},this),l.showList=_.bind(u.FloatbarService.showPanel,u.FloatbarService),l.closeList=_.bind(u.FloatbarService.closePanel,u.FloatbarService),l.hideList=_.bind(u.FloatbarService.hidePanel,u.FloatbarService),l.showTable=function(){},l.closeTable=function(){},l.showContentFactory=function(e){var t;switch(e){case"query":t=l.showQueryResults;break;case"form":t=l.showForm}return t},l.showForm=function(t){var i=e("sdk").gui.vue.FormComponent,n=t.formComponent?new t.formComponent:new i({id:"form"}),r=n.getService();return r.setInitForm(t),l.setContent({content:n,push:!1,closable:!1}),r},l.closeForm=function(){h.ViewportService.removeContent()},l.showQueryResults=function(e,t){var i=l.getComponent("queryresults"),n=i.getService();return n.reset(),t&&n.setQueryResponse(t),l.showContextualContent(i,"Risultati "+e),n},l.showPanel=_.bind(c.SidebarService.showPanel,c.SidebarService),l.closePanel=_.bind(c.SidebarService.closePanel,c.SidebarService),toastr.options.positionClass="toast-top-center",toastr.options.preventDuplicates=!0,toastr.options.timeOut=2e3,l.notify=toastr,l.dialog=bootbox,l.showSpinner=function(e){var t=e.container||"body",i=e.id||"loadspinner",n=e.where||"prepend",r=e.style||"",o=e.transparent?"background-color: transparent":"";$("#"+i).length||$(t)[n].call($(t),'<div id="'+i+'" class="spinner-wrapper '+r+'" style="'+o+'"><div class="spinner '+r+'"></div></div>')},l.hideSpinner=function(e){$("#"+e).remove()},l.showFloatbar=function(){u.FloatbarService.open()},l.hideFloatbar=function(){u.FloatbarService.close()},l.showSidebar=_.bind(this._showSidebar,this),l.hideSidebar=_.bind(this._hideSidebar,this),l.setModal=_.bind(this._showModalOverlay,this),l.setPrimaryView=function(e){h.ViewportService.setPrimaryView(e)},l.showMap=function(){h.ViewportService.showMap()},l.showContextualMap=function(e,t){e=e||30,h.ViewportService.showContextualMap({perc:e,split:t})},l.setContextualMapComponent=function(e){h.ViewportService.setContextualMapComponent(e)},l.resetContextualMapComponent=function(){h.ViewportService.resetContextualMapComponent()},l.showContent=function(e,t,i){var n={content:e,title:t,split:i,perc:100};l.setContent(n)},l.showContextualContent=function(e,t,i,n){var r={content:e,title:t,split:n,perc:i||50};l.setContent(r)},l.pushContent=function(e){var e=e||{};e.push=!0,e.perc=100,l.setContent(e)},l.pushContextualContent=function(e,t,i,n){var r={content:e,title:t,perc:i||50,split:n,push:!0};l.setContent(r)},l.setContent=function(e){var e=e||{},t=e.content||{},i=e.title||"",n=e.push||!1,r=e.perc||0,o=e.split||null,s=e.closable,a=e.backonclose||!1;h.ViewportService.showContent({content:t,title:i,push:n,split:o,perc:r,closable:s,backonclose:a})}},o(this)};r(p,s),p.PLACEHOLDERS=["navbar","sidebar","viewport","floatbar"],p.Services={navbar:null,sidebar:c.SidebarService,viewport:h.ViewportService,floatbar:c.FloatbarService},t.exports=p},{"./applicationui":10,"./floatbar":13,"./layout":14,"./sidebar":15,"./viewport":17,"core/g3wobject":31,"core/utils/utils":51,sdk:100,"sdk/core/i18n/i18n.service":34,"sdk/gui/componentsregistry":72,"sdk/gui/gui":79,"sdk/gui/vue/vue.directives":99}],17:[function(e,t,i){var n=e("sdk").core.utils.inherit,r=e("sdk").core.utils.base,o=e("sdk").core.G3WObject,s=e("sdk").gui.GUI,a=function(){this.state={primaryView:"map",secondaryPerc:0,split:"h",map:{sizes:{width:0,height:0},aside:!1},content:{sizes:{width:0,height:0},aside:!0,stack:[],closable:!0,backonclose:!1}},this._components={map:null,content:null},
this._defaultMapComponent,this._contextualMapComponent,this.contentStack=[],this._secondaryViewMinWidth=300,this._secondaryViewMinHeight=200,this.init=function(e){var e=e||{};this.state.primaryView=e.primaryview?e.primaryview:"map",this.state.split=e.split?e.split:"h",this._addComponents(e.components)},this.showMap=function(){this._toggleMapComponentVisibility(this._defaultMapComponent),this._components.map=this._defaultMapComponent,this._showView("map")},this.showContextualMap=function(e){var t=this;if(this._contextualMapComponent||(this._contextualMapComponent=this._defaultMapComponent),this._contextualMapComponent!=this._defaultMapComponent&&this._toggleMapComponentVisibility(this._defaultMapComponent,!1),this._contextualMapComponent.ismount())t._components.map=this._contextualMapComponent,this._toggleMapComponentVisibility(this._contextualMapComponent,!0);else{var i=this._contextualMapComponent;i.mount("#g3w-view-map",!0).then(function(){t._components.map=i})}this._showView("map",e)},this.recoverDefaultMap=function(){this._components.map!=this._defaultMapComponent&&(this._components.map=this._defaultMapComponent,this._toggleMapComponentVisibility(this._contextualMapComponent,!1),this._toggleMapComponentVisibility(this._defaultMapComponent,!0))},this.setContextualMapComponent=function(e){e!=this._defaultMapComponent&&(this._contextualMapComponent&&this._contextualMapComponent.unmount(),this._contextualMapComponent=e)},this.resetContextualMapComponent=function(){this._contextualMapComponent&&this._contextualMapComponent.unmount(),this._contextualMapComponent=this._defaultMapComponent},this._toggleMapComponentVisibility=function(e,t){e.internalComponent.$el.style.display=t?"block":"none"},this.closeMap=function(){this.state.secondaryPerc="map"==this.state.primaryView?100:0,this.recoverDefaultMap(),this._layout()},this.showContent=function(e){var t="boolean"==typeof e.push&&e.push;t||(this.contentStack=[]),this.contentStack.push(e),this._setContents(e)},this.popContent=function(){if(this.contentStack.length){this.recoverDefaultMap(),this.contentStack.pop();var e=this.contentStack[this.contentStack.length-1];this._setContents(e)}},this.clearContentStack=function(){this.contentStack=[]},this.removeContent=function(){this.state.content.backonclose?this.popContent():(this.clearContentStack(),this.recoverDefaultMap(),this.closeSecondaryView())},this.isPrimaryView=function(e){return this.state.primaryView==e},this.setPrimaryView=function(e){this.state.primaryView!=e&&(this.state.primaryView=e),this._layout()},this.showPrimaryView=function(e){e&&this.state.secondaryVisible&&100==this.state.secondaryPerc&&(this.state.secondaryPerc=100-e,this._layout())},this.showSecondaryView=function(e,t){this.state.secondaryVisible=!0,this.state.split=e?e:this.state.split,this.state.secondaryPerc=t?t:this.state.perc,this._layout()},this.closeSecondaryView=function(e){var t=this,i=this._components[this._otherView(this.state.primaryView)];i.clearContents?i.clearContents().then(function(){t.state.secondaryVisible=!1,t._layout()}):(this.state.secondaryVisible=!1,this._layout())},this._addComponents=function(e){var t=this;_.forEach(e,function(e,i){["map","content"].indexOf(i)>-1&&e.mount("#g3w-view-"+i,!0).then(function(){t._components[i]=e,"map"==i&&(t._defaultMapComponent=e)})})},this._setContents=function(e){var e=e||{},t=this;this._components.content.setContent(e.content).then(function(){t.state.content.preferredPerc=e.perc||t.getDefaultViewPerc("content"),t.state.content.title=e.title,t.state.content.closable=!!_.isNil(e.closable)||e.closable,t.state.content.backonclose=!!_.isNil(e.backonclose)||e.backonclose,t.state.content.stack=_.map(t.contentStack,function(e){return e.title}),t._showView("content",e)})},this._showView=function(e,t){t=t||{};var i,n=t.perc||this.getDefaultViewPerc(e),r=t.split||"h";i=!this.isPrimaryView(e)||"undefined"!=typeof t.aside&&t.aside,this.state[e].aside=i;var o=this.isPrimaryView(e)?100-n:n;o>0?this.showSecondaryView(r,o):this.closeSecondaryView()},this.getDefaultViewPerc=function(e){return this.isPrimaryView(e)?100:50},this._otherView=function(e){return"map"==e?"content":"map"},this._setPrimaryView=function(e){this.state.primaryView!=e&&(this.state.primaryView=e)},this._firstLayout=function(){function e(){r=!0,t()}function t(){r===!0?(r=!1,n=!0,i._layout(),requestAnimationFrame(t)):n=!1}var i=this,n=!1,r=!1;s.on("ready",function(){var t=i.state.primaryView,r=i._otherView(t),o=$(".g3w-viewport ."+r),a=o.css("min-width");""==a||_.isNaN(parseFloat(a))||(i._secondaryViewMinWidth=parseFloat(a));var l=o.css("min-height");""==l||_.isNaN(parseFloat(l))||(i._secondaryViewMinHeight=parseFloat(l)),i._layout(),s.on("guiresized",function(){e()}),$(window).resize(function(){n===!1&&e()}),$(".main-sidebar").on("webkitTransitionEnd transitionend msTransitionEnd oTransitionEnd",function(){$(this).trigger("trans-end"),e()})})},this._setViewSizes=function(){var e=this.state.primaryView,t=this._otherView(e),i=this._viewportWidth(),n=this._viewportHeight(),r=i,o=n,s=this.state.secondaryPerc/100;"h"==this.state.split?(secondaryWidth=this.state.secondaryVisible?Math.max(i*s,this._secondaryViewMinWidth):0,secondaryHeight=n,r=i-secondaryWidth,o=n):(secondaryWidth=i,secondaryHeight=this.state.secondaryVisible?Math.max(n*s,this._secondaryViewMinHeight):0,r=i,o=n-secondaryHeight),this.state[e].sizes.width=r,this.state[e].sizes.height=o,this.state[t].sizes.width=secondaryWidth,this.state[t].sizes.height=secondaryHeight},this._viewportHeight=function(){var e=$(".navbar").innerHeight();return $(window).innerHeight()-e},this._viewportWidth=function(){var e=$(".main-sidebar").offset().left,t=$(".main-sidebar").innerWidth(),i=t+e;return $(window).innerWidth()-i},this._layout=function(){var e="h"==this.state.split?"split-h":"split-v",t="h"==this.state.split?"split-v":"split-c";$(".g3w-viewport .g3w-view").addClass(e),$(".g3w-viewport .g3w-view").removeClass(t),this._setViewSizes(),this._layoutComponents()},this._layoutComponents=function(){var e=this;_.forEach(this._components,function(t,i){var n=e.state[i].sizes.width,r=e.state[i].sizes.height;t.layout(n,r)})},this._firstLayout(),r(this)};n(a,o);var l=new a,c=Vue.extend({template:e("../html/viewport.html"),data:function(){return{state:l.state}},computed:{contentTitle:function(){return this.state.content.stack[this.state.content.stack.length-1]},previousTitle:function(){return this.state.content.stack.length>1?this.state.content.stack[this.state.content.stack.length-2]:null},contentSmallerThenPreferred:function(){return this.state.secondaryPerc<this.state.content.preferredPerc}},methods:{closeContent:function(){l.removeContent()},closeMap:function(){l.closeMap()},gotoPreviousContent:function(){l.popContent()}}});t.exports={ViewportService:l,ViewportComponent:c}},{"../html/viewport.html":9,sdk:100}],18:[function(e,t,i){function n(){this._config=null,this._baseUrl=null,this._apiUrls={},this.init=function(e){this._config=e,this._baseUrl=e.urls.api,this._apiEndpoints=e.urls.apiEndpoints};var e=0;this._incrementLoaders=function(){0==e&&this.emit("apiquerystart"),e+=1},this._decrementLoaders=function(){e-=1,0==e&&this.emit("apiqueryend")},this.get=function(e,t){var i=this,n=this._apiEndpoints[e];if(n){var r=this._baseUrl+"/"+n;t.request&&(r=r+"/"+t.request);var o=t.params||{};return i.emit(e+"querystart"),this._incrementLoaders(),$.get(r,o).done(function(t){return i.emit(e+"queryend",t),t}).fail(function(t){return i.emit(e+"queryfail",t),t}).always(function(){i._decrementLoaders()})}return a()},o(this)}var r=e("core/utils/utils").inherit,o=e("core/utils/utils").base,s=e("core/g3wobject"),a=e("core/utils/utils").reject;r(n,s),t.exports=new n},{"core/g3wobject":31,"core/utils/utils":51}],19:[function(e,t,i){var n=e("core/utils/utils").inherit,r=e("core/utils/utils").base,o=e("core/g3wobject"),s=e("core/apiservice"),a=e("core/router"),l=e("core/project/projectsregistry"),c=e("core/plugin/pluginsregistry"),u=e("core/clipboardservice"),h=function(){this.secret="### G3W Client Application Service ###",this.ready=!1,this.complete=!1,this._modalOverlay=null,this._acquirePostBoostrap=!1,this._applicationServices={},this.config={},r(this),this.init=function(e,t){this._config=e,t&&(this._acquirePostBoostrap=!0),this._bootstrap()},this.getConfig=function(){return this._config},this.getRouterService=function(){return a},this.getClipboardService=function(){return u},this.postBootstrap=function(){this.complete||(a.init(),this.complete=!0)},this._bootstrap=function(){var e=this;this.ready||$.when(s.init(this._config),l.init(this._config)).then(function(){c.init({pluginsBaseUrl:e._config.urls.staticurl,pluginsConfigs:e._config.plugins}),e.emit("ready"),e._acquirePostBoostrap||e.postBootstrap(),this.initialized=!0})},this.registerService=function(e,t){this._applicationServices[e]=t},this.unregisterService=function(e){delete this._applicationServices[e]},this.getService=function(e){return this._applicationServices[e]}};n(h,o),t.exports=new h},{"core/apiservice":18,"core/clipboardservice":20,"core/g3wobject":31,"core/plugin/pluginsregistry":42,"core/project/projectsregistry":45,"core/router":49,"core/utils/utils":51}],20:[function(e,t,i){function n(){this._data={},this.set=function(e,t){var i=e.split("form")[0];this._data[i]=t,console.log(t)},this.get=function(e){var t=this._data[e]||{};return this._data[e]={},t}}t.exports=new n},{}],21:[function(e,t,i){function n(e,t){var t=t||{};this._editor=e,this._origVectorLayer=new ol.layer.Vector({source:new ol.source.Vector}),this._cloneLayer(),this._geometriesBuffer={},this._attributesBuffer={},this._relationsBuffers={},this._relationEditBuffer=t.relationEditBuffer||s}var r=e("core/utils/utils").inherit,o=e("core/g3wobject"),s=e("./relationeditbuffer");r(n,o),t.exports=n;var a=n.prototype;a.commit=function(){var e=this,t=this._editor.getVectorLayer(),i=this._editor.getEditVectorLayer().getFeatures();i&&(_.forEach(i,function(t,n){i[n]=e._editor._transformCoordinateFeatureFromLayerToMap(t)}),t.addFeatures(i));var n=this._geometriesBuffer;_.forEach(n,function(i,n){if(!e._isNewFeature(n)){var r=t.getFeatureById(n);r&&(r=e._editor._transformCoordinateFeatureFromLayerToMap(r),r.setStyle(null),t.modifyFeatureGeometry(n,r.getGeometry()))}}),this._editor.getEditVectorLayer().clear(),this._clearBuffers(),this._cloneLayer()},a.undoAll=function(){this._resetVectorLayer(),this._clearBuffers()},a.destroy=function(){this._clearBuffers()},a.generateId=function(){return this._editor.generateId()},a.addFeature=function(e){e.getId()||e.setId(this.generateId()),this._addEditToGeometryBuffer(e,"add")},a.updateFeature=function(e){this._addEditToGeometryBuffer(e,"update")},a.deleteFeature=function(e,t){this._addEditToGeometryBuffer(e,"delete"),this._addEditToValuesBuffers(e,t,"delete")},a.updateFields=function(e,t){e.getId()||e.setId(this.generateId()),this._addEditToValuesBuffers(e,t)},a.getFeatureAttributes=function(e){return this._attributesBuffer[e]?this._attributesBuffer[e].slice(-1)[0]:null},a.areFeatureAttributesEdited=function(e){return!!this._attributesBuffer[e]&&this._attributesBuffer[e].length>-1},a.hasRelationsEdits=function(e){var t=!1;return _.forEach(this._relationsBuffers[e],function(e){t=t||e.hasRelationElements()}),t},a.getRelationsEdits=function(e){var t={};return _.forEach(this._relationsBuffers[e],function(e){t[e.getRelationName()]=e.getRelationElements()}),t},a.collectFeatureIds=function(){var e=this._geometriesBuffer,t=this._attributesBuffer,i=[];return i=_.concat(i,_.keys(e)),i=_.concat(i,_.keys(t)),_.uniq(i)},a.collectFeatures=function(e,t){var i,n=this,t=(this._geometriesBuffer,this._attributesBuffer,t||!1),r=new ol.format.GeoJSON,o=this.collectFeatureIds();i="new"==e?n._editor.getEditVectorLayer():n._editor.getVectorLayer();var s=[];return _.forEach(o,function(o){var a=i.getFeatureById(o),l=n._isNewFeature(o),c="new"==e&&l&&a,u="updated"==e&&!l&&a,h="deleted"==e&&!l&&!a;c||u?(t&&(a=r.writeFeatureObject(a)),s.push(a)):h&&s.push(o)}),s},a.createFeature=function(e,t,i){var n=new ol.Feature;return n.setId(e),n.setGeometry(t),n.setProperties(i),n},a.collectRelations=function(){var e={add:[],"delete":[],update:[]};return _.forEach(this._relationsBuffers,function(t,i){var n={fid:i,relations:{}},r={fid:i,relations:{}},o={fid:i,relations:{}};_.forEach(t,function(e){var t=e.getRelationName(),i=e.getRelationElementsOnlyFieldsValues("NEW"),s=e.getRelationElementsOnlyFieldsValues("OLD"),a=e.getRelationElementsOnlyFieldsValues("OLD_DELETED"),l=[],c=[],u=[];_.forEach(i,function(e){l.push({id:e.id,fields:e.fields})}),_.forEach(s,function(e){c.push({id:e.id,fields:e.fields})}),_.forEach(a,function(e){u.push({id:e.id})}),n.relations[t]=l,r.relations[t]=c,o.relations[t]=u}),e.add.push(n),e.update.push(r),e["delete"].push(o)}),e},a._addEditToGeometryBuffer=function(e,t){var i=this._geometriesBuffer,n=e.getId(),r=e.getGeometry();if("delete"==t){r=null;var o=this._isNewFeature(n)?this._editor.getEditVectorLayer():this._editor.getVectorLayer();o.getSource().removeFeature(e)}_.has(i,n)||(i[n]=[]),i[n].push(r),this._setDirty(!0)},a._addDeleteRelationsBuffers=function(e){e&&_.forEach(e,function(e){_.has(self._relationsBuffers,fid)||(self._relationsBuffers[fid]={}),_.has(self._relationsBuffers[fid],e.name)||(self._relationsBuffers[fid][e.name]=new self._relationEditBuffer(self,e.name));var t=self._relationsBuffers[fid][e.name];t.updateRelation(e)})},a._addEditToValuesBuffers=function(e,t){var i=this,n=e.getId(),r=e.getProperties(),o=this._attributesBuffer;_.has(o,n)||(o[n]=[]),o[n].push(r),t&&_.forEach(t,function(e){_.has(i._relationsBuffers,n)||(i._relationsBuffers[n]={}),_.has(i._relationsBuffers[n],e.name)||(i._relationsBuffers[n][e.name]=new i._relationEditBuffer(i,e.name));var t=i._relationsBuffers[n][e.name];t.updateRelation(e)}),this._setDirty(!0)},a._isNewFeature=function(e){return this._editor.isNewFeature(e)},a._setDirty=function(e){var t=e||!_.isEmpty(this._geometriesBuffer)||!_.isEmpty(this._attributesBuffer)||!_.isEmpty(this._relationsAttributesBuffer);this._editor._setDirty(t)},a._resetVectorLayer=function(){this._editor.vectoLayer=this._origVectorLayer,this._origVectorLayer.getSource().clear()},a._clearBuffers=function(){this._geometriesBuffer={},this._attributesBuffer={},this._relationsAttributesBuffer={},this._editor._setDirty(!1)},a._cloneLayer=function(){var e=[];this._editor.getVectorLayer().getSource().forEachFeature(function(t){e.push(t.clone())},this),this._origVectorLayer.getSource().addFeatures(e)}},{"./relationeditbuffer":23,"core/g3wobject":31,"core/utils/utils":51}],22:[function(e,t,i){function n(e){var e=e||{};this._formComponent=e.formComponent||null,this._mapService=e.mapService||{},this._vectorLayer=null,this._editVectorLayer=null,this._editBufferClass=e.editBufferClass||v,this._editBuffer=null,this._activeTool=null,this._dirty=!1,this._newPrefix="_new_",this._featureLocks=null,this._started=!1,this._editingVectorStyle=e.editingVectorStyle||null,this.checkOneRelation=e.checkOneRelation||!1,this._copyAndPasteFieldsNotOverwritable=e.copyAndPasteFieldsNotOverwritable||{},this._fieldsLayerbindToRelationsFileds=e.fieldsLayerbindToRelationsFileds||{},this._formTools=e.formTools||["copypaste"],this._pickedFeature=null,this._setterslisteners={before:{},after:{}},this._geometrytypes=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],this._toolsForGeometryTypes={Point:{addfeature:u,movefeature:h,deletefeature:f,editattributes:p},MultiPoint:{addfeature:u,movefeature:h,deletefeature:f,editattributes:p},LineString:{addfeature:u,modifyvertex:d,movefeature:h,deletefeature:f,editattributes:p,cutline:g},Polygon:{addfeature:u,modifyvertex:d,movefeature:h,deletefeature:f,editattributes:p},MultiPolygon:{addfeature:u,modifyvertex:d,movefeature:h,deletefeature:f,editattributes:p}},this._activeTool=new function(){this.type=null,this.instance=null,this.setTool=function(e,t){this.type=e,this.instance=t},this.getType=function(){return this.type},this.getTool=function(){return this.instance},this.clear=function(){this.type=null,this.instance=null}},this._tools={},this._setupAddFeatureAttributesEditingListeners(),this._setupEditAttributesListeners(),this._askConfirmToDeleteEditingListener(),o(this)}var r=e("core/utils/utils").inherit,o=e("core/utils/utils").base,s=e("core/utils/utils").resolve,a=e("core/g3wobject"),l=e("gui/gui"),c=e("core/map/layer/vectorlayer"),u=e("./tools/addfeaturetool"),h=e("./tools/movepointtool"),d=e("./tools/modifyfeaturetool"),f=e("./tools/deletefeaturetool"),p=e("./tools/pickfeaturetool"),g=e("./tools/cutlinetool"),v=e("./editbuffer");r(n,a);var m=n.prototype;m._askConfirmToDeleteEditingListener=function(){var e=this;this.onbeforeasync("deleteFeature",function(t,i,n){e._deleteFeatureDialog(n)})},m._deleteFeatureDialog=function(e){l.dialog.confirm("Vuoi eliminare l'elemento selezionato?",function(t){e(t)})},m._setupAddFeatureAttributesEditingListeners=function(){var e=this;this.onbeforeasync("addFeature",function(t,i){e._openEditorForm("new",t,i)},100)},m._setupEditAttributesListeners=function(){var e=this;this.onbeforeasync("pickFeature",function(t,i){var n=e.isNewFeature(t.getId())?"new":"old";e._openEditorForm(n,t,i)})},m.getcopyAndPasteFieldsNotOverwritable=function(){return this._copyAndPasteFieldsNotOverwritable},m.setcopyAndPasteFieldsNotOverwritable=function(e){this._copyAndPasteFieldsNotOverwritable=e},m.getfieldsLayerbindToRelationsFileds=function(){return this._fieldsLayerbindToRelationsFileds},m.getMapService=function(){return this._mapService},m.getPickedFeature=function(){return this._pickedFeature},m.setPickedFeature=function(e){this._pickedFeature=e},m.cleanUpPickedFeature=function(){this._pickedFeature.setStyle(null),this._pickedFeature=null},m.setVectorLayer=function(e){var t=e.geometrytype;if(!t||!this._isCompatibleType(t))throw Error("Vector geometry type "+t+" is not valid for editing");this._setToolsForVectorType(t),this._vectorLayer=e},m.addEditingLayerToMap=function(e){this._editVectorLayer=new c({name:"editvector",geometrytype:e}),this._editingVectorStyle&&this._editVectorLayer.setStyle(this._editingVectorStyle.url),this._mapService.viewer.map.addLayer(this._editVectorLayer.getMapLayer())},m.removeEditingLayerFromMap=function(){this._mapService.viewer.removeLayerByName(this._editVectorLayer.name),this._editVectorLayer=null},m.start=function(){var e=!1;return this._vectorLayer&&(this.stop(),this.addEditingLayerToMap(this._vectorLayer.geometrytype),this._editBuffer=new this._editBufferClass(this),this._setStarted(!0),e=!0),e},m.stop=function(){return!this.isStarted()||!!this.stopTool()&&(this._editBuffer.destroy(),this._editBuffer=null,this.removeEditingLayerFromMap(),this._setStarted(!1),!0)},m.destroy=function(){this.stop()&&this.removeAllListeners()},m.setTool=function(e,t){if(!this.stopTool())return!1;var i=this._tools[e];if(i){var n=new i(this,t);return this._activeTool.setTool(e,n),this._setToolSettersListeners(n),n.run(),!0}},m.stopTool=function(){return!(this._activeTool.instance&&!this._activeTool.instance.stop())&&(l.closeForm(),l.setModal(!1),this._activeTool.clear(),!0)},m.getActiveTool=function(){return this._activeTool},m.isStarted=function(){return this._started},m.hasActiveTool=function(){return!_.isNull(this._activeTool.instance)},m.isToolActive=function(e){return!!this._activeTool.toolType&&this._activeTool.toolType==e},m.commit=function(e){this._editBuffer.commit(e)},m.undoAll=function(){this._editBuffer.undoAll()},m.setFeatureLocks=function(e){this._featureLocks=e},m.getFeatureLocks=function(){return this._featureLocks},m.getFeatureLockIds=function(){return _.map(this._vectorLayer.getFeatureLocks(),function(e){return e.lockid})},m.getFeatureLocksLockIds=function(e){var e=e||this._vectorLayer.getFeatureLocks();return _.map(e,function(e){return e.lockid})},m.getFeatureLocksFeatureIds=function(e){var e=e||this._vectorLayer.getFeatureLocks();return _.map(e,function(e){return e.featureid})},m.getFeatureLockIdsForFeatureIds=function(e){var t=_.filter(this._vectorLayer.getFeatureLocks(),function(t){return _.includes(e,t.featureid)});return this.getFeatureLocksLockIds(t)},m.getFeatureLockForFeatureIds=function(e){return this._vectorLayer.getFeatureLocks()},m.getEditedFeatures=function(){var e=this._editBuffer.collectFeatureIds(),t=this.getFeatureLockForFeatureIds(e);return{add:this._editBuffer.collectFeatures("new",!0),update:this._editBuffer.collectFeatures("updated",!0),"delete":this._editBuffer.collectFeatures("deleted",!0),relationsedits:this.collectRelations(),lockids:t}},m.collectRelations=function(){return relationsEdits=this._editBuffer.collectRelations(),relationsEdits},m.setFieldsWithValues=function(e,t,i){var n={};_.forEach(t,function(e){"null"==e.value&&(e.value=null),n[e.name]=e.value}),e.setProperties(n),this._editBuffer.updateFields(e,i),i&&this._vectorLayer.setRelationsData(e.getId(),i)},m.getRelationsWithValues=function(e){var t=e.getId();if(this._vectorLayer.hasRelations()){var i;if(t)if(this._vectorLayer.getFeatureById(t)){var n=this._editBuffer.hasRelationsEdits(t);if(n){var r=this._editBuffer.getRelationsEdits(t),o=this._vectorLayer.getRelations();_.forEach(o,function(e){e.elements=_.cloneDeep(r[e.name])}),i=s(o)}else i=this._vectorLayer.getRelationsWithValues(t)}else if(this._vectorLayer.featureHasRelationsFksWithValues(e)){var a=this._vectorLayer.getRelationsFksWithValuesForFeature(e);i=this._vectorLayer.getNewRelationsWithValuesFromFks(a)}else i=this._vectorLayer.getRelationsWithValues(t);else i=this._vectorLayer.getRelationsWithValues()}else i=s(null);return i},m.createRelationElement=function(e){var t={};return t.fields=_.cloneDeep(this._vectorLayer.getRelationFields(e)),t.id=this.generateId(),t.state="NEW",t},m.getRelationPkFieldIndex=function(e){return this._vectorLayer.getRelationPkFieldIndex(e)},m.getField=function(e,t){var t=t||this.getVectorLayer().getFieldsWithValues(),i=null;return _.forEach(t,function(t){t.name==e&&(i=t)}),i},m.isDirty=function(){return this._dirty},m.onafter=function(e,t,i){this._onaftertoolaction(e,t,i)},m.onbefore=function(e,t,i){this._onbeforetoolaction(e,t,!1,i)},m.onbeforeasync=function(e,t,i){this._onbeforetoolaction(e,t,!0,i)},m._onaftertoolaction=function(e,t,i){i=i||0,_.get(this._setterslisteners.after,e)||(this._setterslisteners.after[e]=[]),this._setterslisteners.after[e].push({fnc:t,priority:i})},m._onbeforetoolaction=function(e,t,i,n){n=n||0,_.get(this._setterslisteners.before,e)||(this._setterslisteners.before[e]=[]),this._setterslisteners.before[e].push({fnc:t,how:i?"async":"sync",priority:n})},m._setToolSettersListeners=function(e){_.forEach(this._setterslisteners.before,function(t,i){_.hasIn(e.setters,i)&&_.forEach(t,function(t){"sync"==t.how?e.onbefore(i,t.fnc,t.priority):e.onbeforeasync(i,t.fnc,t.priority)})}),_.forEach(this._setterslisteners.after,function(t,i){_.hasIn(e.setters,i)&&_.forEach(t,function(t){e.onafter(i,t.fnc,t.priority)})})},m._transformCoordinateFeatureFromMapToLayer=function(e){var t=this._mapService.getProjection().getCode(),i=this._vectorLayer.getCrs(),n=e.getGeometry().getCoordinates();return n=ol.proj.transform(n,t,i),e.getGeometry().setCoordinates(n),e},m._transformCoordinateFeatureFromLayerToMap=function(e){var t=this._mapService.getProjection().getCode(),i=this._vectorLayer.getCrs(),n=e.getGeometry().getCoordinates();return n=ol.proj.transform(n,i,t),e.getGeometry().setCoordinates(n),e},m.addFeature=function(e){e=this._transformCoordinateFeatureFromMapToLayer(e),this._editBuffer.addFeature(e)},m.updateFeature=function(e){e=this._transformCoordinateFeatureFromMapToLayer(e),this._editBuffer.updateFeature(e)},m.pickFeature=function(e){this.updateFeature(e)},m.moveFeature=function(e){this.updateFeature(e)},m.deleteFeature=function(e,t,i){this._editBuffer.deleteFeature(e,t)},m.getVectorLayer=function(){return this._vectorLayer},m.getEditVectorLayer=function(){return this._editVectorLayer},m.generateId=function(){return this._newPrefix+Date.now()},m.generateFormId=function(e){return e+"form"+Date.now()},m.isNewFeature=function(e){return!e||0==e.toString().indexOf(this._newPrefix)},m._isCompatibleType=function(e){return this._geometrytypes.indexOf(e)>-1},m._setToolsForVectorType=function(e){var t=this,i=this._toolsForGeometryTypes[e];_.forEach(i,function(e,i){t._tools[i]=e})},m._setStarted=function(e){this._started=e},m._setDirty=function(e){_.isNil(e)?this._dirty=!0:this._dirty=e,this.emit("dirty",this._dirty)},m._onSaveEditorForm=function(e,t,i,n){var r=this,n=n,e=e;return function(t,i){r.setFieldsWithValues(e,t,i),n&&n(!0),l.setModal(!1)}},m._openEditorForm=function(e,t,i){var n=this,r=this.getVectorLayer(),o=r.getFieldsWithValues(t),s=r.pk;s&&_.isNull(this.getField(s))&&_.forEach(t.getProperties(),function(e,t){var i=n.getField(t,o);i&&(i.value=e)});var a=this.getRelationsWithValues(t),c=l.showContentFactory("form");a.then(function(e){c({provider:n,name:"Edita attributi "+r.name,formId:n.generateFormId(r.name),dataid:r.name,vectorLayer:r,pk:r.pk,isnew:n.isNewFeature(t.getId()),fields:o,relations:e,relationOne:n.checkOneRelation,tools:n._formTools,formComponent:n._formComponent,editor:n,buttons:[{title:"Salva",type:"save","class":"btn-danger",cbk:n._onSaveEditorForm(t,o,e,i)},{title:"Cancella",type:"cancel","class":"btn-primary",cbk:function(){i&&i(!1),l.setModal(!1)}}]})}).fail(function(){i&&i(!1),l.setModal(!1)})},t.exports=n},{"./editbuffer":21,"./tools/addfeaturetool":24,"./tools/cutlinetool":25,"./tools/deletefeaturetool":26,"./tools/modifyfeaturetool":28,"./tools/movepointtool":29,"./tools/pickfeaturetool":30,"core/g3wobject":31,"core/map/layer/vectorlayer":38,"core/utils/utils":51,"gui/gui":79}],23:[function(e,t,i){function n(e,t){this._relationName=t,this._editor=e,this._elementsBuffer={}}var r=e("core/utils/utils").inherit,o=e("core/g3wobject");r(n,o),t.exports=n;var s=n.prototype;s.commit=function(){this._clearBuffers()},s.undoAll=function(){this._clearBuffers()},s.destroy=function(){this._clearBuffers()},s.getRelationName=function(){return this._relationName},s.generateId=function(){return this._editor.generateId()},s.getAddedElements=function(){},s.getDeletedElements=function(){},s.getUpdatedElements=function(){},s.updateRelation=function(e){var t=this;_.forEach(e.elements,function(e){t._editElementsBuffer(e)})},s._editElementsBuffer=function(e){var t=_.some(e.fields,function(e){return!_.isNil(e.value)});if(t){var i=e.id;_.has(this._elementsBuffer,i)||(this._elementsBuffer[i]=[]),this._elementsBuffer[i].push(e),this._setDirty(!0)}},s.getRelationElements=function(e,t){var i=[];return _.forEach(this._elementsBuffer,function(n){var r=n.slice(-1)[0];(r||"ALL"==e)&&(!e||e&&r.state==e)&&(t&&(r=_.cloneDeep(r),r.fields=_.map(r.fields,function(e){return{name:e.name,value:e.value}})),i.push(r))}),i},s.getRelationElementsOnlyFieldsValues=function(e){return this.getRelationElements(e,!0)},s.hasRelationElements=function(){var e=!1;return _.forEach(this._elementsBuffer,function(t){e=e||t.length>0}),e},s._setDirty=function(e){this._editor._setDirty(e)},s._clearBuffers=function(){this._elementsBuffer={},this._setDirty(!1)}},{"core/g3wobject":31,"core/utils/utils":51}],24:[function(e,t,i){function n(e,t){var t=t||{};this._running=!1,this._busy=!1,this.source=e.getEditVectorLayer().getMapLayer().getSource(),this.drawInteraction=null,this._snap=t.snap||null,this._snapInteraction=null,this._finishCondition=t.finishCondition||_.constant(!0),this._condition=t.condition||_.constant(!0),this.setters={addFeature:{fnc:n.prototype._addFeature,fallback:n.prototype._fallBack}},o(this,e)}var r=e("core/utils/utils").inherit,o=e("core/utils/utils").base,s=e("./editingtool");r(n,s),t.exports=n;var a=n.prototype;a.run=function(){var e=this;this.drawInteraction=new ol.interaction.Draw({type:this.editor.getEditVectorLayer().geometrytype,source:this.source,condition:this._condition,finishCondition:this._finishCondition});var t=this.editor._editingVectorStyle?this.editor._editingVectorStyle.add:null;this.addInteraction(this.drawInteraction),this.drawInteraction.setActive(!0),this.drawInteraction.on("drawstart",function(t){e.editor.emit("drawstart",t)}),this.drawInteraction.on("drawend",function(i){i.feature.setStyle(t),e.editor.emit("drawend",i),e._busy||(e._busy=!0,e.pause(),e.addFeature(i.feature))}),this._snap&&(this._snapInteraction=new ol.interaction.Snap({source:this._snap.vectorLayer.getSource()}),this.addInteraction(this._snapInteraction))},a.pause=function(e){_.isUndefined(e)||e?(this._snapInteraction&&this._snapInteraction.setActive(!1),this.drawInteraction.setActive(!1)):(this._snapInteraction&&this._snapInteraction.setActive(!0),this.drawInteraction.setActive(!0))},a.stop=function(){return this._snapInteraction&&(this.removeInteraction(this._snapInteraction),this._snapInteraction=null),this.removeInteraction(this.drawInteraction),this.drawInteraction=null,!0},a.removeLastPoint=function(){if(this.drawInteraction)try{this.drawInteraction.removeLastPoint()}catch(e){}},a._addFeature=function(e){return e.setStyle(null),this.editor.addFeature(e),this._busy=!1,this.pause(!1),!0},a._fallBack=function(e){this._busy=!1,this.source.getFeaturesCollection().getLength()&&(this.source.getFeaturesCollection().pop(),this.pause(!1))}},{"./editingtool":27,"core/utils/utils":51}],25:[function(e,t,i){function n(e,t){this.setters={cutLine:n.prototype._cutLine},o(this,e,t),this.steps=new c.Steps(n.steps),this._origFeature=null,this._origGeometry=null,this._newFeatures=[],this._linePickInteraction=null,this._pointPickInteraction=null,this._pointLayer=t.pointLayer||null,this._minCutPointDistance=t.minCutPointDistance||1/0,this._modType=t.modType||"MODONCUT",this._selectedLineOverlay=new ol.layer.Vector({source:new ol.source.Vector,style:new ol.style.Style({stroke:new ol.style.Stroke({color:"rgb(255,255,0)",width:4})})}),this._lineToKeepOverlay=new ol.layer.Vector({source:new ol.source.Vector})}var r=e("core/utils/utils").inherit,o=e("core/utils/utils").base,s=e("core/geometry/geom"),a=e("g3w-ol3/src/interactions/pickfeatureinteraction"),l=e("g3w-ol3/src/interactions/pickcoordinatesinteraction"),c=e("./editingtool");r(n,c),t.exports=n;var u=n.prototype;u.run=function(){var e=this;this._linePickInteraction=new a({layers:[this.layer,this.editingLayer]}),this.addInteraction(this._linePickInteraction),e.steps.next(),this._linePickInteraction.on("picked",function(t){var i,n=e._origFeature=t.feature;e._origGeometry=n.getGeometry().clone(),e._showSelection(e._origGeometry,300),e.removeInteraction(this),e._pointLayer?e._pointPickInteraction=new a({layers:[e._pointLayer]}):e._pointPickInteraction=new l,e.steps.next(),e._pointPickInteraction.on("picked",function(t){e.removeInteraction(this);var r;if(t.feature?(i=t.feature,r=i.getGeometry().getCoordinates()):r=t.coordinate,r){var o=n.getGeometry().getClosestPoint(r),a=s.distance(r,o);if(a<e._minCutPointDistance){var l=e._cut(n.getGeometry(),o);if(l){var c=l[0],u=l[1],h=e.editor.generateId();c.setId(h+"_1"),u.setId(h+"_2");var d=n.getProperties();if(delete d[n.getGeometryName()],e._showSelection(c.getGeometry(),300),setTimeout(function(){e._showSelection(u.getGeometry(),300)},300),"MODONCUT"==e._modType)e.steps.next(),e._selectLineToKeep(c,u).then(function(t){n.setGeometry(t.getGeometry().clone());var r;c.getId()==t.getId()?(delete c,r=u):u.getId()==t.getId()&&(delete u,r=c),e._newFeatures.push(r),r.setProperties(d),e.editingLayer.getSource().addFeatures([r]);var o={added:[r],updated:n,cutfeature:i};e.cutLine(o,e._modType).fail(function(){e._rollBack(),e.rerun()})});else{e.layer.getSource().removeFeature(n),e._newFeatures.push(c),e._newFeatures.push(u),e.editingLayer.getSource().addFeatures([featureToAdd,c]);var f={added:[c,u],removed:n};e.cutLine(f,e._modType).fail(function(){e._rollBack(),e.rerun()})}}else e.rerun()}}}),e.addInteraction(e._pointPickInteraction)})},u.pause=function(e){_.isUndefined(e)||e?(this._linePickInteraction.setActive(!1),this._pointPickInteraction.setActive(!1)):(this._linePickInteraction.setActive(!0),
this._pointPickInteraction.setActive(!0))},u.rerun=function(){this.stop(),this.run()},u.stop=function(){this._cleanUp();var e=o(this,"stop");return e&&(this.removeInteraction(this._linePickInteraction),this.removeInteraction(this._pointPickInteraction),this._linePickInteraction=null,this._pointPickInteraction=null),e},u._cleanUp=function(){this.steps.completed(),this._origFeature=null,this._origGeometry=null,this._newFeatures=[],this._lineToKeepOverlay.setMap(null),this._selectedLineOverlay.setMap(null)},u._rollBack=function(){this._origFeature.setGeometry(this._origGeometry);try{_.forEach(this._newFeatures,function(e){self.editingLayer.getSource().removeFeature(e)})}catch(e){}},u._cutLine=function(e,t){if("MODONCUT"==t){var i=e.updated,n=e.added[0];this.editor.updateFeature(i),this.editor.addFeature(n)}else{var r=e.removed,o=e.added[0],s=e.added[1];this.editor.deleteFeature(r),this.editor.addFeature(o),this.editor.addFeature(s)}return this._busy=!1,this.pause(!1),this.rerun(),!0},u._selectLineToKeep=function(e,t){var i=$.Deferred(),n=this,r=this._lineToKeepOverlay;r.getSource().addFeatures([e,t]),r.setMap(this.editor.getMapService().viewer.map);var o=new a({layers:[this._lineToKeepOverlay]});return this.addInteraction(o),o.on("picked",function(e){r.setMap(null),n.removeInteraction(this),i.resolve(e.feature)}),i.promise()},u._fallBack=function(e){this._busy=!1,this.pause(!1)},u._cut=function(e,t){for(;t.length<e.getLayout().length;)t.push(0);var i=1/0,n=0,r=0;e.forEachSegment(function(e,o){var a=s.closestOnSegment(t,[e,o]),l=s.distance(t,a);l<i&&(i=l,n=r),r+=1});var o=e.getCoordinates(),a=o.slice(0,n+1);a.splice(a.length,0,t);var l=o.slice(n);if(l.splice(0,1,t),a.length<2||l.length<2)return!1;var c=new ol.geom.LineString;c.setCoordinates(a);var u=new ol.geom.LineString;u.setCoordinates(l);var h=new ol.Feature({geometry:c}),d=new ol.Feature({geometry:u});return[h,d]},u._showSelection=function(e,t){var i=this,t=t||null,n=this._selectedLineOverlay,r=new ol.Feature;r.setGeometry(e),n.getSource().addFeatures([r]),n.setMap(this.editor.getMapService().viewer.map),t&&setTimeout(function(){n.setMap(null),i._selectedLineOverlay.getSource().clear()},t)},u._isNew=function(e){return!_.isNil(this.editingLayer.getSource().getFeatureById(e.getId()))},n.steps=[{type:"selectline"},{type:"selectcutpoint"},{type:"selectparttokeep"}]},{"./editingtool":27,"core/geometry/geom":32,"core/utils/utils":51,"g3w-ol3/src/interactions/pickcoordinatesinteraction":60,"g3w-ol3/src/interactions/pickfeatureinteraction":61}],26:[function(e,t,i){function n(e){this.editor=e,this.drawInteraction=null,this.layer=null,this.editingLayer=null,this.setters={deleteFeature:n.prototype._deleteFeature},o(this,e)}var r=e("core/utils/utils").inherit,o=e("core/utils/utils").base,s=e("g3w-ol3/src/interactions/deletefeatureinteraction"),a=e("./editingtool");r(n,a),t.exports=n;var l=n.prototype;ol.geom.GeometryType={POINT:"Point",LINE_STRING:"LineString",LINEAR_RING:"LinearRing",POLYGON:"Polygon",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon",GEOMETRY_COLLECTION:"GeometryCollection",CIRCLE:"Circle"};var c={},u=[255,255,255,1],h=[255,0,0,1],d=3;c[ol.geom.GeometryType.POLYGON]=[new ol.style.Style({stroke:new ol.style.Stroke({color:"red",width:3}),fill:new ol.style.Fill({color:"rgba(255, 0, 0, 0.1)"})})],c[ol.geom.GeometryType.MULTI_POLYGON]=c[ol.geom.GeometryType.POLYGON],c[ol.geom.GeometryType.LINE_STRING]=[new ol.style.Style({stroke:new ol.style.Stroke({color:u,width:d+2})}),new ol.style.Style({stroke:new ol.style.Stroke({color:h,width:d})})],c[ol.geom.GeometryType.MULTI_LINE_STRING]=c[ol.geom.GeometryType.LINE_STRING],c[ol.geom.GeometryType.CIRCLE]=c[ol.geom.GeometryType.POLYGON].concat(c[ol.geom.GeometryType.LINE_STRING]),c[ol.geom.GeometryType.POINT]=[new ol.style.Style({image:new ol.style.Circle({radius:2*d,fill:new ol.style.Fill({color:h}),stroke:new ol.style.Stroke({color:u,width:d/2})}),zIndex:1/0})],c[ol.geom.GeometryType.MULTI_POINT]=c[ol.geom.GeometryType.POINT],c[ol.geom.GeometryType.GEOMETRY_COLLECTION]=c[ol.geom.GeometryType.POLYGON].concat(c[ol.geom.GeometryType.LINE_STRING],c[ol.geom.GeometryType.POINT]),c[ol.geom.GeometryType.POLYGON]=_.concat(c[ol.geom.GeometryType.POLYGON],c[ol.geom.GeometryType.LINE_STRING]),c[ol.geom.GeometryType.GEOMETRY_COLLECTION]=_.concat(c[ol.geom.GeometryType.GEOMETRY_COLLECTION],c[ol.geom.GeometryType.LINE_STRING]),l.run=function(){var e=this;this.layer=this.editor.getVectorLayer().getMapLayer(),this.editingLayer=this.editor.getEditVectorLayer().getMapLayer(),this._selectInteraction=new ol.interaction.Select({layers:[this.layer,this.editingLayer],condition:ol.events.condition.click,style:function(t,i){var n=e.editor._editingVectorStyle?e.editor._editingVectorStyle["delete"]:c[t.getGeometry().getType()];return n}}),this.addInteraction(this._selectInteraction),this._deleteInteraction=new s({features:this._selectInteraction.getFeatures()}),this.addInteraction(this._deleteInteraction),this._deleteInteraction.on("deleteend",function(t){var i=t.features.getArray()[0],n=e._isNew(i);e._busy||(e._busy=!0,e.pause(!0),e.deleteFeature(i,n).always(function(){e._busy=!1,e.pause(!1)}))})},l.pause=function(e){_.isUndefined(e)||e?(this._selectInteraction.setActive(!1),this._deleteInteraction.setActive(!1)):(this._selectInteraction.setActive(!0),this._deleteInteraction.setActive(!0))},l.stop=function(){return this._selectInteraction.getFeatures().clear(),this.removeInteraction(this._selectInteraction),this._selectInteraction=null,this.removeInteraction(this._deleteInteraction),this._deleteInteraction=null,!0},l._deleteFeature=function(e,t){var i=[],n=this.editor.getRelationsWithValues(e);return n.then(function(e){i=e}),this.editor.deleteFeature(e,i,t),this._selectInteraction.getFeatures().clear(),this._busy=!1,this.pause(!1),!0},l._fallBack=function(e){this._busy=!1,this.pause(!1)},l._isNew=function(e){return!_.isNil(this.editingLayer.getSource().getFeatureById(e.getId()))}},{"./editingtool":27,"core/utils/utils":51,"g3w-ol3/src/interactions/deletefeatureinteraction":59}],27:[function(e,t,i){function n(e,t){this._interactions=[],this.editor=e,this.layer=this.editor.getVectorLayer().getMapLayer(),this.editingLayer=this.editor.getEditVectorLayer().getMapLayer(),this.options=t||{},this.steps=null,o(this)}var r=e("core/utils/utils").inherit,o=e("core/utils/utils").base,s=e("core/g3wobject");r(n,s);var a=n.prototype;a.addInteraction=function(e){var t=this.editor.getMapService();t.addInteraction(e),this._interactions.push(e)},a.removeInteraction=function(e){var t=this._interactions,i=this.editor.getMapService();_.forEach(t,function(i,n){i==e&&t.splice(n,1)}),i.removeInteraction(e)},a.ownsInteraction=function(e){var t=!1;return _.forEach(this._interactions,function(i){i==e&&(t=!0)}),t},a.stop=function(){return this.steps&&this.steps.destroy(),!0},a.run=function(){console.log("Se appare quasto messaggio significa che non Ã¨ stato sovrascritto il metodo run() dalla sottoclasse")},n.Steps=function(e){var t=-1,e=e;this.next=function(){t+=1;var i=e[t];this.emit("step",t,i)},this.currentStep=function(){return e[t]},this.currentStepIndex=function(){return t},this.totalSteps=function(){return e.length},this.reset=function(){t=0},this.destroy=function(){this.removeAllListeners()},this.completed=function(){this.emit("complete"),this.reset()},this.insertStepAt=function(t,i){e.splice(t,0,i)}},r(n.Steps,s),t.exports=n},{"core/g3wobject":31,"core/utils/utils":51}],28:[function(e,t,i){function n(e,t){t=t||{},this.editor=e,this.isPausable=!0,this.drawInteraction=null,this.layer=null,this.editingLayer=null,this._deleteCondition=t.deleteCondition||void 0,this._snap=t.snap||null,this._snapInteraction=null,this.setters={modifyFeature:n.prototype._modifyFeature},o(this,e)}var r=e("core/utils/utils").inherit,o=e("core/utils/utils").base,s=(e("core/g3wobject"),e("g3w-ol3/src/interactions/pickfeatureinteraction")),a=e("./editingtool");r(n,a),t.exports=n;var l=n.prototype;l.run=function(){var e=this;this.layer=this.editor.getVectorLayer().getMapLayer(),this.editingLayer=this.editor.getEditVectorLayer().getMapLayer(),this.pickedFeatures=new ol.Collection,this._pickInteraction=new s({layers:[this.layer,this.editingLayer]}),this.addInteraction(this._pickInteraction),this._pickInteraction.on("picked",function(t){e.pickedFeatures.clear(),e.pickedFeatures.push(t.feature)}),this._modifyInteraction=new ol.interaction.Modify({features:this.pickedFeatures,deleteCondition:this._deleteCondition}),this.addInteraction(this._modifyInteraction);var t=null;this._modifyInteraction.on("modifystart",function(e){var i=e.features.getArray()[0];t=i.getGeometry().clone()}),this._modifyInteraction.on("modifyend",function(i){var n=i.features.getArray()[0],r=e._isNew(n);e._busy||(e._busy=!0,e.pause(!0),e.modifyFeature(n,r).fail(function(){n.setGeometry(t)}).always(function(){e._busy=!1,e.pause(!1)}))}),this._snap&&(this._snapInteraction=new ol.interaction.Snap({source:this._snap.vectorLayer.getSource()}),this.addInteraction(this._snapInteraction))},l.pause=function(e){_.isUndefined(e)||e?(this._snapInteraction&&this._snapInteraction.setActive(!1),this._pickInteraction.setActive(!1),this._modifyInteraction.setActive(!1)):(this._snapInteraction&&this._snapInteraction.setActive(!0),this._pickInteraction.setActive(!0),this._modifyInteraction.setActive(!0))},l.stop=function(){return this.pickedFeatures.clear(),this._snapInteraction&&(this.removeInteraction(this._snapInteraction),this._snapInteraction=null),this.removeInteraction(this._pickInteraction),this._pickInteraction=null,this.removeInteraction(this._modifyInteraction),this._modifyInteraction=null,!0},l._modifyFeature=function(e,t){return this.editor.updateFeature(e,t),this._busy=!1,this.pause(!1),!0},l.removePoint=function(e){if(this._modifyInteraction)try{this._modifyInteraction.removePoint()}catch(t){console.log(t)}},l._fallBack=function(e){this._busy=!1,this.pause(!1)},l._isNew=function(e){return!_.isNil(this.editingLayer.getSource().getFeatureById(e.getId()))}},{"./editingtool":27,"core/g3wobject":31,"core/utils/utils":51,"g3w-ol3/src/interactions/pickfeatureinteraction":61}],29:[function(e,t,i){function n(e){this.editor=e,this.isPausable=!0,this.drawInteraction=null,this.layer=null,this.editingLayer=null,this._origGeometry=null,this.setters={moveFeature:{fnc:n.prototype._moveFeature,fallback:n.prototype._fallBack}},o(this,e)}var r=e("core/utils/utils").inherit,o=e("core/utils/utils").base,s=e("./editingtool");r(n,s),t.exports=n;var a=n.prototype;a.run=function(){var e=this;this.layer=this.editor.getVectorLayer().getMapLayer(),this.editingLayer=this.editor.getEditVectorLayer().getMapLayer();var t=this.editor._editingVectorStyle?this.editor._editingVectorStyle.move:null;this._selectInteraction=new ol.interaction.Select({layers:[this.layer,this.editingLayer],condition:ol.events.condition.click,style:t}),this.addInteraction(this._selectInteraction),this._translateInteraction=new ol.interaction.Translate({features:this._selectInteraction.getFeatures()}),this.addInteraction(this._translateInteraction),this._translateInteraction.on("translatestart",function(t){var i=t.features.getArray()[0];e._origGeometry=i.getGeometry().clone(),e.editor.emit("movestart",i)}),this._translateInteraction.on("translateend",function(t){var i=t.features.getArray()[0];e._busy||(e._busy=!0,e.pause(),e.moveFeature(i).then(function(t){e.pause(!1)}).fail(function(){i.setGeometry(e._origGeometry)}))})},a.pause=function(e){_.isUndefined(e)||e?(this._selectInteraction.setActive(!1),this._translateInteraction.setActive(!1)):(this._selectInteraction.setActive(!0),this._translateInteraction.setActive(!0))},a.stop=function(){return this._selectInteraction.getFeatures().clear(),this.removeInteraction(this._selectInteraction),this._selectInteraction=null,this.removeInteraction(this._translateInteraction),this._translateInteraction=null,!0},a._moveFeature=function(e){return this.editor.emit("moveend",e),this.editor.moveFeature(e),this._selectInteraction.getFeatures().clear(),this._busy=!1,this.pause(!1),!0},a._fallBack=function(e){this._busy=!1,this.pause(!1)}},{"./editingtool":27,"core/utils/utils":51}],30:[function(e,t,i){function n(e){this.isPausable=!0,this.pickFeatureInteraction=null,this._running=!1,this._busy=!1,this._originalFeatureStyle=null,this.setters={pickFeature:{fnc:n.prototype._pickFeature,fallback:n.prototype._fallBack}},o(this,e)}var r=e("core/utils/utils").inherit,o=e("core/utils/utils").base,s=(e("core/utils/utils").noop,e("g3w-ol3/src/interactions/pickfeatureinteraction")),a=e("./editingtool");r(n,a),t.exports=n;var l=n.prototype;l._pickFeature=function(e){this.editor.pickFeature(e)},l.run=function(){var e=this,t=(new ol.style.Style({image:new ol.style.Circle({radius:5,fill:new ol.style.Fill({color:"red"})})}),this.editor._editingVectorStyle?this.editor._editingVectorStyle.edit:null),i=[this.editor.getVectorLayer().getMapLayer(),this.editor.getEditVectorLayer().getMapLayer()];this.pickFeatureInteraction=new s({layers:i}),this.pickFeatureInteraction.on("picked",function(i){e.editor.setPickedFeature(i.feature),e._busy||(i.feature.setStyle(t),e._busy=!0,e.pause(!0),e.pickFeature(i.feature).then(function(t){e._busy=!1,e.pause(!1)}))}),this.addInteraction(this.pickFeatureInteraction)},l.pause=function(e){_.isUndefined(e)||e?this.pickFeatureInteraction.setActive(!1):this.pickFeatureInteraction.setActive(!0)},l.stop=function(){return this.removeInteraction(this.pickFeatureInteraction),this.pickFeatureInteraction=null,!0},l._fallBack=function(e){this._busy=!1,this.pause(!1)}},{"./editingtool":27,"core/utils/utils":51,"g3w-ol3/src/interactions/pickfeatureinteraction":61}],31:[function(e,t,i){var n=e("core/utils/utils").inherit,r=e("core/utils/utils").noop,o=function(){this.setters&&this._setupListenersChain(this.setters)};n(o,EventEmitter);var s=o.prototype;s.onafter=function(e,t,i){return this._onsetter("after",e,t,!1,i)},s.onbefore=function(e,t,i){return this._onsetter("before",e,t,!1,i)},s.onbeforeasync=function(e,t,i){return this._onsetter("before",e,t,!0,i)},s.un=function(e,t){_.forEach(this.settersListeners,function(i){_.forEach(i[e],function(n,r){n.key==t&&i[e].slice(r,1)})})},s._onsetter=function(e,t,i,n,r){var o=this.settersListeners[e],s=""+Math.floor(1e6*Math.random())+Date.now();r=r||0;var a=o[t];return a.push({key:s,fnc:i,async:n,priority:r}),o[t]=_.sortBy(a,function(e){return e.priority}),s},s._setupListenersChain=function(e){var t=this;this.settersListeners={after:{},before:{}},_.forEach(e,function(e,i){var n=r,o=r;_.isFunction(e)?n=e:(n=e.fnc,o=e.fallback||r),t.settersListeners.after[i]=[],t.settersListeners.before[i]=[],t[i]=function(){function e(){c=n.apply(t,a),l.resolve(c);var e=t.settersListeners.after[i];_.forEach(e,function(e){e.fnc.apply(t,a)})}function r(){o.apply(t,a),l.reject()}function s(n){var o=!0;_.isBoolean(n)&&(o=n);var l=Array.prototype.slice.call(a);if(o===!1||u==h.length)o===!1?r.apply(t,a):(completed=e.apply(t,a),(_.isUndefined(completed)||completed===!0)&&t.emitEvent("set:"+i,a));else if(o){var c=h[u].fnc;if(h[u].async)l.push(s),u+=1,c.apply(t,l);else{var d=c.apply(t,l);u+=1,s(d)}}}var a=arguments,l=$.Deferred(),c=null,u=0,h=t.settersListeners.before[i];return u=0,s(),l.promise()}})},s.un=function(e){_.forEach(this.settersListeners,function(t){_.forEach(t,function(i,n){i.key==e&&t.splice(n,1)})})},t.exports=o},{"core/utils/utils":51}],32:[function(e,t,i){var n={distance:function(e,t){return Math.sqrt(n.squaredDistance(e,t))},squaredDistance:function(e,t){var i=e[0],n=e[1],r=t[0],o=t[1],s=r-i,a=o-n;return s*s+a*a},closestOnSegment:function(e,t){var i,n,r=e[0],o=e[1],s=t[0],a=t[1],l=s[0],c=s[1],u=a[0],h=a[1],d=u-l,f=h-c,p=0===d&&0===f?0:(d*(r-l)+f*(o-c))/(d*d+f*f||0);return p<=0?(i=l,n=c):p>=1?(i=u,n=h):(i=l+p*d,n=c+p*f),[i,n]}};t.exports=n},{}],33:[function(e,t,i){var n={};n.GeometryTypes={POINT:"Point",MULTIPOINT:"MultiPoint",LINESTRING:"Line",MULTILINESTRING:"MultiLine",POLYGON:"Polygon",MULTIPOLYGON:"MultiPolygon",GEOMETRYCOLLECTION:"GeometryCollection"},n.SupportedGeometryTypes=[n.GeometryTypes.POINT,n.GeometryTypes.MULTIPOINT,n.GeometryTypes.LINESTRING,n.GeometryTypes.MULTILINESTRING,n.GeometryTypes.POLYGON,n.GeometryTypes.MULTIPOLYGON],t.exports=n},{}],34:[function(e,t,i){function n(e){i18next.use(i18nextXHRBackend).init({lng:"it",ns:"app",fallbackLng:"it",resources:e.resources}),jqueryI18next.init(i18next,$,{tName:"t",i18nName:"i18n",handleName:"localize",selectorAttr:"data-i18n",targetAttr:"data-i18n-target",optionsAttr:"data-i18n-options",useOptionsAttr:!1,parseDefaultValueFromContent:!0})}var r=function(e){var t=i18next.t(e);return t};t.exports={init:n,t:r}},{}],35:[function(e,t,i){function n(){this._layers={},this._type="tipo di layers",this._isReady=!1,o(this)}var r=e("core/utils/utils").inherit,o=e("core/utils/utils").base,s=e("core/g3wobject");r(n,s);var a=n.prototype;a.getLoaderType=function(){return this._type},a.getLayers=function(){return this._layers},a.getLayer=function(e){return this._layers[e]},a.loadLayer=function(e,t){},a.loadLayers=function(){},a.cleanUpLayers=function(){},a.setReady=function(e){this._isReady=e},a.isReady=function(){return this._isReady},a.setMode=function(e){switch(e){case"w":this._editingMode=!0;break;case"r":this._editingMode=!1}this._mode=e,this.emit("setmode",e)},a.getMode=function(){return this._mode},t.exports=n},{"core/g3wobject":31,"core/utils/utils":51}],36:[function(e,t,i){function n(){this._layer={},this._type="vector",this._layerCodes=[],this._baseUrl="",this._mapService=null,this._loadedExtent=null,this._editingMode=!1,this._customUrlParameters="",this._vectorLayersCodes=[],this._vectorLayersData={},o(this),this.init=function(e){this._layers=e.layers||{},this._baseUrl=e.baseurl||"",this._mapService=e.mapService||null,this._layerCodes=_.keys(this._layers)}}var r=e("core/utils/utils").inherit,o=e("core/utils/utils").base,s=e("core/utils/utils").resolve,a=e("core/map/layer/vectorlayer"),l=e("./loaderlayer");r(n,l);var c=n.prototype;c.loadLayers=function(e,t){var i=this;this.setMode(e),t&&this._setCustomUrlParameters(t);var n=$.Deferred(),r=[];_.forEach(this._layers,function(e,t){_.isNull(e.vector)&&r.push(t)});var o=_.map(r,function(e){return i._setupVectorLayer(e)});return i.emit("loadingvectorlayersstart"),$.when.apply(this,o).then(function(){var e=Array.prototype.slice.call(arguments);i.emit("loadingvectolayersdatastart"),i.loadAllVectorsData(e).then(function(){i._vectorLayersCodes=e,n.resolve(e)}).fail(function(){n.reject()}).always(function(){i.emit("loadingvectorlayersend"),i.setReady(!0),i.emit("loadingvectolayersdataend")})}).fail(function(){i.emit("loadingvectorlayersend"),n.reject()}),n.promise()},c.setVectorLayersCodes=function(e){this._vectorLayersCodes=e},c.getVectorLayersCodes=function(){return this._vectorLayersCodes},c.loadAllVectorsData=function(e){var t=this,i=$.Deferred(),n=this._layers,r=this._mapService.state.bbox,o=this._loadedExtent;if(o&&ol.extent.containsExtent(o,r))return s();o?this._loadedExtent=ol.extent.extend(o,r):this._loadedExtent=r,e&&(n=[],_.forEach(e,function(e){n.push(t._layers[e])}));var a=_.map(n,function(e){return t._loadVectorData(e.vector,r)});return $.when.apply(this,a).then(function(){i.resolve(e)}).fail(function(){i.reject()}),i.promise()},c._setCustomUrlParameters=function(e){this._customUrlParameters=e},c._setupVectorLayer=function(e){var t=this,i=this._layers[e],n=$.Deferred();return this._getVectorLayerConfig(i.name).then(function(r){var o=r.vector,s=i.crs||t._mapService.getProjection().getCode(),a=t._createVectorLayer({geometrytype:o.geometrytype,format:o.format,crs:t._mapService.getProjection().getCode(),crsLayer:s,id:i.id,name:i.name,pk:o.pk,editing:t._editingMode});a.setFields(o.fields),a.setCrs(s);var l=o.relations;l&&(a.lazyRelations=!0,a.setRelations(l)),i.style&&a.setStyle(i.style),i.vector=a,n.resolve(e)}).fail(function(){n.reject()}),n.promise()},c._loadVectorData=function(e,t){var i=this;return i._getVectorLayerData(e,t).then(function(t){if(i.setVectorLayerData(e.name,t),i._editingMode&&t.featurelocks&&i.setVectorFeaturesLock(e,t.featurelocks),e.setData(t.vector.data),i._)return t})},c.getVectorLayerData=function(e){return this._vectorLayersData[e]},c.getVectorLayersData=function(){return this._vectorLayersData},c.setVectorLayerData=function(e,t){this._vectorLayersData[e]=t},c.setVectorFeaturesLock=function(e,t){e.setFeatureLocks(t)},c.cleanVectorFeaturesLock=function(e){e.cleanFeatureLocks()},c.lockFeatures=function(e){var t=this,i=$.Deferred(),n=this._mapService.state.bbox,r=this._layers[e].vector;return $.get(this._baseUrl+e+"/?lock"+this._customUrlParameters+"&in_bbox="+n[0]+","+n[1]+","+n[2]+","+n[3]).done(function(e){t.setVectorFeaturesLock(r,e.featurelocks),i.resolve(e)}).fail(function(){i.reject()}),i.promise()},c._getVectorLayerConfig=function(e){var t=$.Deferred();return $.get(this._baseUrl+e+"/?config"+this._customUrlParameters).done(function(e){t.resolve(e)}).fail(function(){t.reject()}),t.promise()},c._getVectorLayerData=function(e,t){var i,n=$.Deferred(),r="w"==this.getMode();return i=r?this._baseUrl+e.name+"/?editing":this._baseUrl+e.name+"/?",$.get(i+this._customUrlParameters+"&in_bbox="+t[0]+","+t[1]+","+t[2]+","+t[3]).done(function(e){n.resolve(e)}).fail(function(){n.reject()}),n.promise()},c._createVectorLayer=function(e){var t=new a(e);return t},c.cleanUpLayers=function(){this._loadedExtent=null},t.exports=n},{"./loaderlayer":35,"core/map/layer/vectorlayer":38,"core/utils/utils":51}],37:[function(e,t,i){function n(e){this.config=e||{},this.id=e.id,this._olLayer=null,o(this)}var r=e("core/utils/utils").inherit,o=e("core/utils/utils").base,s=e("core/g3wobject");r(n,s);var a=n.prototype;a.getId=function(){return this.id},t.exports=n},{"core/g3wobject":31,"core/utils/utils":51}],38:[function(e,t,i){function n(e){var e=e||{};this.geometrytype=e.geometrytype||null,this.format=e.format||null,this.crs=e.crs||null,this.crsLayer=e.crsLayer||this.crs,this.id=e.id||null,this.name=e.name||"",this.pk=e.pk||"id",this._newPrefix="_new_",this._olSource=new ol.source.Vector({features:new ol.Collection}),this._olLayer=new ol.layer.Vector({name:this.name,source:this._olSource}),this._isReady=!1,this._PKinAttributes=!1,this._featuresFilter=null,this._fields=null,this._relationsDataLoaded={},this.lazyRelations=!0,this._relations=null,this._editingMode=e.editing||!1,this._featureLocks=null,this._crs=null}var r=e("core/utils/utils").inherit,o=(e("core/utils/utils").truefnc,e("core/utils/utils").resolve),s=(e("core/utils/utils").reject,e("core/g3wobject"));r(n,s),t.exports=n;var a=n.prototype;a.getPk=function(){return this.pk},a.setData=function(e){var t,i=this;if(this.format){switch(this.format){case"GeoJSON":var n=new ol.format.GeoJSON({geometryName:"geometry"});t=n.readFeatures(e,{dataProjection:i.crsLayer,featureProjection:i.crs})}if(this._editingMode&&this._featureLocks&&(t=_.filter(t,function(e){var t=!1;return _.forEach(i._featureLocks,function(i){i.featureid==e.getId()&&(t=!0)}),t})),t&&t.length){_.isNull(this._featuresFilter)||(t=_.map(t,function(e){return i._featuresFilter(e)}));var r=this.getFeatureIds(),o=_.filter(t,function(e){return!_.includes(r,e.getId())});this._olSource.addFeatures(o);var s=this.getSource().getFeatures()[0].getProperties();this._PKinAttributes=!!_.get(s,this.pk)}}else console.log("VectorLayer format not defined")},a.cleanFeatureLocks=function(){this._featureLocks=null},a.setFeatureLocks=function(e){this._featureLocks=e},a.getFeatureLocks=function(){return this._featureLocks},a.addLockId=function(e){this._featureLocks.push(e)},a.setFeatureData=function(e,t,i,n){var r=this.getFeatureById(e);if(t&&r.setId(t),i&&r.setGeometry(i),n){var o=r.getProperties(),s=_.assign(o,n);r.setProperties(s)}return r},a.addFeatures=function(e){this.getSource().addFeatures(e)},a.modifyFeatureGeometry=function(e,t){var i=this.getFeatures(),n=null;return _.forEach(i,function(n,r){if(n.getId()==e)return i[r].setGeometry(t),n=n[r]}),n},a.setFeaturesFilter=function(e){this._featuresFilter=e},a.setFields=function(e){this._fields=e},a.setCrs=function(e){this._crs=e},a.getCrs=function(){return this._crs},a.setPkField=function(){var e=this,t=!1;_.forEach(this._fields,function(i){i.name==e.pk&&(t=!0)}),t||this._fields},a.getFeatures=function(){return this.getSource().getFeatures()},a.getFeatureIds=function(){var e=_.map(this.getSource().getFeatures(),function(e){return e.getId()});return e},a.getFields=function(){return _.cloneDeep(this._fields)},a.getFieldsNames=function(){return _.map(this._fields,function(e){return e.name})},a.getFieldsWithValues=function(e){var t,i,n=this,r=_.cloneDeep(this._fields);return e instanceof ol.Feature?t=e:e&&(t=this.getFeatureById(e)),t&&(i=t.getProperties()),_.forEach(r,function(e){t?this._PKinAttributes||e.name!=n.pk?e.value=i[e.name]:n.isNewFeature(t.getId())?e.value=null:e.value=t.getId():e.value=null}),r},a.setRelations=function(e){this._relations=e,_.forEach(e,function(e){_.forEach(e.fields,function(t,i){t.name==e.pk&&(e.pkFieldIndex=i)})})},a.getRelations=function(){return this._relations},a.getRelation=function(e){var t;return _.forEach(this._relations,function(i){i.name==e&&(t=i)}),t},a.hasRelations=function(){return!_.isNull(this._relations)},a.getRelationPkFieldIndex=function(e){var t;return _.forEach(e.fields,function(i,n){i.name==e.pk&&(t=n)}),t},a.getRelationElementPkValue=function(e,t){var i=this.getRelationPkFieldIndex(e);return t.fields[i].value},a.getRelationsFksKeys=function(){var e=[];return _.forEach(this._relations,function(t){e.push(t.fk)}),e},a.getRelationFields=function(e){return e.fields},a.getRelationFieldsNames=function(e){return _.map(relationFields,function(e){return e.name})},a.getRelationsWithValues=function(e){var t=this;this._relations||o([]);var i=_.cloneDeep(this._relations);if(e||this.getFeatureById(e)){if(this.lazyRelations){if(t._relationsDataLoaded[e])return o(this._relationsDataLoaded[e]);var n=$.Deferred(),r=this.getFeatureById(e).getProperties(),s={};return _.forEach(i,function(e){_.forEach(e.fk,function(e){s[e]=r[e]})}),this.getRelationsWithValuesFromFks(s).then(function(i){t._relationsDataLoaded[e]=i,n.resolve(i)}).fail(function(){n.reject()}),n.promise()}return o(this._relations)}return _.forEach(i,function(e){e.elements=[]}),o(i)},a.getRelationsWithValuesFromFks=function(e,t){var i=_.cloneDeep(this._relations),n=[];return _.forEach(i,function(i){i.elements=[];var r=i.url,o=[];_.forEach(i.fk,function(t){var i=e[t];o.push(t+"="+i)});var s=_.join(o,"&");r+="?"+s,n.push($.get(r).then(function(e){e.length&&_.forEach(e,function(e){var n={};n.fields=_.cloneDeep(i.fields),_.forEach(n.fields,function(r){if(r.value=e[r.name],r.name==i.pk){n.id=r.value;var o=t?"NEW":"OLD";n.state=o}}),i.elements.push(n)})}))}),$.when.apply(this,n).then(function(){return i})},a.getNewRelationsWithValuesFromFks=function(e){return this.getRelationsWithValuesFromFks(e,!0)},a.featureHasRelationsFksWithValues=function(e){var t=e.getProperties(),i=this.getRelationsFksKeys();return _.every(i,function(e){var i=t[e];return!_.isNil(i)&&""!=i})},a.getRelationsFksWithValuesForFeature=function(e){var t=e.getProperties(),i={},n=this.getRelationsFksKeys();return _.forEach(n,function(e){i[e]=t[e]}),i},a.setRelationsData=function(e,t){this._relationsDataLoaded[e]=t},a.setStyle=function(e){this._olLayer.setStyle(e)},a.getMapLayer=function(){return this._olLayer},a.getSource=function(){return this._olLayer.getSource()},a.getFeatureById=function(e){if(e)return this._olLayer.getSource().getFeatureById(e)},a.isVisible=function(){return this._olLayer.getVisible()},a.setVisible=function(e){this._olLayer.setVisible(e)},a.clear=function(){this.getSource().clear()},a.addToMap=function(e){e.addLayer(this._olLayer)},a.isNewFeature=function(e){return!e||0==e.toString().indexOf(this._newPrefix)}},{"core/g3wobject":31,"core/utils/utils":51}],39:[function(e,t,i){function n(e,t){this.LAYERTYPE={LAYER:"layer",MULTILAYER:"multilayer"},this.extraParams=t,this.layers=[],o(this,e)}var r=e("core/utils/utils").inherit,o=e("core/utils/utils").base,s=e("core/utils/geo"),a=e("core/map/layer/maplayer"),l=e("g3w-ol3/src/layers/rasters");r(n,a);var c=n.prototype;c.getOLLayer=function(e){var t=this._olLayer;return t||(t=this._olLayer=this._makeOlLayer(e)),t},c.getSource=function(){return this.getOLLayer().getSource()},c.getInfoFormat=function(){return"application/vnd.ogc.gml"},c.getGetFeatureInfoUrl=function(e,t,i,n){return this.getOLLayer().getSource().getGetFeatureInfoUrl(e,t,i,n)},c.getLayerConfigs=function(){return this.layers},c.addLayer=function(e){this.layers.push(e)},c.toggleLayer=function(e){_.forEach(this.layers,function(t){t.id==e.id&&(t.visible=e.visible)}),this._updateLayers()},c.update=function(e,t){this._updateLayers(e,t)},c.isVisible=function(){return this._getVisibleLayers().length>0},c.getQueryUrl=function(){var e=this.layers[0];return e.infourl&&""!=e.infourl?e.infourl:this.config.url},c.getQueryableLayers=function(){return _.filter(this.layers,function(e){return e.isQueryable()})},c._getVisibleLayers=function(e){var t=[];return _.forEach(this.layers,function(i){var n=!i.state.maxresolution||i.state.maxresolution&&i.state.maxresolution>e.resolution;i.state.visible&&n&&t.push(i)}),t},c._makeOlLayer=function(e){var t=this,i={url:this.config.url,id:this.config.id};e&&(i.layers=_.map(this.layers,function(e){return e.getWMSLayerName()}));var n=this.layers[0];n.state.source&&"wms"==n.state.source.type&&n.state.source.url&&(i.url=n.state.source.url);var r=new l.WMSLayer(i,this.extraParams);return r.getSource().on("imageloadstart",function(){t.emit("loadstart")}),r.getSource().on("imageloadend",function(){t.emit("loadend")}),r},c.checkLayerDisabled=function(e,t){var i=s.resToScale(t),n=!0;e.state.maxresolution&&(n=n&&e.state.maxresolution>t),e.state.minresolution&&(n=n&&e.state.minresolution<t),e.state.minscale&&(n=n&&e.state.minscale>i),e.state.maxscale&&(n=n&&e.state.maxscale<i),e.state.disabled=!n},c.checkLayersDisabled=function(e){var t=this;_.forEach(this.layers,function(i){t.checkLayerDisabled(i,e)})},c._updateLayers=function(e,t){this.checkLayersDisabled(e.resolution);var i=this._getVisibleLayers(e);if(i.length>0){var n={LAYERS:_.join(_.map(i,function(e){return e.getWMSLayerName()}),",")};t&&(n=_.assign(n,t)),this._olLayer.setVisible(!0),this._olLayer.getSource().updateParams(n)}else this._olLayer.setVisible(!1)},t.exports=n},{"core/map/layer/maplayer":37,"core/utils/geo":50,"core/utils/utils":51,"g3w-ol3/src/layers/rasters":63}],40:[function(e,t,i){function n(){o(this),this._mapsServices={},this.addMap=function(e){this._registerMapService(e)},this._registerMapService=function(e){var e=this._mapsServices[e.id];_.isUndefined(e)&&(this._mapsServices[e.id]=e)}}var r=e("core/utils/utils").inherit,o=e("core/utils/utils").base,s=e("core/g3wobject");r(n,s),t.exports=n},{"core/g3wobject":31,"core/utils/utils":51}],41:[function(e,t,i){var n=e("core/utils/utils").inherit,r=e("core/utils/utils").base,o=e("core/g3wobject"),s=e("core/project/projectsregistry"),a=e("./pluginsregistry"),l=function(){this.name="(no name)",this.config=null,r(this)};n(l,o);var c=l.prototype;c.getPluginService=function(){return this.service},c.setPluginService=function(e){this.service=e},c.getName=function(){return this.name},c.setName=function(e){this.name=e},c.getPluginConfig=function(){return a.getPluginConfig(this.name)},c.isCurrentProjectCompatible=function(e){var t=s.getCurrentProject();return e==t.getGid()},c.registerPlugin=function(e){return!!this.isCurrentProjectCompatible(e)&&(a.registerPlugin(this),!0)},c.setupGui=function(){},t.exports=l},{"./pluginsregistry":42,"core/g3wobject":31,"core/project/projectsregistry":45,"core/utils/utils":51}],42:[function(e,t,i){function n(){var e=this;this.config=null,this._plugins={},this.setters={registerPlugin:function(t){e._plugins[t.name]||(e._plugins[t.name]=t)}},r(this),this.init=function(e){var t=this;this.pluginsBaseUrl=e.pluginsBaseUrl,
this.pluginsConfigs=e.pluginsConfigs,_.forEach(this.pluginsConfigs,function(e,i){t._setup(i,e)})},this._setup=function(e,t){if(t){var i=this.pluginsBaseUrl+e+"/js/plugin.js";$script(i)}},this.getPluginConfig=function(e){return this.pluginsConfigs[e]}}var r=e("core/utils/utils").base,o=e("core/utils/utils").inherit,s=e("core/g3wobject");o(n,s),t.exports=new n},{"core/g3wobject":31,"core/utils/utils":51}],43:[function(e,t,i){function n(e){function t(e){_.forIn(e,function(e,n){if(!_.isNil(e.id)){var r=i.buildProjectLayer(e);i._layers[r.getId()]=r}_.isNil(e.nodes)||t(e.nodes)})}var i=this;this.state=e,this._layers={},t(e.layerstree),this.setters={setLayersVisible:function(e,t){_.forEach(e,function(e){i.getLayerById(e).state.visible=t})},setBaseLayer:function(e){_.forEach(i.state.baselayers,function(t){t.visible=t.id==e||t.fixed===!0})},setLayerSelected:function(e,t){_.forEach(this._layers,function(i){i.state.selected=e==i.state.id&&t||!1})}},o(this)}var r=e("core/utils/utils").inherit,o=e("core/utils//utils").base,s=e("core/g3wobject"),a=(e("core/applicationservice"),e("./projectlayer"));r(n,s);var l=n.prototype;l.buildProjectLayer=function(e){var t=new a(e);return t.setProject(this),t.state.selected=!1,t.state.disabled=!1,t},l.getId=function(){return this.state.id},l.getTitle=function(){return this.state.title},l.getType=function(){return this.state.type},l.getGid=function(){return this.state.gid},l.getOverviewProjectGid=function(){return this.state.overviewprojectgid.gid},l.getLayersDict=function(e){var e=e||{},t=e.QUERYABLE,i=e.VISIBLE,n=e.SELECTED,r=e.SELECTEDORALL;if(r&&(n=null),_.isUndefined(t)&&_.isUndefined(i)&&_.isUndefined(n)&&_.isUndefined(r))return this._layers;var o=this._layers;if(t&&(o=_.filter(o,function(e){return t&&e.isQueryable()})),i&&(o=_.filter(o,function(e){return i&&e.isVisible()})),n&&(o=_.filter(o,function(e){return n&&e.isSelected()})),r){var s=o;o=_.filter(o,function(e){return e.isSelected()}),o=o.length?o:s}return o},l.getLayers=function(e){var t=this.getLayersDict(e);return _.values(t)},l.getLayerById=function(e){return this.getLayersDict()[e]},l.getLayerByName=function(e){var t=null;return _.forEach(this.getLayers(),function(t){t.getName()==e&&(t=_layer)}),t},l.getLayerAttributes=function(e){return this.getLayerById(e).getAttributes()},l.getLayerAttributeLabel=function(e,t){return this.getLayerById(e).getAttributeLabel(t)},l.toggleLayer=function(e,t){var i=this.getLayerById(e),t=t||!i.state.visible;this.setLayersVisible([e],t)},l.toggleLayers=function(e,t){this.setLayersVisible(e,t)},l.selectLayer=function(e){this.setLayerSelected(e,!0)},l.unselectLayer=function(e){this.setLayerSelected(e,!1)},l.getCrs=function(){return this.state.crs},l.getInfoFormat=function(){return"application/vnd.ogc.gml"},l.getWmsUrl=function(){return this.state.WMSUrl},l.getLegendUrl=function(e){var t=this.getWmsUrl();return sep=t.indexOf("?")>-1?"&":"?",this.getWmsUrl()+sep+"SERVICE=WMS&VERSION=1.3.0&REQUEST=GetLegendGraphic&SLD_VERSION=1.1.0&FORMAT=image/png&TRANSPARENT=true&ITEMFONTCOLOR=white&LAYERTITLE=False&ITEMFONTSIZE=10&LAYER="+e.name},t.exports=n},{"./projectlayer":44,"core/applicationservice":19,"core/g3wobject":31,"core/utils//utils":51,"core/utils/utils":51}],44:[function(e,t,i){function n(e){this.state=e,this._project=null}var r=(e("core/geometry/geometry").GeometryTypes,{QUERY:1,EDIT:2}),o=n.prototype;o.getProject=function(){return this._project},o.setProject=function(e){this._project=e},o.getId=function(){return this.state.id},o.getName=function(){return this.state.name},o.getOrigName=function(){return this.state.origname},o.getGeometryType=function(){return this.state.geometrytype},o.getAttributes=function(){return this.state.fields},o.getAttributeLabel=function(e){var t;return _.forEach(this.getAttributes(),function(i){i.name==e&&(t=i.label)}),t},o.isSelected=function(){return this.state.selected},o.isDisabled=function(){return this.state.disabled},o.isQueryable=function(){var e=!1,t=!!(this.state.capabilities&&this.state.capabilities&&r.QUERY);return t&&(e=this.state.visible&&!this.state.disabled,_.isUndefined(this.state.infowhennotvisible)||this.state.infowhennotvisible!==!0||(e=!0)),e},o.isVisible=function(){return this.state.visible},o.getQueryLayerName=function(){var e;return e=this.state.infolayer&&""!=this.state.infolayer?this.state.infolayer:this.state.name},o.getServerType=function(){return this.state.servertype&&""!=this.state.servertype?this.state.servertype:n.ServerTypes.QGIS},o.getCrs=function(){return this.getProject().getCrs()},o.isExternalWMS=function(){return this.state.source&&this.state.source.url},o.getWMSLayerName=function(){var e=this.state.name;return this.state.source&&this.state.source.layers&&(e=this.state.source.layers),e},o.getQueryUrl=function(){var e;return e=this.state.infourl&&""!=this.state.infourl?this.state.infourl:this.getProject().getWmsUrl(),"QGIS"!=this.getServerType()&&(e+="SOURCE=wms"),e},o.setQueryUrl=function(e){this.state.inforurl=e},o.getInfoFormat=function(){return this.state.infoformat&&""!=this.state.infoformat?this.state.infoformat:this.getProject().getInfoFormat()},o.setInfoFormat=function(e){this.state.infoformat=e},o.getWmsUrl=function(){var e;return e=this.state.source&&"wms"==this.state.source.type&&this.state.source.url?this.state.source.url:this.getProject().getWmsUrl()},o.getLegendUrl=function(){var e=this.getWmsUrl();return sep=e.indexOf("?")>-1?"&":"?",this.getWmsUrl()+sep+"SERVICE=WMS&VERSION=1.3.0&REQUEST=GetLegendGraphic&SLD_VERSION=1.1.0&FORMAT=image/png&TRANSPARENT=true&ITEMFONTCOLOR=white&LAYERTITLE=False&ITEMFONTSIZE=10&WIDTH=300&LAYER="+this.getWMSLayerName()},n.ServerTypes={OGC:"OGC",QGIS:"QGIS",Mapserver:"Mapserver",Geoserver:"Geoserver",ArcGIS:"ArcGIS"},t.exports=n},{"core/geometry/geometry":33}],45:[function(e,t,i){function n(){var e=this;this.config=null,this.initialized=!1,this.projectType=null,this.setters={setCurrentProject:function(t){e.state.currentProject=t}},this.state={baseLayers:{},minScale:null,maxscale:null,currentProject:null},this._pendingProjects=[],this._projects={},o(this)}var r=e("core/utils/utils").inherit,o=e("core/utils/utils").base,s=(e("core/utils/utils").resolve,e("core/utils/utils").reject),a=e("core/g3wobject"),l=e("core/project/project");r(n,a);var c=n.prototype;c.init=function(e){var t=this;if(!this.initialized)return this.initialized=!0,this.config=e,this.setupState(),this.getProject(e.initproject).then(function(e){t.setCurrentProject(e),t.setProjectType(e.state.type)})},c.setProjectType=function(e){this.projectType=e},c.setupState=function(){var e=this;e.state.baseLayers=e.config.baselayers,e.state.minScale=e.config.minscale,e.state.maxScale=e.config.maxscale,e.state.crs=e.config.crs,e.state.proj4=e.config.proj4;var t=e.config.overviewproject&&e.config.overviewproject.gid?e.config.overviewproject:null;e.config.projects.forEach(function(i){i.baselayers=_.cloneDeep(e.config.baselayers),i.minscale=e.config.minscale,i.maxscale=e.config.maxscale,i.crs=e.config.crs,i.proj4=e.config.proj4,i.overviewprojectgid=t,e._pendingProjects.push(i)})},c.getProjectType=function(){return this.projectType},c.getPendingProjects=function(){return this._pendingProjects},c.getProjects=function(){return this._pendingProjects},c.getListableProjects=function(){return _.filter(this.getProjects(),function(e){return _.isNil(e.listable)?e:e.listable})},c.getCurrentProject=function(){return this.state.currentProject},c.getProject=function(e){var t,i=this,n=$.Deferred(),r=null;return this._pendingProjects.forEach(function(n){n.gid==e&&(t=n,r=i._projects[e])}),t?r?n.resolve(r):this._getProjectFullConfig(t).then(function(e){var r=_.merge(t,e);i._buildProjectTree(r),r.WMSUrl=i.config.getWmsUrl(r);var o=new l(r);return i._projects[r.gid]=o,n.resolve(o)}):s("Project doesn't exist")},c._getProjectFullConfig=function(e){var t=$.Deferred(),i=this.config.getProjectConfigUrl(e);return $.get(i).done(function(e){t.resolve(e)}),t.promise()},c._buildProjectTree=function(e){function t(e){_.forIn(e,function(n,r){if(!_.isNil(n.id)){var o=_.merge(n,i[n.id]);e[parseInt(r)]=o}_.isNil(n.nodes)||(n.title=n.name,t(n.nodes))})}var i=_.keyBy(e.layers,"id"),n=_.cloneDeep(e.layerstree);t(n),e.layerstree=n,_.forEach(e.baselayers,function(t){var i=!1;e.initbaselayer&&(i=t.id==e.initbaselayer),t.fixed&&(i=t.fixed),t.visible=i})},t.exports=new n},{"core/g3wobject":31,"core/project/project":43,"core/utils/utils":51}],46:[function(e,t,i){function n(){self=this,this.submitGetFeatureInfo=function(e){var t=e.url||"",i=e.querylayername||null,n=e.filter||null,r=(e.bbox||s.getCurrentProject().state.extent.join(","),null),o=e.crs||"4326;";return $.get(t,{SERVICE:"WMS",VERSION:"1.3.0",REQUEST:"GetFeatureInfo",LAYERS:i,QUERY_LAYERS:i,FEATURE_COUNT:r||50,INFO_FORMAT:"application/vnd.ogc.gml",CRS:"EPSG:"+o,FILTER:n})},this.doSearch=function(e){var t=$.Deferred(),i=e.queryLayer,n=i.getQueryUrl(),r=i.getCrs(),o=e.filterObject,s=this.createFilter(o,i.getQueryLayerName());if(!s)return t.reject().promise();var a=this.submitGetFeatureInfo({url:n,crs:r,filter:s,querylayername:i.getQueryLayerName()});return a},this.createFilter=function(e,t){function i(e){var t,n=[],r="",o="",s="'";return _.forEach(e,function(e,l,c){t=a[l],_.forEach(e,function(e){o="",_.forEach(e,function(t,l,c){if(_.isArray(t))r=i(c);else{"LIKE"!=l&&"ILIKE"!=l||(o="%"),filterOp=a[l];_.forEach(e,function(e,t,i){_.forEach(e,function(e,t,i){_.isNull(e)||_.isNaN(e)||""==_.trim(e)||(r='"'+t+'" '+filterOp+" "+s+o+e+o+s,n.push(r))})})}})}),t=n.length>0&&n.join(" "+t+" ")}),t}return!!i(e)&&t+":"+i(e)}}var r=e("core/utils/utils").inherit,o=(e("core/utils/utils").base,e("core/g3wobject")),s=(e("core/utils/utils").resolve,e("core/project/projectsregistry")),a={eq:"=",gt:">",gte:">=",lt:"<",lte:"=<",LIKE:"LIKE",ILIKE:"ILIKE",AND:"AND",OR:"OR",NOT:"!="};r(n,o),t.exports=new n},{"core/g3wobject":31,"core/project/projectsregistry":45,"core/utils/utils":51}],47:[function(e,t,i){function n(){var e=this,t=$.Deferred();this.doSearch=function(e){var t=e.queryLayer,i=t.getQueryUrl(),n=t.getCrs(),r=e.filterObject;c.srsName+=n||"4326";var o,s;switch(ogcservertype){case"OGC":return s=this.createStandardFilter(r,t),o=this.standardSearch(i,s),a(o);case"qgis":return s=this.createQgisFilter(r),o=this.qgisSearch(t,i,s),a(o);case"mapserver":return s=this.createMapserverFilter(r),o=this.mapserverSearch(t,i,s),a(o);case"geoserver":return s=this.createGeoserverFilter(r),o=this.geoserverSearch(t,i,s),a(o);default:return!1}},this.standardSearch=function(e,t){},this.createStandardFilter=function(e,t){function i(e){var t,n=[],r="";return _.forEach(e,function(e,o,s){t=u[o],_.forEach(e,function(e){_.forEach(e,function(t,o,s){_.isArray(t)?r=i(s):(r=u[o],_.forEach(e,function(e,t,i){_.forEach(e,function(e,t,i){r=r(t,e)})})),n.push(r)})}),t=n.length>1?t.apply(this,n):n[0]}),t}c.featureTypes.push(t.getQueryLayerName);var n=[];return c.filter=i(e),n=(new ol.format.WFS).writeGetFeature(c)},this.qgisSearch=function(i,n){return $.get(searchUrl).then(function(t){e.emit("searchdone",t)}),t.promise()},this.createQGisFilter=function(e){var t;return t},this.mapserverSearch=function(e,i,n){return t.promise()},this.createMapserverFilter=function(e){var t;return t},this.geoserverSearch=function(e,i,n){return t.promise()},this.createGeoserverFilter=function(e){var t;return t},o(this)}var r=e("core/utils/utils").inherit,o=e("core/utils/utils").base,s=e("core/g3wobject"),a=e("core/utils/utils").resolve,l=ol.format.ogc.filter,c={srsName:"EPSG:",featureNS:"",featurePrefix:"",featureTypes:[],outputFormat:"application/json",filter:null},u={eq:l.equalTo,gt:l.greaterThan,gte:l.greaterThanOrEqualTo,lt:l.lessThan,lte:l.lessThanOrEqualTo,like:l.like,ilike:"",bbox:l.bbox,AND:l.and,OR:l.or,NOT:l.not};(function(){var e={propertyName:"<PropertyName>[PROP]</PropertyName>",literal:"<Literal>[VALUE]</Literal>"};return{eq:"<PropertyIsEqualTo>"+e.propertyName+e.literal+"</PropertyIsEqualTo>",gt:"<PropertyIsGreaterThan>"+e.propertyName+e.literal+"</PropertyIsGreaterThan>",gte:"",lt:"",lte:"",like:"",ilike:"",AND:"<And>[AND]</And>",OR:"<Or>[OR]</Or>"}})();r(n,s),t.exports=new n},{"core/g3wobject":31,"core/utils/utils":51}],48:[function(e,t,i){function n(){var e=this;this.url="",this.filterObject={},this.queryFilterObject={},this.setMapService=function(e){this._mapService=e},this.setFilterObject=function(e){this.filterObject=e},this.getFilterObject=function(){return this.filterObject},this.createQueryFilterFromConfig=function(e){function t(e){return evalObject={},_.forEach(e,function(e,t){if(_.isArray(e))return i(t,e)}),r=e.attribute,n=e.op,evalObject[n]={},evalObject[n][r]=null,evalObject}function i(e,i){return s={},s[e]=[],_.forEach(i,function(i){s[e].push(t(i))}),s}var n,r,o={},s={};return _.forEach(e,function(e,t,n){o=i(t,e)}),o},this.createQueryFilterObject=function(e,t){return{type:"standard",queryLayer:e,filterObject:t}},this._parseLayerFeatureCollection=function(e,t){var i=e.getWMSLayerName(),n=_.cloneDeep(t);n.FeatureCollection.featureMember=[];var r=t.FeatureCollection.featureMember;r=_.isArray(r)?r:[r],_.forEach(r,function(e){i=i.replace(/ /g,"");var t=_.get(e,i);t&&n.FeatureCollection.featureMember.push(e)});var o=new X2JS,s=o.json2xml_str(n),a=new ol.format.WMSGetFeatureInfo;return a.readFeatures(s)},this._parseLayermsGMLOutput=function(e,t){var i=new ol.format.WMSGetFeatureInfo({layers:[e.getQueryLayerName()]});return i.readFeatures(t)},this._parseLayerGeoJSON=function(e,t){var i=new ol.format.GeoJSON({defaultDataProjection:this.crs,geometryName:"geometry"});return i.readFeatures(t)},this.handleResponseFeaturesAndRelations=function(e){var t=null;return _.forEach(e,function(e){_.forEach(e.features,function(e){g3w_relations=e.getProperties().g3w_relations,g3w_relations&&(t=[],_.forEach(g3w_relations,function(e,i){relation={},e.length&&(relation.name=i,relation.elements=e,t.push(relation))}),t.length&&e.set("relations",t))})}),e},this.handleQueryResponseFromServer=function(t,i,n){var r,o,s,a=[];switch(i){case"json":o=this._parseLayerGeoJSON,s=t.vector.data;break;default:var l=new X2JS;try{r=_.isString(t)?l.xml_str2json(t):l.xml2json(t)}catch(c){return}var u=_.keys(r)[0];switch(u){case"FeatureCollection":o=this._parseLayerFeatureCollection,s=r;break;case"msGMLOutput":o=this._parseLayermsGMLOutput,s=t}}var h=0;return o&&_.forEach(n,function(t){var i=o.call(e,t,s);h+=i.length,a.push({layer:t,features:i})}),a},this.queryByFilter=function(e){var t=this,i=$.Deferred(),n=c[e.queryLayer.getServerType()];return n.doSearch(e).then(function(n){var r=e.queryLayer,o=t.handleQueryResponseFromServer(n,r.getInfoFormat(),[r]);t.handleResponseFeaturesAndRelations(o),i.resolve({data:o,query:{filter:e}})}).fail(function(e){i.reject(e)}),i.promise()},this.queryByLocation=function(e,t){var i=this,n=$.Deferred(),r={};_.forEach(t,function(e){var t=e.getQueryUrl(),i=t.hashCode().toString();_.keys(r).indexOf(i)==-1&&(r[i]={url:t,layers:[]}),r[i].layers.push(e)});var o=i._mapService.getResolution(),s=i._mapService.getEpsg(),a=[];if(_.forEach(r,function(t){var n=t.url.split("SOURCE");t.url=n[0],n=n.length>1?"&SOURCE"+n[1]:"";var r=t.layers,l=r[0].getInfoFormat(),c={LAYERS:_.map(r,function(e){return e.getQueryLayerName()}),QUERY_LAYERS:_.map(r,function(e){return e.getQueryLayerName()}),INFO_FORMAT:l,FEATURE_COUNT:10,FI_POINT_TOLERANCE:u,FI_LINE_TOLERANCE:u,FI_POLYGON_TOLERANCE:u,G3W_TOLERANCE:u*o},h=i._mapService.getGetFeatureInfoUrlForLayer(r[0],e,o,s,c),d=h.split("?")[1],f=t.url+"?"+d+n;a.push({url:f,infoformat:l,queryLayers:r})}),a.length>0){var l=[],c=[];_.forEach(a,function(e){var t=e.url,n=e.queryLayers,r=e.infoformat,o=i.doRequestAndParse(t,r,n);l.push(o)}),$.when.apply(this,l).then(function(){var t=Array.prototype.slice.call(arguments);_.forEach(t,function(e){c&&(c=_.concat(c,e))}),c=i.handleResponseFeaturesAndRelations(c),n.resolve({data:c,query:{coordinates:e,resolution:o}})}).fail(function(e){n.reject(e)})}else n.resolve(e,0,{});return n.promise()},this.doRequestAndParse=function(e,t,i){var n=this,r=$.Deferred();return $.get(e).done(function(e){var o=n.handleQueryResponseFromServer(e,t,i);r.resolve(o)}).fail(function(){r.reject()}),r},this.queryByBoundingBox=function(e){},o(this)}var r=e("core/utils/utils").inherit,o=e("core/utils/utils").base,s=e("core/g3wobject"),a=e("./queryWFSProvider"),l=e("./queryQGISWMSProvider"),c={QGIS:l,OGC:a},u=10;r(n,s),t.exports=new n},{"./queryQGISWMSProvider":46,"./queryWFSProvider":47,"core/g3wobject":31,"core/utils/utils":51}],49:[function(e,t,i){var n=e("core/utils/utils").inherit,r=e("core/utils/utils").base,o=(e("core/utils/utils").Base64,e("core/g3wobject"));crossroads.ignoreState=!0,crossroads.greedy=!0;var s=function(){this._initialLocationQuery,this._routeQuery="",this.setters={setRouteQuery:function(e){this._routeQuery=e,crossroads.parse(e)}},r(this)};n(s,o);var a=s.prototype;a.init=function(){var e=window.location.search;this._setRouteQueryFromLocationQuery(e)},a.addRoute=function(e,t,i){return crossroads.addRoute(e,t,i)},a.removeRoute=function(e){return crossroads.removeRoute(e)},a.removeAllRoutes=function(){return crossroads.removeAllRoutes()},a.parse=function(e,t){return crossroads.parse(e,t)},a["goto"]=function(e){this._initialQuery||(this._initialLocationQuery=this._stripInitialQuery(location.search.substring(1))),e&&this.setRouteQuery(e)},a.makePermalink=function(e){this._initialQuery||(this._initialLocationQuery=this._stripInitialQuery(location.search.substring(1)));this._encodeRouteQuery(e);return"?"+this._initialLocationQuery+"&q="+this._encodeRouteQuery(e)},a.makeQueryString=function(e){},a.slicePath=function(e){return e.split("?")[0].split("/")},a.sliceFirst=function(e){var t=e.split("?"),i=t[1],n=t[0].split("/"),r=n[0];return e=n.slice(1).join("/"),e=[e,i].join("?"),[r,e]},a.getQueryParams=function(e){e=e.replace("?","");var t={},i=[];i=""!=e&&e.indexOf("&")==-1?[e]:e.split("&");try{_.forEach(i,function(e){var i=e.split("="),n=i[0],r=i[1];t[n]=r})}catch(n){}return t},a.getQueryString=function(e){return e.split("?")[1]},a._getQueryPortion=function(e,t){var i;try{var n=e.split("&");_.forEach(n,function(e){var n=e.split("="),r=n[0];r==t&&(i=e)})}catch(r){}return i},a._encodeRouteQuery=function(e){return e=e.replace("?","@"),e=e.replace("&","|"),e=e.replace("=","!")},a._decodeRouteQuery=function(e){return e=e.replace("@","?"),e=e.replace("|","&"),e=e.replace("!","=")},a._setRouteQueryFromLocationQuery=function(e){var t=this._getRouteQueryFromLocationQuery(e);if(t){var i=this._decodeRouteQuery(t);this.setRouteQuery(i)}},a._getRouteQueryFromLocationQuery=function(e){return this.getQueryParams(e).q},a._stripInitialQuery=function(e){var t=this._getQueryPortion(e,"q");if(t){var i=t.length,n=e.indexOf(t);queryPrefix=_.trimEnd(e.substring(0,n),"&"),querySuffix=e.substring(n+i),querySuffix=""!=queryPrefix?querySuffix:_.trimStart(querySuffix,"&"),e=queryPrefix+querySuffix}return e},t.exports=new s},{"core/g3wobject":31,"core/utils/utils":51}],50:[function(e,t,i){var n=.28;t.exports={resToScale:function(e,t){var i,t=t||"m";switch(t){case"m":var i=1e3*e/n}return i}}},{}],51:[function(e,t,i){function n(e,t,i){return"undefined"==typeof i||0===+i?Math[e](t):(t=+t,i=+i,isNaN(t)||"number"!=typeof i||i%1!==0?NaN:(t=t.toString().split("e"),t=Math[e](+(t[0]+"e"+(t[1]?+t[1]-i:-i))),t=t.toString().split("e"),+(t[0]+"e"+(t[1]?+t[1]+i:i))))}Math.round10||(Math.round10=function(e,t){return n("round",e,t)}),Math.floor10||(Math.floor10=function(e,t){return n("floor",e,t)}),Math.ceil10||(Math.ceil10=function(e,t){return n("ceil",e,t)}),String.prototype.hashCode=function(){var e,t,i,n=0;if(0===this.length)return n;for(e=0,i=this.length;e<i;e++)t=this.charCodeAt(e),n=(n<<5)-n+t,n|=0;return n};var r={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){var t,i,n,o,s,a,l,c="",u=0;for(e=r._utf8_encode(e);u<e.length;)t=e.charCodeAt(u++),i=e.charCodeAt(u++),n=e.charCodeAt(u++),o=t>>2,s=(3&t)<<4|i>>4,a=(15&i)<<2|n>>6,l=63&n,isNaN(i)?a=l=64:isNaN(n)&&(l=64),c=c+this._keyStr.charAt(o)+this._keyStr.charAt(s)+this._keyStr.charAt(a)+this._keyStr.charAt(l);return c},decode:function(e){var t,i,n,o,s,a,l,c="",u=0;for(e=e.replace(/[^A-Za-z0-9+\/=]/g,"");u<e.length;)o=this._keyStr.indexOf(e.charAt(u++)),s=this._keyStr.indexOf(e.charAt(u++)),a=this._keyStr.indexOf(e.charAt(u++)),l=this._keyStr.indexOf(e.charAt(u++)),t=o<<2|s>>4,i=(15&s)<<4|a>>2,n=(3&a)<<6|l,c+=String.fromCharCode(t),64!=a&&(c+=String.fromCharCode(i)),64!=l&&(c+=String.fromCharCode(n));return c=r._utf8_decode(c)},_utf8_encode:function(e){e=e.replace(/rn/g,"n");for(var t="",i=0;i<e.length;i++){var n=e.charCodeAt(i);n<128?t+=String.fromCharCode(n):n>127&&n<2048?(t+=String.fromCharCode(n>>6|192),t+=String.fromCharCode(63&n|128)):(t+=String.fromCharCode(n>>12|224),t+=String.fromCharCode(n>>6&63|128),t+=String.fromCharCode(63&n|128))}return t},_utf8_decode:function(e){for(var t="",i=0,n=c1=c2=0;i<e.length;)n=e.charCodeAt(i),n<128?(t+=String.fromCharCode(n),i++):n>191&&n<224?(c2=e.charCodeAt(i+1),t+=String.fromCharCode((31&n)<<6|63&c2),i+=2):(c2=e.charCodeAt(i+1),c3=e.charCodeAt(i+2),t+=String.fromCharCode((15&n)<<12|(63&c2)<<6|63&c3),i+=3);return t}},o={mixin:function(e,t){return o.merge(e.prototype,t)},mixininstance:function(e,t){var i=new t;o.merge(e,i),o.merge(e.prototype,t.prototype)},merge:function(e,t){var i;for(i in t)o.hasOwn(t,i)&&(e[i]=t[i])},hasOwn:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},inherit:function(e,t){function i(){}i.prototype=t.prototype,e.superClass_=t.prototype,e.prototype=new i,e.prototype.constructor=e},base:function(e,t,i){var n=arguments.callee.caller;if(n.superClass_)return n.superClass_.constructor.apply(e,Array.prototype.slice.call(arguments,1));for(var r=Array.prototype.slice.call(arguments,2),o=!1,s=e.constructor;s;s=s.superClass_&&s.superClass_.constructor)if(s.prototype[t]===n)o=!0;else if(o)return s.prototype[t].apply(e,r);if(e[t]===n)return e.constructor.prototype[t].apply(e,r);throw Error("base called from a method of one name to a method of a different name")},noop:function(){},truefnc:function(){return!0},falsefnc:function(){return!0},resolve:function(e){var t=$.Deferred();return t.resolve(e),t.promise()},reject:function(e){var t=$.Deferred();return t.reject(e),t.promise()},Base64:r};t.exports=o},{}],52:[function(e,t,i){var n=function(e){var t=e.name||"?";if(this.name=t.split(" ").join("-").toLowerCase(),this.id=this.name+"_"+Math.floor(1e6*Math.random()),this.positionCode=e.position||"tl",!e.element){var i="ol-"+this.name.split(" ").join("-").toLowerCase(),r=e.tipLabel||this.name,o=e.label||"?";e.element=$('<div class="'+i+' ol-unselectable ol-control"><button type="button" title="'+r+'">'+o+"</button></div>")[0]}$(e.element).addClass("ol-control-"+this.positionCode);var s=e.buttonClickHandler||n.prototype._handleClick.bind(this);$(e.element).on("click",s),ol.control.Control.call(this,e),this._postRender()};ol.inherits(n,ol.control.Control);var r=n.prototype;r.getPosition=function(e){var e=e||this.positionCode,t={};return t.top=e.indexOf("t")>-1,t.left=e.indexOf("l")>-1,t},r._handleClick=function(e){e.preventDefault();var t=this,i=this.getMap(),n=null,r=i.getControls();r.forEach(function(e){e.id&&e.toggle&&e.id!=t.id&&(e.toggle(!1),"reset"==e.name&&(n=e))}),!t._toggled&&n&&n.toggle(!0)},r.layout=function(e){if(e){var t=this.getPosition(),i=e.getViewport(),n=$(i).find(".ol-control-"+this.positionCode);if(n.length){previusControl=n.last();var r=t.left?previusControl.position().left:previusControl.position().right,o=t.left?"left":"right",s=previusControl[0].offsetWidth,a=$(this.element).position()[o]+r+s+2;$(this.element).css(o,a+"px")}}},r.setMap=function(e){this.layout(e),ol.control.Control.prototype.setMap.call(this,e)},r._postRender=function(){},t.exports=n},{}],53:[function(e,t,i){var n=e("./control"),r=function(e){this._toggled=this._toggled||!1,this._interactionClass=e.interactionClass||null,this._interaction=null,this._autountoggle=e.autountoggle||!1,e.buttonClickHandler=r.prototype._handleClick.bind(this),n.call(this,e)};ol.inherits(r,n);var o=r.prototype;o.toggle=function(e){var e=void 0!==e?e:!this._toggled;this._toggled=e;var t=(this.getMap(),$(this.element).find("button").first());e?(this._interaction&&this._interaction.setActive(!0),t.addClass("g3w-ol-toggled")):(this._interaction&&this._interaction.setActive(!1),t.removeClass("g3w-ol-toggled"))},o.setMap=function(e){!this._interaction&&this._interactionClass&&(this._interaction=new this._interactionClass,e.addInteraction(this._interaction),this._interaction.setActive(!1)),n.prototype.setMap.call(this,e)},o._handleClick=function(e){this.toggle(),n.prototype._handleClick.call(this,e)},t.exports=r},{"./control":52}],54:[function(e,t,i){var n=function(e){switch(this._control=null,this.positionCode=e.position||"tl",e.type){case"zoom":this._control=new ol.control.Zoom(e);break;case"zoomtoextent":this._control=new ol.control.ZoomToExtent(e);break;case"scaleline":this._control=new ol.control.ScaleLine(e);break;case"overview":this._control=new ol.control.OverviewMap(e)}$(this._control.element).addClass("ol-control-"+this.positionCode),ol.control.Control.call(this,{element:this._control.element})};ol.inherits(n,ol.control.Control),t.exports=n;var r=n.prototype;r.getPosition=function(e){var e=e||this.positionCode,t={};return t.top=e.indexOf("t")>-1,t.left=e.indexOf("l")>-1,t},r.layout=function(e){if(e){var t=this.getPosition(),i=e.getViewport(),n=$(i).find(".ol-control-"+this.positionCode);if(n.length){previusControl=n.last();var r=t.left?previusControl.position().left:previusControl.position().right,o=t.left?"left":"right",s=previusControl[0].offsetWidth,a=$(this.element).position()[o]+r+s+2;$(this.element).css(o,a+"px")}}},r.setMap=function(e){this.layout(e),this._control.setMap(e)}},{}],55:[function(e,t,i){var n=e("../utils"),r=e("./interactioncontrol"),o=e("../interactions/pickcoordinatesinteraction"),s=function(e){var t={name:"querylayer",tipLabel:"Query layer",label:"î¨",interactionClass:o};e=n.merge(e,t),r.call(this,e)};ol.inherits(s,r);var a=s.prototype;a.setMap=function(e){var t=this;r.prototype.setMap.call(this,e),this._interaction.on("boxstart",function(e){t._startCoordinate=e.coordinate}),this._interaction.on("picked",function(e){t.dispatchEvent({type:"picked",coordinates:e.coordinate}),t._autountoggle&&t.toggle()})},t.exports=s},{"../interactions/pickcoordinatesinteraction":60,"../utils":65,"./interactioncontrol":53}],56:[function(e,t,i){var n=e("../utils"),r=e("./interactioncontrol"),o=function(e){this._toggled=!0,this._startCoordinate=null;var t={name:"reset",tipLabel:"Pan",label:"î¤"};e=n.merge(e,t),r.call(this,e)};ol.inherits(o,r),t.exports=o;var s=o.prototype;s._postRender=function(){this.toggle(!0)}},{"../utils":65,"./interactioncontrol":53}],57:[function(e,t,i){var n=e("../utils"),r=e("./interactioncontrol"),o=function(e){this._startCoordinate=null;var t={name:"zoombox",tipLabel:"Zoom to box",label:"î¤",interactionClass:ol.interaction.DragBox};e=n.merge(e,t),r.call(this,e)};ol.inherits(o,r),t.exports=o;var s=o.prototype;s.setMap=function(e){var t=this;r.prototype.setMap.call(this,e),this._interaction.on("boxstart",function(e){t._startCoordinate=e.coordinate}),this._interaction.on("boxend",function(e){var i=t._startCoordinate,n=e.coordinate,r=ol.extent.boundingExtent([i,n]);t.dispatchEvent({type:"zoomend",extent:r}),t._startCoordinate=null,t._autountoggle&&t.toggle()})}},{"../utils":65,"./interactioncontrol":53}],58:[function(e,t,i){var n=e("./utils"),r=e("./map/maphelpers");!function(e,n,r){"function"==typeof define&&define.amd?define(r):"object"==typeof i?t.exports=r():n[e]=r()}("g3wol3",this,function(){"use strict";var e=n.merge({},r);return{helpers:e}})},{"./map/maphelpers":64,"./utils":65}],59:[function(e,t,i){var n=function(e,t,i){this.type=e,this.features=t,this.coordinate=i},r=function(e){ol.interaction.Pointer.call(this,{handleDownEvent:r.handleDownEvent_,handleMoveEvent:r.handleMoveEvent_,handleUpEvent:r.handleUpEvent_,handleEvent:r.handleEvent_}),this.previousCursor_=void 0,this.lastCoordinate_=null,this.features_=void 0!==e.features?e.features:null};ol.inherits(r,ol.interaction.Pointer),r.handleEvent_=function(e){return"keydown"!=e.type?ol.interaction.Pointer.handleEvent.call(this,e):this.features_.getArray().length&&46==e.originalEvent.keyCode?(this.dispatchEvent(new n("deleteend",this.features_,event.coordinate)),!0):void 0},r.handleDownEvent_=function(e){return this.lastFeature_=this.featuresAtPixel_(e.pixel,e.map),!!this.lastFeature_&&(r.handleMoveEvent_.call(this,e),this.dispatchEvent(new n("deleteend",this.features_,e.coordinate)),!0)},r.handleMoveEvent_=function(e){var t=e.map.getTargetElement(),i=e.map.forEachFeatureAtPixel(e.pixel,function(e){return e});i?(this.previousCursor_=t.style.cursor,t.style.cursor="pointer"):(t.style.cursor=void 0!==this.previousCursor_?this.previousCursor_:"",this.previousCursor_=void 0)},r.prototype.featuresAtPixel_=function(e,t){var i=null,n=t.forEachFeatureAtPixel(e,function(e){return e});return this.features_&&_.includes(this.features_.getArray(),n)&&(i=n),i},t.exports=r},{}],60:[function(e,t,i){var n={PICKED:"picked"},r=function(e,t){this.type=e,this.coordinate=t},o=function(e){this.previousCursor_=null,ol.interaction.Pointer.call(this,{handleDownEvent:o.handleDownEvent_,handleUpEvent:o.handleUpEvent_,handleMoveEvent:o.handleMoveEvent_})};ol.inherits(o,ol.interaction.Pointer),o.handleDownEvent_=function(e){return!0},o.handleUpEvent_=function(e){return this.dispatchEvent(new r(n.PICKED,e.coordinate)),!0},o.handleMoveEvent_=function(e){var t=e.map.getTargetElement();t.style.cursor="pointer"},o.prototype.shouldStopEvent=function(){return!1},o.prototype.setActive=function(e){var t=this.getMap();if(t){var i=t.getTargetElement();i.style.cursor=""}ol.interaction.Pointer.prototype.setActive.call(this,e)},o.prototype.setMap=function(e){if(!e){var t=this.getMap().getTargetElement();t.style.cursor=""}ol.interaction.Pointer.prototype.setMap.call(this,e)},t.exports=o},{}],61:[function(e,t,i){var n={PICKED:"picked"},r=function(e,t,i){this.type=e,this.feature=i,this.coordinate=t},o=function(e){ol.interaction.Pointer.call(this,{handleDownEvent:o.handleDownEvent_,handleUpEvent:o.handleUpEvent_,handleMoveEvent:o.handleMoveEvent_}),this.features_=e.features||null,this.layers_=e.layers||null,this.pickedFeature_=null;var t=this;this.layerFilter_=function(e){return _.includes(t.layers_,e)}};ol.inherits(o,ol.interaction.Pointer),o.handleDownEvent_=function(e){return this.pickedFeature_=this.featuresAtPixel_(e.pixel,e.map),!0},o.handleUpEvent_=function(e){return this.pickedFeature_&&this.dispatchEvent(new r(n.PICKED,e.coordinate,this.pickedFeature_)),!0},o.handleMoveEvent_=function(e){var t=e.map.getTargetElement(),i=this.featuresAtPixel_(e.pixel,e.map);i?t.style.cursor="pointer":t.style.cursor=""},o.prototype.featuresAtPixel_=function(e,t){var i=null,n=t.forEachFeatureAtPixel(e,function(e){return this.features_?this.features_.indexOf(e)>-1?e:null:e},this,this.layerFilter_);return n&&(i=n),i},o.prototype.shouldStopEvent=function(){return!1},o.prototype.setMap=function(e){if(!e){var t=this.getMap().getTargetElement();t.style.cursor=""}ol.interaction.Pointer.prototype.setMap.call(this,e)},t.exports=o},{}],62:[function(e,t,i){var n={};n.OSM=new ol.layer.Tile({source:new ol.source.OSM({attributions:[new ol.Attribution({html:'All maps &copy; <a href="http://www.openstreetmap.org/">OpenStreetMap</a>'}),ol.source.OSM.ATTRIBUTION],url:"http://{a-c}.tile.openstreetmap.org/{z}/{x}/{y}.png",crossOrigin:null}),id:"osm",title:"OSM",basemap:!0}),n.BING={},n.BING.Road=new ol.layer.Tile({name:"Road",visible:!1,preload:1/0,source:new ol.source.BingMaps({key:"Am_mASnUA-jtW3O3MxIYmOOPLOvL39dwMvRnyoHxfKf_EPNYgfWM9imqGETWKGVn",imagerySet:"Road"}),basemap:!0}),n.BING.AerialWithLabels=new ol.layer.Tile({name:"AerialWithLabels",visible:!0,preload:1/0,source:new ol.source.BingMaps({key:"Am_mASnUA-jtW3O3MxIYmOOPLOvL39dwMvRnyoHxfKf_EPNYgfWM9imqGETWKGVn",
imagerySet:"AerialWithLabels"}),basemap:!0}),n.BING.Aerial=new ol.layer.Tile({name:"Aerial",visible:!1,preload:1/0,source:new ol.source.BingMaps({key:"Am_mASnUA-jtW3O3MxIYmOOPLOvL39dwMvRnyoHxfKf_EPNYgfWM9imqGETWKGVn",imagerySet:"Aerial"}),basemap:!0}),t.exports=n},{}],63:[function(e,t,i){var n=e("../utils"),r={};r.TiledWMSLayer=function(e,t){var i={layerObj:e,extraParams:t||{},tiled:!0};return r._WMSLayer(i)},r.WMSLayer=function(e,t){var i={layerObj:e,extraParams:t||{}};return r._WMSLayer(i)},r._WMSLayer=function(e){var t=e.layerObj,i=e.extraParams,r=e.tiled||!1,o={LAYERS:t.layers||"",VERSION:"1.3.0",TRANSPARENT:!0,SLD_VERSION:"1.1.0"};o=n.merge(o,i);var s,a,l={url:t.url,params:o,ratio:1},c={id:t.id,name:t.name,opacity:t.opacity||1,visible:t.visible,maxResolution:t.maxResolution};r?(a=new ol.source.TileWMS(l),s=ol.layer.Tile):(a=new ol.source.ImageWMS(l),s=ol.layer.Image),c.source=a;var u=new s(c);return u},t.exports=r},{"../utils":65}],64:[function(e,t,i){BaseLayers=e("../layers/bases");var n={createViewer:function(e){return new r(e)}},r=function(e){var t=ol.control.defaults({attributionOptions:{collapsible:!1},zoom:!1,attribution:!1}),i=ol.interaction.defaults().extend([new ol.interaction.DragRotate]);i.removeAt(1);var n;n=e.view instanceof ol.View?e.view:new ol.View(e.view);var r={controls:t,interactions:i,ol3Logo:!1,view:n,keyboardEventTarget:document};e.id&&(r.target=e.id);var o=new ol.Map(r);this.map=o};r.prototype.destroy=function(){this.map&&(this.map.dispose(),this.map=null)},r.prototype.getView=function(){return this.map.getView()},r.prototype.updateMap=function(e){},r.prototype.updateView=function(){},r.prototype.getMap=function(){return this.map},r.prototype.setTarget=function(e){this.map.setTarget(e)},r.prototype.goTo=function(e,t){var t=t||{},i=t.animate||!0,n=t.zoom||!1,r=this.map.getView();if(i){var o=ol.animation.pan({duration:500,source:r.getCenter()}),s=ol.animation.zoom({duration:500,resolution:r.getResolution()});this.map.beforeRender(o,s)}r.setCenter(e),n&&r.setZoom(n)},r.prototype.goToRes=function(e,t){var i=i||{},n=i.animate||!0,r=this.map.getView();if(n){var o=ol.animation.pan({duration:300,source:r.getCenter()}),s=ol.animation.zoom({duration:300,resolution:r.getResolution()});this.map.beforeRender(o,s)}r.setCenter(e),r.setResolution(t)},r.prototype.fit=function(e,t){var i=this.map.getView(),t=t||{},n=t.animate||!0;if(n){var r=ol.animation.pan({duration:300,source:i.getCenter()}),o=ol.animation.zoom({duration:300,resolution:i.getResolution()});this.map.beforeRender(r,o)}t.animate&&delete t.animate,t.constrainResolution=t.constrainResolution||!0,i.fit(e,this.map.getSize(),t)},r.prototype.getZoom=function(){var e=this.map.getView();return e.getZoom()},r.prototype.getResolution=function(){var e=this.map.getView();return e.getResolution()},r.prototype.getCenter=function(){var e=this.map.getView();return e.getCenter()},r.prototype.getBBOX=function(){return this.map.getView().calculateExtent(this.map.getSize())},r.prototype.getLayerByName=function(e){for(var t=this.map.getLayers(),i=t.getLength(),n=0;n<i;n++)if(e===t.item(n).get("name"))return t.item(n);return null},r.prototype.removeLayerByName=function(e){var t=this.getLayerByName(e);t&&(this.map.removeLayer(t),delete t)},r.prototype.getActiveLayers=function(){var e=[];return this.map.getLayers().forEach(function(t){var i=t.getProperties();1!=i.basemap&&i.visible&&e.push(t)}),e},r.prototype.removeLayers=function(){this.map.getLayers().clear()},r.prototype.getLayersNoBase=function(){var e=[];return this.map.getLayers().forEach(function(t){var i=t.getProperties();1!=i.basemap&&e.push(t)}),e},r.prototype.addBaseLayer=function(e){var t;t=e?BaseLayers[e]:BaseLayers.BING.Aerial,this.map.addLayer(t)},r.prototype.changeBaseLayer=function(e){var t=this.getLayerByName(layername),i=this.map.getLayers();i.insertAt(0,t)},t.exports=n},{"../layers/bases":62}],65:[function(e,t,i){var n={merge:function(e,t){var i={};for(var n in e)i[n]=e[n];for(var n in t)i[n]=t[n];return i}};t.exports=n},{}],66:[function(e,t,i){t.exports='<!-- item template -->\n<div id="catalog" class="tabbable-panel catalog">\n  <div class="title">{{ title }}</div>\n  <div class="tabbable-line">\n    <ul class="nav nav-tabs" role="tablist">\n      <li role="presentation" class="active"><a href="#tree" aria-controls="tree" role="tab" data-toggle="tab" data-i18n="tree">Data</a></li>\n      <li v-if="hasBaseLayers" role="presentation"><a href="#baselayers" aria-controls="baselayers" role="tab" data-toggle="tab" data-i18n="baselayers">Layer Base</a></li>\n      <li role="presentation"><a href="#legend" aria-controls="legend" role="tab" data-toggle="tab" data-i18n="legend">Legenda</a></li>\n    </ul>\n    <div  class="tab-content">\n      <div role="tabpanel" class="tab-pane active tree" id="tree">\n        <ul class="tree-root">\n          <tristate-tree v-if="!isHidden" :layerstree="layerstree" class="item" v-for="layerstree in layerstree">\n          </tristate-tree>\n        </ul>\n      </div>\n      <div v-if="hasBaseLayers" role="tabpanel" class="tab-pane baselayers" id="baselayers">\n        <form>\n          <ul>\n            <li v-if="!baselayer.fixed" v-for="baselayer in baselayers">\n              <div class="radio">\n                <label><input type="radio" name="baselayer" v-checked="baselayer.visible" @click="setBaseLayer(baselayer.id)">{{ baselayer.title }}</label>\n              </div>\n            </li>\n          </ul>\n        </form>\n      </div>\n      <legend :layerstree="layerstree"></legend>\n    </div>\n  </div>\n</div>\n'},{}],67:[function(e,t,i){function n(e){function t(e){var t=e.getService();i.state.visible=!t.state.hidden,t.onafter("setHidden",function(e){i.state.visible=!t.state.hidden,i.state.expanded=!0})}o(this);var i=this;if(this.id="catalog-component",this.title="catalog",this.mapComponentId=e.mapcomponentid,this.internalComponent=new d,this.mapComponentId){var n=c.getComponent(this.mapComponentId);n?t(n):l.on("componentregistered",function(e){e.getId()==i.mapComponentId&&t(e)})}s(this,e)}var r=e("core/utils/utils").inherit,o=e("core/utils/utils").base,s=e("core/utils/utils").merge,a=(e("core/i18n/i18n.service").t,e("core/utils/utils").resolve,e("gui/vue/component")),l=e("gui/componentsregistry"),c=e("gui/gui"),u=e("core/project/projectsregistry"),h={template:e("./catalog.html"),data:function(){return{prstate:u.state}},computed:{project:function(){return this.prstate.currentProject},title:function(){return this.project.state.title},layerstree:function(){return this.project.state.layerstree},baselayers:function(){return this.project.state.baselayers},hasBaseLayers:function(){return this.project.state.baselayers.length>0}},methods:{setBaseLayer:function(e){this.project.setBaseLayer(e)}},ready:function(){var e=this;this.$on("treenodetoogled",function(t){e.project.toggleLayer(t.id)}),this.$on("treenodestoogled",function(t,i){var n=_.map(t,"id");e.project.toggleLayers(n,i)}),this.$on("treenodeselected",function(t){t.selected?e.project.unselectLayer(t.id):e.project.selectLayer(t.id)})}},d=Vue.extend(h);Vue.component("g3w-catalog",h),Vue.component("tristate-tree",{template:e("./tristate-tree.html"),props:{layerstree:[],n_parentChilds:0,checked:!1},data:function(){return{expanded:this.layerstree.expanded,parentChecked:!1,n_childs:this.layerstree.nodes?this.layerstree.nodes.length:0}},watch:{checked:function(e){this.layerstree.visible=e}},computed:{isFolder:function(){var e=!!this.n_childs;if(e){var t=0;_.forEach(this.layerstree.nodes,function(e){e.visible&&(t+=1)}),this.n_parentChilds=this.n_childs-t}return e},isHidden:function(){return this.layerstree.hidden&&this.layerstree.hidden===!0},selected:function(){var e=this.layerstree.selected?"SI":"NO";return e}},methods:{toggle:function(e){var t="true"==e;this.isFolder&&!t?this.layerstree.expanded=!this.layerstree.expanded:t?(this.parentChecked&&!this.n_parentChilds?this.parentChecked=!1:this.parentChecked&&this.n_parentChilds?this.parentChecked=!0:this.parentChecked=!this.parentChecked,this.$dispatch("treenodestoogled",this.layerstree.nodes,this.parentChecked)):this.$dispatch("treenodetoogled",this.layerstree)},select:function(){this.isFolder||this.$dispatch("treenodeselected",this.layerstree)},triClass:function(){return this.n_parentChilds?this.n_parentChilds>0&&this.n_parentChilds<this.n_childs?"fa-square":"fa-square-o":"fa-check-square-o"}}}),Vue.component("legend",{template:e("./legend.html"),props:["layerstree"],data:function(){return{}},computed:{visiblelayers:function(){function e(i){_.forIn(i,function(i,n){!_.isNil(i.id)&&i.visible&&t.push(i),_.isNil(i.nodes)||e(i.nodes)})}var t=[],i=this.layerstree;return e(i),t}},watch:{layerstree:{handler:function(e,t){},deep:!0}},ready:function(){}}),Vue.component("legend-item",{template:e("./legend_item.html"),props:["layer"],computed:{legendurl:function(){var e=u.getCurrentProject().getLayerById(this.layer.id);if(e)return e.getLegendUrl()}},methods:{openform:function(){}}}),r(n,a),t.exports=n},{"./catalog.html":66,"./legend.html":68,"./legend_item.html":69,"./tristate-tree.html":70,"core/i18n/i18n.service":34,"core/project/projectsregistry":45,"core/utils/utils":51,"gui/componentsregistry":72,"gui/gui":79,"gui/vue/component":98}],68:[function(e,t,i){t.exports='<div role="tabpanel" class="tab-pane" id="legend">\n  <legend-item :layer="layer" v-for="layer in visiblelayers"></legend-item>\n</div>\n'},{}],69:[function(e,t,i){t.exports='<div @click="openform()">{{ layer.title }}</div>\n<div><img :src="legendurl"></div>\n'},{}],70:[function(e,t,i){t.exports='<li class="tree-item" :class="{selected: layerstree.selected}">\n  <span :class="{bold: isFolder, \'fa-chevron-down\': layerstree.expanded, \'fa-chevron-right\': !layerstree.expanded}" @click="toggle" v-if="isFolder" class="fa"></span>\n  <span v-if="isFolder" @click="toggle(\'true\')" :class="[triClass()]" class="fa"></span>\n  <span v-else @click="toggle" :class="[layerstree.visible  ? \'fa-check-square-o\': \'fa-square-o\',layerstree.disabled  ? \'disabled\': \'\']" class="fa" style="cursor:default"></span>\n  <span id="tree-node-title" :class="{bold: isFolder, disabled: layerstree.disabled}" @click="select">{{layerstree.title}}</span>\n  <ul v-show="layerstree.expanded" v-if="isFolder">\n    <tristate-tree :n_parent-childs.sync="n_parentChilds" :layerstree="layerstree" :checked="parentChecked" v-for="layerstree in layerstree.nodes">\n    </tristate-tree>\n  </ul>\n</li>\n\n\n\n\n'},{}],71:[function(e,t,i){var n=e("core/utils/utils").inherit,r=e("core/utils/utils").merge,o=e("core/g3wobject"),s=["methods","computed","data","components"],a=function(e){var e=e||{};this.internalComponent=null,this.id=e.id||1e3*Math.random(),this.title=e.title||"",this.state={visible:e.visible||!0,open:e.open||!1}};n(a,o);var l=a.prototype;l.getId=function(){return this.id},l.setId=function(e){this.id=e},l.getTitle=function(){return this.state.title},l.setTitle=function(e){this.state.title=e},l.getService=function(){return this._service},l.setService=function(e){this._service=e},l.getInternalComponent=function(){return this.internalComponent},l.setInternalComponent=function(e){this.internalComponent=e},l.overwriteServiceMethod=function(e,t){this._service[e]=t},l.overwriteServiceMethods=function(e){var t=this;_.forEach(e,function(e,i){t.overwriteServiceMethod(i,e)})},l.extendService=function(e){this._service&&r(this._service,e)},l.extendInternalComponent=function(e){var t=this;this.vueComponent&&_.forEach(e,function(e,i){if(s.indexOf(i)>-1)switch(i){case"methods":t.extendInternalComponentMethods(e);break;case"components":t.extendInternalComponentComponents(e);break;default:r(t.vueComponent[i],e)}})},l.extendInternalComponentComponents=function(e){e&&r(this.vueComponent.components,e)},l.extendInternalComponentMethods=function(e){e&&(_.forEach(e,function(t,i){t instanceof Function||delete e[i]}),r(this.vueComponent.methods,e))},l.extendInternalComponentComputed=function(e){e&&(_.forEach(e,function(t,i){t instanceof Function||delete e[i]}),r(this.vueComponent.computed,e))},l.setInternalComponentTemplate=function(e){e&&(this.vueComponent.template=e)},l.getInternalTemplate=function(){return this.vueComponent.template},l.mount=function(e){},l.unmount=function(){},l.ismount=function(){return!0},l.layout=function(e,t){},t.exports=a},{"core/g3wobject":31,"core/utils/utils":51}],72:[function(e,t,i){function n(){this.components={},this.registerComponent=function(e){var t=e.getId();this.components[t]||(this.components[t]=e,this.emit("componentregistered",e))},this.getComponent=function(e){return this.components[e]},this.unregisterComponent=function(e){var t=this._components[e];t&&(_.isFunction(t.destroy)&&t.destroy(),delete t,this._components[e]=null)}}var r=e("core/g3wobject"),o=e("core/utils/utils").inherit;e("core/utils/utils").base;o(n,r),t.exports=new n},{"core/g3wobject":31,"core/utils/utils":51}],73:[function(e,t,i){},{}],74:[function(e,t,i){t.exports='<div class="g3w-iternet-editing-panel">\n  <template v-for="toolbar in editorstoolbars">\n    <div class="panel panel-primary">\n      <div class="panel-heading">\n        <h3 class="panel-title">{{ toolbar.name }}</h3>\n      </div>\n      <div class="panel-body">\n        <template v-for="tool in toolbar.tools">\n          <div class="editbtn" :class="{\'enabled\' : (state.editing.on && editingtoolbtnEnabled(tool)), \'toggled\' : editingtoolbtnToggled(toolbar.layercode,tool.tooltype)}">\n            <img height="30px" width="30px" @click="toggleEditTool(toolbar.layercode,tool.tooltype)" :alt.once="tool.title" :title.once="tool.title" :src.once="resourcesurl+\'images/\'+tool.icon"/>\n          </div>\n        </template>\n      </div>\n    </div>\n  </template>\n  <div>\n    <button class="btn btn-primary" v-disabled="editingbtnEnabled" :class="{\'btn-success\' : state.editingOn}" @click="toggleEditing">{{ editingbtnlabel }}</button>\n    <button class="btn btn-danger" v-disabled="!state.hasEdits" @click="saveEdits">{{ savebtnlabel }}</button>\n    <img v-show="state.retrievingData" :src="resourcesurl +\'images/loader.svg\'">\n  </div>\n  <div class="message">\n    {{{ message }}}\n  </div>\n</div>\n'},{}],75:[function(e,t,i){function n(e){var t=this;l(this,e),this.vueComponent=h,this.componentService=a,this.id=e.id,c(this,e),this.internalComponent=null,this._template=e.template||u,this._editorsToolbars=e.editorsToolBars||[],this._saveBtnLabel=e.saveBtnLabel||"Salva",this._resourcesUrl=e.resourcesUrl||o.getResourcesUrl(),this._service=e.service||new a,this.setInternalComponent=function(){var e=Vue.extend(this.vueComponent);return this.internalComponent=new e({service:this._service,template:this._template,data:function(){return{state:t._service.state,resourcesurl:t._resourcesUrl,editorstoolbars:t._editorsToolbars,savebtnlabel:t._saveBtnLabel}}}),this.internalComponent.state=this._service.state,this.internalComponent}}var r=e("core/utils/utils").inherit,o=e("gui/gui"),s=e("gui/vue/component"),a=e("gui/editorpanel/panelservice"),l=e("core/utils/utils").base,c=e("core/utils/utils").merge,u=e("./panel.html"),h={template:null,data:null,transitions:{addremovetransition:"showhide"},methods:{toggleEditing:function(){this.$options.service.toggleEditing()},saveEdits:function(){this.$options.service.saveEdits()},toggleEditTool:function(e,t){""!=t&&this.state.editing.on&&this.$options.service.toggleEditTool(e,t)},editingtoolbtnToggled:function(e,t){return this.state.editing.layerCode==e&&this.state.editing.toolType==t},editingtoolbtnEnabled:function(e){return""!=e.tooltype},onClose:function(){this.$options.service.stop()}},computed:{editingbtnlabel:function(){return this.state.editing.on?"Termina editing":"Avvia editing"},editingbtnEnabled:function(){return this.state.editing.enabled||this.state.editing.on?"":"disabled"},message:function(){var e="";if(this.state.editing.enabled){if(this.state.editing.toolstep.message){var t=this.state.editing.toolstep.n,i=this.state.editing.toolstep.total,n=this.state.editing.toolstep.message;e='<div style="margin-top:20px">GUIDA STRUMENTO:</div><div><span>['+t+"/"+i+'] </span><span style="color: yellow">'+n+"</span></div>"}}else e='<span style="color: red">Aumentare il livello di zoom per abilitare l\'editing';return e}}};Vue.extend(h);r(n,s),t.exports=n},{"./panel.html":74,"core/utils/utils":51,"gui/editorpanel/panelservice":73,"gui/gui":79,"gui/vue/component":98}],76:[function(e,t,i){function n(){this._actions={},this.state=null,this._pickInteraction=null,this.setters={setInitForm:function(e){this._setInitForm(e)},setFormRelations:function(e){this.state.relations=e},setFormFields:function(e){this.state.fields=e},setupFields:function(){this._setupFields()},setupRelationsFields:function(){this._setupRelationsFields()},setFormData:function(e,t){this.setFormFields(e),this.setFormRelations(t)},setField:function(e){console.log(e)},setState:function(e){this._setState(e)},addActionsForForm:function(e){},postRender:function(e){}},this._setInitForm=function(e){this.provider=e.provider||null,this.formId=e.formId,this.name=e.name,this.dataid=e.dataid,this.editor=e.editor||{},this.relationOne=e.relationOne||null,this.pk=e.pk||null,this.tools=e.tools||[],this.isnew=!(!_.isNil(e.isnew)&&_.isBoolean(e.isnew))||e.isnew,this._defaults=e.defaults||h.defaults,this.buttons=e.buttons,this._clipBoard=c;var t=this.formId.split("form")[0];this._pickedPromise=null,this.state={fields:null,relations:null,editor:this.editor,isnew:this.isnew,buttons:this.buttons,tools:{},relationOne:this.relationOne,canpaste:_.has(this._clipBoard._data,t)},this.setFormFields(e.fields),this.setFormRelations(e.relations);var i=this.getUniqueRelationsElementId();this.state.elementsBoxes=i,this._setFormTools(this.tools)},this.createPickInteraction=function(){return this._pickInteraction=new l,this._pickInteraction},this.getState=function(){return this.state},this._setState=function(e){this.state=e},this._checkFieldsValidation=function(e){var t=this,i=!0,n=!0;return _.forEach(e,function(e){t._isEditable(e)&&t._isVisible(e)&&e.validate&&e.validate.required&&(!_.isNil(e.value)&&_.trim(e.value)||(n=!1),i=i&&n)}),i},this.getFields=function(){return this._fields},this._getRelationsOne=function(){var e=this,t=[];return _.forEach(this.state.relations,function(i,n){"ONE"==i.type&&t.push(e.state.relations[n])}),t},this._getLayerFormFromId=function(){return this.formId.split("form")[0]},this._copyFormToClipBoard=function(){var e=_.cloneDeep(this.state);return this._clipBoard.set(this.formId,e),this.state.canpaste=!0,!0},this._setFieldValueLayerFromToRelationField=function(e,t){},this._checkIfFieldIsOverwritable=function(e,t){var i=null;return _.forEach(t,function(t){_.isNil(t[e])||(i=t[e])}),i},this._pasteStateWithoutPk=function(e,t){var i=this,n=[],r=i.editor.getcopyAndPasteFieldsNotOverwritable(),o={};_.isNil(r.layer)||(n=r.layer),_.isNil(r.relations)||(o=r.relations);var s;_.forEach(e,function(t,r){s=i._checkIfFieldIsOverwritable(t.name,n),i.pk==t.name?e[r].value=i.isnew?null:i.state.fields[r].value:_.isNull(s)||(e[r].value=s&&i.isnew?void 0:i.state.fields[r].value)}),_.forEach(t,function(e,i){_.forEach(e.elements,function(n,r){t[i].elements[r].state="NEW",_.forEach(n.fields,function(n,s){_.forEach(o[e.name],function(e){n.name==e&&(t[i].elements[r].fields[s].value=void 0)})})})}),this.setFormRelations(t),this.setFormFields(e);var a=this.getUniqueRelationsElementId(!1);return this.state.elementsBoxes=a,!0},this._pasteClipBoardToForm=function(e){var t=this._clipBoard.get(e);this._pasteStateWithoutPk(t.fields,t.relations),this.state.canpaste=!1},this._isNew=function(){return this.isnew},this._hasFieldsRequired=function(){var e=_.some(this.state.fields,function(e){return e.validate&&e.validate.required}),t=_.some(this.state.relations,function(e){return e.validate&&e.validate.required});return e||t},this._isVisible=function(e){return!(!e.editable&&(""==e.value||_.isNull(e.value)))},this._isEditable=function(e){return e.editable},this._isSimple=function(e){return!_.includes(h.specialInputs,e.input.type)&&_.includes(h.simpleFieldTypes,e.type)},this._isTextarea=function(e){return e.input.type==h.TEXTAREA},this._isSelect=function(e){return _.includes(h.specialInputs,e.input.type)&&e.input.type==h.SELECT},this._isRadio=function(e){return _.includes(h.specialInputs,e.input.type)&&e.input.type==h.RADIO},this._isCheckbox=function(e){return _.includes(h.specialInputs,e.input.type)&&e.input.type==h.CHECKBOX},this._isLayerPicker=function(e){return _.includes(h.specialInputs,e.input.type)&&e.input.type==h.LAYERPICKER},this._isImage=function(e){return e.input.type==h.IMAGE},this._cleanUpPickLayer=function(){var e=s.getComponent("map").getService();e.removeInteraction(this._pickInteraction),this._pickInteraction=null,s.setModal(!0)},this._pickLayerInputFieldChange=function(e,t){console.log("funzione che deve essere sovrascritta dal plugin")},this._pickLayer=function(e,t){var i=$.Deferred();s.notify.info("Seleziona un'elemento dalla mappa per ottenere il valore di "+e.label+" o scrivilo direttamentene");var n=this;s.setModal(!1);var r=s.getComponent("map").getService(),o=r.getProject().getLayerById(e.input.options.layerid),a=e.input.options.field,l=o.getAttributeLabel(e.input.options.field);return r.addInteraction(this.createPickInteraction()),this._pickInteraction.on("picked",function(t){u.queryByLocation(t.coordinate,[o]).then(function(t){var n=t.data;if(n.length&&n[0].features.length){var r=n[0].features[0].getProperties(),o=r[a]?r[a]:r[l];e.value=o,i.resolve(r)}else i.reject()}).fail(function(){i.reject()}).always(function(){n._cleanUpPickLayer()})}),i.promise()},this._pickLayerToClipBoard=function(){var e=this,t=$.Deferred();if(this._pickedPromise)return this._pickedPromise;s.setModal(!1);var i=s.getComponent("map").getService(),n=this.editor.getVectorLayer(),r=i.getProject().getLayerById(n.id);return i.addInteraction(this.createPickInteraction()),this._pickInteraction.on("picked",function(i){u.queryByLocation(i.coordinate,[r]).then(function(i){var r=i.data;if(r.length&&r[0].features.length){var o=r[0].features[0],s=n.getPk();o=n.getFeatureById(o.get(s));var a=n.getFieldsWithValues(o),l=e.editor.getRelationsWithValues(o);l.then(function(i){e._pasteStateWithoutPk(a,i),t.resolve()})}}).fail(function(){t.reject()}).always(function(){e._cleanUpPickLayer()})}),t.promise()},this._getDefaultValue=function(e){return e.input&&e.input.options&&e.input.options["default"]?e.input.options["default"]:this._isSelect(e)?e.input.options.values[0].key:""},this._getlayerPickerLayerName=function(e){mapService=s.getComponent("map").getService();var t=mapService.getProject().getLayerById(e);return t?t.getName():""},this._shouldShowRelation=function(e){return!0},this._setupFields=function(){var e=this,t=_.filter(this.state.fields,function(t){return!e.pk||null!=t.value||t.name!=e.pk});_.forEach(t,function(t){if(_.isNil(t.value)){var i=e._getDefaultValue(t);i&&(t.value=i)}})},this._setupRelationsFields=function(e){var t=this;e=e||this.state.relations,e&&_.forEach(e,function(e){_.forEach(e.elements,function(e){t._setupRelationElementFields(e)})})},this._setupRelationElementFields=function(e){var t=this;_.forEach(e.fields,function(e){_.isNil(e.value)&&(e.value=t._getDefaultValue(e))})},this._setupPanel=function(){var e=this.internalComponent=new this._formPanel({form:this});this.options.buttons&&(e.buttons=this.options.buttons);var t=this.getUniqueRelationsElementId();return this.state.elementsBoxes=t,e.state=this.state,this._setFormTools(this.tools),e},this._setFormTools=function(e){var t=this;_.forEach(e,function(e){t.state.tools[e]=!0})},this.getUniqueRelationsElementId=function(e){var t=this,i={},n=!!_.isNil(e)||e;return _.forEach(this.state.relations,function(e){_.forEach(e.elements,function(r){var o=t.getUniqueRelationElementId(e,r);i[o]={collapsed:n}})}),i},this.getUniqueRelationElementId=function(e,t){return e.name+"_"+t.id},this._getField=function(e){var t=null;return _.forEach(this.state.fields,function(i){i.name==e&&(t=i)}),t},this._addRelationElement=function(e){var t=this.provider.createRelationElement(e),i=this.getUniqueRelationElementId(e,t);Vue.set(this.state.elementsBoxes,i,{collapsed:!1}),this._setupRelationElementFields(t),e.elements.push(t)},this._removeRelationElement=function(e,t){var i=this;_.forEach(e.elements,function(e,n){e.id==t.id&&(t.state=t.state+"_DELETED",delete i.state.elementsBoxes.elmentBoxId)})},this._removeRelationElements=function(e){var t=this;_.forEach(e.elements,function(i){t._removeRelationElement(e,i)})},this._getRelationField=function(e,t){var i=null;return _.forEach(this.state.relations,function(n){t==n.name&&_.forEach(n.fields,function(t){t.name==e&&(i=t)})}),i},this._getRelationElementField=function(e,t){var i;return _.forEach(t.fields,function(t){t.name==e&&(i=t)}),i},o(this)}var r=e("core/utils/utils").inherit,o=e("core/utils/utils").base,s=e("gui/gui"),a=e("core/g3wobject"),l=e("g3w-ol3/src/interactions/pickcoordinatesinteraction"),c=e("core/clipboardservice"),u=e("core/query/queryservice"),h={};h.STRING="string",h.INTEGER="integer",h.FLOAT="float",h.BOOLEAN="boolean",h.defaults={},h.defaults[h.STRING]="",h.defaults[h.INTEGER]=0,h.defaults[h.FLOAT]=0,h.simpleFieldTypes=[h.STRING,h.INTEGER,h.FLOAT],h.TEXTAREA="textarea",h.SELECT="select",h.RADIO="radio",h.CHECKBOX="checkbox",h.LAYERPICKER="layerpicker",h.IMAGE="image",h.specialInputs=[h.TEXTAREA,h.SELECT,h.RADIO,h.CHECKBOX,h.LAYERPICKER,h.IMAGE],r(n,a),t.exports=n},{"core/clipboardservice":20,"core/g3wobject":31,"core/query/queryservice":48,"core/utils/utils":51,"g3w-ol3/src/interactions/pickcoordinatesinteraction":60,"gui/gui":79}],77:[function(e,t,i){function n(e){var e=e||{};e.id=e.id||"form",this.vueComponent=e.vueComponentOptions||u,l(this,e);var t=e.service?new e.service:new a;this.setService(t);var i=e.template||c;this.setInternalComponentTemplate(i),this.setInternalComponent=function(){var e=Vue.extend(this.vueComponent);this.internalComponent=new e({formService:this.getService(),template:this.getInternalTemplate()}),this.internalComponent.state=this.getService().state},this.mount=function(e,t){var i=this;return l(this,"mount",e,t).then(function(){i.getService().setupFields(),i.getService().setupRelationsFields(),o.setModal(!0)})}}var r=e("core/utils/utils").inherit,o=e("gui/gui"),s=e("gui/vue/component"),a=e("gui/form/formservice"),l=e("core/utils/utils").base,c=e("./templateform.html");Vue.filter("startcase",function(e){return _.startCase(e)}),Vue.filter("lowerCase",function(e){return _.lowerCase(e)}),Vue.filter("relationplural",function(e){return e.plural?e.plural:_.startCase(e.name)}),Vue.validator("email",function(e){return/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)}),Vue.validator("integer",function(e){return/^(-?[1-9]\d*|0)$/.test(e)});var u={template:null,data:function(){return{state:this.$options.formService.state,tools:{copypaste:!1}}},components:{},transitions:{addremovetransition:"showhide"},methods:{exec:function(e){var t=this.state.relations||null;e(this.state.fields,t),this.state.editor.getPickedFeature()&&this.state.editor.cleanUpPickedFeature(),o.closeForm()},btnEnabled:function(e){return"save"!=e.type||"save"==e.type&&this.$validation.valid&&this.isValidForm()},hasFieldsRequired:function(){return this.$options.formService._hasFieldsRequired()},isEditable:function(e){return this.$options.formService._isEditable(e)},isSimple:function(e){return this.$options.formService._isSimple(e)},isTextarea:function(e){return this.$options.formService._isTextarea(e)},isSelectOptionsNull:function(e){return _.isNil(e)?"null":e},isSelect:function(e){return this.$options.formService._isSelect(e)},isRadio:function(e){return this.$options.formService._isRadio(e)},isCheckbox:function(e){return this.$options.formService._isCheckbox(e)},multiCheckBoxValue:function(e,t){t.value||(filed.value=[]),e.target.checked?t.push(e.target.value):_.remove(t,function(t){return t==e.target.value})},isLayerPicker:function(e){return this.$options.formService._isLayerPicker(e)},removeImage:function(e){e.value=null},isImage:function(e){return this.$options.formService._isImage(e)},layerPickerPlaceHolder:function(e){return this.$options.formService._getlayerPickerLayerName(e.input.options.layerid)},pickLayer:function(e,t){this.checkPickLayer(),this.$options.formService._pickLayer(e,t)},pickLayerInputFieldChange:function(e,t){this.$options.formService._pickLayerInputFieldChange(e,t)},pickLayerToClipBoard:function(){this.checkPickLayer(),this.$options.formService._pickLayerToClipBoard().then(function(){})},isValidForm:function(){var e=this,t=this.$options.formService._checkFieldsValidation(this.state.fields);return _.forEach(this.state.relations,function(i){_.forEach(i.elements,function(i){t=t&&e.$options.formService._checkFieldsValidation(i.fields)})}),t},pickLayerInputChange:function(){this.$options.formService._cleanUpPickLayer()},checkPickLayer:function(){this.$options.formService._pickInteraction&&this.$options.formService._cleanUpPickLayer()},isVisible:function(e){return this.$options.formService._isVisible(e)},visibleElements:function(e){return _.filter(e.elements,function(e){return"NEW_DELETED"!=e.state&&"OLD_DELETED"!=e.state})},showRelation:function(e){return this.$options.formService._shouldShowRelation(e)},relationPkFieldName:function(e){return e.pk},isRelationElementDeletable:function(e,t){if(t["new"])return!0;var i;return i="ONE"==e.type?1:Number.NEGATIVE_INFINITY,e.min&&(i=Math.min(i.relation.min)),i<e.elements.length},canAddRelationElements:function(e){var t=!0;if("ONE"==e.type)t=!e.elements.length;else{var i=e.max?e.max:Number.POSITIVE_INFINITY;t=e.elements.length<i}return t},addRelationElement:function(e){this.$options.formService._addRelationElement(e)},removeRelationElement:function(e,t){this.$options.formService._removeRelationElement(e,t)},fieldsSubset:function(e){var t=Math.min(3,e.length);return e.slice(0,t)},fieldsSubsetLength:function(e){return this.fieldsSubset(e).length},collapseElementBox:function(e,t){var i=this.getUniqueRelationElementId(e,t);if(this.state.elementsBoxes[i])return this.state.elementsBoxes[i].collapsed},toggleElementBox:function(e,t){var i=this.getUniqueRelationElementId(e,t);this.state.elementsBoxes[i].collapsed=!this.state.elementsBoxes[i].collapsed},getUniqueRelationElementId:function(e,t){return this.$options.formService.getUniqueRelationElementId(e,t)},pasteClipBoardToForm:function(){var e=this.$options.formService._getLayerFormFromId();this.$options.formService._pasteClipBoardToForm(e),this.$validate(),this.$validate(this.state.relations),this.$resetValidation()},copyToClipBoard:function(){this.$options.formService._copyFormToClipBoard()},onSelectChange:function(e,t){e.value=t.target.value},onFileChange:function(e,t){formData={};var i=this.$cookie.get("csrftoken");i&&(formData.csrfmiddlewaretoken=i),$(t.target).fileupload({dataType:"json",formData:formData,done:function(t,i){$.each(i.result,function(t,i){e.value=i.filename})}});var n=t.target.files||t.dataTransfer.files;!n.length},createImage:function(e,t){var i=new FileReader;i.onload=function(e){t.value=e.target.result},i.readAsDataURL(e)},checkFileSrc:function(e){var e=e;return _.isNil(e)&&(e=""),e}},computed:{isValid:function(e){return this.$validate(e.name)},hasRelations:function(){return this.state.relations.length}},ready:function(){var e=this;if(this.state.relationOne&&this.state.isnew){var t=this.$options.formService._getRelationsOne();_.forEach(t,function(t){t.elements.length||e.addRelationElement(t)})}$("input:file").filestyle({buttonText:" Foto",buttonName:"btn-primary",iconName:"glyphicon glyphicon-camera"}),this.$options.formService.postRender()}};r(n,s),t.exports=n},{"./templateform.html":78,"core/utils/utils":51,"gui/form/formservice":76,"gui/gui":79,"gui/vue/component":98}],78:[function(e,t,i){t.exports='<div>\n  <div class="quick-actions-menu">\n    <div v-if="state.tools.copypaste" class="pull-right">\n      <button v-if=\'state.isnew\' class="btn btn-default glyphicon glyphicon-screenshot" data-placement="bottom" @click="pickLayerToClipBoard"  data-i18n="[title]copy_form_data_from_feature"></button>\n      <button v-if=\'!state.isnew\' class="btn btn-default glyphicon glyphicon-copy" data-placement="bottom" @click="copyToClipBoard"  data-i18n="[title]copy_form_data"></button>\n      <button v-if=\'state.isnew\' class="btn btn-default glyphicon glyphicon-paste" data-placement="bottom" @click="pasteClipBoardToForm" v-disabled="!state.canpaste" data-i18n="[title]paste_form_data"></button>\n    </div>\n  </div>\n  <div style="height:100%; overflow:auto">\n    <validator name="validation">\n      <form novalidate class="form-horizontal g3w-form">\n        <div class="box box-primary">\n          <div class="box-header with-border">\n            <h3 class="box-title">Attributi elemento</h3>\n            <div class="box-tools pull-right">\n            </div>\n          </div>\n          <div class="box-body">\n            <template v-for="field in state.fields">\n              <div v-if="isVisible(field)" class="form-group has-feedback">\n                <label :for="field.name" class="col-sm-4 control-label">{{ field.label }}<span v-if="field.validate && field.validate.required">*</span></label>\n                <div class="col-sm-8">\n                  <input v-if="isSimple(field)" @focus="checkPickLayer" :field="field.name" v-validate="field.validate" v-disabled="!isEditable(field)" class="form-control" v-model="field.value" :id="field.name" :placeholder="field.input.label">\n                  <textarea v-if="isTextarea(field)" @focus="checkPickLayer" :field="field.name" v-validate="field.validate" v-disabled="!isEditable(field)" class="form-control" v-model="field.value" :id="field.name" :placeholder="field.input.label">\n                  </textarea>\n                  <select v-if="isSelect(field)" @focus="checkPickLayer" :field="field.name" v-validate="field.validate" v-disabled="!isEditable(field)" class="form-control" @change="onSelectChange(field, $event)" :value="isSelectOptionsNull(field.value)" :id="field.name" :placeholder="field.input.label">\n                    <option v-for="value in field.input.options.values"  :value="isSelectOptionsNull(value.key)" >{{ value.value }}</option>\n                  </select>\n                  <div v-if="isLayerPicker(field)">\n                    <input class="form-control picklayerinput" @click="pickLayer(field)" @change="pickLayerInputChange" :field="field.name" v-validate="field.validate" data-toggle="tooltip" title="Ottieni il dato da un elemento del layer \'{{ layerPickerPlaceHolder(field) }}\' o scrivilo direttamente qui" v-disabled="!isEditable(field)" v-model="field.value" :id="field.name" :placeholder="\'[\'+layerPickerPlaceHolder(field)+\']\'">\n                    <i class="glyphicon glyphicon-screenshot form-control-feedback" ></i>\n                  </div>\n                  <div v-if="isRadio(field)">\n                    <template v-for="(index, value) in field.input.options.values">\n                      <input class="magic-radio" type="radio" value="{{ value.value }}" v-model="field.value" :field="field.name" v-validate="field.validate" v-disabled="!isEditable(field)" :id="field.name + value.value" :placeholder="{{ value.key }}">\n                      <label for="{{ field.name }}{{ value.value }}">{{ value.key }}</label>\n                    </template>\n                  </div>\n                  <div v-if="isImage(field)">\n                    <i v-if="checkFileSrc(field.value)" class="glyphicon glyphicon glyphicon-trash pull-right link trash" @click="removeImage(field)"></i>\n                    <img v-if="checkFileSrc(field.value)" class="photo-preview img-responsive img-thumbnail"  :src="field.value" />\n                    <input type="file" :name="field.name" data-url="{{ field.uploadurl }}" :field="field.name" title="Foto" accept="image/*;capture=camera" class="filestyle" @change="onFileChange(field, $event)">\n                  </div>\n                </div>\n              </div>\n            </template>\n          </div>\n        </div>\n        <div v-for="relation in state.relations" style="margin-top:10px">\n          <div v-if="showRelation(relation)" transition="expand">\n            <div class="box box-default">\n              <div class="box-header with-border">\n                <h3 class="box-title">{{ relation | relationplural }}</h3>\n              </div>\n              <div class="box-body">\n                <table v-if="relation.elements.length" class="table table-striped">\n                  <thead>\n                  <tr>\n                    <th v-for="field in fieldsSubset(relation.fields)">{{field.label}}</th>\n                  </tr>\n                  </thead>\n                  <tbody>\n                  <template v-for="element in visibleElements(relation)">\n                    <tr class="attributes-preview" @click="toggleElementBox(relation, element)">\n                      <td v-for="relfield in fieldsSubset(element.fields)">\n                        <span>{{relfield.value}}</span>\n                      </td>\n                      <td>\n                        <i v-if="isRelationElementDeletable(relation,element)" class="glyphicon glyphicon glyphicon-trash link trash" @click.stop.prevent="removeRelationElement(relation,element)"></i>\n                        <i class="glyphicon glyphicon-option-horizontal link morelink"></i>\n                      </td>\n                    </tr>\n                    <tr v-show="!collapseElementBox(relation,element)" class="queryresults-featurebox">\n                      <td :colspan="fieldsSubsetLength(element.fields)+1">\n                        <template v-for="(idxF, field) in element.fields">\n                          <div v-if="isVisible(field)" class="form-group has-feedback">\n                            <label :for="field.name" class="col-sm-4 control-label">{{ field.label }}<span v-if="field.validate && field.validate.required">*</span></label>\n                            <div class="col-sm-8">\n                              <input v-if="isSimple(field)" @focus="checkPickLayer" :field="field.name" v-validate="field.validate" v-disabled="!isEditable(field)" class="form-control" v-model="field.value" :id="field.name" :placeholder="field.input.label">\n                              <textarea v-if="isTextarea(field)" @focus="checkPickLayer" :field="field.name" v-validate="field.validate" v-disabled="!isEditable(field)" class="form-control" v-model="field.value" :id="field.name" :placeholder="field.input.label"></textarea>\n                              <select v-if="isSelect(field)" @focus="checkPickLayer" :field="field.name" v-validate="field.validate" v-disabled="!isEditable(field)" class="form-control"  :id="field.name" :placeholder="field.input.label">\n                                <option v-for="value in field.input.options.values" :value="isSelectOptionsNull(value.key)">{{ value.value }}</option>\n                              </select>\n                              <div v-if="isRadio(field)">\n                                <template v-for="(index, value) in field.input.options.values">\n                                  <input class="magic-radio" type="radio" value="{{ value.value }}" v-model="field.value" :field="field.name" v-validate="field.validate" v-disabled="!isEditable(field)" :id="field.name + value.value" :placeholder="{{ value.key }}">\n                                  <label for="{{ field.name }}{{ value.value }}">{{ value.key }} </label>\n                                </template>\n                              </div>\n                              <div v-if="isCheckBox(field)">\n                                <template v-for="(index, value) in field.input.options.values">\n                                  <label for="{{ field.name }}{{ value.value }}">{{ value.key }} </label>\n                                  <input type="radio" value="{{ value.value }}" v-model="field.value" :field="field.name" v-validate="field.validate" v-disabled="!isEditable(field)" :id="field.name + value.value" :placeholder="{{ value.key }}">\n                                </template>\n                              </div>\n                              <div v-if="isLayerPicker(field)">\n                                <input class="form-control picklayerinput" @click="pickLayer(field, relation)" @input="pickLayerInputFieldChange(field, relation)"  :field="field.name" v-validate="field.validate" data-toggle="tooltip" title="Ottieni il dato da un elemento del layer \'{{ layerPickerPlaceHolder(field) }}\' o scrivilo direttamente qui" v-disabled="!isEditable(field)" v-model="field.value" :id="field.name" :placeholder="\'[\'+layerPickerPlaceHolder(field)+\']\'">\n                                <i class="glyphicon glyphicon-screenshot form-control-feedback" ></i>\n                              </div>\n                            </div>\n                          </div>\n                        </template>\n                      </td>\n                    </tr>\n                  </template>\n                  </tbody>\n                </table>\n                <div v-if="canAddRelationElements(relation)" class="row" style="margin:0px"><i class="glyphicon glyphicon-plus-sign pull-right btn-add" @click="addRelationElement(relation)"></i></div>\n              </div>\n            </div>\n          </div>\n        </div>\n        <div class="form-group">\n          <div class="col-sm-offset-4 col-sm-8">\n            <div v-if="hasFieldsRequired" style="margin-bottom:10px">\n              <span>* Campi richiesti</span>\n            </div>\n            <span v-for="button in state.buttons">\n              <button class="btn " :class="[button.class]" @click.stop.prevent="exec(button.cbk)" v-disabled="!btnEnabled(button)">{{ button.title }}</button>\n            </span>\n          </div>\n        </div>\n      </form>\n    </validator>\n  </div>\n</div>';
},{}],79:[function(e,t,i){function n(){this.ready=!1,this.getResourcesUrl=r,this.showForm=r,this.closeForm=r,this.showListing=r,this.closeListing=r,this.hideListing=r,this.showQueryResults=function(e){},this.hideQueryResults=r,this.showPanel=r,this.hidePanel=r,this.addComponent=function(e,t){},this.removeComponent=function(e){},this.setComponent=function(e){l.registerComponent(e)},this.getComponent=function(e){return l.getComponent(e)},this["goto"]=function(e){a["goto"](e)},this.ready=function(){this.emit("ready"),this.ready=!0},this.guiResized=function(){this.emit("guiresized")},n.showSpinner=function(e){},n.hideSpinner=function(e){},this.notify=r,this.dialog=r}var r=e("core/utils/utils").noop,o=e("core/utils/utils").inherit,s=e("core/g3wobject"),a=e("core/router"),l=e("gui/componentsregistry");o(n,s),t.exports=new n},{"core/g3wobject":31,"core/router":49,"core/utils/utils":51,"gui/componentsregistry":72}],80:[function(e,t,i){t.exports="<div>\n  Lista di oggetti\n</div>\n"},{}],81:[function(e,t,i){function n(e){this.panelComponent=null,this.options=e||{},this.id=e.id||null,this.name=e.name||null,this.state={list:e.list||[]},this._listPanelComponent=e.listPanelComponent||s}var r=e("core/utils/utils").resolve,o=(e("core/utils/utils").reject,e("gui/gui")),s=Vue.extend({template:e("./listpanel.html"),methods:{exec:function(e){var t=this.state.relations||null;e(this.state.fields,t),o.closeForm()}}}),a=n.prototype;a.onShow=function(e){var t=this._setupPanel();return this._mountPanel(t,e),r(!0)},a.onClose=function(){return this.panelComponent.$destroy(!0),this.panelComponent=null,r(!0)},a._setupPanel=function(){var e=this.panelComponent=new this._listPanelComponent({panel:this});return e.state=this.state,e},a._mountPanel=function(e,t){e.$mount().$appendTo(t)},t.exports={ListPanelComponent:s,ListPanel:n}},{"./listpanel.html":80,"core/utils/utils":51,"gui/gui":79}],82:[function(e,t,i){var n=e("g3w-ol3/src/controls/resetcontrol"),r=e("g3w-ol3/src/controls/querycontrol"),o=e("g3w-ol3/src/controls/zoomboxcontrol"),s=e("g3w-ol3/src/controls/olcontrol"),a={create:function(e){var t,i=a.CONTROLS[e.type];return i&&(t=new i(e)),t}};a.CONTROLS={reset:n,zoombox:o,zoomtoextent:s,query:r,zoom:s,scaleline:s,overview:s},t.exports=a},{"g3w-ol3/src/controls/olcontrol":54,"g3w-ol3/src/controls/querycontrol":55,"g3w-ol3/src/controls/resetcontrol":56,"g3w-ol3/src/controls/zoomboxcontrol":57}],83:[function(e,t,i){function n(e){var t=this;this.viewer,this.target,this._mapControls=[],this._mapLayers=[],this.mapBaseLayers={},this.layersExtraParams={},this.state={bbox:[],resolution:null,center:null,loading:!1,hidden:!0},this._interactionsStack=[],this._greyListenerKey=null,this.config=e.config||l.getConfig(),this._howManyAreLoading=0,this._incrementLoaders=function(){0==this._howManyAreLoading&&(this.emit("loadstart"),a.showSpinner({container:$("#map-spinner"),id:"maploadspinner",style:"blue"})),this._howManyAreLoading+=1},this._decrementLoaders=function(){this._howManyAreLoading-=1,0==this._howManyAreLoading&&(this.emit("loadend"),a.hideSpinner("maploadspinner"))},this.project,_.isNil(e.project)?(this.project=c.getCurrentProject(),c.onafter("setCurrentProject",function(e){t.project=e,t.setupLayers()})):this.project=e.project,this.setters={setMapView:function(e,t,i){this.state.bbox=e,this.state.resolution=t,this.state.center=i,this.updateMapLayers(this._mapLayers)},setHidden:function(e){this.state.hidden=e},setupViewer:function(e,i){0!=e&&0!=i&&(proj4.defs("EPSG:"+t.project.state.crs,this.project.state.proj4),t.viewer&&(t.viewer.destroy(),t.viewer=null),t._setupViewer(e,i),t.state.bbox=this.viewer.getBBOX(),t.state.resolution=this.viewer.getResolution(),t.state.center=this.viewer.getCenter(),t.setupControls(),t.setupLayers(),t.emit("viewerset"))}},this._setupViewer=function(e,t){var i=this,n=this.getProjection(),r=this.project.state.initextent,o=this.project.state.extent,s=ol.extent.getWidth(o)/e,a=ol.extent.getHeight(o)/t,l=Math.max(s,a),c=ol.extent.getWidth(r)/e,u=ol.extent.getHeight(r)/t,d=Math.max(c,u);this.viewer=h.createViewer({id:this.target,view:{projection:n,center:ol.extent.getCenter(r),extent:o,maxResolution:l}}),this.config.background_color&&$("#"+this.target).css("background-color",this.config.background_color),$(this.viewer.map.getViewport()).prepend('<div id="map-spinner" style="position:absolute;right:0px;"></div>'),this.viewer.map.getInteractions().forEach(function(e){i._watchInteraction(e)}),this.viewer.map.getInteractions().on("add",function(e){i._watchInteraction(e.element)}),this.viewer.map.getInteractions().on("remove",function(e){}),this.viewer.map.getView().setResolution(d),this.viewer.map.on("moveend",function(e){i._setMapView()}),p.setMapService(this),this.emit("ready")},this.project.onafter("setLayersVisible",function(e){_.map(e,function(e){var i=t.project.getLayerById(e);return t.getMapLayerForLayer(i)});t.updateMapLayers(t.getMapLayers())}),this.project.onafter("setBaseLayer",function(){t.updateMapLayers(t.mapBaseLayers)}),o(this)}var r=e("core/utils/utils").inherit,o=e("core/utils/utils").base,s=e("core/g3wobject"),a=e("gui/gui"),l=e("core/applicationservice"),c=e("core/project/projectsregistry"),u=e("core/project/projectlayer"),h=e("g3w-ol3/src/g3w.ol3").helpers,d=e("core/map/layer/wmslayer"),f=e("gui/map/control/factory"),p=e("core/query/queryservice");r(n,s);var g=n.prototype;g.slaveOf=function(e,t){},g.setLayersExtraParams=function(e,t){this.layersExtraParams=_.assign(this.layersExtraParams,e),this.emit("extraParamsSet",e,t)},g.getProject=function(){return this.project},g.getMap=function(){return this.viewer.map},g.getProjection=function(){var e=this.project.state.extent,t=new ol.proj.Projection({code:"EPSG:"+this.project.state.crs,extent:e});return t},g.getViewerElement=function(){return this.viewer.map.getTargetElement()},g.getViewport=function(){return this.viewer.map.getViewport()},g.getResolution=function(){return this.viewer.map.getView().getResolution()},g.getEpsg=function(){return this.viewer.map.getView().getProjection().getCode()},g.getGetFeatureInfoUrlForLayer=function(e,t,i,n,r){var o=this.getMapLayerForLayer(e);return o.getGetFeatureInfoUrl(t,i,n,r)},g.setupControls=function(){var e=this;e.viewer.map;this.config&&this.config.mapcontrols&&_.forEach(this.config.mapcontrols,function(t){var i;switch(t){case"reset":isMobile.any||(i=f.create({type:t})),e.addControl(t,i);break;case"zoom":i=f.create({type:t,zoomInLabel:"î¦",zoomOutLabel:"î¦"}),e.addControl(t,i);break;case"zoombox":isMobile.any||(i=f.create({type:t}),i.on("zoomend",function(t){e.viewer.fit(t.extent)}),e.addControl(t,i));break;case"zoomtoextent":isMobile.any||(i=f.create({type:t,label:"î¦",extent:e.project.state.initextent}),e.addControl(t,i));break;case"query":i=f.create({type:t}),i.on("picked",function(t){var i=t.coordinates,n=a.showContentFactory("query"),r=e.project.getLayers({QUERYABLE:!0,SELECTEDORALL:!0}),o=n("interrogazione");p.queryByLocation(i,r).then(function(t){o.setQueryResponse(t,i,e.state.resolution)})}),e.addControl(t,i);break;case"scaleline":i=f.create({type:t,position:"br"}),e.addControl(t,i);break;case"overview":if(!isMobile.any){var n=e.project.getOverviewProjectGid();n&&c.getProject(n).then(function(n){var r=e.getOverviewMapLayers(n);i=f.create({type:t,position:"bl",className:"ol-overviewmap ol-custom-overviewmap",collapseLabel:$('<span class="glyphicon glyphicon-menu-left"></span>')[0],label:$('<span class="glyphicon glyphicon-menu-right"></span>')[0],collapsed:!1,layers:r,view:new ol.View({projection:e.getProjection()})}),e.addControl(t,i)})}}})},g.addControl=function(e,t){this.viewer.map.addControl(t),this._mapControls.push({type:e,control:t,visible:!0})},g.showControl=function(e){this.showControls([e])},g.hideControl=function(e){this.hideControls([e])},g.showControls=function(e){this.toggleControls(!0,e)},g.hideControls=function(e){this.toggleControls(!1,e)},g.showAllControls=function(){this.toggleControls(!0)},g.hideAllControls=function(){this.toggleControls(!1)},g.toggleControls=function(e,t){this._removeControls(),_.forEach(this._mapControls,function(i){t?t.indexOf(i.type)>-1&&(i.visible=e):i.visible=e}),this._layoutControls()},g._layoutControls=function(){var e=this;_.forEach(this._mapControls,function(t){t.visible&&e.viewer.map.addControl(t.control)})},g._removeControls=function(){var e=this;_.forEach(this._mapControls,function(t){e.viewer.map.removeControl(t.control)})},g._unToggleControls=function(){_.forEach(this._mapControls,function(e){e.control.toggle&&e.control.toggle(!1)})},g.addMapLayer=function(e){this._mapLayers.push(e)},g.getMapLayers=function(){return this._mapLayers},g.getMapLayerForLayer=function(e){var t,i="layer_"+e.state.multilayer;return _.forEach(this.getMapLayers(),function(e){e.getId()==i&&(t=e)}),t},g.setupBaseLayers=function(){var e=this;if(this.project.state.baselayers){this.mapBaseLayers={};var t=(this.project.state.baselayers,this.project.state.baselayers);_.forEach(t,function(t){var i=new u(t);i.setProject(this);var n={url:e.project.getWmsUrl(),id:i.state.id,tiled:i.state.tiled},r=new d(n);e.addMapLayer(r),e.registerListeners(r),r.addLayer(i),e.mapBaseLayers[i.state.id]=r}),_.forEach(_.values(this.mapBaseLayers).reverse(),function(t){e.viewer.map.addLayer(t.getOLLayer()),t.update(e.state)})}},g.setupLayers=function(){var e=this;this.viewer.removeLayers(),this.setupBaseLayers(),this._reset();var t=this.project.getLayers(),i=_.groupBy(t,function(e){return e.state.multilayer});return _.forEach(i,function(t,i){var n="layer_"+i,r=t[0].state.tiled,o={url:e.project.getWmsUrl(),id:n,tiled:r},s=new d(o,e.layersExtraParams);e.addMapLayer(s),e.registerListeners(s),_.forEach(t.reverse(),function(e){s.addLayer(e)})}),_.forEach(this.getMapLayers().reverse(),function(t){e.viewer.map.addLayer(t.getOLLayer()),t.update(e.state,e.layersExtraParams)}),this.mapLayers},g.getOverviewMapLayers=function(e){var t=e.getLayers({VISIBLE:!0}),i=_.groupBy(t,function(e){return e.state.multilayer}),n=[];return _.forEach(i,function(t,i){var r="overview_layer_"+i,o=t[0].state.tiled,s={url:e.getWmsUrl(),id:r,tiled:o},a=new d(s);_.forEach(t.reverse(),function(e){a.addLayer(e)}),n.push(a.getOLLayer(!0))}),n.reverse()},g.updateMapLayers=function(e){var t=this;_.forEach(e,function(e){e.update(t.state,t.layersExtraParams)})},g.registerListeners=function(e){var t=this;e.on("loadstart",function(){t._incrementLoaders()}),e.on("loadend",function(){t._decrementLoaders(!1)}),this.on("extraParamsSet",function(t,i){i&&e.update(this.state,t)})},g.setTarget=function(e){this.target=e},g.addInteraction=function(e){this._unToggleControls(),this.viewer.map.addInteraction(e),e.setActive(!0)},g.removeInteraction=function(e){this.viewer.map.removeInteraction(e)},g._watchInteraction=function(e){var t=this;e.on("change:active",function(e){e.target instanceof ol.interaction.Pointer&&e.target.getActive()&&t.emit("pointerInteractionSet",e.target)})},g.goTo=function(e,t){var t=t||6;this.viewer.goTo(e,t)},g.goToWGS84=function(e,t){var e=ol.proj.transform(e,"EPSG:4326","EPSG:"+this.project.state.crs);this.goTo(e,t)},g.extentToWGS84=function(e){return ol.proj.transformExtent(e,"EPSG:"+this.project.state.crs,"EPSG:4326")},g.getResolutionForMeters=function(e){var t=this.viewer.map.getViewport();return e/Math.max(t.clientWidth,t.clientHeight)};var v=null,m=!1;g.highlightGeometry=function(e,t){var i,t=t||{},n="boolean"!=typeof t.zoom||t.zoom,r=t.duration;this.viewer.map.getView();if(e instanceof ol.geom.Geometry)i=e;else{var o=new ol.format.GeoJSON;i=o.readGeometry(e)}t.fromWGS84&&i.transform("EPSG:4326","EPSG:"+ProjectService.state.project.crs);var s=i.getType();if(n)if("Point"==s||"MultiPoint"==s&&1==i.getPoints().length){var a="Point"==s?i.getCoordinates():i.getPoint(0).getCoordinates();if(4326!=this.project.state.crs&&3857!=this.project.state.crs){var l=this.getResolutionForMeters(100);this.viewer.goToRes(a,l)}else this.viewer.goTo(a,6)}else this.viewer.fit(i,t);var c=new ol.Feature({geometry:i});v||(v=new ol.layer.Vector({source:new ol.source.Vector,style:function(e){var t=[],i=e.getGeometry().getType();if("LineString"==i){var n=new ol.style.Style({stroke:new ol.style.Stroke({color:"rgb(255,255,0)",width:4})});t.push(n)}else if("Point"==i||"MultiPoint"==i){var n=new ol.style.Style({image:new ol.style.Circle({radius:6,fill:new ol.style.Fill({color:"rgb(255,255,0)"})}),zIndex:1/0});t.push(n)}else if("MultiPolygon"==i||"Polygon"==i){var n=new ol.style.Style({stroke:new ol.style.Stroke({color:"rgb(255,255,0)",width:4}),fill:new ol.style.Fill({color:"rgba(255, 255, 0, 0.5)"})});t.push(n)}return t}}),v.setMap(this.viewer.map)),v.getSource().clear(),v.getSource().addFeature(c),r&&(m=!0,setTimeout(function(){v.getSource().clear(),m=!1},r))},g.clearHighlightGeometry=function(){v&&!m&&v.getSource().clear()},g.refreshMap=function(){_.forEach(this._mapLayers,function(e){e.getOLLayer().getSource().updateParams({time:Date.now()})})},g.layout=function(e,t){this.viewer||this.setupViewer(e,t),this.viewer&&(this.setHidden(0==e||0==t),this.getMap().updateSize(),this._setMapView())},g._reset=function(){this._mapLayers=[]},g._setMapView=function(){var e=this.viewer.getBBOX(),t=this.viewer.getResolution(),i=this.viewer.getCenter();this.setMapView(e,t,i)},g.startDrawGreyCover=function(e){var t=this.viewer.map;this._greyListenerKey?this.stopDrawGreyCover():(this._greyListenerKey=t.on("postcompose",function(t){var i=t.context,n=this.getSize(),r=n[1]*ol.has.DEVICE_PIXEL_RATIO,o=n[0]*ol.has.DEVICE_PIXEL_RATIO;if(i.beginPath(),i.moveTo(0,0),i.lineTo(o,0),i.lineTo(o,r),i.lineTo(0,r),i.lineTo(0,0),i.closePath(),e){var s=e[0],a=e[1],l=e[2],c=e[3];i.moveTo(s,a),i.lineTo(s,c),i.lineTo(l,c),i.lineTo(l,a),i.lineTo(s,a),i.closePath()}i.fillStyle="rgba(0, 5, 25, 0.55)",i.fill(),i.restore()}),t.render())},g.stopDrawGreyCover=function(){var e=this.viewer.map;e.unByKey(this._greyListenerKey),this._greyListenerKey=null,e.render()},t.exports=n},{"core/applicationservice":19,"core/g3wobject":31,"core/map/layer/wmslayer":39,"core/project/projectlayer":44,"core/project/projectsregistry":45,"core/query/queryservice":48,"core/utils/utils":51,"g3w-ol3/src/g3w.ol3":58,"gui/gui":79,"gui/map/control/factory":82}],84:[function(e,t,i){t.exports='<div :id="target" style="width:100%;height:100%"></div>\n'},{}],85:[function(e,t,i){function n(e){o(this,e),this.id="map-component",this.title="Catalogo dati",this.target=e.target||"map",this._service=new l(e),s(this,e),this.internalComponent=new u({mapService:this._service}),this.internalComponent.target=this.target}var r=e("core/utils/utils").inherit,o=e("core/utils/utils").base,s=e("core/utils/utils").merge,a=(e("core/i18n/i18n.service").t,e("core/utils/utils").resolve,e("gui/gui"),e("gui/vue/component")),l=(e("core/router"),e("g3w-ol3/src/g3w.ol3").helpers,e("core/map/mapsregistry"),e("../mapservice")),c={template:e("./map.html"),data:function(){return{target:"map"}},ready:function(){var e=this,t=this.$options.mapService;t.setTarget(this.$el.id),t.onafter("setupViewer",function(){t.setTarget(e.$el.id)})}},u=Vue.extend(c);Vue.component("g3w-map",c),r(n,a);var h=n.prototype;h.layout=function(e,t){$("#"+this.target).height(t),$("#"+this.target).width(e),this._service.layout(e,t)},t.exports=n},{"../mapservice":83,"./map.html":84,"core/i18n/i18n.service":34,"core/map/mapsregistry":40,"core/router":49,"core/utils/utils":51,"g3w-ol3/src/g3w.ol3":58,"gui/gui":79,"gui/vue/component":98}],86:[function(e,t,i){var n=e("core/utils/utils").inherit,r=e("core/utils/utils").resolve,o=e("core/g3wobject"),s=function(e){this.internalPanel=null;var e=e||{};this.id=e.id||null,this.title=e.title||""};n(s,o);var a=s.prototype;a.getId=function(){return this.id},a.getTitle=function(){return this.title},a.mount=function(e){var t=this.internalPanel;return t.$mount().$appendTo(e),$(e).localize(),t.onShow&&t.onShow(),r(!0)},a.unmount=function(){var e=this.internalPanel,t=$.Deferred();return e.$destroy(!0),t.resolve(),e.onClose&&e.onClose(),t.promise()},a.onResize=function(e,t){},t.exports=s},{"core/g3wobject":31,"core/utils/utils":51}],87:[function(e,t,i){function n(){var e=this;this._actions={zoomto:n.zoomToElement,highlightgeometry:n.highlightGeometry,clearHighlightGeometry:n.clearHighlightGeometry},this.state=null,this.init=function(e){this.clearState()},this.setters={setQueryResponse:function(e,t,i){this.state.layers=[],this.state.query=e.query;var n=this._digestFeaturesForLayers(e.data);this.setLayersData(n,this)},setLayersData:function(e,t){this.state.loading=!1,this.state.layers=e,this.setActionsForLayers(e)},addActionsForLayers:function(e){},postRender:function(e){}},this.clearState=function(){this.state={layers:[],query:{},querytitle:"",loading:!0,layersactions:{}}},this.getState=function(){return this.state},this.setState=function(e){this.state=e},this.setTitle=function(e){this.state.querytitle=e||""},this.reset=function(){this.clearState()},this._digestFeaturesForLayers=function(e){var t=this,i=0,n=[];return _.forEach(e,function(e){var r=e.layer;if(e.features.length){var o={title:r.state.title,id:r.state.id,attributes:t._parseAttributes(r.getAttributes(),e.features[0].getProperties()),features:[],hasgeometry:!1,show:!0,expandable:!0};_.forEach(e.features,function(e){var t=e.getId()?e.getId():i,n=e.getGeometry();n&&(o.hasgeometry=!0);var r={id:t,attributes:e.getProperties(),geometry:e.getGeometry(),show:!0};o.features.push(r),i+=1}),n.push(o)}}),n},this._parseAttributes=function(e,t){var i=_.keys(t);if(i=_.filter(i,function(e){return["boundedBy","geom","the_geom","geometry","bbox"].indexOf(e)==-1}),e&&e.length){var i=_.keys(t);return _.filter(e,function(e){return i.indexOf(e.name)>-1})}return _.map(i,function(e){return{name:e,label:e}})},this.setActionsForLayers=function(t){_.forEach(t,function(t){e.state.layersactions[t.id]||(e.state.layersactions[t.id]=[]),t.hasgeometry&&e.state.layersactions[t.id].push({id:"gotogeometry","class":"glyphicon glyphicon-map-marker",hint:"Visualizza sulla mappa",cbk:n.goToGeometry})}),this.addActionsForLayers(e.state.layersactions)},this.trigger=function(t,i,n){var r=this._actions[t];if(r&&r(i,n),i){var o=e.state.layersactions[i.id];if(o){var s;_.forEach(o,function(e){e.id==t&&(s=e)}),s&&this.triggerLayerAction(s,i,n)}}},this.triggerLayerAction=function(e,t,i){if(e.cbk&&e.cbk(t,i),e.route){var n,r=e.route;n=r.replace(/{(\w*)}/g,function(e,t){return i.attributes.hasOwnProperty(t)?i.attributes[t]:""}),n&&""!=n&&s["goto"](n)}},o(this)}var r=e("core/utils/utils").inherit,o=e("core/utils/utils").base,s=e("gui/gui"),a=e("core/g3wobject"),l=e("gui/componentsregistry");n.zoomToElement=function(e,t){},n.goToGeometry=function(e,t){if(t.geometry){var i=l.getComponent("map").getService();i.highlightGeometry(t.geometry,{duration:4e3})}},n.highlightGeometry=function(e,t){if(t.geometry){var i=l.getComponent("map").getService();i.highlightGeometry(t.geometry,{zoom:!1})}},n.clearHighlightGeometry=function(e,t){var i=l.getComponent("map").getService();i.clearHighlightGeometry()},r(n,a),t.exports=n},{"core/g3wobject":31,"core/utils/utils":51,"gui/componentsregistry":72,"gui/gui":79}],88:[function(e,t,i){t.exports='<div id="search-results" class="queryresults-wrapper">\n  <h3 v-if="state.querytitle">Risultati {{state.querytitle | lowercase}}</h3>\n  <div v-show="state.loading" class="bar-loader"></div>\n  <div class="queryresults-container">\n    <ul v-if="hasResults()" class="queryresults" id="queryresults">\n      <li v-if="layerHasFeatures(layer) && layer.show" v-for="layer in state.layers">\n        <div class="box box-primary">\n          <div class="box-header with-border" data-widget="collapse">\n            <h3 class="box-title">{{ layer.title }} ({{layer.features.length}})</h3>\n            <div class="box-tools pull-right">\n              <button class="btn btn-box-tool" data-widget="collapse"><i class="btn-collapser fa fa-minus"></i></button>\n            </div>\n          </div>\n          <div class="box-body">\n            <table class="table table-striped">\n              <thead>\n              <tr>\n                <th v-if="layer.hasgeometry" :style="{ width:headerZoomActionCellWidth + \'%\' }"></th>\n                <th v-for="(index,attribute) in attributesSubset(layer.attributes)" :style="{ width:cellWidth(index,layer) + \'%\' }">{{attribute.label}}</th>\n                <th :style="{ width:headerExpandActionCellWidth + \'%\' }"></th>\n              </tr>\n              </thead>\n              <tbody>\n              <template v-if="feature.show" v-for="feature in layer.features">\n                <tr @click="toggleFeatureBoxAndZoom(layer,feature);" @mouseover="trigger(\'highlightgeometry\',layer,feature)" @mouseout="trigger(\'clearHighlightGeometry\')" class="featurebox-header">\n                  <td v-if="geometryAvailable(feature)" class="action-cell">\n                    <span @click.stop.prevent="trigger(\'gotogeometry\',layer,feature)" class="action-button-icon glyphicon glyphicon-map-marker link"></span>\n                  </td>\n                  <td v-for="attribute in attributesSubset(layer.attributes)">\n                    <span>{{feature.attributes[attribute.name]}}</span>\n                  </td>\n                  <td class="action-cell">\n                    <span v-if="layer.expandable" class="fa link morelink" :class="[collapsedFeatureBox(layer,feature) ? \'fa-plus\' : \'fa-minus\']"></span>\n                  </td>\n                </tr>\n                <tr v-show="!collapsedFeatureBox(layer,feature) && layer.expandable" class="featurebox-body">\n                  <td :colspan="attributesSubsetLength(layer.attributes)+2">\n                    <div class="action-buttons-container">\n                      <template v-for="action in state.layersactions[layer.id]">\n                        <div @click="trigger(action.id,layer,feature)"  class="action-button hint--top-right" aria-label="{{ action.hint }}">\n                          <span class="action-button-icon {{ action.class }}"></span>\n                        </div>\n                      </template>\n                    </div>\n                    <table>\n                      <tr v-for="attribute in layer.attributes">\n                        <td class="attr-label">{{attribute.label}}</td>\n                        <!--<td class="attr-value">{{feature.attributes[attribute.name]}}</td>-->\n                        <td class="attr-value">\n                          <span v-if="is(\'simple\',layer,attribute.name,feature.attributes[attribute.name])">{{feature.attributes[attribute.name]}}</span>\n                          <!--<span v-if="isRoute(layer,feature,attribute)" class="link dashboardlink" @click="goto(layer,feature.attributes[attribute.name])">{{ feature.attributes[attribute.name] }}</span>-->\n                          <!--<img v-if="isPhoto(layer,feature,attribute)" data-url="{{getPhotoUrl(feature.attributes[attribute.name])}}" style="max-width:50px" :src="getPhotoUrl(feature.attributes[attribute.name],thumb)" />-->\n                          <img v-if="is(\'photo\',layer,attribute.name,feature.attributes[attribute.name])" :src="feature.attributes[attribute.name]">\n                          <a v-if="is(\'link\',layer,attribute.name,feature.attributes[attribute.name])" :href="feature.attributes[attribute.name]" target="_blank" class="glyphicon glyphicon-link"></a>\n                        </td>\n                      </tr>\n                    </table>\n                  </td>\n                </tr>\n                <tr v-show="collapsedFeatureBox(layer,feature) && feature.attributes.relations">\n                  <td :colspan="attributesSubsetLength(layer.attributes)+2">\n                    <!--Relazioni-->\n                    <div class="queryresults-container">\n                      <ul class="queryresults" id="relations">\n                        <template v-for="relation in feature.attributes.relations">\n                          <li>\n                            <div class="box box-solid box-default relationsbox collapsed-box">\n                              <div class="box-header with-border" data-widget="collapse">\n                                <h3 class="box-title">{{ relation.name }} ({{ relation.elements.length }})</h3>\n                                <div class="box-tools pull-right">\n                                  <button class="btn btn-box-tool" data-widget="collapse"><i class="btn-collapser fa fa-plus"></i></button>\n                                </div>\n                              </div>\n                              <div class="box-body">\n                                <template v-for="(index, element) in relation.elements">\n                                  <table class="table table-striped">\n                                    <thead>\n                                    <tr>\n                                      <th v-for="attribute in relationsAttributesSubset(element)">\n                                        {{attribute.label}}\n                                      </th>\n                                      <th></th>\n                                    </tr>\n                                    </thead>\n                                    <tbody>\n                                    <tr @click="toggleFeatureBox(layer, feature, relation.name+index)"  class="featurebox-header">\n                                      <td v-for="attribute in relationsAttributesSubset(element)">\n                                        <span>{{attribute.value}}</span>\n                                      </td>\n                                      <td class="action-cell text-center">\n                                        <span class="fa link morelink" :class="[collapsedFeatureBox(layer, feature, relation.name+index) ? \'fa-minus\' : \'fa-plus\']" style="text-align: right"></span>\n                                      </td>\n                                    </tr>\n                                    <tr v-show="collapsedFeatureBox(layer, feature, relation.name+index)" class="featurebox-body">\n                                      <td :colspan="relationsAttributesSubsetLength(element)+1">\n                                        <table>\n                                          <tr v-for="relattribute in relationsAttributes(element)">\n                                            <td class="attr-label">{{relattribute.label}}</td>\n                                            <!--<td class="attr-value">{{attribute.value}}</td>-->\n                                            <td class="attr-value">\n                                              <span v-if="isSimple(layer,relattribute.name,relattribute.value)">{{relattribute.value}}</span>\n                                              <!--<span v-if="isRoute(layer,feature,attribute)" class="link dashboardlink" @click="goto(layer,feature.attributes[attribute.name])">{{ feature.attributes[attribute.name] }}</span>-->\n                                              <!--<img v-if="isPhoto(layer,feature,attribute)" data-url="{{getPhotoUrl(feature.attributes[attribute.name])}}" style="max-width:50px" :src="getPhotoUrl(feature.attributes[attribute.name],thumb)" />-->\n                                              <a v-if="isLink(layer,relattribute.name,relattribute.value)" :href="relattribute.value" target="_blank" class="glyphicon glyphicon-link"></a>\n                                            </td>\n                                          </tr>\n                                        </table>\n                                      </td>\n                                    </tr>\n                                    </tbody>\n                                  </table>\n                                </template>\n                              </div>\n                            </div>\n                          </li>\n                        </template>\n                      </ul>\n                    </div>\n                    <!--Fine Relazioni-->\n                  </td>\n                </tr>\n              </template>\n              </tbody>\n            </table>\n          </div>\n        </div>\n      </li>\n    </ul>\n  </div>\n  <span v-if="!hasResults() && !state.loading">Nessun risultato</span>\n</div>\n\n'},{}],89:[function(e,t,i){function n(e,t,i){var n=/^(https?:\/\/[^\s]+)/g,r=/[^\s]+.(png|jpg|jpeg)$/g;if(_.isNil(i))return Fields.SIMPLE;i=i.toString();i.split(".").pop();return i.match(r)?Fields.PHOTO:i.match(n)?Fields.LINK:Fields.SIMPLE}function r(e,t,i,r){var o=n(t,i,r);return o===e}function o(e){a(this,e);var t=this;this.id="queryresults",this.title="Query Results",this._service=new u,this.setInternalComponent=function(){this.internalComponent=new g({queryResultsService:this._service}),this.createLayersFeaturesBoxes(),this.internalComponent.querytitle=this._service.state.querytitle},this.getElement=function(){if(this.internalComponent)return this.internalComponent.$el},this._service.onafter("setLayersData",function(){t.createLayersFeaturesBoxes()}),l(this,e),this.createLayersFeaturesBoxes=function(){var e={},t=this._service.state.layers;_.forEach(t,function(t){t.attributes.length<=h&&(t.expandable=!1),_.forEach(t.features,function(i,n){var r=!0,o=t.id+"_"+i.id;e[o]={collapsed:r},i.attributes.relations&&(o="",_.forEach(i.attributes.relations,function(n){o=t.id+"_"+i.id+"_"+n.name,_.forEach(n.elements,function(t,i){e[o+i]={collapsed:!0}})}))})}),this.internalComponent.layersFeaturesBoxes=e},this.mount=function(e,t){var i=this;return a(this,"mount",e,t).then(function(){i._service.state.layers.length&&i._service.postRender(i.getElement())})}}var s=e("core/utils/utils").inherit,a=e("core/utils/utils").base,l=e("core/utils/utils").merge,c=e("gui/vue/component"),u=e("gui/queryresults/queryresultsservice");Fields={},Fields.SIMPLE="simple",Fields.LINK="link",Fields.PHOTO="photo",Fields.POINTLINK="pointlink",Fields.ROUTE="route";var h=3,d=10,f=10,p={template:e("./queryresults.html"),data:function(){return{state:this.$options.queryResultsService.state,layersFeaturesBoxes:{},headerExpandActionCellWidth:d,headerActionsCellWidth:f}},replace:!1,methods:{isSimple:function(e,t,i){return r(Fields.SIMPLE,e,t,i)},isLink:function(e,t,i){return r(Fields.LINK,e,t,i)},is:function(e,t,i,n){return r(e,t,i,n)},layerHasFeatures:function(e){return!!e.features&&e.features.length>0},hasResults:function(){return this.state.layers.length},layerHasActions:function(e){return this.state.layersactions[e.id].length>0},featureHasActions:function(e,t){return this.geometryAvailable(t)},geometryAvailable:function(e){return!!e.geometry},attributesSubset:function(e){var t=Math.min(h,e.length);return e.slice(0,t)},relationsAttributesSubset:function(e){var t=[];_.forEach(e,function(e,i){t.push({label:i,value:e})});var i=Math.min(h,t.length);return t.slice(0,i)},relationsAttributes:function(e){var t=[];return _.forEach(e,function(e,i){t.push({label:i,value:e})}),t},attributesSubsetLength:function(e){return this.attributesSubset(e).length},cellWidth:function(e,t){var i=this.attributesSubsetLength(t.attributes),n=h-i;actionsCellWidth=t.hasgeometry?f:0;var r=100-d-actionsCellWidth,o=r/h;return e==i-1&&n>0?o*(n+1):o},featureBoxColspan:function(e){var t=this.attributesSubsetLength(e.attributes);return e.expandable&&(t+=1),e.hasgeometry&&(t+=1),t},relationsAttributesSubsetLength:function(e){return this.relationsAttributesSubset(e).length},collapsedFeatureBox:function(e,t,i){var n,r=!0;return n=_.isNil(i)?e.id+"_"+t.id:e.id+"_"+t.id+"_"+i,this.layersFeaturesBoxes[n]&&(r=this.layersFeaturesBoxes[n].collapsed),r},toggleFeatureBox:function(e,t,i){var n;n=_.isNil(i)?e.id+"_"+t.id:e.id+"_"+t.id+"_"+i,this.layersFeaturesBoxes[n].collapsed=!this.layersFeaturesBoxes[n].collapsed},toggleFeatureBoxAndZoom:function(e,t,i){this.collapsedFeatureBox(e,t,i)&&this.trigger("gotogeometry",e,t),this.toggleFeatureBox(e,t,i)},trigger:function(e,t,i){this.$options.queryResultsService.trigger(e,t,i)}},watch:{
"state.layers":function(e){e.length&&this.$options.queryResultsService.postRender(this.$el)}}},g=Vue.extend(p);s(o,c),t.exports=o},{"./queryresults.html":88,"core/utils/utils":51,"gui/queryresults/queryresultsservice":87,"gui/vue/component":98}],90:[function(e,t,i){function n(){this.init=function(e){var t=e||s.getCurrentProject().state.search;this.state.searches=t},this.state={searches:[]},this.showSearchPanel=function(e){var t=new l;return t.init(e),o.showPanel(t),t},this.cleanSearchPanels=function(){this.state.panels={}},this.stop=function(){var e=$.Deferred();return e.resolve(),e.promise()}}var r=e("core/utils/utils").inherit,o=e("gui/gui"),s=e("core/project/projectsregistry"),a=e("core/g3wobject"),l=e("gui/search/vue/panel/searchpanel");r(n,a),t.exports=n},{"core/g3wobject":31,"core/project/projectsregistry":45,"core/utils/utils":51,"gui/gui":79,"gui/search/vue/panel/searchpanel":92}],91:[function(e,t,i){t.exports='<div class="g3w-search-panel form-group">\n  <h4>{{ \'search\' | t }} {{title}}</h4>\n  <form id="g3w-search-form">\n    <template v-for="forminput in forminputs">\n      <div v-if="forminput.input.type == \'numberfield\'" class="form-group numeric">\n        <label for="{{ forminput.id }} ">{{ forminput.label }}</label>\n        <input type="number" v-model="formInputValues[$index].value" class="form-control" id="{{ forminput.id }}">\n      </div>\n      <div v-if="forminput.input.type == \'textfield\'" class="form-group text">\n        <label for="{{ forminput.id }}">{{ forminput.label }}</label>\n        <input type="text" v-model="formInputValues[$index].value" class="form-control" id="{{ forminput.id }}">\n      </div>\n    </template>\n    <div class="form-group">\n      <button style="width:100%" class="btn btn-primary pull-right" @click="doSearch($event)" data-i18n="dosearch">Search</button>\n    </div>\n  </form>\n</div>\n'},{}],92:[function(e,t,i){function n(){self=this,this.config={},this.filter={},this.id=null,this.querylayerid=null,this.internalPanel=new c,this.init=function(e){this.config=e||{},this.name=this.config.name||this.name,this.id=this.config.id||this.id,this.filter=this.config.options.filter||this.filter;var t=this.config.options.querylayerid||this.querylayerid;this.queryLayer=l.getCurrentProject().getLayerById(t),this.fillInputsFormFromFilter();var i=s.createQueryFilterFromConfig(this.filter);this.internalPanel.filterObject=s.createQueryFilterObject(this.queryLayer,i),this.internalPanel.fillFilterInputsWithValues=this.fillFilterInputsWithValues,this.internalPanel.title=this.name},this.fillInputsFormFromFilter=function(){var e,t=0;_.forEach(this.filter,function(i,n,r){_.forEach(i,function(i){e={},i.id=t,e.type=i.input.type,e.value=null,self.internalPanel.formInputValues.push(e),self.internalPanel.forminputs.push(i),t+=1})})},this.fillFilterInputsWithValues=function(e,t,i){function n(e,t){switch(e){case"numberfield":t=parseInt(t)}return t}return _.forEach(e.filterObject,function(e,r){_.forEach(e,function(e,r){_.forEach(e,function(o,s,a){_.isArray(o)?fillFilterInputsWithValues(e,t,r):_.forEach(o,function(e,o,s){index=i?i+r:r,s[o]=n(t[index].type,t[index].value)})})})}),e}}var r=e("core/utils/utils").inherit,o=(e("core/i18n/i18n.service").t,e("core/utils/utils").resolve,e("gui/gui")),s=e("core/query/queryservice"),a=(e("gui/listpanel").ListPanel,e("gui/panel")),l=e("core/project/projectsregistry"),c=Vue.extend({template:e("./searchpanel.html"),data:function(){return{title:"",forminputs:[],filterObject:{},formInputValues:[]}},methods:{doSearch:function(e){var t=this;e.preventDefault(),this.filterObject=this.fillFilterInputsWithValues(this.filterObject,this.formInputValues);var i=o.showContentFactory("query"),n=i(t.title);s.queryByFilter(this.filterObject).then(function(e){n.setQueryResponse(e)}).fail(function(){n.setQueryResponse({})})}}});r(n,a),t.exports=n},{"./searchpanel.html":91,"core/i18n/i18n.service":34,"core/project/projectsregistry":45,"core/query/queryservice":48,"core/utils/utils":51,"gui/gui":79,"gui/listpanel":81,"gui/panel":86}],93:[function(e,t,i){t.exports='<ul id="g3w-search" class="treeview-menu g3w-search g3w-tools menu-items">\n  <li v-for="search in project.search" class="menu-item">\n      <span @click="showSearchPanel(search)">{{ search.name }}</span>\n  </li>\n</ul>\n'},{}],94:[function(e,t,i){function n(e){o(this,e),this.id="search-component",this.title="search",this._service=new c,this.internalComponent=new h({searchesService:this._service}),this.state.visible=l.getCurrentProject().state.search.length>0,s(this,e),this.initService=function(){this._service.init()}}var r=e("core/utils/utils").inherit,o=e("core/utils/utils").base,s=e("core/utils/utils").merge,a=(e("core/i18n/i18n.service").t,e("core/utils/utils").resolve,e("gui/vue/component")),l=(e("gui/gui"),e("core/project/projectsregistry")),l=(e("core/g3wobject"),e("gui/search/vue/panel/searchpanel"),e("core/project/projectsregistry")),c=e("gui/search/searchesservice"),u={template:e("./search.html"),data:function(){return{project:l.getCurrentProject().state}},methods:{showSearchPanel:function(e){this.$options.searchesService.showSearchPanel(e)}}},h=Vue.extend(u);r(n,a),t.exports=n},{"./search.html":93,"core/g3wobject":31,"core/i18n/i18n.service":34,"core/project/projectsregistry":45,"core/utils/utils":51,"gui/gui":79,"gui/search/searchesservice":90,"gui/search/vue/panel/searchpanel":92,"gui/vue/component":98}],95:[function(e,t,i){function n(){var e=this;this.config=null,this._actions={},this.state={toolsGroups:[]},this.setters={addToolGroup:function(t,i){e.state.toolsGroups.splice(t,0,i)}},this.addTools=function(e,t,i){var n=this,r=this._getToolsGroup(t);r||(r={name:t,tools:[]},this.addToolGroup(e,r)),_.forEach(i,function(e){r.tools.push(e),n._addAction(e)})},this.removeTool=function(e){},this.updateToolsGroup=function(e,t){this.state.toolsGroups.$set(e,t)},this.getState=function(){return this.state},this.fireAction=function(e){var t=this._actions[e];t()},this._getToolsGroup=function(e){var t=null;return _.forEach(this.state.toolsGroups,function(i){i.name==e&&(t=i)}),t},this._addAction=function(e){var t=Math.floor(1e6*Math.random())+1;e.actionId=t,this._actions[t]=e.action},o(this)}var r=e("core/utils/utils").inherit,o=e("core/utils/utils").base,s=e("core/g3wobject");r(n,s),t.exports=n},{"core/g3wobject":31,"core/utils/utils":51}],96:[function(e,t,i){t.exports='<div class="g3w-tools">\n  <ul>\n    <li v-for="group in state.toolsGroups">\n      <div class="tool-header">\n        <span style="">{{ group.name }}</span>\n      </div>\n      <div id="{{ group.name }}-tools" class="tool-box">\n        <template v-for="tool in group.tools">\n          <div v-if="tool.type == \'checkbox\' " class="checkbox tool">\n            <label><input style="cursor:pointer" :checked="tool.isCheck" type="checkbox" @click="fireAction(tool.actionId)" value="">{{ tool.name }}</label>\n          </div>\n          <div v-else class="tool" >\n            <i class="glyphicon glyphicon-cog"></i>\n            <span @click="fireAction(tool.actionId)">{{ tool.name }}</span>\n          </div>\n        </template>\n      </div>\n    </li>\n  </ul>\n</div>\n'},{}],97:[function(e,t,i){function n(e){o(this,e);var t=this;this._service=new l,this.id="tools-component",this.title="tools",this.state.visible=!1,this._service.onafter("addToolGroup",function(){t.state.visible=t._service.state.toolsGroups.length>0}),s(this,e),this.internalComponent=new c({toolsService:this._service}),this.internalComponent.state=this._service.state}var r=(e("core/i18n/i18n.service").t,e("core/utils/utils").inherit),o=e("core/utils/utils").base,s=e("core/utils/utils").merge,a=e("gui/vue/component"),l=e("gui/tools/toolsservice"),c=Vue.extend({template:e("./tools.html"),data:function(){return{state:null}},methods:{fireAction:function(e){this.$options.toolsService.fireAction(e)}}});r(n,a);n.prototype;t.exports=n},{"./tools.html":96,"core/i18n/i18n.service":34,"core/utils/utils":51,"gui/tools/toolsservice":95,"gui/vue/component":98}],98:[function(e,t,i){var n=e("core/utils/utils").inherit,r=e("core/utils/utils").base,o=e("core/utils/utils").resolve,s=(e("core/utils/utils").reject,e("gui/component")),a=function(e){r(this,e)};n(a,s);var l=a.prototype;l.mount=function(e,t){return this.internalComponent||this.setInternalComponent(),t?this.internalComponent.$mount().$appendTo(e):this.internalComponent.$mount(e),$(e).localize(),o(!0)},l.unmount=function(){return this.internalComponent.$destroy(!0),this.internalComponent=null,o()},l.ismount=function(){return this.internalComponent&&this.internalComponent.$el},t.exports=a},{"core/utils/utils":51,"gui/component":71}],99:[function(e,t,i){var n=e("core/i18n/i18n.service").t;Vue.directive("disabled",function(e){e?this.el.setAttribute("disabled","disabled"):this.el.removeAttribute("disabled")}),Vue.directive("checked",function(e){e?this.el.setAttribute("checked","checked"):this.el.removeAttribute("checked")}),Vue.directive("selected-first",function(e){0==e?this.el.setAttribute("selected",""):this.el.removeAttribute("selected")}),Vue.directive("t",function(e){return n(e)})},{"core/i18n/i18n.service":34}],100:[function(e,t,i){var n=n||{};n.core={G3WObject:e("core/g3wobject"),utils:e("core/utils/utils"),ApplicationService:e("core/applicationservice"),ApiService:e("core/apiservice"),Router:e("core/router"),ProjectsRegistry:e("core/project/projectsregistry"),Project:e("core/project/project"),QueryService:e("core/query/queryservice"),MapLayer:e("core/map/layer/maplayer"),VectorLayer:e("core/map/layer/vectorlayer"),WmsLayer:e("core/map/layer/wmslayer"),VectorLayerLoader:e("core/map/layer/loader/vectorloaderlayer"),Geometry:e("core/geometry/geometry"),geom:e("core/geometry/geom"),PickCoordinatesInteraction:e("g3w-ol3/src/interactions/pickcoordinatesinteraction"),PickFeatureInteraction:e("g3w-ol3/src/interactions/pickfeatureinteraction"),i18n:e("core/i18n/i18n.service"),Plugin:e("core/plugin/plugin"),PluginsRegistry:e("core/plugin/pluginsregistry"),Editor:e("core/editing/editor"),EditBuffer:e("core/editing/editbuffer"),RelationEditBuffer:e("core/editing/relationeditbuffer")},n.gui={GUI:e("gui/gui"),Panel:e("gui/panel"),vue:{Component:e("gui/vue/component"),SearchComponent:e("gui/search/vue/search"),CatalogComponent:e("gui/catalog/vue/catalog"),MapComponent:e("gui/map/vue/map"),ToolsComponent:e("gui/tools/vue/tools"),QueryResultsComponent:e("gui/queryresults/vue/queryresults"),FormComponent:e("gui/form/vue/form"),PanelComponent:e("gui/editorpanel/vue/panel")}},t.exports={core:n.core,gui:n.gui}},{"core/apiservice":18,"core/applicationservice":19,"core/editing/editbuffer":21,"core/editing/editor":22,"core/editing/relationeditbuffer":23,"core/g3wobject":31,"core/geometry/geom":32,"core/geometry/geometry":33,"core/i18n/i18n.service":34,"core/map/layer/loader/vectorloaderlayer":36,"core/map/layer/maplayer":37,"core/map/layer/vectorlayer":38,"core/map/layer/wmslayer":39,"core/plugin/plugin":41,"core/plugin/pluginsregistry":42,"core/project/project":43,"core/project/projectsregistry":45,"core/query/queryservice":48,"core/router":49,"core/utils/utils":51,"g3w-ol3/src/interactions/pickcoordinatesinteraction":60,"g3w-ol3/src/interactions/pickfeatureinteraction":61,"gui/catalog/vue/catalog":67,"gui/editorpanel/vue/panel":75,"gui/form/vue/form":77,"gui/gui":79,"gui/map/vue/map":85,"gui/panel":86,"gui/queryresults/vue/queryresults":89,"gui/search/vue/search":94,"gui/tools/vue/tools":97,"gui/vue/component":98}]},{},[3]);