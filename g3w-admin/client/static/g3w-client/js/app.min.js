!function e(t,i,n){function o(s,a){if(!i[s]){if(!t[s]){var l="function"==typeof require&&require;if(!a&&l)return l(s,!0);if(r)return r(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var u=i[s]={exports:{}};t[s][0].call(u.exports,function(e){var i=t[s][1][e];return o(i?i:e)},u,u.exports,e,t,i,n)}return i[s].exports}for(var r="function"==typeof require&&require,s=0;s<n.length;s++)o(n[s]);return o}({1:[function(e,t,i){var n="G3W Client",o={},r={tools:[]},s={resources:e("./locales/app.js")},a={debug:!0,local:!1},l={urls:{ows:"/ows",api:"/api",initconfig:"/api/initconfig",config:"/api/config"}};t.exports={apptitle:n,client:a,server:l,plugins:o,tools:r,i18n:s}},{"./locales/app.js":2}],2:[function(e,t,i){var n={it:{translation:{component:"Componente Generico",search:"Ricerche",print:"Stampa",dosearch:"Cerca",catalog:"Mappa",baselayers:"Basi",tools:"Strumenti",tree:"Strati",legend:"Legenda",street_search:"Cerca indirizzo",show:"Mostra",hide:"Nascondi",street_search:"Cerca indirizzo",copy_form_data:"Copia i dati del modulo",paste_form_data:"Incolla",copy_form_data_from_feature:"Copia i dati dalla mappa",could_not_load_vector_layers:"Errore del server: non Ã¨ satto possibile caricare i vettoriali richiesti"}}};t.exports=n},{}],3:[function(e,t,i){function n(){return{apptitle:c.apptitle||"",logo_img:c.group.header_logo_img,logo_link:c.group.header_logo_link,terms_of_use_text:c.group.header_terms_of_use_text,terms_of_use_link:c.group.terms_of_use_link,debug:c.client.debug||!1,group:c.group,urls:c.server.urls,mediaurl:c.server.urls.mediaurl,resourcesurl:c.server.urls.clienturl,projects:c.group.projects,initproject:c.group.initproject,overviewproject:c.group.overviewproject,baselayers:c.group.baselayers,mapcontrols:c.group.mapcontrols,background_color:c.group.background_color,crs:c.group.crs,proj4:c.group.proj4,minscale:c.group.minscale,maxscale:c.group.maxscale,getWmsUrl:function(e){return c.server.urls.ows+"/"+c.group.id+"/"+e.type+"/"+e.id},getProjectConfigUrl:function(e){return c.server.urls.config+"/"+c.group.id+"/"+e.type+"/"+e.id},plugins:c.group.plugins,tools:c.tools,views:c.views||{},user:c.user||null}}function o(){var t=e("sdk").gui.vue.CatalogComponent,i=e("sdk").gui.vue.SearchComponent,n=e("sdk").gui.vue.PrintComponent,o=e("sdk").gui.vue.ToolsComponent,r=e("sdk").gui.vue.MapComponent,s=e("./template/js/contentsviewer"),a=e("sdk").gui.vue.QueryResultsComponent;return{title:c.apptitle,placeholders:{navbar:{components:[]},sidebar:{components:[new n({id:"print",open:!1,collapsible:!0,icon:"fa fa-print"}),new i({id:"search",open:!1,collapsible:!0,icon:"fa fa-search"}),new t({id:"catalog",open:!1,collapsible:!1,icon:"fa fa-map-o"}),new o({id:"tools",open:!1,collapsible:!0,icon:"fa fa-gear"})]},floatbar:{components:[]}},othercomponents:[new a({id:"queryresults"})],viewport:{components:{map:new r({id:"map"}),content:new s({id:"contents"})}}}}function r(e){var t=$.Deferred();if(window.initConfig)return t.resolve(window.initConfig);var i,n=location.search.substring(1).split("&");if(_.forEach(n,function(e){e.indexOf("project")>-1&&(i=e.split("=")[1])}),i){var o=e;i&&(o=o+"/"+i),$.get(o,function(e){e.staticurl="../dist/",e.clienturl="../dist/",t.resolve(e)})}return t.promise()}var s=e("sdk").core.i18n.init,a=e("sdk/sdk").core.ApplicationService,l=e("./template/js/template"),c=e("./config/config.js");window.g3wsdk=e("sdk"),a.on("ready",function(){var e=o();applicationTemplate=new l(e,this),applicationTemplate.init(),applicationTemplate.on("ready",function(){a.postBootstrap()})}),bootstrap=function(){s(c.i18n),r(c.server.urls.initconfig).then(function(e){c.server.urls.staticurl=e.staticurl,c.server.urls.clienturl=e.staticurl+e.client,c.server.urls.mediaurl=e.mediaurl,c.group=e.group,c.user=e.user;var t=n();a.init(t,!0)})}()},{"./config/config.js":1,"./template/js/contentsviewer":12,"./template/js/template":16,sdk:130,"sdk/sdk":130}],4:[function(e,t,i){t.exports='<div class="wrapper">\n  <header class="main-header">\n    <!-- Logo -->\n    <!-- Header Navbar: style can be found in header.less -->\n    <nav class="navbar navbar-static-top" role="navigation">\n      <!-- Toggle button on navbar only for mobile -->\n      <a v-if="isMobile()" href="#" class="sidebar-toggle" data-toggle="offcanvas" role="button">\n        <span class="sr-only">Expand</span>\n      </a>\n      <div class="logo-wrapper">\n        <a v-if="logo_url" :href="logo_link" :target="logo_link_target" class=""><img :src="logo_url" style="height:40px"></a>\n        <span class="">{{project_title}}</span>\n      </div>\n      <div v-if="user" class="navbar-custom-menu">\n        <ul class="nav navbar-nav">\n          <li class="dropdown user user-menu">\n            <a href="#" class="dropdown-toggle" data-toggle="dropdown">\n              <i class="fa fa-user"></i>\n              <span class="hidden-xs">{{ user.username }}</span>\n            </a>\n            <ul class="dropdown-menu">\n              <li class="user-header">\n                <p>\n                  {{ user.first_name }} {{ user.last_name }}\n                </p>\n              </li>\n              <li class="user-footer">\n                <div class="pull-left">\n                  <a :href="user.admin_url" class="btn btn-default btn-flat"><i class="fa fa-folder"></i> Admin</a>\n                </div>\n                <div class="pull-right">\n                  <a :href="user.logout_url" class="btn btn-default btn-flat"><i class="fa fa-sign-out"></i>Sign out</a>\n                </div>\n              </li>\n            </ul>\n          </li>\n        </ul>\n      </div>\n    </nav>\n  </header>\n  <!-- Left side column. contains the logo and sidebar -->\n  <sidebar></sidebar>\n  <!-- Content Wrapper. Contains page content -->\n  <div class="content-wrapper" style="background-color:white">\n    <viewport></viewport>\n  </div>\n  <!-- /.content-wrapper -->\n  <!-- Control Sidebar -->\n  <floatbar></floatbar>\n  <!-- /.control-sidebar -->\n  <!-- Add the sidebar\'s background. This div must be placed\n       immediately after the control sidebar -->\n  <div class="control-sidebar-bg"></div>\n</div>\n'},{}],5:[function(e,t,i){t.exports='<div id="contents" class="contents"></div>\n'},{}],6:[function(e,t,i){t.exports='<aside class="control-sidebar control-sidebar-light" >\n  <a v-show="panelsinstack" href="#" class="floatbar-aside-toggle" data-toggle="control-sidebar" role="button">\n    <span class="sr-only">Expand</span>\n  </a>\n  <div id="floatbar-spinner" style="position:absolute"></div>\n  <div v-show="panelsinstack" class="g3w-sidebarpanel">\n    <div v-if="closable" class="row">\n      <div class="col-xs-12 col-sm-12 col-md-12">\n        <button class="glyphicon glyphicon-remove pull-right close-panel-button" @click="closePanel"></button>\n      </div>\n    </div>\n    <div v-if="panelname">\n      <h4 class="g3w-floatbarpanel-name">{{ panelname }}</h4>\n    </div>\n    <div id="g3w-floatbarpanel-placeholder" class="g3w-floatbarpanel-placeholder"></div>\n  </div>\n</aside>\n'},{}],7:[function(e,t,i){t.exports='<li v-show="state.visible" class="treeview sidebaritem" :class="{\'active\': open}">\n  <a @click="onClickItem" href="#">\n    <i :class="icon"></i>\n    <span class="treeview-label">{{title | t}}</span>\n    <i class="fa fa-angle-left pull-right"></i>\n  </a>\n  <div id="g3w-sidebarcomponent-placeholder"></div>\n</li>\n'},{}],8:[function(e,t,i){t.exports='<aside class="main-sidebar">\n  <!-- sidebar: style can be found in sidebar.less -->\n  <!-- Sidebar toggle button-->\n  <!-- Toggle button on the left side of main sidebar only if not mobile -->\n  <a v-if="!isMobile()" href="#" class="sidebar-aside-toggle" data-toggle="offcanvas" role="button">\n    <span class="sr-only">Expand</span>\n  </a>\n  <!--<div class="quick-actions-menu">\n    <button class="btn btn-default btn-circle-medium glyphicon glyphicon-share-alt"></button>\n    <button class="btn btn-default btn-circle-medium glyphicon glyphicon-modal-window"></button>\n    <button class="btn btn-default btn-circle-medium glyphicon glyphicon-print"></button>\n    <button class="btn btn-default btn-circle-medium glyphicon glyphicon-search"></button>\n  </div>-->\n\t<section class="sidebar">\n    <div v-show="panelsinstack" class="g3w-sidebarpanel">\n      <div style="overflow: hidden;line-height: 14px;margin-top: 4px; font-size:1.5em">\n          <button class="glyphicon glyphicon-remove pull-right close-panel-button" @click="closePanel"></button>\n      </div>\n      <div id="g3w-sidebarpanel-placeholder" class="g3w-sidebarpanel-placeholder"></div>\n    </div>\n\t  <ul id="g3w-sidebarcomponents" v-show="showmainpanel" class="sidebar-menu"></ul>\n\t</section>\n\t<!-- /.sidebar -->\n</aside>\n'},{}],9:[function(e,t,i){t.exports='<div class="g3w-viewport">\n  <div id="g3w-view-map" class="g3w-view map" :style="{width:state.map.sizes.width+\'px\',height:state.map.sizes.height+\'px\'}">\n  </div>\n  <div id="g3w-view-content" class="g3w-view content" :style="{width:state.content.sizes.width+\'px\',height:state.content.sizes.height+\'px\'}">\n    <div v-if="(showtitle && contentTitle) || previousTitle || (state.content.closable && state.content.aside)" class="close-panel-block">\n      <div v-if="previousTitle" class="g3w_contents_back">\n        <span  @click="gotoPreviousContent()"><span class="glyphicon glyphicon-chevron-left"></span> Torna {{ previousTitle }}</span>\n      </div>\n      <button v-if="state.content.closable && state.content.aside" class="glyphicon glyphicon-remove pull-right close-panel-button" @click="closeContent"></button>\n      <div v-if="showtitle && contentTitle">\n        <span>{{ contentTitle }}</span>\n      </div>\n    </div>\n  </div>\n</div>\n'},{}],10:[function(e,t,i){var n=e("core/applicationservice"),o=e("core/project/projectsregistry"),r=e("./layout"),s=Vue.extend({template:e("../html/app.html"),mounted:function(){this.$nextTick(function(){function e(){$(i).css("max-height",$(window).innerHeight()),$(".g3w-sidebarpanel").css("height",$(window).height()-$(".main-header").height())}function t(){$("#g3w-modal-overlay").css("height",$(window).height())}r.loading(!1),r.setup(),r.pushMenu.expandOnHover(),r.controlSidebar._fix($(".control-sidebar-bg")),r.controlSidebar._fix($(".control-sidebar"));var i=r.options.controlSidebarOptions.selector;e(),$(window).resize(function(){e(),t()})})},computed:{logo_url:function(){var e,t=n.getConfig();return t.logo_img&&""!=t.logo_img&&(e=t.mediaurl+t.logo_img),e},logo_link:function(){var e=this.getLogoLink();return e?e:"#"},logo_link_target:function(){var e=this.getLogoLink();return e?"_blank":""},project_title:function(){var e=o.getCurrentProject();return e.state.name},user:function(){var e=n.getConfig().user;return _.isEmpty(e)&&(e=null),e}},methods:{closePanel:function(){sidebarService.closePanel()},isMobile:function(){return isMobile.any},getLogoLink:function(){var e=null;return n.getConfig().logo_link&&(e=n.getConfig().logo_link),e}}});t.exports=s},{"../html/app.html":4,"./layout":14,"core/applicationservice":19,"core/project/projectsregistry":51}],11:[function(e,t,i){function n(){this._parent=null,this.state={contentsdata:[]}}var o=e("sdk/core/utils/utils"),r=e("sdk/core/utils/utils").inherit,s=e("sdk/core/g3wobject"),a=e("gui/vue/component"),l=e("gui/panel");r(n,s);var c=n.prototype;c.push=function(e,t){return this._parent=t.parent,this._mount(e,t)},c.pop=function(){var e=this,t=$.Deferred();if(this.state.contentsdata.length){var i=this.state.contentsdata.slice(-1)[0].content;return this._unmount(i).then(function(){e.state.contentsdata.pop()})}return t.resolve(),t.promise()},c.clear=function(){var e=this,t=$.Deferred();if(this.state.contentsdata.length){var i=[];_.forEach(this.state.contentsdata,function(t,n){i.push(e._unmount(t.content))}),$.when(i).then(function(){e.state.contentsdata.splice(0,e.state.contentsdata.length),t.resolve()})}else t.resolve();return t.promise()},c.getContentData=function(){return this.state.contentsdata},c.getCurrentContentData=function(){return this.state.contentsdata[this.state.contentsdata.length-1]},c.getPreviousContentData=function(){return this.state.contentsdata[this.state.contentsdata.length-2]},c._mount=function(e,t){if(e instanceof jQuery)return this._setJqueryContent(e);if(_.isString(e)){var i=$(e);return i.length||(i=$("<div>"+e+"</div>")),this._setJqueryContent(i)}return e.mount&&"function"==typeof e.mount?(this._checkDuplicateVueContent(e),this._setVueContent(e,t)):this._setDOMContent(e)},c._setJqueryContent=function(e,t){return $(this._parent).append(e),this.state.contentsdata.push({content:e,options:t}),o.resolve()},c._setDOMContent=function(e,t){return this._parent.appendChild(e),this.state.contentsdata.push({content:e,options:t}),o.resolve()},c._setVueContent=function(e,t){var i=this,n=$.Deferred(),o=t.append||!1;return e.mount(this._parent,o).then(function(){$(parent).localize(),i.state.contentsdata.push({content:e,options:t}),n.resolve()}),n.promise()},c._checkDuplicateVueContent=function(e){var t=this,i=null,n=e.getId();if(_.forEach(this.state.contentsdata,function(e,t){e.content.getId&&e.content.getId()==n&&(i=t)}),!_.isNull(i)){var o=t.state.contentsdata[i];o.content.unmount().then(function(){t.state.contentsdata.splice(i,1)})}},c._unmount=function(e){var t=$.Deferred();return e instanceof a||e instanceof l?e.unmount().then(function(){t.resolve()}):($(this._parent).empty(),t.resolve()),t.promise()},c.forEach=function(e){_.forEach(this.state.contentsdata,function(t){e(t.content)})},c.getLength=function(){return this.state.contentsdata.length},t.exports=n},{"gui/panel":99,"gui/vue/component":128,"sdk/core/g3wobject":31,"sdk/core/utils/utils":59}],12:[function(e,t,i){function n(e){r(this,e),this.stack=new s,this.setService(this),this.title="contents",this.contentsdata=this.stack.state.contentsdata,this.state.visible=!0,this.setInternalComponent(new l({service:this})),this.internalComponent.state=this.state}var o=e("core/utils/utils").inherit,r=e("core/utils/utils").base,s=e("./barstack.js"),a=e("gui/vue/component"),l=Vue.extend({template:e("../html/contentsviewer.html"),data:function(){return{state:null}}});o(n,a);var c=n.prototype;c.setContent=function(e){var t=this,i=$.Deferred(),n=e.push||!1,o=e.content;return n?this.addContent(o,e).then(function(){i.resolve()}):this.clearContents().then(function(){t.addContent(o,e).then(function(){i.resolve()})}),this.setOpen(!0),i.promise()},c.addContent=function(e,t){var i=this;return t.parent=this.internalComponent.$el,t.append=!0,this.stack.push(e,t).then(function(){i.contentsdata=i.stack.state.contentsdata,i.updateContentVisibility()})},c.removeContent=function(){return this.setOpen(!1),this.clearContents()},c.popContent=function(){var e=this;return this.stack.pop().then(function(){e.contentsdata=e.stack.state.contentsdata,e.updateContentVisibility()})},c.getComponentByClass=function(e){var t,i=this.stack.getContentData();return _.forEach(i,function(i){if(i.content instanceof e)return t=i.content,!1}),t},c.getComponentById=function(e){var t,i=this.stack.getContentData();return _.forEach(i,function(i){if(i.content.id==e)return t=i.content,!1}),t},c.getContentData=function(){return this.stack.getContentData()},c.getCurrentContentData=function(){return this.stack.getCurrentContentData()},c.getPreviousContentData=function(){return this.stack.getPreviousContentData()},c.updateContentVisibility=function(){var e=$(this.internalComponent.$el).children();e.hide(),e.last().show()},c.clearContents=function(){var e=this;return this.stack.clear().then(function(){e.contentsdata=e.stack.state.contentsdata})},c.layout=function(e,t){var i=this,n=$(this.internalComponent.$el);Vue.nextTick(function(){var t=n.parent().height()-n.siblings(".close-panel-block").outerHeight(!0)-n.siblings(".g3w_contents_back").outerHeight(!0);n.height(t),n.children().first().height(t);var o=i.stack.state.contentsdata;o.forEach(function(i){"function"==typeof i.content.layout&&i.content.layout(e,t)})})},t.exports=n},{"../html/contentsviewer.html":5,"./barstack.js":11,"core/utils/utils":59,"gui/vue/component":128}],13:[function(e,t,i){function n(){this.stack=new o,this.init=function(e){this.layout=e,this.sidebarEl=$(this.layout.options.controlSidebarOptions.selector),this._zindex=this.sidebarEl.css("z-index"),this._modalOverlay=null,this._modal=!1,this._isopen=!1},this.isOpen=function(){return this._isopen},this.open=function(){this.layout.floatBar.open(this.sidebarEl,!0),this._isopen=!0},this.close=function(){this.layout.floatBar.close(this.sidebarEl,!0),this._isopen=!1},this.showPanel=function(e,t){var t=t||{};t.append||!1,t.modal||!1;t.parent="#g3w-floatbarpanel-placeholder",this.stack.push(e,t),this._isopen||this.open()},this.closePanel=function(e){e?this.stack.remove(e):this.stack.pop(),this.stack.getLength()||(this._modal?(r.setModal(!1),this.close(),$(".control-sidebar-bg").toggleClass("control-sidebar-bg-shadow"),this.sidebarEl.css("z-index",""),this.sidebarEl.css("padding-top","50px"),$(".control-sidebar-bg").css("z-index",""),this._modal=!1):this.close())},this.hidePanel=function(){this.close()}}var o=(e("sdk/core/i18n/i18n.service").t,e("./barstack.js")),r=e("sdk/gui/gui"),s=new n,a=Vue.extend({template:e("../html/floatbar.html"),data:function(){return{stack:s.stack.state}},computed:{panelsinstack:function(){return this.stack.contentsdata.length>0},panelname:function(){var e;return this.stack.contentsdata.length&&(e=this.stack.contentsdata.slice(-1)[0].content.getTitle()),e},closable:function(){return s.closable}},watch:{"stack.contentsdata":function(){var e=$("#g3w-floatbarpanel-placeholder").children();_.forEach(e,function(t,i){i==e.length-1?$(t).show():$(t).hide()})}},methods:{closePanel:function(){s.closePanel()}}});t.exports={FloatbarService:s,FloatbarComponent:a}},{"../html/floatbar.html":6,"./barstack.js":11,"sdk/core/i18n/i18n.service":34,"sdk/gui/gui":91}],14:[function(e,t,i){if("undefined"==typeof jQuery)throw new Error("LayoutManager requires jQuery");$.LayoutManager={},$.LayoutManager.options={navbarMenuSlimscroll:!0,navbarMenuSlimscrollWidth:"0px",navbarMenuHeight:"200px",animationSpeed:"fast",sidebarToggleSelector:"[data-toggle='offcanvas']",sidebarPushMenu:!0,sidebarSlimScroll:!0,sidebarExpandOnHover:!1,enableBoxRefresh:!0,enableBSToppltip:!0,BSTooltipSelector:"[data-toggle='tooltip']",enableFastclick:!0,enableControlSidebar:!0,controlSidebarOptions:{toggleBtnSelector:"[data-toggle='control-sidebar']",selector:".control-sidebar",slide:!0},enableBoxWidget:!0,boxWidgetOptions:{boxWidgetIcons:{collapse:"fa-minus",open:"fa-plus",remove:"fa-times"},boxWidgetSelectors:{remove:'[data-widget="remove"]',collapse:'[data-widget="collapse"]'}},directChat:{enable:!0,contactToggleSelector:'[data-widget="chat-pane-toggle"]'},colors:{lightBlue:"#3c8dbc",red:"#f56954",green:"#00a65a",aqua:"#00c0ef",yellow:"#f39c12",blue:"#0073b7",navy:"#001F3F",teal:"#39CCCC",olive:"#3D9970",lime:"#01FF70",orange:"#FF851B",fuchsia:"#F012BE",purple:"#8E24AA",maroon:"#D81B60",black:"#222222",gray:"#d2d6de"},screenSizes:{xs:480,sm:768,md:992,lg:1200}},$.LayoutManager._init=function(){"use strict";return $.LayoutManager.layout={activate:function(){var e=this;e.fix(),e.fixSidebar(),$(window,".wrapper").resize(function(){e.fix(),e.fixSidebar()})},fix:function(){var e=$(".main-header").outerHeight()+$(".main-footer").outerHeight(),t=$(window).height(),i=$(".sidebar").height();if($("body").hasClass("fixed"))$(".content-wrapper, .right-side").css("min-height",t-$(".main-footer").outerHeight()),$(".content-wrapper, .right-side").css("height",t-$(".main-footer").outerHeight());else{var n;t>=i?($(".content-wrapper, .right-side").css("min-height",t-e),n=t-e):($(".content-wrapper, .right-side").css("min-height",i),n=i);var o=$($.LayoutManager.options.controlSidebarOptions.selector);"undefined"!=typeof o&&o.height()>n&&$(".content-wrapper, .right-side").css("min-height",o.height())}},fixSidebar:function(){return $("body").hasClass("fixed")?("undefined"==typeof $.fn.slimScroll&&window.console&&window.console.error("Error: the fixed layout requires the slimscroll plugin!"),void($.LayoutManager.options.sidebarSlimScroll?"undefined"!=typeof $.fn.slimScroll&&($(".sidebar").slimScroll({destroy:!0}).height("auto"),$(".sidebar").slimscroll({height:$(window).height()-$(".main-header").height()+"px",color:"rgba(255,255,255,0.7)",size:"3px"})):$(".sidebar").css({height:$(window).height()-$(".main-header").height()+"px"}))):void("undefined"!=typeof $.fn.slimScroll&&$(".sidebar").slimScroll({destroy:!0}).height("auto"))}},$.LayoutManager.pushMenu={activate:function(e){var t=$.LayoutManager.options.screenSizes;$(e).on("click",function(e){e.preventDefault(),$(window).width()>t.sm-1?$("body").hasClass("sidebar-collapse")?$("body").removeClass("sidebar-collapse").trigger("expanded.pushMenu"):$("body").addClass("sidebar-collapse").trigger("collapsed.pushMenu"):$("body").hasClass("sidebar-open")?$("body").removeClass("sidebar-open").removeClass("sidebar-collapse").trigger("collapsed.pushMenu"):$("body").addClass("sidebar-open").trigger("expanded.pushMenu")}),($.LayoutManager.options.sidebarExpandOnHover||$("body").hasClass("fixed")&&$("body").hasClass("sidebar-mini"))&&this.expandOnHover()},expandOnHover:function(){var e=this,t=$.LayoutManager.options.screenSizes.sm-1;$(".main-sidebar").hover(function(){$("body").hasClass("sidebar-mini")&&$("body").hasClass("sidebar-collapse")&&$(window).width()>t&&e.expand()},function(){$("body").hasClass("sidebar-mini")&&$("body").hasClass("sidebar-expanded-on-hover")&&$(window).width()>t&&e.collapse()})},expand:function(){$("body").removeClass("sidebar-collapse").addClass("sidebar-expanded-on-hover")},collapse:function(){$("body").hasClass("sidebar-expanded-on-hover")&&$("body").removeClass("sidebar-expanded-on-hover").addClass("sidebar-collapse")}},$.LayoutManager.tree=function(e){var t=this,i=$.LayoutManager.options.animationSpeed;$(document).on("click",e+" li a",function(e){var n=$(this),o=n.next();if(o.is(".treeview-menu")&&o.is(":visible"))o.slideUp(i,function(){o.parent("li.treeview").removeClass("active"),o.removeClass("menu-open")});else if(o.is(".treeview-menu")&&!o.is(":visible")){var r,s=n.parents("ul").first(),a=n.parent("li"),l=a.siblings(),c=(s.height()-s.find("li.header").outerHeight(),a.outerHeight());l.not(".header").each(function(e,t){c+=$(t).find("a").outerHeight()});var u=s.find("ul.treeview-menu:visible").slideUp(i);u.removeClass("menu-open"),o.slideDown(i,function(){o.addClass("menu-open"),r=s.find("li.treeview.active"),r.removeClass("active"),a.addClass("active"),t.layout.fix()})}o.is(".treeview-menu")&&e.preventDefault()})},$.LayoutManager.floatBar=$.LayoutManager.controlSidebar={activate:function(){var e=this,t=$.LayoutManager.options.controlSidebarOptions,i=$(t.selector),n=$(t.toggleBtnSelector);n.on("click",function(n){n.preventDefault(),i.hasClass("control-sidebar-open")||$("body").hasClass("control-sidebar-open")?e.close(i,t.slide):e.open(i,t.slide)});var o=$(".control-sidebar-bg");e._fix(o),$("body").hasClass("fixed")?e._fixForFixed(i):$(".content-wrapper, .right-side").height()<i.height()&&e._fixForContent(i)},open:function(e,t){t?e.addClass("control-sidebar-open"):$("body").addClass("control-sidebar-open")},close:function(e,t){t?e.removeClass("control-sidebar-open"):$("body").removeClass("control-sidebar-open")},_fix:function(e){var t=this;$("body").hasClass("layout-boxed")?(e.css("position","absolute"),e.height($(".wrapper").height()),$(window).resize(function(){t._fix(e)})):e.css({position:"fixed",height:"auto"})},_fixForFixed:function(e){e.css({position:"fixed","max-height":"100%","padding-bottom":"50px"})},_fixForContent:function(e){$(".content-wrapper, .right-side").css("min-height",e.height())}},$.LayoutManager.boxWidget={selectors:$.LayoutManager.options.boxWidgetOptions.boxWidgetSelectors,icons:$.LayoutManager.options.boxWidgetOptions.boxWidgetIcons,animationSpeed:$.LayoutManager.options.animationSpeed,activate:function(e){var t=this;e||(e=document),$(e).on("click",t.selectors.collapse,function(e){e.preventDefault(),t.collapse($(this))}),$(e).on("click",t.selectors.remove,function(e){e.preventDefault(),t.remove($(this))})},collapse:function(e){var t=this,i=e.parents(".box").first(),n=i.find("> .box-body, > .box-footer, > form  >.box-body, > form > .box-footer");i.hasClass("collapsed-box")?(e.find(".btn-collapser").removeClass(t.icons.open).addClass(t.icons.collapse),n.slideDown(t.animationSpeed,function(){i.removeClass("collapsed-box")})):(e.find(".btn-collapser").removeClass(t.icons.collapse).addClass(t.icons.open),n.slideUp(t.animationSpeed,function(){i.addClass("collapsed-box")}))},remove:function(e){var t=e.parents(".box").first();t.slideUp(this.animationSpeed)}},$.LayoutManager},$.LayoutManager.addRefreshButton=function(){"use strict";return $.fn.boxRefresh=function(e){function t(e){e.append(o),n.onLoadStart.call(e)}function i(e){e.find(o).remove(),n.onLoadDone.call(e)}var n=$.extend({trigger:".refresh-btn",source:"",onLoadStart:function(e){return e},onLoadDone:function(e){return e}},e),o=$('<div class="overlay"><div class="fa fa-refresh fa-spin"></div></div>');return this.each(function(){if(""===n.source)return void(window.console&&window.console.log("Please specify a source first - boxRefresh()"));var e=$(this),o=e.find(n.trigger).first();o.on("click",function(o){o.preventDefault(),t(e),e.find(".box-body").load(n.source,function(){i(e)})})})},$.LayoutManager},$.LayoutManager.activateBox=function(){"use strict";return $.fn.activateBox=function(){$.LayoutManager.boxWidget.activate(this)},$.LayoutManager},$.LayoutManager.listCustomPlugin=function(){"use strict";return $.fn.todolist=function(e){var t=$.extend({onCheck:function(e){return e},onUncheck:function(e){return e}},e);return this.each(function(){"undefined"!=typeof $.fn.iCheck?($("input",this).on("ifChecked",function(){var e=$(this).parents("li").first();e.toggleClass("done"),t.onCheck.call(e)}),$("input",this).on("ifUnchecked",function(){var e=$(this).parents("li").first();e.toggleClass("done"),t.onUncheck.call(e)})):$("input",this).on("change",function(){var e=$(this).parents("li").first();e.toggleClass("done"),$("input",e).is(":checked")?t.onCheck.call(e):t.onUncheck.call(e)})})},$.LayoutManager},$.LayoutManager.setup=function(){"use strict";$("body").removeClass("hold-transition"),"undefined"!=typeof LayoutManagerOptions&&$.extend(!0,$.LayoutManager.options,LayoutManagerOptions);var e=$.LayoutManager.options;return $.LayoutManager._init(),$.LayoutManager.layout.activate(),$.LayoutManager.tree(".sidebar"),e.enableControlSidebar&&$.LayoutManager.controlSidebar.activate(),e.navbarMenuSlimscroll&&"undefined"!=typeof $.fn.slimscroll&&$(".navbar .menu").slimscroll({height:e.navbarMenuHeight,alwaysVisible:!1,size:e.navbarMenuSlimscrollWidth}).css("width","100%"),e.sidebarPushMenu&&$.LayoutManager.pushMenu.activate(e.sidebarToggleSelector),e.enableBSToppltip&&$("body").tooltip({selector:e.BSTooltipSelector}),e.enableBoxWidget&&$.LayoutManager.boxWidget.activate(),e.enableFastclick&&"undefined"!=typeof FastClick&&FastClick.attach(document.body),e.directChat.enable&&$(document).on("click",e.directChat.contactToggleSelector,function(){var e=$(this).parents(".direct-chat").first();e.toggleClass("direct-chat-contacts-open")}),$('.btn-group[data-toggle="btn-toggle"]').each(function(){var e=$(this);$(this).find(".btn").on("click",function(t){e.find(".btn.active").removeClass("active"),$(this).addClass("active"),t.preventDefault()})}),$.LayoutManager.addRefreshButton().activateBox().listCustomPlugin()},$.LayoutManager.loading=function(e){var e=!_.isBoolean(e)||e;e?$("body").append('<div id="loadspinner" class="loading"></div>'):$("#loadspinner").remove()},t.exports=$.LayoutManager},{}],15:[function(e,t,i){function n(){this.stack=new s,this.setters={closeSidebarPanel:function(){},openCloseItem:function(e){}},this.state={components:[]},this.init=function(e){this.layout=e},this.addComponents=function(e){var t=this;return _.forEach(e,function(e){t.addComponent(e)}),!0},this.addComponent=function(e,t){var i=new c({service:this});i.title=e.title||i.title,i.open=e.state.open,i.icon=e.icon||i.icon,i.state=e.state||!0,i.collapsible=e.collapsible||!0,i.component=e;var n=i.$mount();return _.isNil(t)?(this.state.components.push(e),$("#g3w-sidebarcomponents").append(n.$el)):(this.state.components=this.state.components.splice(0,0,e),$("#g3w-sidebarcomponents").children().each(function(e,i){t==e&&$(n.$el).insertBefore(i)})),e.mount("#g3w-sidebarcomponent-placeholder"),_.has(e,"initService")&&e.initService(),!0},this.removeComponent=function(){},this.showPanel=function(e){var t="#g3w-sidebarpanel-placeholder";this.stack.push(e,{parent:t})},this.closePanel=function(){this.closeSidebarPanel();this.stack.pop()},l(this)}var o=e("sdk/core/i18n/i18n.service").t,r=e("sdk/core/utils/utils").inherit,s=e("./barstack.js"),a=e("sdk/core/g3wobject"),l=e("sdk/core/utils/utils").base,c=Vue.extend({template:e("../html/sidebar-item.html"),data:function(){return{main:!0,component:null,active:!1,title:"component",open:!1,icon:null,state:null}},methods:{onClickItem:function(){var e=this,t=this.$options.service;this.component.setOpen(!this.component.state.open),_.forEach(t.state.components,function(t){t!=e.component&&e.component.collapsible&&t.setOpen(!1)})}}});r(n,a);var u=new n,h=Vue.extend({template:e("../html/sidebar.html"),data:function(){return{components:u.state.components,panels:u.stack.state.contentsdata,bOpen:!0,bPageMode:!1,header:o("main navigation")}},computed:{panelsinstack:function(){return this.panels.length>0},showmainpanel:function(){return this.components.length>0&&!this.panelsinstack},componentname:function(){var e="";return this.components.length&&(e=this.components.slice(-1)[0].getTitle()),e},panelname:function(){var e="";return this.panels.length&&(e=this.panels.slice(-1)[0].content.getTitle()),e}},methods:{closePanel:function(){u.closePanel()},isMobile:function(){return isMobile.any}}});t.exports={SidebarService:u,SidebarComponent:h}},{"../html/sidebar-item.html":7,"../html/sidebar.html":8,"./barstack.js":11,"sdk/core/g3wobject":31,"sdk/core/i18n/i18n.service":34,"sdk/core/utils/utils":59}],16:[function(e,t,i){var n=e("sdk/core/i18n/i18n.service").t;e("sdk/gui/vue/vue.directives");var o=e("core/utils/utils").inherit,r=e("core/utils/utils").base,s=e("core/g3wobject"),a=e("sdk/gui/componentsregistry"),l=e("sdk/gui/gui"),c=e("./sidebar"),u=e("./floatbar"),h=e("./viewport"),d=e("./applicationui"),p=e("./layout");p.loading();var f=function(t,i){self=this,this.templateConfig=t,this.init=function(){i.getConfig();this._setupInterface(),this._setupLayout(),this._setUpServices()},this._setupLayout=function(){Vue.filter("t",function(e){return n(e)}),isMobile.any||$("<style type='text/css'> .ol-control-tl {top: 7px;left:43px;}</style>").appendTo("head"),Vue.component("sidebar",c.SidebarComponent),Vue.component("viewport",h.ViewportComponent),Vue.component("floatbar",u.FloatbarComponent),Vue.component("app",d);new Vue({el:"#app",mounted:function(){self._buildTemplate(),$(document).localize(),this.$nextTick(function(){self._setViewport(self.templateConfig.viewport),self.emit("ready"),l.ready()})}})},this._setUpServices=function(){_.forEach(f.Services,function(e,t){i.registerService(t,e)}),_.forEach(l.getComponents(),function(e){i.registerService(e.id,e.getService())})},this._buildTemplate=function(){var e=this;u.FloatbarService.init(p);var t=this.templateConfig.placeholders;_.forEach(t,function(t,i){e._addComponents(t.components,i)}),this._addOtherComponents()},this._addOtherComponents=function(){var e=this;this.templateConfig.othercomponents&&e._addComponents(this.templateConfig.othercomponents)},this._setViewport=function(e){e&&(f.Services.viewport.init(e),this._addComponents(e.components))},this._addComponent=function(e,t){this._addComponents([e],t)},this._addComponents=function(e,t){var i=!0;
if(t&&f.PLACEHOLDERS.indexOf(t)>-1){var n=f.Services[t];n&&(i=n.addComponents(e))}_.forEach(e,function(e){i&&a.registerComponent(e)})},this._removeComponent=function(e){a.unregisterComponent(e)},this._showModalOverlay=function(e){var t=l.getComponent("map").getService();e?t.startDrawGreyCover():t.stopDrawGreyCover()},this._showSidebar=function(){},this._hideSidebar=function(){},this._setupInterface=function(){l.layout=p,l.addComponent=_.bind(this._addComponent,this),l.removeComponent=_.bind(this._removeComponent,this),l.getResourcesUrl=_.bind(function(){return i.getConfig().resourcesurl},this),l.showList=_.bind(u.FloatbarService.showPanel,u.FloatbarService),l.closeList=_.bind(u.FloatbarService.closePanel,u.FloatbarService),l.hideList=_.bind(u.FloatbarService.hidePanel,u.FloatbarService),l.showTable=function(){},l.closeTable=function(){},l.showContentFactory=function(e){var t;switch(e){case"query":t=l.showQueryResults;break;case"form":t=l.showForm}return t},l.showForm=function(t){var i=e("sdk").gui.vue.FormComponent,n=t.formComponent?new t.formComponent:new i({id:"form"}),o=n.getService();return o.setInitForm(t),l.setContent({content:n,push:!1,closable:!1}),o},l.closeForm=function(){h.ViewportService.removeContent(),l.setModal(!1)},l.closeContent=function(){h.ViewportService.closeContent()},l.showQueryResults=function(e,t){var i=l.getComponent("queryresults"),n=i.getService();n.reset(),t&&n.setQueryResponse(t);var o=l.getComponent("contents");return!o.getContentData().length||1==o.getContentData().length&&"queryresults"==o.getCurrentContentData().content.getId()?l.showContextualContent({content:i,title:"Risultati "+e}):("queryresults"==o.getCurrentContentData().content.getId()&&o.popContent(),l.pushContent({content:i,backonclose:!0,closable:!1,perc:50,title:"Risultati "+e})),n},l.showPanel=_.bind(c.SidebarService.showPanel,c.SidebarService),l.closePanel=_.bind(c.SidebarService.closePanel,c.SidebarService),toastr.options.positionClass="toast-top-center",toastr.options.preventDuplicates=!0,toastr.options.timeOut=2e3,l.notify=toastr,l.dialog=bootbox,l.showSpinner=function(e){var t=e.container||"body",i=e.id||"loadspinner",n=e.where||"prepend",o=e.style||"",r=e.transparent?"background-color: transparent":"",s=e.center?"margin: auto":"";$("#"+i).length||$(t)[n].call($(t),'<div id="'+i+'" class="spinner-wrapper '+o+'" style="'+r+'"><div class="spinner '+o+'" style="'+s+'"></div></div>')},l.hideSpinner=function(e){$("#"+e).remove()},l.showFloatbar=function(){u.FloatbarService.open()},l.hideFloatbar=function(){u.FloatbarService.close()},l.showSidebar=_.bind(this._showSidebar,this),l.hideSidebar=_.bind(this._hideSidebar,this),l.setModal=_.bind(this._showModalOverlay,this),l.setPrimaryView=function(e){h.ViewportService.setPrimaryView(e)},l.showMap=function(){h.ViewportService.showMap()},l.showContextualMap=function(e,t){e=e||30,h.ViewportService.showContextualMap({perc:e,split:t})},l.setContextualMapComponent=function(e){h.ViewportService.setContextualMapComponent(e)},l.resetContextualMapComponent=function(){h.ViewportService.resetContextualMapComponent()},l.showContent=function(e){e=e||{},e.perc=100,l.setContent(e)},l.showContextualContent=function(e){e=e||{},e.perc=e.perc||50,l.setContent(e)},l.pushContent=function(e){e=e||{},e.perc=e.perc||100,e.push=!0,l.setContent(e)},l.pushContextualContent=function(e){e=e||{},e.perc=e.perc||50,e.push=!0,l.setContent(e)},l.setContent=function(e){e=e||{},e.content=e.content||null,e.title=e.title||"",e.push=!!_.isBoolean(e.push)&&e.push,e.perc=e.perc||0,e.split=e.split||"h",e.backonclose=!!_.isBoolean(e.backonclose)&&e.backonclose,e.showtitle=!_.isBoolean(e.showtitle)||e.showtitle,h.ViewportService.showContent(e)}},r(this)};o(f,s),f.PLACEHOLDERS=["navbar","sidebar","viewport","floatbar"],f.Services={navbar:null,sidebar:c.SidebarService,viewport:h.ViewportService,floatbar:c.FloatbarService},t.exports=f},{"./applicationui":10,"./floatbar":13,"./layout":14,"./sidebar":15,"./viewport":17,"core/g3wobject":31,"core/utils/utils":59,sdk:130,"sdk/core/i18n/i18n.service":34,"sdk/gui/componentsregistry":84,"sdk/gui/gui":91,"sdk/gui/vue/vue.directives":129}],17:[function(e,t,i){var n=e("sdk").core.utils.inherit,o=e("sdk").core.utils.base,r=e("sdk").core.G3WObject,s=e("sdk").gui.GUI,a=function(){this.state={primaryView:"map",secondaryPerc:0,split:"h",map:{sizes:{width:0,height:0},aside:!1},content:{sizes:{width:0,height:0},aside:!0,stack:[],closable:!0,backonclose:!1,contentsdata:[]}},this._components={map:null,content:null},this._defaultMapComponent,this._contextualMapComponent,this._secondaryViewMinWidth=300,this._secondaryViewMinHeight=200,this._immediateComponentsLayout=!0,this.init=function(e){var e=e||{};this.state.primaryView=e.primaryview?e.primaryview:"map",this.state.split=e.split?e.split:"h",this._addComponents(e.components)},this._addComponents=function(e){var t=this;_.forEach(e,function(e,i){["map","content"].indexOf(i)>-1&&e.mount("#g3w-view-"+i,!0).then(function(){t._components[i]=e,"map"==i&&(t._defaultMapComponent=e)})})},this.showMap=function(){this._toggleMapComponentVisibility(this._defaultMapComponent,!0),this._components.map=this._defaultMapComponent,this._showView("map")},this.showContextualMap=function(e){var t=this;if(this._contextualMapComponent||(this._contextualMapComponent=this._defaultMapComponent),this._contextualMapComponent!=this._defaultMapComponent&&this._toggleMapComponentVisibility(this._defaultMapComponent,!1),this._contextualMapComponent.ismount())t._components.map=this._contextualMapComponent,this._toggleMapComponentVisibility(this._contextualMapComponent,!0);else{var i=this._contextualMapComponent;i.mount("#g3w-view-map",!0).then(function(){t._components.map=i})}this._showView("map",e)},this.recoverDefaultMap=function(){this._components.map!=this._defaultMapComponent&&(this._components.map=this._defaultMapComponent,this._toggleMapComponentVisibility(this._contextualMapComponent,!1),this._toggleMapComponentVisibility(this._defaultMapComponent,!0))},this.setContextualMapComponent=function(e){e!=this._defaultMapComponent&&(this._contextualMapComponent&&this._contextualMapComponent.unmount(),this._contextualMapComponent=e)},this.resetContextualMapComponent=function(){this._contextualMapComponent&&this._contextualMapComponent.unmount(),this._contextualMapComponent=this._defaultMapComponent},this._toggleMapComponentVisibility=function(e,t){e.internalComponent.$el.style.display=t?"block":"none"},this.closeMap=function(){this.state.secondaryPerc="map"==this.state.primaryView?100:0,this.recoverDefaultMap(),this._layout()},this.showContent=function(e){var t=this;e.push=e.push||!1,this._prepareContentView(e),this._immediateComponentsLayout=!1,this._showView("content",e,!0),t._components.content.setContent(e).then(function(){t._layoutComponents(),t._immediateComponentsLayout=!0})},this.popContent=function(){var e=this;if(this.state.content.contentsdata.length){this.recoverDefaultMap();var t=this._components.content.getPreviousContentData();e._prepareContentView(t.options),this._immediateComponentsLayout=!1,this._showView("content"),this._components.content.popContent().then(function(){e._layoutComponents(),e._immediateComponentsLayout=!0})}},this.closeContent=function(){this._components.content.removeContent(),this.recoverDefaultMap(),this.closeSecondaryView()},this.removeContent=function(){this.state.content.backonclose&&this.state.content.contentsdata.length>1?this.popContent():(this._components.content.removeContent(),this.recoverDefaultMap(),this.closeSecondaryView())},this.isPrimaryView=function(e){return this.state.primaryView==e},this.setPrimaryView=function(e){this.state.primaryView!=e&&(this.state.primaryView=e),this._layout()},this.showPrimaryView=function(e){e&&this.state.secondaryVisible&&100==this.state.secondaryPerc&&(this.state.secondaryPerc=100-e,this._layout())},this.showSecondaryView=function(e,t){this.state.secondaryVisible=!0,this.state.split=e?e:this.state.split,this.state.secondaryPerc=t?t:this.state.perc,this._layout()},this.closeSecondaryView=function(e){var t=this,i=this._components[this._otherView(this.state.primaryView)];i.clearContents?i.clearContents().then(function(){t.state.secondaryVisible=!1,t._layout()}):(this.state.secondaryVisible=!1,this._layout())},this.getDefaultViewPerc=function(e){return this.isPrimaryView(e)?100:50},this._otherView=function(e){return"map"==e?"content":"map"},this._isSecondary=function(e){return this.state.primaryView!=e},this._setPrimaryView=function(e){this.state.primaryView!=e&&(this.state.primaryView=e)},this._prepareContentView=function(e){this.state.content.preferredPerc=e.perc||this.getDefaultViewPerc("content"),this.state.content.title=e.title,this.state.content.closable=!!_.isNil(e.closable)||e.closable,this.state.content.backonclose=!!_.isNil(e.backonclose)||e.backonclose,this.state.content.contentsdata=this._components.content.contentsdata},this._showView=function(e,t){t=t||{};var i,n=t.perc||this.getDefaultViewPerc(e),o=t.split||"h";i=!this.isPrimaryView(e)||"undefined"!=typeof t.aside&&t.aside,this.state[e].aside=i;var r=this.isPrimaryView(e)?100-n:n;r>0?this.showSecondaryView(o,r):this.closeSecondaryView()},this._getReducedSizes=function(){var e=$(".content"),t=0,i=0;if(e&&this.state.secondaryVisible&&100==this.state.secondaryPerc){var n=$(".sidebar-aside-toggle");if(n&&n.is(":visible")){var o=n.outerWidth();e.css("padding-left",o+5),t=o-5}}else e.css("padding-left",15);return{reducedWidth:t,reducedHeight:i}},this._layout=function(){var e=this,t="h"==this.state.split?"split-h":"split-v",i="h"==this.state.split?"split-v":"split-c";$(".g3w-viewport .g3w-view").addClass(t),$(".g3w-viewport .g3w-view").removeClass(i);var n=this._getReducedSizes();this._setViewSizes(n.reducedWidth,n.reducedHeight);var o=$("#closemap-btn");if(!o.length){var o=$('<div id="closemap-btn" @click="closeMap" style="        position: absolute;        right: 10px;        top: 7px;        line-height: 1;        padding: 7px 2px;        font-size: 1.5em;        background-color: #3c8dbc;        color: white;        z-index:1000;        height: 39px;        width: 39px">          <button class="glyphicon glyphicon-remove pull-right close-panel-button" style="background-color: transparent;border: 0px;"></button>        </div>');o.on("click",function(){e.closeMap()});var r=$(".g3w-viewport .map");r.append(o)}this.state.secondaryVisible&&this._isSecondary("content")&&this.state.secondaryPerc<this.state.content.preferredPerc?o.show():o.hide(),this._immediateComponentsLayout&&this._layoutComponents()},this._setViewSizes=function(){var e=this.state.primaryView,t=this._otherView(e),i=this._viewportWidth(),n=this._viewportHeight(),o=i,r=n,s=this.state.secondaryPerc/100;"h"==this.state.split?(secondaryWidth=this.state.secondaryVisible?Math.max(i*s,this._secondaryViewMinWidth):0,secondaryHeight=n,o=i-secondaryWidth,r=n):(secondaryWidth=i,secondaryHeight=this.state.secondaryVisible?Math.max(n*s,this._secondaryViewMinHeight):0,o=i,r=n-secondaryHeight),this.state[e].sizes.width=o,this.state[e].sizes.height=r,this.state[t].sizes.width=secondaryWidth,this.state[t].sizes.height=secondaryHeight},this._viewportHeight=function(){var e=$(".navbar").innerHeight();return $(window).innerHeight()-e},this._viewportWidth=function(){var e=$(".main-sidebar").offset().left,t=$(".main-sidebar").innerWidth(),i=t+e;return $(window).innerWidth()-i},this._layoutComponents=function(){var e=this;Vue.nextTick(function(){var t=e._getReducedSizes();reducedWidth=t.reducedWidth||0,reducedHeight=t.reducedHeight||0,_.forEach(e._components,function(t,i){var n=e.state[i].sizes.width-reducedWidth,o=e.state[i].sizes.height-reducedHeight;t.layout(n,o)})})},this._firstLayout=function(){function e(){o=!0,t()}function t(){o===!0?(o=!1,n=!0,i._layout(!0),requestAnimationFrame(t)):n=!1}var i=this,n=!1,o=!1;s.on("ready",function(){var t=i.state.primaryView,o=i._otherView(t),r=$(".g3w-viewport ."+o),a=r.css("min-width");""==a||_.isNaN(parseFloat(a))||(i._secondaryViewMinWidth=parseFloat(a));var l=r.css("min-height");""==l||_.isNaN(parseFloat(l))||(i._secondaryViewMinHeight=parseFloat(l)),i._layout(!0),s.on("guiresized",function(){e()}),$(window).resize(function(){n===!1&&e()}),$(".main-sidebar").on("webkitTransitionEnd transitionend msTransitionEnd oTransitionEnd",function(){$(this).trigger("trans-end"),e()})})},this._firstLayout(),o(this)};n(a,r);var l=new a,c=Vue.extend({template:e("../html/viewport.html"),data:function(){return{state:l.state}},computed:{showtitle:function(){var e=!0,t=this.state.content.contentsdata;if(t.length){var i=t[t.length-1].options;_.isBoolean(i.showtitle)&&(e=i.showtitle)}return e},contentTitle:function(){var e=this.state.content.contentsdata;if(e.length)return e[e.length-1].options.title},previousTitle:function(){var e=this.state.content.contentsdata;return e.length>1&&(e[e.length-2].options.title?"a "+e[e.length-2].options.title:"indietro")},contentSmallerThenPreferred:function(){return this.state.secondaryPerc<this.state.content.preferredPerc}},methods:{closeContent:function(){l.removeContent()},closeMap:function(){l.closeMap()},gotoPreviousContent:function(){l.popContent()}}});t.exports={ViewportService:l,ViewportComponent:c}},{"../html/viewport.html":9,sdk:130}],18:[function(e,t,i){function n(){this._config=null,this._baseUrl=null,this.init=function(e){this._config=e,this._baseUrl=e.urls.api,this._apiEndpoints=e.urls.apiEndpoints};var e=0;this._incrementLoaders=function(){0==e&&this.emit("apiquerystart"),e+=1},this._decrementLoaders=function(){e-=1,0==e&&this.emit("apiqueryend")},this.get=function(e,t){var i=this,n=this._apiEndpoints[e];if(n){var o=this._baseUrl+"/"+n;t.request&&(o=o+"/"+t.request);var r=t.params||{};return i.emit(e+"querystart"),this._incrementLoaders(),$.get(o,r).done(function(t){return i.emit(e+"queryend",t),t}).fail(function(t){return i.emit(e+"queryfail",t),t}).always(function(){i._decrementLoaders()})}return a()},r(this)}var o=e("core/utils/utils").inherit,r=e("core/utils/utils").base,s=e("core/g3wobject"),a=e("core/utils/utils").reject;o(n,s),t.exports=new n},{"core/g3wobject":31,"core/utils/utils":59}],19:[function(e,t,i){var n=e("core/utils/utils").inherit,o=e("core/utils/utils").base,r=e("core/g3wobject"),s=e("core/apiservice"),a=e("core/router"),l=e("core/project/projectsregistry"),c=e("core/plugin/pluginsregistry"),u=e("core/clipboardservice"),h=function(){var e=this;this.secret="### G3W Client Application Service ###",this.ready=!1,this.complete=!1,this._modalOverlay=null,this._acquirePostBoostrap=!1,this._applicationServices={},this.config={},o(this),this.init=function(e,t){this._config=e,t&&(this._acquirePostBoostrap=!0),this._bootstrap()},this.getConfig=function(){return this._config},this.getRouterService=function(){return a},this.getClipboardService=function(){return u},this.postBootstrap=function(){if(!this.complete){a.init();var t=l.getCurrentProject();t.state.law&&t.state.law.length&&(e._config.plugins.law=t.state.law),c.init({pluginsBaseUrl:e._config.urls.staticurl,pluginsConfigs:e._config.plugins}),this.complete=!0}},this._bootstrap=function(){var e=this;this.ready||$.when(s.init(this._config),l.init(this._config)).then(function(){e.emit("ready"),e._acquirePostBoostrap||e.postBootstrap(),this.initialized=!0})},this.registerService=function(e,t){this._applicationServices[e]=t},this.unregisterService=function(e){delete this._applicationServices[e]},this.getService=function(e){return this._applicationServices[e]}};n(h,r),t.exports=new h},{"core/apiservice":18,"core/clipboardservice":20,"core/g3wobject":31,"core/plugin/pluginsregistry":45,"core/project/projectsregistry":51,"core/router":57,"core/utils/utils":59}],20:[function(e,t,i){function n(){this._data={},this.set=function(e,t){var i=e.split("form")[0];this._data[i]=t},this.get=function(e){var t=this._data[e]||{};return this._data[e]={},t}}t.exports=new n},{}],21:[function(e,t,i){function n(e,t){var t=t||{};this._editor=e,this._origVectorLayer=new ol.layer.Vector({source:new ol.source.Vector}),this._cloneLayer(),this._geometriesBuffer={},this._attributesBuffer={},this._relationsBuffers={},this._relationEditBuffer=t.relationEditBuffer||s}var o=e("core/utils/utils").inherit,r=e("core/g3wobject"),s=e("./relationeditbuffer");o(n,r),t.exports=n;var a=n.prototype;a.commit=function(){var e=this,t=this._editor.getVectorLayer(),i=this._editor.getEditVectorLayer().getFeatures();i&&(_.forEach(i,function(t,n){i[n]=e._editor._transformCoordinateFeatureFromLayerToMap(t)}),t.addFeatures(i));var n=this._geometriesBuffer;_.forEach(n,function(i,n){if(!e._isNewFeature(n)){var o=t.getFeatureById(n);o&&(o=e._editor._transformCoordinateFeatureFromLayerToMap(o),o.setStyle(null),t.modifyFeatureGeometry(n,o.getGeometry()))}}),this._editor.getEditVectorLayer().clear(),this._clearBuffers(),this._cloneLayer()},a.undoAll=function(){this._resetVectorLayer(),this._clearBuffers()},a.destroy=function(){this._clearBuffers()},a.generateId=function(){return this._editor.generateId()},a.addFeature=function(e){e.getId()||e.setId(this.generateId()),this._addEditToGeometryBuffer(e,"add")},a.updateFeature=function(e){this._addEditToGeometryBuffer(e,"update")},a.deleteFeature=function(e,t){this._addEditToGeometryBuffer(e,"delete"),this._addEditToValuesBuffers(e,t,"delete")},a.updateFields=function(e,t){e.getId()||e.setId(this.generateId()),this._addEditToValuesBuffers(e,t)},a.getFeatureAttributes=function(e){return this._attributesBuffer[e]?this._attributesBuffer[e].slice(-1)[0]:null},a.areFeatureAttributesEdited=function(e){return!!this._attributesBuffer[e]&&this._attributesBuffer[e].length>-1},a.hasRelationsEdits=function(e){var t=!1;return _.forEach(this._relationsBuffers[e],function(e){t=t||e.hasRelationElements()}),t},a.getRelationsEdits=function(e){var t={};return _.forEach(this._relationsBuffers[e],function(e){t[e.getRelationName()]=e.getRelationElements()}),t},a.collectFeatureIds=function(){var e=this._geometriesBuffer,t=this._attributesBuffer,i=[];return i=_.concat(i,_.keys(e)),i=_.concat(i,_.keys(t)),_.uniq(i)},a.collectFeatures=function(e,t){var i,n=this,t=t||!1,o=new ol.format.GeoJSON,r=this.collectFeatureIds();i="new"==e?n._editor.getEditVectorLayer():n._editor.getVectorLayer();var s=[];return _.forEach(r,function(r){var a=i.getFeatureById(r),l=n._isNewFeature(r),c="new"==e&&l&&a,u="updated"==e&&!l&&a,h="deleted"==e&&!l&&!a;c||u?(t&&(a=o.writeFeatureObject(a)),s.push(a)):h&&s.push(r)}),s},a.createFeature=function(e,t,i){var n=new ol.Feature;return n.setId(e),n.setGeometry(t),n.setProperties(i),n},a.collectRelations=function(){var e={add:[],"delete":[],update:[]};return _.forEach(this._relationsBuffers,function(t,i){var n={fid:i,relations:{}},o={fid:i,relations:{}},r={fid:i,relations:{}};_.forEach(t,function(e){var t=e.getRelationName(),i=e.getRelationElementsOnlyFieldsValues("NEW"),s=e.getRelationElementsOnlyFieldsValues("OLD"),a=e.getRelationElementsOnlyFieldsValues("OLD_DELETED"),l=[],c=[],u=[];_.forEach(i,function(e){l.push({id:e.id,fields:e.fields})}),_.forEach(s,function(e){c.push({id:e.id,fields:e.fields})}),_.forEach(a,function(e){u.push({id:e.id})}),n.relations[t]=l,o.relations[t]=c,r.relations[t]=u}),e.add.push(n),e.update.push(o),e["delete"].push(r)}),e},a._addEditToGeometryBuffer=function(e,t){var i=this._geometriesBuffer,n=e.getId(),o=e.getGeometry();if("delete"==t){o=null;var r=this._isNewFeature(n)?this._editor.getEditVectorLayer():this._editor.getVectorLayer();r.getSource().removeFeature(e)}_.has(i,n)||(i[n]=[]),i[n].push(o),this._setDirty(!0)},a._addDeleteRelationsBuffers=function(e,t){var i=this;e&&_.forEach(e,function(e){_.has(i._relationsBuffers,t)||(i._relationsBuffers[t]={}),_.has(i._relationsBuffers[t],e.name)||(i._relationsBuffers[t][e.name]=new i._relationEditBuffer(i,e.name));var n=i._relationsBuffers[t][e.name];n.updateRelation(e)})},a._addEditToValuesBuffers=function(e,t){var i=e.getId(),n=e.getProperties(),o=this._attributesBuffer;_.has(o,i)||(o[i]=[]),o[i].push(n),this._addDeleteRelationsBuffers(t,i),this._setDirty(!0)},a._isNewFeature=function(e){return this._editor.isNewFeature(e)},a._setDirty=function(e){var t=e||!_.isEmpty(this._geometriesBuffer)||!_.isEmpty(this._attributesBuffer)||!_.isEmpty(this._relationsAttributesBuffer);this._editor._setDirty(t)},a._resetVectorLayer=function(){this._editor.vectoLayer=this._origVectorLayer,this._origVectorLayer.getSource().clear()},a._clearBuffers=function(){this._geometriesBuffer={},this._attributesBuffer={},this._relationsAttributesBuffer={},this._relationsBuffers={},this._editor._setDirty(!1)},a._cloneLayer=function(){var e=[];this._editor.getVectorLayer().getSource().forEachFeature(function(t){e.push(t.clone())},this),this._origVectorLayer.getSource().addFeatures(e)}},{"./relationeditbuffer":23,"core/g3wobject":31,"core/utils/utils":59}],22:[function(e,t,i){function n(e){var e=e||{};this._formComponent=e.formComponent||null,this._mapService=e.mapService||{},this._vectorLayer=null,this._editVectorLayer=null,this._editBufferClass=e.editBufferClass||v,this._editBuffer=null,this._activeTool=null,this._dirty=!1,this._newPrefix="_new_",this._featureLocks=null,this._started=!1,this._editingVectorStyle=e.editingVectorStyle||null,this.checkOneRelation=e.checkOneRelation||!1,this._copyAndPasteFieldsNotOverwritable=e.copyAndPasteFieldsNotOverwritable||{},this._fieldsLayerbindToRelationsFileds=e.fieldsLayerbindToRelationsFileds||{},this._formTools=e.formTools||["copypaste"],this._pickedFeature=null,this._formService=null,this._setterslisteners={before:{},after:{}},this._geometrytypes=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],this._toolsForGeometryTypes={Point:{addfeature:u,movefeature:h,deletefeature:p,editattributes:f},MultiPoint:{addfeature:u,movefeature:h,deletefeature:p,editattributes:f},LineString:{addfeature:u,modifyvertex:d,movefeature:h,deletefeature:p,editattributes:f,cutline:g},Polygon:{addfeature:u,modifyvertex:d,movefeature:h,deletefeature:p,editattributes:f},MultiPolygon:{addfeature:u,modifyvertex:d,movefeature:h,deletefeature:p,editattributes:f}},this._activeTool=new function(){this.type=null,this.instance=null,this.setTool=function(e,t){this.type=e,this.instance=t},this.getType=function(){return this.type},this.getTool=function(){return this.instance},this.clear=function(){this.type=null,this.instance=null}},this._tools={},this._setupAddFeatureAttributesEditingListeners(),this._setupEditAttributesListeners(),this._askConfirmToDeleteEditingListener(),r(this)}var o=e("core/utils/utils").inherit,r=e("core/utils/utils").base,s=e("core/utils/utils").resolve,a=e("core/g3wobject"),l=e("gui/gui"),c=e("core/map/layer/vectorlayer"),u=e("./tools/addfeaturetool"),h=e("./tools/movepointtool"),d=e("./tools/modifyfeaturetool"),p=e("./tools/deletefeaturetool"),f=e("./tools/pickfeaturetool"),g=e("./tools/cutlinetool"),v=e("./editbuffer");o(n,a);var m=n.prototype;m._askConfirmToDeleteEditingListener=function(){var e=this;this.onbeforeasync("deleteFeature",function(t,i,n){e._deleteFeatureDialog(n)})},m._deleteFeatureDialog=function(e){l.dialog.confirm("Vuoi eliminare l'elemento selezionato?",function(t){e(t)})},m._setupAddFeatureAttributesEditingListeners=function(){var e=this;this.onbeforeasync("addFeature",function(t,i){e._openEditorForm("new",t,i)},100)},m._setupEditAttributesListeners=function(){var e=this;this.onbeforeasync("pickFeature",function(t,i){var n=e.isNewFeature(t.getId())?"new":"old";e._openEditorForm(n,t,i)})},m.getcopyAndPasteFieldsNotOverwritable=function(){return this._copyAndPasteFieldsNotOverwritable},m.setcopyAndPasteFieldsNotOverwritable=function(e){this._copyAndPasteFieldsNotOverwritable=e},m.getfieldsLayerbindToRelationsFileds=function(){return this._fieldsLayerbindToRelationsFileds},m.setFormService=function(e){this._formService=e},m.getFormService=function(){return this._formService},m.getMapService=function(){return this._mapService},m.getPickedFeature=function(){return this._pickedFeature},m.setPickedFeature=function(e){this._pickedFeature=e},m.cleanUpPickedFeature=function(){this._pickedFeature.setStyle(null),this._pickedFeature=null},m.setFormData=function(e){this.formData=e},m.setVectorLayer=function(e){var t=e.geometrytype;if(!t||!this._isCompatibleType(t))throw Error("Vector geometry type "+t+" is not valid for editing");this._setToolsForVectorType(t),this._vectorLayer=e},m.addEditingLayerToMap=function(e){this._editVectorLayer=new c({name:"editvector",geometrytype:e}),this._editingVectorStyle&&this._editVectorLayer.setStyle(this._editingVectorStyle.url),this._mapService.viewer.map.addLayer(this._editVectorLayer.getMapLayer())},m.removeEditingLayerFromMap=function(){this._mapService.viewer.removeLayerByName(this._editVectorLayer.name),this._editVectorLayer=null},m.start=function(){var e=!1;return this._vectorLayer&&(this.stop(),this.addEditingLayerToMap(this._vectorLayer.geometrytype),this._editBuffer=new this._editBufferClass(this),this._setStarted(!0),e=!0),e},m.stop=function(){return!this.isStarted()||!!this.stopTool()&&(this._editBuffer.destroy(),this._editBuffer=null,this.removeEditingLayerFromMap(),this._setStarted(!1),!0)},m.destroy=function(){this.stop()&&this.removeAllListeners()},m.setTool=function(e,t){if(!this.stopTool())return!1;var i=this._tools[e];if(i){var n=new i(this,t);return this._activeTool.setTool(e,n),this._setToolSettersListeners(n),n.run(),!0}},m.stopTool=function(){return!(this._activeTool.instance&&!this._activeTool.instance.stop())&&(l.closeForm(),l.setModal(!1),this._activeTool.clear(),!0)},m.getActiveTool=function(){return this._activeTool},m.isStarted=function(){return this._started},m.hasActiveTool=function(){return!_.isNull(this._activeTool.instance)},m.isToolActive=function(e){return!!this._activeTool.toolType&&this._activeTool.toolType==e},m.commit=function(e){this._editBuffer.commit(),this._formService&&this._formService.cleanStateAfterCommit(e)},m.undoAll=function(){this._editBuffer.undoAll()},m.setFeatureLocks=function(e){this._featureLocks=e},m.getFeatureLocks=function(){return this._featureLocks},m.getFeatureLockIds=function(){return _.map(this._vectorLayer.getFeatureLocks(),function(e){return e.lockid})},m.getFeatureLocksLockIds=function(e){var e=e||this._vectorLayer.getFeatureLocks();return _.map(e,function(e){return e.lockid})},m.getFeatureLocksFeatureIds=function(e){var e=e||this._vectorLayer.getFeatureLocks();return _.map(e,function(e){return e.featureid})},m.getFeatureLockIdsForFeatureIds=function(e){var t=_.filter(this._vectorLayer.getFeatureLocks(),function(t){return _.includes(e,t.featureid)});return this.getFeatureLocksLockIds(t)},m.getFeatureLockForFeatureIds=function(e){return this._vectorLayer.getFeatureLocks()},m.getEditedFeatures=function(){var e=this._editBuffer.collectFeatureIds(),t=this.getFeatureLockForFeatureIds(e);return{add:this._editBuffer.collectFeatures("new",!0),update:this._editBuffer.collectFeatures("updated",!0),"delete":this._editBuffer.collectFeatures("deleted",!0),relationsedits:this.collectRelations(),lockids:t}},m.collectRelations=function(){return relationsEdits=this._editBuffer.collectRelations(),relationsEdits},m.setFieldsWithValues=function(e,t,i){var n={};_.forEach(t,function(e){"null"==e.value&&(e.value=null),n[e.name]=e.value}),e.setProperties(n),this._editBuffer.updateFields(e,i),i&&this._vectorLayer.setRelationsData(e.getId(),i)},m.getRelationsWithValues=function(e){var t=e.getId();if(this._vectorLayer.hasRelations()){var i;if(t)if(this._vectorLayer.getFeatureById(t)){var n=this._editBuffer.hasRelationsEdits(t);if(n){var o=this._editBuffer.getRelationsEdits(t),r=this._vectorLayer.getRelations();_.forEach(r,function(e){e.elements=_.cloneDeep(o[e.name])}),i=s(r)}else i=this._vectorLayer.getRelationsWithValues(t)}else if(this._vectorLayer.featureHasRelationsFksWithValues(e)){var a=this._vectorLayer.getRelationsFksWithValuesForFeature(e);i=this._vectorLayer.getNewRelationsWithValuesFromFks(a)}else i=this._vectorLayer.getRelationsWithValues(t);else i=this._vectorLayer.getRelationsWithValues()}else i=s(null);return i},m.createRelationElement=function(e){var t={},i=_.cloneDeep(this._vectorLayer.getRelationFields(e));return _.forEach(i,function(e){e.value=null}),t.fields=i,t.id=this.generateId(),t.state="NEW",t},m.getRelationPkFieldIndex=function(e){return this._vectorLayer.getRelationPkFieldIndex(e)},m.getField=function(e,t){var t=t||this.getVectorLayer().getFieldsWithValues(),i=null;return _.forEach(t,function(t){t.name==e&&(i=t)}),i},m.isDirty=function(){return this._dirty},m.onafter=function(e,t,i){this._onaftertoolaction(e,t,i)},m.onbefore=function(e,t,i){this._onbeforetoolaction(e,t,!1,i)},m.onbeforeasync=function(e,t,i){this._onbeforetoolaction(e,t,!0,i)},m._onaftertoolaction=function(e,t,i){i=i||0,_.get(this._setterslisteners.after,e)||(this._setterslisteners.after[e]=[]),this._setterslisteners.after[e].push({fnc:t,priority:i})},m._onbeforetoolaction=function(e,t,i,n){n=n||0,_.get(this._setterslisteners.before,e)||(this._setterslisteners.before[e]=[]),this._setterslisteners.before[e].push({fnc:t,how:i?"async":"sync",priority:n})},m._setToolSettersListeners=function(e){_.forEach(this._setterslisteners.before,function(t,i){_.hasIn(e.setters,i)&&_.forEach(t,function(t){"sync"==t.how?e.onbefore(i,t.fnc,t.priority):e.onbeforeasync(i,t.fnc,t.priority)})}),_.forEach(this._setterslisteners.after,function(t,i){_.hasIn(e.setters,i)&&_.forEach(t,function(t){e.onafter(i,t.fnc,t.priority)})})},m._transformCoordinateFeatureFromMapToLayer=function(e){var t=this._mapService.getProjection().getCode(),i=this._vectorLayer.getCrs(),n=e.getGeometry().getCoordinates();return n=ol.proj.transform(n,t,i),e.getGeometry().setCoordinates(n),e},m._transformCoordinateFeatureFromLayerToMap=function(e){var t=this._mapService.getProjection().getCode(),i=this._vectorLayer.getCrs(),n=e.getGeometry().getCoordinates();return n=ol.proj.transform(n,i,t),e.getGeometry().setCoordinates(n),e},m.addFeature=function(e){e=this._transformCoordinateFeatureFromMapToLayer(e),this._editBuffer.addFeature(e)},m.updateFeature=function(e){e=this._transformCoordinateFeatureFromMapToLayer(e),this._editBuffer.updateFeature(e)},m.pickFeature=function(e){this.updateFeature(e)},m.moveFeature=function(e){this.updateFeature(e)},m.deleteFeature=function(e,t,i){this._editBuffer.deleteFeature(e,t)},m.getVectorLayer=function(){return this._vectorLayer},m.getEditVectorLayer=function(){return this._editVectorLayer},m.generateId=function(){return this._newPrefix+Date.now()},m.generateFormId=function(e){return e+"form"+Date.now()},m.isNewFeature=function(e){return!e||0==e.toString().indexOf(this._newPrefix)},m._isCompatibleType=function(e){return this._geometrytypes.indexOf(e)>-1},m._setToolsForVectorType=function(e){var t=this,i=this._toolsForGeometryTypes[e];_.forEach(i,function(e,i){t._tools[i]=e})},m._setStarted=function(e){this._started=e},m._setDirty=function(e){_.isNil(e)?this._dirty=!0:this._dirty=e,this.emit("dirty",this._dirty)},m._onSaveEditorForm=function(e,t,i,n){var o=this,n=n,e=e;return function(t,i){o.setFieldsWithValues(e,t,i),n&&n(!0),l.setModal(!1)}},m._openEditorForm=function(e,t,i){var n=this,o=this.getVectorLayer(),r=o.getFieldsWithValues(t),s=o.pk;s&&_.isNull(this.getField(s))&&_.forEach(t.getProperties(),function(e,t){var i=n.getField(t,r);i&&(i.value=e)});var a=l.showContentFactory("form"),c=this.getRelationsWithValues(t);c.then(function(e){var e=_.cloneDeep(e);a({provider:n,name:"Edita attributi "+o.name,formId:n.generateFormId(o.name),dataid:o.name,vectorLayer:o,pk:o.pk,isnew:n.isNewFeature(t.getId()),fields:r,relations:e,relationOne:n.checkOneRelation,tools:n._formTools,formComponent:n._formComponent,editor:n,buttons:[{title:"Salva",type:"save","class":"btn-danger",cbk:n._onSaveEditorForm(t,r,e,i)},{title:"Cancella",type:"cancel","class":"btn-primary",cbk:function(){i&&i(!1),l.setModal(!1)}}]})}).fail(function(){i&&i(!1),l.setModal(!1)})},t.exports=n},{"./editbuffer":21,"./tools/addfeaturetool":24,
"./tools/cutlinetool":25,"./tools/deletefeaturetool":26,"./tools/modifyfeaturetool":28,"./tools/movepointtool":29,"./tools/pickfeaturetool":30,"core/g3wobject":31,"core/map/layer/vectorlayer":40,"core/utils/utils":59,"gui/gui":91}],23:[function(e,t,i){function n(e,t){this._relationName=t,this._editorBuffer=e,this._elementsBuffer={}}var o=e("core/utils/utils").inherit,r=e("core/g3wobject");o(n,r),t.exports=n;var s=n.prototype;s.commit=function(){this._clearBuffers()},s.undoAll=function(){this._clearBuffers()},s.destroy=function(){this._clearBuffers()},s.getRelationName=function(){return this._relationName},s.generateId=function(){return this._editorBuffer.generateId()},s.getAddedElements=function(){},s.getDeletedElements=function(){},s.getUpdatedElements=function(){},s.updateRelation=function(e){var t=this;_.forEach(e.elements,function(e){t._editElementsBuffer(e)})},s._editElementsBuffer=function(e){var t=_.some(e.fields,function(e){return!_.isNil(e.value)});if(t){var i=e.id;_.has(this._elementsBuffer,i)||(this._elementsBuffer[i]=[]),this._elementsBuffer[i].push(e),this._setDirty(!0)}},s.getRelationElements=function(e,t){var i=[];return _.forEach(this._elementsBuffer,function(n){var o=n.slice(-1)[0];(o||"ALL"==e)&&(!e||e&&o.state==e)&&(t&&(o=_.cloneDeep(o),o.fields=_.map(o.fields,function(e){return{name:e.name,value:e.value}})),i.push(o))}),i},s.getRelationElementsOnlyFieldsValues=function(e){return this.getRelationElements(e,!0)},s.hasRelationElements=function(){var e=!1;return _.forEach(this._elementsBuffer,function(t){e=e||t.length>0}),e},s._setDirty=function(e){this._editorBuffer._setDirty(e)},s._clearBuffers=function(){this._elementsBuffer={},this._setDirty(!1)}},{"core/g3wobject":31,"core/utils/utils":59}],24:[function(e,t,i){function n(e,t){var t=t||{};this._running=!1,this._busy=!1,this.source=e.getEditVectorLayer().getMapLayer().getSource(),this.drawInteraction=null,this._snap=t.snap||null,this._snapInteraction=null,this._finishCondition=t.finishCondition||_.constant(!0),this._condition=t.condition||_.constant(!0),this.setters={addFeature:{fnc:n.prototype._addFeature,fallback:n.prototype._fallBack}},r(this,e)}var o=e("core/utils/utils").inherit,r=e("core/utils/utils").base,s=e("./editingtool");o(n,s),t.exports=n;var a=n.prototype;a.run=function(){var e=this;this.drawInteraction=new ol.interaction.Draw({type:this.editor.getEditVectorLayer().geometrytype,source:this.source,condition:this._condition,finishCondition:this._finishCondition});var t=this.editor._editingVectorStyle?this.editor._editingVectorStyle.add:null;this.addInteraction(this.drawInteraction),this.drawInteraction.setActive(!0),this.drawInteraction.on("drawstart",function(t){e.editor.emit("drawstart",t)}),this.drawInteraction.on("drawend",function(i){i.feature.setStyle(t),e.editor.emit("drawend",i),e._busy||(e._busy=!0,e.pause(),e.addFeature(i.feature))}),this._snap&&(this._snapInteraction=new ol.interaction.Snap({source:this._snap.vectorLayer.getSource()}),this.addInteraction(this._snapInteraction))},a.pause=function(e){_.isUndefined(e)||e?(this._snapInteraction&&this._snapInteraction.setActive(!1),this.drawInteraction.setActive(!1)):(this._snapInteraction&&this._snapInteraction.setActive(!0),this.drawInteraction.setActive(!0))},a.stop=function(){return this._snapInteraction&&(this.removeInteraction(this._snapInteraction),this._snapInteraction=null),this.removeInteraction(this.drawInteraction),this.drawInteraction=null,!0},a.removeLastPoint=function(){if(this.drawInteraction)try{this.drawInteraction.removeLastPoint()}catch(e){}},a._addFeature=function(e){return e.setStyle(null),this.editor.addFeature(e),this._busy=!1,this.pause(!1),!0},a._fallBack=function(e){this._busy=!1,this.source.getFeaturesCollection().getLength()&&(this.source.getFeaturesCollection().pop(),this.pause(!1))}},{"./editingtool":27,"core/utils/utils":59}],25:[function(e,t,i){function n(e,t){this.setters={cutLine:n.prototype._cutLine},r(this,e,t),this.steps=new c.Steps(n.steps),this._origFeature=null,this._origGeometry=null,this._newFeatures=[],this._linePickInteraction=null,this._pointPickInteraction=null,this._pointLayer=t.pointLayer||null,this._minCutPointDistance=t.minCutPointDistance||1/0,this._modType=t.modType||"MODONCUT",this._selectedLineOverlay=new ol.layer.Vector({source:new ol.source.Vector,style:new ol.style.Style({stroke:new ol.style.Stroke({color:"rgb(255,255,0)",width:4})})}),this._lineToKeepOverlay=new ol.layer.Vector({source:new ol.source.Vector})}var o=e("core/utils/utils").inherit,r=e("core/utils/utils").base,s=e("core/geometry/geom"),a=e("g3w-ol3/src/interactions/pickfeatureinteraction"),l=e("g3w-ol3/src/interactions/pickcoordinatesinteraction"),c=e("./editingtool");o(n,c),t.exports=n;var u=n.prototype;u.run=function(){var e=this;this._linePickInteraction=new a({layers:[this.layer,this.editingLayer]}),this.addInteraction(this._linePickInteraction),e.steps.next(),this._linePickInteraction.on("picked",function(t){var i,n=e._origFeature=t.feature;e._origGeometry=n.getGeometry().clone(),e._showSelection(e._origGeometry,300),e.removeInteraction(this),e._pointLayer?e._pointPickInteraction=new a({layers:[e._pointLayer]}):e._pointPickInteraction=new l,e.steps.next(),e._pointPickInteraction.on("picked",function(t){e.removeInteraction(this);var o;if(t.feature?(i=t.feature,o=i.getGeometry().getCoordinates()):o=t.coordinate,o){var r=n.getGeometry().getClosestPoint(o),a=s.distance(o,r);if(a<e._minCutPointDistance){var l=e._cut(n.getGeometry(),r);if(l){var c=l[0],u=l[1],h=e.editor.generateId();c.setId(h+"_1"),u.setId(h+"_2");var d=n.getProperties();if(delete d[n.getGeometryName()],e._showSelection(c.getGeometry(),300),setTimeout(function(){e._showSelection(u.getGeometry(),300)},300),"MODONCUT"==e._modType)e.steps.next(),e._selectLineToKeep(c,u).then(function(t){n.setGeometry(t.getGeometry().clone());var o;c.getId()==t.getId()?(delete c,o=u):u.getId()==t.getId()&&(delete u,o=c),e._newFeatures.push(o),o.setProperties(d),e.editingLayer.getSource().addFeatures([o]);var r={added:[o],updated:n,cutfeature:i};e.cutLine(r,e._modType).fail(function(){e._rollBack(),e.rerun()})});else{e.layer.getSource().removeFeature(n),e._newFeatures.push(c),e._newFeatures.push(u),e.editingLayer.getSource().addFeatures([featureToAdd,c]);var p={added:[c,u],removed:n};e.cutLine(p,e._modType).fail(function(){e._rollBack(),e.rerun()})}}else e.rerun()}}}),e.addInteraction(e._pointPickInteraction)})},u.pause=function(e){_.isUndefined(e)||e?(this._linePickInteraction.setActive(!1),this._pointPickInteraction.setActive(!1)):(this._linePickInteraction.setActive(!0),this._pointPickInteraction.setActive(!0))},u.rerun=function(){this.stop(),this.run()},u.stop=function(){this._cleanUp();var e=r(this,"stop");return e&&(this.removeInteraction(this._linePickInteraction),this.removeInteraction(this._pointPickInteraction),this._linePickInteraction=null,this._pointPickInteraction=null),e},u._cleanUp=function(){this.steps.completed(),this._origFeature=null,this._origGeometry=null,this._newFeatures=[],this._lineToKeepOverlay.setMap(null),this._selectedLineOverlay.setMap(null)},u._rollBack=function(){this._origFeature.setGeometry(this._origGeometry);try{_.forEach(this._newFeatures,function(e){self.editingLayer.getSource().removeFeature(e)})}catch(e){}},u._cutLine=function(e,t){if("MODONCUT"==t){var i=e.updated,n=e.added[0];this.editor.updateFeature(i),this.editor.addFeature(n)}else{var o=e.removed,r=e.added[0],s=e.added[1];this.editor.deleteFeature(o),this.editor.addFeature(r),this.editor.addFeature(s)}return this._busy=!1,this.pause(!1),this.rerun(),!0},u._selectLineToKeep=function(e,t){var i=$.Deferred(),n=this,o=this._lineToKeepOverlay;o.getSource().addFeatures([e,t]),o.setMap(this.editor.getMapService().viewer.map);var r=new a({layers:[this._lineToKeepOverlay]});return this.addInteraction(r),r.on("picked",function(e){o.setMap(null),n.removeInteraction(this),i.resolve(e.feature)}),i.promise()},u._fallBack=function(e){this._busy=!1,this.pause(!1)},u._cut=function(e,t){for(;t.length<e.getLayout().length;)t.push(0);var i=1/0,n=0,o=0;e.forEachSegment(function(e,r){var a=s.closestOnSegment(t,[e,r]),l=s.distance(t,a);l<i&&(i=l,n=o),o+=1});var r=e.getCoordinates(),a=r.slice(0,n+1);a.splice(a.length,0,t);var l=r.slice(n);if(l.splice(0,1,t),a.length<2||l.length<2)return!1;var c=new ol.geom.LineString;c.setCoordinates(a);var u=new ol.geom.LineString;u.setCoordinates(l);var h=new ol.Feature({geometry:c}),d=new ol.Feature({geometry:u});return[h,d]},u._showSelection=function(e,t){var i=this,t=t||null,n=this._selectedLineOverlay,o=new ol.Feature;o.setGeometry(e),n.getSource().addFeatures([o]),n.setMap(this.editor.getMapService().viewer.map),t&&setTimeout(function(){n.setMap(null),i._selectedLineOverlay.getSource().clear()},t)},u._isNew=function(e){return!_.isNil(this.editingLayer.getSource().getFeatureById(e.getId()))},n.steps=[{type:"selectline"},{type:"selectcutpoint"},{type:"selectparttokeep"}]},{"./editingtool":27,"core/geometry/geom":32,"core/utils/utils":59,"g3w-ol3/src/interactions/pickcoordinatesinteraction":72,"g3w-ol3/src/interactions/pickfeatureinteraction":73}],26:[function(e,t,i){function n(e){this.editor=e,this.drawInteraction=null,this.layer=null,this.editingLayer=null,this.setters={deleteFeature:n.prototype._deleteFeature},r(this,e)}var o=e("core/utils/utils").inherit,r=e("core/utils/utils").base,s=e("g3w-ol3/src/interactions/deletefeatureinteraction"),a=e("./editingtool");o(n,a),t.exports=n;var l=n.prototype;ol.geom.GeometryType={POINT:"Point",LINE_STRING:"LineString",LINEAR_RING:"LinearRing",POLYGON:"Polygon",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon",GEOMETRY_COLLECTION:"GeometryCollection",CIRCLE:"Circle"};var c={},u=[255,255,255,1],h=[255,0,0,1],d=3;c[ol.geom.GeometryType.POLYGON]=[new ol.style.Style({stroke:new ol.style.Stroke({color:"red",width:3}),fill:new ol.style.Fill({color:"rgba(255, 0, 0, 0.1)"})})],c[ol.geom.GeometryType.MULTI_POLYGON]=c[ol.geom.GeometryType.POLYGON],c[ol.geom.GeometryType.LINE_STRING]=[new ol.style.Style({stroke:new ol.style.Stroke({color:u,width:d+2})}),new ol.style.Style({stroke:new ol.style.Stroke({color:h,width:d})})],c[ol.geom.GeometryType.MULTI_LINE_STRING]=c[ol.geom.GeometryType.LINE_STRING],c[ol.geom.GeometryType.CIRCLE]=c[ol.geom.GeometryType.POLYGON].concat(c[ol.geom.GeometryType.LINE_STRING]),c[ol.geom.GeometryType.POINT]=[new ol.style.Style({image:new ol.style.Circle({radius:2*d,fill:new ol.style.Fill({color:h}),stroke:new ol.style.Stroke({color:u,width:d/2})}),zIndex:1/0})],c[ol.geom.GeometryType.MULTI_POINT]=c[ol.geom.GeometryType.POINT],c[ol.geom.GeometryType.GEOMETRY_COLLECTION]=c[ol.geom.GeometryType.POLYGON].concat(c[ol.geom.GeometryType.LINE_STRING],c[ol.geom.GeometryType.POINT]),c[ol.geom.GeometryType.POLYGON]=_.concat(c[ol.geom.GeometryType.POLYGON],c[ol.geom.GeometryType.LINE_STRING]),c[ol.geom.GeometryType.GEOMETRY_COLLECTION]=_.concat(c[ol.geom.GeometryType.GEOMETRY_COLLECTION],c[ol.geom.GeometryType.LINE_STRING]),l.run=function(){var e=this;this.layer=this.editor.getVectorLayer().getMapLayer(),this.editingLayer=this.editor.getEditVectorLayer().getMapLayer(),this._selectInteraction=new ol.interaction.Select({layers:[this.layer,this.editingLayer],condition:ol.events.condition.click,style:function(t,i){var n=e.editor._editingVectorStyle?e.editor._editingVectorStyle["delete"]:c[t.getGeometry().getType()];return n}}),this.addInteraction(this._selectInteraction),this._deleteInteraction=new s({features:this._selectInteraction.getFeatures()}),this.addInteraction(this._deleteInteraction),this._deleteInteraction.on("deleteend",function(t){var i=t.features.getArray()[0],n=e._isNew(i);e._busy||(e._busy=!0,e.pause(!0),e.deleteFeature(i,n).always(function(){e._busy=!1,e.pause(!1)}))})},l.pause=function(e){_.isUndefined(e)||e?(this._selectInteraction.setActive(!1),this._deleteInteraction.setActive(!1)):(this._selectInteraction.setActive(!0),this._deleteInteraction.setActive(!0))},l.stop=function(){return this._selectInteraction.getFeatures().clear(),this.removeInteraction(this._selectInteraction),this._selectInteraction=null,this.removeInteraction(this._deleteInteraction),this._deleteInteraction=null,!0},l._deleteFeature=function(e,t){var i=[],n=this.editor.getRelationsWithValues(e);return n.then(function(e){i=e}),this.editor.deleteFeature(e,i,t),this._selectInteraction.getFeatures().clear(),this._busy=!1,this.pause(!1),!0},l._fallBack=function(e){this._busy=!1,this.pause(!1)},l._isNew=function(e){return!_.isNil(this.editingLayer.getSource().getFeatureById(e.getId()))}},{"./editingtool":27,"core/utils/utils":59,"g3w-ol3/src/interactions/deletefeatureinteraction":71}],27:[function(e,t,i){function n(e,t){this._interactions=[],this.editor=e,this.layer=this.editor.getVectorLayer().getMapLayer(),this.editingLayer=this.editor.getEditVectorLayer().getMapLayer(),this.options=t||{},this.steps=null,r(this)}var o=e("core/utils/utils").inherit,r=e("core/utils/utils").base,s=e("core/g3wobject");o(n,s);var a=n.prototype;a.addInteraction=function(e){var t=this.editor.getMapService();t.addInteraction(e),this._interactions.push(e)},a.removeInteraction=function(e){var t=this._interactions,i=this.editor.getMapService();_.forEach(t,function(i,n){i==e&&t.splice(n,1)}),i.removeInteraction(e)},a.ownsInteraction=function(e){var t=!1;return _.forEach(this._interactions,function(i){i==e&&(t=!0)}),t},a.stop=function(){return this.steps&&this.steps.destroy(),!0},a.run=function(){console.log("Se appare quasto messaggio significa che non Ã¨ stato sovrascritto il metodo run() dalla sottoclasse")},n.Steps=function(e){var t=-1,e=e;this.next=function(){t+=1;var i=e[t];this.emit("step",t,i)},this.currentStep=function(){return e[t]},this.currentStepIndex=function(){return t},this.totalSteps=function(){return e.length},this.reset=function(){t=0},this.destroy=function(){this.removeAllListeners()},this.completed=function(){this.emit("complete"),this.reset()},this.insertStepAt=function(t,i){e.splice(t,0,i)}},o(n.Steps,s),t.exports=n},{"core/g3wobject":31,"core/utils/utils":59}],28:[function(e,t,i){function n(e,t){t=t||{},this.editor=e,this.isPausable=!0,this.drawInteraction=null,this.layer=null,this.editingLayer=null,this._deleteCondition=t.deleteCondition||void 0,this._snap=t.snap||null,this._snapInteraction=null,this.setters={modifyFeature:n.prototype._modifyFeature},r(this,e)}var o=e("core/utils/utils").inherit,r=e("core/utils/utils").base,s=(e("core/g3wobject"),e("g3w-ol3/src/interactions/pickfeatureinteraction")),a=e("./editingtool");o(n,a),t.exports=n;var l=n.prototype;l.run=function(){var e=this;this.layer=this.editor.getVectorLayer().getMapLayer(),this.editingLayer=this.editor.getEditVectorLayer().getMapLayer(),this.pickedFeatures=new ol.Collection,this._pickInteraction=new s({layers:[this.layer,this.editingLayer]}),this.addInteraction(this._pickInteraction),this._pickInteraction.on("picked",function(t){e.pickedFeatures.clear(),e.pickedFeatures.push(t.feature)}),this._modifyInteraction=new ol.interaction.Modify({features:this.pickedFeatures,deleteCondition:this._deleteCondition}),this.addInteraction(this._modifyInteraction);var t=null;this._modifyInteraction.on("modifystart",function(e){var i=e.features.getArray()[0];t=i.getGeometry().clone()}),this._modifyInteraction.on("modifyend",function(i){var n=i.features.getArray()[0],o=e._isNew(n);e._busy||(e._busy=!0,e.pause(!0),e.modifyFeature(n,o).fail(function(){n.setGeometry(t)}).always(function(){e._busy=!1,e.pause(!1)}))}),this._snap&&(this._snapInteraction=new ol.interaction.Snap({source:this._snap.vectorLayer.getSource()}),this.addInteraction(this._snapInteraction))},l.pause=function(e){_.isUndefined(e)||e?(this._snapInteraction&&this._snapInteraction.setActive(!1),this._pickInteraction.setActive(!1),this._modifyInteraction.setActive(!1)):(this._snapInteraction&&this._snapInteraction.setActive(!0),this._pickInteraction.setActive(!0),this._modifyInteraction.setActive(!0))},l.stop=function(){return this.pickedFeatures.clear(),this._snapInteraction&&(this.removeInteraction(this._snapInteraction),this._snapInteraction=null),this.removeInteraction(this._pickInteraction),this._pickInteraction=null,this.removeInteraction(this._modifyInteraction),this._modifyInteraction=null,!0},l._modifyFeature=function(e,t){return this.editor.updateFeature(e,t),this._busy=!1,this.pause(!1),!0},l.removePoint=function(e){if(this._modifyInteraction)try{this._modifyInteraction.removePoint()}catch(t){console.log(t)}},l._fallBack=function(e){this._busy=!1,this.pause(!1)},l._isNew=function(e){return!_.isNil(this.editingLayer.getSource().getFeatureById(e.getId()))}},{"./editingtool":27,"core/g3wobject":31,"core/utils/utils":59,"g3w-ol3/src/interactions/pickfeatureinteraction":73}],29:[function(e,t,i){function n(e){this.editor=e,this.isPausable=!0,this.drawInteraction=null,this.layer=null,this.editingLayer=null,this._origGeometry=null,this.setters={moveFeature:{fnc:n.prototype._moveFeature,fallback:n.prototype._fallBack}},r(this,e)}var o=e("core/utils/utils").inherit,r=e("core/utils/utils").base,s=e("./editingtool");o(n,s),t.exports=n;var a=n.prototype;a.run=function(){var e=this;this.layer=this.editor.getVectorLayer().getMapLayer(),this.editingLayer=this.editor.getEditVectorLayer().getMapLayer();var t=this.editor._editingVectorStyle?this.editor._editingVectorStyle.move:null;this._selectInteraction=new ol.interaction.Select({layers:[this.layer,this.editingLayer],condition:ol.events.condition.click,style:t,hitTolerance:isMobile&&isMobile.any?10:0}),this.addInteraction(this._selectInteraction),this._translateInteraction=new ol.interaction.Translate({features:this._selectInteraction.getFeatures(),hitTolerance:isMobile&&isMobile.any?10:0}),this.addInteraction(this._translateInteraction),this._translateInteraction.on("translatestart",function(t){var i=t.features.getArray()[0];e._origGeometry=i.getGeometry().clone(),e.editor.emit("movestart",i)}),this._translateInteraction.on("translateend",function(t){var i=t.features.getArray()[0];e._busy||(e._busy=!0,e.pause(),e.moveFeature(i).then(function(t){e.pause(!1)}).fail(function(){i.setGeometry(e._origGeometry)}))})},a.pause=function(e){_.isUndefined(e)||e?(this._selectInteraction.setActive(!1),this._translateInteraction.setActive(!1)):(this._selectInteraction.setActive(!0),this._translateInteraction.setActive(!0))},a.stop=function(){return this._selectInteraction.getFeatures().clear(),this.removeInteraction(this._selectInteraction),this._selectInteraction=null,this.removeInteraction(this._translateInteraction),this._translateInteraction=null,!0},a._moveFeature=function(e){return this.editor.emit("moveend",e),this.editor.moveFeature(e),this._selectInteraction.getFeatures().clear(),this._busy=!1,this.pause(!1),!0},a._fallBack=function(e){this._busy=!1,this.pause(!1)}},{"./editingtool":27,"core/utils/utils":59}],30:[function(e,t,i){function n(e){this.isPausable=!0,this.pickFeatureInteraction=null,this._running=!1,this._busy=!1,this._originalFeatureStyle=null,this.setters={pickFeature:{fnc:n.prototype._pickFeature,fallback:n.prototype._fallBack}},r(this,e)}var o=e("core/utils/utils").inherit,r=e("core/utils/utils").base,s=(e("core/utils/utils").noop,e("g3w-ol3/src/interactions/pickfeatureinteraction")),a=e("./editingtool");o(n,a),t.exports=n;var l=n.prototype;l._pickFeature=function(e){this.editor.pickFeature(e)},l.run=function(){var e=this,t=(new ol.style.Style({image:new ol.style.Circle({radius:5,fill:new ol.style.Fill({color:"red"})})}),this.editor._editingVectorStyle?this.editor._editingVectorStyle.edit:null),i=[this.editor.getVectorLayer().getMapLayer(),this.editor.getEditVectorLayer().getMapLayer()];this.pickFeatureInteraction=new s({layers:i}),this.pickFeatureInteraction.on("picked",function(i){e.editor.setPickedFeature(i.feature),e._busy||(i.feature.setStyle(t),e._busy=!0,e.pause(!0),e.pickFeature(i.feature).then(function(t){e._busy=!1,e.pause(!1)}))}),this.addInteraction(this.pickFeatureInteraction)},l.pause=function(e){_.isUndefined(e)||e?this.pickFeatureInteraction.setActive(!1):this.pickFeatureInteraction.setActive(!0)},l.stop=function(){return this.removeInteraction(this.pickFeatureInteraction),this.pickFeatureInteraction=null,!0},l._fallBack=function(e){this._busy=!1,this.pause(!1)}},{"./editingtool":27,"core/utils/utils":59,"g3w-ol3/src/interactions/pickfeatureinteraction":73}],31:[function(e,t,i){var n=e("core/utils/utils").inherit,o=e("core/utils/utils").noop,r=function(){this.setters&&this._setupListenersChain(this.setters)};n(r,EventEmitter);var s=r.prototype;s.onafter=function(e,t,i){return this._onsetter("after",e,t,!1,i)},s.onbefore=function(e,t,i){return this._onsetter("before",e,t,!1,i)},s.onbeforeasync=function(e,t,i){return this._onsetter("before",e,t,!0,i)},s.un=function(e,t){_.forEach(this.settersListeners,function(i){_.forEach(i[e],function(n,o){n.key==t&&i[e].slice(o,1)})})},s._onsetter=function(e,t,i,n,o){var r=this.settersListeners[e],s=""+Math.floor(1e6*Math.random())+Date.now();o=o||0;var a=r[t];return a.push({key:s,fnc:i,async:n,priority:o}),r[t]=_.sortBy(a,function(e){return e.priority}),s},s._setupListenersChain=function(e){var t=this;this.settersListeners={after:{},before:{}},_.forEach(e,function(e,i){var n=o,r=o;_.isFunction(e)?n=e:(n=e.fnc,r=e.fallback||o),t.settersListeners.after[i]=[],t.settersListeners.before[i]=[],t[i]=function(){function e(){c=n.apply(t,a),l.resolve(c);var e=t.settersListeners.after[i];_.forEach(e,function(e){e.fnc.apply(t,a)})}function o(){r.apply(t,a),l.reject()}function s(n){var r=!0;_.isBoolean(n)&&(r=n);var l=Array.prototype.slice.call(a);if(r===!1||u==h.length)r===!1?o.apply(t,a):(completed=e.apply(t,a),(_.isUndefined(completed)||completed===!0)&&t.emitEvent("set:"+i,a));else if(r){var c=h[u].fnc;if(h[u].async)l.push(s),u+=1,c.apply(t,l);else{var d=c.apply(t,l);u+=1,s(d)}}}var a=arguments,l=$.Deferred(),c=null,u=0,h=t.settersListeners.before[i];return u=0,s(),l.promise()}})},s.un=function(e){_.forEach(this.settersListeners,function(t){_.forEach(t,function(i,n){i.key==e&&t.splice(n,1)})})},t.exports=r},{"core/utils/utils":59}],32:[function(e,t,i){var n={distance:function(e,t){return Math.sqrt(n.squaredDistance(e,t))},squaredDistance:function(e,t){var i=e[0],n=e[1],o=t[0],r=t[1],s=o-i,a=r-n;return s*s+a*a},closestOnSegment:function(e,t){var i,n,o=e[0],r=e[1],s=t[0],a=t[1],l=s[0],c=s[1],u=a[0],h=a[1],d=u-l,p=h-c,f=0===d&&0===p?0:(d*(o-l)+p*(r-c))/(d*d+p*p||0);return f<=0?(i=l,n=c):f>=1?(i=u,n=h):(i=l+f*d,n=c+f*p),[i,n]}};t.exports=n},{}],33:[function(e,t,i){var n={};n.GeometryTypes={POINT:"Point",MULTIPOINT:"MultiPoint",LINESTRING:"Line",MULTILINESTRING:"MultiLine",POLYGON:"Polygon",MULTIPOLYGON:"MultiPolygon",GEOMETRYCOLLECTION:"GeometryCollection"},n.SupportedGeometryTypes=[n.GeometryTypes.POINT,n.GeometryTypes.MULTIPOINT,n.GeometryTypes.LINESTRING,n.GeometryTypes.MULTILINESTRING,n.GeometryTypes.POLYGON,n.GeometryTypes.MULTIPOLYGON],t.exports=n},{}],34:[function(e,t,i){function n(e){i18next.use(i18nextXHRBackend).init({lng:"it",ns:"app",fallbackLng:"it",resources:e.resources}),jqueryI18next.init(i18next,$,{tName:"t",i18nName:"i18n",handleName:"localize",selectorAttr:"data-i18n",targetAttr:"data-i18n-target",optionsAttr:"data-i18n-options",useOptionsAttr:!1,parseDefaultValueFromContent:!0})}var o=function(e){var t=i18next.t(e);return t};t.exports={init:n,t:o}},{}],35:[function(e,t,i){function n(e,t){r(this,e),this.layer=null}var o=e("core/utils/utils").inherit,r=e("core/utils/utils").base,s=(e("core/utils/geo"),e("core/map/layer/maplayer"));e("g3w-ol3/src/layers/bases");o(n,s);var a=n.prototype;a.getOLLayer=function(){var e=this._olLayer;return e||(e=this._olLayer=this._makeOlLayer()),e},a.getSource=function(){return this.getOLLayer().getSource()},a.getLayerConfigs=function(){return this.layer},a.addLayer=function(e){this.layer=e},a.toggleLayer=function(e){this._updateLayers()},a.update=function(e,t){this._updateLayer(e,t)},a.isVisible=function(){return layer.state.visible},a._makeOlLayer=function(){var e,t=this,i=this.layer.state.source?this.layer.state.source.subtype:null;switch(i){case"streets":e=BaseLayers.BING.Road;break;case"aerial":e=BaseLayers.BING.Aerial;break;case"aerialwithlabels":e=BaseLayers.BING.AerialWithLabels;break;default:e=BaseLayers.BING.Aerial}return e.getSource().on("imageloadstart",function(){t.emit("loadstart")}),e.getSource().on("imageloadend",function(){t.emit("loadend")}),e},a._updateLayer=function(e,t){this._olLayer.setVisible(this.layer.isVisible())},t.exports=n},{"core/map/layer/maplayer":38,"core/utils/geo":58,"core/utils/utils":59,"g3w-ol3/src/layers/bases":74}],36:[function(e,t,i){function n(){this._layers={},this._type="tipo di layers",this._isReady=!1,r(this)}var o=e("core/utils/utils").inherit,r=e("core/utils/utils").base,s=e("core/g3wobject");o(n,s);var a=n.prototype;a.getLoaderType=function(){return this._type},a.getLayers=function(){return this._layers},a.getLayer=function(e){return this._layers[e]},a.loadLayer=function(e,t){},a.loadLayers=function(){},a.cleanUpLayers=function(){},a.setReady=function(e){this._isReady=e},a.isReady=function(){return this._isReady},a.setMode=function(e){switch(e){case"w":this._editingMode=!0;break;case"r":this._editingMode=!1}this._mode=e,this.emit("setmode",e)},a.getMode=function(){return this._mode},t.exports=n},{"core/g3wobject":31,"core/utils/utils":59}],37:[function(e,t,i){function n(){this._layer={},this._type="vector",this._layerCodes=[],this._baseUrl="",this._mapService=null,this._loadedExtent=null,this._editingMode=!1,this._customUrlParameters="",this._vectorLayersCodes=[],this._vectorLayersData={},r(this),this.init=function(e){this._layers=e.layers||{},this._baseUrl=e.baseurl||"",this._mapService=e.mapService||null,this._layerCodes=_.keys(this._layers)}}var o=e("core/utils/utils").inherit,r=e("core/utils/utils").base,s=e("core/utils/utils").resolve,a=e("core/map/layer/vectorlayer"),l=e("./loaderlayer");o(n,l);var c=n.prototype;c.loadLayers=function(e,t){var i=this;this.setMode(e),t&&this._setCustomUrlParameters(t);var n=$.Deferred(),o=[];_.forEach(this._layers,function(e,t){_.isNull(e.vector)&&o.push(t)});var r=_.map(o,function(e){return i._setupVectorLayer(e)});return i.emit("loadingvectorlayersstart"),$.when.apply(this,r).then(function(){var e=Array.prototype.slice.call(arguments);i.emit("loadingvectolayersdatastart"),i.loadAllVectorsData(e).then(function(){i._vectorLayersCodes=e,n.resolve(e)}).fail(function(){n.reject()}).always(function(){i.emit("loadingvectorlayersend"),i.setReady(!0),i.emit("loadingvectolayersdataend")})}).fail(function(){i.emit("loadingvectorlayersend"),n.reject()}),n.promise()},c.setVectorLayersCodes=function(e){this._vectorLayersCodes=e},c.getVectorLayersCodes=function(){return this._vectorLayersCodes},c.loadAllVectorsData=function(e){var t=this,i=$.Deferred(),n=this._layers,o=this._mapService.state.bbox,r=this._loadedExtent;if(r&&ol.extent.containsExtent(r,o))return s();r?this._loadedExtent=ol.extent.extend(r,o):this._loadedExtent=o,e&&(n=[],_.forEach(e,function(e){n.push(t._layers[e])}));var a=_.map(n,function(e){return t._loadVectorData(e.vector,o)});return $.when.apply(this,a).then(function(){i.resolve(e)}).fail(function(){i.reject()}),i.promise()},c._setCustomUrlParameters=function(e){this._customUrlParameters=e},c._setupVectorLayer=function(e){var t=this,i=this._layers[e],n=$.Deferred();return this._getVectorLayerConfig(i.name).then(function(o){var r=o.vector,s=i.crs||t._mapService.getProjection().getCode(),a=t._createVectorLayer({geometrytype:r.geometrytype,format:r.format,crs:t._mapService.getProjection().getCode(),crsLayer:s,id:i.id,name:i.name,pk:r.pk,editing:t._editingMode});a.setFields(r.fields),a.setCrs(s);var l=r.relations;l&&(a.lazyRelations=!0,a.setRelations(l)),i.style&&a.setStyle(i.style),i.vector=a,n.resolve(e)}).fail(function(){n.reject()}),n.promise()},c._loadVectorData=function(e,t){var i=this;return i._getVectorLayerData(e,t).then(function(t){if(i.setVectorLayerData(e.name,t),i._editingMode&&t.featurelocks&&i.setVectorFeaturesLock(e,t.featurelocks),e.setData(t.vector.data),i._)return t})},c.getVectorLayerData=function(e){return this._vectorLayersData[e]},c.getVectorLayersData=function(){return this._vectorLayersData},c.setVectorLayerData=function(e,t){this._vectorLayersData[e]=t},c.setVectorFeaturesLock=function(e,t){e.setFeatureLocks(t)},c.cleanVectorFeaturesLock=function(e){e.cleanFeatureLocks()},c.lockFeatures=function(e){var t=this,i=$.Deferred(),n=this._mapService.state.bbox,o=this._layers[e].vector;return $.get(this._baseUrl+e+"/?lock"+this._customUrlParameters+"&in_bbox="+n[0]+","+n[1]+","+n[2]+","+n[3]).done(function(e){t.setVectorFeaturesLock(o,e.featurelocks),i.resolve(e)}).fail(function(){i.reject()}),i.promise()},c._getVectorLayerConfig=function(e){var t=$.Deferred();return $.get(this._baseUrl+e+"/?config"+this._customUrlParameters).done(function(e){t.resolve(e)}).fail(function(){t.reject()}),t.promise()},c._getVectorLayerData=function(e,t){var i,n=$.Deferred(),o="w"==this.getMode();return i=o?this._baseUrl+e.name+"/?editing":this._baseUrl+e.name+"/?",$.get(i+this._customUrlParameters+"&in_bbox="+t[0]+","+t[1]+","+t[2]+","+t[3]).done(function(e){n.resolve(e)}).fail(function(){n.reject()}),n.promise()},c._createVectorLayer=function(e){var t=new a(e);return t},c.cleanUpLayers=function(){this._loadedExtent=null},t.exports=n},{"./loaderlayer":36,"core/map/layer/vectorlayer":40,"core/utils/utils":59}],38:[function(e,t,i){function n(e){this.config=e||{},this.id=e.id,this._olLayer=null,r(this)}var o=e("core/utils/utils").inherit,r=e("core/utils/utils").base,s=e("core/g3wobject");o(n,s);var a=n.prototype;a.getId=function(){return this.id},t.exports=n},{"core/g3wobject":31,"core/utils/utils":59}],39:[function(e,t,i){function n(e,t){r(this,e),this.layer=null}var o=e("core/utils/utils").inherit,r=e("core/utils/utils").base,s=(e("core/utils/geo"),e("core/map/layer/maplayer")),a=e("g3w-ol3/src/layers/bases");o(n,s);var l=n.prototype;l.getOLLayer=function(){var e=this._olLayer;return e||(e=this._olLayer=this._makeOlLayer()),e},l.getSource=function(){return this.getOLLayer().getSource()},l.getLayerConfigs=function(){return this.layer},l.addLayer=function(e){this.layer=e},l.toggleLayer=function(e){this._updateLayers()},l.update=function(e,t){this._updateLayer(e,t)},l.isVisible=function(){return layer.state.visible},l._makeOlLayer=function(){var e=this,t=a.OSM;return t.getSource().on("imageloadstart",function(){e.emit("loadstart")}),t.getSource().on("imageloadend",function(){e.emit("loadend")}),t},l._updateLayer=function(e,t){this._olLayer.setVisible(this.layer.isVisible())},t.exports=n},{"core/map/layer/maplayer":38,"core/utils/geo":58,"core/utils/utils":59,"g3w-ol3/src/layers/bases":74}],40:[function(e,t,i){function n(e){var e=e||{};this.geometrytype=e.geometrytype||null,this.format=e.format||null,this.crs=e.crs||null,this.crsLayer=e.crsLayer||this.crs,this.id=e.id||null,this.name=e.name||"",this.pk=e.pk||"id",this._newPrefix="_new_",this._olSource=new ol.source.Vector({features:new ol.Collection}),this._olLayer=new ol.layer.Vector({name:this.name,source:this._olSource}),this._isReady=!1,this._PKinAttributes=!1,this._featuresFilter=null,this._fields=null,this._relationsDataLoaded={},this.lazyRelations=!0,this._relations=null,this._editingMode=e.editing||!1,this._loadedIds=[],this._featureLocks=null,this._crs=null}var o=e("core/utils/utils").inherit,r=(e("core/utils/utils").truefnc,e("core/utils/utils").resolve),s=(e("core/utils/utils").reject,e("core/g3wobject"));o(n,s),t.exports=n;var a=n.prototype;a.getPk=function(){return this.pk},a.setData=function(e){var t,i=this,n=[];if(this.format){switch(this.format){case"GeoJSON":var o=new ol.format.GeoJSON({geometryName:"geometry"});t=o.readFeatures(e,{dataProjection:i.crsLayer,featureProjection:i.crs})}if(this._editingMode&&this._featureLocks&&(t=_.filter(t,function(e){var t=!1;return _.forEach(i._featureLocks,function(i){i.featureid==e.getId()&&(t=!0,
n.push(e.getId()))}),t})),t&&t.length){_.isNull(this._featuresFilter)||(t=_.map(t,function(e){return i._featuresFilter(e)}));var r=_.filter(t,function(e){return!_.includes(i._loadedIds,e.getId())});this._olSource.addFeatures(r);var s=this.getSource().getFeatures()[0].getProperties();this._PKinAttributes=!!_.get(s,this.pk),this._loadedIds=_.union(this._loadedIds,n)}}else console.log("VectorLayer format not defined")},a.cleanFeatureLocks=function(){this._featureLocks=null},a.setFeatureLocks=function(e){this._featureLocks=e},a.getFeatureLocks=function(){return this._featureLocks},a.addLockId=function(e){this._featureLocks.push(e)},a.setFeatureData=function(e,t,i,n){var o=this.getFeatureById(e);if(o&&(t&&o.setId(t),i&&o.setGeometry(i),n)){var r=o.getProperties(),s=_.assign(r,n);o.setProperties(s)}return o},a.addFeature=function(e){this.getSource().addFeature(e)},a.addFeatures=function(e){this.getSource().addFeatures(e)},a.modifyFeatureGeometry=function(e,t){var i=this.getFeatures(),n=null;return _.forEach(i,function(n,o){if(n.getId()==e)return i[o].setGeometry(t),n=n[o]}),n},a.setFeaturesFilter=function(e){this._featuresFilter=e},a.setFields=function(e){this._fields=e},a.setCrs=function(e){this._crs=e},a.getCrs=function(){return this._crs},a.setPkField=function(){var e=this,t=!1;_.forEach(this._fields,function(i){i.name==e.pk&&(t=!0)}),t||this._fields},a.getFeatures=function(){return this.getSource().getFeatures()},a.getFeatureIds=function(){var e=_.map(this.getSource().getFeatures(),function(e){return e.getId()});return e},a.getFields=function(){return _.cloneDeep(this._fields)},a.getAttributes=function(){return this._fields},a.getFieldsNames=function(){return _.map(this._fields,function(e){return e.name})},a.getFieldsWithValues=function(e){var t,i,n=this,o=_.cloneDeep(this._fields);return e instanceof ol.Feature?t=e:e&&(t=this.getFeatureById(e)),t&&(i=t.getProperties()),_.forEach(o,function(e){t?this._PKinAttributes||e.name!=n.pk?e.value=i[e.name]:n.isNewFeature(t.getId())?e.value=null:e.value=t.getId():e.value=null}),o},a.setRelations=function(e){this._relations=e,_.forEach(e,function(e){_.forEach(e.fields,function(t,i){t.name==e.pk&&(e.pkFieldIndex=i)})})},a.getRelations=function(){return this._relations},a.getRelation=function(e){var t;return _.forEach(this._relations,function(i){i.name==e&&(t=i)}),t},a.hasRelations=function(){return!_.isNull(this._relations)},a.getRelationPkFieldIndex=function(e){var t;return _.forEach(e.fields,function(i,n){i.name==e.pk&&(t=n)}),t},a.getRelationElementPkValue=function(e,t){var i=this.getRelationPkFieldIndex(e);return t.fields[i].value},a.getRelationsFksKeys=function(){var e=[];return _.forEach(this._relations,function(t){e.push(t.fk)}),e},a.getRelationFields=function(e){return e.fields},a.getRelationFieldsNames=function(e){return _.map(relationFields,function(e){return e.name})},a.getRelationsWithValues=function(e){var t=this;this._relations||r([]);var i=_.cloneDeep(this._relations);if(e||this.getFeatureById(e)){if(this.lazyRelations){if(t._relationsDataLoaded[e])return r(this._relationsDataLoaded[e]);var n=$.Deferred(),o=this.getFeatureById(e).getProperties(),s={};return _.forEach(i,function(e){_.forEach(e.fk,function(e){s[e]=o[e]})}),this.getRelationsWithValuesFromFks(s).then(function(i){t._relationsDataLoaded[e]=i,n.resolve(i)}).fail(function(){n.reject()}),n.promise()}return r(this._relations)}return _.forEach(i,function(e){e.elements=[]}),r(i)},a.getRelationsWithValuesFromFks=function(e,t){var i=_.cloneDeep(this._relations),n=[];return _.forEach(i,function(i){i.elements=[];var o=i.url,r=[];_.forEach(i.fk,function(t){var i=e[t];r.push(t+"="+i)});var s=_.join(r,"&");o+="?"+s,n.push($.get(o).then(function(e){e.length&&_.forEach(e,function(e){var n={};n.fields=_.cloneDeep(i.fields),_.forEach(n.fields,function(o){if(o.value=e[o.name],o.name==i.pk){n.id=o.value;var r=t?"NEW":"OLD";n.state=r}}),i.elements.push(n)})}))}),$.when.apply(this,n).then(function(){return i})},a.getNewRelationsWithValuesFromFks=function(e){return this.getRelationsWithValuesFromFks(e,!0)},a.featureHasRelationsFksWithValues=function(e){var t=e.getProperties(),i=this.getRelationsFksKeys();return _.every(i,function(e){var i=t[e];return!_.isNil(i)&&""!=i})},a.getRelationsFksWithValuesForFeature=function(e){var t=e.getProperties(),i={},n=this.getRelationsFksKeys();return _.forEach(n,function(e){i[e]=t[e]}),i},a.setRelationsData=function(e,t){this._relationsDataLoaded[e]=t},a.setStyle=function(e){this._olLayer.setStyle(e)},a.getMapLayer=function(){return this._olLayer},a.getSource=function(){return this._olLayer.getSource()},a.getFeatureById=function(e){if(e)return this._olLayer.getSource().getFeatureById(e)},a.isVisible=function(){return this._olLayer.getVisible()},a.setVisible=function(e){this._olLayer.setVisible(e)},a.clear=function(){this.getSource().clear()},a.addToMap=function(e){e.addLayer(this._olLayer)},a.isNewFeature=function(e){return!e||0==e.toString().indexOf(this._newPrefix)}},{"core/g3wobject":31,"core/utils/utils":59}],41:[function(e,t,i){function n(e,t){this.LAYERTYPE={LAYER:"layer",MULTILAYER:"multilayer"},this.extraParams=t,this.layers=[],r(this,e)}var o=e("core/utils/utils").inherit,r=e("core/utils/utils").base,s=e("core/utils/geo"),a=e("core/map/layer/maplayer"),l=e("g3w-ol3/src/layers/rasters");o(n,a);var c=n.prototype;c.getOLLayer=function(e){var t=this._olLayer;return t||(t=this._olLayer=this._makeOlLayer(e)),t},c.getSource=function(){return this.getOLLayer().getSource()},c.getInfoFormat=function(){return"application/vnd.ogc.gml"},c.getGetFeatureInfoUrl=function(e,t,i,n){return this.getOLLayer().getSource().getGetFeatureInfoUrl(e,t,i,n)},c.getLayerConfigs=function(){return this.layers},c.addLayer=function(e){this.layers.push(e)},c.toggleLayer=function(e){_.forEach(this.layers,function(t){t.id==e.id&&(t.visible=e.visible)}),this._updateLayers()},c.update=function(e,t){this._updateLayers(e,t)},c.isVisible=function(){return this._getVisibleLayers().length>0},c.getQueryUrl=function(){var e=this.layers[0];return e.infourl&&""!=e.infourl?e.infourl:this.config.url},c.getQueryableLayers=function(){return _.filter(this.layers,function(e){return e.isQueryable()})},c._getVisibleLayers=function(e){var t=[];return _.forEach(this.layers,function(i){var n=!i.state.maxresolution||i.state.maxresolution&&i.state.maxresolution>e.resolution;i.state.visible&&n&&t.push(i)}),t},c._makeOlLayer=function(e){var t=this,i={url:this.config.url,id:this.config.id};e&&(i.layers=_.map(this.layers,function(e){return e.getWMSLayerName()}));var n=this.layers[0];n.state.source&&"wms"==n.state.source.type&&n.state.source.url&&(i.url=n.state.source.url);var o=new l.WMSLayer(i,this.extraParams);return o.getSource().on("imageloadstart",function(){t.emit("loadstart")}),o.getSource().on("imageloadend",function(){t.emit("loadend")}),o},c.checkLayerDisabled=function(e,t){var i=s.resToScale(t),n=!0;e.state.maxresolution&&(n=n&&e.state.maxresolution>t),e.state.minresolution&&(n=n&&e.state.minresolution<t),e.state.minscale&&(n=n&&e.state.minscale>i),e.state.maxscale&&(n=n&&e.state.maxscale<i),e.state.disabled=!n},c.checkLayersDisabled=function(e){var t=this;_.forEach(this.layers,function(i){t.checkLayerDisabled(i,e)})},c._updateLayers=function(e,t){this.checkLayersDisabled(e.resolution);var i=this._getVisibleLayers(e);if(i.length>0){var n={LAYERS:_.join(_.map(i,function(e){return e.getWMSLayerName()}),",")};t&&(n=_.assign(n,t)),this._olLayer.setVisible(!0),this._olLayer.getSource().updateParams(n)}else this._olLayer.setVisible(!1)},t.exports=n},{"core/map/layer/maplayer":38,"core/utils/geo":58,"core/utils/utils":59,"g3w-ol3/src/layers/rasters":75}],42:[function(e,t,i){function n(){r(this),this._mapsServices={},this.addMap=function(e){this._registerMapService(e)},this._registerMapService=function(e){var e=this._mapsServices[e.id];_.isUndefined(e)&&(this._mapsServices[e.id]=e)}}var o=e("core/utils/utils").inherit,r=e("core/utils/utils").base,s=e("core/g3wobject");o(n,s),t.exports=n},{"core/g3wobject":31,"core/utils/utils":59}],43:[function(e,t,i){var n=e("core/utils/utils").inherit,o=e("core/utils/utils").base,r=e("core/g3wobject"),s=e("core/project/projectsregistry"),a=e("./pluginsregistry"),l=function(){this.name="(no name)",this.config=null,o(this)};n(l,r);var c=l.prototype;c.getPluginService=function(){return this.service},c.setPluginService=function(e){this.service=e},c.getName=function(){return this.name},c.setName=function(e){this.name=e},c.getPluginConfig=function(){return a.getPluginConfig(this.name)},c.isCurrentProjectCompatible=function(e){var t=s.getCurrentProject();return e==t.getGid()},c.registerPlugin=function(e){return!!this.isCurrentProjectCompatible(e)&&(a.registerPlugin(this),!0)},c.setupGui=function(){},t.exports=l},{"./pluginsregistry":45,"core/g3wobject":31,"core/project/projectsregistry":51,"core/utils/utils":59}],44:[function(e,t,i){function n(e){var e=e||{};r(this,e),this.init=function(e){this.config=e}}var o=e("core/utils/utils").inherit,r=e("core/utils/utils").base,s=e("core/g3wobject");o(n,s),t.exports=n},{"core/g3wobject":31,"core/utils/utils":59}],45:[function(e,t,i){function n(){var e=this;this.config=null,this._plugins={},this.setters={registerPlugin:function(t){e._plugins[t.name]||(e._plugins[t.name]=t)}},o(this),this.init=function(e){var t=this;this.pluginsBaseUrl=e.pluginsBaseUrl,this.pluginsConfigs=e.pluginsConfigs,_.forEach(this.pluginsConfigs,function(e,i){t._setup(i,e)})},this._setup=function(e,t){if(t){var i=this.pluginsBaseUrl+e+"/js/plugin.js";$script(i)}},this.getPluginConfig=function(e){return this.pluginsConfigs[e]}}var o=e("core/utils/utils").base,r=e("core/utils/utils").inherit,s=e("core/g3wobject");r(n,s),t.exports=new n},{"core/g3wobject":31,"core/utils/utils":59}],46:[function(e,t,i){function n(){r(this),this.print=function(e){var e=e||{},t=e.type||"QGIS",i=new a(t);return i.print(e)}}var o=e("core/utils/utils").inherit,r=e("core/utils/utils").base,s=e("core/g3wobject"),a=e("./providers/printerprovider");o(n,s),t.exports=new n},{"./providers/printerprovider":47,"core/g3wobject":31,"core/utils/utils":59}],47:[function(e,t,i){function n(e){var e=e||{},t=e.serverType||"QGIS";this._provider=l[t],this.print=function(e){return this._provider.print(e)},r(this)}var o=e("core/utils/utils").inherit,r=e("core/utils/utils").base,s=e("core/g3wobject"),a=e("./qgis/printerQGISProvider"),l={QGIS:a};o(n,s),t.exports=n},{"./qgis/printerQGISProvider":48,"core/g3wobject":31,"core/utils/utils":59}],48:[function(e,t,i){function n(){s(this),this._getPrintUrl=function(e){var e=e||{},t=l.getCurrentProject(),i=e.map||"map0",n=t.getWmsUrl(),o=_.reverse(t.getLayers({ACTIVE:!0,VISIBLE:!0}));o=_.map(o,function(e){return e.getQueryLayerName()});var s={SERVICE:"WMS",VERSION:"1.3.0",REQUEST:"GetPrint",TEMPLATE:e.template,DPI:e.dpi,FORMAT:"pdf",CRS:"EPSG:"+t.state.crs,LAYERS:o.join()};return s[i+":EXTENT"]=e.extent,s[i+":ROTATION"]=e.rotation,n=n+"?"+$.param(s),r(n)},this.print=function(e){var e=e||{},t=this._getPrintUrl(e);return t}}var o=e("core/utils/utils").inherit,r=e("core/utils/utils").resolve,s=e("core/utils/utils").base,a=e("core/g3wobject"),l=e("core/project/projectsregistry");o(n,a),t.exports=new n},{"core/g3wobject":31,"core/project/projectsregistry":51,"core/utils/utils":59}],49:[function(e,t,i){function n(e){function t(e){_.forIn(e,function(e,n){if(!_.isNil(e.id)){var o=i.buildProjectLayer(e);i._layers[o.getId()]=o}_.isNil(e.nodes)||t(e.nodes)})}var i=this;this.state=e,this._layers={},t(e.layerstree),this.setters={setLayersVisible:function(e,t){_.forEach(e,function(e){i.getLayerById(e).state.visible=t})},setBaseLayer:function(e){_.forEach(i.state.baselayers,function(t){t.visible=t.id==e||t.fixed===!0})},setLayerSelected:function(e,t){_.forEach(this._layers,function(i){i.state.selected=e==i.state.id&&t||!1})}},r(this)}var o=e("core/utils/utils").inherit,r=e("core/utils//utils").base,s=e("core/g3wobject"),a=e("./projectlayer");o(n,s);var l=n.prototype;l.buildProjectLayer=function(e){var t=new a(e);return t.setProject(this),t.state.selected=!1,t.state.disabled=!1,t},l.getId=function(){return this.state.id},l.getTitle=function(){return this.state.title},l.getType=function(){return this.state.type},l.getGid=function(){return this.state.gid},l.getOverviewProjectGid=function(){return this.state.overviewprojectgid?this.state.overviewprojectgid.gid:null},l.getLayersDict=function(e){var t=this,e=e||{},i=e.ACTIVE,n=e.QUERYABLE,o=e.VISIBLE,r=e.SELECTED,s=e.SELECTEDORALL,a=e.ALLNOTSELECTED,l=e.WFS;if(s&&(r=null),_.isUndefined(n)&&_.isUndefined(o)&&_.isUndefined(i)&&_.isUndefined(r)&&_.isUndefined(s))return this._layers;var c=this._layers;if(i&&(c=_.filter(c,function(e){return i&&!e.isDisabled()})),n&&(c=_.filter(c,function(e){return n&&e.isQueryable()})),o&&(c=_.filter(c,function(e){return o&&e.isVisible()})),r&&(c=_.filter(c,function(e){return r&&e.isSelected()})),s){var u=c;c=_.filter(c,function(e){return e.isSelected()}),c=c.length?c:u}if(a){var u=c;c=_.filter(c,function(e){return!e.isSelected()}),c=c.length?c:u}return l&&(c=_.filter(c,function(e){return e.getWfsCapabilities()&&e.state.crs==t.state.crs})),c},l.getLayers=function(e){var t=this.getLayersDict(e);return _.values(t)},l.getLayerById=function(e){return this.getLayersDict()[e]},l.getLayerByName=function(e){var t=null;return _.forEach(this.getLayers(),function(t){t.getName()==e&&(t=_layer)}),t},l.getLayerAttributes=function(e){return this.getLayerById(e).getAttributes()},l.getLayerAttributeLabel=function(e,t){return this.getLayerById(e).getAttributeLabel(t)},l.toggleLayer=function(e,t){var i=this.getLayerById(e),t=t||!i.state.visible;this.setLayersVisible([e],t)},l.toggleLayers=function(e,t){this.setLayersVisible(e,t)},l.selectLayer=function(e){this.setLayerSelected(e,!0)},l.unselectLayer=function(e){this.setLayerSelected(e,!1)},l.getCrs=function(){return this.state.crs},l.getInfoFormat=function(){return"application/vnd.ogc.gml"},l.getWmsUrl=function(){return this.state.WMSUrl},l.getLegendUrl=function(e){var t=this.getWmsUrl();return sep=t.indexOf("?")>-1?"&":"?",this.getWmsUrl()+sep+"SERVICE=WMS&VERSION=1.3.0&REQUEST=GetLegendGraphic&SLD_VERSION=1.1.0&FORMAT=image/png&TRANSPARENT=true&ITEMFONTCOLOR=white&LAYERTITLE=False&ITEMFONTSIZE=10&LAYER="+e.name},t.exports=n},{"./projectlayer":50,"core/g3wobject":31,"core/utils//utils":59,"core/utils/utils":59}],50:[function(e,t,i){function n(e){this.state=e,this._project=null}var o=(e("core/geometry/geometry").GeometryTypes,{QUERY:1,EDIT:2}),r=n.prototype;r.getProject=function(){return this._project},r.setProject=function(e){this._project=e},r.getId=function(){return this.state.id},r.getName=function(){return this.state.name},r.getOrigName=function(){return this.state.origname},r.getGeometryType=function(){return this.state.geometrytype},r.getAttributes=function(){return this.state.fields},r.changeAttribute=function(e,t,i){_.forEach(this.state.fields,function(n){n.name==e&&(n.type=t,n.options=i)})},r.getAttributeLabel=function(e){var t;return _.forEach(this.getAttributes(),function(i){i.name==e&&(t=i.label)}),t},r.isSelected=function(){return this.state.selected},r.isDisabled=function(){return this.state.disabled},r.isQueryable=function(){var e=!1,t=!!(this.state.capabilities&&this.state.capabilities&&o.QUERY);return t&&(e=this.state.visible&&!this.state.disabled,_.isUndefined(this.state.infowhennotvisible)||this.state.infowhennotvisible!==!0||(e=!0)),e},r.isVisible=function(){return this.state.visible},r.getQueryLayerName=function(){var e;return e=this.state.infolayer&&""!=this.state.infolayer?this.state.infolayer:this.state.name},r.getQueryLayerOrigName=function(){var e;return e=this.state.infolayer&&""!=this.state.infolayer?this.state.infolayer:this.state.origname},r.getServerType=function(){return this.state.servertype&&""!=this.state.servertype?this.state.servertype:n.ServerTypes.QGIS},r.getCrs=function(){return this.getProject().getCrs()},r.isWMS=function(){return n.WMSServerTypes.indexOf(this.state.servertype)>-1},r.isExternalWMS=function(){return this.state.source&&this.state.source.url},r.getWMSLayerName=function(){var e=this.state.name;return this.state.source&&this.state.source.layers&&(e=this.state.source.layers),e},r.getWFSLayerName=function(){var e=this.state.origname;return this.state.source&&this.state.source.layers&&(e=this.state.source.layers),e},r.getQueryUrl=function(){var e;return e=this.state.infourl&&""!=this.state.infourl?this.state.infourl:this.getProject().getWmsUrl(),"QGIS"!=this.getServerType()&&(e+="SOURCE=wms"),e},r.setQueryUrl=function(e){this.state.inforurl=e},r.getInfoFormat=function(e){return this.state.infoformat&&""!=this.state.infoformat&&"wfs"!=e?this.state.infoformat:this.getProject().getInfoFormat()},r.setInfoFormat=function(e){this.state.infoformat=e},r.getWfsCapabilities=function(){return this.state.wfscapabilities||1==this.state.capabilities},r.getWmsUrl=function(){var e;return e=this.state.source&&"wms"==this.state.source.type&&this.state.source.url?this.state.source.url:this.getProject().getWmsUrl()},r.getLegendUrl=function(){var e=this.getWmsUrl();return sep=e.indexOf("?")>-1?"&":"?",this.getWmsUrl()+sep+"SERVICE=WMS&VERSION=1.3.0&REQUEST=GetLegendGraphic&SLD_VERSION=1.1.0&FORMAT=image/png&TRANSPARENT=true&ITEMFONTCOLOR=white&LAYERTITLE=True&ITEMFONTSIZE=10&WIDTH=300&LAYER="+this.getWMSLayerName()},n.ServerTypes={OGC:"OGC",QGIS:"QGIS",Mapserver:"Mapserver",Geoserver:"Geoserver",ArcGIS:"ArcGIS",OSM:"OSM",Bing:"Bing"},n.WMSServerTypes=[n.ServerTypes.QGIS,n.ServerTypes.Mapserver,n.ServerTypes.Geoserver,n.ServerTypes.OGC],t.exports=n},{"core/geometry/geometry":33}],51:[function(e,t,i){function n(){var e=this;this.config=null,this.initialized=!1,this.projectType=null,this.setters={setCurrentProject:function(t){e.state.currentProject=t,e.setProjectType(t.state.type)}},this.state={baseLayers:{},minScale:null,maxscale:null,currentProject:null},this._pendingProjects=[],this._projects={},r(this)}var o=e("core/utils/utils").inherit,r=e("core/utils/utils").base,s=(e("core/utils/utils").resolve,e("core/utils/utils").reject),a=e("core/g3wobject"),l=e("core/project/project");o(n,a);var c=n.prototype;c.init=function(e){var t=this;if(!this.initialized)return this.initialized=!0,this.config=e,this.setupState(),this.getProject(e.initproject).then(function(e){t.setCurrentProject(e)})},c.setProjectType=function(e){this.projectType=e},c.getConfig=function(){return this.config},c.getState=function(){return this.state},c.setupState=function(){var e=this;e.state.baseLayers=e.config.baselayers,e.state.minScale=e.config.minscale,e.state.maxScale=e.config.maxscale,e.state.crs=e.config.crs,e.state.proj4=e.config.proj4;var t=e.config.overviewproject&&e.config.overviewproject.gid?e.config.overviewproject:null;e.config.projects.forEach(function(i){i.baselayers=_.cloneDeep(e.config.baselayers),i.minscale=e.config.minscale,i.maxscale=e.config.maxscale,i.crs=e.config.crs,i.proj4=e.config.proj4,i.overviewprojectgid=t,e._pendingProjects.push(i)})},c.getProjectType=function(){return this.projectType},c.getPendingProjects=function(){return this._pendingProjects},c.getProjects=function(){return this._pendingProjects},c.getListableProjects=function(){return _.filter(this.getProjects(),function(e){return _.isNil(e.listable)?e:e.listable})},c.getCurrentProject=function(){return this.state.currentProject},c.getProject=function(e){var t,i=this,n=$.Deferred(),o=null;return this._pendingProjects.forEach(function(n){n.gid==e&&(t=n,o=i._projects[e])}),t?o?n.resolve(o):this._getProjectFullConfig(t).then(function(e){var o=_.merge(t,e);i._buildProjectTree(o),o.WMSUrl=i.config.getWmsUrl(o);var r=new l(o);return i._projects[o.gid]=r,n.resolve(r)}):s("Project doesn't exist")},c._getProjectFullConfig=function(e){var t=$.Deferred(),i=this.config.getProjectConfigUrl(e);return $.get(i).done(function(e){t.resolve(e)}),t.promise()},c._buildProjectTree=function(e){function t(e){_.forIn(e,function(n,o){if(!_.isNil(n.id)){var r=_.merge(n,i[n.id]);e[parseInt(o)]=r}_.isNil(n.nodes)||(n.title=n.name,t(n.nodes))})}var i=_.keyBy(e.layers,"id"),n=_.cloneDeep(e.layerstree);t(n),e.layerstree=n,_.forEach(e.baselayers,function(t){var i=!1;e.initbaselayer&&(i=t.id==e.initbaselayer),t.fixed&&(i=t.fixed),t.visible=i})},t.exports=new n},{"core/g3wobject":31,"core/project/project":49,"core/utils/utils":59}],52:[function(e,t,i){function n(){var e=this,t=$.Deferred();this.doSearch=function(e){var t=e.queryLayer,i=t.getQueryUrl(),n=t.getCrs(),o=e.filterObject;c.srsName+=n||"4326";var r,s;switch(ogcservertype){case"OGC":return s=this.createStandardFilter(o,t),r=this.standardSearch(i,s),a(r);case"qgis":return s=this.createQgisFilter(o),r=this.qgisSearch(t,i,s),a(r);case"mapserver":return s=this.createMapserverFilter(o),r=this.mapserverSearch(t,i,s),a(r);case"geoserver":return s=this.createGeoserverFilter(o),r=this.geoserverSearch(t,i,s),a(r);default:return!1}},this.standardSearch=function(e,t){},this.createStandardFilter=function(e,t){function i(e){var t,n=[],o="";return _.forEach(e,function(e,r,s){t=u[r],_.forEach(e,function(e){_.forEach(e,function(t,r,s){_.isArray(t)?o=i(s):(o=u[r],_.forEach(e,function(e,t,i){_.forEach(e,function(e,t,i){o=o(t,e)})})),n.push(o)})}),t=n.length>1?t.apply(this,n):n[0]}),t}c.featureTypes.push(t.getQueryLayerName);var n=[];return c.filter=i(e),n=(new ol.format.WFS).writeGetFeature(c)},this.qgisSearch=function(i,n){return $.get(searchUrl).then(function(t){e.emit("searchdone",t)}),t.promise()},this.createQGisFilter=function(e){var t;return t},this.mapserverSearch=function(e,i,n){return t.promise()},this.createMapserverFilter=function(e){var t;return t},this.geoserverSearch=function(e,i,n){return t.promise()},this.createGeoserverFilter=function(e){var t;return t},r(this)}var o=e("core/utils/utils").inherit,r=e("core/utils/utils").base,s=e("core/g3wobject"),a=e("core/utils/utils").resolve,l=ol.format.filter,c={srsName:"EPSG:",featureNS:"",featurePrefix:"",featureTypes:[],outputFormat:"application/json",filter:null},u={eq:l.equalTo,gt:l.greaterThan,gte:l.greaterThanOrEqualTo,lt:l.lessThan,lte:l.lessThanOrEqualTo,like:l.like,ilike:"",bbox:l.bbox,AND:l.and,OR:l.or,NOT:l.not};(function(){var e={propertyName:"<PropertyName>[PROP]</PropertyName>",literal:"<Literal>[VALUE]</Literal>"};return{eq:"<PropertyIsEqualTo>"+e.propertyName+e.literal+"</PropertyIsEqualTo>",gt:"<PropertyIsGreaterThan>"+e.propertyName+e.literal+"</PropertyIsGreaterThan>",gte:"",lt:"",lte:"",like:"",ilike:"",AND:"<And>[AND]</And>",OR:"<Or>[OR]</Or>"}})();o(n,s),t.exports=new n},{"core/g3wobject":31,"core/utils/utils":59}],53:[function(e,t,i){function n(){r(this),self=this,this._post=function(e,t){return e+="/",request=$.post(e,t)},this._get=function(e,t){var i=$.param(t);return e=e+"?"+i,$.get(e)},this._doRequest=function(e){var e=e||{},t=e.url,i=e.crs,n=e.filter,o=e.infoFormat,r=e.layers,r=_.map(r,function(e){return e.getQueryLayerName().replace(/ /g,"_")}),s={SERVICE:"WFS",VERSION:"1.3.0",REQUEST:"GetFeature",TYPENAME:r.join(),OUTPUTFORMAT:o,SRSNAME:"EPSG:"+i};if(n.bbox)s.BBOX=""+n.bbox,request=this._get(t,s);else{var a=n.geometry,l=ol.format.filter,c=(new ol.format.WFS).writeGetFeature({featureTypes:r,filter:l.intersects("the_geom",a)});n=c.children[0].innerHTML,s.FILTER=n,request=this._post(t,s)}return request},this.doSearch=function(e){return this._doRequest(e)}}var o=e("core/utils/utils").inherit,r=e("core/utils/utils").base,s=e("core/g3wobject");o(n,s),t.exports=new n},{"core/g3wobject":31,"core/utils/utils":59}],54:[function(e,t,i){function n(){self=this,this._submitGetFeatureInfo=function(e){var t=e.url||"",i=e.layername||null,n=e.filter||null,o=(e.bbox||s.getCurrentProject().state.extent.join(","),null),r=e.crs||"4326;";return $.get(t,{SERVICE:"WMS",VERSION:"1.3.0",REQUEST:"GetFeatureInfo",LAYERS:i,QUERY_LAYERS:i,FEATURE_COUNT:o||50,INFO_FORMAT:"application/vnd.ogc.gml",CRS:"EPSG:"+r,FILTER:n})},this.doSearch=function(e){var e=e||{},t=$.Deferred(),i=e.layers,n=e.url,o=e.crs,r=e.filter,s=this._createFilter(r,i[0].getQueryLayerName());if(!s)return t.reject().promise();var a=this._submitGetFeatureInfo({url:n,crs:o,filter:s,layername:i[0].getQueryLayerName()});return a},this._createFilter=function(e,t){function i(e){var t,n=[],o="",r="",s="'";return _.forEach(e,function(e,l,c){t=a[l],_.forEach(e,function(e){r="",_.forEach(e,function(t,l,c){if(_.isArray(t))o=i(c);else{"LIKE"!=l&&"ILIKE"!=l||(r="%"),filterOp=a[l];_.forEach(e,function(e,t,i){_.forEach(e,function(e,t,i){_.isNull(e)||_.isNaN(e)||""==_.trim(e)||(o='"'+t+'" '+filterOp+" "+s+r+e+r+s,n.push(o))})})}})}),t=n.length>0&&n.join(" "+t+" ")}),t}return!!i(e)&&t+":"+i(e)}}var o=e("core/utils/utils").inherit,r=(e("core/utils/utils").base,e("core/g3wobject")),s=(e("core/utils/utils").resolve,e("core/project/projectsregistry")),a={eq:"=",gt:">",gte:">=",lt:"<",lte:"=<",LIKE:"LIKE",ILIKE:"ILIKE",AND:"AND",OR:"OR",NOT:"!="};o(n,r),t.exports=new n},{"core/g3wobject":31,"core/project/projectsregistry":51,"core/utils/utils":59}],55:[function(e,t,i){function n(e){var e=e||{},t=e.serverType||"QGIS",i=e.ogcService||"wms";this._provider=h[t][i],this.doSearch=function(){return this._provider.doSearch(e)},r(this)}var o=e("core/utils/utils").inherit,r=e("core/utils/utils").base,s=e("core/g3wobject"),a=e("./ogc/queryWFSProvider"),l=e("./ogc/queryWFSProvider"),c=e("./qgis/queryQGISWMSProvider"),u=e("./qgis/queryQGISWFSProvider"),h={QGIS:{wms:c,wfs:u},OGC:{wms:l,wfs:a}};o(n,s),t.exports=n},{"./ogc/queryWFSProvider":52,"./qgis/queryQGISWFSProvider":53,"./qgis/queryQGISWMSProvider":54,"core/g3wobject":31,"core/utils/utils":59}],56:[function(e,t,i){function n(){var e=this;this.url="",this.filterObject={},this.queryFilterObject={},this.setMapService=function(e){this._mapService=e},this.setFilterObject=function(e){this.filterObject=e},this.getFilterObject=function(){return this.filterObject},this.createQueryFilterFromConfig=function(e){function t(e){return evalObject={},_.forEach(e,function(e,t){if(_.isArray(e))return i(t,e)}),o=e.attribute,n=e.op,evalObject[n]={},evalObject[n][o]=null,evalObject}function i(e,i){return s={},s[e]=[],_.forEach(i,function(i){s[e].push(t(i))}),s}var n,o,r={},s={};return _.forEach(e,function(e,t,n){r=i(t,e)}),r},this.createQueryFilterObject=function(e){var e=e||{},t=e.queryLayers||[],i=e.ogcService||"wms",n=e.filter||{},o=[],r=this.getInfoFromLayers(t,i);return _.forEach(r,function(e){o.push(_.merge(e,{ogcService:i,filter:n}))}),o},this._parseLayerFeatureCollection=function(e,t,i){var n="wfs"==i?e.getWMSLayerName().replace(/ /g,"_"):e.getWMSLayerName().replace(/ /g,""),o=_.cloneDeep(t);o.FeatureCollection.featureMember=[];var r=t.FeatureCollection.featureMember;r=_.isArray(r)?r:[r],_.forEach(r,function(e){var t=_.get(e,n);t&&o.FeatureCollection.featureMember.push(e)});var s=new X2JS,a=s.json2xml_str(o),l=new ol.format.WMSGetFeatureInfo;return l.readFeatures(a)},this._parseLayermsGMLOutput=function(e,t,i){var n="wfs"==i?[e.getQueryLayerOrigName()]:[e.getQueryLayerName()],o=new ol.format.WMSGetFeatureInfo({layers:n});return o.readFeatures(t)},this._parseLayerGeoJSON=function(e,t){var i=new ol.format.GeoJSON({defaultDataProjection:this.crs,geometryName:"geometry"});return i.readFeatures(t)},this.handleResponseFeaturesAndRelations=function(e){var t=null;return _.forEach(e,function(e){_.forEach(e.features,function(e){g3w_relations=e.getProperties().g3w_relations,g3w_relations&&(t=[],_.forEach(g3w_relations,function(e,i){relation={},e.length&&(relation.name=i,relation.elements=e,t.push(relation))}),t.length&&e.set("relations",t))})}),e},this.handleQueryResponseFromServer=function(t,i,n,o){var r,s,a,l=[];switch(i){case"json":s=this._parseLayerGeoJSON,a=t.vector.data;break;default:var c=new X2JS;try{r=_.isString(t)?c.xml_str2json(t):c.xml2json(t)}catch(u){return}var h=_.keys(r)[0];switch(h){case"FeatureCollection":s=this._parseLayerFeatureCollection,a=r;break;case"msGMLOutput":s=this._parseLayermsGMLOutput,a=t}}var d=0;return s&&_.forEach(n,function(t){var i=s.call(e,t,a,o);d+=i.length,l.push({layer:t,features:i})}),l},this.queryByFilter=function(e){var t=this,i=$.Deferred(),n=[];return _.forEach(e,function(e){var t=new l(e);n.push(t.doSearch(e))}),$.when.apply(this,n).done(function(n){var o=[];_.forEach(e,function(e){var i=t.handleQueryResponseFromServer(n,e.infoFormat,e.layers,e.ogcService);o=_.union(o,t.handleResponseFeaturesAndRelations(i))}),i.resolve({data:o})}).fail(function(e){i.reject(e)}),i.promise()},this.queryByLocation=function(e,t){var i=$.Deferred(),n=a.getComponent("map").getService(),o=this.getInfoFromLayers(t),r=n.getResolution(),s=n.getEpsg(),l=[];return _.forEach(o,function(t){var i=t.url.split("SOURCE");t.url=i[0],i=i.length>1?"&SOURCE"+i[1]:"";var o=t.layers,a=o[0].getInfoFormat(),u={LAYERS:_.map(o,function(e){return e.getQueryLayerName()}),QUERY_LAYERS:_.map(o,function(e){return e.getQueryLayerName()}),INFO_FORMAT:a,FEATURE_COUNT:10,FI_POINT_TOLERANCE:c,FI_LINE_TOLERANCE:c,FI_POLYGON_TOLERANCE:c,G3W_TOLERANCE:c*r},h=n.getGetFeatureInfoUrlForLayer(o[0],e,r,s,u),d=h.split("?")[1],p=t.url+"?"+d+i;l.push({url:p,infoformat:a,queryLayers:o})}),this.makeQueryForLayers(l,e,r).then(function(e){i.resolve(e)}).fail(function(e){i.reject(e)}),i.promise()},this.makeQueryForLayers=function(e,t,i){var n=this,o=$.Deferred(),r={coordinates:t,resolution:i};if(e.length>0){var s=[],a=[];_.forEach(e,function(e){var t=e.url,i=e.queryLayers,o=e.infoformat,r=e.postData,a=n.doRequestAndParse({url:t,infoFormat:o,queryLayers:i,postData:r});s.push(a)}),$.when.apply(this,s).then(function(){var e=Array.prototype.slice.call(arguments);_.forEach(e,function(e){a&&(a=_.concat(a,e))}),a=n.handleResponseFeaturesAndRelations(a),o.resolve({data:a,query:r})}).fail(function(e){o.reject(e)})}else o.resolve({data:null,query:r});return o.promise()},this.getInfoFromLayers=function(e,t){var i={};return _.forEach(e,function(e){if("wfs"==t)var n=e.getProject().getWmsUrl();else var n=e.getQueryUrl();var o=n.hashCode().toString();_.keys(i).indexOf(o)==-1&&(i[o]={url:n,layers:[],infoFormat:e.getInfoFormat(t),crs:e.getCrs(),serverType:e.getServerType()}),i[o].layers.push(e)}),i},this.doRequestAndParse=function(e){var t,e=e||{},i=e.url,n=e.infoFormat,o=e.queryLayers,r=e.postData||null,s=this,a=$.Deferred();return t=r?$.post(i,r):$.get(i),t.done(function(e){var t=s.handleQueryResponseFromServer(e,n,o);a.resolve(t)}).fail(function(){a.reject()}),a},r(this)}var o=e("core/utils/utils").inherit,r=e("core/utils/utils").base,s=e("core/g3wobject"),a=e("gui/gui"),l=e("./providers/queryprovider"),c=10;o(n,s),t.exports=new n},{"./providers/queryprovider":55,"core/g3wobject":31,"core/utils/utils":59,"gui/gui":91}],57:[function(e,t,i){var n=e("core/utils/utils").inherit,o=e("core/utils/utils").base,r=(e("core/utils/utils").Base64,e("core/g3wobject"));crossroads.ignoreState=!0,crossroads.greedy=!0;var s=function(){this._initialLocationQuery,this._routeQuery="",this.setters={setRouteQuery:function(e){this._routeQuery=e,crossroads.parse(e)}},o(this)};n(s,r);var a=s.prototype;a.init=function(){var e=window.location.search;this._setRouteQueryFromLocationQuery(e)},a.addRoute=function(e,t,i){return crossroads.addRoute(e,t,i)},a.removeRoute=function(e){return crossroads.removeRoute(e)},a.removeAllRoutes=function(){return crossroads.removeAllRoutes()},a.parse=function(e,t){return crossroads.parse(e,t)},a["goto"]=function(e){this._initialQuery||(this._initialLocationQuery=this._stripInitialQuery(location.search.substring(1))),e&&this.setRouteQuery(e)},a.makePermalink=function(e){this._initialQuery||(this._initialLocationQuery=this._stripInitialQuery(location.search.substring(1)));this._encodeRouteQuery(e);return"?"+this._initialLocationQuery+"&q="+this._encodeRouteQuery(e)},a.makeQueryString=function(e){},a.slicePath=function(e){return e.split("?")[0].split("/")},a.sliceFirst=function(e){var t=e.split("?"),i=t[1],n=t[0].split("/"),o=n[0];return e=n.slice(1).join("/"),e=[e,i].join("?"),[o,e]},a.getQueryParams=function(e){e=e.replace("?","");
var t={},i=[];i=""!=e&&e.indexOf("&")==-1?[e]:e.split("&");try{_.forEach(i,function(e){var i=e.split("="),n=i[0],o=i[1];t[n]=o})}catch(n){}return t},a.getQueryString=function(e){return e.split("?")[1]},a._getQueryPortion=function(e,t){var i;try{var n=e.split("&");_.forEach(n,function(e){var n=e.split("="),o=n[0];o==t&&(i=e)})}catch(o){}return i},a._encodeRouteQuery=function(e){return e=e.replace("?","@"),e=e.replace("&","|"),e=e.replace("=","!")},a._decodeRouteQuery=function(e){return e=e.replace("@","?"),e=e.replace("|","&"),e=e.replace("!","=")},a._setRouteQueryFromLocationQuery=function(e){var t=this._getRouteQueryFromLocationQuery(e);if(t){var i=this._decodeRouteQuery(t);this.setRouteQuery(i)}},a._getRouteQueryFromLocationQuery=function(e){return this.getQueryParams(e).q},a._stripInitialQuery=function(e){var t=this._getQueryPortion(e,"q");if(t){var i=t.length,n=e.indexOf(t);queryPrefix=_.trimEnd(e.substring(0,n),"&"),querySuffix=e.substring(n+i),querySuffix=""!=queryPrefix?querySuffix:_.trimStart(querySuffix,"&"),e=queryPrefix+querySuffix}return e},t.exports=new s},{"core/g3wobject":31,"core/utils/utils":59}],58:[function(e,t,i){var n=.28;t.exports={resToScale:function(e,t){var i,t=t||"m";switch(t){case"m":var i=1e3*e/n}return i},scaleToRes:function(e,t){var i,t=t||"m";switch(t){case"m":var i=e*n/1e3}return i}}},{}],59:[function(e,t,i){function n(e,t,i){return"undefined"==typeof i||0===+i?Math[e](t):(t=+t,i=+i,isNaN(t)||"number"!=typeof i||i%1!==0?NaN:(t=t.toString().split("e"),t=Math[e](+(t[0]+"e"+(t[1]?+t[1]-i:-i))),t=t.toString().split("e"),+(t[0]+"e"+(t[1]?+t[1]+i:i))))}Math.round10||(Math.round10=function(e,t){return n("round",e,t)}),Math.floor10||(Math.floor10=function(e,t){return n("floor",e,t)}),Math.ceil10||(Math.ceil10=function(e,t){return n("ceil",e,t)}),String.prototype.hashCode=function(){var e,t,i,n=0;if(0===this.length)return n;for(e=0,i=this.length;e<i;e++)t=this.charCodeAt(e),n=(n<<5)-n+t,n|=0;return n};var o={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){var t,i,n,r,s,a,l,c="",u=0;for(e=o._utf8_encode(e);u<e.length;)t=e.charCodeAt(u++),i=e.charCodeAt(u++),n=e.charCodeAt(u++),r=t>>2,s=(3&t)<<4|i>>4,a=(15&i)<<2|n>>6,l=63&n,isNaN(i)?a=l=64:isNaN(n)&&(l=64),c=c+this._keyStr.charAt(r)+this._keyStr.charAt(s)+this._keyStr.charAt(a)+this._keyStr.charAt(l);return c},decode:function(e){var t,i,n,r,s,a,l,c="",u=0;for(e=e.replace(/[^A-Za-z0-9+\/=]/g,"");u<e.length;)r=this._keyStr.indexOf(e.charAt(u++)),s=this._keyStr.indexOf(e.charAt(u++)),a=this._keyStr.indexOf(e.charAt(u++)),l=this._keyStr.indexOf(e.charAt(u++)),t=r<<2|s>>4,i=(15&s)<<4|a>>2,n=(3&a)<<6|l,c+=String.fromCharCode(t),64!=a&&(c+=String.fromCharCode(i)),64!=l&&(c+=String.fromCharCode(n));return c=o._utf8_decode(c)},_utf8_encode:function(e){e=e.replace(/rn/g,"n");for(var t="",i=0;i<e.length;i++){var n=e.charCodeAt(i);n<128?t+=String.fromCharCode(n):n>127&&n<2048?(t+=String.fromCharCode(n>>6|192),t+=String.fromCharCode(63&n|128)):(t+=String.fromCharCode(n>>12|224),t+=String.fromCharCode(n>>6&63|128),t+=String.fromCharCode(63&n|128))}return t},_utf8_decode:function(e){for(var t="",i=0,n=c1=c2=0;i<e.length;)n=e.charCodeAt(i),n<128?(t+=String.fromCharCode(n),i++):n>191&&n<224?(c2=e.charCodeAt(i+1),t+=String.fromCharCode((31&n)<<6|63&c2),i+=2):(c2=e.charCodeAt(i+1),c3=e.charCodeAt(i+2),t+=String.fromCharCode((15&n)<<12|(63&c2)<<6|63&c3),i+=3);return t}},r={mixin:function(e,t){return r.merge(e.prototype,t)},mixininstance:function(e,t){var i=new t;r.merge(e,i),r.merge(e.prototype,t.prototype)},merge:function(e,t){var i;for(i in t)r.hasOwn(t,i)&&(e[i]=t[i])},hasOwn:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},inherit:function(e,t){function i(){}i.prototype=t.prototype,e.superClass_=t.prototype,e.prototype=new i,e.prototype.constructor=e},base:function(e,t,i){var n=arguments.callee.caller;if(n.superClass_)return n.superClass_.constructor.apply(e,Array.prototype.slice.call(arguments,1));for(var o=Array.prototype.slice.call(arguments,2),r=!1,s=e.constructor;s;s=s.superClass_&&s.superClass_.constructor)if(s.prototype[t]===n)r=!0;else if(r)return s.prototype[t].apply(e,o);if(e[t]===n)return e.constructor.prototype[t].apply(e,o);throw Error("base called from a method of one name to a method of a different name")},noop:function(){},truefnc:function(){return!0},falsefnc:function(){return!0},resolve:function(e){var t=$.Deferred();return t.resolve(e),t.promise()},reject:function(e){var t=$.Deferred();return t.reject(e),t.promise()},Base64:o};t.exports=r},{}],60:[function(e,t,i){var n=function(e){var t=e.name||"?";if(this.name=t.split(" ").join("-").toLowerCase(),this.id=this.name+"_"+Math.floor(1e6*Math.random()),this.positionCode=e.position||"tl",this.priority=e.priority||0,!e.element){var i="ol-"+this.name.split(" ").join("-").toLowerCase(),o=e.tipLabel||this.name,r=e.label||"?";e.element=$('<div class="'+i+' ol-unselectable ol-control"><button type="button" title="'+o+'">'+r+"</button></div>")[0]}$(e.element).addClass("ol-control-"+this.positionCode);var s=e.buttonClickHandler||n.prototype._handleClick.bind(this);$(e.element).on("click",s),ol.control.Control.call(this,e),this._postRender()};ol.inherits(n,ol.control.Control);var o=n.prototype;o.getPosition=function(e){var e=e||this.positionCode,t={};return t.top=e.indexOf("t")>-1,t.left=e.indexOf("l")>-1,t},o._handleClick=function(e){e.preventDefault();var t=this,i=this.getMap(),n=null,o=i.getControls();o.forEach(function(e){e.id&&e.toggle&&e.id!=t.id&&(e.toggle(!1),"reset"==e.name&&(n=e))}),!t._toggled&&n&&n.toggle(!0)},o.shiftPosition=function(e){$(this.element).css(hWhere,hOffset+"px")},o.layout=function(e){if(e){var t=this.getPosition(),i=e.getViewport(),n=$(i).find(".ol-control-"+this.positionCode+":visible");if(n.length){previusControl=n.last();var o=t.left?previusControl.position().left:previusControl.position().right,r=t.left?"left":"right",s=previusControl[0].offsetWidth,a=$(this.element).position()[r]+o+s;$(this.element).css(r,a+"px")}}},o.setMap=function(e){e&&(this.layout(e),ol.control.Control.prototype.setMap.call(this,e))},o.hideControl=function(){var e=$(this.element).position().left,t=e,i=$(this.element).siblings(".ol-control-tl");i.each(function(){$(this).position().left>e&&(t=$(this).position().left,$(this).css("left",e+"px"),e=t)}),$(this.element).hide()},o._postRender=function(){},t.exports=n},{}],61:[function(e,t,i){function n(){var e={name:"geolocation",tipLabel:"Geolocation",label:"î¤"};o.call(this,e)}var o=e("./control");ol.inherits(n,o);var r=n.prototype;r.setMap=function(e){var t=this;o.prototype.setMap.call(this,e);var i=new ol.Geolocation({projection:e.getView().getProjection(),tracking:!0});i.once("change:position",function(e){this.getPosition()?($(t.element).removeClass("g3w-ol-disabled"),$(t.element).on("click",function(){var e=t.getMap(),n=e.getView();coordinates=i.getPosition(),n.setCenter(coordinates),t.dispatchEvent({type:"click",coordinates:coordinates})})):t.hideControl()}),i.once("error",function(e){t.hideControl()})},r.layout=function(e){o.prototype.layout.call(this,e),$(this.element).addClass("g3w-ol-disabled")},t.exports=n},{"./control":60}],62:[function(e,t,i){var n=e("./control"),o=function(e){this._toggled=this._toggled||!1,this._interactionClass=e.interactionClass||null,this._interaction=null,this._autountoggle=e.autountoggle||!1,this._geometryTypes=e.geometryTypes||[],this._onSelectLayer=e.onselectlayer||!1,this._enabled=e.enabled!==!1,this._onhover=e.onhover||!1,this._help=e.help||null,this._modalHelp=this._help?e.modalHelp||toastr:null,e.buttonClickHandler=o.prototype._handleClick.bind(this),n.call(this,e),this._help&&this._createModalHelp()};ol.inherits(o,n);var r=o.prototype;r._clearModalHelp=function(e){var t=this;$("body").delegate("#"+e,"change",function(){t._modalHelp=null})},r._showModalHelp=function(){var e=toastr.options.positionClass,t=$("#g3w-view-content");if(this._modalHelp){toastr.options.positionClass="toast-top-right",this._modalHelp.clear();var i=this._modalHelp.info(this._help);if(t){var n=t.css("width");$(i).css("right",n)}toastr.options.positionClass=e}},r._createModalHelp=function(){var e=this,t="close_button"+Math.floor(1e6*Math.random())+Date.now();this._help+='<label for="'+t+'" style="float:right">Non mostrare piÃ¹</label><input type="checkbox" id="'+t+'" class="pull-right"/>',this._onhover&&$(this.element).on("mouseenter",function(){e._enabled||e._showModalHelp()}),this._clearModalHelp(t)},r.getGeometryTypes=function(){return this._geometryTypes},r.getInteraction=function(){return this._interaction},r.isToggled=function(){return this._toggled},r.toggle=function(e){var e=void 0!==e?e:!this._toggled;this._toggled=e;var t=$(this.element).find("button").first();e?(this._showModalHelp(),this._interaction&&this._interaction.setActive(!0),t.addClass("g3w-ol-toggled")):(this._interaction&&this._interaction.setActive(!1),t.removeClass("g3w-ol-toggled"))},r.setEnable=function(e){var t=$(this.element).find("button").first();e?t.removeClass("g3w-ol-disabled"):(t.addClass("g3w-ol-disabled"),t.removeClass("g3w-ol-toggled"),this._interaction&&this._interaction.setActive(!1)),this._enabled=e},r.getEnable=function(){return this._enabled},r.getGeometryTypes=function(){return this._geometryTypes},r.setGeometryTypes=function(e){this._geometryTypes=e},r.onSelectLayer=function(){return this._onSelectLayer},r.setMap=function(e){!this._interaction&&this._interactionClass&&(this._interaction=new this._interactionClass,e.addInteraction(this._interaction),this._interaction.setActive(!1)),n.prototype.setMap.call(this,e)},r._handleClick=function(e){this._enabled&&(this.toggle(),n.prototype._handleClick.call(this,e))},t.exports=o},{"./control":60}],63:[function(e,t,i){var n=function(e){switch(this._control=null,this.positionCode=e.position||"tl",e.type){case"zoom":this._control=new ol.control.Zoom(e);break;case"zoomtoextent":this._control=new ol.control.ZoomToExtent(e);break;case"scaleline":this._control=new ol.control.ScaleLine(e);break;case"overview":this._control=new ol.control.OverviewMap(e)}$(this._control.element).addClass("ol-control-"+this.positionCode),ol.control.Control.call(this,{element:this._control.element})};ol.inherits(n,ol.control.Control),t.exports=n;var o=n.prototype;o.getPosition=function(e){var e=e||this.positionCode,t={};return t.top=e.indexOf("t")>-1,t.left=e.indexOf("l")>-1,t},o.layout=function(e){if(e){var t=this.getPosition(),i=e.getViewport(),n=$(i).find(".ol-control-"+this.positionCode);if(n.length){previusControl=n.last();var o=t.left?previusControl.position().left:previusControl.position().right,r=t.left?"left":"right",s=previusControl[0].offsetWidth,a=$(this.element).position()[r]+o+s+2;$(this.element).css(r,a+"px")}}},o.setMap=function(e){this.layout(e),this._control.setMap(e)}},{}],64:[function(e,t,i){var n=e("../utils"),o=e("./interactioncontrol"),r=function(e){this._startCoordinate=null;var t={name:"querybbox",tipLabel:"Query BBox layer",label:"î¤",interactionClass:ol.interaction.DragBox,help:"<h4>Guida - Query BBox layer</h4><ul><li>Disegna un rettangolo per interrogare gli strati evidenziati in giallo</li></ul>"};e=n.merge(e,t),o.call(this,e)};ol.inherits(r,o);var s=r.prototype;s.setMap=function(e){var t=this;o.prototype.setMap.call(this,e),this._interaction.on("boxstart",function(e){t._startCoordinate=e.coordinate}),this._interaction.on("boxend",function(e){var i=t._startCoordinate,n=e.coordinate,o=ol.extent.boundingExtent([i,n]);t.dispatchEvent({type:"bboxend",extent:o}),t._startCoordinate=null,t._autountoggle&&t.toggle()})},t.exports=r},{"../utils":77,"./interactioncontrol":62}],65:[function(e,t,i){var n=e("../utils"),o=e("./interactioncontrol"),r=e("../interactions/pickcoordinatesinteraction"),s=function(e){var t={name:"querybypolygon",tipLabel:"Query By Polygon",label:"î¤",geometryTypes:["Polygon","MultiPolygon"],onselectlayer:!0,interactionClass:r,help:"<h4>Guida - Query By Polygon</h4><ul><li>Seleziona uno strato poligonale</li><li>Clicca su una feature dello strato selezionato per lanciare la selezione</li></ul>",onhover:!0};e=n.merge(e,t),o.call(this,e)};ol.inherits(s,o);var a=s.prototype;a.setMap=function(e){var t=this;o.prototype.setMap.call(this,e),this._interaction.on("boxstart",function(e){t._startCoordinate=e.coordinate}),this._interaction.on("picked",function(e){t.dispatchEvent({type:"picked",coordinates:e.coordinate}),t._autountoggle&&t.toggle()})},t.exports=s},{"../interactions/pickcoordinatesinteraction":72,"../utils":77,"./interactioncontrol":62}],66:[function(e,t,i){var n=e("../utils"),o=e("./interactioncontrol"),r=e("../interactions/pickcoordinatesinteraction"),s=function(e){var t={name:"querylayer",tipLabel:"Query layer",label:"î¨",interactionClass:r};e=n.merge(e,t),o.call(this,e)};ol.inherits(s,o);var a=s.prototype;a.setMap=function(e){var t=this;o.prototype.setMap.call(this,e),this._interaction.on("boxstart",function(e){t._startCoordinate=e.coordinate}),this._interaction.on("picked",function(e){t.dispatchEvent({type:"picked",coordinates:e.coordinate}),t._autountoggle&&t.toggle()})},t.exports=s},{"../interactions/pickcoordinatesinteraction":72,"../utils":77,"./interactioncontrol":62}],67:[function(e,t,i){var n=e("../utils"),o=e("./interactioncontrol"),r=function(e){this._toggled=!0,this._startCoordinate=null;var t={name:"reset",tipLabel:"Pan",label:"î¤"};e=n.merge(e,t),o.call(this,e)};ol.inherits(r,o),t.exports=r;var s=r.prototype;s._postRender=function(){this.toggle(!0)}},{"../utils":77,"./interactioncontrol":62}],68:[function(e,t,i){var n=e("../utils"),o=e("./interactioncontrol"),r=e("../interactions/pickcoordinatesinteraction"),s=function(e){var t={name:"streetview",tipLabel:"StreetView",label:"î¤",interactionClass:r};this._sv=null,this._panorama=null,this._map=null,this._projection=null,this._streetViewFeature=new ol.Feature,this._streetViewFeature.setStyle(style=new ol.style.Style({text:new ol.style.Text({text:"î¤",font:"bold 30px icomoon",textBaseline:"Bottom",fill:new ol.style.Fill({color:"#3c8dbc"})})}));var i=new ol.source.Vector({features:[]});this._layer=new ol.layer.Vector({source:i}),e=n.merge(e,t),o.call(this,e)};ol.inherits(s,o);var a=s.prototype;a.getLayer=function(){return this._layer},a.setProjection=function(e){this._projection=e},a.setPosition=function(e){var t,i,n=this;this._sv||(this._sv=new google.maps.StreetViewService),this._sv.getPanorama({location:e},function(e){n._panorama=new google.maps.StreetViewPanorama(document.getElementById("streetview")),n._panorama.addListener("position_changed",function(){n.isToggled()&&(t=ol.proj.transform([this.getPosition().lng(),this.getPosition().lat()],"EPSG:4326",n._projection.getCode()),n._layer.getSource().getFeatures()[0].setGeometry(new ol.geom.Point(t)),i=n._map.getPixelFromCoordinate(t),(i[0]+15>n._map.getSize()[0]||i[1]+15>n._map.getSize()[1]||i[0]<15||i[1]<15)&&n._map.getView().setCenter(t))}),e&&e.location&&(n._panorama.setPov({pitch:0,heading:0}),n._panorama.setPosition(e.location.latLng))})},a.setMap=function(e){var t=this;this._map=e,o.prototype.setMap.call(this,e),this._interaction.on("picked",function(e){t.dispatchEvent({type:"picked",coordinates:e.coordinate}),t._autountoggle&&t.toggle()})},a.clear=function(){this._layer.getSource().clear(),this._streetViewFeature.setGeometry(null)},a.toggle=function(e){o.prototype.toggle.call(this,e),this.isToggled()?this._layer.getSource().addFeatures([this._streetViewFeature]):this.clear()},t.exports=s},{"../interactions/pickcoordinatesinteraction":72,"../utils":77,"./interactioncontrol":62}],69:[function(e,t,i){var n=e("../utils"),o=e("./interactioncontrol"),r=function(e){this._startCoordinate=null;var t={name:"zoombox",tipLabel:"Zoom to box",label:"î¤",interactionClass:ol.interaction.DragBox};e=n.merge(e,t),o.call(this,e)};ol.inherits(r,o),t.exports=r;var s=r.prototype;s.setMap=function(e){var t=this;o.prototype.setMap.call(this,e),this._interaction.on("boxstart",function(e){t._startCoordinate=e.coordinate}),this._interaction.on("boxend",function(e){var i=t._startCoordinate,n=e.coordinate,o=ol.extent.boundingExtent([i,n]);t.dispatchEvent({type:"zoomend",extent:o}),t._startCoordinate=null,t._autountoggle&&t.toggle()})}},{"../utils":77,"./interactioncontrol":62}],70:[function(e,t,i){var n=e("./utils"),o=e("./map/maphelpers");!function(e,n,o){"function"==typeof define&&define.amd?define(o):"object"==typeof i?t.exports=o():n[e]=o()}("g3wol3",this,function(){"use strict";var e=n.merge({},o);return{helpers:e}})},{"./map/maphelpers":76,"./utils":77}],71:[function(e,t,i){var n=function(e,t,i){this.type=e,this.features=t,this.coordinate=i},o=function(e){ol.interaction.Pointer.call(this,{handleDownEvent:o.handleDownEvent_,handleMoveEvent:o.handleMoveEvent_,handleUpEvent:o.handleUpEvent_,handleEvent:o.handleEvent_}),this.previousCursor_=void 0,this.lastCoordinate_=null,this.features_=void 0!==e.features?e.features:null};ol.inherits(o,ol.interaction.Pointer),o.handleEvent_=function(e){return"keydown"!=e.type?ol.interaction.Pointer.handleEvent.call(this,e):this.features_.getArray().length&&46==e.originalEvent.keyCode?(this.dispatchEvent(new n("deleteend",this.features_,event.coordinate)),!0):void 0},o.handleDownEvent_=function(e){return this.lastFeature_=this.featuresAtPixel_(e.pixel,e.map),!!this.lastFeature_&&(o.handleMoveEvent_.call(this,e),this.dispatchEvent(new n("deleteend",this.features_,e.coordinate)),!0)},o.handleMoveEvent_=function(e){var t=e.map.getTargetElement(),i=e.map.forEachFeatureAtPixel(e.pixel,function(e){return e});i?(this.previousCursor_=t.style.cursor,t.style.cursor="pointer"):(t.style.cursor=void 0!==this.previousCursor_?this.previousCursor_:"",this.previousCursor_=void 0)},o.prototype.featuresAtPixel_=function(e,t){var i=null,n=t.forEachFeatureAtPixel(e,function(e){return e});return this.features_&&_.includes(this.features_.getArray(),n)&&(i=n),i},t.exports=o},{}],72:[function(e,t,i){var n={PICKED:"picked"},o=function(e,t){this.type=e,this.coordinate=t},r=function(e){this.previousCursor_=null,ol.interaction.Pointer.call(this,{handleDownEvent:r.handleDownEvent_,handleUpEvent:r.handleUpEvent_,handleMoveEvent:r.handleMoveEvent_})};ol.inherits(r,ol.interaction.Pointer),r.handleDownEvent_=function(e){return!0},r.handleUpEvent_=function(e){return this.dispatchEvent(new o(n.PICKED,e.coordinate)),!0},r.handleMoveEvent_=function(e){var t=e.map.getTargetElement();t.style.cursor="pointer"},r.prototype.shouldStopEvent=function(){return!1},r.prototype.setActive=function(e){var t=this.getMap();if(t){var i=t.getTargetElement();i.style.cursor=""}ol.interaction.Pointer.prototype.setActive.call(this,e)},r.prototype.setMap=function(e){if(!e){var t=this.getMap().getTargetElement();t.style.cursor=""}ol.interaction.Pointer.prototype.setMap.call(this,e)},t.exports=r},{}],73:[function(e,t,i){var n={PICKED:"picked"},o=function(e,t,i){this.type=e,this.feature=i,this.coordinate=t},r=function(e){var t=this;ol.interaction.Pointer.call(this,{handleDownEvent:r.handleDownEvent_,handleUpEvent:r.handleUpEvent_,handleMoveEvent:r.handleMoveEvent_}),this.features_=e.features||null,this.layers_=e.layers||null,this.pickedFeature_=null,this.layerFilter_=function(e){return _.includes(t.layers_,e)}};ol.inherits(r,ol.interaction.Pointer),r.handleDownEvent_=function(e){return this.pickedFeature_=this.featuresAtPixel_(e.pixel,e.map),!0},r.handleUpEvent_=function(e){return this.pickedFeature_&&this.dispatchEvent(new o(n.PICKED,e.coordinate,this.pickedFeature_)),!0},r.handleMoveEvent_=function(e){var t=e.map.getTargetElement(),i=this.featuresAtPixel_(e.pixel,e.map);i?t.style.cursor="pointer":t.style.cursor=""},r.prototype.featuresAtPixel_=function(e,t){var i=null,n=t.forEachFeatureAtPixel(e,function(e){return this.features_?this.features_.indexOf(e)>-1?e:null:e},this,{layerFilter:this.layerFilter_,hitTolerance:isMobile&&isMobile.any?10:0});return n&&(i=n),i},r.prototype.shouldStopEvent=function(){return!1},r.prototype.setMap=function(e){if(!e){var t=this.getMap().getTargetElement();t.style.cursor=""}ol.interaction.Pointer.prototype.setMap.call(this,e)},t.exports=r},{}],74:[function(e,t,i){var n={};n.OSM=new ol.layer.Tile({source:new ol.source.OSM({attributions:[new ol.Attribution({html:'All maps &copy; <a href="http://www.openstreetmap.org/">OpenStreetMap</a>'}),ol.source.OSM.ATTRIBUTION],url:"http://{a-c}.tile.openstreetmap.org/{z}/{x}/{y}.png",crossOrigin:null}),id:"osm",title:"OSM",basemap:!0}),n.BING={},n.BING.Road=new ol.layer.Tile({name:"Road",visible:!1,preload:1/0,source:new ol.source.BingMaps({key:"Am_mASnUA-jtW3O3MxIYmOOPLOvL39dwMvRnyoHxfKf_EPNYgfWM9imqGETWKGVn",imagerySet:"Road"}),basemap:!0}),n.BING.AerialWithLabels=new ol.layer.Tile({name:"AerialWithLabels",visible:!0,preload:1/0,source:new ol.source.BingMaps({key:"Am_mASnUA-jtW3O3MxIYmOOPLOvL39dwMvRnyoHxfKf_EPNYgfWM9imqGETWKGVn",imagerySet:"AerialWithLabels"}),basemap:!0}),n.BING.Aerial=new ol.layer.Tile({name:"Aerial",visible:!1,preload:1/0,source:new ol.source.BingMaps({key:"Am_mASnUA-jtW3O3MxIYmOOPLOvL39dwMvRnyoHxfKf_EPNYgfWM9imqGETWKGVn",imagerySet:"Aerial"}),basemap:!0}),t.exports=n},{}],75:[function(e,t,i){var n=e("../utils"),o={};o.TiledWMSLayer=function(e,t){var i={layerObj:e,extraParams:t||{},tiled:!0};return o._WMSLayer(i)},o.WMSLayer=function(e,t){var i={layerObj:e,extraParams:t||{}};return o._WMSLayer(i)},o._WMSLayer=function(e){var t=e.layerObj,i=e.extraParams,o=e.tiled||!1,r={LAYERS:t.layers||"",VERSION:"1.3.0",TRANSPARENT:!0,SLD_VERSION:"1.1.0"};r=n.merge(r,i);var s,a,l={url:t.url,params:r,ratio:1},c={id:t.id,name:t.name,opacity:t.opacity||1,visible:t.visible,maxResolution:t.maxResolution};o?(a=new ol.source.TileWMS(l),s=ol.layer.Tile):(a=new ol.source.ImageWMS(l),s=ol.layer.Image),c.source=a;var u=new s(c);return u},t.exports=o},{"../utils":77}],76:[function(e,t,i){BaseLayers=e("../layers/bases");var n={createViewer:function(e){return new o(e)}},o=function(e){var t=ol.control.defaults({attributionOptions:{collapsible:!1},zoom:!1,attribution:!1}),i=ol.interaction.defaults().extend([new ol.interaction.DragRotate]);i.removeAt(1);var n;n=e.view instanceof ol.View?e.view:new ol.View(e.view);var o={controls:t,interactions:i,ol3Logo:!1,view:n,keyboardEventTarget:document};e.id&&(o.target=e.id);var r=new ol.Map(o);this.map=r};o.prototype.destroy=function(){this.map&&(this.map.dispose(),this.map=null)},o.prototype.getView=function(){return this.map.getView()},o.prototype.updateMap=function(e){},o.prototype.updateView=function(){},o.prototype.getMap=function(){return this.map},o.prototype.setTarget=function(e){this.map.setTarget(e)},o.prototype.goTo=function(e,t){var t=t||{},i=t.animate||!0,n=t.zoom||!1,o=this.map.getView();if(i){o.animate({duration:500,center:o.getCenter()}),o.animate({duration:500,resolution:o.getResolution()})}o.setCenter(e),n&&o.setZoom(n)},o.prototype.goToRes=function(e,t){var i=i||{},n=i.animate||!0,o=this.map.getView();if(n){o.animate({duration:300,center:o.getCenter()}),o.animate({duration:300,resolution:o.getResolution()})}o.setCenter(e),o.setResolution(t)},o.prototype.fit=function(e,t){var i=this.map.getView(),t=t||{},n=t.animate||!0;if(n){i.animate({duration:300,center:i.getCenter()}),i.animate({duration:300,resolution:i.getResolution()})}t.animate&&delete t.animate,t.constrainResolution=t.constrainResolution||!0,i.fit(e,this.map.getSize(),t)},o.prototype.getZoom=function(){var e=this.map.getView();return e.getZoom()},o.prototype.getResolution=function(){var e=this.map.getView();return e.getResolution()},o.prototype.getCenter=function(){var e=this.map.getView();return e.getCenter()},o.prototype.getBBOX=function(){return this.map.getView().calculateExtent(this.map.getSize())},o.prototype.getLayerByName=function(e){for(var t=this.map.getLayers(),i=t.getLength(),n=0;n<i;n++)if(e===t.item(n).get("name"))return t.item(n);return null},o.prototype.removeLayerByName=function(e){var t=this.getLayerByName(e);t&&(this.map.removeLayer(t),delete t)},o.prototype.getActiveLayers=function(){var e=[];return this.map.getLayers().forEach(function(t){var i=t.getProperties();1!=i.basemap&&i.visible&&e.push(t)}),e},o.prototype.removeLayers=function(){this.map.getLayers().clear()},o.prototype.getLayersNoBase=function(){var e=[];return this.map.getLayers().forEach(function(t){var i=t.getProperties();1!=i.basemap&&e.push(t)}),e},o.prototype.addBaseLayer=function(e){var t;t=e?BaseLayers[e]:BaseLayers.BING.Aerial,this.map.addLayer(t)},o.prototype.changeBaseLayer=function(e){var t=this.getLayerByName(layername),i=this.map.getLayers();i.insertAt(0,t)},t.exports=n},{"../layers/bases":74}],77:[function(e,t,i){var n={merge:function(e,t){var i={};for(var n in e)i[n]=e[n];for(var n in t)i[n]=t[n];return i}};t.exports=n},{}],78:[function(e,t,i){t.exports='<!-- item template -->\n<div id="catalog" class="tabbable-panel catalog">\n  <!--<div class="title">{{ title }}</div>-->\n  <div class="tabbable-line">\n    <ul class="nav nav-tabs" role="tablist">\n      <li role="presentation" class="active"><a href="#tree" aria-controls="tree" role="tab" data-toggle="tab" data-i18n="tree">Data</a></li>\n      <li v-if="hasBaseLayers" role="presentation"><a href="#baselayers" aria-controls="baselayers" role="tab" data-toggle="tab" data-i18n="baselayers">Layer Base</a></li>\n      <li role="presentation"><a href="#legend" aria-controls="legend" role="tab" data-toggle="tab" data-i18n="legend">Legenda</a></li>\n    </ul>\n    <div  class="tab-content">\n      <div role="tabpanel" class="tab-pane active tree" id="tree">\n        <ul class="tree-root">\n          <tristate-tree :highlightlayers="highlightlayers" :layerstree="layerstree" class="item" v-for="layerstree in layerstree">\n          </tristate-tree>\n        </ul>\n      </div>\n      <div v-if="hasBaseLayers" role="tabpanel" class="tab-pane baselayers" id="baselayers">\n        <form>\n          <ul>\n            <li v-if="!baselayer.fixed" v-for="baselayer in baselayers">\n              <div class="radio">\n                <label><input type="radio" name="baselayer" v-checked="baselayer.visible" @click="setBaseLayer(baselayer.id)">{{ baselayer.title }}</label>\n              </div>\n            </li>\n          </ul>\n        </form>\n      </div>\n      <layerslegend :layerstree="layerstree"></layerslegend>\n    </div>\n  </div>\n</div>\n'},{}],79:[function(e,t,i){function n(e){function t(e){var t=e.getService();i.state.visible=!t.state.hidden,t.onafter("setHidden",function(e){i.state.visible=!t.state.hidden,i.state.expanded=!0})}r(this);var i=this;if(this.id="catalog-component",this.title="catalog",this.mapComponentId=e.mapcomponentid,this.internalComponent=new f,this.mapComponentId){var n=c.getComponent(this.mapComponentId);n?t(n):l.on("componentregistered",function(e){e.getId()==i.mapComponentId&&t(e)})}s(this,e)}var o=e("core/utils/utils").inherit,r=e("core/utils/utils").base,s=e("core/utils/utils").merge,a=e("gui/vue/component"),l=e("gui/componentsregistry"),c=e("gui/gui"),u=e("core/project/projectsregistry"),h=e("gui/map/control/registry"),d=new Vue,p={template:e("./catalog.html"),data:function(){return{prstate:u.state,highlightlayers:!1}},computed:{project:function(){return this.prstate.currentProject},title:function(){return this.project.state.title},layerstree:function(){return this.project.state.layerstree},baselayers:function(){return this.project.state.baselayers},hasBaseLayers:function(){return this.project.state.baselayers.length>0}},methods:{setBaseLayer:function(e){this.project.setBaseLayer(e)}},mounted:function(){var e=this;d.$on("treenodetoogled",function(t){e.project.toggleLayer(t.id)}),d.$on("treenodestoogled",function(t,i){var n=_.map(t,"id");e.project.toggleLayers(n,i)}),d.$on("treenodeselected",function(t){var i=c.getComponent("map").getService();t.selected?(e.project.unselectLayer(t.id),i.emit("cataloglayerunselected")):(e.project.selectLayer(t.id),i.emit("cataloglayerselected"))}),h.onafter("registerControl",function(t,i){"querybbox"==t&&i.getInteraction().on("propertychange",function(t){"active"==t.key&&(e.highlightlayers=!t.oldValue)})})}},f=Vue.extend(p);Vue.component("g3w-catalog",p),Vue.component("tristate-tree",{template:e("./tristate-tree.html"),props:{layerstree:{},checked:!1,highlightlayers:!1},data:function(){return{expanded:this.layerstree.expanded,parentChecked:!1,controltoggled:!1,n_childs:this.layerstree.nodes?this.layerstree.nodes.length:0}},watch:{checked:function(e){this.layerstree.visible=e}},computed:{isFolder:function(){var e=!!this.n_childs;if(e){var t=0;_.forEach(this.layerstree.nodes,function(e){e.visible&&(t+=1)}),this.n_parentChilds=this.n_childs-t}return e},isHidden:function(){return this.layerstree.hidden&&this.layerstree.hidden===!0},selected:function(){var e=this.layerstree.selected?"SI":"NO";return e},isHighLight:function(){var e=u.getCurrentProject();return this.highlightlayers&&e.state.crs==this.layerstree.crs&&1==this.layerstree.wfscapabilities}},methods:{toggle:function(e){var t="true"==e;this.isFolder&&!t?this.layerstree.expanded=!this.layerstree.expanded:t?(this.parentChecked&&!this.n_parentChilds?this.parentChecked=!1:this.parentChecked&&this.n_parentChilds?this.parentChecked=!0:this.parentChecked=!this.parentChecked,d.$emit("treenodestoogled",this.layerstree.nodes,this.parentChecked)):d.$emit("treenodetoogled",this.layerstree)},select:function(){this.isFolder||d.$emit("treenodeselected",this.layerstree)},triClass:function(){return this.n_parentChilds?this.n_parentChilds>0&&this.n_parentChilds<this.n_childs?"fa-square":"fa-square-o":"fa-check-square-o"}}}),Vue.component("layerslegend",{template:e("./legend.html"),props:["layerstree"],data:function(){return{}},computed:{visiblelayers:function(){function e(i){_.forIn(i,function(i,n){!_.isNil(i.id)&&i.visible&&t.push(i),_.isNil(i.nodes)||e(i.nodes)})}var t=[],i=this.layerstree;return e(i),t}},watch:{layerstree:{handler:function(e,t){},deep:!0}}}),Vue.component("layerslegend-item",{template:e("./legend_item.html"),props:["layer"],computed:{legendurl:function(){var e=u.getCurrentProject().getLayerById(this.layer.id);if(e)return e.getLegendUrl()}},methods:{openform:function(){}}}),o(n,a),t.exports=n},{"./catalog.html":78,"./legend.html":80,"./legend_item.html":81,"./tristate-tree.html":82,"core/project/projectsregistry":51,"core/utils/utils":59,"gui/componentsregistry":84,"gui/gui":91,"gui/map/control/registry":95,"gui/vue/component":128}],80:[function(e,t,i){t.exports='<div role="tabpanel" class="tab-pane" id="legend">\n  <layerslegend-item :layer="layer" v-for="layer in visiblelayers"></layerslegend-item>\n</div>\n'},{}],81:[function(e,t,i){t.exports='  <div><img :src="legendurl"></div>\n'},{}],82:[function(e,t,i){t.exports='<li class="tree-item" :class="{selected: layerstree.selected }">\n  <span :class="{bold: isFolder, \'fa-chevron-down\': layerstree.expanded, \'fa-chevron-right\': !layerstree.expanded}" @click="toggle" v-if="isFolder" class="fa"></span>\n  <span v-if="isFolder" @click="toggle(\'true\')" :class="[triClass()]" class="fa"></span>\n  <span v-else @click="toggle" :class="[layerstree.visible  ? \'fa-check-square-o\': \'fa-square-o\',layerstree.disabled  ? \'disabled\': \'\']" class="fa" style="cursor:default"></span>\n  <span id="tree-node-title" :class="{bold: isFolder, disabled: layerstree.disabled, highlightlayer: isHighLight }" @click="select">{{layerstree.title}}</span>\n  <ul v-show="layerstree.expanded" v-if="isFolder">\n    <tristate-tree :n_parent-childs="n_parentChilds" :layerstree="layerstree" :checked="parentChecked" v-for="layerstree in layerstree.nodes">\n    </tristate-tree>\n  </ul>\n</li>\n\n\n\n\n'},{}],83:[function(e,t,i){var n=e("core/utils/utils").inherit,o=e("core/utils/utils").merge,r=e("core/utils/utils").base,s=e("core/g3wobject"),a=["methods","computed","data","components"],l=function(e){e=e||{},this.internalComponent=null,this.id=e.id||1e3*Math.random(),this.title=e.title||"",this.state={visible:e.visible||!0,open:e.open||!1},this.setters={setOpen:function(e){this.state.open=e,this._setOpen();
},setVisible:function(e){this.state.visible=e,this._setVisible()}},r(this)};n(l,s);var c=l.prototype;c.getId=function(){return this.id},c.setId=function(e){this.id=e},c.getOpen=function(){return this.state.open},c.getVisible=function(){return this.state.visible},c.getTitle=function(){return this.state.title},c.setTitle=function(e){this.state.title=e},c.getService=function(){return this._service},c.setService=function(e){this._service=e},c.getInternalComponent=function(){return this.internalComponent},c.setInternalComponent=function(e){!e&&this.internalComponentClass?this.internalComponent=new this.internalComponentClass:this.internalComponent=e},c.createVueComponent=function(e){return _.cloneDeep(e)},c.addInternalComponentData=function(e){_.merge(this.internalComponent,e)},c.overwriteServiceMethod=function(e,t){this._service[e]=t},c.overwriteServiceMethods=function(e){var t=this;_.forEach(e,function(e,i){t.overwriteServiceMethod(i,e)})},c.extendService=function(e){this._service&&o(this._service,e)},c.extendInternalComponent=function(e){var t=this;this.vueComponent?_.forEach(e,function(e,i){if(a.indexOf(i)>-1)switch(i){case"methods":t.extendInternalComponentMethods(e);break;case"components":t.extendInternalComponentComponents(e);break;default:o(t.vueComponent[i],e)}}):this.vueComponent=e},c.extendInternalComponentComponents=function(e){e&&o(this.vueComponent.components,e)},c.extendInternalComponentMethods=function(e){e&&(_.forEach(e,function(t,i){t instanceof Function||delete e[i]}),o(this.vueComponent.methods,e))},c.extendInternalComponentComputed=function(e){e&&(_.forEach(e,function(t,i){t instanceof Function||delete e[i]}),o(this.vueComponent.computed,e))},c.setInternalComponentTemplate=function(e){e&&(this.vueComponent.template=e)},c.getInternalTemplate=function(){return this.vueComponent.template},c.mount=function(e){},c.unmount=function(){},c.ismount=function(){return!0},c._setOpen=function(){},c._setVisible=function(){},c.layout=function(e,t){},t.exports=l},{"core/g3wobject":31,"core/utils/utils":59}],84:[function(e,t,i){function n(){this.components={},this.registerComponent=function(e){var t=e.getId();this.components[t]||(this.components[t]=e,this.emit("componentregistered",e))},this.getComponent=function(e){return this.components[e]},this.getComponents=function(){return this.components},this.unregisterComponent=function(e){var t=this._components[e];t&&(_.isFunction(t.destroy)&&t.destroy(),delete t,this._components[e]=null)},s(this)}var o=e("core/g3wobject"),r=e("core/utils/utils").inherit,s=e("core/utils/utils").base;r(n,o),t.exports=new n},{"core/g3wobject":31,"core/utils/utils":59}],85:[function(e,t,i){function n(e){var e=e||{},t=this;this._mapService=e.mapService||a.getComponent("map").getService(),this._layerCodes=e.layerCodes||{},this._editorClass=e.editorClass||{},this._layers=e.layers||{},this._loader=e.loader||new l;var i={resolution:1};this._formClass=e.formClass||c,this._toolStepsMessages=e.toolStepsMessages||{},this._loadDataOnMapViewChangeListener=null,this._currentEditingLayer=null,this.state={editing:{on:!1,enabled:!1,layerCode:null,toolType:null,startingEditingTool:!1,toolstep:{n:null,total:null,message:null}},retrievingData:!1,hasEdits:!1},this.init=function(e){var t=this;this.config=e;var n={layers:this._layers,baseurl:this.config.baseurl,mapService:this._mapService};this._loader.init(n),this._loader.on("loadingvectorlayersstart",function(){t.state.retrievingData=!0}),this._loader.on("loadingvectorlayersend",function(){t.state.retrievingData=!1}),this._mapService.on("pointerInteractionSet",function(e){var i=t._getCurrentEditingLayer();if(i){var n=i.editor.getActiveTool().instance;n&&!n.ownsInteraction(e)&&t._stopEditingTool()}}),this._mapService.onafter("setMapView",function(e,n){t.state.editing.enabled=n<i.resolution}),this.state.editing.enabled=this._mapService.getResolution()<i.resolution,_.forEach(this._layers,function(i,n){var o=e.layers[n].id,r=t._mapService.getProject().getLayerById(o);i.name=r.getOrigName(),i.id=o})},this.setLoader=function(e){this._loader=e},this.getLoader=function(){return this._loader},this.setLayers=function(e){this._layers=e},this.getLayers=function(e){return this._layers},this.getLayer=function(e){return this._layers[e]},this.setLayersCode=function(e){this._layerCodes=e},this.getLayerCodes=function(){return this._layerCodes},this.setFormClass=function(e){this._formClass=e},this.getFormClass=function(){return this._formClass},this.stop=function(){var e=$.Deferred();return this.state.editing.on?this._cancelOrSave().then(function(){t._stopEditing(),e.resolve()}).fail(function(){e.reject()}):e.resolve(),e.promise()},this.toggleEditing=function(){var e=$.Deferred();if(this.state.editing.enabled&&!this.state.editing.on)this._startEditing();else if(this.state.editing.on)return this.stop();return e.promise()},this.saveEdits=function(){this._cancelOrSave(2)},this.toggleEditTool=function(e,t){var i=this,n=this._layers[e];if(n){var o=this._getCurrentEditingLayer();o&&e==o.layerCode?t==o.editor.getActiveTool().getType()?this._stopEditingTool():(this._stopEditingTool(),this._startEditingTool(o,t)):o&&o.editor.isStarted()?this._cancelOrSave(2).then(function(){i._stopEditor()&&i._startEditingTool(n,t)}):this._startEditingTool(n,t)}},this._setUpVectorLayer=function(e,t){this._layers[e].vector=t},this._setUpEditor=function(e){var t=this,i={mapService:t._mapService,formClass:this._formClass},n=this._layers[e].vector,o=new t._editorClass[e](i);o.setVectorLayer(n),o.on("dirty",function(e){t.state.hasEdits=e}),this._layers[e].editor=o},this._startEditing=function(){if(!this.state.editing.on&&!this.state.retrievingData){var e=this;this._loader.loadLayers("w").then(function(t){_.forEach(t,function(t){e._setUpEditor(t)}),e._addToMap(),e.state.editing.on=!0,e.emit("editingstarted"),e._loadDataOnMapViewChangeListener||(e._loadDataOnMapViewChangeListener=e._mapService.onafter("setMapView",function(){e.state.editing.on&&e.state.editing.enabled&&e._loader.loadAllVectorsData()}))}).fail(function(){a.notify.error(o("could_not_load_vector_layers"))})}},this._stopEditing=function(e){this._stopEditor(e)&&(_.forEach(this._layers,function(e,i){var n=e.vector;t._mapService.viewer.removeLayerByName(n.name),e.vector=null,e.editor.destroy(),e.editor=null,t._unlockLayer(t._layers[i])}),this._updateEditingState(),t.state.editing.on=!1,t._cleanUp(),t.emit("editingstopped"))},this._cleanUp=function(){this._loader.cleanUpLayers()},this._startEditor=function(e){return!!e.editor.start(this)&&(this._setCurrentEditingLayer(e),!0)},this._startEditingTool=function(e,t,i){this.state.startingEditingTool=!0;var n=!0;return e.editor.isStarted()||(n=this._startEditor(e)),n&&e.editor.setTool(t,i)?(this._updateEditingState(),this.state.startingEditingTool=!1,!0):(this.state.startingEditingTool=!1,!1)},this._stopEditor=function(e){var t=!0,i=this._getCurrentEditingLayer();return i&&(t=i.editor.stop(e),t&&this._setCurrentEditingLayer()),t},this._stopEditingTool=function(){var e=!0,t=this._getCurrentEditingLayer();return t&&(e=t.editor.stopTool(),e&&this._updateEditingState()),e},this._cancelOrSave=function(e){var t=$.Deferred();try{var i=1;e&&(i=e);var n=this,o={};_.forEach(this._layers,function(e,t){e.editor.isDirty()&&(o[t]=e.editor)}),_.keys(o).length?this._askCancelOrSave(i).then(function(e){"save"===e?n._saveEdits(o).then(function(e){t.resolve()}).fail(function(e){t.reject()}):"nosave"==e?t.resolve():"cancel"==e&&t.reject()}):t.resolve()}catch(r){t.reject()}return t.promise()},this._askCancelOrSave=function(e){var t=$.Deferred(),i={SAVE:{label:"Salva",className:"btn-success",callback:function(){t.resolve("save")}},NOSAVE:{label:"Termina senza salvare",className:"btn-danger",callback:function(){t.resolve("nosave")}},CANCEL:{label:"Annulla",className:"btn-primary",callback:function(){t.resolve("cancel")}}};switch(e){case 1:buttons={save:i.SAVE,nosave:i.NOSAVE,cancel:i.CANCEL};break;case 2:buttons={save:i.SAVE,cancel:i.CANCEL}}return a.dialog.dialog({message:"Vuoi salvare definitivamente le modifiche?",title:"Salvataggio modifica",buttons:buttons}),t.promise()},this._saveEdits=function(e){function i(e){_.forIn(e,function(t,o){if(_.isArray(t)&&(n=t[0]),_.isObject(t)&&i(e[o]),n)return!1})}var n,o=$.Deferred();return this._sendEdits(e).then(function(i){a.notify.success("I dati sono stati salvati correttamente"),t._commitEdits(e,i),t._mapService.refreshMap(),o.resolve()}).fail(function(e){e?(i(e.error.data),a.notify.error("<h4>Errore nel salvataggio sul server</h4><h5>"+n+"</h5>")):a.notify.error("Errore nel salvataggio sul server"),o.resolve()}),o.promise()},this._sendEdits=function(e){var t=$.Deferred(),i=_.map(e,function(e){return{layername:e.getVectorLayer().name,edits:e.getEditedFeatures()}});return this._postData(i).then(function(e){e.result?t.resolve(e.response):t.reject(e.response)}).fail(function(e){t.reject(e.response)}),t.promise()},this._commitEdits=function(e,t){_.forEach(e,function(e){t&&t["new"].length>0?(_.forEach(t["new"],function(t){var i=t.clientid,n=t.id;e.getEditVectorLayer().setFeatureData(i,n,null,t),e.commit(t)}),_.forEach(t.new_lockids,function(t){e.getVectorLayer().addLockId(t)})):e.commit()})},this._undoEdits=function(e){var t=this._getCurrentEditingLayer().layerCode;e[t];this._stopEditing(!0)},this._updateEditingState=function(){var e=this._getCurrentEditingLayer();e?(this.state.editing.layerCode=e.layerCode,this.state.editing.toolType=e.editor.getActiveTool().getType()):(this.state.editing.layerCode=null,this.state.editing.toolType=null),this._updateToolStepsState()},this._updateToolStepsState=function(){var e,t=this,i=this._getCurrentEditingLayer();if(i&&(e=i.editor.getActiveTool()),e&&e.getTool()){var n=e.getTool();n.steps&&(this._setToolStepState(e),n.steps.on("step",function(i,n){t._setToolStepState(e)}),n.steps.on("complete",function(){t._setToolStepState()}))}else t._setToolStepState()},this._setToolStepState=function(e){var t,i,n;if(_.isUndefined(e))t=null,i=null,n=null;else{var o=e.getTool(),r=this._toolStepsMessages[e.getType()];t=o.steps.currentStepIndex(),i=o.steps.totalSteps(),n=r[t],_.isUndefined(n)&&(t=null,i=null,n=null)}this.state.editing.toolstep.n=t+1,this.state.editing.toolstep.total=i,this.state.editing.toolstep.message=n},this._getCurrentEditingLayer=function(){return this._currentEditingLayer},this._setCurrentEditingLayer=function(e){e?this._currentEditingLayer=e:this._currentEditingLayer=null},this._addToMap=function(){var e=this._mapService.viewer.map,i=this.getLayerCodes();_.forEach(i,function(i){t._layers[i].vector.addToMap(e)})},this._postData=function(e){if(e.length>1)return this._postBatchData(e);var t=e[0].layername,i=e[0].edits,n=JSON.stringify(i);return $.post({url:this.config.baseurl+t+"/",data:n,contentType:"application/json"})},this._postBatchData=function(e){var t={};_.forEach(e,function(e){t[e.layername]=e.edits});var i=JSON.stringify(t);return $.post({url:this.config.baseurl,data:i,contentType:"application/json"})},this._unlock=function(){var e=this.getLayerCodes();_.map(e,function(e){return t._unlockLayer(t._layers[e])})},this._unlockLayer=function(e){$.get(this.config.baseurl+e.name+"/?unlock")}}var o=e("core/i18n/i18n.service").t,r=e("core/utils/utils").inherit,s=e("core/g3wobject"),a=e("gui/gui"),l=e("core/map/layer/loader/vectorloaderlayer"),c=e("gui/form/vue/form");r(n,s),t.exports=n},{"core/g3wobject":31,"core/i18n/i18n.service":34,"core/map/layer/loader/vectorloaderlayer":37,"core/utils/utils":59,"gui/form/vue/form":89,"gui/gui":91}],86:[function(e,t,i){t.exports='<div class="g3w-iternet-editing-panel">\n  <template v-for="toolbar in editorstoolbars">\n    <div class="panel panel-primary">\n      <div class="panel-heading">\n        <h3 class="panel-title">{{ toolbar.name }}</h3>\n      </div>\n      <div class="panel-body">\n        <template v-for="tool in toolbar.tools">\n          <div class="editbtn" :class="{\'enabled\' : (state.editing.on && editingtoolbtnEnabled(tool)), \'toggled\' : editingtoolbtnToggled(toolbar.layercode,tool.tooltype)}">\n            <img height="30px" width="30px" @click="toggleEditTool(toolbar.layercode,tool.tooltype)" :alt="tool.title" :title="tool.title" :src="resourcesurl+\'images/\'+tool.icon"/>\n          </div>\n        </template>\n      </div>\n    </div>\n  </template>\n  <div>\n    <button class="btn btn-primary" v-disabled="editingbtnEnabled" :class="{\'btn-success\' : state.editingOn}" @click="toggleEditing">{{ editingbtnlabel }}</button>\n    <button class="btn btn-danger" v-disabled="!state.hasEdits" @click="saveEdits">{{ savebtnlabel }}</button>\n    <img v-show="state.retrievingData" :src="resourcesurl +\'images/loader.svg\'">\n  </div>\n  <div class="message" v-html="message"></div>\n</div>\n'},{}],87:[function(e,t,i){function n(e){var t=this;l(this,e),this.vueComponent=h,this.name=e.name||"Gestione dati",c(this,e),this.internalComponent=null,this._template=e.template||u,this._editorsToolbars=e.editorsToolBars||[],this._saveBtnLabel=e.saveBtnLabel||"Salva",this._resourcesUrl=e.resourcesUrl||r.getResourcesUrl();var i=e.serviceOptions||{};this._service=e.service||new a(i),this.setInternalComponent=function(){var e=Vue.extend(this.vueComponent);return this.internalComponent=new e({service:this._service,template:this._template,data:function(){return{state:t._service.state,resourcesurl:t._resourcesUrl,editorstoolbars:t._editorsToolbars,savebtnlabel:t._saveBtnLabel}}}),this.internalComponent.state=this._service.state,this.internalComponent},this.mount=function(e){return l(this,"mount",e,!0)},this.unmount=function(){return this._service._stopEditingTool(),r.closeForm(),l(this,"unmount")}}var o=e("core/utils/utils").inherit,r=e("gui/gui"),s=e("gui/vue/component"),a=e("gui/editingpanel/panelservice"),l=e("core/utils/utils").base,c=e("core/utils/utils").merge,u=e("./panel.html"),h={template:null,data:null,transitions:{addremovetransition:"showhide"},methods:{toggleEditing:function(){this.$options.service.toggleEditing()},saveEdits:function(){this.$options.service.saveEdits()},toggleEditTool:function(e,t){""!=t&&this.state.editing.on&&this.$options.service.toggleEditTool(e,t)},editingtoolbtnToggled:function(e,t){return this.state.editing.layerCode==e&&this.state.editing.toolType==t},editingtoolbtnEnabled:function(e){return""!=e.tooltype},onClose:function(){this.$options.service.stop()}},computed:{editingbtnlabel:function(){return this.state.editing.on?"Termina editing":"Avvia editing"},editingbtnEnabled:function(){return this.state.editing.enabled||this.state.editing.on?"":"disabled"},message:function(){var e="";if(this.state.editing.enabled){if(this.state.editing.toolstep.message){var t=this.state.editing.toolstep.n,i=this.state.editing.toolstep.total,n=this.state.editing.toolstep.message;e='<div style="margin-top:20px">GUIDA STRUMENTO:</div><div><span>['+t+"/"+i+'] </span><span style="color: yellow">'+n+"</span></div>"}}else e='<span style="color: red">Aumentare il livello di zoom per abilitare l\'editing';return e}}};o(n,s),t.exports=n},{"./panel.html":86,"core/utils/utils":59,"gui/editingpanel/panelservice":85,"gui/gui":91,"gui/vue/component":128}],88:[function(e,t,i){function n(){this._actions={},this.state=null,this._pickInteraction=null,this.setters={setInitForm:function(e){this._setInitForm(e)},setFormRelations:function(e){this.state.relations=e},setFormFields:function(e){this.state.fields=e},setupFields:function(){this._setupFields()},setupRelationsFields:function(){this._setupRelationsFields()},setFormData:function(e,t){this.setFormFields(e),this.setFormRelations(t)},setField:function(e){},setState:function(e){this._setState(e)},addActionsForForm:function(e){},postRender:function(e){}},this._setInitForm=function(e){this.provider=e.provider||null,this.formId=e.formId,this.name=e.name,this.dataid=e.dataid,this.editor=e.editor||{},this.relationOne=e.relationOne||null,this.pk=e.pk||null,this.tools=e.tools||[],this.isnew=!(!_.isNil(e.isnew)&&_.isBoolean(e.isnew))||e.isnew,this._defaults=e.defaults||h.defaults,this.buttons=e.buttons,this._clipBoard=c;var t=this.formId.split("form")[0];this._pickedPromise=null,this.state={fields:null,relations:null,editor:this.editor,isnew:this.isnew,buttons:this.buttons,tools:{},relationOne:this.relationOne,canpaste:_.has(this._clipBoard._data,t)},this.setFormFields(e.fields),this.setFormRelations(e.relations);var i=this.getUniqueRelationsElementId();this.state.elementsBoxes=i,this._setFormTools(this.tools),this.editor.setFormService(this)},this.cleanStateAfterCommit=function(e){var t=e&&e.length>0?e[0].relations:{};_.forEach(this.state.relations,function(e){var i=t[e.name];_.forEach(e.elements,function(t,n){t.state.indexOf("DELETE")>-1&&e.elements.splice(n,1),"NEW"==t.state&&(_.forEach(i,function(e){if(t.id==e.clientid)return t.id=e.id,!1}),t.state="OLD")})})},this.createPickInteraction=function(){return this._pickInteraction=new l,this._pickInteraction},this.getState=function(){return this.state},this._setState=function(e){this.state=e},this._checkFieldsValidation=function(e){var t=this,i=!0,n=!0;return _.forEach(e,function(e){t._isEditable(e)&&t._isVisible(e)&&e.validate&&e.validate.required&&(!_.isNil(e.value)&&_.trim(e.value)||t._isSelect(e)||(n=!1),i=i&&n)}),i},this.getFields=function(){return this._fields},this._getRelationsOne=function(){var e=this,t=[];return _.forEach(this.state.relations,function(i,n){"ONE"==i.type&&t.push(e.state.relations[n])}),t},this._getLayerFormFromId=function(){return this.formId.split("form")[0]},this._copyFormToClipBoard=function(){var e=_.cloneDeep(this.state);return this._clipBoard.set(this.formId,e),this.state.canpaste=!0,!0},this._setFieldValueLayerFromToRelationField=function(e,t){},this._checkIfFieldIsOverwritable=function(e,t){var i=null;return _.forEach(t,function(t){_.isNil(t[e])||(i=t[e])}),i},this._pasteStateWithoutPk=function(e,t){var i=this,n=[],o=i.editor.getcopyAndPasteFieldsNotOverwritable(),r={};_.isNil(o.layer)||(n=o.layer),_.isNil(o.relations)||(r=o.relations);var s;_.forEach(e,function(t,o){s=i._checkIfFieldIsOverwritable(t.name,n),i.pk==t.name?e[o].value=i.isnew?null:i.state.fields[o].value:_.isNull(s)||(e[o].value=s&&i.isnew?void 0:i.state.fields[o].value)}),_.forEach(t,function(e,i){_.forEach(e.elements,function(n,o){t[i].elements[o].state="NEW",_.forEach(n.fields,function(n,s){_.forEach(r[e.name],function(e){n.name==e&&(t[i].elements[o].fields[s].value=void 0)})})})}),this.setFormData(e,t);var a=this.getUniqueRelationsElementId(!1);return this.state.elementsBoxes=a,!0},this._pasteClipBoardToForm=function(e){var t=this._clipBoard.get(e);this._pasteStateWithoutPk(t.fields,t.relations),this.state.canpaste=!1},this._isNew=function(){return this.isnew},this._hasFieldsRequired=function(){var e=_.some(this.state.fields,function(e){return e.validate&&e.validate.required}),t=_.some(this.state.relations,function(e){return e.validate&&e.validate.required});return e||t},this._isVisible=function(e){return!(!e.editable&&(""==e.value||_.isNull(e.value)))&&e.name!=this.pk},this._isEditable=function(e){return e.editable},this._isSimple=function(e){return!_.includes(h.specialInputs,e.input.type)&&_.includes(h.simpleFieldTypes,e.type)},this._isTextarea=function(e){return e.input.type==h.TEXTAREA},this._isSelect=function(e){return _.includes(h.specialInputs,e.input.type)&&e.input.type==h.SELECT},this._isRadio=function(e){return _.includes(h.specialInputs,e.input.type)&&e.input.type==h.RADIO},this._isCheckbox=function(e){return _.includes(h.specialInputs,e.input.type)&&e.input.type==h.CHECKBOX},this._isLayerPicker=function(e){return _.includes(h.specialInputs,e.input.type)&&e.input.type==h.LAYERPICKER},this._isImage=function(e){return e.input.type==h.IMAGE},this._cleanUpPickLayer=function(){var e=s.getComponent("map").getService();e.removeInteraction(this._pickInteraction),this._pickInteraction=null,s.setModal(!0)},this._pickLayerInputFieldChange=function(e,t){console.log("funzione che deve essere sovrascritta dal plugin")},this._pickLayer=function(e,t){var i=$.Deferred();s.notify.info("Seleziona un'elemento dalla mappa per ottenere il valore di "+e.label+" o scrivilo direttamentene");var n=this;s.setModal(!1);var o=s.getComponent("map").getService(),r=o.getProject().getLayerById(e.input.options.layerid),a=e.input.options.field,l=r.getAttributeLabel(e.input.options.field);return o.addInteraction(this.createPickInteraction()),this._pickInteraction.on("picked",function(t){u.queryByLocation(t.coordinate,[r]).then(function(t){var n=t.data;if(n.length&&n[0].features.length){var o=n[0].features[0].getProperties(),r=o[a]?o[a]:o[l];e.value=r,i.resolve(o)}else i.reject()}).fail(function(){i.reject()}).always(function(){n._cleanUpPickLayer()})}),i.promise()},this._pickLayerToClipBoard=function(){var e=this,t=$.Deferred();if(this._pickedPromise)return this._pickedPromise;s.setModal(!1);var i=s.getComponent("map").getService(),n=this.editor.getVectorLayer(),o=i.getProject().getLayerById(n.id);return i.addInteraction(this.createPickInteraction()),this._pickInteraction.on("picked",function(i){u.queryByLocation(i.coordinate,[o]).then(function(i){var o=i.data;if(o.length&&o[0].features.length){var r=o[0].features[0],s=n.getPk(),a=n.getFeatureById(r.get(s));a||(a=n.getFeatureById(r.getId()));var l=n.getFieldsWithValues(a),c=e.editor.getRelationsWithValues(a);c.then(function(i){e._pasteStateWithoutPk(l,i),t.resolve()})}}).fail(function(){t.reject()}).always(function(){e._cleanUpPickLayer()})}),t.promise()},this._getDefaultValue=function(e){return e.input&&e.input.options&&e.input.options["default"]?e.input.options["default"]:this._isSelect(e)?e.input.options.values[0].key:""},this._getlayerPickerLayerName=function(e){mapService=s.getComponent("map").getService();var t=mapService.getProject().getLayerById(e);return t?t.getName():""},this._shouldShowRelation=function(e){return!0},this._setupFields=function(){var e=this,t=_.filter(this.state.fields,function(t){return!e.pk||null!=t.value||t.name!=e.pk});_.forEach(t,function(t){if(_.isNil(t.value)){var i=e._getDefaultValue(t);i&&(t.value=i)}})},this._setupRelationsFields=function(e){var t=this;e=e||this.state.relations,e&&_.forEach(e,function(e){_.forEach(e.elements,function(e){t._setupRelationElementFields(e)})})},this._setupRelationElementFields=function(e){var t=this;_.forEach(e.fields,function(e){_.isNil(e.value)&&(e.value=t._getDefaultValue(e))})},this._setupPanel=function(){var e=this.internalComponent=new this._formPanel({form:this});this.options.buttons&&(e.buttons=this.options.buttons);var t=this.getUniqueRelationsElementId();return this.state.elementsBoxes=t,e.state=this.state,this._setFormTools(this.tools),e},this._setFormTools=function(e){var t=this;_.forEach(e,function(e){t.state.tools[e]=!0})},this.getUniqueRelationsElementId=function(e){var t=this,i={},n=!!_.isNil(e)||e;return _.forEach(this.state.relations,function(e){_.forEach(e.elements,function(o){var r=t.getUniqueRelationElementId(e,o);i[r]={collapsed:n}})}),i},this.getUniqueRelationElementId=function(e,t){return e.name+"_"+t.id},this._getField=function(e){var t=null;return _.forEach(this.state.fields,function(i){i.name==e&&(t=i)}),t},this._setImageStyleInput=function(){$("input:file").filestyle({buttonText:" Foto",buttonName:"btn-primary",iconName:"glyphicon glyphicon-camera"})},this._addRelationElement=function(e){var t=this,i=this.provider.createRelationElement(e),n=this.getUniqueRelationElementId(e,i);Vue.set(this.state.elementsBoxes,n,{collapsed:!1}),this._setupRelationElementFields(i),e.elements.push(i),_.forEach(i.fields,function(e){t._isImage(e)&&Vue.nextTick(function(){t._setImageStyleInput()})})},this._removeRelationElement=function(e,t){var i=this;_.forEach(e.elements,function(e,n){e.id==t.id&&(t.state=t.state+"_DELETED",delete i.state.elementsBoxes.elmentBoxId)})},this._removeRelationElements=function(e){var t=this;_.forEach(e.elements,function(i){t._removeRelationElement(e,i)})},this._getRelationField=function(e,t){var i=null;return _.forEach(this.state.relations,function(n){t==n.name&&_.forEach(n.fields,function(t){t.name==e&&(i=t)})}),i},this._getRelationElementField=function(e,t){var i;return _.forEach(t.fields,function(t){t.name==e&&(i=t)}),i},r(this)}var o=e("core/utils/utils").inherit,r=e("core/utils/utils").base,s=e("gui/gui"),a=e("core/g3wobject"),l=e("g3w-ol3/src/interactions/pickcoordinatesinteraction"),c=e("core/clipboardservice"),u=e("core/query/queryservice"),h={};h.STRING="string",h.INTEGER="integer",h.FLOAT="float",h.BOOLEAN="boolean",h.defaults={},h.defaults[h.STRING]="",h.defaults[h.INTEGER]=0,h.defaults[h.FLOAT]=0,h.simpleFieldTypes=[h.STRING,h.INTEGER,h.FLOAT],h.TEXTAREA="textarea",h.SELECT="select",h.RADIO="radio",h.CHECKBOX="checkbox",h.LAYERPICKER="layerpicker",h.IMAGE="image",h.specialInputs=[h.TEXTAREA,h.SELECT,h.RADIO,h.CHECKBOX,h.LAYERPICKER,h.IMAGE],o(n,a),t.exports=n},{"core/clipboardservice":20,"core/g3wobject":31,"core/query/queryservice":56,"core/utils/utils":59,"g3w-ol3/src/interactions/pickcoordinatesinteraction":72,"gui/gui":91}],89:[function(e,t,i){function n(e){var e=e||{};e.id=e.id||"form",l(this,e);var t=e.service?new e.service:new a,i=e.vueComponentOptions||u;this.vueComponent=this.createVueComponent(i),this.setService(t);var n=e.template||c;this.setInternalComponentTemplate(n),this.setInternalComponent=function(){var e=Vue.extend(this.vueComponent);this.internalComponent=new e({formService:this.getService(),template:this.getInternalTemplate()}),this.internalComponent.state=this.getService().state},this.mount=function(e,t){var i=this;return l(this,"mount",e,t).then(function(){i.getService().setupFields(),i.getService().setupRelationsFields(),r.setModal(!0)})},this.layout=function(e,t){var i=$(this.internalComponent.$el).find(".g3w-form-component_header").height(),n=t-i;$(this.internalComponent.$el).find(".g3w-form-component_body").height(n),$(".nano").nanoScroller()}}var o=e("core/utils/utils").inherit,r=e("gui/gui"),s=e("gui/vue/component"),a=e("gui/form/formservice"),l=e("core/utils/utils").base,c=e("./templateform.html");Vue.filter("startcase",function(e){return _.startCase(e)}),Vue.filter("lowerCase",function(e){return _.lowerCase(e)}),Vue.filter("relationplural",function(e){return e.plural?e.plural:_.startCase(e.name)});var u={template:null,data:function(){return{state:null,tools:{copypaste:!1}}},components:{},transitions:{addremovetransition:"showhide"},methods:{exec:function(e){var t=this.state.relations||null;e(this.state.fields,t),this.state.editor.getPickedFeature()&&this.state.editor.cleanUpPickedFeature(),r.closeForm()},btnEnabled:function(e){return"save"!=e.type||"save"==e.type&&this.isValidForm()},hasFieldsRequired:function(){return this.$options.formService._hasFieldsRequired()},isEditable:function(e){return this.$options.formService._isEditable(e)},isSimple:function(e){return this.$options.formService._isSimple(e)},isTextarea:function(e){return this.$options.formService._isTextarea(e)},isSelectOptionsNull:function(e){return _.isNil(e)?"null":e},isSelect:function(e){return this.$options.formService._isSelect(e)},isRadio:function(e){return this.$options.formService._isRadio(e)},isCheckbox:function(e){return this.$options.formService._isCheckbox(e)},multiCheckBoxValue:function(e,t){t.value||(filed.value=[]),e.target.checked?t.push(e.target.value):_.remove(t,function(t){return t==e.target.value})},isLayerPicker:function(e){return this.$options.formService._isLayerPicker(e)},removeImage:function(e){e.value=null},isImage:function(e){return this.$options.formService._isImage(e)},layerPickerPlaceHolder:function(e){return this.$options.formService._getlayerPickerLayerName(e.input.options.layerid)},pickLayer:function(e,t){this.checkPickLayer(),this.$options.formService._pickLayer(e,t)},pickLayerInputFieldChange:function(e,t){this.$options.formService._pickLayerInputFieldChange(e,t)},pickLayerToClipBoard:function(){this.checkPickLayer(),this.$options.formService._pickLayerToClipBoard().then(function(){})},isValidForm:function(){var e=this,t=this.$options.formService._checkFieldsValidation(this.state.fields);return _.forEach(this.state.relations,function(i){e.showRelation(i)&&_.forEach(i.elements,function(i){return i.state.indexOf("DELETE")>-1||void(t=t&&e.$options.formService._checkFieldsValidation(i.fields))})}),t},pickLayerInputChange:function(){this.$options.formService._cleanUpPickLayer()},checkPickLayer:function(){this.$options.formService._pickInteraction&&this.$options.formService._cleanUpPickLayer()},isVisible:function(e){return this.$options.formService._isVisible(e)},visibleElements:function(e){return _.filter(e.elements,function(e){return"NEW_DELETED"!=e.state&&"OLD_DELETED"!=e.state})},visibleElementsLength:function(e){return this.visibleElements(e).length},showRelation:function(e){return this.$options.formService._shouldShowRelation(e)},relationPkFieldName:function(e){return e.pk},isRelationElementDeletable:function(e,t){if(t["new"])return!0;var i;return i="ONE"==e.type?1:Number.NEGATIVE_INFINITY,e.min&&(i=Math.min(i.relation.min)),i<e.elements.length},canAddRelationElements:function(e){var t=!0;if("ONE"==e.type)t=!e.elements.length;else{var i=e.max?e.max:Number.POSITIVE_INFINITY;t=e.elements.length<i}return t},addRelationElement:function(e){this.$options.formService._addRelationElement(e)},removeRelationElement:function(e,t){this.$options.formService._removeRelationElement(e,t)},visibleElementFields:function(e){var t=this;return _.filter(e,function(e){return t.isVisible(e)})},fieldsSubset:function(e){var t=_.filter(e,function(e){return"image"!=e.type}),i=Math.min(3,t.length);return t.slice(0,i)},fieldsSubsetLength:function(e){return this.fieldsSubset(e).length},collapseElementBox:function(e,t){var i=this.getUniqueRelationElementId(e,t);if(this.state.elementsBoxes[i])return this.state.elementsBoxes[i].collapsed},toggleElementBox:function(e,t){var i=this.getUniqueRelationElementId(e,t);this.state.elementsBoxes[i].collapsed=!this.state.elementsBoxes[i].collapsed},getUniqueRelationElementId:function(e,t){return this.$options.formService.getUniqueRelationElementId(e,t)},pasteClipBoardToForm:function(){var e=this.$options.formService._getLayerFormFromId();this.$options.formService._pasteClipBoardToForm(e),this.$validate(),this.$validate(this.state.relations),this.$resetValidation()},copyToClipBoard:function(){this.$options.formService._copyFormToClipBoard()},onSelectChange:function(e,t){e.value=t.target.value},onFileChange:function(e,t,i){var n,o={},s=this.$cookie.get("csrftoken");s&&(o.csrfmiddlewaretoken=s),n=t?$("#foto-spinner"+t):$("#foto-spinner"),r.showSpinner({container:n,id:"fotoloadspinner",style:"white",center:!0}),$(i.target).fileupload({dataType:"json",formData:o,done:function(t,i){$.each(i.result,function(t,i){e.value=i.filename})},always:function(){r.hideSpinner("fotoloadspinner")}});var a=i.target.files||i.dataTransfer.files;!a.length},createImage:function(e,t){var i=new FileReader;i.onload=function(e){t.value=e.target.result},i.readAsDataURL(e)},checkFileSrc:function(e){var e=e;return _.isNil(e)&&(e=""),e},setImageStyleInput:function(){this.$options.formService._setImageStyleInput()}},computed:{isValid:function(e){return this.$validate(e.name)},hasRelations:function(){return this.state.relations.length},fields:function(){return this.state.fields}},watch:{"state.fields":function(){this.setImageStyleInput()}},mounted:function(){var e=this;if(this.state.relationOne&&this.state.isnew){var t=this.$options.formService._getRelationsOne();_.forEach(t,function(t){t.elements.length||e.addRelationElement(t)})}this.$nextTick(function(){e.setImageStyleInput(),e.$options.formService.postRender()})},beforeDestroy:function(){this.$options.formService._cleanUpPickLayer()}};o(n,s),t.exports=n},{"./templateform.html":90,"core/utils/utils":59,"gui/form/formservice":88,"gui/gui":91,"gui/vue/component":128}],90:[function(e,t,i){t.exports='<div>\n  <div class="g3w-form-component_header">\n    <div class="quick-actions-menu">\n      <div v-if="state.tools.copypaste" class="pull-right">\n        <button v-if=\'state.isnew\' class="btn btn-default glyphicon glyphicon-screenshot" data-placement="bottom" @click="pickLayerToClipBoard"  data-i18n="[title]copy_form_data_from_feature"></button>\n        <button v-if=\'!state.isnew\' class="btn btn-default glyphicon glyphicon-copy" data-placement="bottom" @click="copyToClipBoard"  data-i18n="[title]copy_form_data"></button>\n        <button v-if=\'state.isnew\' class="btn btn-default glyphicon glyphicon-paste" data-placement="bottom" @click="pasteClipBoardToForm" v-disabled="!state.canpaste" data-i18n="[title]paste_form_data"></button>\n      </div>\n    </div>\n  </div>\n  <div class="g3w-form-component_body nano">\n    <form name="validation" novalidate class="form-horizontal g3w-form nano-content">\n        <div class="box box-primary">\n          <div class="box-header with-border">\n            <h3 class="box-title">Attributi elemento</h3>\n            <div class="box-tools pull-right">\n            </div>\n          </div>\n          <div class="box-body">\n            <template v-for="field in fields">\n              <div v-if="isVisible(field)" class="form-group has-feedback">\n                <label :for="field.name" class="col-sm-4 control-label">{{ field.label }}<span v-if="field.validate && field.validate.required">*</span></label>\n                <div class="col-sm-8">\n                  <input v-if="isSimple(field)" @focus="checkPickLayer" :field="field.name" v-disabled="!isEditable(field)" class="form-control" v-model="field.value" :id="field.name" :placeholder="field.input.label">\n                  <textarea v-if="isTextarea(field)" @focus="checkPickLayer" :field="field.name" v-disabled="!isEditable(field)" class="form-control" v-model="field.value" :id="field.name" :placeholder="field.input.label">\n                  </textarea>\n                  <select v-if="isSelect(field)" @focus="checkPickLayer" :field="field.name" v-disabled="!isEditable(field)" class="form-control" @change="onSelectChange(field, $event)" :value="isSelectOptionsNull(field.value)" :id="field.name" :placeholder="field.input.label">\n                    <option v-for="value in field.input.options.values"  :value="isSelectOptionsNull(value.key)" >{{ value.value }}</option>\n                  </select>\n                  <div v-if="isLayerPicker(field)">\n                    <input class="form-control picklayerinput" @click="pickLayer(field)" @change="pickLayerInputChange" :field="field.name" data-toggle="tooltip" :title="\'Ottieni il dato da un elemento del layer \\\'\' + layerPickerPlaceHolder(field) + \'\\\' o scrivilo direttamente qui\'" v-disabled="!isEditable(field)" v-model="field.value" :id="field.name" :placeholder="\'[\'+layerPickerPlaceHolder(field)+\']\'">\n                    <i class="glyphicon glyphicon-screenshot form-control-feedback" ></i>\n                  </div>\n                  <div v-if="isRadio(field)">\n                    <template v-for="(value,index) in field.input.options.values">\n                      <input class="magic-radio" type="radio" :value="value.value" v-model="field.value" :field="field.name" v-disabled="!isEditable(field)" :id="field.name + value.value" :placeholder="value.key">\n                      <label :for="field.name + value.value">{{ value.key }}</label>\n                    </template>\n                  </div>\n                  <div v-if="isImage(field)">\n                    <i v-if="checkFileSrc(field.value)" class="glyphicon glyphicon glyphicon-trash pull-right link trash" @click="removeImage(field)"></i>\n                    <img v-if="checkFileSrc(field.value)" class="photo-preview img-responsive img-thumbnail rounded"  :src="field.value" />\n                    <div id="foto-spinner"></div>\n                    <input type="file" :name="field.name" :data-url="field.uploadurl" :field="field.name" title="Foto" accept="image/*;capture=camera" class="filestyle" @change="onFileChange(field, $event)">\n                  </div>\n                </div>\n              </div>\n            </template>\n          </div>\n        </div>\n        <div v-for="relation, relationIndex in state.relations" style="margin-top:10px">\n          <transition name="expand">\n          <div v-if="showRelation(relation)">\n            <div class="box box-default">\n              <div class="box-header with-border">\n                <h3 class="box-title">{{ relation | relationplural }}</h3>\n              </div>\n              <div class="box-body">\n                <table v-if="visibleElementsLength(relation)" class="table table-striped">\n                  <thead>\n                  <tr>\n                    <th v-for="field in fieldsSubset(relation.fields)">{{field.label}}</th>\n                  </tr>\n                  </thead>\n                  <tbody>\n                  <template v-for="element in visibleElements(relation)">\n                    <tr class="attributes-preview" @click="toggleElementBox(relation, element)">\n                      <td v-for="relfield in fieldsSubset(element.fields)">\n                        <span>{{relfield.value}}</span>\n                      </td>\n                      <td class="pull-right">\n                        <i v-if="isRelationElementDeletable(relation,element)" class="glyphicon glyphicon glyphicon-trash link trash" @click.stop.prevent="removeRelationElement(relation,element)"></i>\n                        <i class="glyphicon glyphicon-option-horizontal link morelink"></i>\n                      </td>\n                    </tr>\n                    <tr v-show="!collapseElementBox(relation,element)" class="queryresults-featurebox">\n                      <td :colspan="fieldsSubsetLength(element.fields)+1">\n                        <template v-for="field in element.fields">\n                          <div v-if="isVisible(field)" class="form-group has-feedback">\n                            <label :for="field.name" class="col-sm-4 control-label">{{ field.label }}<span v-if="field.validate && field.validate.required">*</span></label>\n                            <div class="col-sm-8">\n                              <input v-if="isSimple(field)" @focus="checkPickLayer" :field="field.name" v-disabled="!isEditable(field)" class="form-control" v-model="field.value" :id="field.name" :placeholder="field.input.label">\n                              <textarea v-if="isTextarea(field)" @focus="checkPickLayer" :field="field.name" v-disabled="!isEditable(field)" class="form-control" v-model="field.value" :id="field.name" :placeholder="field.input.label"></textarea>\n                              <select v-if="isSelect(field)" @focus="checkPickLayer" :field="field.name" v-disabled="!isEditable(field)" class="form-control" @change="onSelectChange(field, $event)" :value="isSelectOptionsNull(field.value)" :id="field.name" :placeholder="field.input.label">\n                                <option v-for="value in field.input.options.values"  :value="isSelectOptionsNull(value.key)" >{{ value.value }}</option>\n                              </select>\n                              <div v-if="isRadio(field)">\n                                <template v-for="(value, index) in field.input.options.values">\n                                  <input class="magic-radio" type="radio" :value="value.value" v-model="field.value" :field="field.name" v-disabled="!isEditable(field)" :id="field.name + value.value" :placeholder="value.key">\n                                  <label :for="field.name + value.value">{{ value.key }} </label>\n                                </template>\n                              </div>\n                              <div v-if="isCheckbox(field)">\n                                <template v-for="(value, index) in field.input.options.values">\n                                  <label :for="field.name + value.value">{{ value.key }} </label>\n                                  <input type="radio" :value="value.value" v-model="field.value" :field="field.name" v-disabled="!isEditable(field)" :id="field.name + value.value" :placeholder="value.key">\n                                </template>\n                              </div>\n                              <div v-if="isLayerPicker(field)">\n                                <input class="form-control picklayerinput" @click="pickLayer(field, relation)" @input="pickLayerInputFieldChange(field, relation)"  :field="field.name" data-toggle="tooltip" :title="\'Ottieni il dato da un elemento del layer \\\'\' + layerPickerPlaceHolder(field) + \'\\\' o scrivilo direttamente qui\'" v-disabled="!isEditable(field)" v-model="field.value" :id="field.name" :placeholder="\'[\'+layerPickerPlaceHolder(field)+\']\'">\n                                <i class="glyphicon glyphicon-screenshot form-control-feedback" ></i>\n                              </div>\n                              <div v-if="isRadio(field)">\n                                <template v-for="(value,index) in field.input.options.values">\n                                  <input class="magic-radio" type="radio" :value="value.value" v-model="field.value" :field="field.name" v-disabled="!isEditable(field)" :id="field.name + value.value" :placeholder="value.key">\n                                  <label :for="field.name + value.value">{{ value.key }}</label>\n                                </template>\n                              </div>\n                              <div v-if="isImage(field)" style="position:relative;">\n                                <i v-if="checkFileSrc(field.value)" class="glyphicon glyphicon glyphicon-trash pull-right link trash" @click="removeImage(field)"></i>\n                                <img v-if="checkFileSrc(field.value)" class="photo-preview img-responsive img-thumbnail rounded" :src="field.value" />\n                                <div id="foto-spinner{{ relationIndex }}"></div>\n                                <input type="file" :name="field.name" :data-url="field.uploadurl" :field="field.name" title="Foto" accept="image/*;capture=camera" class="filestyle" @change="onFileChange(field, relationIndex, $event)">\n                              </div>\n                            </div>\n                          </div>\n                        </template>\n                      </td>\n                    </tr>\n                  </template>\n                  </tbody>\n                </table>\n                <div v-if="canAddRelationElements(relation)" class="row" style="margin:0px"><i class="glyphicon glyphicon-plus-sign pull-right btn-add" @click="addRelationElement(relation)"></i></div>\n              </div>\n            </div>\n          </div>\n          </transition>\n        </div>\n        <div class="form-group">\n          <div class="col-sm-offset-4 col-sm-8">\n            <div v-if="hasFieldsRequired" style="margin-bottom:10px">\n              <span>* Campi richiesti</span>\n            </div>\n            <span v-for="button in state.buttons">\n              <button class="btn " :class="[button.class]" @click.stop.prevent="exec(button.cbk)" v-disabled="!btnEnabled(button)">{{ button.title }}</button>\n            </span>\n          </div>\n        </div>\n    </form>\n  </div>\n</div>';
},{}],91:[function(e,t,i){function n(){this.ready=!1,this.getResourcesUrl=o,this.showForm=o,this.closeForm=o,this.showListing=o,this.closeListing=o,this.hideListing=o,this.showQueryResults=function(e){},this.hideQueryResults=o,this.showPanel=o,this.hidePanel=o,this.addComponent=function(e,t){},this.removeComponent=function(e){},this.setComponent=function(e){l.registerComponent(e)},this.getComponent=function(e){return l.getComponent(e)},this.getComponents=function(){return l.getComponents()},this["goto"]=function(e){a["goto"](e)},this.ready=function(){this.emit("ready"),this.ready=!0},this.guiResized=function(){this.emit("guiresized")},this.showSpinner=function(e){},this.hideSpinner=function(e){},this.notify=o,this.dialog=o}var o=e("core/utils/utils").noop,r=e("core/utils/utils").inherit,s=e("core/g3wobject"),a=e("core/router"),l=e("gui/componentsregistry");r(n,s),t.exports=new n},{"core/g3wobject":31,"core/router":57,"core/utils/utils":59,"gui/componentsregistry":84}],92:[function(e,t,i){t.exports="<div>\n  Lista di oggetti\n</div>\n"},{}],93:[function(e,t,i){function n(e){this.panelComponent=null,this.options=e||{},this.id=e.id||null,this.name=e.name||null,this.state={list:e.list||[]},this._listPanelComponent=e.listPanelComponent||s}var o=e("core/utils/utils").resolve,r=(e("core/utils/utils").reject,e("gui/gui")),s=Vue.extend({template:e("./listpanel.html"),methods:{exec:function(e){var t=this.state.relations||null;e(this.state.fields,t),r.closeForm()}}}),a=n.prototype;a.onShow=function(e){var t=this._setupPanel();return this._mountPanel(t,e),o(!0)},a.onClose=function(){return this.panelComponent.$destroy(!0),this.panelComponent=null,o(!0)},a._setupPanel=function(){var e=this.panelComponent=new this._listPanelComponent({panel:this});return e.state=this.state,e},a._mountPanel=function(e,t){e.$mount().$appendTo(t)},t.exports={ListPanelComponent:s,ListPanel:n}},{"./listpanel.html":92,"core/utils/utils":59,"gui/gui":91}],94:[function(e,t,i){var n=e("g3w-ol3/src/controls/resetcontrol"),o=e("g3w-ol3/src/controls/querycontrol"),r=e("g3w-ol3/src/controls/zoomboxcontrol"),s=e("g3w-ol3/src/controls/querybboxcontrol"),a=e("g3w-ol3/src/controls/querybypolygoncontrol"),l=e("g3w-ol3/src/controls/geolocationcontrol"),c=e("g3w-ol3/src/controls/streetviewcontrol"),u=e("g3w-ol3/src/controls/control"),h=e("g3w-ol3/src/controls/olcontrol"),d={create:function(e){var t,i=d.CONTROLS[e.type],n=e.layers;if(i&&(t=new i(e)),n&&t instanceof u){if(!n.length)return null;var o=t.getGeometryTypes(),r=!o.length;return _.forEach(n,function(e){if(o.indexOf(e.getGeometryType())>-1)return r=!0,!1}),r?t:null}return t}};d.CONTROLS={reset:n,zoombox:r,zoomtoextent:h,query:o,querybbox:s,querybypolygon:a,geolocation:l,streetview:c,zoom:h,scaleline:h,overview:h},t.exports=d},{"g3w-ol3/src/controls/control":60,"g3w-ol3/src/controls/geolocationcontrol":61,"g3w-ol3/src/controls/olcontrol":63,"g3w-ol3/src/controls/querybboxcontrol":64,"g3w-ol3/src/controls/querybypolygoncontrol":65,"g3w-ol3/src/controls/querycontrol":66,"g3w-ol3/src/controls/resetcontrol":67,"g3w-ol3/src/controls/streetviewcontrol":68,"g3w-ol3/src/controls/zoomboxcontrol":69}],95:[function(e,t,i){function n(){this._controls={},this.setters={registerControl:function(e,t){this._registerControl(e,t)}},this._registerControl=function(e,t){this._controls[e]=t},this.getControl=function(e){return this._controls[e]},this.getControls=function(){return this._controls},this.unregisterControl=function(e){var t=this.getControl(e),i=a.getComponet("map").getService(),n=i.getMap();return!!t&&(n.removeControl(t),delete this._controls[e],!0)},r(this)}var o=e("core/utils/utils").inherit,r=e("core/utils/utils").base,s=e("core/g3wobject"),a=e("gui/gui");o(n,s),t.exports=new n},{"core/g3wobject":31,"core/utils/utils":59,"gui/gui":91}],96:[function(e,t,i){function n(e){var t=this;this.viewer,this.target,this.project,this.selectedLayer,this._mapControls=[],this._mapLayers=[],this.mapBaseLayers={},this.layersExtraParams={},this.state={bbox:[],resolution:null,center:null,loading:!1,hidden:!0},this._greyListenerKey=null,this._drawShadow={type:"coordinate",outer:[],inner:[],scale:null,rotation:null},this.config=e.config||l.getConfig(),this._howManyAreLoading=0,this._incrementLoaders=function(){0==this._howManyAreLoading&&(this.emit("loadstart"),a.showSpinner({container:$("#map-spinner"),id:"maploadspinner",style:"blue"})),this._howManyAreLoading+=1},this._decrementLoaders=function(){this._howManyAreLoading-=1,0==this._howManyAreLoading&&(this.emit("loadend"),a.hideSpinner("maploadspinner"))},_.isNil(e.project)?(this.project=c.getCurrentProject(),c.onafter("setCurrentProject",function(e){t.project=e,t.setupLayers()})):this.project=e.project,this._marker=null,this.setters={setMapView:function(e,t,i){this.state.bbox=e,this.state.resolution=t,this.state.center=i,this.updateMapLayers(this._mapLayers)},setHidden:function(e){this.state.hidden=e},setupViewer:function(e,i){0!=e&&0!=i&&(proj4.defs("EPSG:"+t.project.state.crs,this.project.state.proj4),t.viewer&&(t.viewer.destroy(),t.viewer=null),t._setupViewer(e,i),t.state.bbox=this.viewer.getBBOX(),t.state.resolution=this.viewer.getResolution(),t.state.center=this.viewer.getCenter(),t.setupControls(),t.setupLayers(),t.emit("viewerset"))}},this._setupViewer=function(e,t){var i=this,n=this.getProjection(),o=this.project.state.initextent,r=this.project.state.extent,s=ol.extent.getWidth(r)/e,a=ol.extent.getHeight(r)/t,l=Math.max(s,a),c=ol.extent.getWidth(o)/e,u=ol.extent.getHeight(o)/t,d=Math.max(c,u);this.viewer=h.createViewer({id:this.target,view:{projection:n,center:ol.extent.getCenter(o),extent:r,maxResolution:l}}),this.config.background_color&&$("#"+this.target).css("background-color",this.config.background_color),$(this.viewer.map.getViewport()).prepend('<div id="map-spinner" style="position:absolute;right:0px;"></div>'),this.viewer.map.getInteractions().forEach(function(e){i._watchInteraction(e)}),this.viewer.map.getInteractions().on("add",function(e){i._watchInteraction(e.element)}),this.viewer.map.getInteractions().on("remove",function(e){}),this.viewer.map.getView().setResolution(d),this.viewer.map.on("moveend",function(e){i._setMapView()}),this._marker=new ol.Overlay({position:void 0,positioning:"center-center",element:document.getElementById("marker"),stopEvent:!1}),this.viewer.map.addOverlay(this._marker),this.emit("ready")},this.project.onafter("setLayersVisible",function(e){_.map(e,function(e){var i=t.project.getLayerById(e);return t.getMapLayerForLayer(i)});t.updateMapLayers(t.getMapLayers())}),this.project.onafter("setBaseLayer",function(){t.updateMapLayers(t.mapBaseLayers)}),this.on("cataloglayerselected",function(){var e=this,t=this.project.getLayers({SELECTED:!0});t&&(this.selectLayer=t[0],_.forEach(this._mapControls,function(t){_.indexOf(_.keysIn(t.control),"onSelectLayer")>-1&&t.control.onSelectLayer()&&(t.control.getGeometryTypes().indexOf(e.selectLayer.getGeometryType())>-1?t.control.setEnable(!0):t.control.setEnable(!1))}))}),this.on("cataloglayerunselected",function(){this.selectLayer=null,_.forEach(this._mapControls,function(e){_.indexOf(_.keysIn(e.control),"onSelectLayer")>-1&&e.control.onSelectLayer()&&e.control.setEnable(!1)})}),r(this)}var o=e("core/utils/utils").inherit,r=e("core/utils/utils").base,s=e("core/g3wobject"),a=e("gui/gui"),l=e("core/applicationservice"),c=e("core/project/projectsregistry"),u=e("core/project/projectlayer"),h=e("g3w-ol3/src/g3w.ol3").helpers,d=e("core/map/layer/wmslayer"),p=e("gui/map/control/factory"),f=e("core/query/queryservice"),g=e("gui/streetview/streetviewservice"),v=e("gui/map/control/registry");o(n,s);var m=n.prototype;m.slaveOf=function(e,t){},m.setLayersExtraParams=function(e,t){this.layersExtraParams=_.assign(this.layersExtraParams,e),this.emit("extraParamsSet",e,t)},m.getProject=function(){return this.project},m.getMap=function(){return this.viewer.map},m.getProjection=function(){var e=this.project.state.extent,t=new ol.proj.Projection({code:"EPSG:"+this.project.state.crs,extent:e});return t},m.getViewerElement=function(){return this.viewer.map.getTargetElement()},m.getViewport=function(){return this.viewer.map.getViewport()},m.getResolution=function(){return this.viewer.map.getView().getResolution()},m.getEpsg=function(){return this.viewer.map.getView().getProjection().getCode()},m.getGetFeatureInfoUrlForLayer=function(e,t,i,n,o){var r=this.getMapLayerForLayer(e);return r.getGetFeatureInfoUrl(t,i,n,o)},m.showMarker=function(e,t){t=t||1e3;var i=this;this._marker.setPosition(e),setTimeout(function(){i._marker.setPosition()},t)},m.setupControls=function(){var e=this;e.viewer.map;if(this.config&&this.config.mapcontrols&&(_.forEach(this.config.mapcontrols,function(t){var i;switch(t){case"reset":isMobile.any||(i=p.create({type:t})),e.addControl(t,i);break;case"zoom":i=p.create({type:t,zoomInLabel:"î¦",zoomOutLabel:"î¦"}),e.addControl(t,i);break;case"zoombox":isMobile.any||(i=p.create({type:t}),i.on("zoomend",function(t){e.viewer.fit(t.extent)}),e.addControl(t,i));break;case"zoomtoextent":isMobile.any||(i=p.create({type:t,label:"î¦",extent:e.project.state.initextent}),e.addControl(t,i));break;case"query":i=p.create({type:t}),i.on("picked",function(t){var i=t.coordinates;e.showMarker(i);var n=a.showContentFactory("query"),o=e.project.getLayers({QUERYABLE:!0,SELECTEDORALL:!0}),r=n("interrogazione");f.queryByLocation(i,o).then(function(t){r.setQueryResponse(t,i,e.state.resolution)})}),e.addControl(t,i);break;case"querybypolygon":var n=e.project.getLayers({QUERYABLE:!0,SELECTEDORALL:!0});i=p.create({type:t,layers:n}),i&&(i.on("picked",function(t){var i=t.coordinates,n=a.showContentFactory("query"),o=n("interrogazione"),r=e.project.getLayers({QUERYABLE:!0,SELECTED:!0});f.queryByLocation(i,r).then(function(t){if(t&&t.data&&t.data[0].features.length){var n=t.data[0].features[0].getGeometry(),r=e.project.getLayers({QUERYABLE:!0,ALLNOTSELECTED:!0,WFS:!0});e.highlightGeometry(n);var s=f.createQueryFilterObject({queryLayers:r,ogcService:"wfs",filter:{geometry:n}});f.queryByFilter(s).then(function(t){o.setQueryResponse(t,i,e.state.resolution)}).always(function(){e.clearHighlightGeometry()})}})}),e.addControl(t,i));break;case"querybbox":if(!isMobile.any&&e.checkWFSLayers()){var n=e.project.getLayers({QUERYABLE:!0,SELECTEDORALL:!0,WFS:!0});i=p.create({type:t,layers:n}),i&&(i.on("bboxend",function(t){var i=t.extent,n=e.project.getLayers({QUERYABLE:!0,SELECTEDORALL:!0,WFS:!0}),o=a.showContentFactory("query"),r=o("interrogazione"),s=f.createQueryFilterObject({queryLayers:n,ogcService:"wfs",filter:{bbox:i}});f.queryByFilter(s).then(function(t){r.setQueryResponse(t,i,e.state.resolution)})}),e.addControl(t,i))}break;case"streetview":isMobile.any||(i=p.create({type:t}),i.setProjection(e.getProjection()),e.addControl(t,i),e.on("viewerset",function(){e.viewer.map.addLayer(i.getLayer())}),$script("https://maps.googleapis.com/maps/api/js?key=AIzaSyBCHtKGx3yXWZZ7_gwtJKG8a_6hArEFefs",function(){var t={lat:null,lng:null},n=new g;n.onafter("postRender",function(e){i.setPosition(e)}),i&&(i.on("picked",function(i){var o=i.coordinates,r=ol.proj.transform(o,e.getProjection().getCode(),"EPSG:4326");t.lat=r[1],t.lng=r[0],n.showStreetView(t)}),i.on("disabled",function(){panorama&&(panorama=null)}))}));break;case"scaleline":i=p.create({type:t,position:"br"}),e.addControl(t,i);break;case"overview":if(!isMobile.any){var o=e.project.getOverviewProjectGid();o&&c.getProject(o).then(function(n){var o=e.getOverviewMapLayers(n);i=p.create({type:t,position:"bl",className:"ol-overviewmap ol-custom-overviewmap",collapseLabel:$('<span class="glyphicon glyphicon-menu-left"></span>')[0],label:$('<span class="glyphicon glyphicon-menu-right"></span>')[0],collapsed:!1,layers:o,view:new ol.View({projection:e.getProjection()})}),e.addControl(t,i)})}}}),this.config.mapcontrols.indexOf("geolocation")>-1||isMobile.any)){var t="geolocation";control=p.create({type:t}),control.on("click",function(t){e.showMarker(t.coordinates)}),this.addControl(t,control)}},m.checkWFSLayers=function(){var e=!1,t=this.project.getLayers({QUERYABLE:!0,SELECTEDORALL:!0});return _.forEach(t,function(t){if(t.getWfsCapabilities())return e=!0,!1}),e},m.addControl=function(e,t){_.indexOf(_.keysIn(t),"onSelectLayer")>-1&&t.onSelectLayer()&&(this.selectLayer||t.setEnable(!1)),this.viewer.map.addControl(t),this._mapControls.push({type:e,control:t,visible:!0}),v.registerControl(e,t)},m.showControl=function(e){this.showControls([e])},m.hideControl=function(e){this.hideControls([e])},m.showControls=function(e){this.toggleControls(!0,e)},m.hideControls=function(e){this.toggleControls(!1,e)},m.showAllControls=function(){this.toggleControls(!0)},m.hideAllControls=function(){this.toggleControls(!1)},m.toggleControls=function(e,t){this._removeControls(),_.forEach(this._mapControls,function(i){t?t.indexOf(i.type)>-1&&(i.visible=e):i.visible=e}),this._layoutControls()},m._layoutControls=function(){var e=this;_.forEach(this._mapControls,function(t){t.visible&&e.viewer.map.addControl(t.control)})},m.removeControl=function(e){var t=this;_.forEach(this._mapControls,function(i,n){if(e==i.type)return t._mapControls.splice(n,1),t.viewer.map.removeControl(i.control),!1})},m._removeControls=function(){var e=this;_.forEach(this._mapControls,function(t){e.viewer.map.removeControl(t.control)})},m._unToggleControls=function(){_.forEach(this._mapControls,function(e){e.control.toggle&&e.control.toggle(!1)})},m.addMapLayer=function(e){this._mapLayers.push(e)},m.getMapLayers=function(){return this._mapLayers},m.getMapLayerForLayer=function(e){var t,i="layer_"+e.state.multilayer;return _.forEach(this.getMapLayers(),function(e){e.getId()==i&&(t=e)}),t},m.getProjectLayer=function(e){return this.project.getLayerById(e)},m.setupBaseLayers=function(){var t=this;if(this.project.state.baselayers){this.mapBaseLayers={};var i=(this.project.state.baselayers,this.project.state.baselayers);_.forEach(i,function(i){var n=new u(i);if(n.setProject(this),n.isWMS())var o={url:t.project.getWmsUrl(),id:n.state.id,tiled:n.state.tiled},r=new d(o);else switch(n.getServerType()){case"OSM":var s=e("core/map/layer/osmlayer"),r=new s({id:n.state.id});break;case"Bing":var a=e("core/map/layer/binglayer"),r=new a({id:n.state.id})}t.addMapLayer(r),t.registerListeners(r),r.addLayer(n),t.mapBaseLayers[n.state.id]=r}),_.forEach(_.values(this.mapBaseLayers).reverse(),function(e){t.viewer.map.addLayer(e.getOLLayer()),e.update(t.state)})}},m.setupLayers=function(){var e=this;this.viewer.removeLayers(),this.setupBaseLayers(),this._reset();var t=this.project.getLayers(),i=_.groupBy(t,function(e){return e.state.multilayer});return _.forEach(i,function(t,i){var n="layer_"+i,o=t[0].state.tiled,r={url:e.project.getWmsUrl(),id:n,tiled:o},s=new d(r,e.layersExtraParams);e.addMapLayer(s),e.registerListeners(s),_.forEach(t.reverse(),function(e){s.addLayer(e)})}),_.forEach(this.getMapLayers().reverse(),function(t){e.viewer.map.addLayer(t.getOLLayer()),t.update(e.state,e.layersExtraParams)}),this.mapLayers},m.getOverviewMapLayers=function(e){var t=e.getLayers({VISIBLE:!0}),i=_.groupBy(t,function(e){return e.state.multilayer}),n=[];return _.forEach(i,function(t,i){var o="overview_layer_"+i,r=t[0].state.tiled,s={url:e.getWmsUrl(),id:o,tiled:r},a=new d(s);_.forEach(t.reverse(),function(e){a.addLayer(e)}),n.push(a.getOLLayer(!0))}),n.reverse()},m.updateMapLayers=function(e){var t=this;_.forEach(e,function(e){e.update(t.state,t.layersExtraParams)})},m.registerListeners=function(e){var t=this;e.on("loadstart",function(){t._incrementLoaders()}),e.on("loadend",function(){t._decrementLoaders(!1)}),this.on("extraParamsSet",function(t,i){i&&e.update(this.state,t)})},m.setTarget=function(e){this.target=e},m.addInteraction=function(e){this._unToggleControls(),this.viewer.map.addInteraction(e),e.setActive(!0)},m.removeInteraction=function(e){this.viewer.map.removeInteraction(e)},m._watchInteraction=function(e){var t=this;e.on("change:active",function(e){e.target instanceof ol.interaction.Pointer&&e.target.getActive()&&t.emit("pointerInteractionSet",e.target)})},m.goTo=function(e,t){var t=t||6;this.viewer.goTo(e,t)},m.goToWGS84=function(e,t){var e=ol.proj.transform(e,"EPSG:4326","EPSG:"+this.project.state.crs);this.goTo(e,t)},m.extentToWGS84=function(e){return ol.proj.transformExtent(e,"EPSG:"+this.project.state.crs,"EPSG:4326")},m.getResolutionForMeters=function(e){var t=this.viewer.map.getViewport();return e/Math.max(t.clientWidth,t.clientHeight)};var y=null,b=!1;m.highlightGeometry=function(e,t){this.clearHighlightGeometry();var i,t=t||{},n="boolean"!=typeof t.zoom||t.zoom,o="boolean"!=typeof t.highlight||t.highlight,r=t.duration;this.viewer.map.getView();if(e instanceof ol.geom.Geometry)i=e;else{var s=new ol.format.GeoJSON;i=s.readGeometry(e)}t.fromWGS84&&i.transform("EPSG:4326","EPSG:"+ProjectService.state.project.crs);var a=i.getType();if(n)if("Point"==a||"MultiPoint"==a&&1==i.getPoints().length){var l="Point"==a?i.getCoordinates():i.getPoint(0).getCoordinates();if(4326!=this.project.state.crs&&3857!=this.project.state.crs){var c=this.getResolutionForMeters(100);this.viewer.goToRes(l,c)}else this.viewer.goTo(l,6)}else this.viewer.fit(i,t);if(o){var u=new ol.Feature({geometry:i});y||(y=new ol.layer.Vector({source:new ol.source.Vector,style:function(e){var t=[],i=e.getGeometry().getType();if("LineString"==i){var n=new ol.style.Style({stroke:new ol.style.Stroke({color:"rgb(255,255,0)",width:4})});t.push(n)}else if("Point"==i||"MultiPoint"==i){var n=new ol.style.Style({image:new ol.style.Circle({radius:6,fill:new ol.style.Fill({color:"rgb(255,255,0)"})}),zIndex:1/0});t.push(n)}else if("MultiPolygon"==i||"Polygon"==i){var n=new ol.style.Style({stroke:new ol.style.Stroke({color:"rgb(255,255,0)",width:4}),fill:new ol.style.Fill({color:"rgba(255, 255, 0, 0.5)"})});t.push(n)}return t}}),y.setMap(this.viewer.map)),y.getSource().clear(),y.getSource().addFeature(u),r&&(b=!0,setTimeout(function(){y.getSource().clear(),b=!1},r))}},m.clearHighlightGeometry=function(){y&&!b&&y.getSource().clear()},m.refreshMap=function(){_.forEach(this._mapLayers,function(e){e.getOLLayer().getSource().updateParams({time:Date.now()})})},m.layout=function(e,t){this.viewer||this.setupViewer(e,t),this.viewer&&(this.setHidden(0==e||0==t),this.getMap().updateSize(),this._setMapView())},m._reset=function(){this._mapLayers=[]},m._setMapView=function(){var e=this.viewer.getBBOX(),t=this.viewer.getResolution(),i=this.viewer.getCenter();this.setMapView(e,t,i)},m.getMapSize=function(){var e=this.viewer.map;return e.getSize()},m.setInnerGreyCoverScale=function(e){this._drawShadow.scale=e},m._resetDrawShadowInner=function(){this._drawShadow={type:"coordinate",outer:[],inner:[],scale:null,rotation:null}},m.setInnerGreyCoverBBox=function(e){var t,i,e=e||{},n=this.viewer.map,o=e.type||"coordinate",r=e.inner||null,s=e.rotation,a=e.scale;if(r){switch(o){case"coordinate":t=n.getPixelFromCoordinate([r[0],r[1]]),i=n.getPixelFromCoordinate([r[2],r[3]]);break;case"pixel":t=[r[0],r[1]],i=[r[2],r[3]]}var l=t[1]*ol.has.DEVICE_PIXEL_RATIO,c=t[0]*ol.has.DEVICE_PIXEL_RATIO,u=i[1]*ol.has.DEVICE_PIXEL_RATIO,h=i[0]*ol.has.DEVICE_PIXEL_RATIO;this._drawShadow.inner[0]=c,this._drawShadow.inner[1]=l,this._drawShadow.inner[2]=h,this._drawShadow.inner[3]=u}_.isNil(a)?this._drawShadow.scale=this._drawShadow.scale||1:this._drawShadow.scale=a,_.isNil(s)?this._drawShadow.rotation=this._drawShadow.rotation||0:this._drawShadow.rotation=s,this._drawShadow.outer&&n.render()},m.startDrawGreyCover=function(){function e(e){var l=e.context,c=this.getSize(),u=c[1]*ol.has.DEVICE_PIXEL_RATIO,h=c[0]*ol.has.DEVICE_PIXEL_RATIO;a._drawShadow.outer=[0,0,h,u],l.restore(),l.beginPath(),l.moveTo(0,0),l.lineTo(h,0),l.lineTo(h,u),l.lineTo(0,u),l.lineTo(0,0),l.closePath(),a._drawShadow.inner.length&&(l.save(),t=a._drawShadow.inner[0],n=a._drawShadow.inner[3],i=a._drawShadow.inner[2],o=a._drawShadow.inner[1],r=a._drawShadow.rotation,s=a._drawShadow.scale,l.translate((i+t)/2,(o+n)/2),l.rotate(r*Math.PI/180),l.moveTo(-((i-t)/2),(o-n)/2),l.lineTo((i-t)/2,(o-n)/2),l.lineTo((i-t)/2,-((o-n)/2)),l.lineTo(-((i-t)/2),-((o-n)/2)),l.lineTo(-((i-t)/2),(o-n)/2),l.closePath()),l.fillStyle="rgba(0, 5, 25, 0.55)",l.fill(),l.restore()}var t,i,n,o,r,s,a=this,l=this.viewer.map;this._greyListenerKey&&this.stopDrawGreyCover(),this._greyListenerKey=l.on("postcompose",e)},m.stopDrawGreyCover=function(){var e=this.viewer.map;ol.Observable.unByKey(this._greyListenerKey),this._greyListenerKey=null,this._drawShadow.inner.length&&this._resetDrawShadowInner(),e.render()},t.exports=n},{"core/applicationservice":19,"core/g3wobject":31,"core/map/layer/binglayer":35,"core/map/layer/osmlayer":39,"core/map/layer/wmslayer":41,"core/project/projectlayer":50,"core/project/projectsregistry":51,"core/query/queryservice":56,"core/utils/utils":59,"g3w-ol3/src/g3w.ol3":70,"gui/gui":91,"gui/map/control/factory":94,"gui/map/control/registry":95,"gui/streetview/streetviewservice":122}],97:[function(e,t,i){t.exports='<div :id="target" style="width:100%;height:100%">\n  <div style="display: none;">\n    <div id="marker"></div>\n  </div>\n</div>\n\n'},{}],98:[function(e,t,i){function n(e){r(this,e),this.id="map-component",this.title="Catalogo dati",this.target=e.target||"map",this.setService(new l(e)),s(this,e),this.internalComponent=new u({mapService:this._service}),this.internalComponent.target=this.target}var o=e("core/utils/utils").inherit,r=e("core/utils/utils").base,s=e("core/utils/utils").merge,a=(e("core/i18n/i18n.service").t,e("core/utils/utils").resolve,e("gui/gui"),e("gui/vue/component")),l=(e("core/router"),e("g3w-ol3/src/g3w.ol3").helpers,e("core/map/mapsregistry"),e("../mapservice")),c={template:e("./map.html"),data:function(){return{target:"map"}},mounted:function(){var e=this,t=this.$options.mapService;this.$nextTick(function(){t.setTarget(e.$el.id)}),t.onafter("setupViewer",function(){t.setTarget(e.$el.id)})}},u=Vue.extend(c);Vue.component("g3w-map",c),o(n,a);var h=n.prototype;h.layout=function(e,t){$("#"+this.target).height(t),$("#"+this.target).width(e),this._service.layout(e,t)},t.exports=n},{"../mapservice":96,"./map.html":97,"core/i18n/i18n.service":34,"core/map/mapsregistry":42,"core/router":57,"core/utils/utils":59,"g3w-ol3/src/g3w.ol3":70,"gui/gui":91,"gui/vue/component":128}],99:[function(e,t,i){var n=e("core/utils/utils").inherit,o=e("core/utils/utils").resolve,r=e("core/g3wobject"),s=function(e){this.internalPanel=null;var e=e||{};this.id=e.id||null,this.title=e.title||""};n(s,r);var a=s.prototype;a.getId=function(){return this.id},a.getTitle=function(){return this.title},a.getInternalPanel=function(){return this.internalPanel},a.setInternalPanel=function(e){this.internalPanel=e},a.mount=function(e){var t=this.internalPanel,i=t.$mount();return $(e).append(i.$el),i.$nextTick(function(){$(e).localize(),t.onShow&&t.onShow()}),o(!0)},a.unmount=function(){var e=this.internalPanel,t=$.Deferred();return e.$destroy(!0),$(e.$el).remove(),e.onClose&&e.onClose(),this.internalComponent=null,t.resolve(),t.promise()},a.onResize=function(e,t){},t.exports=s},{"core/g3wobject":31,"core/utils/utils":59}],100:[function(e,t,i){var n=[{value:500,label:"1:500"},{value:1e3,label:"1:1.000"},{value:2e3,label:"1:2.000"},{value:2500,label:"1:2.500"},{value:5e3,label:"1:5.000"},{value:1e4,label:"1:10.000"},{value:25e3,label:"1:25.000"},{value:5e4,label:"1:50.000"},{value:1e5,label:"1:100.000"},{value:25e4,label:"1:250.000"},{value:5e5,label:"1:500.000"},{value:1e6,label:"1:1.000.000"}],o=[300,700];t.exports={scale:n,dpis:o}},{}],101:[function(e,t,i){function n(){r(this),this._initialized=!1,this._project=l.getCurrentProject(),this.state={},this.state.print=this._project.state.print,this.state.visible=!(!this.state.print||!this.state.print.length),this.state.isShow=!1,this.state.loading=!1,this.state.url=null,this.state.visible&&(this.state.template=this.state.print[0].name,this.state.rotation=0,this.state.inner=null,this.state.center=null,this.state.size=null,this.state.scale=f,this.state.scala=null,this.state.dpis=g,this.state.dpi=g[0],this.state.map=null,this.state.width=null,this.state.height=null),this._moveMapKeyEvent=null,this._page=null,this._mapService=null,this._map=null,this._scalesResolutions={},this.changeTemplate=function(){var e=this,t=this.state.template;_.forEach(this.state.print,function(i){i.name==t&&(e.state.width=i.maps[0].w,e.state.height=i.maps[0].h,e.state.map=i.maps[0].name)}),this._setPrintArea()},this.changeScale=function(){this._setPrintArea()},this.changeRotation=function(){this._mapService.setInnerGreyCoverBBox({rotation:this.state.rotation}),this._changePrintOutput()},this._getOptionsPrint=function(){var e={scale:this.state.scala,extent:this.state.inner.join(),rotation:this.state.rotation,dpi:this.state.dpi,template:this.state.template,map:this.state.map};return e},this.print=function(){var e=this;this._page=new p({service:this});var t=this._getOptionsPrint();c.print(t).then(function(t){e.state.url=t,s.setContent({content:e._page,title:"Stampa",perc:100})})},this._calculateInternalPrintExtent=function(e){var t,i,n=this.state.width/this.state.height,o=this.state.size[0]/this.state.size[1];o>1?n>1?(t=n>o?this.state.size[0]/2:this.state.size[0]*(n/o)/2,t-=parseInt(t/10),i=t/n):(i=this.state.size[1]/2,i-=parseInt(i/10),t=i*n):n>1?(t=this.state.size[0]/2,t-=parseInt(t/10),i=t/n):(i=n<o?this.state.size[1]/2:this.state.size[1]*(o/n)/2,i-=parseInt(i/10),t=i*n),x_min=this.state.center[0]-t*e,x_max=this.state.center[0]+t*e,y_min=this.state.center[1]-i*e,y_max=this.state.center[1]+i*e,this.state.inner=[x_min,y_min,x_max,y_max]},this._setPrintArea=function(){this.state.size=this._map.getSize(),this.state.currentScala=u(this._map.getView().getResolution()),this.state.center=this._map.getView().getCenter();var e=h(this.state.scala);this._calculateInternalPrintExtent(e),this._mapService.setInnerGreyCoverBBox({inner:this.state.inner,rotation:this.state.rotation})},this._clearPrint=function(){ol.Observable.unByKey(this._moveMapKeyEvent),this._moveMapKeyEvent=null},this._changePrintOutput=function(){var e=this;if(this.state.isShow){this.state.loading=!0;var t=this._getOptionsPrint();c.print(t).then(function(t){e.state.url==t&&(e.state.loading=!1),e.state.url=t})}},this._setAllScalesBasedOnMaxResolution=function(e){var t=this,i=e,n=u(i),o=_.orderBy(this.state.scale,["value"],["desc"]),r=[];_.forEach(o,function(e){n>e.value&&(r.push(e),i=h(e.value),t._scalesResolutions[e.value]=i,i/=2)}),this.state.scale=_.orderBy(r,["value"],["asc"])},this._setInitialScalaSelect=function(){var e=this,t=this._map.getView().getResolution(),i=u(t),n=!1;_.forEach(this.state.scale,function(t,o){if(i<t.value&&!e.state.scala){var r=o?o-1:o;return e.state.scala=e.state.scale[r].value,$("#scala").val(e.state.scala),n=!0,!1}}),n||(this.state.scala=this.state.scale[this.state.scale.length-1].value)},this._setCurrentScala=function(e){var t=this;_.forEach(this._scalesResolutions,function(i,n){if(i==e)return t.state.scala=n,!1})},this._setMoveendMapEvent=function(){var e=this;this._moveMapKeyEvent=this._map.on("moveend",function(){e._setPrintArea()})},this._showPrintArea=function(){this._setPrintArea(),this._mapService.startDrawGreyCover()},this._enableDisablePrintButton=function(e){this.state.isShow=e,this.emit("showpdf",e)},this._initPrintConfig=function(){var e;if(this._initialized)e=this._map.getView().getResolution(),this._setCurrentScala(e);else{var t=this._map.getView().getMaxResolution();this._setAllScalesBasedOnMaxResolution(t),this._setInitialScalaSelect(),this._initialized=!0}},this._setMapInfo=function(){var e=this;_.forEach(this.state.print[0].maps,function(t){if("map0"==t.name)return e.state.map=t.name,e.state.width=t.w,e.state.height=t.h,!1})},this.showPrintArea=function(e){this._mapService=s.getComponent("map").getService(),this._map=this._mapService.viewer.map,e?(this._setMapInfo(),this._setMoveendMapEvent(),this._initPrintConfig(),this._showPrintArea()):(this._mapService.stopDrawGreyCover(),this._clearPrint())}}var o=e("core/utils/utils").inherit,r=e("core/utils/utils").base,s=e("gui/gui"),a=e("core/g3wobject"),l=e("core/project/projectsregistry"),c=e("core/print/printservice"),u=e("core/utils/geo").resToScale,h=e("core/utils/geo").scaleToRes,d=e("./printconfig"),p=e("./vue/printpage"),f=d.scale,g=d.dpis;o(n,a),t.exports=n},{"./printconfig":100,"./vue/printpage":105,"core/g3wobject":31,"core/print/printservice":46,"core/project/projectsregistry":51,"core/utils/geo":58,"core/utils/utils":59,"gui/gui":91}],102:[function(e,t,i){t.exports='<ul id="print" class="treeview-menu">\n  <li>\n    <form id="g3w-search-form" class="form-horizonal">\n      <div class="box-body">\n        <label for="templates">Template</label>\n        <select class="form-control" @change="onChangeTemplate" v-model="state.template" id="templates" placeholder="Seleziona il template">\n          <option v-for="print in state.print">{{ print.name }}</option>\n        </select>\n        <label for="scala">Scala</label>\n        <select class="form-control" @change="onChangeScale" v-model="state.scala" id="scala" placeholder="Seleziona la scala">\n          <option v-for="scala in state.scale" :value="scala.value">{{ scala.label }}</option>\n        </select>\n        <label for="dpi">dpi</label>\n        <select class="form-control" @change="onChangeDpi"  v-model="state.dpi" id="dpi" placeholder="Seleziona i dpi">\n          <option v-for="dpi in state.dpis" >{{ dpi }}</option>\n        </select>\n        <label for="rotation">Rotazione</label>\n        <input min="-360" max="360"  @input="onChangeRotation" v-model="state.rotation" id="rotation" class="form-control" type="number">\n      </div>\n      <div class="box-footer" style="background-color: transparent">\n        <span>\n          <button style="width:100%" class="btn " :class="[button.class, isAnnullaButton(button.type) ? \'pull-right\' : \'\' ]" @click.stop.prevent="exec(button.cbk)" v-disabled="btnEnabled(button)">{{ button.title }}</button>\n        </span>\n      </div>\n    </form>\n    <div id="message" style="text-align:center; padding:3px; color: yellow" class="message" v-show="btnEnabled(button)">\n      <div>\n        <span>Muovendoti all\'interno della mappa</span>\n      </div>\n      <div>\n        <span>o cambiando i parametri della stampa</span>\n      </div>\n      <div>\n        <span>il PDF si aggiornerÃ  automaticamente</span>\n      </div>\n    </div>\n  </li>\n</ul>\n'},{}],103:[function(e,t,i){function n(e){a(this,e),this.title="print",this.vueComponent=c,this.internalComponent=null;var t=e.service||new s;this.setService(t),this.setInternalComponent=function(){var e=Vue.extend(this.vueComponent);return this.internalComponent=new e({service:t}),this.state.visible=t.state.visible,this.internalComponent.state=t.state,this.internalComponent},this._setOpen=function(){this._service.showPrintArea(this.state.open)},l(this,e)}var o=e("core/utils/utils").inherit,r=e("gui/vue/component"),s=e("gui/print/printservice"),a=e("core/utils/utils").base,l=e("core/utils/utils").merge,c={template:e("./print.html"),data:function(){var e=this;return{state:null,button:{title:"Crea PDF","class":"btn-success",type:"stampa",disabled:!1,cbk:function(){e.print()}}}},methods:{exec:function(e){e()},btnEnabled:function(e){return e.disabled},isAnnullaButton:function(e){return"annulla"==e},onChangeTemplate:function(){this.$options.service.changeTemplate()},onChangeScale:function(){this.$options.service.changeScale()},onChangeDpi:function(){},onChangeRotation:function(e){this.state.rotation>=0&&!_.isNil(this.state.rotation)&&""!=this.state.rotation?(this.state.rotation=this.state.rotation>360?360:this.state.rotation,e.target.value=this.state.rotation):this.state.rotation<0?(this.state.rotation=this.state.rotation<-360?-360:this.state.rotation,e.target.value=this.state.rotation):this.state.rotation=0,this.$options.service.changeRotation()},print:function(){this.$options.service.print()}},mounted:function(){
var e=this;this.$options.service.on("showpdf",function(t){e.button.disabled=t})}};o(n,r),t.exports=n},{"./print.html":102,"core/utils/utils":59,"gui/print/printservice":101,"gui/vue/component":128}],104:[function(e,t,i){t.exports='<div id="pdf-output" style="height:100%">\n  <div v-show="state.loading" class="bar-loader"></div>\n  <iframe id="pdf" style="border:0px;width:100%;height:100%" :src="state.url"></iframe>\n</div>'},{}],105:[function(e,t,i){var n=e("core/utils/utils").inherit,o=e("core/utils/utils").base,r=e("gui/vue/component"),s=Vue.extend({template:e("./printpage.html"),data:function(){return{state:null}},mounted:function(){var e=this;this.state.loading=!0,this.$nextTick(function(){$("#pdf").load(function(){e.state.loading=!1})})}}),a=function(e){o(this);var e=e||{},t=e.service;this.setService(t);var i=new s;this.setInternalComponent(i),this.internalComponent.state=t.state,this.unmount=function(){var e=o(this,"unmount");return t._enableDisablePrintButton(!1),e}};n(a,r),t.exports=a},{"./printpage.html":104,"core/utils/utils":59,"gui/vue/component":128}],106:[function(e,t,i){function n(e){this.state={},r(this)}var o=e("core/utils/utils").inherit,r=e("core/utils/utils").base,s=e("core/g3wobject");o(n,s),t.exports=n},{"core/g3wobject":31,"core/utils/utils":59}],107:[function(e,t,i){t.exports='<div id="photo" style="margin: 10px;">\n  <img :src="url" style="width: 100%;">\n</div>'},{}],108:[function(e,t,i){var n=e("core/utils/utils").inherit,o=e("core/utils/utils").base,r=e("gui/vue/component"),s=e("../photoservice"),a=Vue.extend({template:e("./photo.html"),data:function(){return{state:null,url:this.$options.url}}}),l=function(e){o(this);var e=e||{},t=e.service||new s({}),i=e.url||null;this.setService(t);var n=new a({service:t,url:i});this.setInternalComponent(n),this.internalComponent.state=t.state};n(l,r),t.exports=l},{"../photoservice":106,"./photo.html":107,"core/utils/utils":59,"gui/vue/component":128}],109:[function(e,t,i){function n(e){this.state={},this._project=s.getCurrentProject(),r(this),this.getRelations=function(e){var t=this._project.state.id;e=e||{};var i=e.value||null,n=e.id||null;return $.get("/qdjango/api/relations/"+t+"/"+n+"/"+i)},this.buildRelationTable=function(e){var t=_.keys(e[0]),i=[];return _.forEach(e,function(e){i.push(_.values(e))}),{columns:t,rows:i}}}var o=e("core/utils/utils").inherit,r=e("core/utils/utils").base,s=e("core/project/projectsregistry"),a=e("core/g3wobject");e("gui/gui");o(n,a),t.exports=n},{"core/g3wobject":31,"core/project/projectsregistry":51,"core/utils/utils":59,"gui/gui":91}],110:[function(e,t,i){t.exports='<div class="query-relation">\n  <div class="back-btn" @click="back">\n    <span class="back-link">\n      <span class="glyphicon glyphicon-chevron-left"></span>\n      Ritorna alle Relazioni\n    </span>\n  </div>\n  <div class="header">\n    <div>\n      Dati relativi alla relazione <b>{{ relation.name }}</b>\n    </div>\n  </div>\n  <div class="nano" v-if="table.rows.length">\n    <div class="nano-content">\n      <table class="table table-striped">\n        <thead>\n          <tr>\n            <th v-for="column in table.columns">{{ column }}</th>\n          </tr>\n        </thead>\n        <tbody>\n          <tr v-for="row in table.rows">\n            <td v-for="value in row">{{ value }}</td>\n          </tr>\n        </tbody>\n        </table>\n    </div>\n  </div>\n  <div v-else> Non ci sono relazioni </div>\n\n</div>\n'},{}],111:[function(e,t,i){t.exports='<div class="query-relations">\n  <div class="header">\n    <div>Elenco Relazioni della feature <span v-for="info in featureInfo()"><b>{{ info.key }}</b>: {{ info.value }} </span></div>\n  </div>\n  <div class="nano">\n    <div class="nano-content">\n      <table class="table table-bordered table-hover">\n        <thead>\n        </thead>\n        <tbody>\n          <tr @click="showRelation(relation)" v-for="relation in relations" style="cursor:pointer">\n            <td>{{ relation.name }}<span class="glyphicon glyphicon-chevron-right pull-right" aria-hidden="true"></span></td>\n          </tr>\n        </tbody>\n      </table>\n    </div>\n  </div>\n</div>\n'},{}],112:[function(e,t,i){t.exports='<div class="query-relations-page">\n    <component\n        :is="currentview"\n        :relations="relations"\n        :relation="relation"\n        :feature="feature"\n        :table="table">\n    </component>\n</div>'},{}],113:[function(e,t,i){var n=e("core/utils/utils").inherit,o=e("core/utils/utils").base,r=e("gui/vue/component"),s=e("../relationsservice"),a={template:e("./relations.html"),props:["relations","feature"],methods:{showRelation:function(e){this.$parent.showRelation(e)},featureInfo:function(){var e=[],t=0;return _.forEach(this.feature.attributes,function(i,n){return!(t>2)&&void(i&&_.isString(i)&&i.indexOf("/")==-1&&(e.push({key:n,value:i}),t+=1))}),e}}},l={template:e("./relation.html"),props:["table","relation"],methods:{back:function(){this.$parent.setRelationsList()}}},c=Vue.extend({template:e("./relationspage.html"),data:function(){return{state:null,table:null,relation:null,relations:this.$options.relations,feature:this.$options.feature,currentview:"relations"}},components:{relations:a,relation:l},methods:{showRelation:function(e){var t=this;this.relation=e;var i=e.fieldRef.referencedField,n=this.feature.attributes[i];this.$options.service.getRelations({id:e.id,value:n}).then(function(e){t.table=t.$options.service.buildRelationTable(e),t.currentview="relation",Vue.nextTick(function(){$(".nano").nanoScroller()})})},setRelationsList:function(){this.currentview="relations"}}}),u=function(e){o(this);var e=e||{},t=e.service||new s({}),i=e.relations||[],n=e.feature||null;this.setService(t);var r=new c({service:t,relations:i,feature:n});this.setInternalComponent(r),r.state=t.state};n(u,r),t.exports=u},{"../relationsservice":109,"./relation.html":110,"./relations.html":111,"./relationspage.html":112,"core/utils/utils":59,"gui/vue/component":128}],114:[function(e,t,i){function n(){var e=this;this._relations=s.getCurrentProject().state.relations?_.groupBy(s.getCurrentProject().state.relations,"referencedLayer"):null,this._actions={zoomto:n.zoomToElement,highlightgeometry:n.highlightGeometry,clearHighlightGeometry:n.clearHighlightGeometry},this.state={},this.init=function(e){this.clearState()},this.setters={setQueryResponse:function(e,t,i){this.clearState(),this.state.query=e.query;var n=this._digestFeaturesForLayers(e.data);this.setLayersData(n)},setLayersData:function(e){this.state.loading=!1,this.state.layers=e,this.setActionsForLayers(e)},addActionsForLayers:function(e){},postRender:function(e){}},this.clearState=function(){this.state.layers=[],this.state.query={},this.state.querytitle="",this.state.loading=!0,this.state.layersactions={}},this.getState=function(){return this.state},this.setState=function(e){this.state=e},this.setTitle=function(e){this.state.querytitle=e||""},this.reset=function(){this.clearState()},this._digestFeaturesForLayers=function(e){var t=this,i=0,n=[];return _.forEach(e,function(e){var o=e.layer;if(e.features.length){var r={title:o.state.title,id:o.state.id,attributes:t._parseAttributes(o.getAttributes(),e.features[0].getProperties()),features:[],hasgeometry:!1,show:!0,expandable:!0,hasImageField:!1};_.forEach(r.attributes,function(e){"image"==e.type&&(r.hasImageField=!0)}),_.forEach(e.features,function(e){var t=e.getId()?e.getId():i,n=e.getGeometry();n&&(r.hasgeometry=!0);var o={id:t,attributes:e.getProperties(),geometry:e.getGeometry(),show:!0};r.features.push(o),i+=1}),n.push(r)}}),n},this._parseAttributes=function(e,t){var i=_.keys(t);if(i=_.filter(i,function(e){return["boundedBy","geom","the_geom","geometry","bbox"].indexOf(e)==-1}),e&&e.length){var i=_.keys(t);return _.filter(e,function(e){return i.indexOf(e.name)>-1})}return _.map(i,function(e){return{name:e,label:e}})},this.setActionsForLayers=function(e){var t=this;_.forEach(e,function(e){t.state.layersactions[e.id]||(t.state.layersactions[e.id]=[]),e.hasgeometry&&t.state.layersactions[e.id].push({id:"gotogeometry","class":"glyphicon glyphicon-map-marker",hint:"Visualizza sulla mappa",cbk:n.goToGeometry}),t._relations&&_.forEach(t._relations,function(i,o){return e.id==o&&t.state.layersactions[e.id].push({id:"show-query-relations","class":"fa fa-sitemap",hint:"Visualizza Relazioni",cbk:n.showQueryRelations,relations:i}),!1})}),this.addActionsForLayers(t.state.layersactions)},this.trigger=function(t,i,n){var o=this._actions[t];if(o&&o(i,n),i){var r=e.state.layersactions[i.id];if(r){var s;_.forEach(r,function(e){e.id==t&&(s=e)}),s&&this.triggerLayerAction(s,i,n)}}},this.triggerLayerAction=function(e,t,i){if(e.cbk&&e.cbk(t,i,e),e.route){var n,o=e.route;n=o.replace(/{(\w*)}/g,function(e,t){return i.attributes.hasOwnProperty(t)?i.attributes[t]:""}),n&&""!=n&&a["goto"](n)}},this.showFullPhoto=function(e){a.pushContent({content:new u({url:e}),backonclose:!0,closable:!1})},r(this)}var o=e("core/utils/utils").inherit,r=e("core/utils/utils").base,s=e("core/project/projectsregistry"),a=e("gui/gui"),l=e("core/g3wobject"),c=e("gui/componentsregistry"),u=e("./components/photo/vue/photo"),h=e("./components/relations/vue/relationspage");n.zoomToElement=function(e,t){},n.goToGeometry=function(e,t){if(t.geometry){var i=c.getComponent("map").getService();i.highlightGeometry(t.geometry,{duration:4e3})}},n.highlightGeometry=function(e,t){if(t.geometry){var i=c.getComponent("map").getService();i.highlightGeometry(t.geometry,{zoom:!1})}},n.clearHighlightGeometry=function(e,t){var i=c.getComponent("map").getService();i.clearHighlightGeometry()},n.showQueryRelations=function(e,t,i){a.pushContent({content:new h({relations:i.relations,feature:t}),backonclose:!0,closable:!1})},o(n,l),t.exports=n},{"./components/photo/vue/photo":108,"./components/relations/vue/relationspage":113,"core/g3wobject":31,"core/project/projectsregistry":51,"core/utils/utils":59,"gui/componentsregistry":84,"gui/gui":91}],115:[function(e,t,i){t.exports='<div id="search-results" class="queryresults-wrapper">\n  <h3 v-if="state.querytitle">Risultati {{state.querytitle.toLowerCase()}}</h3>\n  <div v-show="state.loading" class="bar-loader"></div>\n  <div class="queryresults-container">\n    <ul v-if="hasResults()" class="queryresults" id="queryresults">\n      <li v-if="layerHasFeatures(layer) && layer.show" v-for="layer in state.layers">\n        <div class="box box-primary">\n          <div class="box-header with-border" data-widget="collapse">\n            <h3 class="box-title">{{ layer.title }} ({{layer.features.length}})</h3>\n            <div class="box-tools pull-right">\n              <button class="btn btn-box-tool" data-widget="collapse"><i class="btn-collapser fa fa-minus"></i></button>\n            </div>\n          </div>\n          <div class="box-body">\n            <table class="table table-striped">\n              <thead>\n              <tr>\n                <th v-if="layer.hasgeometry"></th>\n                <th v-for="(attribute, index) in attributesSubset(layer.attributes)" :style="{ width:cellWidth(index,layer) + \'%\' }">{{attribute.label}}</th>\n                <th :style="{ width:headerExpandActionCellWidth + \'%\' }"></th>\n              </tr>\n              </thead>\n              <tbody>\n              <template v-if="feature.show" v-for="feature in layer.features">\n                <tr @click="toggleFeatureBoxAndZoom(layer,feature);" @mouseover="trigger(\'highlightgeometry\',layer,feature)" @mouseout="trigger(\'clearHighlightGeometry\')" class="featurebox-header">\n                  <td v-if="geometryAvailable(feature)" class="action-cell">\n                    <span @click.stop.prevent="trigger(\'gotogeometry\',layer,feature)" class="glyphicon glyphicon-map-marker action-button-icon"></span>\n                  </td>\n                  <td v-for="attribute in attributesSubset(layer.attributes)">\n                    <span>{{feature.attributes[attribute.name]}}</span>\n                  </td>\n                  <td class="action-cell">\n                    <span v-if="layer.expandable" class="fa link morelink" :class="[collapsedFeatureBox(layer,feature) ? \'fa-plus\' : \'fa-minus\']"></span>\n                  </td>\n                </tr>\n                <tr v-show="!collapsedFeatureBox(layer,feature) && layer.expandable" class="featurebox-body">\n                  <td :colspan="attributesSubsetLength(layer.attributes)+2">\n                    <div class="action-buttons-container">\n                      <template v-for="action in state.layersactions[layer.id]">\n                        <div @click="trigger(action.id,layer,feature)"  class="action-button hint--top-right" :aria-label="action.hint">\n                          <span :class="\'action-button-icon \' + action.class"></span>\n                        </div>\n\n                      </template>\n                    </div>\n                    <table>\n                      <tr v-for="attribute in layer.attributes">\n                        <td class="attr-label">{{attribute.label}}</td>\n                        <!--<td class="attr-value">{{feature.attributes[attribute.name]}}</td>-->\n                        <td class="attr-value">\n                          <span v-if="is(\'simple\',layer,attribute.name,feature.attributes[attribute.name])">{{feature.attributes[attribute.name]}}</span>\n                          <!--<span v-if="isRoute(layer,feature,attribute)" class="link dashboardlink" @click="goto(layer,feature.attributes[attribute.name])">{{ feature.attributes[attribute.name] }}</span>-->\n                          <!--<img v-if="isPhoto(layer,feature,attribute)" :data-url="getPhotoUrl(feature.attributes[attribute.name])" style="max-width:50px" :src="getPhotoUrl(feature.attributes[attribute.name],thumb)" />-->\n                          <img v-if="is(\'photo\',layer,attribute.name,feature.attributes[attribute.name])"  class="photo-preview img-responsive img-thumbnail" title="Clicca per allargare"  @click="showFullPhoto(isRelativePath(feature.attributes[attribute.name]))" :src="isRelativePath(feature.attributes[attribute.name])">\n                          <a v-if="is(\'link\',layer,attribute.name,feature.attributes[attribute.name])" :href="feature.attributes[attribute.name]" target="_blank" class="glyphicon glyphicon-link"></a>\n                        </td>\n                      </tr>\n                    </table>\n                  </td>\n                </tr>\n                <tr v-show="collapsedFeatureBox(layer,feature) && feature.attributes.relations">\n                  <td :colspan="attributesSubsetLength(layer.attributes)+2">\n                    <!--Relazioni-->\n                    <div class="queryresults-container">\n                      <ul class="queryresults" id="relations">\n                        <template v-for="relation in feature.attributes.relations">\n                          <li>\n                            <div class="box box-solid box-default relationsbox collapsed-box">\n                              <div class="box-header with-border" data-widget="collapse">\n                                <h3 class="box-title">{{ relation.name }} ({{ relation.elements.length }})</h3>\n                                <div class="box-tools pull-right">\n                                  <button class="btn btn-box-tool" data-widget="collapse"><i class="btn-collapser fa fa-plus"></i></button>\n                                </div>\n                              </div>\n                              <div class="box-body">\n                                <template v-for="(element, index) in relation.elements">\n                                  <table class="table table-striped">\n                                    <thead>\n                                    <tr>\n                                      <th v-for="attribute in relationsAttributesSubset(element)">\n                                        {{attribute.label}}\n                                      </th>\n                                      <th></th>\n                                    </tr>\n                                    </thead>\n                                    <tbody>\n                                    <tr @click="toggleFeatureBox(layer, feature, relation.name+index)"  class="featurebox-header">\n                                      <td v-for="attribute in relationsAttributesSubset(element)">\n                                        <span>{{attribute.value}}</span>\n                                      </td>\n                                      <td class="action-cell text-center">\n                                        <span class="fa link morelink" :class="[collapsedFeatureBox(layer, feature, relation.name+index) ? \'fa-minus\' : \'fa-plus\']" style="text-align: right"></span>\n                                      </td>\n                                    </tr>\n                                    <tr v-show="collapsedFeatureBox(layer, feature, relation.name+index)" class="featurebox-body">\n                                      <td :colspan="relationsAttributesSubsetLength(element)+1">\n                                        <table>\n                                          <tr v-for="relattribute in relationsAttributes(element)">\n                                            <td class="attr-label">{{relattribute.label}}</td>\n                                            <!--<td class="attr-value">{{attribute.value}}</td>-->\n                                            <td class="attr-value">\n                                              <span v-if="isSimple(layer,relattribute.name,relattribute.value)">{{relattribute.value}}</span>\n                                              <!--<span v-if="isRoute(layer,feature,attribute)" class="link dashboardlink" @click="goto(layer,feature.attributes[attribute.name])">{{ feature.attributes[attribute.name] }}</span>-->\n                                              <!--<img v-if="isPhoto(layer,feature,attribute)" v-bind:data-url="getPhotoUrl(feature.attributes[attribute.name])" style="max-width:50px" :src="getPhotoUrl(feature.attributes[attribute.name],thumb)" />-->\n                                              <a v-if="isLink(layer,relattribute.name,relattribute.value)" :href="relattribute.value" target="_blank" class="glyphicon glyphicon-link"></a>\n                                            </td>\n                                          </tr>\n                                        </table>\n                                      </td>\n                                    </tr>\n                                    </tbody>\n                                  </table>\n                                </template>\n                              </div>\n                            </div>\n                          </li>\n                        </template>\n                      </ul>\n                    </div>\n                    <!--Fine Relazioni-->\n                  </td>\n                </tr>\n              </template>\n              </tbody>\n            </table>\n          </div>\n        </div>\n      </li>\n    </ul>\n  </div>\n  <span v-if="!hasResults() && !state.loading">Nessun risultato</span>\n</div>\n\n'},{}],116:[function(e,t,i){function n(e,t,i){var n=/^(https?:\/\/[^\s]+)/g,o=/[^\s]+.(png|jpg|jpeg)$/g;if(_.isNil(i))return Fields.SIMPLE;i=i.toString();i.split(".").pop();return i.match(o)?Fields.PHOTO:i.match(n)?Fields.LINK:Fields.SIMPLE}function o(e,t,i,o){var r=n(t,i,o);return r===e}function r(e){a(this,e);var t=this;this.id="queryresults",this.title="Query Results",this._service=new u,this.setInternalComponent=function(){this.internalComponent=new v({queryResultsService:this._service}),this.createLayersFeaturesBoxes(),this.internalComponent.querytitle=this._service.state.querytitle},this.getElement=function(){if(this.internalComponent)return this.internalComponent.$el},this._service.onafter("setLayersData",function(){t.internalComponent||t.setInternalComponent(),t.createLayersFeaturesBoxes()}),l(this,e),this.createLayersFeaturesBoxes=function(){var e={},t=this._service.state.layers;_.forEach(t,function(t){t.attributes.length<=d&&!t.hasImageField&&(t.expandable=!1),_.forEach(t.features,function(i,n){var o=!0,r=t.id+"_"+i.id;e[r]={collapsed:o},i.attributes.relations&&(r="",_.forEach(i.attributes.relations,function(n){r=t.id+"_"+i.id+"_"+n.name,_.forEach(n.elements,function(t,i){e[r+i]={collapsed:!0}})}))})}),this.internalComponent.layersFeaturesBoxes=e},this.layout=function(e,t){}}var s=e("core/utils/utils").inherit,a=e("core/utils/utils").base,l=e("core/utils/utils").merge,c=e("gui/vue/component"),u=e("gui/queryresults/queryresultsservice"),h=e("core/project/projectsregistry");Fields={},Fields.SIMPLE="simple",Fields.LINK="link",Fields.PHOTO="photo",Fields.POINTLINK="pointlink",Fields.ROUTE="route";var d=3,p=10,f=10,g={template:e("./queryresults.html"),data:function(){return{state:this.$options.queryResultsService.state,layersFeaturesBoxes:{},headerExpandActionCellWidth:p,headerActionsCellWidth:f}},methods:{isSimple:function(e,t,i){return o(Fields.SIMPLE,e,t,i)},isLink:function(e,t,i){return o(Fields.LINK,e,t,i)},is:function(e,t,i,n){return o(e,t,i,n)},isRelativePath:function(e){return _.startsWith(e,"/")?e:h.getConfig().mediaurl+e},layerHasFeatures:function(e){return!!e.features&&e.features.length>0},hasResults:function(){return this.state.layers.length},layerHasActions:function(e){return this.state.layersactions[e.id].length>0},featureHasActions:function(e,t){return this.geometryAvailable(t)},geometryAvailable:function(e){return!!e.geometry},attributesSubset:function(e){var e=_.filter(e,function(e){return"image"!=e.type}),t=Math.min(d,e.length);return e.slice(0,t)},relationsAttributesSubset:function(e){var t=[];_.forEach(e,function(e,i){t.push({label:i,value:e})});var i=Math.min(d,t.length);return t.slice(0,i)},relationsAttributes:function(e){var t=[];return _.forEach(e,function(e,i){t.push({label:i,value:e})}),t},attributesSubsetLength:function(e){return this.attributesSubset(e).length},cellWidth:function(e,t){var i=this.attributesSubsetLength(t.attributes),n=d-i;actionsCellWidth=t.hasgeometry?f:0;var o=100-p-actionsCellWidth,r=o/d;return e==i-1&&n>0?r*(n+1):r},featureBoxColspan:function(e){var t=this.attributesSubsetLength(e.attributes);return e.expandable&&(t+=1),e.hasgeometry&&(t+=1),t},relationsAttributesSubsetLength:function(e){return this.relationsAttributesSubset(e).length},collapsedFeatureBox:function(e,t,i){var n,o=!0;return n=_.isNil(i)?e.id+"_"+t.id:e.id+"_"+t.id+"_"+i,this.layersFeaturesBoxes[n]&&(o=this.layersFeaturesBoxes[n].collapsed),o},toggleFeatureBox:function(e,t,i){var n;n=_.isNil(i)?e.id+"_"+t.id:e.id+"_"+t.id+"_"+i,this.layersFeaturesBoxes[n].collapsed=!this.layersFeaturesBoxes[n].collapsed},toggleFeatureBoxAndZoom:function(e,t,i){this.toggleFeatureBox(e,t,i)},trigger:function(e,t,i){this.$options.queryResultsService.trigger(e,t,i)},showFullPhoto:function(e){this.$options.queryResultsService.showFullPhoto(e)}},watch:{"state.layers":function(e){var t=this;e.length&&this.$nextTick(function(){t.$options.queryResultsService.postRender(t.$el)})}}},v=Vue.extend(g);s(r,c),t.exports=r},{"./queryresults.html":115,"core/project/projectsregistry":51,"core/utils/utils":59,"gui/queryresults/queryresultsservice":114,"gui/vue/component":128}],117:[function(e,t,i){function n(){this.init=function(e){var t=e||s.getCurrentProject().state.search;this.state.searches=t},this.state={searches:[]},this.showSearchPanel=function(e){var t=new l;return t.init(e),r.showPanel(t),t},this.cleanSearchPanels=function(){this.state.panels={}},this.stop=function(){var e=$.Deferred();return e.resolve(),e.promise()}}var o=e("core/utils/utils").inherit,r=e("gui/gui"),s=e("core/project/projectsregistry"),a=e("core/g3wobject"),l=e("gui/search/vue/panel/searchpanel");o(n,a),t.exports=n},{"core/g3wobject":31,"core/project/projectsregistry":51,"core/utils/utils":59,"gui/gui":91,"gui/search/vue/panel/searchpanel":119}],118:[function(e,t,i){t.exports='<div class="g3w-search-panel form-group">\n  <h4> {{title}}</h4>\n  <form id="g3w-search-form">\n    <template v-for="(forminput, index) in forminputs">\n      <div v-if="forminput.input.type == \'numberfield\'" class="form-group numeric">\n        <label :for="forminput.id + \' \'">{{ forminput.label }}</label>\n        <input type="number" v-model="formInputValues[index].value" class="form-control" :id="forminput.id">\n      </div>\n      <div v-if="forminput.input.type == \'textfield\' || forminput.input.type == \'textField\'" class="form-group text">\n        <label :for="forminput.id">{{ forminput.label }}</label>\n        <input type="text" v-model="formInputValues[index].value" class="form-control" :id="forminput.id">\n      </div>\n    </template>\n    <div class="form-group">\n      <button class="btn btn-block btn-primary pull-right" @click="doSearch($event)" data-i18n="dosearch">Search</button>\n    </div>\n  </form>\n</div>\n'},{}],119:[function(e,t,i){function n(e){self=this;var e=e||{};this.config={},this.filter={},this.id=null,this.querylayerid=null,this.internalPanel=e.internalPanel||new c,this.init=function(e){this.config=e||{},this.name=this.config.name||this.name,this.id=this.config.id||this.id,this.filter=this.config.options.filter||this.filter;var t=this.config.options.querylayerid||this.querylayerid;this.queryLayer=l.getCurrentProject().getLayerById(t),this.fillInputsFormFromFilter();var i=s.createQueryFilterFromConfig(this.filter);this.internalPanel.filterObject=s.createQueryFilterObject({queryLayers:[this.queryLayer],filter:i}),this.internalPanel.filterObject=this.internalPanel.filterObject[0],this.internalPanel.fillFilterInputsWithValues=this.fillFilterInputsWithValues,this.internalPanel.title=this.name},this.fillInputsFormFromFilter=function(){var e,t=0;_.forEach(this.filter,function(i,n,o){_.forEach(i,function(i){e={},i.id=t,e.type=i.input.type,e.value=null,self.internalPanel.formInputValues.push(e),self.internalPanel.forminputs.push(i),t+=1})})},this.fillFilterInputsWithValues=function(e,t,i){function n(e,t){switch(e){case"numberfield":t=parseInt(t)}return t}return _.forEach(e.filter,function(e,o){_.forEach(e,function(e,o){_.forEach(e,function(r,s,a){_.isArray(r)?fillFilterInputsWithValues(e,t,o):_.forEach(r,function(e,r,s){index=i?i+o:o,s[r]=n(t[index].type,t[index].value)})})})}),e}}var o=e("core/utils/utils").inherit,r=(e("core/i18n/i18n.service").t,e("core/utils/utils").resolve,e("gui/gui")),s=e("core/query/queryservice"),a=(e("gui/listpanel").ListPanel,e("gui/panel")),l=e("core/project/projectsregistry"),c=Vue.extend({template:e("./searchpanel.html"),data:function(){return{title:"",forminputs:[],filterObject:{},formInputValues:[]}},methods:{doSearch:function(e){var t=this;e.preventDefault(),this.filterObject=this.fillFilterInputsWithValues(this.filterObject,this.formInputValues);var i=r.showContentFactory("query"),n=i(t.title);s.queryByFilter([this.filterObject]).then(function(e){n.setQueryResponse(e)}).fail(function(){n.setQueryResponse({})})}}});o(n,a),t.exports=n},{"./searchpanel.html":118,"core/i18n/i18n.service":34,"core/project/projectsregistry":51,"core/query/queryservice":56,"core/utils/utils":59,"gui/gui":91,"gui/listpanel":93,"gui/panel":99}],120:[function(e,t,i){t.exports='<ul id="g3w-search" class="treeview-menu g3w-search g3w-tools menu-items">\n  <li v-for="search in project.search" class="menu-item">\n      <span @click="showSearchPanel(search)">{{ search.name }}</span>\n  </li>\n</ul>\n'},{}],121:[function(e,t,i){function n(e){r(this,e),this.id="search-component",this.title="search",this._service=new c,this.internalComponent=new h({searchesService:this._service}),this.state.visible=l.getCurrentProject().state.search.length>0,s(this,e),this.initService=function(){this._service.init()}}var o=e("core/utils/utils").inherit,r=e("core/utils/utils").base,s=e("core/utils/utils").merge,a=e("gui/vue/component"),l=e("core/project/projectsregistry"),c=e("gui/search/searchesservice"),u={template:e("./search.html"),data:function(){return{project:l.getCurrentProject().state}},methods:{showSearchPanel:function(e){this.$options.searchesService.showSearchPanel(e)}}},h=Vue.extend(u);o(n,a),t.exports=n},{"./search.html":120,"core/project/projectsregistry":51,"core/utils/utils":59,"gui/search/searchesservice":117,"gui/vue/component":128}],122:[function(e,t,i){function n(){this._position=null,this.setters={postRender:function(e){}},this.getPosition=function(){return this._position},this.showStreetView=function(e){this._position=e,a.setContent({content:new l({service:this}),title:"StreetView"})},r(this)}var o=e("core/utils/utils").inherit,r=e("core/utils/utils").base,s=e("core/g3wobject"),a=e("gui/gui"),l=e("gui/streetview/vue/streetview");o(n,s),t.exports=n},{"core/g3wobject":31,"core/utils/utils":59,"gui/gui":91,"gui/streetview/vue/streetview":124}],123:[function(e,t,i){t.exports='<div id="streetview"></div>'},{}],124:[function(e,t,i){var n=e("core/utils/utils").inherit,o=e("core/utils/utils").base,r=e("gui/vue/component"),s=Vue.extend({template:e("./streetview.html"),data:function(){return{state:null}},mounted:function(){var e=this;this.$nextTick(function(){var t=e.$options.service.getPosition();e.$options.service.postRender(t)})}}),a=function(e){o(this);var e=e||{},t=e.service;this.setService(t);var i=new s({service:t});this.setInternalComponent(i),this.unmount=function(){return o(this,"unmount")}};n(a,r),t.exports=a},{"./streetview.html":123,"core/utils/utils":59,"gui/vue/component":128}],125:[function(e,t,i){function n(){var e=this;this.config=null,this._actions={},this.state={toolsGroups:[]},this.setters={addToolGroup:function(t,i){e.state.toolsGroups.splice(t,0,i)}},this.addTools=function(e,t,i){var n=this,o=this._getToolsGroup(t);o||(o={name:t,tools:[]},this.addToolGroup(e,o)),_.forEach(i,function(e){o.tools.push(e),n._addAction(e)})},this.removeTool=function(e){},this.updateToolsGroup=function(e,t){Vue.set(this.state.toolsGroups,e,t)},this.getState=function(){return this.state},this.fireAction=function(e){var t=this._actions[e];t()},this._getToolsGroup=function(e){var t=null;return _.forEach(this.state.toolsGroups,function(i){i.name==e&&(t=i)}),t},this._addAction=function(e){var t=Math.floor(1e6*Math.random())+1;e.actionId=t,this._actions[t]=e.action},r(this)}var o=e("core/utils/utils").inherit,r=e("core/utils/utils").base,s=e("core/g3wobject");o(n,s),t.exports=n},{"core/g3wobject":31,"core/utils/utils":59}],126:[function(e,t,i){t.exports='<ul class="g3w-tools treeview-menu">\n  <li v-for="group in state.toolsGroups">\n    <div class="tool-header">\n      <span style="">{{ group.name }}</span>\n    </div>\n    <div :id="group.name + \'-tools\'" class="tool-box">\n      <template v-for="tool in group.tools">\n        <div v-if="tool.type == \'checkbox\' " class="checkbox tool">\n          <label><input style="cursor:pointer" :checked="tool.isCheck" type="checkbox" @click="fireAction(tool.actionId)" value="">{{ tool.name }}</label>\n        </div>\n        <div v-else class="tool" >\n          <i class="glyphicon glyphicon-cog"></i>\n          <span @click="fireAction(tool.actionId)">{{ tool.name }}</span>\n        </div>\n      </template>\n    </div>\n  </li>\n</ul>\n\n'},{}],127:[function(e,t,i){function n(e){r(this,e);var t=this;this._service=new l,this.id="tools-component",this.title="tools",this.state.visible=!1,this._service.onafter("addToolGroup",function(){t.state.visible=t._service.state.toolsGroups.length>0}),s(this,e),this.internalComponent=new c({toolsService:this._service}),this.internalComponent.state=this._service.state}var o=(e("core/i18n/i18n.service").t,e("core/utils/utils").inherit),r=e("core/utils/utils").base,s=e("core/utils/utils").merge,a=e("gui/vue/component"),l=e("gui/tools/toolsservice"),c=Vue.extend({template:e("./tools.html"),data:function(){return{state:null}},methods:{fireAction:function(e){
this.$options.toolsService.fireAction(e)}}});o(n,a);n.prototype;t.exports=n},{"./tools.html":126,"core/i18n/i18n.service":34,"core/utils/utils":59,"gui/tools/toolsservice":125,"gui/vue/component":128}],128:[function(e,t,i){var n=e("core/utils/utils").inherit,o=e("core/utils/utils").base,r=e("core/utils/utils").resolve,s=e("gui/component"),a=function(e){o(this,e)};n(a,s);var l=a.prototype;l.mount=function(e,t){var i=$.Deferred();if(this.internalComponent||this.setInternalComponent(),t){var n=this.internalComponent.$mount();$(e).append(n.$el)}else this.internalComponent.$mount(e);return Vue.nextTick(function(){$(e).localize(),i.resolve(!0)}),i.promise()},l.unmount=function(){if(_.isNil(this.internalComponent)){return r()}return this.internalComponent.$destroy(!0),$(this.internalComponent.$el).remove(),this.internalComponent=null,r()},l.ismount=function(){return this.internalComponent&&this.internalComponent.$el},l.layout=function(e,t){this.internalComponent},t.exports=a},{"core/utils/utils":59,"gui/component":83}],129:[function(e,t,i){var n=e("core/i18n/i18n.service").t;Vue.directive("disabled",function(e,t){t.value?e.setAttribute("disabled","disabled"):e.removeAttribute("disabled")}),Vue.directive("checked",function(e,t){t.value?e.setAttribute("checked","checked"):e.removeAttribute("checked")}),Vue.directive("selected-first",function(e,t){0==t.value?e.setAttribute("selected",""):e.removeAttribute("selected")}),Vue.directive("t",function(e,t){return n(t.value)})},{"core/i18n/i18n.service":34}],130:[function(e,t,i){var n=n||{};n.core={G3WObject:e("core/g3wobject"),utils:e("core/utils/utils"),ApplicationService:e("core/applicationservice"),ApiService:e("core/apiservice"),Router:e("core/router"),ProjectsRegistry:e("core/project/projectsregistry"),Project:e("core/project/project"),QueryService:e("core/query/queryservice"),MapLayer:e("core/map/layer/maplayer"),VectorLayer:e("core/map/layer/vectorlayer"),WmsLayer:e("core/map/layer/wmslayer"),VectorLayerLoader:e("core/map/layer/loader/vectorloaderlayer"),Geometry:e("core/geometry/geometry"),geom:e("core/geometry/geom"),PickCoordinatesInteraction:e("g3w-ol3/src/interactions/pickcoordinatesinteraction"),PickFeatureInteraction:e("g3w-ol3/src/interactions/pickfeatureinteraction"),i18n:e("core/i18n/i18n.service"),Plugin:e("core/plugin/plugin"),PluginsRegistry:e("core/plugin/pluginsregistry"),PluginService:e("core/plugin/pluginservice"),Editor:e("core/editing/editor"),EditBuffer:e("core/editing/editbuffer"),RelationEditBuffer:e("core/editing/relationeditbuffer")},n.gui={GUI:e("gui/gui"),Panel:e("gui/panel"),ControlFactory:e("gui/map/control/factory"),vue:{Component:e("gui/vue/component"),SearchComponent:e("gui/search/vue/search"),SearchPanel:e("gui/search/vue/panel/searchpanel"),PrintComponent:e("gui/print/vue/print"),CatalogComponent:e("gui/catalog/vue/catalog"),MapComponent:e("gui/map/vue/map"),ToolsComponent:e("gui/tools/vue/tools"),QueryResultsComponent:e("gui/queryresults/vue/queryresults"),FormComponent:e("gui/form/vue/form"),EditorPanelComponent:e("gui/editingpanel/vue/panel")}},n.ol3={interactions:{PickFeatureInteraction:e("g3w-ol3/src/interactions/pickfeatureinteraction")},controls:{}},t.exports={core:n.core,gui:n.gui,ol3:n.ol3}},{"core/apiservice":18,"core/applicationservice":19,"core/editing/editbuffer":21,"core/editing/editor":22,"core/editing/relationeditbuffer":23,"core/g3wobject":31,"core/geometry/geom":32,"core/geometry/geometry":33,"core/i18n/i18n.service":34,"core/map/layer/loader/vectorloaderlayer":37,"core/map/layer/maplayer":38,"core/map/layer/vectorlayer":40,"core/map/layer/wmslayer":41,"core/plugin/plugin":43,"core/plugin/pluginservice":44,"core/plugin/pluginsregistry":45,"core/project/project":49,"core/project/projectsregistry":51,"core/query/queryservice":56,"core/router":57,"core/utils/utils":59,"g3w-ol3/src/interactions/pickcoordinatesinteraction":72,"g3w-ol3/src/interactions/pickfeatureinteraction":73,"gui/catalog/vue/catalog":79,"gui/editingpanel/vue/panel":87,"gui/form/vue/form":89,"gui/gui":91,"gui/map/control/factory":94,"gui/map/vue/map":98,"gui/panel":99,"gui/print/vue/print":103,"gui/queryresults/vue/queryresults":116,"gui/search/vue/panel/searchpanel":119,"gui/search/vue/search":121,"gui/tools/vue/tools":127,"gui/vue/component":128}]},{},[3]);