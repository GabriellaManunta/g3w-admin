(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
var plugins = {
  iternet:  require('plugins/g3w-iternet/plugin')
};

var tools = {
  tools:  []
};

var mapcontrols = ['zoom','zoombox'];
//var mapcontrols = ['zoom','zoombox','zoomtoextent','query'];

var i18n = {
  resources: require('./locales/app.js')
};

var client =  {
  debug:  false,
  local:  false
};

var server =  {
    urls:  {
      ows:  '/ows',
      api:  '/api',
      config:  '/api/config',
      staticurl:  ''
    }
};

var templates =  {
  app:  require('../templates/app.html'),
  sidebar:  require('../templates/sidebar.html'),
  floatbar:  require('../templates/floatbar.html'),
};

module.exports = {
  client: client,
  server: server,
  templates: templates,
  plugins:  plugins,
  tools:  tools,
  map: {
    controls: mapcontrols
  },
  i18n: i18n
};

},{"../templates/app.html":4,"../templates/floatbar.html":5,"../templates/sidebar.html":6,"./locales/app.js":2,"plugins/g3w-iternet/plugin":87}],2:[function(require,module,exports){
var translations = {
    "it": {
        "translation": {
            "search": "Ricerca",
            "catalog": "Catalogo dati",
            "baselayers": "Basi",
            "tools": "Strumenti",
            "tree": "Dati",
            "legend": "Legenda",
            "street_search": "Cerca indirizzo"
        }
    }
};

module.exports = translations;

},{}],3:[function(require,module,exports){
var boostrap = require('g3w-base-app/bootstrap');
var Nominatim = require('g3w/core/geocodingservice').Nominatim;
var GeocodingListPanelComponent = require('g3w/gui/geocoding/listpanel');
var ListPanel = require('g3w/gui/listpanel').ListPanel;
var GUI = require('g3w/gui/gui');

var config = require('./config/config.js');

$(function (){  
  config.getWmsUrl = function(project){
    return config.server.urls.ows+'/'+config.group.id+'/'+project.type+'/'+project.id;
  };
  config.getProjectConfigUrl = function(project){
    return config.server.urls.config+'/'+config.group.id+'/'+project.type+'/'+project.id;
  }
  
  boostrap(config);
  
  Nominatim.on("results",function(result,query){
    var listPanel = new ListPanel({
      name: "Risultati ricerca '"+query+"'",
      id: 'nominatim_results',
      list: result,
      listPanelComponent: GeocodingListPanelComponent
    });
    GUI.showListing(listPanel);
  })
});

},{"./config/config.js":1,"g3w-base-app/bootstrap":7,"g3w/core/geocodingservice":29,"g3w/gui/geocoding/listpanel":54,"g3w/gui/gui":55,"g3w/gui/listpanel":57}],4:[function(require,module,exports){
module.exports = "<div class=\"wrapper\">\n  <header class=\"main-header\">\n    <!-- Logo -->\n    <!-- \n    -->\n    <!-- Header Navbar: style can be found in header.less -->\n    <nav class=\"navbar navbar-static-top\" role=\"navigation\">\n      <!-- Toggle button on navbar only for mobile -->\n      <a v-if=\"isMobile()\" href=\"#\" class=\"sidebar-toggle\" data-toggle=\"offcanvas\" role=\"button\">\n        <span class=\"sr-only\">Expand</span>\n      </a>\n      <geocoder type=\"Nominatim\"></geocoder>\n      <div class=\"navbar-custom-menu\">\n        <ul class=\"nav navbar-nav\">\n        </ul>\n      </div>\n    </nav>\n  </header>\n  <!-- Left side column. contains the logo and sidebar -->\n  <sidebar></sidebar>\n\n  <!-- Content Wrapper. Contains page content -->\n  <div class=\"content-wrapper\" style=\"background-color:white\">\n    <viewport></viewport>\n  </div>\n  <!-- /.content-wrapper -->\n  \n  <!-- \n  <footer class=\"main-footer\">\n    <div class=\"pull-right hidden-xs\">\n      <b>Version</b> 2.3.2\n    </div>\n    <strong>Copyright &copy; 2014-2015 <a href=\"http://almsaeedstudio.com\">Almsaeed Studio</a>.</strong> All rights\n    reserved.\n  </footer>\n  -->\n\n  <!-- Control Sidebar -->\n  <floatbar></floatbar>\n  <!-- /.control-sidebar -->\n  <!-- Add the sidebar's background. This div must be placed\n       immediately after the control sidebar -->\n  <div class=\"control-sidebar-bg\"></div>\n</div>\n";

},{}],5:[function(require,module,exports){
module.exports = "<aside class=\"control-sidebar control-sidebar-light\" >\n  <a v-show=\"panelsinstack\" href=\"#\" class=\"floatbar-aside-toggle\" data-toggle=\"control-sidebar\" role=\"button\">\n    <span class=\"sr-only\">Expand</span>\n  </a>\n  <div v-show=\"panelsinstack\" class=\"g3w-sidebarpanel\">\n    <div class=\"row\" v-if=\"closable\">\n      <div class=\"col-xs-12 col-sm-12 col-md-12\">\n        <button class=\"glyphicon glyphicon-remove pull-right close-panel-button\" @click=\"closePanel\"></button>\n      </div>\n    </div>\n    <div>\n      <h4 class=\"g3w-floatbarpanel-name\">{{ panelname }}</h2>\n    </div>\n    <div id=\"g3w-floatbarpanel-placeholder\" class=\"g3w-floatbarpanel-placeholder\"></div>\n  </div>\n</aside>\n";

},{}],6:[function(require,module,exports){
module.exports = "<aside class=\"main-sidebar\">\n  <!-- sidebar: style can be found in sidebar.less -->\n  <!-- Sidebar toggle button-->\n  <!-- Toggle button on the left side of main sidebar only if not mobile -->\n  <a v-if=\"!isMobile()\" href=\"#\" class=\"sidebar-aside-toggle\" data-toggle=\"offcanvas\" role=\"button\">\n    <span class=\"sr-only\">Expand</span>\n  </a>\n\t<section class=\"sidebar\">\n    <div v-show=\"panelsinstack\" class=\"g3w-sidebarpanel\">\n      <div class=\"row\">\n        <div class=\"col-xs-12 col-sm-12 col-md-12\">\n          <button class=\"glyphicon glyphicon-remove pull-right close-panel-button\" @click=\"closePanel\"></button></div>\n      </div>\n      <div>\n        <h4>{{ panelname }}</h2>\n      </div>\n      <div id=\"g3w-sidebarpanel-placeholder\" class=\"g3w-sidebarpanel-placeholder\"></div>\n    </div>\n    \n\t  <ul v-show=\"!panelsinstack\" class=\"sidebar-menu\">\n\t    <!--<sidebar-item data-icon=\"fa fa-search\" data-label=\"search\" data-type=\"inline\">\n        <g3w-search></g3w-search>\n      </sidebar-item>-->\n      <sidebar-item open-on-start=\"true\" data-icon=\"fa fa-database\" data-label=\"catalog\" data-type=\"inline\">\n        <g3w-catalog></g3w-catalog>\n      </sidebar-item>\n      <sidebar-item data-icon=\"fa fa-gears\" data-label=\"tools\" data-type=\"inline\">\n        <g3w-tools></g3w-tools>\n      </sidebar-item>\n\t  </ul>\n\t</section>\n\t<!-- /.sidebar -->\n</aside>\n";

},{}],7:[function(require,module,exports){
var i18ninit = require('i18n/i18n.service').init;
var t = require('i18n/i18n.service').t;
require('g3w/gui/vue.directives');
var isMobileMixin = require('g3w/gui/vue.mixins').isMobileMixin;
var layout = require('./js/layout/layout');
var app = null;
var appService = require('./js/app.service');

var bootstrap = function (baseconfig){
  i18ninit(baseconfig.i18n);
  
  //creo un filtro vue che traduce il testo passato
  Vue.filter('t', function (value) {
    return t(value);
  });
  
  if (baseconfig.client.debug){
    Vue.config.debug = true;
  }
  
  Vue.mixin(isMobileMixin);
  
  var SidebarComponent = require('g3w-base-app/js/layout/sidebar').SidebarComponent;
  var FloatbarComponent = require('g3w-base-app/js/layout/floatbar').FloatbarComponent;
  var AppUI = require('g3w-base-app/js/app.ui');
  
  var SideBar = SidebarComponent.extend({
    mixins: [isMobileMixin],
    template: baseconfig.templates.sidebar,
  });
  Vue.component('sidebar',SideBar);
  
  var FloatBar = FloatbarComponent.extend({
    template: baseconfig.templates.floatbar,
  });
  Vue.component('floatbar',FloatBar);
  
  var UI = AppUI.extend({
    template: baseconfig.templates.app,
  });
  Vue.component('app',UI);
  
  function createConfig(config){
    return {
      debug: baseconfig.client.debug || false,
      group: null,
      urls: baseconfig.server.urls,
      resourcesurl: baseconfig.server.urls.staticurl,
      projects: baseconfig.group.projects,
      initproject: baseconfig.group.initproject,
      baselayers: baseconfig.group.baselayers,
      crs: baseconfig.group.crs,
      minscale: baseconfig.group.minscale,
      maxscale: baseconfig.group.maxscale,
      // richiesto da ProjectService
      getWmsUrl: baseconfig.getWmsUrl,
      // richiesto da ProjectsRegistry
      getProjectConfigUrl: baseconfig.getProjectConfigUrl,
      plugins: {
        plugins: baseconfig.plugins,
        configs: baseconfig.group.plugins
      },
      tools: baseconfig.tools,
      views: baseconfig.views || {},
      map: baseconfig.map
    }
  };
  
  //inizializza la vue appicazione
  function run(){
    app = new Vue({
      el: 'body',
      ready: function(){
        $(document).localize();
      }
    });
  };
  
  layout.loading();
  
  // i servizi sono stati inizializzati, posso avviare l'istanza Vue
  appService.on('ready',function(){
    run();
  });
  
  // se sto caricando dal client g3w-admin initconfig è già inlined
  if (window.initConfig) {
    baseconfig.server.urls.staticurl = initConfig.staticurl;
    baseconfig.group = window.initConfig.group; // config is inlined by g3w-admin inside the index template as a <script> tag
    var config = createConfig(config);
    appService.init(config);// emette evento ready dopo aver letto la configurazione
  }
  // altrimenti devo aspettare che local.initconfig.js abbia caricato l'initconfig
  else{
    $(document).on('initconfigReady',function(e,initconfig){
      baseconfig.server.urls.staticurl = initconfig.staticurl;
      baseconfig.group = initconfig.group;
      var config = createConfig(config);
      appService.init(config);
    })
  }
};

module.exports = bootstrap;

},{"./js/app.service":8,"./js/layout/layout":12,"g3w-base-app/js/app.ui":9,"g3w-base-app/js/layout/floatbar":11,"g3w-base-app/js/layout/sidebar":13,"g3w/gui/vue.directives":66,"g3w/gui/vue.mixins":67,"i18n/i18n.service":68}],8:[function(require,module,exports){
var inherit = require('g3w/core/utils').inherit;
var base = require('g3w/core/utils').base;
var G3WObject = require('g3w/core/g3wobject');
var ApiService = require('g3w/core/apiservice');
var ProjectsRegistry = require('g3w/core/projectsregistry');
var PluginsRegistry = require('g3w/core/pluginsregistry');
var MapService = require('g3w/core/mapservice');
var ToolsService = require('g3w/core/toolsservice');

var MapView = require('g3w/gui/map/map');

var AppService = function(){
  var self = this;
  this.initialized = false;
  this._modalOverlay = null;
  this.config = {};
  
  // chiama il costruttore di G3WObject (che in questo momento non fa niente)
  base(this);
};
inherit(AppService,G3WObject);

var proto = AppService.prototype;

proto.init = function(config){
  this.config = config;
  this._bootstrap();
};

proto._bootstrap = function(){
  var self = this;
  if (!this.initialized){
    
    //inizializza la configurazione dei servizi. Ognungo cercherà dal config quello di cui avrà bisogno
    //una volta finita la configurazione emetto l'evento ready. A questo punto potrò avviare l'istanza Vue globale
    $.when(
      ApiService.init(this.config),
      ProjectsRegistry.init(this.config),
      PluginsRegistry.init(this.config.plugins),
      MapService.init(this.config.map),
      ToolsService.init(this.config.tools)
    ).then(function(){
      self.emit('ready');
      this.initialized = true;
    });
  };
};

proto.showModalOverlay = function(bool){
  if (!this._modalOverlay){
    this._modalOverlay = $('<div id="g3w-modal-overlay" style="background-color: #000000; opacity: 0.7;z-index:4000;position:fixed;top:0px;left:0px"></div>');
    $("body").append(this._modalOverlay);
    this._modalOverlay.width($(window).innerWidth());
    this._modalOverlay.height($(window).innerHeight());
  }
  if (_.isUndefined(bool) || bool === true){
    this._modalOverlay.show();
  }
  else {
    this._modalOverlay.hide();
  }
};

proto.getDefaultView = function(){
  var view;
  if (this.config.views && this.config.views.default) {
    view = this.config.views.default;
  }
  else {
    view = require('g3w/gui/map/map');
  }
  return view.getViewComponent();
};

module.exports = new AppService;

},{"g3w/core/apiservice":27,"g3w/core/g3wobject":28,"g3w/core/mapservice":33,"g3w/core/pluginsregistry":35,"g3w/core/projectsregistry":37,"g3w/core/toolsservice":39,"g3w/core/utils":40,"g3w/gui/map/map":59}],9:[function(require,module,exports){
var t = require('i18n/i18n.service').t;
var MapService = require('g3w/core/mapservice');
var GUI = require('g3w/gui/gui.js');
var ViewportService = require('g3w/gui/view/viewport');
require('g3w/gui/geocoding/geocoding');
require('g3w/gui/vue.directives');

var layout = require('./layout/layout');
var SidebarService = require('./layout/sidebar').SidebarService;
var FloatbarService = require('./layout/floatbar').FloatbarService;

var AppService = require('./app.service.js')

var BaseUI = Vue.extend({
    ready: function(){
      /* start to render LayoutManager layout */
      layout.loading(false);
      layout.setup();
      $("body").toggleClass("fixed");
      
      layout.layout.fixSidebar();
      //Fix the problem with right sidebar and layout boxed
      layout.pushMenu.expandOnHover();
      layout.layout.activate();
      layout.controlSidebar._fix($(".control-sidebar-bg"));
      layout.controlSidebar._fix($(".control-sidebar"));
      
      FloatbarService.init(layout);

      
      var controlsidebarEl = layout.options.controlSidebarOptions.selector;
      
      function setFloatBarMaxHeight(){
        $(controlsidebarEl).css('max-height',$(window).innerHeight());
        $('.g3w-sidebarpanel').height($(window).innerHeight()-$('.main-header').innerHeight());
      }
      setFloatBarMaxHeight();
      
      function setModalHeight(){
        $('#g3w-modal-overlay').height($(window).innerHeight());
      }
      
      $(window).resize(function() {
        setFloatBarMaxHeight();
        setModalHeight();
      });
      
      /*$(controlsidebarEl).slimScroll({
          height: mainHeight()
      });*/
      
      ViewportService.setView(AppService.getDefaultView());
      
          // definisco (implemento) i metodi dell'API globale della GUI
      GUI.getResourcesUrl = function(){ return AppService.config.resourcesurl };
      // mostra un pannello nella floatbar
      GUI.showForm = _.bind(FloatbarService.showPanel,FloatbarService);
      GUI.closeForm = _.bind(FloatbarService.closePanel,FloatbarService);
      GUI.showListing = _.bind(FloatbarService.showPanel,FloatbarService);
      GUI.closeListing = _.bind(FloatbarService.closePanel,FloatbarService);
      GUI.hideListing = _.bind(FloatbarService.hidePanel,FloatbarService);
      // mostra un pannello nella sidebar
      GUI.showPanel = _.bind(SidebarService.showPanel,SidebarService);

      GUI.setModal = _.bind(AppService.showModalOverlay,AppService);
      
      GUI.showSpinner = function(options){
        var container = options.container || 'body';
        var id = options.id || 'loadspinner';
        var where = options.where || 'prepend'; // append | prepend
        var style = options.style || '';
        var transparent = options.transparent ? 'background-color: transparent' : '';
        $(container)[where].call($(container),'<div id="'+id+'" class="spinner-wrapper '+style+'" style="'+transparent+'"><div class="spinner '+style+'"></div></div>');
      };
      
      GUI.hideSpinner = function(id){
        $("#"+id).remove();
      }
      
      GUI.ready();
      
      $(MapService.getViewport()).prepend('<div id="map-spinner" style="position:absolute;right:0px;"></div>')
      
      MapService.on('loadstart',function(){
        GUI.showSpinner({
          container: $('#map-spinner'),
          id: 'maploadspinner',
          style: 'blue'
        });
      });
      
      MapService.on('loadend',function(){
        GUI.hideSpinner('maploadspinner');
      });
    }
});

module.exports = BaseUI;

},{"./app.service.js":8,"./layout/floatbar":11,"./layout/layout":12,"./layout/sidebar":13,"g3w/core/mapservice":33,"g3w/gui/geocoding/geocoding":52,"g3w/gui/gui.js":55,"g3w/gui/view/viewport":65,"g3w/gui/vue.directives":66,"i18n/i18n.service":68}],10:[function(require,module,exports){
var inherit = require('g3w/core/utils').inherit;
var G3WObject = require('g3w/core/g3wobject');

function BarStack(){
  this._panels = [];
  this.state = {
    panels: []
  };
}
inherit(BarStack,G3WObject);

var proto = BarStack.prototype;

proto.push = function(panel,container){
  var self = this;
  return panel.onShow(container)
  .then(function(){
    self._panels.push(panel);
    self.state.panels.push({
      id: panel.id,
      name: panel.name
    });
  });
};

proto.pop = function(){
  // qui potremo chiedere al pannello se può essere chiuso...
  var self = this;
  var panel = this._panels.slice(-1)[0];
  return panel.onClose()
  .then(function(){
    self.state.panels.pop();
    self._panels.pop();
  });
};

module.exports = BarStack;

},{"g3w/core/g3wobject":28,"g3w/core/utils":40}],11:[function(require,module,exports){
var t = require('i18n/i18n.service').t;
var Stack = require('./barstack.js');
var GUI = require('g3w/gui/gui');

function FloatbarService(){
  this.stack = new Stack();
  
  this.init = function(layout){
    this.layout = layout;
    this.closable = true;
    this.sidebarEl = $(this.layout.options.controlSidebarOptions.selector);
    this._zindex = this.sidebarEl.css("z-index");
    this._modalOverlay = null;
    this._modal = false;
  };
  
  this.showPanel = function(panel,options){
    var options = options || {};
    var modal = options.modal || false;
    this.closable = options.closable || true;
    this.stack.push(panel,"#g3w-floatbarpanel-placeholder")
    .then(function(){
      /*$('input').iCheck({
        checkboxClass: 'icheckbox_square-blue'
      });*/
    })
    this.layout.floatBar.open(this.sidebarEl,true);
    if (modal){
      this._modal = true;
      GUI.setModal();
      this.sidebarEl.css("z-index",5000);
      this.sidebarEl.css("padding-top","0px");
      $('.control-sidebar-bg').css("z-index",4999);
      $('.control-sidebar-bg').toggleClass('control-sidebar-bg-shadow');
    }
    
  };
  
  this.closePanel = function(){
    var panel = this.stack.pop();
    if (panel){
      if (_.hasIn(panel,"$destroy")){
        panel.$destroy();
      }
    };
    if (!this.stack.length) {
      if (this._modal){
        GUI.setModal(false);
        this.layout.floatBar.close(this.sidebarEl,true);
        $('.control-sidebar-bg').toggleClass('control-sidebar-bg-shadow');
        this.sidebarEl.css("z-index","");
        this.sidebarEl.css("padding-top","50px");
        $('.control-sidebar-bg').css("z-index","");
        this._modal = false;
      }
      else {
        this.layout.floatBar.close(this.sidebarEl,true);
      }
    }
  };
  
  this.hidePanel = function(){
    this.layout.floatBar.close(this.sidebarEl,true);
  };
}

var floatbarService = new FloatbarService();

var FloatbarComponent = Vue.extend({
    data: function() {
    	return {
        stack: floatbarService.stack.state,
      };
    },
    computed: {
      // quanti pannelli sono attivi nello stack
      panelsinstack: function(){
        return this.stack.panels.length>0;
      },
      panelname: function(){
        var name = "";
        if (this.stack.panels.length){
          name = this.stack.panels.slice(-1)[0].name;
        }
        return name;
      },
      closable: function() {
        return floatbarService.closable;
      }
    },
    watch: {
      // TODO: Brutto, ma è l'unico (per ora) modo flessibile che ho trovato per implementare il concetto di stack... 
      "stack.panels": function(){
        var children = $("#g3w-floatbarpanel-placeholder").children();
        _.forEach(children,function(child,index){
          if (index == children.length-1){
            $(child).show();
          }
          else {
            $(child).hide();
          }
        })
      }
    },
    methods: {
      closePanel: function(){
        floatbarService.closePanel();
      }
    }
});

module.exports = {
  FloatbarService: floatbarService,
  FloatbarComponent: FloatbarComponent
}

},{"./barstack.js":10,"g3w/gui/gui":55,"i18n/i18n.service":68}],12:[function(require,module,exports){
//Make sure jQuery has been loaded before app.js
if (typeof jQuery === "undefined") {
  throw new Error("LayoutManager requires jQuery");
}

$.LayoutManager = {};

/* --------------------
 * - LayoutManager Options -
 * --------------------
 * Modify these options to suit your implementation
 */
$.LayoutManager.options = {
  //Add slimscroll to navbar menus
  //This requires you to load the slimscroll plugin
  //in every page before app.js
  navbarMenuSlimscroll: true,
  navbarMenuSlimscrollWidth: "0px", //The width of the scroll bar
  navbarMenuHeight: "200px", //The height of the inner menu
  //General animation speed for JS animated elements such as box collapse/expand and
  //sidebar treeview slide up/down. This options accepts an integer as milliseconds,
  //'fast', 'normal', or 'slow'
  animationSpeed:'fast',
  //Sidebar push menu toggle button selector
  sidebarToggleSelector: "[data-toggle='offcanvas']",
  //Activate sidebar push menu
  sidebarPushMenu: true,
  //Activate sidebar slimscroll if the fixed layout is set (requires SlimScroll Plugin)
  sidebarSlimScroll: false,
  //Enable sidebar expand on hover effect for sidebar mini
  //This option is forced to true if both the fixed layout and sidebar mini
  //are used together
  sidebarExpandOnHover: false,
  //BoxRefresh Plugin
  enableBoxRefresh: true,
  //Bootstrap.js tooltip
  enableBSToppltip: true,
  BSTooltipSelector: "[data-toggle='tooltip']",
  //Enable Fast Click. Fastclick.js creates a more
  //native touch experience with touch devices. If you
  //choose to enable the plugin, make sure you load the script
  //before LayoutManager's app.js
  enableFastclick: true,
  //Control Sidebar Options
  enableControlSidebar: true,
  controlSidebarOptions: {
    //Which button should trigger the open/close event
    toggleBtnSelector: "[data-toggle='control-sidebar']",
    //The sidebar selector
    selector: ".control-sidebar",
    //Enable slide over content
    slide: true
  },
  //Box Widget Plugin. Enable this plugin
  //to allow boxes to be collapsed and/or removed
  enableBoxWidget: true,
  //Box Widget plugin options
  boxWidgetOptions: {
    boxWidgetIcons: {
      //Collapse icon
      collapse: 'fa-minus',
      //Open icon
      open: 'fa-plus',
      //Remove icon
      remove: 'fa-times'
    },
    boxWidgetSelectors: {
      //Remove button selector
      remove: '[data-widget="remove"]',
      //Collapse button selector
      collapse: '[data-widget="collapse"]'
    }
  },
  //Direct Chat plugin options
  directChat: {
    //Enable direct chat by default
    enable: true,
    //The button to open and close the chat contacts pane
    contactToggleSelector: '[data-widget="chat-pane-toggle"]'
  },
  //Define the set of colors to use globally around the website
  colors: {
    lightBlue: "#3c8dbc",
    red: "#f56954",
    green: "#00a65a",
    aqua: "#00c0ef",
    yellow: "#f39c12",
    blue: "#0073b7",
    navy: "#001F3F",
    teal: "#39CCCC",
    olive: "#3D9970",
    lime: "#01FF70",
    orange: "#FF851B",
    fuchsia: "#F012BE",
    purple: "#8E24AA",
    maroon: "#D81B60",
    black: "#222222",
    gray: "#d2d6de"
  },
  //The standard screen sizes that bootstrap uses.
  //If you change these in the variables.less file, change
  //them here too.
  screenSizes: {
    xs: 480,
    sm: 768,
    md: 992,
    lg: 1200
  }
};


/* ----------------------------------
 * - Initialize the LayoutManager Object -
 * ----------------------------------
 * All LayoutManager functions are implemented below.
 */
$.LayoutManager._init = function() {
  'use strict';
  /* Layout
   * ======
   * Fixes the layout height in case min-height fails.
   *
   * @type Object
   * @usage $.LayoutManager.layout.activate()
   *        $.LayoutManager.layout.fix()
   *        $.LayoutManager.layout.fixSidebar()
   */
  $.LayoutManager.layout = {
    activate: function () {
      var _this = this;
      _this.fix();
      _this.fixSidebar();
      $(window, ".wrapper").resize(function () {
        _this.fix();
        _this.fixSidebar();
      });
    },
    fix: function () {
      //Get window height and the wrapper height
      var neg = $('.main-header').outerHeight() + $('.main-footer').outerHeight();
      var window_height = $(window).height();
      var sidebar_height = $(".sidebar").height();
      //Set the min-height of the content and sidebar based on the
      //the height of the document.
      if ($("body").hasClass("fixed")) {
        $(".content-wrapper, .right-side").css('min-height', window_height - $('.main-footer').outerHeight());
        $(".content-wrapper, .right-side").css('height', window_height - $('.main-footer').outerHeight());
      } else {
        var postSetWidth;
        if (window_height >= sidebar_height) {
          $(".content-wrapper, .right-side").css('min-height', window_height - neg);
          postSetWidth = window_height - neg;
        } else {
          $(".content-wrapper, .right-side").css('min-height', sidebar_height);
          postSetWidth = sidebar_height;
        }
        //Fix for the control sidebar height
        var controlSidebar = $($.LayoutManager.options.controlSidebarOptions.selector);
        if (typeof controlSidebar !== "undefined") {
          if (controlSidebar.height() > postSetWidth)
            $(".content-wrapper, .right-side").css('min-height', controlSidebar.height());
        }

      }
    },
    fixSidebar: function () {
      //Make sure the body tag has the .fixed class
      if (!$("body").hasClass("fixed")) {
        if (typeof $.fn.slimScroll != 'undefined') {
          $(".sidebar").slimScroll({destroy: true}).height("auto");
        }
        return;
      } else if (typeof $.fn.slimScroll == 'undefined' && window.console) {
        window.console.error("Error: the fixed layout requires the slimscroll plugin!");
      }
      //Enable slimscroll for fixed layout
      if ($.LayoutManager.options.sidebarSlimScroll) {
        if (typeof $.fn.slimScroll != 'undefined') {
          //Destroy if it exists
          $(".sidebar").slimScroll({destroy: true}).height("auto");
          //Add slimscroll
          $(".sidebar").slimscroll({
            height: ($(window).height() - $(".main-header").height()) + "px",
            color: "rgba(255,255,255,0.7)",
            size: "3px"
          });
        }
      }
      else {
         $(".sidebar").css({'height': ($(window).height() - $(".main-header").height()) + "px"})
      }
    }
  };

  /* PushMenu()
   * ==========
   * Adds the push menu functionality to the sidebar.
   *
   * @type Function
   * @usage: $.LayoutManager.pushMenu("[data-toggle='offcanvas']")
   */
  $.LayoutManager.pushMenu = {
    activate: function (toggleBtn) {
      //Get the screen sizes
      var screenSizes = $.LayoutManager.options.screenSizes;

      //Enable sidebar toggle
      $(toggleBtn).on('click', function (e) {
        e.preventDefault();

        //Enable sidebar push menu
        if ($(window).width() > (screenSizes.sm - 1)) {
          if ($("body").hasClass('sidebar-collapse')) {
            $("body").removeClass('sidebar-collapse').trigger('expanded.pushMenu');
          } else {
            $("body").addClass('sidebar-collapse').trigger('collapsed.pushMenu');
          }
        }
        //Handle sidebar push menu for small screens
        else {
          if ($("body").hasClass('sidebar-open')) {
            $("body").removeClass('sidebar-open').removeClass('sidebar-collapse').trigger('collapsed.pushMenu');
          } else {
            $("body").addClass('sidebar-open').trigger('expanded.pushMenu');
          }
        }
      });

      $(".content-wrapper").click(function () {
        //Enable hide menu when clicking on the content-wrapper on small screens
        if ($(window).width() <= (screenSizes.sm - 1) && $("body").hasClass("sidebar-open")) {
          $("body").removeClass('sidebar-open');
        }
      });

      //Enable expand on hover for sidebar mini
      if ($.LayoutManager.options.sidebarExpandOnHover || ($('body').hasClass('fixed') && $('body').hasClass('sidebar-mini'))) {
        this.expandOnHover();
      }
    },
    expandOnHover: function () {
      var _this = this;
      var screenWidth = $.LayoutManager.options.screenSizes.sm - 1;
      //Expand sidebar on hover
      $('.main-sidebar').hover(function () {
        if ($('body').hasClass('sidebar-mini') && $("body").hasClass('sidebar-collapse') && $(window).width() > screenWidth) {
          _this.expand();
        }
      }, function () {
        if ($('body').hasClass('sidebar-mini') && $('body').hasClass('sidebar-expanded-on-hover') && $(window).width() > screenWidth) {
          _this.collapse();
        }
      });
    },
    expand: function () {
      $("body").removeClass('sidebar-collapse').addClass('sidebar-expanded-on-hover');
    },
    collapse: function () {
      if ($('body').hasClass('sidebar-expanded-on-hover')) {
        $('body').removeClass('sidebar-expanded-on-hover').addClass('sidebar-collapse');
      }
    }
  };

  /* Tree()
   * ======
   * Converts the sidebar into a multilevel
   * tree view menu.
   *
   * @type Function
   * @Usage: $.LayoutManager.tree('.sidebar')
   */
  $.LayoutManager.tree = function (menu) {
    var _this = this;
    var animationSpeed = $.LayoutManager.options.animationSpeed;
    //click event //
    $(document).on('click', menu + ' li a', function (e) {

      //Get the clicked link and the next element
      var $this = $(this);
      //is the content of the "accordion" ul //
      var checkElement = $this.next();

      //Check if the next element is a menu and is visible
      if ((checkElement.is('.treeview-menu')) && (checkElement.is(':visible'))) {
        //Close the menu
        checkElement.slideUp(animationSpeed, function () {
          checkElement.parent("li.treeview").removeClass("active");
          checkElement.removeClass('menu-open');
          //Fix the layout in case the sidebar stretches over the height of the window
          //_this.layout.fix();
        });

      }
      //If the menu is not visible
      else if ((checkElement.is('.treeview-menu')) && (!checkElement.is(':visible'))) {
        //Get the parent menu
        var parent = $this.parents('ul').first();
        var parent_li = $this.parent("li");
        var li_siblings = parent_li.siblings();
        var parent_find_active;
        var sidebar_content_height = parent.height() - parent.find('li.header').outerHeight();
        var treeviewHeight = parent_li.outerHeight();
        li_siblings.not('.header').each(function(index, el) {
                treeviewHeight+=$(el).find('a').outerHeight();
        });
        var section_height = (sidebar_content_height - treeviewHeight);
        checkElement.css({
          'height': section_height + 'px',
          'max-height':section_height + 'px',
          'overflow-y': 'auto'
        });
        //Close all open menus within the parent
        var ul = parent.find('ul.treeview-menu:visible').slideUp(animationSpeed);
        //Remove the menu-open class from the parent
        ul.removeClass('menu-open');
        //Get the parent li
        //Open the target menu and add the menu-open class
        checkElement.slideDown(animationSpeed, function () {
          //Add the class active to the parent li
          checkElement.addClass('menu-open');
          parent_find_active = parent.find('li.treeview.active');
          parent_find_active.removeClass('active');
          parent_li.addClass('active');
          //Fix the layout in case the sidebar stretches over the height of the window
          _this.layout.fix();
        });
      }
      //if this isn't a link, prevent the page from being redirected
      if (checkElement.is('.treeview-menu')) {
        e.preventDefault();
      }
    });
  };

  /* ControlSidebar
   * ==============
   * Adds functionality to the right sidebar
   *
   * @type Object
   * @usage $.LayoutManager.controlSidebar.activate(options)
   */
  $.LayoutManager.floatBar = $.LayoutManager.controlSidebar = {
    //instantiate the object
    activate: function () {
      //Get the object
      var _this = this;
      //Update options
      var o = $.LayoutManager.options.controlSidebarOptions;
      //Get the sidebar
      var sidebar = $(o.selector);
      //The toggle button
      var btn = $(o.toggleBtnSelector);

      //Listen to the click event
      btn.on('click', function (e) {
        e.preventDefault();
        //If the sidebar is not open
        if (!sidebar.hasClass('control-sidebar-open') && !$('body').hasClass('control-sidebar-open')) {
          //Open the sidebar
          _this.open(sidebar, o.slide);
        } else {
          _this.close(sidebar, o.slide);
        }
      });

      //If the body has a boxed layout, fix the sidebar bg position
      var bg = $(".control-sidebar-bg");
      _this._fix(bg);

      //If the body has a fixed layout, make the control sidebar fixed
      if ($('body').hasClass('fixed')) {
        _this._fixForFixed(sidebar);
      } else {
        //If the content height is less than the sidebar's height, force max height
        if ($('.content-wrapper, .right-side').height() < sidebar.height()) {
          _this._fixForContent(sidebar);
        }
      }
    },
    //Open the control sidebar
    open: function (sidebar, slide) {
      //Slide over content
      if (slide) {
        sidebar.addClass('control-sidebar-open');
      } else {
        //Push the content by adding the open class to the body instead
        //of the sidebar itself
        $('body').addClass('control-sidebar-open');
      }
    },
    //Close the control sidebar
    close: function (sidebar, slide) {
      if (slide) {
        sidebar.removeClass('control-sidebar-open');
      } else {
        $('body').removeClass('control-sidebar-open');
      }
    },
    _fix: function (sidebar) {
      var _this = this;
      if ($("body").hasClass('layout-boxed')) {
        sidebar.css('position', 'absolute');
        sidebar.height($(".wrapper").height());
        $(window).resize(function () {
          _this._fix(sidebar);
        });
      } else {
        sidebar.css({
          'position': 'fixed',
          'height': 'auto'
        });
      }
    },
    _fixForFixed: function (sidebar) {
      sidebar.css({
        'position': 'fixed',
        'max-height': '100%',
        'overflow': 'auto',
        'padding-bottom': '50px'
      });
    },
    _fixForContent: function (sidebar) {
      $(".content-wrapper, .right-side").css('min-height', sidebar.height());
    }
  };

  /* BoxWidget
   * =========
   * BoxWidget is a plugin to handle collapsing and
   * removing boxes from the screen.
   *
   * @type Object
   * @usage $.LayoutManager.boxWidget.activate()
   *        Set all your options in the main $.LayoutManager.options object
   */
  $.LayoutManager.boxWidget = {
    selectors: $.LayoutManager.options.boxWidgetOptions.boxWidgetSelectors,
    icons: $.LayoutManager.options.boxWidgetOptions.boxWidgetIcons,
    animationSpeed: $.LayoutManager.options.animationSpeed,
    activate: function (_box) {
      var _this = this;
      if (!_box) {
        _box = document; // activate all boxes per default
      }
      //Listen for collapse event triggers
      $(_box).on('click', _this.selectors.collapse, function (e) {
        e.preventDefault();
        _this.collapse($(this));
      });

      //Listen for remove event triggers
      $(_box).on('click', _this.selectors.remove, function (e) {
        e.preventDefault();
        _this.remove($(this));
      });
    },
    collapse: function (element) {
      var _this = this;
      //Find the box parent
      var box = element.parents(".box").first();
      //Find the body and the footer
      var box_content = box.find("> .box-body, > .box-footer, > form  >.box-body, > form > .box-footer");
      if (!box.hasClass("collapsed-box")) {
        //Convert minus into plus
        element.children(":first")
                .removeClass(_this.icons.collapse)
                .addClass(_this.icons.open);
        //Hide the content
        box_content.slideUp(_this.animationSpeed, function () {
          box.addClass("collapsed-box");
        });
      } else {
        //Convert plus into minus
        element.children(":first")
                .removeClass(_this.icons.open)
                .addClass(_this.icons.collapse);
        //Show the content
        box_content.slideDown(_this.animationSpeed, function () {
          box.removeClass("collapsed-box");
        });
      }
    },
    remove: function (element) {
      //Find the box parent
      var box = element.parents(".box").first();
      box.slideUp(this.animationSpeed);
    }
  };
  
  return $.LayoutManager;
};

/* ------------------
 * - Custom Plugins -
 * ------------------
 * All custom plugins are defined below.
 */

/*
 * BOX REFRESH BUTTON
 * ------------------
 * This is a custom plugin to use with the component BOX. It allows you to add
 * a refresh button to the box. It converts the box's state to a loading state.
 *
 * @type plugin
 * @usage $("#box-widget").boxRefresh( options );
 */
$.LayoutManager.addRefreshButton = function () {
  "use strict";

  $.fn.boxRefresh = function (options) {

    // Render options
    var settings = $.extend({
      //Refresh button selector
      trigger: ".refresh-btn",
      //File source to be loaded (e.g: ajax/src.php)
      source: "",
      //Callbacks
      onLoadStart: function (box) {
        return box;
      }, //Right after the button has been clicked
      onLoadDone: function (box) {
        return box;
      } //When the source has been loaded

    }, options);

    //The overlay
    var overlay = $('<div class="overlay"><div class="fa fa-refresh fa-spin"></div></div>');

    return this.each(function () {
      //if a source is specified
      if (settings.source === "") {
        if (window.console) {
          window.console.log("Please specify a source first - boxRefresh()");
        }
        return;
      }
      //the box
      var box = $(this);
      //the button
      var rBtn = box.find(settings.trigger).first();

      //On trigger click
      rBtn.on('click', function (e) {
        e.preventDefault();
        //Add loading overlay
        start(box);

        //Perform ajax call
        box.find(".box-body").load(settings.source, function () {
          done(box);
        });
      });
    });

    function start(box) {
      //Add overlay and loading img
      box.append(overlay);

      settings.onLoadStart.call(box);
    }

    function done(box) {
      //Remove overlay and loading img
      box.find(overlay).remove();

      settings.onLoadDone.call(box);
    }

  };
  return $.LayoutManager;
};

/*
 * EXPLICIT BOX ACTIVATION
 * -----------------------
 * This is a custom plugin to use with the component BOX. It allows you to activate
 * a box inserted in the DOM after the app.js was loaded.
 *
 * @type plugin
 * @usage $("#box-widget").activateBox();
 */
$.LayoutManager.activateBox = function () {
  'use strict';

  $.fn.activateBox = function () {
    $.LayoutManager.boxWidget.activate(this);
  };
  
  return $.LayoutManager;
};

/*
 * TODO LIST CUSTOM PLUGIN
 * -----------------------
 * This plugin depends on iCheck plugin for checkbox and radio inputs
 *
 * @type plugin
 * @usage $("#todo-widget").todolist( options );
 */

$.LayoutManager.listCustomPlugin = function () {

	  'use strict';

	  $.fn.todolist = function (options) {
	    // Render options
	    var settings = $.extend({
	      //When the user checks the input
	      onCheck: function (ele) {
	        return ele;
	      },
	      //When the user unchecks the input
	      onUncheck: function (ele) {
	        return ele;
	      }
	    }, options);

	    return this.each(function () {

	      if (typeof $.fn.iCheck != 'undefined') {
	        $('input', this).on('ifChecked', function () {
	          var ele = $(this).parents("li").first();
	          ele.toggleClass("done");
	          settings.onCheck.call(ele);
	        });

	        $('input', this).on('ifUnchecked', function () {
	          var ele = $(this).parents("li").first();
	          ele.toggleClass("done");
	          settings.onUncheck.call(ele);
	        });
	      } else {
	        $('input', this).on('change', function () {
	          var ele = $(this).parents("li").first();
	          ele.toggleClass("done");
	          if ($('input', ele).is(":checked")) {
	            settings.onCheck.call(ele);
	          } else {
	            settings.onUncheck.call(ele);
	          }
	        });
	      }
	    });
	  };
	  return $.LayoutManager;
	};
	
	/* ------------------
	 * - Implementation -
	 * ------------------
	 * The next block of code implements LayoutManager's
	 * functions and plugins as specified by the
	 * options above.
	 */
	$.LayoutManager.setup = function ()
	{
	  "use strict";

	  //Fix for IE page transitions
	  $("body").removeClass("hold-transition");

	  //Extend options if external options exist
	  if (typeof LayoutManagerOptions !== "undefined") {
	    $.extend(true,
	            $.LayoutManager.options,
	            LayoutManagerOptions);
	  }

	  //Easy access to options
	  var o = $.LayoutManager.options;

	  //Set up the object
	  $.LayoutManager._init();

	  //Activate the layout maker
	  $.LayoutManager.layout.activate();

	  //Enable sidebar tree view controls
	  $.LayoutManager.tree('.sidebar');

	  //Enable control sidebar
	  if (o.enableControlSidebar) {
	    $.LayoutManager.controlSidebar.activate();
	  }

	  //Add slimscroll to navbar dropdown
	  if (o.navbarMenuSlimscroll && typeof $.fn.slimscroll != 'undefined') {
	    $(".navbar .menu").slimscroll({
	      height: o.navbarMenuHeight,
	      alwaysVisible: false,
	      size: o.navbarMenuSlimscrollWidth
	    }).css("width", "100%");
	  }

	  //Activate sidebar push menu
	  if (o.sidebarPushMenu) {
	    $.LayoutManager.pushMenu.activate(o.sidebarToggleSelector);
	  }

	  //Activate Bootstrap tooltip
	  if (o.enableBSToppltip) {
	    $('body').tooltip({
	      selector: o.BSTooltipSelector
	    });
	  }

	  //Activate box widget
	  if (o.enableBoxWidget) {
	    $.LayoutManager.boxWidget.activate();
	  }

	  //Activate fast click
	  if (o.enableFastclick && typeof FastClick != 'undefined') {
	    FastClick.attach(document.body);
	  }

	  //Activate direct chat widget
	  if (o.directChat.enable) {
	    $(document).on('click', o.directChat.contactToggleSelector, function () {
	      var box = $(this).parents('.direct-chat').first();
	      box.toggleClass('direct-chat-contacts-open');
	    });
	  }

	  /*
	   * INITIALIZE BUTTON TOGGLE
	   * ------------------------
	   */
	  $('.btn-group[data-toggle="btn-toggle"]').each(function () {
	    var group = $(this);
	    $(this).find(".btn").on('click', function (e) {
	      group.find(".btn.active").removeClass("active");
	      $(this).addClass("active");
	      e.preventDefault();
	    });

	  });
	  
	  return $.LayoutManager
	  	.addRefreshButton()
	  	.activateBox()
	  	.listCustomPlugin();
	};

$.LayoutManager.loading = function(start){
  var start = _.isBoolean(start) ? start : true;
  if (start) {
    $('body').append('<div id="loadspinner" class="loading"></div>');
  }
  else {
    $('#loadspinner').remove();
  }
}

module.exports = $.LayoutManager;

},{}],13:[function(require,module,exports){
var t = require('i18n/i18n.service').t;
require('g3w/gui/catalog/catalog');
require('g3w/gui/search/search');
require('g3w/gui/tools/tools');
var Stack = require('./barstack.js');

function SidebarService(){
  this.stack = new Stack();
  
  this.init = function(layout){
    this.layout = layout;
  };
  
  this.showPanel = function(panel){
    this.stack.push(panel,"#g3w-sidebarpanel-placeholder");
  };
  
  this.closePanel = function(){
    var panel = this.stack.pop();
    if (panel){
      if (_.hasIn(panel,"$destroy")){
        panel.$destroy();
      }
    }
  }
}

var sidebarService = new SidebarService();

var SidebarComponent = Vue.extend({
    data: function() {
    	return {
        panels: sidebarService.stack.state.panels,
        bOpen: true,
    		bPageMode: false,
    		header: t('main navigation'),
        };
    },
    computed: {
      // quanti pannelli sono attivi nello stack
      panelsinstack: function(){
        return this.panels.length>0;
      },
      panelname: function(){
        var name = "";
        if (this.panels.length){
          name = this.panels.slice(-1)[0].name;
        }
        return name;
      }
    },
    methods: {
      closePanel: function(){
        sidebarService.closePanel();
      }
    },
    ready: function(){
      // temporaneo, per avviare direttamente iternet
      //var iternet = require('g3w-iternet/plugin');
      //iternet.startEditing();
    }
});

Vue.component('sidebar-item',{
	props: ['data-icon','data-label','data-type','open-on-start'],
  template: require('./templates/sidebar-item.html'),
  data: function() {
    return {
        main: true,
      };
  }
});

module.exports = {
  SidebarService: sidebarService,
  SidebarComponent: SidebarComponent
}

},{"./barstack.js":10,"./templates/sidebar-item.html":14,"g3w/gui/catalog/catalog":45,"g3w/gui/search/search":61,"g3w/gui/tools/tools":63,"i18n/i18n.service":68}],14:[function(require,module,exports){
module.exports = "<li class=\"treeview\" :class=\"{'active': openOnStart}\">\n  <a href=\"#\">\n    <i :class=\"dataIcon\"></i>\n    <span class=\"treeview-label\">{{dataLabel | t}}</span> \n    <i v-if=\"(dataType === 'inline')\" class=\"fa fa-angle-left pull-right\"></i>\n  </a>\n  <ul v-if=\"(dataType === 'inline')\" class=\"treeview-menu\">\n    <slot></slot>\n  </ul>\n</li>\n";

},{}],15:[function(require,module,exports){
var Control = function(options){
  var name = options.name || "?";
  this.name = name.split(' ').join('-').toLowerCase();
  this.id = this.name+'_'+(Math.floor(Math.random() * 1000000));
  
  if (!options.element) {
    var className = "ol-"+this.name.split(' ').join('-').toLowerCase();
    var tipLabel = options.tipLabel || this.name;
    var label = options.label || "?";
    
    options.element = $('<div class="'+className+' ol-unselectable ol-control"><button type="button" title="'+tipLabel+'">'+label+'</button></div>')[0];
  }
  
  var buttonClickHandler = options.buttonClickHandler || Control.prototype._handleClick.bind(this);
  
  $(options.element).on('click',buttonClickHandler);
  
  ol.control.Control.call(this,options);
  
  this._postRender();
}
ol.inherits(Control, ol.control.Control);


var proto = Control.prototype;

proto._handleClick = function(){
  var self = this;
  var map = this.getMap();
  
  var resetControl = null;
  // remove all the other, eventually toggled, interactioncontrols
  var controls = map.getControls();
  controls.forEach(function(control){
    if(control.id && control.toggle && (control.id != self.id)) {
      control.toggle(false);
      if (control.name == 'reset') {
        resetControl = control;
      }
    }
  });
  if (!self._toggled && resetControl) {
    resetControl.toggle(true);
  }
};

proto._postRender = function(){};

module.exports = Control;

},{}],16:[function(require,module,exports){
var Control = require('./control');

var InteractionControl = function(options){
  this._toggled = this._toggled || false;
  this._interaction = options.interaction || null;
  this._autountoggle = options.autountoggle || false;
  
  options.buttonClickHandler = InteractionControl.prototype._handleClick.bind(this);
  
  Control.call(this,options);
};
ol.inherits(InteractionControl, Control);

var proto = InteractionControl.prototype;

proto.toggle = function(toggle){
  var toggle = toggle !== undefined ? toggle : !this._toggled
  this._toggled = toggle;
  var map = this.getMap();
  var controlButton = $(this.element).find('button').first();
  
  if (toggle) {
    if (this._interaction) {
      map.addInteraction(this._interaction);
    }
    controlButton.addClass('g3w-ol-toggled');
  }
  else {
    if (this._interaction) {
      map.removeInteraction(this._interaction);
    }
    controlButton.removeClass('g3w-ol-toggled');
  }
}

proto._handleClick = function(e){
  this.toggle();
  Control.prototype._handleClick.call(this,e);
};

module.exports = InteractionControl;

},{"./control":15}],17:[function(require,module,exports){
var utils = require('../utils');
var InteractionControl = require('./interactioncontrol');

var PickCoordinatesInteraction = require('../interactions/pickcoordinatesinteraction');

var QueryControl = function(options){
  var self = this;
  var _options = {
    name: "querylayer",
    tipLabel: "Query layer",
    label: "\uea0f",
    interaction: new PickCoordinatesInteraction
  };
  
  options = utils.merge(options,_options);
  
  InteractionControl.call(this,options);
  
  this._interaction.on('picked',function(e){
    self.dispatchEvent({
      type: 'picked',
      coordinates: e.coordinate
    });
    if (self._autountoggle) {
      self.toggle();
    }
  });
}
ol.inherits(QueryControl, InteractionControl);

module.exports = QueryControl;

},{"../interactions/pickcoordinatesinteraction":21,"../utils":26,"./interactioncontrol":16}],18:[function(require,module,exports){
var utils = require('../utils');
var InteractionControl = require('./interactioncontrol');

var ResetControl = function(options){
  var self = this;
  this._toggled = true;
  this._startCoordinate = null;
  var _options = {
      name: "reset",
      tipLabel: "Pan",
      label: "\ue901",
    };
  
  options = utils.merge(options,_options);
  
  InteractionControl.call(this,options);
}
ol.inherits(ResetControl, InteractionControl);
module.exports = ResetControl;

var proto = ResetControl.prototype;

proto._postRender = function(){
  this.toggle(true);
};

},{"../utils":26,"./interactioncontrol":16}],19:[function(require,module,exports){
var utils = require('../utils');
var InteractionControl = require('./interactioncontrol');

var ZoomBoxControl = function(options){
  var self = this;
  this._startCoordinate = null;
  var _options = {
      name: "zoombox",
      tipLabel: "Zoom to box",
      label: "\ue900",
      interaction: new ol.interaction.DragBox
    };
  
  options = utils.merge(options,_options);
  
  InteractionControl.call(this,options);
  
  this._interaction.on('boxstart',function(e){
    self._startCoordinate = e.coordinate;
  });
  
  this._interaction.on('boxend',function(e){
    var start_coordinate = self._startCoordinate;
    var end_coordinate = e.coordinate;
    var extent = ol.extent.boundingExtent([start_coordinate,end_coordinate]);
    self.dispatchEvent({
      type: 'zoomend',
      extent: extent
    });
    self._startCoordinate = null;
    if (self._autountoggle) {
      self.toggle();
    }
  })
}
ol.inherits(ZoomBoxControl, InteractionControl);
module.exports = ZoomBoxControl;

},{"../utils":26,"./interactioncontrol":16}],20:[function(require,module,exports){
var utils = require('./utils');
var maphelpers = require('./map/maphelpers');

(function (name, root, factory) {
  if (typeof define === 'function' && define.amd) {
    define(factory);
  }
  else if (typeof exports === 'object') {
    module.exports = factory();
  }
  else {
    root[name] = factory();
  }
})('g3wol3', this, function () {
  'use strict';
  
  var helpers = utils.merge({},maphelpers);
  
  return {
    helpers: helpers
  }
});

},{"./map/maphelpers":25,"./utils":26}],21:[function(require,module,exports){
var PickCoordinatesEventType = {
  PICKED: 'picked'
};

var PickCoordinatesEvent = function(type, coordinate) {
  this.type = type;
  this.coordinate = coordinate;
};

var PickCoordinatesInteraction = function(options) {
  this.previousCursor_ = null;
  
  ol.interaction.Pointer.call(this, {
    handleDownEvent: PickCoordinatesInteraction.handleDownEvent_,
    handleUpEvent: PickCoordinatesInteraction.handleUpEvent_,
    handleMoveEvent: PickCoordinatesInteraction.handleMoveEvent_,
  });
};
ol.inherits(PickCoordinatesInteraction, ol.interaction.Pointer);

PickCoordinatesInteraction.handleDownEvent_ = function(event) {
  return true;
};

PickCoordinatesInteraction.handleUpEvent_ = function(event) {
  this.dispatchEvent(
          new PickCoordinatesEvent(
              PickCoordinatesEventType.PICKED,
              event.coordinate));
  return true;
};

PickCoordinatesInteraction.handleMoveEvent_ = function(event) {
  var elem = event.map.getTargetElement();
  elem.style.cursor =  'pointer';
};

PickCoordinatesInteraction.prototype.shouldStopEvent = function(){
  return false;
};

PickCoordinatesInteraction.prototype.setMap = function(map){
  if (!map) {
    var elem = this.getMap().getTargetElement();
    elem.style.cursor = '';
  }
  ol.interaction.Pointer.prototype.setMap.call(this,map);
};

module.exports = PickCoordinatesInteraction;

},{}],22:[function(require,module,exports){
  var PickFeatureEventType = {
  PICKED: 'picked'
};

var PickFeatureEvent = function(type, coordinate, feature) {
  this.type = type;
  this.feature = feature;
  this.coordinate = coordinate;
};

var PickFeatureInteraction = function(options) {
  ol.interaction.Pointer.call(this, {
    handleDownEvent: PickFeatureInteraction.handleDownEvent_,
    handleUpEvent: PickFeatureInteraction.handleUpEvent_,
    handleMoveEvent: PickFeatureInteraction.handleMoveEvent_,
  });
  
  this.features_ = options.features || null;
  
  this.layers_ = options.layers || null;
  
  this.pickedFeature_ = null;
  
  var self = this;
  this.layerFilter_ = function(layer) {
    return _.includes(self.layers_, layer);
  };
};
ol.inherits(PickFeatureInteraction, ol.interaction.Pointer);

PickFeatureInteraction.handleDownEvent_ = function(event) {
  this.pickedFeature_ = this.featuresAtPixel_(event.pixel, event.map);
  return true;
};

PickFeatureInteraction.handleUpEvent_ = function(event) {
  if(this.pickedFeature_){
    this.dispatchEvent(
            new PickFeatureEvent(
                PickFeatureEventType.PICKED,
                event.coordinate,
                this.pickedFeature_));
  }
  return true;
};

PickFeatureInteraction.handleMoveEvent_ = function(event) {
  var elem = event.map.getTargetElement();
  var intersectingFeature = this.featuresAtPixel_(event.pixel, event.map);

  if (intersectingFeature) {
    elem.style.cursor =  'pointer';
  } else {
    elem.style.cursor = '';
  }
};

PickFeatureInteraction.prototype.featuresAtPixel_ = function(pixel, map) {
  var found = null;

  var intersectingFeature = map.forEachFeatureAtPixel(pixel,
      function(feature) {
        if (this.features_) {
          if (this.features_.indexOf(feature) > -1){
            return feature
          }
          else{
            return null;
          }
        }
        return feature;
      },this,this.layerFilter_);
  
  if(intersectingFeature){
    found = intersectingFeature;
  }
  return found;
};

PickFeatureInteraction.prototype.shouldStopEvent = function(){
  return false;
};

PickFeatureInteraction.prototype.setMap = function(map){
  if (!map) {
    var elem = this.getMap().getTargetElement();
    elem.style.cursor = '';
  }
  ol.interaction.Pointer.prototype.setMap.call(this,map);
};

module.exports = PickFeatureInteraction;

},{}],23:[function(require,module,exports){
var BaseLayers = {};

BaseLayers.OSM = new ol.layer.Tile({
  source: new ol.source.OSM({
    attributions: [
      new ol.Attribution({
        html: 'All maps &copy; ' +
            '<a href="http://www.openstreetmap.org/">OpenStreetMap</a>'
      }),
      ol.source.OSM.ATTRIBUTION
    ],
    url: 'http://{a-c}.tile.openstreetmap.org/{z}/{x}/{y}.png',
    crossOrigin: null
  }),
  id: 'osm',
  title: 'OSM',
  basemap: true
});

BaseLayers.BING = {};

BaseLayers.BING.Road = new ol.layer.Tile({
  name:'Road',
  visible: false,
  preload: Infinity,
  source: new ol.source.BingMaps({
    key: 'Am_mASnUA-jtW3O3MxIYmOOPLOvL39dwMvRnyoHxfKf_EPNYgfWM9imqGETWKGVn',
    imagerySet: 'Road'
      // use maxZoom 19 to see stretched tiles instead of the BingMaps
      // "no photos at this zoom level" tiles
      // maxZoom: 19
  }),
  basemap: true
});

BaseLayers.BING.AerialWithLabels = new ol.layer.Tile({
  name: 'AerialWithLabels',
  visible: true,
  preload: Infinity,
  source: new ol.source.BingMaps({
    key: 'Am_mASnUA-jtW3O3MxIYmOOPLOvL39dwMvRnyoHxfKf_EPNYgfWM9imqGETWKGVn',
    imagerySet: 'AerialWithLabels'
      // use maxZoom 19 to see stretched tiles instead of the BingMaps
      // "no photos at this zoom level" tiles
      // maxZoom: 19
  }),
  basemap: true
});

BaseLayers.BING.Aerial = new ol.layer.Tile({
  name: 'Aerial',
  visible: false,
  preload: Infinity,
  source: new ol.source.BingMaps({
    key: 'Am_mASnUA-jtW3O3MxIYmOOPLOvL39dwMvRnyoHxfKf_EPNYgfWM9imqGETWKGVn',
    imagerySet: 'Aerial'
      // use maxZoom 19 to see stretched tiles instead of the BingMaps
      // "no photos at this zoom level" tiles
      // maxZoom: 19
  }),
  basemap: true
});

module.exports = BaseLayers;

},{}],24:[function(require,module,exports){
var utils = require('../utils');
var RasterLayers = {};

RasterLayers.TiledWMSLayer = function(layerObj,extraParams){
  var options = {
    layerObj: layerObj,
    extraParams: extraParams || {},
    tiled: true
  }
  return RasterLayers._WMSLayer(options);
};

RasterLayers.WMSLayer = function(layerObj,extraParams){
  var options = {
    layerObj: layerObj,
    extraParams: extraParams || {}
  }
  return RasterLayers._WMSLayer(options);
};

RasterLayers._WMSLayer = function(options){
  var layerObj = options.layerObj;
  var extraParams = options.extraParams;
  var tiled = options.tiled || false;
  
  var params = {
    LAYERS: layerObj.layers || '',
    VERSION: '1.3.0',
    TRANSPARENT: true,
    SLD_VERSION: '1.1.0'
  };
  
  params = utils.merge(params,extraParams);
  
  var sourceOptions = {
    url: layerObj.url,
    params: params,
    ratio: 1
  };
  
  var imageOptions = {
    id: layerObj.id,
    name: layerObj.name,
    opacity: layerObj.opacity || 1.0,
    visible:layerObj.visible,
    maxResolution: layerObj.maxResolution
  }
  
  var imageClass;
  var source;
  if (tiled) {
    source = new ol.source.TileWMS(sourceOptions);
    imageClass = ol.layer.Tile;
    //imageOptions.extent = [1134867,3873002,2505964,5596944];
  }
  else {
    source = new ol.source.ImageWMS(sourceOptions)
    imageClass = ol.layer.Image;
  }
  
  imageOptions.source = source;
  
  var layer = new imageClass(imageOptions);
  
  return layer;
};

/*RasterLayers.TiledWMSLayer = function(layerObj){
  var layer = new ol.layer.Tile({
    name: layerObj.name,
    opacity: 1.0,
    source: new ol.source.TileWMS({
      url: layerObj.url,
      params: {
        LAYERS: layerObj.layers || '',
        VERSION: '1.3.0',
        TRANSPARENT: true
      }
    }),
    visible: layerObj.visible
  });
  
  return layer;
};*/

module.exports = RasterLayers;


},{"../utils":26}],25:[function(require,module,exports){
BaseLayers = require('../layers/bases');

var MapHelpers = {
  createViewer: function(opts){
    return new _Viewer(opts);
  }
};

var _Viewer = function(opts){
  var controls = ol.control.defaults({
    attributionOptions: {
      collapsible: false
    },
    zoom: false,
    attribution: false
  });//.extend([new ol.control.Zoom()]);
  
  var interactions = ol.interaction.defaults()
    .extend([
      new ol.interaction.DragRotate()
    ]);
  interactions.removeAt(1) // rimuovo douclickzoom
  
  var view = new ol.View(opts.view);
  var options = {
    controls: controls,
    interactions: interactions,
    ol3Logo: false,
    view: view,
    keyboardEventTarget: document
  };
  if (opts.id){
    options.target = opts.id;
  }
  var map  = new ol.Map(options);
  this.map = map;
};

_Viewer.prototype.destroy = function(){
  if (this.map) {
    this.map.dispose();
    this.map = null
  }
};

_Viewer.prototype.updateMap = function(mapObject){};

_Viewer.prototype.updateView = function(){};

_Viewer.prototype.getMap = function(){
  return this.map;
};

_Viewer.prototype.setTarget = function(id){
  this.map.setTarget(id);
};

_Viewer.prototype.goTo = function(coordinates, zoom){
  var options = options || {};
  var animate = options.animate || true;
  var view = this.map.getView();
  
  if (animate) {
    var pan = ol.animation.pan({
      duration: 500,
      source: view.getCenter()
    });
    var zoom = ol.animation.zoom({
      duration: 500,
      resolution: view.getResolution()
    });
    this.map.beforeRender(pan,zoom);
  }
  
  view.setCenter(coordinates);
  view.setZoom(zoom);
};

_Viewer.prototype.goToRes = function(coordinates, resolution){
  var options = options || {};
  var animate = options.animate || true;
  var view = this.map.getView();
  
  if (animate) {
    var pan = ol.animation.pan({
      duration: 500,
      source: view.getCenter()
    });
    var zoom = ol.animation.zoom({
      duration: 500,
      resolution: view.getResolution()
    });
    this.map.beforeRender(pan,zoom);
  }

  view.setCenter(coordinates);
  view.setResolution(resolution);
};

_Viewer.prototype.fit = function(geometry, options){
  var view = this.map.getView();
  
  var options = options || {};
  var animate = options.animate || true;
  
  if (animate) {
    var pan = ol.animation.pan({
      duration: 500,
      source: view.getCenter()
    });
    var zoom = ol.animation.zoom({
      duration: 500,
      resolution: view.getResolution()
    });
    this.map.beforeRender(pan,zoom);
  }
  
  if (options.animate) {
    delete options.animate; // non lo passo al metodo di OL3 perché è un'opzione interna
  }
  options.constrainResolution = options.constrainResolution || false;
  
  view.fit(geometry,this.map.getSize(),options);
};

_Viewer.prototype.getZoom = function(){
  var view = this.map.getView();
  return view.getZoom();
};

_Viewer.prototype.getResolution = function(){
  var view = this.map.getView();
  return view.getResolution();
};

_Viewer.prototype.getCenter = function(){
  var view = this.map.getView();
  return view.getCenter();
};

_Viewer.prototype.getBBOX = function(){
  return this.map.getView().calculateExtent(this.map.getSize());
};

_Viewer.prototype.getLayerByName = function(layerName) {
  var layers = this.map.getLayers();
  var length = layers.getLength();
  for (var i = 0; i < length; i++) {
    if (layerName === layers.item(i).get('name')) {
      return layers.item(i);
    }
  }
  return null;
};

_Viewer.prototype.removeLayerByName = function(layerName){
  var layer = this.getLayerByName(layerName);
  if (layer){
    this.map.removeLayer(layer);
    delete layer;
  }
};

_Viewer.prototype.getActiveLayers = function(){
  var activelayers = [];
  this.map.getLayers().forEach(function(layer) {
    var props = layer.getProperties();
    if (props.basemap != true && props.visible){
       activelayers.push(layer);
    }
  });
  
  return activelayers;
};

_Viewer.prototype.removeLayers = function(){
  this.map.getLayers().clear();
};

_Viewer.prototype.getLayersNoBase = function(){
  var layers = [];
  this.map.getLayers().forEach(function(layer) {
    var props = layer.getProperties();
    if (props.basemap != true){
      layers.push(layer);
    }
  });
  
  return layers;
};

_Viewer.prototype.addBaseLayer = function(type){
  var layer;
  type ? layer = BaseLayers[type]:  layer = BaseLayers.BING.Aerial;
  this.map.addLayer(layer);
};

_Viewer.prototype.changeBaseLayer = function(layerName){
  var baseLayer = this.getLayerByName(layername);
  var layers = this.map.getLayers();
  layers.insertAt(0, baseLayer);
};

module.exports = MapHelpers;

},{"../layers/bases":23}],26:[function(require,module,exports){
var utils = {
  merge: function(obj1,obj2){
    var obj3 = {};
    for (var attrname in obj1) { obj3[attrname] = obj1[attrname]; }
    for (var attrname in obj2) { obj3[attrname] = obj2[attrname]; }
    return obj3;
  }
}

module.exports = utils;

},{}],27:[function(require,module,exports){
var inherit = require('./utils').inherit;
var base = require('./utils').base;
var G3WObject = require('g3w/core/g3wobject');
var rejectedValue = require('./utils').rejectedValue;

function ApiService(){
  this._config = null;
  this._baseUrl = null;
  this._apiUrls = {};
  
  this.init = function(config) {
    this._config = config;
    this._baseUrl = config.urls.api;
    this._apiEndpoints = config.urls.apiEndpoints;
  };
  
  this.get = function(api,options) {
    var self = this;
    var apiEndPoint = this._apiEndpoints[api];
    if (apiEndPoint) {
      var completeUrl = this._baseUrl + '/' + apiEndPoint;
      if (options.request) {
         completeUrl =+ '/' + request
      }
      var params = options.params || {};
      
      self.emit('apiquerystart');
      self.emit(api+'querystart');
      return $.get(completeUrl,params)
      .done(function(response){
        self.emit('apiqueryend',response);
        self.emit(api+'queryend',response);
        return response;
      })
      .fail(function(e){
        self.emit('apiqueryfail',e);
        self.emit(api+'queryfail',e);
        return e;
      });
    }
    else {
      return rejectedValue();
    }
  };
  
  base(this);
}
inherit(ApiService,G3WObject);

module.exports = new ApiService;

},{"./utils":40,"g3w/core/g3wobject":28}],28:[function(require,module,exports){
var inherit = require('g3w/core/utils').inherit;
var noop = require('g3w/core/utils').noop;

/**
 * Un oggetto base in grado di gestire eventuali setter e relativa catena di listeners.
 * @constructor
 */
var G3WObject = function(){
  if (this.setters){
    this._setupListenersChain(this.setters);
  }
};
inherit(G3WObject,EventEmitter);

var proto = G3WObject.prototype;

/**
 * Inserisce un listener dopo che è stato eseguito il setter
 * @param {string} setter - Il nome del metodo su cui si cuole registrare una funzione listener
 * @param {function} listener - Una funzione listener (solo sincrona)
 */
proto.onafter = function(setter,listener){
  return this._onsetter('after',setter,listener,false);
};

// un listener può registrarsi in modo da essere eseguito PRIMA dell'esecuzione del metodo setter. Può ritornare true/false per
// votare a favore o meno dell'esecuzione del setter. Se non ritorna nulla o undefined, non viene considerato votante
/**
 * Inserisce un listener prima che venga eseguito il setter. Se ritorna false il setter non viene eseguito
 * @param {string} setter - Il nome del metodo su cui si cuole registrare una funzione listener
 * @param {function} listener - Una funzione listener, a cui viene passato una funzione "next" come ultimo parametro, da usare nel caso di listener asincroni
 */
proto.onbefore = function(setter,listener){
  return this._onsetter('before',setter,listener,false);
};

/**
 * Inserisce un listener prima che venga eseguito il setter. Al listener viene passato una funzione "next" come ultimo parametro, da chiamare con parametro true/false per far proseguire o meno il setter
 * @param {string} setter - Il nome del metodo su cui si cuole registrare una funzione listener
 * @param {function} listener - Una funzione listener, a cui 
 */
proto.onbeforeasync = function(setter,listener){
  return this._onsetter('before',setter,listener,true);
};

proto.un = function(setter,key){
  _.forEach(this.settersListeners,function(settersListeners,when){
    _.forEach(settersListeners[setter],function(setterListener){
      if(setterListener.key == key){
        delete setterListener;
      }
    })
  })
};

proto._onsetter = function(when,setter,listener,async){ /*when=before|after, type=sync|async*/
  var settersListeners = this.settersListeners[when];
  var listenerKey = ""+Math.floor(Math.random()*1000000)+""+Date.now();
  /*if ((when == 'before') && !async){
    listener = this._makeChainable(listener);
  }*/
  settersListeners[setter].push({
    key: listenerKey,
    fnc: listener,
    async: async
  });
  return listenerKey;
  //return this.generateUnListener(setter,listenerKey);
};

// trasformo un listener sincrono in modo da poter essere usato nella catena di listeners (richiamando next col valore di ritorno del listener)
/*proto._makeChainable = function(listener){
  var self = this
  return function(){
    var args = Array.prototype.slice.call(arguments);
    // rimuovo next dai parametri prima di chiamare il listener
    var next = args.pop();
    var canSet = listener.apply(self,arguments);
    var _canSet = true;
    if (_.isBoolean(canSet)){
      _canSet = canSet;
    }
    next(canSet);
  }
};*/

proto._setupListenersChain = function(setters){
  // inizializza tutti i metodi definiti nell'oggetto "setters" della classe figlia.
  var self = this;
  this.settersListeners = {
    after:{},
    before:{}
  };
  // per ogni setter viene definito l'array dei listeners e fiene sostituito il metodo originale con la funzioni che gestisce la coda di listeners
  _.forEach(setters,function(setterOption,setter){
    var setterFnc = noop;
    var setterFallback = noop;
    if (_.isFunction(setterOption)){
      setterFnc = setterOption
    }
    else {
      setterFnc = setterOption.fnc;
      setterFallback = setterOption.fallback || noop;
    }
    self.settersListeners.after[setter] = [];
    self.settersListeners.before[setter] = [];
    // setter sostituito
    self[setter] = function(){
      var args = arguments;
      // eseguo i listener registrati per il before
      var deferred = $.Deferred();
      var returnVal = null;
      var counter = 0;
      var canSet = true;
      
      // richiamata alla fine della catena di listeners
      function done(){
        if(canSet){
          // eseguo la funzione
          returnVal = setterFnc.apply(self,args);
          // e risolvo la promessa (eventualmente utilizzata da chi ha invocato il setter
          deferred.resolve(returnVal);
          
          var afterListeners = self.settersListeners.after[setter];
          _.forEach(afterListeners,function(listener, key){
            listener.fnc.apply(self,args);
          })
        }
        else {
          // se non posso proseguire 
          // chiamo l'eventuale funzione di fallback
          setterFallback.apply(self,args);
          // e rigetto la promessa
          deferred.reject();
        }
      };
      
      function complete(){
        // eseguo la funzione
        returnVal = setterFnc.apply(self,args);
        // e risolvo la promessa (eventualmente utilizzata da chi ha invocato il setter
        deferred.resolve(returnVal);
        
        var afterListeners = self.settersListeners.after[setter];
        _.forEach(afterListeners,function(listener, key){
          listener.fnc.apply(self,args);
        })
      }
      
      function abort(){
          // se non posso proseguire ...
          // chiamo l'eventuale funzione di fallback
          setterFallback.apply(self,args);
          // e rigetto la promessa
          deferred.reject();
      }
      
      var beforeListeners = this.settersListeners['before'][setter];
      // contatore dei listener che verrà decrementato ad ogni chiamata a next()
      counter = 0;
      
      // funzione passata come ultimo parametro ai listeners, che ***SE SONO STATI AGGIUNTI COME ASINCRONI la DEVONO*** richiamare per poter proseguire la catena
      function next(bool){
        var cont = true;
        if (_.isBoolean(bool)){
          cont = bool;
        }
        var _args = Array.prototype.slice.call(args);
        // se la catena è stata bloccata o se siamo arrivati alla fine dei beforelisteners
        if (cont === false || (counter == beforeListeners.length)){
          if(cont === false)
            abort.apply(self,args);
          else{
            completed = complete.apply(self,args);
            if(_.isUndefined(completed) || completed === true){
              self.emitEvent('set:'+setter,args);
            }
          }
        }
        else {
          if (cont){
            var listenerFnc = beforeListeners[counter].fnc;
            if (beforeListeners[counter].async){
              // aggiungo next come ulitmo parametro
              _args.push(next);
              counter += 1;
              listenerFnc.apply(self,_args)
            }
            else {
              var _cont = listenerFnc.apply(self,_args);
              counter += 1;
              next(_cont);
            }
          }
        }
      }
      
      next();
      return deferred.promise();
    }
  })
};

/*
proto.generateUnListener = function(settersListeners,setter,listenerKey){
  var self = this;
  return function(){
    settersListeners[setter][listenerKey] = null;
    delete settersListeners[setter][listenerKey];
  }
};
*/

module.exports = G3WObject;

},{"g3w/core/utils":40}],29:[function(require,module,exports){
var inherit = require('g3w/core/utils').inherit;
var base = require('g3w/core/utils').base;
var G3WObject = require('g3w/core/g3wobject');
var ProjectService = require('g3w/core/projectservice').ProjectService;
var MapService = require('g3w/core/mapservice');

function Nominatim(){
  var self = this;
  this.url = "http://nominatim.openstreetmap.org";
  
  this.search = function(query){
    var deferred = $.Deferred();
    var extent = MapService.extentToWGS84(ProjectService.state.project.extent);
    bboxstring = _.join(extent,',');
    var searchUrl = this.url+"/search?viewboxlbrt="+bboxstring+"&bounded=1&format=json&polygon_geojson=1&q="+query;
    $.get(searchUrl,function(result){
      self.emit("results",result,query);
    });
  };
  
  base(this);
}
inherit(Nominatim,G3WObject);

module.exports = {
  Nominatim: new Nominatim
};

},{"g3w/core/g3wobject":28,"g3w/core/mapservice":33,"g3w/core/projectservice":36,"g3w/core/utils":40}],30:[function(require,module,exports){
var geom = {
  distance: function(c1,c2){
    return Math.sqrt(geom.squaredDistance(c1,c2));
  },
  squaredDistance: function(c1,c2){
    var x1 = c1[0];
    var y1 = c1[1];
    var x2 = c2[0];
    var y2 = c2[1];
    var dx = x2 - x1;
    var dy = y2 - y1;
    return dx * dx + dy * dy;
  },
  closestOnSegment: function(coordinate, segment) {
    var x0 = coordinate[0];
    var y0 = coordinate[1];
    var start = segment[0];
    var end = segment[1];
    var x1 = start[0];
    var y1 = start[1];
    var x2 = end[0];
    var y2 = end[1];
    var dx = x2 - x1;
    var dy = y2 - y1;
    var along = (dx === 0 && dy === 0) ? 0 :
        ((dx * (x0 - x1)) + (dy * (y0 - y1))) / ((dx * dx + dy * dy) || 0);
    var x, y;
    if (along <= 0) {
      x = x1;
      y = y1;
    } else if (along >= 1) {
      x = x2;
      y = y2;
    } else {
      x = x1 + along * dx;
      y = y1 + along * dy;
    }
    return [x, y];
  }
}

module.exports = geom;

},{}],31:[function(require,module,exports){
var inherit = require('./utils').inherit;
var base = require('./utils').base;
var G3WObject = require('g3w/core/g3wobject');

var CAPABILITIES = {
  QUERY: 1,
  EDIT: 2
};

var EDITOPS = {
  INSERT: 1,
  UPDATE: 2,
  DELETE: 4
};

function Layer(config){
  this.config = config || {};
  this.id = config.id;
  base(this);
}
inherit(Layer,G3WObject);

var proto = Layer.prototype;

proto.getQueryUrl = function(){
  //
};

proto.getQueryLayers = function(){
 //
};

Layer.isQueryable = function(layerState){
  var queryEnabled = false;
  var queryableForCababilities = (layerState.capabilities && (layerState.capabilities && CAPABILITIES.QUERY)) ? true : false;
  if (queryableForCababilities) {
    // è interrogabile se visibile e non disabilitato (per scala) oppure se interrogabile comunque (forzato dalla proprietà infowhennotvisible)
    var queryEnabled = (layerState.visible && !layerState.disabled) || (layerState.infowhennotvisible && (layerState.infowhennotvisible === true));
  }
  return queryEnabled;
};

Layer.getQueryLayerName = function(layerState) {
  var queryLayerName;
  if (layerState.infolayer && layerState.infolayer != '') {
    queryLayerName = layerState.infolayer;
  }
  else {
    queryLayerName = layerState.name;
  }
  return queryLayerName;
};

module.exports = Layer;

},{"./utils":40,"g3w/core/g3wobject":28}],32:[function(require,module,exports){
var inherit = require('./utils').inherit;
var base = require('./utils').base;
var G3WObject = require('./g3wobject');
var GUI = require('../gui/gui');
var ProjectService = require('./projectservice').ProjectService;

var Layer = require('./layer');

function MapQueryService() {
  base(this);
  
  this.init = function(map){
    this.map = map;
  }
  
  this.queryPoint = function(coordinates,mapLayers) {
    var self = this;
    var d = $.Deferred();
    var urlsForLayers = {};
    _.forEach(mapLayers,function(mapLayer){
      var url = mapLayer.getQueryUrl();
      var urlHash = url.hashCode().toString();
      if (_.keys(urlsForLayers).indexOf(urlHash) == -1) {
        urlsForLayers[urlHash] = {
          url: url,
          mapLayers: []
        };
      }
      urlsForLayers[urlHash].mapLayers.push(mapLayer);
    })
    
    var queryUrlsForLayers = [];
    _.forEach(urlsForLayers,function(urlForLayers){
      var firstLayer = urlForLayers.mapLayers[0];
      var _getFeatureInfoUrl = self.getGetFeatureInfoUrl(firstLayer,coordinates);
      var queryBase = _getFeatureInfoUrl.split('?')[0];
      var queryString = _getFeatureInfoUrl.split('?')[1];
      var queryParams = {};
      _.forEach(queryString.split('&'),function(queryStringPair){
        var queryPair = queryStringPair.split('=');
        var key = queryPair[0];
        var value = queryPair[1];
        queryParams[key] = value;
      });
      
      var layerNames = [];
      var queryLayers = [];
      _.forEach(urlForLayers.mapLayers,function(mapLayer){
        //var mapLayerLayersNames = mapLayer.getLayer().getSource().getParams()['LAYERS'];
        //layerNames = _.concat(layerNames,mapLayerLayersNames);
        var mapLayerQueryLayers = mapLayer.getQueryLayers();
        
        if (mapLayerQueryLayers.length) {
          queryLayers = _.concat(queryLayers,mapLayerQueryLayers);
        }
      })
      
      if (queryLayers.length) {
        delete queryParams['STYLES'];
      
        queryParams['LAYERS'] = _.map(queryLayers,'queryLayerName');
        queryParams['QUERY_LAYERS'] = _.map(queryLayers,'queryLayerName');
        queryParams['FEATURE_COUNT'] = 1000;
        
        var getFeatureInfoUrl = queryBase;
        var newQueryPairs = [];
        _.forEach(queryParams,function(value,key){
          newQueryPairs.push(key+'='+value);
        });
        getFeatureInfoUrl = queryBase+'?'+newQueryPairs.join('&')
        
        queryUrlsForLayers.push({
          url: getFeatureInfoUrl,
          queryLayers: queryLayers
        });
      }
    })
    
    var featuresForLayerNames = {};
    if (queryUrlsForLayers.length > 0) {
      _.forEach(queryUrlsForLayers,function(queryUrlForLayers){
        var url = queryUrlForLayers.url;
        var queryLayers = queryUrlForLayers.queryLayers;

        $.get(url).
        then(function(response){
          var nfeatures = 0
          _.forEach(queryLayers,function(queryLayer){
            var parser = new ol.format.WMSGetFeatureInfo({
              layers: [queryLayer.queryLayerName]
            });
            var features = parser.readFeatures(response);
            nfeatures += features.length;
            featuresForLayerNames[queryLayer.layerName] = features;
          })
          d.resolve(coordinates,nfeatures,featuresForLayerNames);
        })
        .fail(function(e){
          d.reject(e);
        })
      });
    }
    else {
      d.resolve(coordinates,0,featuresForLayerNames);
    }
    
    return d.promise();
  };
  
  this.queryRect = function(rect,layerId) {
    
  };
  
  this._query = function(rect,layerId) {
    var layers;
    if (layerId) {
      layers = [ProjectService.getLayer(layerId)];
    }
    else {
      layers = ProjectService.getLayers();
    }
  };
  
  this.getGetFeatureInfoUrl = function(mapLayer,coordinate){
    //var parser = new ol.format.WMSGetFeatureInfo();
    var resolution = this.map.getView().getResolution();
    var epsg = this.map.getView().getProjection().getCode();
    var params = {
      QUERY_LAYERS: mapLayer.getLayer().getSource().getParams()['LAYERS'],
      INFO_FORMAT: 'application/vnd.ogc.gml'
    }
    var url = mapLayer.getLayer().getSource().getGetFeatureInfoUrl(coordinate,resolution,epsg,params);
    return url;
  };
}
inherit(MapQueryService,G3WObject);

module.exports = new MapQueryService;

},{"../gui/gui":55,"./g3wobject":28,"./layer":31,"./projectservice":36,"./utils":40}],33:[function(require,module,exports){
var inherit = require('./utils').inherit;
var base = require('./utils').base;
var G3WObject = require('g3w/core/g3wobject');
var GUI = require('g3w/gui/gui');
var ProjectsRegistry = require('./projectsregistry');
var ProjectService = require('./projectservice').ProjectService;
var ProjectTypes = require('./projectservice').ProjectTypes;
var GeometryTypes = require('./projectservice').GeometryTypes;
var ol3helpers = require('g3w-ol3/src/g3w.ol3').helpers;
var ResetControl = require('g3w-ol3/src/controls/resetcontrol');
var QueryControl = require('g3w-ol3/src/controls/querycontrol');
var ZoomBoxControl = require('g3w-ol3/src/controls/zoomboxcontrol');
var PickCoordinatesInteraction = require('g3w-ol3/src/interactions/pickcoordinatesinteraction');
var WMSSingleLayer = require('./wmssinglelayer');
var WMSMultiLayer = require('./wmsmultilayer');
var MapQueryService = require('./mapqueryservice');

var PickToleranceParams = {};
PickToleranceParams[ProjectTypes.QDJANGO] = {};
PickToleranceParams[ProjectTypes.QDJANGO][GeometryTypes.POINT] = "FI_POINT_TOLERANCE";
PickToleranceParams[ProjectTypes.QDJANGO][GeometryTypes.LINESTRING] = "FI_LINE_TOLERANCE";
PickToleranceParams[ProjectTypes.QDJANGO][GeometryTypes.POLYGON] = "FI_POLYGON_TOLERANCE";

var PickToleranceValues = {}
PickToleranceValues[GeometryTypes.POINT] = 5;
PickToleranceValues[GeometryTypes.LINESTRING] = 5;
PickToleranceValues[GeometryTypes.POLYGON] = 5;

function MapService(){
  var self = this;
  this.config;
  this.viewer;
  this.mapLayers = {};
  this.mapBaseLayers = {};
  this.layersAssociation = {};
  this.layersExtraParams = {};
  this.state = {
      bbox: [],
      resolution: null,
      center: null,
      loading: false
  };
  
  this.init = function(config) {
    this.config = config;
  }
  
  this._howManyAreLoading = 0;
  
  this._interactionsStack = [];
  
  this.setters = {
    setMapView: function(bbox,resolution,center){
      this.state.bbox = bbox;
      this.state.resolution = resolution;
      this.state.center = center;
      this.checkLayersDisabled(resolution);
    },
    setIsLoading: function(bool){
      var delta = bool ? 1 : -1;
      var isFirstIncrement = (this._howManyAreLoading == 0) && (delta == 1);
      var isLastDecrement = (this._howManyAreLoading == 1) && (delta == -1);
      this._howManyAreLoading += delta;

      if (isFirstIncrement || isLastDecrement){
        this.state.loading = bool;
        if (bool) {
          this.emit('loadstart');
        }
        else {
          this.emit('loadend');
        }
      }
    },
    setupViewer: function(){
      $script("http://epsg.io/"+ProjectService.state.project.crs+".js");
      if (self.viewer) {
        this.viewer.destroy();
        this.viewer = null;
      }
      self._setupViewer();
      self.setupControls();
      self.setupLayers();
      self.emit('viewerset');
    }
  };
  
  ProjectService.on('projectset',function(){
    self.setupViewer();
  });
  
  ProjectService.on('projectswitch',function(){
    self.setupLayers();
  });
  
  ProjectService.onafter('setLayersVisible',function(layers){
    _.forEach(layers,function(layer){
      var mapLayer = self.getMapLayerForLayer(layer);
      mapLayer.update();
    })
  });
  
  this.checkLayerDisabled = function(layer,resolution) {
    var disabled = layer.disabled || false;
    if (layer.maxresolution){
      disabled = layer.maxresolution < resolution;
    }
    if (layer.minresolution){
      layer.disabled = disabled && (layer.minresolution > resolution);
    }
    layer.disabled = disabled;
  };
  
  this.checkLayersDisabled = function(resolution){
    var self = this;
    _.forEach(this.mapLayers,function(mapLayer){
      _.forEach(mapLayer.getLayerConfigs(),function(layer){
        self.checkLayerDisabled(layer,resolution);
      }); 
    })
  };
  
  ProjectService.onafter('setBaseLayer',function(){
    _.forEach(self.mapBaseLayers,function(mapBaseLayer){
      mapBaseLayer.update();
    })
  })
  
  this._setupViewer = function(){
    var extent = ProjectService.state.project.extent;
    var projection = new ol.proj.Projection({
      code: "EPSG:"+ProjectService.state.project.crs,
      extent: extent
    });
    
    /*var constrain_extent;
    if (this.config.constraintextent) {
      var extent = this.config.constraintextent;
      var dx = extent[2]-extent[0];
      var dy = extent[3]-extent[1];
      var dx4 = dx/4;
      var dy4 = dy/4;
      var bbox_xmin = extent[0] + dx4;
      var bbox_xmax = extent[2] - dx4;
      var bbox_ymin = extent[1] + dy4;
      var bbox_ymax = extent[3] - dy4;
      
      constrain_extent = [bbox_xmin,bbox_ymin,bbox_xmax,bbox_ymax];
    }*/
    
    this.viewer = ol3helpers.createViewer({
      view: {
        projection: projection,
        center: this.config.initcenter || ol.extent.getCenter(ProjectService.state.project.extent),
        zoom: this.config.initzoom || 0,
        extent: this.config.constraintextent || extent,
        minZoom: this.config.minzoom || 0, // default di OL3 3.16.0
        maxZoom: this.config.maxzoom || 28 // default di OL3 3.16.0
      }
    });
    
    //var view = this.viewer.map.getView();
    /*view.on('change:resolution',function(e){
      self.setViewBBOX(self.viewer.getBBOX());
      self.setResolution(self.viewer.getResolution());
    });*/
    
    this.viewer.map.on('moveend',function(e){
      self._setMapView();
    });
    
    MapQueryService.init(this.viewer.map);
    
    this.emit('ready');
  };
  
  this.getViewerElement = function(){
    this.viewer.map.getTargetElement();
  };
  
  this.getViewport = function(){
    return this.viewer.map.getViewport();
  };
  
  this.setupControls = function(){
    var self = this;
    var map = self.viewer.map;
    if (this.config && this.config.controls) {
      _.forEach(this.config.controls,function(controlType){
        var control;
        switch (controlType) {
          case 'reset':
            if (!isMobile.any) {
              control = new ResetControl();
            }
            break;
          case 'zoom':
            control = new ol.control.Zoom({
              zoomInLabel: "\ue98a",
              zoomOutLabel: "\ue98b"
            });
            break;
          case 'zoombox': 
            if (!isMobile.any) {
              control = new ZoomBoxControl();
              control.on('zoomend',function(e){
                self.viewer.fit(e.extent);
              })
            }
            break;
          case 'zoomtoextent':
            control = new ol.control.ZoomToExtent({
              label:  "\ue98c",
              extent: self.config.constraintextent
            });
            break;
          case 'query':
            control = new QueryControl();
            control.on('picked',function(e){
              var coordinates = e.coordinates;
 
              MapQueryService.queryPoint(coordinates,self.mapLayers)
              .then(function(coordinates,nfeatures,featuresForLayerNames){
                var featuresForLayers = [];
                _.forEach(featuresForLayerNames,function(features,layerName){
                  var layer = ProjectService.layers[layerName];
                  featuresForLayers.push({
                    layer: layer,
                    features: features
                  })
                })
                
                self.emit('mapqueryend',featuresForLayers,nfeatures,coordinates,self.state.resolution);
              })
            });
            break;
        }
        
        if (control) {
          self.addControl(control);
        }
      });
    }
  };
  
  this.addControl = function(control){
    this.viewer.map.addControl(control);
  };
  
  this.setLayersExtraParams = function(params,update){
    this.layersExtraParams = _.assign(this.layersExtraParams,params);
    this.emit('extraParamsSet',params,update);
  };
  
  this.setupBaseLayers = function(){
    if (!ProjectsRegistry.state.baseLayers){
      return;
    }
    var self = this;
    this.mapBaseLayers = {};
    
    var initBaseLayer = ProjectService.config.initbaselayer;
    var baseLayersArray = ProjectService.state.baseLayers;
    
    _.forEach(baseLayersArray,function(baseLayer){
      var visible = true;
      if (ProjectService.state.project.initbaselayer) {
        visible = baseLayer.id == (ProjectService.state.project.initbaselayer);
      }
      if (baseLayer.fixed) {
        visible = baseLayer.fixed;
      }
      baseLayer.visible = visible;
    })
    
    baseLayersArray.forEach(function(layer){     
      var config = {
        defaultUrl: ProjectService.getWmsUrl(),
        id: layer.id,
        tiled: true
      };
      
      var mapLayer = new WMSSingleLayer(config);
      self.registerListeners(mapLayer);
      
      mapLayer.addLayer(layer);
      self.mapBaseLayers[layer.id] = mapLayer;
    });
    
    _.forEach(_.values(this.mapBaseLayers).reverse(),function(mapLayer){
      self.viewer.map.addLayer(mapLayer.getLayer());
      mapLayer.update();
    })
  };
  
  this.setupLayers = function(){
    this.viewer.removeLayers();
    
    this.setupBaseLayers();
    
    this.mapLayers = {};
    this.layersAssociation = {};
    var layersArray = this.traverseLayersTree(ProjectService.state.project.layerstree);
    // prendo solo i layer veri e non i folder
    var leafLayersArray = _.filter(layersArray,function(layer){
      return !_.get(layer,'nodes');
    });
    var multiLayers = _.groupBy(leafLayersArray,function(layer){
      return layer.multilayer;
    });
    _.forEach(multiLayers,function(layers,id){
      var n = layers.length;
      var layerId = 'layer_'+id
      var mapLayer = _.get(self.mapLayers,layerId);
      var tiled = layers[0].tiled // BRUTTISSIMO, da sistemare quando riorganizzeremo i metalayer (da far diventare multilayer). Per ora posso configurare tiled solo i layer singoli
      // se ho più layer per un dato metalayer significa... che si tratta effettivamente di un metalyer
      var WMSLayerClass = n>1 ? WMSMultiLayer : WMSSingleLayer;
      var config = {
        defaultUrl: ProjectService.getWmsUrl(),
        id: layerId,
        tiled: tiled
      };
      mapLayer = self.mapLayers[layerId] = new WMSLayerClass(config,self.layersExtraParams);
      self.registerListeners(mapLayer);
      
      layers.forEach(function(layer){
        // INIETTO QUA LA PROPRIETA' "disabled" per gestire i layer grigiati
        var resolution = self.viewer.map.getView().getResolution();
        self.checkLayerDisabled(layer,resolution);
        mapLayer.addLayer(layer);
        self.layersAssociation[layer.id] = layerId;
      });
    })
    
    _.forEach(_.values(this.mapLayers).reverse(),function(mapLayer){
      self.viewer.map.addLayer(mapLayer.getLayer());
      mapLayer.update(self.layersExtraParams);
    })
  };
  
  this.getMapLayerForLayer = function(layer){
    return this.mapLayers['layer_'+layer.multilayer];
  };
  
  this.traverseLayersTree = function(layersTree){
    var self = this;
    var layersArray = [];
    function traverse(obj){
      _.forIn(obj, function (val, key) {
          if (!_.isNil(val.id)) {
              layersArray.unshift(val);
          }
          if (!_.isNil(val.nodes)) {
              traverse(val.nodes);
          }
      });
    }
    traverse(layersTree);
    return layersArray;
  };
  
  this.registerListeners = function(mapLayer){
    mapLayer.on('loadstart',function(){
      self.setIsLoading(true);
    });
    mapLayer.on('loadend',function(){
      self.setIsLoading(false);
    });
    
    this.on('extraParamsSet',function(extraParams,update){
      if (update) {
        mapLayer.update(extraParams);
      }
    })
  };
  
  this.showViewer = function(elId){
    this.viewer.setTarget(elId);
    var map = this.viewer.map;
    GUI.on('guiready',function(){
      self._setMapView();
    });
  };
  
  
  // per creare una pila di ol.interaction in cui l'ultimo che si aggiunge disattiva temporaemente i precedenti (per poi togliersi di mezzo con popInteraction!)
  // Usato ad es. da pickfeaturetool e getfeatureinfo
  this.pushInteraction = function(interaction){
    if (this._interactionsStack.length){
      var prevInteraction = this._interactionsStack.slice(-1)[0];
      if (_.isArray(prevInteraction)){
        _.forEach(prevInteraction,function(interaction){
          interaction.setActive(false);
        })
      }
      else{
        prevInteraction.setActive(false);
      };
    }
    
    this.viewer.map.addInteraction(interaction);
    interaction.setActive(true);
    this._interactionsStack.push(interaction)
  };
  
  this.popInteraction = function(){
    var interaction = this._interactionsStack.pop();
    this.viewer.map.removeInteraction(interaction);
    
    if (this._interactionsStack.length){
      var prevInteraction = this._interactionsStack.slice(-1)[0];
      if (_.isArray(prevInteraction)){
        _.forEach(prevInteraction,function(interaction){
          interaction.setActive(true);
        })
      }
      else{
        prevInteraction.setActive(true);
      };
    }
  };
  
  this.goTo = function(coordinates,zoom){
    var zoom = zoom || 6;
    this.viewer.goTo(coordinates,zoom);
  };
  
  this.goToWGS84 = function(coordinates,zoom){
    var coordinates = ol.proj.transform(coordinates,'EPSG:4326','EPSG:'+ProjectService.state.project.crs);
    this.goTo(coordinates,zoom);
  };
  
  this.extentToWGS84 = function(extent){
    return ol.proj.transformExtent(extent,'EPSG:'+ProjectService.state.project.crs,'EPSG:4326');
  };
  
  this.getFeatureInfo = function(layerId){
    var self = this;
    var deferred = $.Deferred();
    this._pickInteraction = new PickCoordinatesInteraction();
    //this.viewer.map.addInteraction(this._pickInteraction);
    //this._pickInteraction.setActive(true);
    this.pushInteraction(this._pickInteraction);
    this._pickInteraction.on('picked',function(e){
      self._completeGetFeatureInfo(layerId,e.coordinate,deferred);
    })
    return deferred.promise();
  };
  
  this._completeGetFeatureInfo = function(layerId,coordinate,deferred){
    var self = this;
    var projectType = ProjectService.state.project.type;
    
    var mapLayer = this.mapLayers[this.layersAssociation[layerId]];
    var resolution = self.viewer.getResolution();
    var epsg = self.viewer.map.getView().getProjection().getCode();
    var params = {
      QUERY_LAYERS: ProjectService.getLayer(layerId).name,
      INFO_FORMAT: "text/xml"
    }
    
    if (projectType == ProjectTypes.QDJANGO){
      var toleranceParams = PickToleranceParams[projectType];
      if (toleranceParams){
        var geometrytype = ProjectService.getLayer(layerId).geometrytype;
        params[toleranceParams[geometrytype]] = PickToleranceValues[geometrytype];
      }
    }
    
    var getFeatureInfoUrl = mapLayer.getSource().getGetFeatureInfoUrl(coordinate,resolution,epsg,params);
    $.get(getFeatureInfoUrl)
    .then(function(data){
      var x2js = new X2JS();
      var jsonData = x2js.xml2json(data);
      if (jsonData.GetFeatureInfoResponse.Layer.Feature){
        var attributes = jsonData.GetFeatureInfoResponse.Layer.Feature.Attribute;
        var attributesObj = {};
        _.forEach(attributes,function(attribute){
          attributesObj[attribute._name] = attribute._value; // X2JS aggiunge "_" come prefisso degli attributi
        })
        
        deferred.resolve(attributesObj);
      }
      deferred.reject();;
    })
    .fail(function(){
      deferred.reject();
    })
    .always(function(){
      //self.viewer.map.removeInteraction(self._pickInteraction);
      self.popInteraction();
      self._pickInteraction = null;
    })
  };
  
  this.highlightGeometry = function(geometryObj,options){    
    var geometry;
    if (geometryObj instanceof ol.geom.Geometry){
      geometry = geometryObj;
    }
    else {
      format = new ol.format.GeoJSON;
      geometry = format.readGeometry(geometryObj);
    }
    
    if (options.zoom) {
      this.viewer.fit(geometry);
    }
    
    var duration = options.duration || 4000;
    
    if (options.fromWGS84) {
      geometry.transform('EPSG:4326','EPSG:'+ProjectService.state.project.crs);
    }
    
    var feature = new ol.Feature({
      geometry: geometry
    });
    var source = new ol.source.Vector();
    source.addFeatures([feature]);
    var layer = new ol.layer.Vector({
      source: source,
      style: function(feature){
        var styles = [];
        var geometryType = feature.getGeometry().getType();
        if (geometryType == 'LineString') {
          var style = new ol.style.Style({
            stroke: new ol.style.Stroke({
              color: 'rgb(255,255,0)',
              width: 4
            })
          })
          styles.push(style);
        }
        else if (geometryType == 'Point'){
          var style = new ol.style.Style({
            image: new ol.style.Circle({
              radius: 6,
              fill: new ol.style.Fill({
                color: 'rgb(255,255,0)',
              })
            }),
            zIndex: Infinity
          });
          styles.push(style);
        }
        
        return styles;
      }
    })
    layer.setMap(this.viewer.map);
    
    setTimeout(function(){
      layer.setMap(null);
    },duration);
  };
  
  this.refreshMap = function(){
    _.forEach(this.mapLayers,function(wmsLayer){
      wmsLayer.getLayer().getSource().updateParams({"time": Date.now()});
    })
  };
  
  base(this);
  
  this._setMapView = function(){
    var bbox = this.viewer.getBBOX();
    var resolution = this.viewer.getResolution();
    var center = this.viewer.getCenter();
    this.setMapView(bbox,resolution,center);
  };
};

inherit(MapService,G3WObject);

module.exports = new MapService

},{"./mapqueryservice":32,"./projectservice":36,"./projectsregistry":37,"./utils":40,"./wmsmultilayer":42,"./wmssinglelayer":43,"g3w-ol3/src/controls/querycontrol":17,"g3w-ol3/src/controls/resetcontrol":18,"g3w-ol3/src/controls/zoomboxcontrol":19,"g3w-ol3/src/g3w.ol3":20,"g3w-ol3/src/interactions/pickcoordinatesinteraction":21,"g3w/core/g3wobject":28,"g3w/gui/gui":55}],34:[function(require,module,exports){
var inherit = require('./utils').inherit;
var G3WObject = require('g3w/core/g3wobject');

function Plugin(){
  this.id = "plugin";
  this.tools = [];
}
inherit(Plugin,G3WObject);

var proto = Plugin.prototype;

proto.providesTools = function(){
  return this.tools.length > 0;
};

proto.getTools = function(){
  return this.tools;
};

proto.getActions = function(tool){
  return tool.actions;
};

module.exports = Plugin;

},{"./utils":40,"g3w/core/g3wobject":28}],35:[function(require,module,exports){
var base = require('./utils').base;
var inherit = require('./utils').inherit;
var G3WObject = require('g3w/core/g3wobject');

var ToolsService = require('g3w/core/toolsservice');

function PluginsRegistry(){
  var self = this;
  this.config = null;
  // un domani questo sarà dinamico
  this.plugins = {};
  this.state = {
    toolsproviders: []
  };
  
  this.setters = {
    setToolsProvider: function(plugin) {
      self.state.toolsproviders.push(plugin);
    }
  }
  
  base(this);
  
  this.init = function(config){
    var self = this;
    this.config = config;
    _.forEach(config.plugins,function(plugin){
      self._setup(plugin);
    })
  };
  
  // Per permettere la registrazione anche in un secondo momento
  this.register = function(plugin){
    if (!this.plugins[plugin.name]) {
      this._setup(plugin);
    }
  };
  
  this._setup = function(plugin) {
    var self = this;
    var pluginConfig = this.config.configs[plugin.name];
    if (pluginConfig){
      plugin.init(pluginConfig);
      self.plugins[name] = plugin;
    }
  };
  
  this.activate = function(plugin) {
    var tools = plugin.getTools();
    if (tools.length) {
      ToolsService.registerToolsProvider(plugin);
    }
  };
};

inherit(PluginsRegistry,G3WObject);

module.exports = new PluginsRegistry

},{"./utils":40,"g3w/core/g3wobject":28,"g3w/core/toolsservice":39}],36:[function(require,module,exports){
var inherit = require('./utils').inherit;
var base = require('./utils').base;
var G3WObject = require('./g3wobject');
var Layer = require('./layer.js');

var ProjectTypes = {
  QDJANGO: 'qdjango',
  OGR: 'ogr'
};

var GeometryTypes = {
  POINT: "Point",
  LINESTRING: "Line",
  POLYGON: "Polygon"
};

function ProjectService(){
  var self = this;
  this.config = null;
  this.layers = {};
  this.state = {
    project: null,
    baseLayers: []
  };
  
  this.setters = {
    setLayersVisible: function(layers,visible){
      _.forEach(layers,function(layer){
        self.layers[layer.id].visible = visible;
      })
    },
    setBaseLayer: function(id){
      _.forEach(self.state.baseLayers,function(baseLayer){
        baseLayer.visible = (baseLayer.id == id);
      })
    }
  };
  
  this.init = function(config){
    this.config = config;
  };
  
  // genera l'oggetto layers (per riferimento), per semplificare gli aggiornamenti dello stato del layerstree
  this.makeLayersObj = function(layerstree){
    this.layers = {};
    function traverse(obj){
      _.forIn(obj, function (layer, key) {
            //verifica che il valore dell'id non sia nullo
            if (!_.isNil(layer.id)) {
                self.layers[layer.id] = layer;
            }
            if (!_.isNil(layer.nodes)) {
                traverse(layer.nodes);
            }
        });
      };
    traverse(layerstree);
  };
  
  this.getCurrentProject = function(){
    return this.state.project;
  };
  
  this.setProject = function(project,doswitch){
    /* struttura oggetto 'project'
    {
      id,
      type,
      gid,
      name,
      crs,
      extent,
      layerstree,
      widgets
    }
    */
    this.state.project = project;
    this.state.baseLayers = project.baseLayers;
    this.makeLayersObj(project.layerstree);
    var eventType = 'projectset';
    if (doswitch && doswitch === true) {
      eventType = 'projectswitch';
    }
    this.emit(eventType);
  };
  
  this.switchProject = function(project) {
    this.setProject(project,true);
  };
  
  this.getLayer = function(id){
    return this.layers[id];
  };
  
  this.getLayers = function(){
    return this.layers;
  };
  
  this.getLayerById = function(id) {
    var layer = null;
    _.forEach(this.getLayers(),function(_layer){
      if (_layer.id == id){
        layer = _layer;
      }
    });
    return layer;
  };
  
  this.getLayerByName = function(name) {
    var layer = null;
    _.forEach(this.getLayers(),function(_layer){
      if (_layer.name == name){
        layer = _layer;
      }
    });
    return layer;
  };
  
  this.getQueryableLayers = function(){
    var queryableLayers = [];
    _.forEach(this.getLayers(),function(layer){
      if (Layer.isQueryable(layer)){
        queryableLayers.push(layer);
      }
    });
    return queryableLayers;
  };
  
  this.getLayerAttributes = function(id){
    return this.layers[id].attributes;
  };
  
  this.getLayerAttributeLabel = function(id,name){
    var label = '';
    _.forEach(this.layers[id].attributes,function(attribute){
      if (attribute.name == name){
        label = attribute.label;
      }
    })
    return label;
  };
  
  this.toggleLayer = function(layer,visible){
    var visible = visible || !layer.visible;
    self.setLayersVisible([layer],visible);
  };
  
  this.toggleLayers = function(layers,visible){
    self.setLayersVisible(layers,visible);
  };
  
  this.getWmsUrl = function(){
    return this.config.getWmsUrl(this.state.project);
  };
  
  this.getLegendUrl = function(layer){
    var url = this.getWmsUrl(this.state);
    sep = (url.indexOf('?') > -1) ? '&' : '?';
    return this.getWmsUrl(this.state)+sep+'SERVICE=WMS&VERSION=1.3.0&REQUEST=GetLegendGraphic&SLD_VERSION=1.1.0&FORMAT=image/png&LAYERTITLE=False&ITEMFONTSIZE=10&LAYER='+layer.name;
  };
  
  base(this);
};

inherit(ProjectService,G3WObject);

module.exports = {
  ProjectService: new ProjectService,
  ProjectTypes: ProjectTypes,
  GeometryTypes: GeometryTypes
};

},{"./g3wobject":28,"./layer.js":31,"./utils":40}],37:[function(require,module,exports){
var inherit = require('./utils').inherit;
var base = require('g3w/core/utils').base;
var G3WObject = require('g3w/core/g3wobject');
var resolvedValue = require('./utils').resolvedValue;
var rejectedValue = require('./utils').rejectedValue;
var ProjectService = require('./projectservice').ProjectService;

/* service
Funzione costruttore contentente tre proprieta':
    setup: metodo di inizializzazione
    getLayersState: ritorna l'oggetto LayersState
    getLayersTree: ritorna l'array layersTree dall'oggetto LayersState
*/

// Public interface
function ProjectsRegistry(){
  var self = this;
  this.config = null;
  this.initialized = false;
  
  this.setters = {
    setCurrentProject: function(project){
      this.state.currentProject = project;
    }
  };
  
  this.state = {
    baseLayers: {},
    minScale: null,
    maxscale: null,
    projects: [],
    currentProject: null
  }
  
  base(this);
}
inherit(ProjectsRegistry,G3WObject);

var proto = ProjectsRegistry.prototype;

proto.init = function(config){
  if (!this.initialized){
    this.initialized = true;
    this.config = config;
    this.setupState();
    ProjectService.init(config);
    return this.setProject(config.initproject);
  }
};
  
proto.setupState = function(){
  var self = this;
  
  self.state.baseLayers = self.config.baselayers;
  self.state.minScale = self.config.minscale;
  self.state.maxScale = self.config.maxscale;
  self.state.crs = self.config.crs;
  self.config.projects.forEach(function(project){
    project.baseLayers = self.config.baselayers;
    project.minScale = self.config.minscale;
    project.maxScale = self.config.maxscale;
    project.crs = self.config.crs;
    self.state.projects.push(project);
  })
  //this.state.projects = config.group.projects;
};

proto.getCurrentProject = function(){
  return this.state.currentProject;
};
  
proto.setProject = function(projectGid){
  var self = this;
  return this.getProject(projectGid).
  then(function(project){
    ProjectService.setProject(project);
    self.setCurrentProject(project);
  })
};
  
proto.switchProject = function(projectGid) {
  var self = this;
  return this.getProject(projectGid).
  then(function(project){
    ProjectService.switchProject(project);
    self.setCurrentProject(project);
  })
};
  
proto.buildProjectTree = function(project){
  var layers = _.keyBy(project.layers,'id');
  var layersTree = _.cloneDeep(project.layerstree);
  
  function traverse(obj){
    _.forIn(obj, function (layer, key) {
        //verifica che il nodo sia un layer e non un folder
        if (!_.isNil(layer.id)) {
            var fulllayer = _.merge(layer,layers[layer.id]);
            obj[parseInt(key)] = fulllayer;
            var a =1;
        }
        if (!_.isNil(layer.nodes)){
          // aggiungo proprietà title per l'albero
          layer.title = layer.name;
          traverse(layer.nodes);
        }
      });
    };
  traverse(layersTree);
  project.layerstree = layersTree;
};

proto.getProject = function(projectGid){
  var self = this;
  var d = $.Deferred();
  var project = null;
  this.state.projects.forEach(function(_project){
    if (_project.gid == projectGid) {
      project = _project;
    }
  })
  if (!project) {
    return rejectedValue("Project doesn't exist");
  }

  var isFullFilled = !_.isNil(project.layers);
  if (isFullFilled){
    return d.resolve(project);
  }
  else{
    return this.getProjectFullConfig(project)
    .then(function(projectFullConfig){
      project = _.merge(project,projectFullConfig);
      self.buildProjectTree(project);
      return d.resolve(project);
    });
  }
  
  return d.promise();
};
  
  //ritorna una promises
proto.getProjectFullConfig = function(projectBaseConfig){
  var self = this;
  var deferred = $.Deferred();
  var url = this.config.getProjectConfigUrl(projectBaseConfig);
  $.get(url).done(function(projectFullConfig){
      deferred.resolve(projectFullConfig);
  })
  return deferred.promise();
};

module.exports = new ProjectsRegistry();

},{"./projectservice":36,"./utils":40,"g3w/core/g3wobject":28,"g3w/core/utils":40}],38:[function(require,module,exports){
var inherit = require('g3w/core/utils').inherit;
var base = require('g3w/core/utils').base;
var G3WObject = require('g3w/core/g3wobject');

var RouterService = function(){
  this._route = '';
  this.setters = {
    setRoute: function(path){
      this._route = path;
    }
  }
  base(this);
};
inherit(RouterService,G3WObject);

var proto = RouterService.prototype;

proto.goto = function(path){
  this.setRoute(path);
};

proto.slicePath = function(path){
  return path.split('?')[0].split('/');
};
  
proto.sliceFirst = function(path){
    var pathAndQuery = path.split('?');
    var queryString = pathAndQuery[1];
    var pathArr = pathAndQuery[0].split('/')
    var firstPath = pathArr[0];
    path = pathArr.slice(1).join('/');
    path = [path,queryString].join('?')
    return [firstPath,path];
  };
  
proto.getQueryParams = function(path){
    var queryString = path.split('?')[1];
    var queryPairs = queryString.split('&');
    var queryParams = {};
    _.forEach(queryPairs,function(queryPair){
      var pair = queryPair.split('=');
      var key = pair[0];
      var value = pair[1];
      queryParams[key] = value;
    });
    return queryParams;
  };
  
proto.makeQueryString = function(queryParams){};

module.exports = new RouterService;

},{"g3w/core/g3wobject":28,"g3w/core/utils":40}],39:[function(require,module,exports){
var inherit = require('./utils').inherit;
var G3WObject = require('g3w/core/g3wobject');

function ToolsService(){
  var self = this;
  this.config = null;
  this._actions = {};
  this.state = {
    tools: []
  };
  
  this.init = function(config){
    this.config = config;
    this.setState();
  };
  
  this.setState = function(){
    this._mergeTools(this.config.tools);
  };
  
  this.registerToolsProvider = function(plugin){
    self._mergeTools(plugin.getTools());
    self._addActions(plugin);
  }
  
  this.fireAction = function(actionid){
    var plugin = this._actions[actionid];
    var method = this._actionMethod(actionid);
    plugin[method]();
  };
  
  this._actionMethod = function(actionid){
    var namespace = actionid.split(":");
    return namespace.pop();
  };
  
  this._mergeTools = function(tools){
    self.state.tools = _.concat(self.state.tools,tools);
  };
  
  this._addActions = function(plugin){
    _.forEach(plugin.getTools(),function(tool){
      _.forEach(plugin.getActions(tool),function(action){
        self._actions[action.id] = plugin;
      })
    })
  };
};

// Make the public service en Event Emitter
inherit(ToolsService,G3WObject);

module.exports = new ToolsService

},{"./utils":40,"g3w/core/g3wobject":28}],40:[function(require,module,exports){

/**
 * Decimal adjustment of a number.
 *
 * @param {String}  type  The type of adjustment.
 * @param {Number}  value The number.
 * @param {Integer} exp   The exponent (the 10 logarithm of the adjustment base).
 * @returns {Number} The adjusted value.
 */
function decimalAdjust(type, value, exp) {
  // If the exp is undefined or zero...
  if (typeof exp === 'undefined' || +exp === 0) {
    return Math[type](value);
  }
  value = +value;
  exp = +exp;
  // If the value is not a number or the exp is not an integer...
  if (isNaN(value) || !(typeof exp === 'number' && exp % 1 === 0)) {
    return NaN;
  }
  // Shift
  value = value.toString().split('e');
  value = Math[type](+(value[0] + 'e' + (value[1] ? (+value[1] - exp) : -exp)));
  // Shift back
  value = value.toString().split('e');
  return +(value[0] + 'e' + (value[1] ? (+value[1] + exp) : exp));
}

// Decimal round
if (!Math.round10) {
  Math.round10 = function(value, exp) {
    return decimalAdjust('round', value, exp);
  };
}
// Decimal floor
if (!Math.floor10) {
  Math.floor10 = function(value, exp) {
    return decimalAdjust('floor', value, exp);
  };
}
// Decimal ceil
if (!Math.ceil10) {
  Math.ceil10 = function(value, exp) {
    return decimalAdjust('ceil', value, exp);
  };
}

String.prototype.hashCode = function() {
  var hash = 0, i, chr, len;
  if (this.length === 0) return hash;
  for (i = 0, len = this.length; i < len; i++) {
    chr   = this.charCodeAt(i);
    hash  = ((hash << 5) - hash) + chr;
    hash |= 0;
  }
  return hash;
};

var utils = {
  mixin: function mixin(destination, source) {
      return utils.merge(destination.prototype, source);
  },
  
  mixininstance: function mixininstance(destination,source){
      var sourceInstance = new source;
      utils.merge(destination, sourceInstance);
      utils.merge(destination.prototype, source.prototype);
  },


  merge: function merge(destination, source) {
      var key;

      for (key in source) {
          if (utils.hasOwn(source, key)) {
              destination[key] = source[key];
          }
      }
  },

  hasOwn: function hasOwn(object, key) {
      return Object.prototype.hasOwnProperty.call(object, key);
  },
  
  inherit:function(childCtor, parentCtor) {
    function tempCtor() {};
    tempCtor.prototype = parentCtor.prototype;
    childCtor.superClass_ = parentCtor.prototype;
    childCtor.prototype = new tempCtor();
    childCtor.prototype.constructor = childCtor;
  },
  
  base: function(me, opt_methodName, var_args) {
    var caller = arguments.callee.caller;
    if (caller.superClass_) {
      // This is a constructor. Call the superclass constructor.
      return caller.superClass_.constructor.apply(
          me, Array.prototype.slice.call(arguments, 1));
    }

    var args = Array.prototype.slice.call(arguments, 2);
    var foundCaller = false;
    for (var ctor = me.constructor;
         ctor; ctor = ctor.superClass_ && ctor.superClass_.constructor) {
      if (ctor.prototype[opt_methodName] === caller) {
        foundCaller = true;
      } else if (foundCaller) {
        return ctor.prototype[opt_methodName].apply(me, args);
      }
    }

    // If we did not find the caller in the prototype chain,
    // then one of two things happened:
    // 1) The caller is an instance method.
    // 2) This method was not called by the right caller.
    if (me[opt_methodName] === caller) {
      return me.constructor.prototype[opt_methodName].apply(me, args);
    } else {
      throw Error(
          'base called from a method of one name ' +
          'to a method of a different name');
    }
  },
  
  noop: function(){},
  
  truefnc: function(){return true},
  
  falsefnc: function(){return true},
  
  resolvedValue: function(value){
    var deferred = $.Deferred();
    deferred.resolve(value);
    return deferred.promise();
  },
  
  rejectedValue: function(value){
    var deferred = $.Deferred();
    deferred.reject(value);
    return deferred.promise();
  }
};

module.exports = utils;

},{}],41:[function(require,module,exports){
var inherit = require('g3w/core/utils').inherit;
var truefnc = require('g3w/core/utils').truefnc;
var resolvedValue = require('g3w/core/utils').resolvedValue;
var rejectedValue = require('g3w/core/utils').rejectedValue;
var G3WObject = require('g3w/core/g3wobject');

function VectorLayer(config){
  var config = config || {};
  this.geometrytype = config.geometrytype || null;
  this.format = config.format || null;
  this.crs = config.crs  || null;
  this.id = config.id || null;
  this.name = config.name || "";
  this.pk = config.pk || "id"; // TODO: il GeoJSON setta l'id della feature da sé, e nasconde il campo PK dalle properties. In altri formati va verificato, e casomai usare feature.setId()
  
  this._olSource = new ol.source.Vector({
    features: new ol.Collection()
  });
  this._olLayer = new ol.layer.Vector({
    name: this.name,
    source: this._olSource
  });
  
  /*
   * Array di oggetti:
   * {
   *  name: Nome dell'attributo,
   *  type: integer | float | string | boolean | date | time | datetime,
   *  input: {
   *    label: Nome del campo di input,
   *    type: select | check | radio | coordspicker | boxpicker | layerpicker | fielddepend,
   *    options: {
   *      Le opzioni per lo spcifico tipo di input (es. "values" per la lista di valori di select, check e radio)
   *    }
   *  }
   * }
  */
  this._PKinAttributes = false;
  this._featuresFilter = null;
  this._fields = null
  this.lazyRelations = true;
  this._relations = null;
}
inherit(VectorLayer,G3WObject);
module.exports = VectorLayer;

var proto = VectorLayer.prototype;

proto.setData = function(featuresData){
  var self = this;
  var features;
  if (this.format) {
    switch (this.format){
      case "GeoJSON":
        var geojson = new ol.format.GeoJSON({
          defaultDataProjection: this.crs,
          geometryName: "geometry"
        });
        features = geojson.readFeatures(featuresData);
        break;
    }
    
    if (features && features.length) {
      if (!_.isNull(this._featuresFilter)){
        var features = _.map(features,function(feature){
          return self._featuresFilter(feature);
        });
      }
      
      var alreadyLoadedIds = this.getFeatureIds();
      var featuresToLoad = _.filter(features,function(feature){
        return !_.includes(alreadyLoadedIds,feature.getId());
      })
      
      this._olSource.addFeatures(featuresToLoad);
      
      // verifico, prendendo la prima feature, se la PK è presente o meno tra gli attributi
      var attributes = this.getSource().getFeatures()[0].getProperties();
      this._PKinAttributes = _.get(attributes,this.pk) ? true : false;
    }
  }
  else {
    console.log("VectorLayer format not defined");
  }
};

proto.setFeatureData = function(oldfid,fid,geometry,attributes){
  var feature = this.getFeatureById(oldfid);
  if (fid){
    feature.setId(fid);
  }
  
  if (geometry){
    feature.setGeometry(geometry);
  }
  
  if (attributes){
    var oldAttributes = feature.getProperties();
    var newAttributes =_.assign(oldAttributes,attributes);
    feature.setProperties(newAttributes);
  }
  
  return feature;
};

proto.addFeatures = function(features){
  this.getSource().addFeatures(features);
};

proto.setFeaturesFilter = function(featuresFilter){
  this._featuresFilter = featuresFilter;
};

proto.setFields = function(fields){
  this._fields = fields;
};

proto.setPkField = function(){
  var self = this;
  var pkfieldSet = false;
  _.forEach(this._fields,function(field){
    if (field.name == self.pk ){
      pkfieldSet = true;
    }
  });
  
  if (!pkfieldSet){
    this._fields
  }
};

proto.getFeatures = function(){
  return this.getSource().getFeatures();
};

proto.getFeatureIds = function(){
  var featureIds = _.map(this.getSource().getFeatures(),function(feature){
    return feature.getId();
  })
  return featureIds
};

proto.getFields = function(){
  return _.cloneDeep(this._fields);
};

proto.getFieldsNames = function(){
  return _.map(this._fields,function(field){
    return field.name;
  });
};

proto.getFieldsWithAttributes = function(obj){
  var self = this;
  /*var fields = _.cloneDeep(_.filter(this._fields,function(field){
    return ((field.name != self.pk) && field.editable);
  }));*/
  var fields = _.cloneDeep(this._fields);
  
  var feature, attributes;
  
  // il metodo accetta sia feature che fid
  if (obj instanceof ol.Feature){
    feature = obj;
  }
  else if (obj){
    feature = this.getFeatureById(obj);
  }
  if (feature){
    attributes = feature.getProperties();
  }
  
  _.forEach(fields,function(field){
    if (feature){
      if (!this._PKinAttributes && field.name == self.pk){
        field.value = feature.getId();
      }
      else{
        field.value = attributes[field.name];
      }
    }
    else{
      field.value = null;
    }
  });
  return fields;
};

proto.setRelations = function(relations){
  _.forEach(relations,function(relation,relationKey){
    relation.name = relationKey;
  });
  this._relations = relations;
};

proto.getRelations = function(){
  return this._relations;
};

proto.hasRelations = function(){
  return !_.isNull(this._relations);
};

proto.getRelationsNames = function(){
  return _.keys(this._relations);
};

proto.getRelationsFksKeys = function(){
  var fks = [];
  _.forEach(this._relations,function(relation){
    fks.push(relation.fk);
  })
  return fks;
};

proto.getRelationFieldsNames = function(relation){
  var relationFields = this._relations[relation];
  if (relationFields){
    return _.map(relationFields,function(field){
      return field.name;
    });
  }
  return null;
};

// ottengo le relazioni a partire dal fid di una feature esistente
proto.getRelationsWithAttributes = function(fid){
  var relations = _.cloneDeep(this._relations);
  var self = this;
  if (!fid || !this.getFeatureById(fid)){
    _.forEach(relations,function(relation,relationKey){
        // inizialmente setto a null i valori
      _.forEach(relation.fields,function(field){
        field.value = null;
      })
    });
    return resolvedValue(relations);
  }
  else {
    if (this.lazyRelations){
      var deferred = $.Deferred();
      var attributes = this.getFeatureById(fid).getProperties();
      var fks = {};
      _.forEach(relations,function(relation,relationKey){
        var url = relation.url;
        var keyVals = [];
        _.forEach(relation.fk,function(fkKey){
          fks[fkKey] = attributes[fkKey];
        });
      })
      
      this.getRelationsWithAttributesFromFks(fks)
      .then(function(relationsResponse){
        deferred.resolve(relationsResponse);
      })
      .fail(function(){
        deferred.reject();
      });
      return deferred.promise();
    }
  }
};

// ottengo le relazioni valorizzate a partire da un oggetto con le chiavi FK come keys e i loro valori come values
proto.getRelationsWithAttributesFromFks = function(fks){
  var self = this;
  var relations = _.cloneDeep(this._relations);
  var relationsRequests = [];

  _.forEach(relations,function(relation,relationKey){
    var url = relation.url;
    var keyVals = [];
    _.forEach(relation.fk,function(fkKey){
      var fkValue = fks[fkKey];
      keyVals.push(fkKey+"="+fkValue);
    });
    var fkParams = _.join(keyVals,"&");
    url += "?"+fkParams;
    relationsRequests.push($.get(url)
      .then(function(relationAttributes){
        _.forEach(relation.fields,function(field){
          field.value = relationAttributes[0][field.name];
        });
      })
    )
  })
  
  return $.when.apply(this,relationsRequests)
  .then(function(){
    return relations;
  });
}

proto.setStyle = function(style){
  this._olLayer.setStyle(style);
};

proto.getLayer = function(){
  return this._olLayer;
};

proto.getSource = function(){
  return this._olLayer.getSource();
};

proto.getFeatureById = function(id){
  return this._olLayer.getSource().getFeatureById(id);
};

proto.clear = function(){
  this.getSource().clear();
};

proto.addToMap = function(map){
  map.addLayer(this._olLayer);
};

// data una feature verifico se ha tra gli attributi i valori delle FK delle (eventuali) relazioni
proto.featureHasRelationsFksWithValues = function(feature){
  var attributes = feature.getProperties();
  var fksKeys = this.getRelationsFksKeys();
  return _.every(fksKeys,function(fkKey){
    var value = attributes[fkKey];
    return (!_.isNil(value) && value != '');
  })
};

// data una feature popolo un oggetto con chiavi/valori delle FK delle (eventuali) relazione
proto.getRelationsFksWithValuesForFeature = function(feature){
  var attributes = feature.getProperties();
  var fks = {};
  var fksKeys = this.getRelationsFksKeys();
  _.forEach(fksKeys,function(fkKey){
    fks[fkKey] = attributes[fkKey];
  })
  return fks;
};

},{"g3w/core/g3wobject":28,"g3w/core/utils":40}],42:[function(require,module,exports){
var inherit = require('./utils').inherit;
var base = require('./utils').base;
var Layer = require('./layer');
var RasterLayers = require('g3w-ol3/src/layers/rasters');

function WMSMultiLayer(config,extraParams){
  base(this,config);
  
  var self = this;
  this._olLayer = null;
  this.layers = [];
  this.extraParams = extraParams;
  
  this._olLayer = null;
}
inherit(WMSMultiLayer,Layer)
var proto = WMSMultiLayer.prototype;

proto.getLayer = function(){
  var olLayer = this._olLayer;
  if (!olLayer){
    olLayer = this._olLayer = this._makeOlLayer();
  }
  return olLayer;
};

proto.getLayerConfigs = function(){
  return this.layers;
};

proto.getSource = function(){
  return this._olLayer.getSource();
};

proto.getId = function(){
  return this.id;
};

proto._makeOlLayer = function(){
  var self = this;
  var wmsConfig = {
    url: this.config.defaultUrl,
    id: this.config.id
  };
  
  var olLayer = new RasterLayers.WMSLayer(wmsConfig,this.extraParams);
  
  olLayer.getSource().on('imageloadstart', function() {
        self.emit("loadstart");
      });
  olLayer.getSource().on('imageloadend', function() {
      self.emit("loadend");
  });
  
  return olLayer
};

proto.addLayer = function(layerConfig){
  this.layers.push(layerConfig);
};

proto.toggleLayer = function(layer){
  _.forEach(this.layers,function(_layer){
    if (_layer.id == layer.id){
      _layer.visible = layer.visible;
    }
  });
  this._updateLayers();
};
  
proto.update = function(extraParams){
  this._updateLayers(extraParams);
};

proto.isVisible = function(){
  return this._getVisibleLayers().length > 0;
};

proto._getVisibleLayers = function(){
  var visibleLayers = [];
  _.forEach(this.layers,function(layer){
    if (layer.visible){
      visibleLayers.push(layer);
    }    
  })
  return visibleLayers;
}

proto._updateLayers = function(extraParams){
  var visibleLayers = this._getVisibleLayers();
  if (visibleLayers.length > 0) {
    var params = {
      LAYERS: _.join(_.map(visibleLayers,'name'),',')
    };
    if (extraParams) {
      params = _.assign(extraParams,params);
    }
    this._olLayer.setVisible(true);
    this._olLayer.getSource().updateParams(params);
  }
  else {
    this._olLayer.setVisible(false);
  }
};

proto.getQueryUrl = function(){
  var layer = this.layers[0];
  if (layer.infourl && layer.infourl != '') {
    return layer.infourl;
  }
  return this.config.defaultUrl;
};

proto.getQueryLayers = function(){
  
  // DA REIMPLEMENTARE SULLA BASE DI WMSSingleLayer
  
  /*var layer = this.layers[0];
  var queryLayers = [];
  _.forEach(this.layers,function(layer){
    if (layer.infolayer && layer.infolayer != '') {
      queryLayers.push(layer.infolayer);
    }
    else {
      queryLayers.push(layer.name);
    }
  })
  return queryLayers;*/
};

module.exports = WMSMultiLayer;


},{"./layer":31,"./utils":40,"g3w-ol3/src/layers/rasters":24}],43:[function(require,module,exports){
var inherit = require('./utils').inherit;
var base = require('./utils').base;
var Layer = require('./layer');
var RasterLayers = require('g3w-ol3/src/layers/rasters');

function WMSSingleLayer(config,extraParams){
  base(this,config);
  var self = this;
  this.LAYERTYPE = {
    LAYER: 'layer',
    MULTILAYER: 'multilayer'
  };

  this._olLayer = null;
  this.layer = null;
  this.extraParams = extraParams;
}
inherit(WMSSingleLayer,Layer)
var proto = WMSSingleLayer.prototype;

proto.getLayer = function(){
 var olLayer = this._olLayer;
  if (!olLayer){
    olLayer = this._olLayer = this._makeOlLayer();
  }
  return olLayer;
};

proto.getLayerConfigs = function(){
  return [this.layer];
};

proto.getSource = function(){
  return this._olLayer.getSource();
};

proto.getId = function(){
  return this.id;
};

proto._makeOlLayer = function(){
  var self = this;
  var wmsConfig = {
    url: this.config.defaultUrl,
    id: this.config.id,
    layers: this.layer.name,
    maxResolution: this.layer.maxresolution
  };
  
  if (this.layer.source && this.layer.source.type == 'wms'){
    wmsConfig.url = this.layer.source.url;
    wmsConfig.layers = this.layer.source.layers;
  };

  var WMSLayerClass;
  if (this.config.tiled) {
    WMSLayerClass = RasterLayers.TiledWMSLayer;
  }
  else {
    WMSLayerClass = RasterLayers.WMSLayer;
  }

  var olLayer = new WMSLayerClass(wmsConfig,this.extraParams);
  
  olLayer.getSource().on('imageloadstart', function() {
        self.emit("loadstart");
      });
  olLayer.getSource().on('imageloadend', function() {
      self.emit("loadend");
  });
  
  return olLayer
};

proto.addLayer = function(layerConfig){
  this.layer = layerConfig;
};

proto.toggleLayer = function(layer){
  var visible = this._olLayer.getVisible();
  this._olLayer.setVisible(!visible);
};
  
proto.update = function(extraParams){
  var olLayer = this.getLayer();
  if (extraParams){
    olLayer.getSource().updateParams(extraParams);
  }
  olLayer.setVisible(this.layer.visible);
};

proto.isVisible = function(){
  return this.layer.visible;
};

proto.getQueryUrl = function(){
  if (this.layer.infourl && this.layer.infourl != '') {
    return this.layer.infourl;
  }
  return this.config.defaultUrl;
};

proto.getQueryLayers = function(){
  var queryLayers = [];
  
  if (Layer.isQueryable(this.layer)) {
    queryLayers.push({
      layerName: this.layer.name,
      queryLayerName: Layer.getQueryLayerName(this.layer)
    });
  }
  
  return queryLayers;
};

module.exports = WMSSingleLayer;


},{"./layer":31,"./utils":40,"g3w-ol3/src/layers/rasters":24}],44:[function(require,module,exports){
module.exports = "<!-- item template -->\n<div id=\"catalog\" class=\"tabbable-panel catalog\">\n  <div class=\"tabbable-line\">\n    <ul class=\"nav nav-tabs\" role=\"tablist\">\n      <li role=\"presentation\" class=\"active\"><a href=\"#tree\" aria-controls=\"tree\" role=\"tab\" data-toggle=\"tab\" data-i18n=\"tree\"></a></li>\n      <li v-if=\"hasBaseLayers\" role=\"presentation\"><a href=\"#baselayers\" aria-controls=\"baselayers\" role=\"tab\" data-toggle=\"tab\" data-i18n=\"baselayers\"></a></li>\n      <li role=\"presentation\"><a href=\"#legend\" aria-controls=\"legend\" role=\"tab\" data-toggle=\"tab\" data-i18n=\"legend\"></a></li>\n    </ul>\n    <div  class=\"tab-content\">\n      <div role=\"tabpanel\" class=\"tab-pane active tree\" id=\"tree\">\n        <ul class=\"tree-root\">\n          <tristate-tree :layerstree=\"layerstree\" class=\"item\" v-for=\"layerstree in layerstree\">\n          </tristate-tree>\n        </ul>\n      </div>\n      <div v-if=\"hasBaseLayers\" role=\"tabpanel\" class=\"tab-pane baselayers\" id=\"baselayers\">\n        <form>\n          <ul>\n            <li v-if=\"!baselayer.fixed\" v-for=\"baselayer in baselayers\">\n              <div class=\"radio\">\n                <label><input type=\"radio\" name=\"baselayer\" v-checked=\"baselayer.visible\" @click=\"setBaseLayer(baselayer.id)\">{{ baselayer.title }}</label>\n              </div>\n            </li>\n          </ul>\n        </form>\n      </div>\n      <legend :layerstree=\"layerstree\"></legend>\n    </div>\n  </div>\n</div>\n";

},{}],45:[function(require,module,exports){
var t = require('i18n/i18n.service').t;
var GUI = require('g3w/gui/gui');
var ProjectsRegistry = require('g3w/core/projectsregistry');
var ProjectService = require('g3w/core/projectservice').ProjectService;

Vue.component('g3w-catalog',{
    template: require('./catalog.html'),
    data: function() {
      return {
        state: ProjectService.state
      }
    },
    computed: {
      layerstree: function(){
        return this.state.project.layerstree;
      },
      baselayers: function(){
        return this.state.baseLayers;
      },
      hasBaseLayers: function(){
        return this.state.baseLayers.length>0;
      }
    },
    methods: {
      setBaseLayer: function(id) {
        ProjectService.setBaseLayer(id);
      }
    },
    ready: function() {
      //
    }
});

// tree component
Vue.component('tristate-tree', {
  template: require('./tristate-tree.html'),
  props: {
    layerstree: [],
    //eredito il numero di childs dal parent
    n_parentChilds : 0,
    checked: false
  },
  data: function () {
    return {
      expanded: this.layerstree.expanded,
      parentChecked: false,
      //proprieta che serve per fare confronto per il tristate
      n_childs: this.layerstree.nodes ? this.layerstree.nodes.length : 0
    }
  },
  watch: {
      'checked': function (val){
        this.layerstree.visible = val;
      }
  },
  computed: {
    isFolder: function () {
      var isFolder = this.n_childs ? true : false;
      if (isFolder) {
        var _visibleChilds = 0;
        _.forEach(this.layerstree.nodes,function(layer){
          if (layer.visible){
            _visibleChilds += 1;
          }
        });
        this.n_parentChilds = this.n_childs - _visibleChilds;
      }
      return isFolder
    },
    isHidden: function() {
      return this.layerstree.hidden && (this.layerstree.hidden === true);
    }
  },
  methods: {
    toggle: function (checkAllLayers) {
      var checkAll = checkAllLayers == 'true' ? true : false;
      if (this.isFolder && !checkAll) {
        this.layerstree.expanded = !this.layerstree.expanded;
      }
      else if (checkAll){
        if (this.parentChecked && !this.n_parentChilds){
          this.parentChecked = false;
        } else if (this.parentChecked && this.n_parentChilds) {
          this.parentChecked = true;
        }
        else {
          this.parentChecked = !this.parentChecked;
        }
        ProjectService.toggleLayers(this.layerstree.nodes,this.parentChecked);
      }
      else {
        ProjectService.toggleLayer(this.layerstree);
      }
    },
    triClass: function () {
      if (!this.n_parentChilds) {
        return 'fa-check-square-o';
      } else if ((this.n_parentChilds > 0) && (this.n_parentChilds < this.n_childs)) {
        return 'fa-square';
      } else {
        return 'fa-square-o';
      }
    }
  }
})

Vue.component('legend',{
    template: require('./legend.html'),
    props: ['layerstree'],
    data: function() {
      return {
        //data qui
      }
    },
    computed: {
      visiblelayers: function(){
        var _visiblelayers = [];
        var layerstree = this.layerstree;
        function traverse(obj){
        _.forIn(obj, function (layer, key) {
              //verifica che il valore dell'id non sia nullo
              if (!_.isNil(layer.id) && layer.visible) {
                  _visiblelayers.push(layer);
              }
              if (!_.isNil(layer.nodes)) {
                  traverse(layer.nodes);
              }
          });
        }
        traverse(layerstree);
        return _visiblelayers;
      }
    },
    watch: {
      'layerstree': {
        handler: function(val, old){
          //codice qui
        },
        deep: true
      }
    },
    ready: function() {
      //codice qui
    }
});

Vue.component('legend-item',{
  template: require('./legend_item.html'),
  props: ['layer'],
  computed: {
    legendurl: function(){
      // in attesa di risolvere lo schianto di QGSI Server...
      //return "http://localhost/cgi-bin/qgis_mapserv.fcgi?map=/home/giohappy/Scrivania/Dev/G3W/g3w-client/test/progetto/test.qgs&SERVICE=WMS&VERSION=1.3.0&REQUEST=GetLegendGraphic&FORMAT=image/png&LAYERTITLE=False&ITEMFONTSIZE=10&LAYER="+this.layer.name;
      return ProjectService.getLegendUrl(this.layer);
    }
  },
  methods: {
    // esempio utilizzo del servizio GUI
    openform: function(){
      //GUI.notify.success("Apro un form");
      //GUI.showForm();
    }
  }
})

},{"./catalog.html":44,"./legend.html":46,"./legend_item.html":47,"./tristate-tree.html":48,"g3w/core/projectservice":36,"g3w/core/projectsregistry":37,"g3w/gui/gui":55,"i18n/i18n.service":68}],46:[function(require,module,exports){
module.exports = "<div role=\"tabpanel\" class=\"tab-pane\" id=\"legend\">\n  <legend-item :layer=\"layer\" v-for=\"layer in visiblelayers\"></legend-item>\n</div>\n";

},{}],47:[function(require,module,exports){
module.exports = "<div @click=\"openform()\">{{ layer.title }}</div>\n<div><img :src=\"legendurl\"></div>\n";

},{}],48:[function(require,module,exports){
module.exports = "<li v-if=\"!isHidden\" class=\"tree-item\">\n  <span :class=\"{bold: isFolder, 'fa-chevron-down': layerstree.expanded, 'fa-chevron-right': !layerstree.expanded}\" @click=\"toggle\" v-if=\"isFolder\" class=\"fa\"></span>\n  <span v-if=\"isFolder\" @click=\"toggle('true')\" :class=\"[triClass()]\" class=\"fa\"></span>\n  <span v-else @click=\"toggle\" :class=\"[layerstree.visible  ? 'fa-check-square-o': 'fa-square-o',layerstree.disabled  ? 'disabled': '']\" class=\"fa\" style=\"cursor:default\"></span>\n  <span :class=\"{bold: isFolder, disabled: layerstree.disabled}\" @click=\"toggle\">{{layerstree.title}}</span>\n  <ul v-show=\"layerstree.expanded\" v-if=\"isFolder\">\n    <tristate-tree :n_parent-childs.sync=\"n_parentChilds\" :layerstree=\"layerstree\" :checked=\"parentChecked\" v-for=\"layerstree in layerstree.nodes\">\n    </tristate-tree>\n  </ul>\n</li>\n\n\n\n";

},{}],49:[function(require,module,exports){
var resolvedValue = require('g3w/core/utils').resolvedValue;
var rejectedValue = require('g3w/core/utils').rejectedValue;
var GUI = require('g3w/gui/gui');
var ProjectService = require('g3w/core/projectservice').ProjectService;
var MapService = require('g3w/core/mapservice');

Vue.filter('startcase', function (value) {
  return _.startCase(value);
});

Vue.validator('email', function (val) {
  return /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(val)
});

Vue.validator('integer', function (val) {
  return /^(-?[1-9]\d*|0)$/.test(val);
})

var FormPanel = Vue.extend({
  template: require('./formpanel.html'),
  methods: {
    exec: function(cbk){
      var relations = this.state.relations || null;
      cbk(this.state.fields,relations);
      GUI.closeForm();
    },
    btnEnabled: function(button) {
      return button.type != 'save' || (button.type == 'save' && this.$validation.valid);
    },
    hasFieldsRequired: function() {
      return this.$options.form._hasFieldsRequired();
    },
    isEditable: function(field){
      return this.$options.form._isEditable(field);
    },
    isSimple: function(field){
      return this.$options.form._isSimple(field);
    },
    isBoolean: function(field) {
      return this.$options.form._isBoolean(field);
    },
    isSelect: function(field){
      return this.$options.form._isSelect(field);
    },
    isLayerPicker: function(field){
      return this.$options.form._isLayerPicker(field);
    },
    layerPickerPlaceHolder: function(field){
      return this.$options.form._getlayerPickerLayerName(field.input.options.layerid);
    },
    pickLayer: function(field){
      this.$options.form._pickLayer(field);
    },
    isVisible: function(field){
      return this.$options.form._isVisible(field);
    },
    showRelation: function(relation){
      return this.$options.form._shouldShowRelation(relation);
    }
  },
  computed: {
    isValid: function(field) {
      return this.$validate(field.name);
    },
  }
});

var Inputs = {};
Inputs.STRING = 'string';
Inputs.INTEGER = 'integer';
Inputs.FLOAT = 'float';
Inputs.BOOLEAN = 'boolean';

Inputs.defaults = {};
Inputs.defaults[Inputs.STRING] = "";
Inputs.defaults[Inputs.INTEGER] = 0;
Inputs.defaults[Inputs.FLOAT] = 0.0;
Inputs.defaults[Inputs.BOOLEAN] = false;
Inputs.simpleFieldTypes = [Inputs.STRING,Inputs.INTEGER,Inputs.FLOAT];

Inputs.SELECT = 'select';
Inputs.LAYERPICKER = 'layerpicker';

Inputs.specialInputs = [Inputs.SELECT,Inputs.LAYERPICKER];

function Form(options){
  // proprietà necessarie. In futuro le mettermo in una classe Panel da cui deriveranno tutti i pannelli che vogliono essere mostrati nella sidebar
  this.panelComponent = null;
  this.options =  options || {};
  this.id = options.id; // id del form
  this.name = options.name; // nome del form
  this.dataid = options.dataid; // "accessi", "giunzioni", ecc.
  this.pk = options.pk || null, // eventuale chiave primaria (non tutti i form potrebbero avercela o averne bisogno
  this.isnew = (!_.isNil(options.isnew) && _.isBoolean(options.isnew)) ? options.isnew : true;
  
  this.state = {
    // i dati del form possono avere o meno una primary key
    fields: options.fields,
    relations: options.relations
  }
  
  this._formPanel = options.formPanel || FormPanel;
  this._defaults = options.defaults || Inputs.defaults;
}

var proto = Form.prototype;

// viene richiamato dalla toolbar quando il plugin chiede di mostrare un proprio pannello nella GUI (GUI.showPanel)
proto.onShow = function(container){
  this._setupFields();
  var panel = this._setupPanel();
  this._mountPanel(panel,container);
  return resolvedValue(true);
};

// richiamato quando la GUI chiede di chiudere il pannello. Se ritorna false il pannello non viene chiuso
proto.onClose = function(){
  this.panelComponent.$destroy(true);
  this.panelComponent = null;
  return resolvedValue(true);
};

proto._isNew = function(){
  return this.isnew;
};

proto._hasFieldsRequired = function() {
  var someFieldsRequired = _.some(this.state.fields,function(field){
    return field.validate && field.validate.required;
  });
  var someRelationsRequired = _.some(this.state.relations,function(relation){
    return relation.validate && relation.validate.required;
  });
  return someFieldsRequired || someRelationsRequired;
};

proto._isVisible = function(field){
  if(!field.editable && (field.value == "" || _.isNull(field.value))){
    return false
  }
  return true;
};

proto._isEditable = function(field){
  return field.editable;
};

proto._isSimple = function(field){
  if (_.includes(Inputs.specialInputs,field.input.type)){
    return false;
  }
  return _.includes(Inputs.simpleFieldTypes,field.type)
};

proto._isBoolean = function(field) {
  return field.type == Inputs.BOOLEAN;
};

proto._isSelect = function(field){
  return (_.includes(Inputs.specialInputs,field.input.type) && field.input.type == Inputs.SELECT);
};

proto._isLayerPicker = function(field){
  return (_.includes(Inputs.specialInputs,field.input.type) && field.input.type == Inputs.LAYERPICKER);
};

proto._pickLayer = function(field){
  // ritorno una promessa, se qualcun altro volesse usare il risultato (es. per settare altri campi in base alla feature selezionata)
  var d = $.Deferred();
  // disabilito temporanemante lo strato modale per permettere l'interazione con la mappa
  GUI.setModal(false);
  var layerId = field.input.options.layerid;
  var relFieldName = field.input.options.field;
  var relFieldLabel = ProjectService.getLayerAttributeLabel(layerId,field.input.options.field);
  MapService.getFeatureInfo(layerId)
  .then(function(attributes){
    var value = attributes[relFieldName] ? attributes[relFieldName] : attributes[relFieldLabel];
    field.value = value;
    d.resolve(attributes);
  })
  .always(function(){
    GUI.setModal(true);
    d.reject();
  });
  return d.promise();
};

proto._getDefaultValue = function(field){
  var defaultValue = null;
  if (field.input) {
    if (field.input.options && field.input.options.default){
      defaultValue = field.input.options.default;
    }
    else if (this._isSelect(field)){
      defaultValue = field.input.options.values[0].key;
    }
    else if (this._isBoolean(field)){
      defaultValue = this._defaults[Inputs.BOOLEAN];
    }
  }
  
  /*else {
    defaultValue = this._defaults[field.type];
  }*/
  return defaultValue;
};

proto._getlayerPickerLayerName = function(id){
  var layer = ProjectService.getLayer(id);
  if (layer){
    return layer.name;
  }
  return "";
};

proto._shouldShowRelation = function(relation){
  return true;
};

// per definire i valori di default nel caso si tratta di un nuovo inserimento
proto._setupFields = function(){
  var self = this;
  
  var fields = _.filter(this.state.fields,function(field){
    // tutti i campi eccetto la PK (se non nulla)
    if (self.pk && field.value==null){
      return ((field.name != self.pk));
    }
    return true;
  });
  
  _.forEach(fields,function(field){
    if(_.isNil(field.value)){
      var defaultValue = self._getDefaultValue(field);
      if (defaultValue){
        field.value = defaultValue;
      }
    }
  });
  
  if (this.state.relations){
    var relations = this.state.relations;
    _.forEach(relations,function(relation){
      _.forEach(relation.fields,function(field){
        if(_.isNil(field.value)){
          var defaultValue = self._getDefaultValue(field);
          if (defaultValue){
            field.value = defaultValue;
          }
        }
      });
    })
  }
};

proto._setupPanel = function(){
  var panel = this.panelComponent = new this._formPanel({
    form: this
  });
  if (this.options.buttons) {
    panel.buttons = this.options.buttons;
  }
  panel.state = this.state;
  return panel
};

proto._mountPanel = function(panel,container){
  panel.$mount().$appendTo(container);
};

proto._getField = function(fieldName){
  var field = null;
  _.forEach(this.state.fields,function(f){
    if (f.name == fieldName){
      field = f;
    }
  })
  return field;
};

proto._getRelationField = function(fieldName,relationName){
  var field = null;
  _.forEach(this.state.relations,function(relation,name){
    if (relationName == name){
      _.forEach(relation.fields,function(f){
        if (f.name == fieldName){
          field = f;
        }
      })
    }
  })
  return field;
};

module.exports = {
  Form: Form,
  FormPanel: FormPanel
}

},{"./formpanel.html":50,"g3w/core/mapservice":33,"g3w/core/projectservice":36,"g3w/core/utils":40,"g3w/gui/gui":55}],50:[function(require,module,exports){
module.exports = "<div>\n  <validator name=\"validation\">\n    <form novalidate class=\"form-horizontal g3w-form\" :class=\"[$validation[relfield.name].invalid ? 'has-error': '']\">\n      <template v-for=\"field in state.fields\">\n        <div v-if=\"isVisible(field)\" class=\"form-group has-feedback\" :class=\"[$validation[field.name].invalid ? 'has-error': '']\">\n          <label :for=\"field.name\" class=\"col-sm-4 control-label\">{{ field.label }}<span v-if=\"field.validate && field.validate.required\">*</span></label>\n          <div class=\"col-sm-8\">\n            <input v-if=\"isSimple(field)\" :field=\"field.name\" v-validate=\"field.validate\" v-disabled=\"!isEditable(field)\" class=\"form-control\" v-model=\"field.value\" :id=\"field.name\" :placeholder=\"field.input.label\">\n            <select v-if=\"isSelect(field)\" :field=\"field.name\" v-validate=\"field.validate\" v-disabled=\"!isEditable(field)\" class=\"form-control\" v-model=\"field.value\" :id=\"field.name\" :placeholder=\"field.input.label\">\n              <option v-for=\"value in field.input.options.values\" value=\"{{ value.key }}\">{{ value.value }}</option>\n            </select>\n            <div v-if=\"isBoolean(field)\" class=\"checkbox\">\n              <label><input type=\"checkbox\" v-model=\"field.value\" :id=\"field.name\" v-disabled=\"!isEditable(field)\"></label>\n            </div>\n            <div v-if=\"isLayerPicker(field)\">\n              <input class=\"form-control\" @click=\"pickLayer(field)\" :field=\"field.name\" v-validate=\"field.validate\" v-disabled=\"!isEditable(field)\" onfocus=\"blur()\" data-toggle=\"tooltip\" title=\"Ottieni il dato da un elemento del layer '{{ layerPickerPlaceHolder(field) }}'\" v-model=\"field.value\" :id=\"field.name\" :placeholder=\"'['+layerPickerPlaceHolder(field)+']'\">\n              <i class=\"glyphicon glyphicon-screenshot form-control-feedback\"></i>\n            </div>  \n          </div>\n        </div>\n      </template>\n      <div v-for=\"relation in state.relations\">\n        <div v-if=\"showRelation(relation)\" transition=\"expand\">\n          <div class=\"g3w-relationname\">{{ relation.name | startcase }}</div>\n          <template v-for=\"relfield in relation.fields\">\n            <div v-if=\"isVisible(relfield)\" class=\"form-group has-feedback\" :class=\"[$validation[relfield.name].invalid ? 'has-error': '']\">\n              <label :for=\"relfield.name\" class=\"col-sm-4 control-label\">{{relfield.label}}<span v-if=\"relfield.validate && relfield.validate.required\">*</span></label>\n              <div class=\"col-sm-8\">\n                <input v-if=\"isSimple(relfield)\" :field=\"relfield.name\" v-validate=\"relfield.validate\" v-disabled=\"!isEditable(relfield)\" class=\"form-control\" v-model=\"relfield.value\" :id=\"relfield.name\" :placeholder=\"relfield.input.label\">\n                <select v-if=\"isSelect(relfield)\" :field=\"relfield.name\" v-validate=\"relfield.validate\" v-disabled=\"!isEditable(relfield)\" class=\"form-control\" v-model=\"relfield.value\" :id=\"relfield.name\" :placeholder=\"relfield.input.label\">\n                  <option v-for=\"relvalue in relfield.input.options.values\" value=\"{{ relvalue.key }}\">{{ relvalue.value }}</option>\n                </select>\n                <input v-if=\"isBoolean(relfield)\" type=\"checkbox\" v-model=\"relfield.value\" :id=\"relfield.name\" v-disabled=\"!isEditable(relfield)\">\n                <div v-if=\"isLayerPicker(relfield)\">\n                  <input class=\"form-control\" @click=\"pickLayer(relfield)\" :field=\"relfield.name\" v-validate=\"relfield.validate\" v-disabled=\"!isEditable(relfield)\" onfocus=\"blur()\" style=\"cursor:pointer\" data-toggle=\"tooltip\" title=\"Ottieni il dato da un elemento del layer '{{ layerPickerPlaceHolder(relfield) }}'\" v-model=\"relfield.value\" :id=\"relfield.name\" :placeholder=\"'['+layerPickerPlaceHolder(relfield)+']'\">\n                  <i class=\"glyphicon glyphicon-screenshot form-control-feedback\"></i>\n                </div>\n              </div>\n            </div>\n          </template>\n        </div>\n      </div>\n      <div class=\"form-group\">\n        <div class=\"col-sm-offset-4 col-sm-8\">\n          <div v-if=\"hasFieldsRequired\" style=\"margin-bottom:10px\">\n            <span>* Campi richiesti</span>\n          </div>\n          <span v-for=\"button in buttons\">\n            <button class=\"btn \" :class=\"[button.class]\" @click.stop.prevent=\"exec(button.cbk)\" v-disabled=\"!btnEnabled(button)\">{{ button.title }}</button>\n          </span>\n        </div>\n      </div>\n    </form>\n  </validator>\n</div>\n";

},{}],51:[function(require,module,exports){
module.exports = "<form class=\"navbar-form\" role=\"search\" @submit.prevent>\n  <div class=\"input-group\">\n    <input type=\"text\" class=\"form-control\" :placeholder=\"placeholder\" v-model=\"query\"  name=\"srch-term\" id=\"srch-term\">\n    <div class=\"input-group-btn\">\n        <button class=\"btn btn-default\" type=\"submit\" @click=\"search\"><i class=\"glyphicon glyphicon-search\"></i></button>\n    </div>\n  </div>\n</form>\n";

},{}],52:[function(require,module,exports){
var t = require('i18n/i18n.service').t;
var GUI = require('g3w/gui/gui');
var GeocodingService = require('g3w/core/geocodingservice');

Vue.component("geocoder",{
  template: require("./geocoding.html"),
  props: ['type'],
  data: function(){
    return {
      query: "",
      placeholder: t("street_search")
    }
  },
  methods: {
    search: function(e){
      e.preventDefault();
      var query = this.query;
      this.service.search(query);
    }
  },
  ready: function(){
    var self = this;
    this.service = GeocodingService[this.type];
    this.service.on("results",function(){
      self.query = "";
    })
  }
});

},{"./geocoding.html":51,"g3w/core/geocodingservice":29,"g3w/gui/gui":55,"i18n/i18n.service":68}],53:[function(require,module,exports){
module.exports = "<div>\n  <ul>\n    <li v-for=\"item in state.list\" @click=\"goto(item)\" style=\"cursor:pointer\">{{ item.display_name }}</li>\n  </ul>\n</div>\n";

},{}],54:[function(require,module,exports){
var GUI = require('g3w/gui/gui');
var MapService = require('g3w/core/mapservice');

var GeocodingListPanelComponent = Vue.extend({
  template: require('./listpanel.html'),
  methods: {
    goto: function(item){
      var x = parseFloat(item.lon);
      var y = parseFloat(item.lat);
      MapService.goToWGS84([x,y]);
      var geojson = item.geojson;
      MapService.highlightGeometry(geojson,4000,true);
      GUI.closeListing();
    }
  }
});

module.exports = GeocodingListPanelComponent;

},{"./listpanel.html":53,"g3w/core/mapservice":33,"g3w/gui/gui":55}],55:[function(require,module,exports){
noop = require('g3w/core/utils').noop;
var inherit = require('g3w/core/utils').inherit;
var G3WObject = require('g3w/core/g3wobject');

// rappresenta l'interfaccia globale dell'API della GUI. 
// metodi devono essere implementati (definiti) dall'applicazione ospite
// l'app ospite dovrebbe chiamare anche la funzione GUI.ready() quando la UI è pronta
function GUI(){
  // url delle risorse
  this.getResourcesUrl = noop;
  // show a Vue form
  this.showForm = noop;
  this.closeForm = noop;
  
  // mostra una lista di oggetti (es. lista di risultati)
  this.showListing = noop;
  this.closeListing = noop;
  this.hideListing = noop;

  this.showPanel = noop;
  
  this.ready = function(){
    this.emit('guiready');
  };
  
  this.guiResized = function(){
    this.emit('guiresized');
  };
  
  this.showSpinner = noop; // per mostrare un'icona spinner che notifica un caricamento dati in corso
  this.hideSpinner = noop;
  
  toastr.options.positionClass = 'toast-top-center';
  toastr.options.preventDuplicates = true;
  // proxy della libreria toastr
  this.notify = toastr;
  this.dialog = bootbox;
}
inherit(GUI,G3WObject);

module.exports = new GUI;

},{"g3w/core/g3wobject":28,"g3w/core/utils":40}],56:[function(require,module,exports){
module.exports = "<div>\n  Lista di oggetti\n</div>\n";

},{}],57:[function(require,module,exports){
var resolvedValue = require('g3w/core/utils').resolvedValue;
var rejectedValue = require('g3w/core/utils').rejectedValue;
var GUI = require('g3w/gui/gui');
var ProjectService = require('g3w/core/projectservice').ProjectService;
var MapService = require('g3w/core/mapservice');

var ListPanelComponent = Vue.extend({
  template: require('./listpanel.html'),
  methods: {
    exec: function(cbk){
      var relations = this.state.relations || null;
      cbk(this.state.fields,relations);
      GUI.closeForm();
    }
  }
});


function ListPanel(options){
  // proprietà necessarie. In futuro le mettermo in una classe Panel da cui deriveranno tutti i pannelli che vogliono essere mostrati nella sidebar
  this.panelComponent = null;
  this.options =  options || {};
  this.id = options.id || null; // id del form
  this.name = options.name || null; // nome del form
  
  this.state = {
    list: options.list || []
  }
  
  this._listPanelComponent = options.listPanelComponent || ListPanelComponent;
}

var proto = ListPanel.prototype;

// viene richiamato dalla toolbar quando il plugin chiede di mostrare un proprio pannello nella GUI (GUI.showPanel)
proto.onShow = function(container){
  var panel = this._setupPanel();
  this._mountPanel(panel,container);
  return resolvedValue(true);
};

// richiamato quando la GUI chiede di chiudere il pannello. Se ritorna false il pannello non viene chiuso
proto.onClose = function(){
  this.panelComponent.$destroy(true);
  this.panelComponent = null;
  return resolvedValue(true);
};

proto._setupPanel = function(){
  var panel = this.panelComponent = new this._listPanelComponent({
    panel: this
  });
  panel.state = this.state;
  return panel
};

proto._mountPanel = function(panel,container){
  panel.$mount().$appendTo(container);
};

module.exports = {
  ListPanelComponent: ListPanelComponent,
  ListPanel: ListPanel
}

},{"./listpanel.html":56,"g3w/core/mapservice":33,"g3w/core/projectservice":36,"g3w/core/utils":40,"g3w/gui/gui":55}],58:[function(require,module,exports){
module.exports = "<div id=\"map\" style=\"width:100%;height:100%\">\n</div>\n";

},{}],59:[function(require,module,exports){
var t = require('i18n/i18n.service').t;
var GUI = require('g3w/gui/gui.js');   
var RouterService = require('g3w/core/router');
var MapService = require('g3w/core/mapservice');
var ol3helpers = require('g3w-ol3/src/g3w.ol3').helpers;

function mainHeight(){
  //return $(window).innerHeight()-$(".navbar").innerHeight();
  //return $(window).innerHeight();
  var topHeight = $(".navbar").innerHeight();
  var bottomHeight = 0;
  
  if ($(".bottombar").is(":visible")) {
    bottomHeight = $(".bottombar").innerHeight()
  }
  return $(window).innerHeight() - topHeight - bottomHeight;
}

/* map resize calculations */
function setMapDivHeight(){
  var height = mainHeight();
  $("#map").height(height);
  MapService.viewer.map.updateSize();
}

function setMapDivWidth(){
  var offset = $(".main-sidebar").offset().left;
  var width = $(".main-sidebar").innerWidth();
  var sideBarSpace = width + offset;
  $("#map").width($(window).innerWidth() - sideBarSpace);
  MapService.viewer.map.updateSize();
}

var MapViewComponent = Vue.component('g3w-map',{
  template: require('./map.html'),
  ready: function(){
    var self = this;
    
    MapService.showViewer(this.$el.id);
    
    // questo serve per quando viene cambiato progetto/vista cartografica, in cui viene ricreato il viewer (e quindi la mappa)
    MapService.onafter('setupViewer',function(){
      MapService.showViewer(self.$el.id);
    });
    
    GUI.on('guiready',function(){
      setMapDivHeight();
      
      $('.main-sidebar').on('webkitTransitionEnd transitionend msTransitionEnd oTransitionEnd', function () {
          $(this).trigger('trans-end');
          setMapDivWidth();
      });
      
      var drawing = false;
      var resizeFired = false;
      
      GUI.on('guiresized',function(){
        resizeFired = true;
        drawResize();
      });
      
      $(window).resize(function() {
        // set resizedFired to true and execute drawResize if it's not already running
        if (drawing === false) {
            resizeFired = true;
            drawResize();
        }
      });

      function drawResize() {
        var height;
        // render friendly resize loop
        if (resizeFired === true) {
            resizeFired = false;
            drawing = true;
            setMapDivHeight();
            setMapDivWidth();
            requestAnimationFrame(drawResize);
        } else {
            drawing = false;
        }
      }
      
    })
  }
});

function MapView() {
  var self = this;
  var _viewComponent;
  
  this.getViewComponent = function(){
    if (!_viewComponent) {
      _viewComponent = new MapViewComponent;
    }
    return _viewComponent;
  };
  
  this.show = function(path){
    var view = RouterService.sliceFirst(path)[0];
    if (view == 'map') {
      var query = RouterService.getQueryParams(path);
      if (query['point']) {
        var coordinates = query['point'].split(',');
        if (coordinates.length == 2) {
          MapService.viewer.goToRes(coordinates,0.5);
          MapService.highlightGeometry(new ol.geom.Point(coordinates),10000);
        }
      }
    }
  };
  
  RouterService.onafter('setRoute',function(path){
    self.show(path);
  });
}

module.exports = new MapView;

},{"./map.html":58,"g3w-ol3/src/g3w.ol3":20,"g3w/core/mapservice":33,"g3w/core/router":38,"g3w/gui/gui.js":55,"i18n/i18n.service":68}],60:[function(require,module,exports){
module.exports = "<li>\n<form role=\"form\">\n  <div class=\"box-body\">\n    <div class=\"form-group\">\n      <label for=\"exampleInputEmail1\" style=\"color: white\">Email address</label>\n      <input type=\"email\" class=\"form-control\" id=\"exampleInputEmail1\" placeholder=\"\">\n    </div>\n    <div class=\"form-group\">\n      <button type=\"button\" class=\"btn btn-primary\">Ciao</button>\n    </div>\n  </div>\n</form>\n</li>";

},{}],61:[function(require,module,exports){
var t = require('i18n/i18n.service').t;

Vue.component('g3w-search',{
    template: require('./search.html'),
    data: function() {
    	return {
        	
        };
    },
    methods: {
    	
	}
});

},{"./search.html":60,"i18n/i18n.service":68}],62:[function(require,module,exports){
module.exports = "<div class=\"g3w-tools\">\n  <ul>\n    <li v-for=\"tool in tools\">\n      <div data-toggle=\"collapse\" data-target=\"#iternet-tools\" class=\"tool-header\">\n        <span style=\"\">{{ tool.name }}</span>\n      </div>\n      <div id=\"iternet-tools\" class=\"tool-box collapse\">\n        <template v-for=\"action in tool.actions\">\n          <i class=\"glyphicon glyphicon-cog\"></i>\n          <span @click=\"fireAction(action.id)\">{{ action.name }}</span>\n        </template>\n      </div>\n    </li>\n  </ul>\n</div>\n";

},{}],63:[function(require,module,exports){
var t = require('i18n/i18n.service').t;
var ToolsService = require('g3w/core/toolsservice');

Vue.component('g3w-tools',{
    template: require('./tools.html'),
    data: function() {
      return {
        tools: ToolsService.state.tools
      }
    },
    methods: {
      fireAction: function(actionid){
        ToolsService.fireAction(actionid);
      }
    }
});

},{"./tools.html":62,"g3w/core/toolsservice":39,"i18n/i18n.service":68}],64:[function(require,module,exports){
module.exports = "<div id=\"viewport\" class=\"viewport\"></div>\n";

},{}],65:[function(require,module,exports){
Vue.component('viewport',{
  template: require('./viewport.html')
});

var ViewportService = function(){
  var containerSelector = '#viewport';
  this.init = function(config){
  };
  
  this.setView = function(view){
    view.$mount().$appendTo(containerSelector);
  }
}

module.exports = new ViewportService;

},{"./viewport.html":64}],66:[function(require,module,exports){
Vue.directive("disabled",function(value){
    if (value){
      this.el.setAttribute('disabled','disabled');
    }
    else {
      this.el.removeAttribute('disabled');
    }
  }
);

Vue.directive("checked",function(value){
    if (value){
      this.el.setAttribute('checked','checked');
    }
    else {
      this.el.removeAttribute('checked');
    }
  }
);

Vue.directive("selected-first",function(value){
    if (value==0){
      this.el.setAttribute('selected','');
    }
    else {
      this.el.removeAttribute('selected');
    }
  }
);

},{}],67:[function(require,module,exports){
var isMobileMixin = {
  methods: {
    isMobile: function(){return isMobile.any}
  }
}

module.exports = {
  isMobileMixin: isMobileMixin
};

},{}],68:[function(require,module,exports){
function init(config) {
  i18next
  .use(i18nextXHRBackend)
  .init({ 
      lng: 'it',
      ns: 'app',
      fallbackLng: 'it',
      resources: config.resources
  });
  
  jqueryI18next.init(i18next, $, {
    tName: 't', // --> appends $.t = i18next.t
    i18nName: 'i18n', // --> appends $.i18n = i18next
    handleName: 'localize', // --> appends $(selector).localize(opts);
    selectorAttr: 'data-i18n', // selector for translating elements
    targetAttr: 'data-i18n-target', // element attribute to grab target element to translate (if diffrent then itself)
    optionsAttr: 'data-i18n-options', // element attribute that contains options, will load/set if useOptionsAttr = true
    useOptionsAttr: false, // see optionsAttr
    parseDefaultValueFromContent: true // parses default values from content ele.val or ele.text
  });
}
    
var t = function(text){
    var trad = i18next.t(text);
    return trad;
};
    
module.exports = {
  init: init,
  t: t
}

},{}],69:[function(require,module,exports){
var inherit = require('g3w/core/utils').inherit;
var G3WObject = require('g3w/core/g3wobject');

function EditBuffer(editor){
  this._editor = editor;
  
  this._origVectorLayer = new ol.layer.Vector({
    source: new ol.source.Vector()
  });
  this._cloneLayer();
  
  //buffer delle geometrie
  this._geometriesBuffer = {};
  
  // buffer degli attributi
  this._attributesBuffer = {};
  
  // buffer degli attributi delle relazioni
  this._relationsAttributesBuffer = {};
}
inherit(EditBuffer,G3WObject);
module.exports = EditBuffer;

var proto = EditBuffer.prototype;

proto.commit = function(){
  var newFeatures = this._editor.getEditVectorLayer().getFeatures();
  this._editor.getVectorLayer().addFeatures(newFeatures);
  this._editor.getEditVectorLayer().clear();
  this._clearBuffers();
  this._cloneLayer();
};

proto.undoAll = function(){
  this._resetVectorLayer();
  this._clearBuffers();
};

proto.destroy = function(){
  this._clearBuffers();
};

proto.generateId = function(){
  return this._editor.generateId();
};

proto.addFeature = function(feature){
  if(!feature.getId()){
    feature.setId(this.generateId());
  }
  this._addEditToGeometryBuffer(feature,'add');
  console.log("Inserita nuova feature: (ID: "+feature.getId()+" "+feature.getGeometry().getCoordinates()+") nel buffer");
};

proto.updateFeature = function(feature){
  this._addEditToGeometryBuffer(feature,'update');
  console.log("Modificata feature: (ID: "+feature.getId()+" "+feature.getGeometry().getCoordinates()+") nel buffer");
};

proto.deleteFeature = function(feature){
  this._addEditToGeometryBuffer(feature,'delete');
  console.log("Rimossa feature: (ID: "+feature.getId()+" "+feature.getGeometry().getCoordinates()+") nel buffer");
};

proto.updateAttributes = function(feature,relationsAttributes){
  if(!feature.getId()){
    feature.setId(this.generateId());
  }
  this._addEditToAttributesBuffer(feature,relationsAttributes);
  console.log("Modificati attributi feature: (ID: "+feature.getId()+")");
};

proto.getFeatureAttributes = function(fid){
  if(this._attributesBuffer[fid]){
    return this._attributesBuffer[fid].slice(-1)[0];
  }
  return null;
};

proto.areFeatureAttributesEdited = function(fid){
  if (this._attributesBuffer[fid]){
    return this._attributesBuffer[fid].length > -1;
  }
  return false;
};

proto.getRelationsAttributes = function(fid){
  return this._relationsAttributesBuffer[fid].slice(-1)[0];
};

proto.areFeatureRelationsEdited = function(fid){
  if (this._relationsAttributesBuffer[fid]){
    return this._relationsAttributesBuffer[fid].length > -1;
  }
  return false;
};

proto.collectFeatureIds = function(){
  var geometriesBuffers = this._geometriesBuffer;
  var attributesBuffers = this._attributesBuffer;
  
  var modifiedFids = [];

  modifiedFids = _.concat(modifiedFids,_.keys(geometriesBuffers));
  modifiedFids = _.concat(modifiedFids,_.keys(attributesBuffers));
  
  return _.uniq(modifiedFids);
};

proto.collectFeatures = function(state,asGeoJSON){
  var self = this;
  var geometriesBuffers = this._geometriesBuffer;
  var attributesBuffers = this._attributesBuffer;
  var asGeoJSON = asGeoJSON || false;
  var GeoJSONFormat = new ol.format.GeoJSON();
  
  var modifiedFids = this.collectFeatureIds();
  
  var layer;
  if (state == 'new') {
    layer = self._editor.getEditVectorLayer();
  }
  else {
    layer = self._editor.getVectorLayer();
  }
  
  var features = [];
  _.forEach(modifiedFids,function(fid){
    
    var feature = layer.getFeatureById(fid);
    var isNew = self._isNewFeature(fid);
    var addedFeature = (state == 'new' && isNew && feature);
    var updatedFeature = (state == 'updated' && !isNew && feature);
    var deletedFeature = (state == 'deleted' && !isNew && !feature);
    
    if (addedFeature || updatedFeature){
      if (asGeoJSON){
        feature = GeoJSONFormat.writeFeatureObject(feature);
      }
      features.push(feature);
    }
    else if (deletedFeature) {
      features.push(fid);
    }
  });
  return features;
};

proto.createFeature = function(fid,geometry,attributes){
  var feature = new ol.Feature();
  feature.setId(fid);
  feature.setGeometry(geometry);
  feature.setProperties(attributes);
  return feature;
};

proto.collectRelationsAttributes = function(){
  var relationsAttributes = {};
  _.forEach(this._relationsAttributesBuffer,function(relationsBuffer,fid){
    lastRelationsAttributes = relationsBuffer[relationsBuffer.length-1];
    relationsAttributes[fid] = lastRelationsAttributes;
  })
  return relationsAttributes;
};

proto._addEditToGeometryBuffer = function(feature,operation){
  var geometriesBuffer = this._geometriesBuffer;
  
  var id = feature.getId();
  var geometry = feature.getGeometry();
  
  if (operation == 'delete'){
      geometry = null;
      var layer = this._isNewFeature(id) ? this._editor._editVectorLayer : this._editor._vectorLayer;
      layer.getSource().removeFeature(feature);
  } 
  
  if (!_.has(geometriesBuffer,id)){
    geometriesBuffer[id] = [];
  }
  geometriesBuffer[id].push(geometry);
  this._setDirty();
};

proto._addEditToAttributesBuffer = function(feature,relationsAttributes){
  var fid = feature.getId();
  var attributes = feature.getProperties();
  var attributesBuffer = this._attributesBuffer;

  if (!_.has(attributesBuffer,fid)){
    attributesBuffer[fid] = [];
  }
  attributesBuffer[fid].push(attributes);
  
  if (relationsAttributes){
    if (!_.has(this._relationsAttributesBuffer,fid)){
    this._relationsAttributesBuffer[fid] = [];
  }
    this._relationsAttributesBuffer[fid].push(relationsAttributes);
  }
  this._setDirty();
};

// guardo se è una feature già presente nel buffer delle nuove geometrie
proto._isNewFeature = function(fid){
  //return id.toString().indexOf('_new_') > -1;
  return this._editor.isNewFeature(fid);
};

proto._setDirty = function(){
  this._editor._setDirty();
};

proto._resetVectorLayer = function(){
  this._editor.vectoLayer = this._origVectorLayer;
  this._origVectorLayer.getSource().clear();
};

proto._clearBuffers = function(){
  this._geometriesBuffer = {};
  this._attributesBuffer = {};
  this._relationsAttributesBuffer = {};
  this._editor._setDirty(false);
};

proto._cloneLayer = function(){
  var clonedFeatures = [];
  this._editor._vectorLayer.getSource().forEachFeature(function(feature){
    clonedFeatures.push(feature.clone());
  },this);
  this._origVectorLayer.getSource().addFeatures(clonedFeatures);
};

},{"g3w/core/g3wobject":28,"g3w/core/utils":40}],70:[function(require,module,exports){
var inherit = require('g3w/core/utils').inherit;
var base = require('g3w/core/utils').base;
var resolvedValue = require('g3w/core/utils').resolvedValue;
var rejectedValue = require('g3w/core/utils').rejectedValue;
var G3WObject = require('g3w/core/g3wobject');
var MapService = require('g3w/core/mapservice');
var VectorLayer = require('g3w/core/vectorlayer');

//var Sequencer = require('./stepsequencer');
var AddFeatureTool = require('./tools/addfeaturetool');
var MoveFeatureTool = require('./tools/movepointtool');
var ModifyFeatureTool = require('./tools/modifyfeaturetool');
var DeleteFeatureTool = require('./tools/deletefeaturetool');
var PickFeatureTool = require('./tools/pickfeaturetool');
var CutLineTool = require('./tools/cutlinetool');
var EditBuffer = require('./editbuffer');

var EditorGeometryTypes = [
  'Point',
  //'MultiPoint',
  'LineString',
  'MultiLineString',
  //'Polygon',
  //'MultiPolygon'
];

// Editor di vettori puntuali
function Editor(options){
  this._vectorLayer = null;
  this._editVectorLayer = null;
  this._editBuffer = null;
  this._activeTool = null;
  this._dirty = false;
  this._newPrefix = '_new_';
  
  this._withFeatureLocks = false;
  this._featureLocks = null;
  
  this._started = false;
  
  this._setterslisteners = {
      before: {},
      after: {}
  };
  this._geometrytypes = [
    'Point',
    //'MultiPoint',
    'LineString',
    'MultiLineString',
    //'Polygon',
    //'MultiPolygon'
  ];
  
  // elenco dei tool e delle relative classi per tipo di geometria (in base a vector.geometrytype)
  this._toolsForGeometryTypes = {
      'Point': {
        addfeature: AddFeatureTool,
        movefeature: MoveFeatureTool,
        deletefeature: DeleteFeatureTool,
        editattributes: PickFeatureTool
      },
      'LineString': {
        addfeature: AddFeatureTool,
        modifyvertex: ModifyFeatureTool,
        movefeature: MoveFeatureTool,
        deletefeature: DeleteFeatureTool,
        editattributes: PickFeatureTool,
        cutline: CutLineTool
      }
  };
  
  this._activeTool = new function(){
    this.type = null;
    this.instance = null;
    
    this.setTool = function(type,instance){
      this.type = type;
      this.instance = instance;
    };
    
    this.getType = function(){
      return this.type;
    };
    
    this.getTool = function(){
      return this.instance;
    };
    
    this.clear = function(){
      this.type = null;
      this.instance = null;
    };
  }
  
  this._tools = {};
  
  base(this);
}
inherit(Editor,G3WObject);
module.exports = Editor;

var proto = Editor.prototype;

// associa l'oggetto VectorLayer su cui si vuole fare l'editing
proto.setVectorLayer = function(vectorLayer){
  var geometrytype = vectorLayer.geometrytype;
  if (!geometrytype || ! this._isCompatibleType(geometrytype)){
    throw Error("Vector geometry type "+geometrytype+" is not valid for editing");
  }
  this._setToolsForVectorType(geometrytype);
  this._vectorLayer = vectorLayer;
};

// avvia la sessione di editazione con un determinato tool (es. addfeature)
proto.start = function(){
  // TODO: aggiungere notifica nel caso questo if non si verifichi
  var res = false;
  // se è stato settato il vectorLayer
  if (this._vectorLayer){
    // nel caso non sia già avviato prima lo stoppo;
    this.stop();
    
    // istanzio l'editVectorLayer
    this._editVectorLayer = new VectorLayer({
      name: "editvector",
      geometrytype: this._vectorLayer.geometrytype,
    })
    MapService.viewer.map.addLayer(this._editVectorLayer.getLayer());
    
    // istanzio l'EditBuffer
    this._editBuffer = new EditBuffer(this);
    this._setStarted(true);
    res = true;
  }
  return res;
};

// termina l'editazione
proto.stop = function(){
  if (this.isStarted()){
    if (this.stopTool()) {
      this._editBuffer.destroy();
      this._editBuffer = null;
      this.removeAllListeners();
      MapService.viewer.removeLayerByName(this._editVectorLayer.name);
      this._setStarted(false);
      return true;
    }
    return false;
  }
  return true;
};

proto.setTool = function(toolType,options){
  if (!this.stopTool()){
    return false;
  }
  var toolClass = this._tools[toolType];
  
  // se esiste il tool richiesto
  if (toolClass ){
    var toolInstance = new toolClass(this,options);
    this._activeTool.setTool(toolType,toolInstance);
    this._setToolSettersListeners(toolInstance,this._setterslisteners);
    toolInstance.run();
    return true;
  }
};

proto.stopTool = function(){
  if (this._activeTool.instance && !this._activeTool.instance.stop()){
    return false;
  }
  this._activeTool.clear();
  return true;
};

proto.getActiveTool = function(){
  return this._activeTool;
};

proto.isStarted = function(){
  return this._started;
};

proto.hasActiveTool = function(){
  return !_.isNull(this._activeTool.instance);
};

proto.isToolActive = function(toolType){
   if (this._activeTool.toolType){
    return this._activeTool.toolType == toolType;
   };
   return false;
};

proto.generateId = function(){
  return this._editBuffer.generateId();
};

proto.commit = function(newFeatures){
  this._editBuffer.commit(newFeatures);
};

proto.undoAll = function(){
  this._editBuffer.undoAll();
};

proto.setFeatureLocks = function(featureLocks){
  this._withFeatureLocks = true;
  this._featureLocks = featureLocks;
};

proto.getFeatureLocks = function(featureLocks){
  return this._featureLocks;
};

proto.getFeatureLockIds = function(){
  return _.map(this._featureLocks,function(featurelock){
    return featurelock.lockid;
  });
};

proto.getFeatureLocksLockIds = function(featureLocks){
  var featureLocks = featureLocks || this._featureLocks;
  return _.map(featureLocks,function(featurelock){
    return featurelock.lockid;
  });
};

proto.getFeatureLocksFeatureIds = function(featureLocks){
  var featureLocks = featureLocks || this._featureLocks;
  return _.map(featureLocks,function(featurelock){
    return featurelock.featureid;
  });
};

proto.getFeatureLockIdsForFeatureIds = function(fids){
  var featurelocksForFids = _.filter(this._featureLocks,function(featurelock){
    return _.includes(fids,featurelock.featureid);
  });
  
  return this.getFeatureLocksLockIds(featurelocksForFids);
};

proto.getEditedFeatures = function(){
  var modifiedFids = this._editBuffer.collectFeatureIds();
  var lockIds = this.getFeatureLockIdsForFeatureIds(modifiedFids);
  return {
    add: this._editBuffer.collectFeatures('new',true),
    update: this._editBuffer.collectFeatures('updated',true),
    delete: this._editBuffer.collectFeatures('deleted',true),
    relationsattributes: this._editBuffer.collectRelationsAttributes(),
    lockids: lockIds
  }
};

proto.setFieldsWithAttributes = function(feature,fields,relations){
  var attributes = {};
  _.forEach(fields,function(field){
    attributes[field.name] = field.value;
  });
  
  var relationsAttributes = null;
  if (relations){
    var relationsAttributes = {};
    _.forEach(relations,function(relation,relationKey){
      var attributes = {};
      _.forEach(relation.fields,function(field){
        attributes[field.name] = field.value;
      });
      relationsAttributes[relationKey] = attributes;
    });
  }
  feature.setProperties(attributes);
  this._editBuffer.updateAttributes(feature,relationsAttributes);
};

proto.setAttributes = function(feature,attributes){
  feature.setProperties(attributes);
  this._editBuffer.updateAttributes(feature);
};

proto.getRelationsWithAttributes = function(feature){
  var fid = feature.getId();
  if (this._vectorLayer.hasRelations()){
    var fieldsPromise;
    // se non ha fid vuol dire che è nuovo e senza attributi, quindi prendo i fields vuoti
    if (!fid){
      fieldsPromise = this._vectorLayer.getRelationsWithAttributes();
    }
    // se per caso ha un fid ma è un vettoriale nuovo
    else if (!this._vectorLayer.getFeatureById(fid)){
      // se questa feature, ancora non presente nel vectorLayer, ha comunque i valori delle FKs popolate, allora le estraggo
      if (this._vectorLayer.featureHasRelationsFksWithValues(feature)){
        var fks = this._vectorLayer.getRelationsFksWithValuesForFeature(feature);
        fieldsPromise = this._vectorLayer.getRelationsWithAttributesFromFks(fks);
      }
      // altrimenti prendo i fields vuoti
      else {
        fieldsPromise = this._vectorLayer.getRelationsWithAttributes();
      }
    }
    // se invece è un vettoriale preesistente controllo intanto se ha dati delle relazioni già editati
    else {    
      var hasEdits = this._editBuffer.areFeatureRelationsEdited(fid);
      if (hasEdits){
        var relations = this._vectorLayer.getRelations();
        var relationsAttributes = this._editBuffer.getRelationsAttributes(fid);
        _.forEach(relationsAttributes,function(relation,relationKey){
          _.forEach(relations[relationKey].fields,function(field){
            field.value = relationsAttributes[relationKey][field.name];
          });
        });
        
        fieldsPromise = resolvedValue(relations);
      }
      // se non ce li ha vuol dire che devo caricare i dati delle relazioni da remoto
      else {
        fieldsPromise = this._vectorLayer.getRelationsWithAttributes(fid);
      }
    }
  }
  else {
    fieldsPromise = resolvedValue(null);
  }
  return fieldsPromise;
};

proto.getField = function(name,fields){
  var fields = fields || this.getVectorLayer().getFieldsWithAttributes();
  var field = null;
  _.forEach(fields,function(f){
    if (f.name == name){
      field = f;
    }
  })
  return field;
};

proto.isDirty = function(){
  return this._dirty;
};

proto.onafter = function(setter,listener){
  this._onaftertoolaction(setter,listener);
};

// permette di inserire un setter listener sincrono prima che venga effettuata una operazione da un tool (es. addfeature)
proto.onbefore = function(setter,listener){
  this._onbeforetoolaction(setter,listener,false);
};

// come onbefore() ma per listener asincroni
proto.onbeforeasync = function(setter,listener){
  this._onbeforetoolaction(setter,listener,true);
};

proto.addFeature = function(feature){
  this._editBuffer.addFeature(feature);
};

proto.updateFeature = function(feature){
  this._editBuffer.updateFeature(feature);
};

proto.deleteFeature = function(feature){
  this._editBuffer.deleteFeature(feature);
};

proto.getVectorLayer = function(){
  return this._vectorLayer;
};

proto.getEditVectorLayer = function(){
  return this._editVectorLayer;
};

proto.generateId = function(){
  return this._newPrefix+Date.now();
};

proto.isNewFeature = function(fid){
  if (fid) {
    return fid.toString().indexOf(this._newPrefix) == 0;
  }
  return true;
};

/*proto.isNewFeature = function(fid){
  if (fid) {
    if(!this.getVectorLayer().getFeatureById(fid)){
      return true;
    }
    return false;
  }
  else {
    return true
  }
};*/

proto._isCompatibleType = function(geometrytype){
  return this._geometrytypes.indexOf(geometrytype) > -1;
};

proto._setToolsForVectorType = function(geometrytype){
  var self = this;
  var tools = this._toolsForGeometryTypes[geometrytype];
  _.forEach(tools,function(toolClass,tool){
    self._tools[tool] = toolClass;
  })
};

proto._onaftertoolaction = function(setter,listener){
  if (!_.get(this._setterslisteners.after,setter)){
    this._setterslisteners.after[setter] = [];
  }
  this._setterslisteners.after[setter].push({
    fnc: listener
  });
}

proto._onbeforetoolaction = function(setter,listener,async){
  if (!_.get(this._setterslisteners.before,setter)){
    this._setterslisteners.before[setter] = [];
  }
  this._setterslisteners.before[setter].push({
    fnc: listener,
    how: async ? 'async' : 'sync'
  });
}

// una volta istanziato il tool aggiungo a questo tutti i listener definiti a livello di editor
proto._setToolSettersListeners = function(tool,settersListeners){
  _.forEach(settersListeners.before,function(listeners,setter){
    if (_.hasIn(tool.setters,setter)){
      _.forEach(listeners,function(listener){
        if (listener.how == 'sync'){
          tool.onbefore(setter,listener.fnc);
        }
        else {
          tool.onbeforeasync(setter,listener.fnc);
        }
      })
    }
  });
  
  _.forEach(settersListeners.after,function(listeners,setter){
    if (_.hasIn(tool.setters,setter)){
      _.forEach(listeners,function(listener){
          tool.onafter(setter,listener.fnc);
      })
    }
  })
};

proto._setStarted = function(bool){
  this._started = bool;
};

proto._setDirty = function(bool){
  if (_.isNil(bool)){
    this._dirty = true;
  }
  else {
    this._dirty = bool;
  }
  this.emit("dirty",this._dirty);
};

},{"./editbuffer":69,"./tools/addfeaturetool":71,"./tools/cutlinetool":72,"./tools/deletefeaturetool":74,"./tools/modifyfeaturetool":75,"./tools/movepointtool":76,"./tools/pickfeaturetool":77,"g3w/core/g3wobject":28,"g3w/core/mapservice":33,"g3w/core/utils":40,"g3w/core/vectorlayer":41}],71:[function(require,module,exports){
var inherit = require('g3w/core/utils').inherit;
var base = require('g3w/core/utils').base;
var G3WObject = require('g3w/core/g3wobject');

var MapService = require('g3w/core/mapservice');

function AddFeatureTool(editor,options){
  var self = this;
  var options = options || {};
  this._running = false;
  this._busy = false;
  this.editor = editor;
  this.source = editor.getEditVectorLayer().getLayer().getSource();
  this.isPausable = true;
  
  this.drawInteraction = null;
  this._snap = options.snap || null;
  this._snapInteraction = null; 
  
  this._finishCondition = options.finishCondition || _.constant(true);
  
  this._condition = options.condition || _.constant(true);
  
  // qui si definiscono i metodi che vogliamo poter intercettare, ed eventualmente bloccare (vedi API G3WObject)
  this.setters = {
    addFeature: {
      fnc: AddFeatureTool.prototype._addFeature,
      fallback: AddFeatureTool.prototype._fallBack
    }
  };
  
  base(this);
}
inherit(AddFeatureTool,G3WObject);
module.exports = AddFeatureTool;

var proto = AddFeatureTool.prototype;

// metodo eseguito all'avvio del tool
proto.run = function(){
  var self = this;
  var map = MapService.viewer.map;
  
  this.drawInteraction = new ol.interaction.Draw({
    type: this.editor.getEditVectorLayer().geometrytype,
    source: this.source,
    condition: this._condition,
    finishCondition: this._finishCondition // disponibile da https://github.com/openlayers/ol3/commit/d425f75bea05cb77559923e494f54156c6690c0b
  });
  map.addInteraction(this.drawInteraction);
  this.drawInteraction.setActive(true);
  
  this.drawInteraction.on('drawstart',function(e){
    self.editor.emit('drawstart',e);
  });
  
  this.drawInteraction.on('drawend',function(e){
    self.editor.emit('drawend',e);
    if (!self._busy){
      self._busy = true;
      self.pause();
      self.addFeature(e.feature);
    }
  });
  
  if (this._snap){
    this._snapInteraction = new ol.interaction.Snap({
      source: this._snap.vectorLayer.getSource()
    });
    map.addInteraction(this._snapInteraction);
  }
};

proto.pause = function(pause){
  if (_.isUndefined(pause) || pause){
    if (this._snapInteraction){
      this._snapInteraction.setActive(false);
    }
    this.drawInteraction.setActive(false);
  }
  else {
    if (this._snapInteraction){
      this._snapInteraction.setActive(true);
    }
    this.drawInteraction.setActive(true);
  }
};

// metodo eseguito alla disattivazione del tool
proto.stop = function(){
  var map = MapService.viewer.map;
  if (this._snapInteraction){
     map.removeInteraction(this._snapInteraction);
     this._snapInteraction = null;
  }
  map.removeInteraction(this.drawInteraction);
  this.drawInteraction = null;
  return true;
};

proto.removeLastPoint = function(){
  if (this.drawInteraction){
    // provo a rimuovere l'ultimo punto. Nel caso non esista la geometria gestisco silenziosamente l'errore
    try{
      this.drawInteraction.removeLastPoint();
    }
    catch (e){
      //
    }
  }
};

proto._addFeature = function(feature){
  // aggiungo la geometria nell'edit buffer
  this.editor.addFeature(feature);
  this._busy = false;
  this.pause(false);
  return true;
};

proto._fallBack = function(feature){
  this._busy = false;
  // rimuovo l'ultima feature inserita, ovvero quella disegnata ma che non si vuole salvare
  this.source.getFeaturesCollection().pop();
  this.pause(false);
};

},{"g3w/core/g3wobject":28,"g3w/core/mapservice":33,"g3w/core/utils":40}],72:[function(require,module,exports){
var inherit = require('g3w/core/utils').inherit;
var base = require('g3w/core/utils').base;
var geom = require('g3w/core/geom');
var MapService = require('g3w/core/mapservice');
var PickFeatureInteraction = require('g3w-ol3/src/interactions/pickfeatureinteraction');
var PickCoordinatesInteraction = require('g3w-ol3/src/interactions/pickcoordinatesinteraction');

var EditingTool = require('./tool');



function CutLineTool(editor,options){
  this.setters = {
    cutLine: CutLineTool.prototype._cutLine
  };
  
  base(this,editor,options);
  
  var self = this;
  this.isPausable = true;
  this.steps = new EditingTool.Steps(CutLineTool.steps);
  
  this._origFeature = null;
  this._origGeometry = null;
  this._newFeatures = [];
  this._linePickInteraction = null;
  this._pointPickInteraction = null;
  this._selectLineToKeepInteraction = null;
  this._pointLayer = options.pointLayer || null;
  this._minCutPointDistance = options.minCutPointDistance || Infinity;
  this._modType = options.modType || 'MODONCUT'; // 'NEWONCUT' | 'MODONCUT'
  
  this._selectedLineOverlay = new ol.layer.Vector({
    source: new ol.source.Vector(),
    style: new ol.style.Style({
      stroke: new ol.style.Stroke({
        color: 'rgb(255,255,0)',
        width: 4
      })
    })
  });
  
  //var cutLineIdx = 0;
  //var cutLineColors = ['rgb(255,0,0)','rgb(0,0,255)']
  this._lineToKeepOverlay = new ol.layer.Vector({
    source: new ol.source.Vector(),
    /*style: function(feature){ 
      cutLineIdx += 1;
      return [new ol.style.Style({
        stroke: new ol.style.Stroke({
          color: cutLineColors[cutLineIdx%2],
          width: 4
        })
      })]
    }*/
  });

  
}
inherit(CutLineTool,EditingTool);
module.exports = CutLineTool;

var proto = CutLineTool.prototype;

proto.run = function(){
  var self = this;
  
  this._linePickInteraction = new PickFeatureInteraction({
    layers: [this.layer,this.editingLayer]
  });
  
  this.map.addInteraction(this._linePickInteraction);
  
  // seleziono la linea da tagliare
  self.steps.next();
  this._linePickInteraction.on('picked',function(e){
    var cutFeature;
    var feature = self._origFeature = e.feature;
    self._origGeometry = feature.getGeometry().clone();
    self._showSelection(self._origGeometry,300);
    self.map.removeInteraction(this);

    
    if (self._pointLayer){
      self._pointPickInteraction = new PickFeatureInteraction({
        layers: [self._pointLayer]
      });
    }
    else {
      self._pointPickInteraction = new PickCoordinatesInteraction();
    }
    
    // pesco coordinata o feature di taglio selezionata
    self.steps.next();
    self._pointPickInteraction.on('picked',function(e){
      self.map.removeInteraction(this);
      var coordinate;
      if (e.feature){
        cutFeature = e.feature;
        coordinate = cutFeature.getGeometry().getCoordinates();
      }
      else {
        coordinate = e.coordinate;
      }
      if (coordinate){
        // snappo sulla linea
        var closestCoordinate = feature.getGeometry().getClosestPoint(coordinate);
        var distance = geom.distance(coordinate,closestCoordinate);
        // se lo snap è entro la tolleranza
        if (distance < self._minCutPointDistance){
          // taglio la linea e ottengo l'array con le due nuove feature
          var slicedLines = self._cut(feature.getGeometry(),closestCoordinate);
          if (slicedLines){
            var prevLineFeature = slicedLines[0];
            var nextLineFeature = slicedLines[1];
            
            var newId = self.editor.generateId();
            prevLineFeature.setId(newId+'_1');
            nextLineFeature.setId(newId+'_2');
            
            // prendo le proprietà della feature originale (esclusa la geometria)
            var origProperties = feature.getProperties();
            delete origProperties[feature.getGeometryName()];
            
            self._showSelection(prevLineFeature.getGeometry(),300);
            setTimeout(function(){
              self._showSelection(nextLineFeature.getGeometry(),300);
            },300)
            
            // nel caso di modifica su taglio
            if (self._modType == 'MODONCUT'){
              // seleziono la porzione da mantenere/modificare
              self.steps.next();
              self._selectLineToKeep(prevLineFeature,nextLineFeature)
              .then(function(featureToKeep){
                // aggiorno la feature originale con la geometria della feature che si è selezionato da mantenere
                feature.setGeometry(featureToKeep.getGeometry().clone());
                
                var featureToAdd;
                
                // rimuovo una delle due nuove feature e mi tengo l'unica feature da aggiungere come nuova
                if (prevLineFeature.getId() == featureToKeep.getId()){
                  delete prevLineFeature;
                  featureToAdd = nextLineFeature;
                }
                else if (nextLineFeature.getId() == featureToKeep.getId()){
                  delete nextLineFeature;
                  featureToAdd = prevLineFeature;
                }
                
                self._newFeatures.push(featureToAdd);
                
                // tramite l'editor assegno alla nuova feature gli stessi attributi dell'altra, originale, modificata
                featureToAdd.setProperties(origProperties);
                // e la aggiungo al layer di editing, così mi viene mostrata come nuova feature sulla mappa
                self.editingLayer.getSource().addFeatures([featureToAdd]);
                
                var data = {
                  added: [featureToAdd],
                  updated: feature,
                  cutfeature:cutFeature
                }
                
                // a questo punto avvio il setter, che si occuperò di aggiornare l'editbuffer a seconda del tipo di modifica
                self.cutLine(data,self._modType)
                .fail(function(){
                  self._rollBack();
                  self.rerun();
                })
              })
            }
            else {
              // nel caso la modifica sia aggiungo su taglia, allora rimuovo l'originale e aggiungo le due nuove feature
              self.layer.getSource().removeFeature(feature);
              //self.editor.setAttributes(prevLineFeature,origProperties);
              //self.editor.setAttributes(nextLineFeature,origProperties);
              self._newFeatures.push(prevLineFeature);
              self._newFeatures.push(nextLineFeature);
              self.editingLayer.getSource().addFeatures([featureToAdd,prevLineFeature]);
              
              var data = {
                added: [prevLineFeature,nextLineFeature],
                removed: feature
              }
              
              self.cutLine(data,self._modType)
              .fail(function(){
                self._rollBack();
                self.rerun();
              })
            }
          }
          else {
            self.rerun();
          }
        }
      }
    })
    self.map.addInteraction(self._pointPickInteraction);
  });
};

proto.pause = function(pause){
  if (_.isUndefined(pause) || pause){
    this._linePickInteraction.setActive(false);
    this._pointPickInteraction.setActive(false);
  }
  else {
    this._linePickInteraction.setActive(true);
    this._pointPickInteraction.setActive(true);
  }
};

proto.rerun = function(){
  this.stop();
  this.run();
};

proto.stop = function(){
  this._cleanUp();
  
  var stop = EditingTool.prototype.stop.call(this);
  
  if (stop) {
    this.map.removeInteraction(this._linePickInteraction);
    this.map.removeInteraction(this._pointPickInteraction);
    this._linePickInteraction = null;
    this._pointPickInteraction = null;
  }

  return stop;
};

proto._cleanUp = function(){
  this._origFeature = null;
  this._origGeometry = null;
  this._newFeatures = [];
  this._lineToKeepOverlay.setMap(null);
  this._selectedLineOverlay.setMap(null);
};

proto._rollBack = function(){
  // rimetto la vecchia geometria
  this._origFeature.setGeometry(this._origGeometry);
  // rimuovo le feature (nuove) editate dal layer di editazione
  try {
    _.forEach(this._newFeatures,function(feature){
      self.editingLayer.getSource().removeFeature(feature);
    });
  }
  catch (e) {};
};

proto._cutLine = function(data,modType){
  // se modifico su taglio aggiorno la vecchia feature e aggiungo la nuova
  if (modType == 'MODONCUT'){
    var featureToUpdate = data.updated;
    var featureToAdd = data.added[0];
    this.editor.updateFeature(featureToUpdate);
    this.editor.addFeature(featureToAdd);
  }
  // altrimenti rimuovo la vecchia e aggiungo le nuove
  else{
    var featureToRemove = data.removed;
    var featureToAdd1 = data.added[0];
    var featureToAdd2 = data.added[1];
    this.editor.deleteFeature(featureToRemove);
    this.editor.addFeature(featureToAdd1);
    this.editor.addFeature(featureToAdd2);
  }
  this._busy = false;
  this.pause(false);
  this.steps.completed();
  this.rerun();
  return true;
};

proto._selectLineToKeep = function(prevLineFeature,nextLineFeature){
  var d = $.Deferred();
  var self = this;
  var layer = this._lineToKeepOverlay;
  layer.getSource().addFeatures([prevLineFeature,nextLineFeature]);
  layer.setMap(this.map);
  
  var selectLineInteraction = new PickFeatureInteraction({
    layers: [this._lineToKeepOverlay],
  });
  this.map.addInteraction(selectLineInteraction);
  
  selectLineInteraction.on('picked',function(e){
    layer.setMap(null);
    self.map.removeInteraction(this);
    d.resolve(e.feature);
  });
  
  return d.promise();
};

proto._fallBack = function(feature){
  this._busy = false;
  this.pause(false);
};

proto._cut = function(geometry,cutCoordinate){
  while (cutCoordinate.length < geometry.getStride()) {
    cutCoordinate.push(0);
  }

  var minDistance = Infinity;
  var closestIndex = 0;
  var index = 0;
  // cerco l'indice del segmento lineare su cui ricade la coordinata di taglio
  geometry.forEachSegment(function(v0,v1){
    var segmentPoint = geom.closestOnSegment(cutCoordinate,[v0,v1]);
    var distance = geom.distance(cutCoordinate,segmentPoint);
    if (distance < minDistance){
      minDistance = distance;
      closestIndex = index;
    }
    index += 1;
  })
  
  var coordinates = geometry.getCoordinates();
  // prendo la prima porzione di coordinate
  var prevCoords = coordinates.slice(0,closestIndex+1);
  // aggiungo la coordinata di taglio alla prima porzione
  prevCoords.splice(prevCoords.length,0,cutCoordinate);
  // prendo la seconda porzione di coordinate
  var nextCoords = coordinates.slice(closestIndex);
  // aggiungo la coordinata di taglio alla seconda porzione
  nextCoords.splice(0,1,cutCoordinate);
  
  if (prevCoords.length < 2 || nextCoords.length < 2){
    return false;
  }
  
  // creo le geometrie
  var prevLine = new ol.geom.LineString();
  prevLine.setCoordinates(prevCoords);
  var nextLine = new ol.geom.LineString();
  nextLine.setCoordinates(nextCoords);
  
  // creo le nuove feature
  var prevLineFeat = new ol.Feature({
    geometry: prevLine
  });
  var nextLineFeat = new ol.Feature({
    geometry: nextLine
  });
  
  return [prevLineFeat,nextLineFeat];
};


// TODO questo andrà spostato dentro MapService o comunque in una libreria core
proto._showSelection = function(geometry,duration){
  var self = this;
  var duration = duration || null;
  var overlay = this._selectedLineOverlay;
  
  var feature = new ol.Feature();
  feature.setGeometry(geometry);
  overlay.getSource().addFeatures([feature]);
  overlay.setMap(this.map);
  if(duration){
    setTimeout(function(){
      overlay.setMap(null);
      self._selectedLineOverlay.getSource().clear();
    },duration);
  }
};

proto._isNew = function(feature){
  return (!_.isNil(this.editingLayer.getSource().getFeatureById(feature.getId())));
};

CutLineTool.steps = [
  {
    type: "selectline"
  },
  {
    type: "selectcutpoint"
  },
  {
    type: "selectparttokeep"
  }
]

},{"./tool":78,"g3w-ol3/src/interactions/pickcoordinatesinteraction":21,"g3w-ol3/src/interactions/pickfeatureinteraction":22,"g3w/core/geom":30,"g3w/core/mapservice":33,"g3w/core/utils":40}],73:[function(require,module,exports){
var DeleteInteractionEvent = function(type, features, coordinate) {

  this.type = type;
  this.features = features;
  this.coordinate = coordinate;
};

var DeleteInteraction = function(options) {
  ol.interaction.Pointer.call(this, {
    handleDownEvent: DeleteInteraction.handleDownEvent_,
    handleMoveEvent: DeleteInteraction.handleMoveEvent_,
    handleUpEvent: DeleteInteraction.handleUpEvent_,
    handleEvent: DeleteInteraction.handleEvent_,
  });

  this.previousCursor_ = undefined;
  this.lastCoordinate_ = null;
  this.features_ = options.features !== undefined ? options.features : null;
};
ol.inherits(DeleteInteraction, ol.interaction.Pointer);

DeleteInteraction.handleEvent_ = function(mapBrowserEvent) {
  if (mapBrowserEvent.type == 'keydown'){
    if(this.features_.getArray().length && mapBrowserEvent.originalEvent.keyCode == 46){
      this.dispatchEvent(
          new DeleteInteractionEvent(
              'deleteend', this.features_,
              event.coordinate));
      return true;
    }
  }
  else{
    return ol.interaction.Pointer.handleEvent.call(this,mapBrowserEvent);
  }
};

DeleteInteraction.handleDownEvent_ = function(event) {
  this.lastFeature_ = this.featuresAtPixel_(event.pixel, event.map);
  if (this.lastFeature_) {
    DeleteInteraction.handleMoveEvent_.call(this, event);
    this.dispatchEvent(
            new DeleteInteractionEvent(
                'deleteend', this.features_,
                event.coordinate));
    return true;
  }
  return false;
};

DeleteInteraction.handleMoveEvent_ = function(event) {
  var elem = event.map.getTargetElement();
  var intersectingFeature = event.map.forEachFeatureAtPixel(event.pixel,
      function(feature) {
        return feature;
      });

  if (intersectingFeature) {
    this.previousCursor_ = elem.style.cursor;

    elem.style.cursor =  'pointer';

  } else {
    elem.style.cursor = this.previousCursor_ !== undefined ?
        this.previousCursor_ : '';
    this.previousCursor_ = undefined;
  }
};

DeleteInteraction.prototype.featuresAtPixel_ = function(pixel, map) {
  var found = null;

  var intersectingFeature = map.forEachFeatureAtPixel(pixel,
      function(feature) {
        return feature;
      });

  if (this.features_ &&
     _.includes(this.features_.getArray(), intersectingFeature)) {
    found = intersectingFeature;
  }

  return found;
};

module.exports = DeleteInteraction;

},{}],74:[function(require,module,exports){
var inherit = require('g3w/core/utils').inherit;
var base = require('g3w/core/utils').base;
var G3WObject = require('g3w/core/g3wobject');
var MapService = require('g3w/core/mapservice');

var DeleteInteraction = require('./deletefeatureinteraction');

function DeleteFeatureTool(editor){
  var self = this;
  this.editor = editor;
  this.isPausable = true;
  this.drawInteraction = null;
  this.layer = null;
  this.editingLayer = null;

  this.setters = {
    deleteFeature: DeleteFeatureTool.prototype._deleteFeature
  };
  
  base(this);
}
inherit(DeleteFeatureTool,G3WObject);
module.exports = DeleteFeatureTool;

var proto = DeleteFeatureTool.prototype;

/* BRUTTISSIMO! Tocca ridefinire tutte le parti interne di OL3 non esposte dalle API */

ol.geom.GeometryType = {
  POINT: 'Point',
  LINE_STRING: 'LineString',
  LINEAR_RING: 'LinearRing',
  POLYGON: 'Polygon',
  MULTI_POINT: 'MultiPoint',
  MULTI_LINE_STRING: 'MultiLineString',
  MULTI_POLYGON: 'MultiPolygon',
  GEOMETRY_COLLECTION: 'GeometryCollection',
  CIRCLE: 'Circle'
};

var styles = {};
var white = [255, 255, 255, 1];
var blue = [0, 153, 255, 1];
var red = [255, 0, 0, 1];
var width = 3;
styles[ol.geom.GeometryType.POLYGON] = [
  new ol.style.Style({
    fill: new ol.style.Fill({
      color: [255, 255, 255, 0.5]
    })
  })
];
styles[ol.geom.GeometryType.MULTI_POLYGON] =
    styles[ol.geom.GeometryType.POLYGON];

styles[ol.geom.GeometryType.LINE_STRING] = [
  new ol.style.Style({
    stroke: new ol.style.Stroke({
      color: white,
      width: width + 2
    })
  }),
  new ol.style.Style({
    stroke: new ol.style.Stroke({
      color: red,
      width: width
    })
  })
];
styles[ol.geom.GeometryType.MULTI_LINE_STRING] =
    styles[ol.geom.GeometryType.LINE_STRING];

styles[ol.geom.GeometryType.CIRCLE] =
    styles[ol.geom.GeometryType.POLYGON].concat(
        styles[ol.geom.GeometryType.LINE_STRING]
    );


styles[ol.geom.GeometryType.POINT] = [
  new ol.style.Style({
    image: new ol.style.Circle({
      radius: width * 2,
      fill: new ol.style.Fill({
        color: red
      }),
      stroke: new ol.style.Stroke({
        color: white,
        width: width / 2
      })
    }),
    zIndex: Infinity
  })
];
styles[ol.geom.GeometryType.MULTI_POINT] =
    styles[ol.geom.GeometryType.POINT];

styles[ol.geom.GeometryType.GEOMETRY_COLLECTION] =
    styles[ol.geom.GeometryType.POLYGON].concat(
        styles[ol.geom.GeometryType.LINE_STRING],
        styles[ol.geom.GeometryType.POINT]
    );


styles[ol.geom.GeometryType.POLYGON] = _.concat(styles[ol.geom.GeometryType.POLYGON],styles[ol.geom.GeometryType.LINE_STRING]);
styles[ol.geom.GeometryType.GEOMETRY_COLLECTION] = _.concat(styles[ol.geom.GeometryType.GEOMETRY_COLLECTION],styles[ol.geom.GeometryType.LINE_STRING]);
    
/* FINE BRUTTISSIMO! */

proto.run = function(){
  var self = this;
  var map = MapService.viewer.map;
  this.layer = this.editor.getVectorLayer().getLayer();
  this.editingLayer = this.editor.getEditVectorLayer().getLayer();
  
  this._selectInteraction = new ol.interaction.Select({
    layers: [this.layer,this.editingLayer],
    condition: ol.events.condition.click,
    style: function(feature, resolution) {
      return styles[feature.getGeometry().getType()];
    }
  });
  map.addInteraction(this._selectInteraction);
  
  this._deleteInteraction = new DeleteInteraction({
    features: this._selectInteraction.getFeatures()
  });
  map.addInteraction(this._deleteInteraction);
  
  var origGeometry = null;
  
  /*this._selectInteraction.on('select',function(e){
    var feature = e.selected[0];
    origGeometry = feature.getGeometry();
  });*/
  
  this._deleteInteraction.on('deleteend',function(e){
    var feature = e.features.getArray()[0];
    var isNew = self._isNew(feature);
    //try {
      if (!self._busy){
        self._busy = true;
        self.pause(true);
        self.deleteFeature(feature,isNew)
        .always(function(){
          self._busy = false;
          self.pause(false);
        })
      }
    //}
    /*catch (error){
      console.log(error);
      feature.setGeometry(origGeometry);
    }*/
  });

};

proto.pause = function(pause){
  if (_.isUndefined(pause) || pause){
    this._selectInteraction.setActive(false);
    this._deleteInteraction.setActive(false);
  }
  else {
    this._selectInteraction.setActive(true);
    this._deleteInteraction.setActive(true);
  }
};

proto.stop = function(){
  var map = MapService.viewer.map;
  this._selectInteraction.getFeatures().clear();
  map.removeInteraction(this._selectInteraction);
  this._selectInteraction = null;
  map.removeInteraction(this._deleteInteraction);
  this._deleteInteraction = null;
  return true;
};

proto._deleteFeature = function(feature,isNew){
  this.editor.deleteFeature(feature,isNew);
  this._selectInteraction.getFeatures().clear();
  this._busy = false;
  this.pause(false);
  return true;
};

proto._fallBack = function(feature){
  this._busy = false;
  this.pause(false);
};

proto._isNew = function(feature){
  return (!_.isNil(this.editingLayer.getSource().getFeatureById(feature.getId())));
};

},{"./deletefeatureinteraction":73,"g3w/core/g3wobject":28,"g3w/core/mapservice":33,"g3w/core/utils":40}],75:[function(require,module,exports){
var inherit = require('g3w/core/utils').inherit;
var base = require('g3w/core/utils').base;
var G3WObject = require('g3w/core/g3wobject');
var MapService = require('g3w/core/mapservice');

function ModifyFeatureTool(editor,options){
  var self = this;
  this.editor = editor;
  this.isPausable = true;
  this.drawInteraction = null;
  this.layer = null;
  this.editingLayer = null;
  this._deleteCondition = options.deleteCondition || undefined;
  this._snap = options.snap || null;
  this._snapInteraction = null; 

  this.setters = {
    modifyFeature: ModifyFeatureTool.prototype._modifyFeature
  };
  
  base(this);
}
inherit(ModifyFeatureTool,G3WObject);
module.exports = ModifyFeatureTool;

var proto = ModifyFeatureTool.prototype;

proto.run = function(){
  var self = this;
  var map = MapService.viewer.map;
  this.layer = this.editor.getVectorLayer().getLayer();
  this.editingLayer = this.editor.getEditVectorLayer().getLayer();
  
  this._selectInteraction = new ol.interaction.Select({
    layers: [this.layer,this.editingLayer],
  });
  map.addInteraction(this._selectInteraction);
  
  this._modifyInteraction = new ol.interaction.Modify({
    features: this._selectInteraction.getFeatures(),
    deleteCondition: this._deleteCondition,
  });
  map.addInteraction(this._modifyInteraction);
  
  var origGeometry = null;
  
  this._modifyInteraction.on('modifystart',function(e){
    var feature = e.features.getArray()[0];
    origGeometry = feature.getGeometry().clone();
  });
  
  this._modifyInteraction.on('modifyend',function(e){
    var feature = e.features.getArray()[0];
    var isNew = self._isNew(feature);
    //try {
      if (!self._busy){
        self._busy = true;
        self.pause(true);
        self.modifyFeature(feature,isNew)
        .fail(function(){
          feature.setGeometry(origGeometry);
        })
        .always(function(){
          self._busy = false;
          self.pause(false);
        })
      }
    //}
    //catch (error){
    //  console.log(error);
    //  feature.setGeometry(origGeometry);
    //}
  });
  
  if (this._snap){
    this._snapInteraction = new ol.interaction.Snap({
      source: this._snap.vectorLayer.getSource()
    });
    map.addInteraction(this._snapInteraction);
  }
};

proto.pause = function(pause){
  if (_.isUndefined(pause) || pause){
    if (this._snapInteraction){
      this._snapInteraction.setActive(false);
    }
    this._selectInteraction.setActive(false);
    this._modifyInteraction.setActive(false);
  }
  else {
    if (this._snapInteraction){
      this._snapInteraction.setActive(true);
    }
    this._selectInteraction.setActive(true);
    this._modifyInteraction.setActive(true);
  }
};

proto.stop = function(){
  var map = MapService.viewer.map;
  this._selectInteraction.getFeatures().clear();
  if (this._snapInteraction){
     map.removeInteraction(this._snapInteraction);
     this._snapInteraction = null;
  }
  map.removeInteraction(this._selectInteraction);
  this._selectInteraction = null;
  map.removeInteraction(this._modifyInteraction);
  this._modifyInteraction = null;
  return true;
};

proto._modifyFeature = function(feature,isNew){
  // aggionro la geometria nel buffer di editing
  this.editor.updateFeature(feature,isNew);
  this._selectInteraction.getFeatures().clear();
  this._busy = false;
  this.pause(false);
  return true;
};

proto.removePoint = function(coordinate){
  if (this._modifyInteraction){
    // provo a rimuovere l'ultimo punto. Nel caso non esista la geometria gestisco silenziosamente l'errore
    try{
      this._modifyInteraction.removePoint();
    }
    catch (e){
      console.log(e);
    }
  }
};

proto._fallBack = function(feature){
  this._busy = false;
  this.pause(false);
};

proto._isNew = function(feature){
  return (!_.isNil(this.editingLayer.getSource().getFeatureById(feature.getId())));
};

},{"g3w/core/g3wobject":28,"g3w/core/mapservice":33,"g3w/core/utils":40}],76:[function(require,module,exports){
var inherit = require('g3w/core/utils').inherit;
var base = require('g3w/core/utils').base;
var G3WObject = require('g3w/core/g3wobject');

var MapService = require('g3w/core/mapservice');

function MoveFeatureTool(editor){
  var self = this;
  this.editor = editor;
  this.isPausable = true;
  this.drawInteraction = null;
  this.layer = null;
  this.editingLayer = null;
  
  this._origGeometry = null;

  this.setters = {
    moveFeature: {
      fnc: MoveFeatureTool.prototype._moveFeature,
      fallback: MoveFeatureTool.prototype._fallBack
    }
  };
  
  base(this);
}
inherit(MoveFeatureTool,G3WObject);
module.exports = MoveFeatureTool;

var proto = MoveFeatureTool.prototype;

proto.run = function(){
  var self = this;
  var map = MapService.viewer.map;
  this.layer = this.editor.getVectorLayer().getLayer();
  this.editingLayer = this.editor.getEditVectorLayer().getLayer();
  
  this._selectInteraction = new ol.interaction.Select({
    layers: [this.layer,this.editingLayer],
    condition: ol.events.condition.click
  });
  map.addInteraction(this._selectInteraction);
  
  this._translateInteraction = new ol.interaction.Translate({
    features: this._selectInteraction.getFeatures()
  });
  map.addInteraction(this._translateInteraction);
  
  this._translateInteraction.on('translatestart',function(e){
    var feature = e.features.getArray()[0];
    self._origGeometry = feature.getGeometry().clone();
    self.editor.emit('movestart',feature);
  });
  
  this._translateInteraction.on('translateend',function(e){
    var feature = e.features.getArray()[0];
    //try {
      if (!self._busy){
        self._busy = true;
        self.pause();
        self.moveFeature(feature)
        .then(function(res){
          self.pause(false);
        })
        .fail(function(){
          feature.setGeometry(self._origGeometry);
        });
      }
    //}
    /*catch (error){
      console.log(error);
      feature.setGeometry(self._origGeometry);
    }*/
  });

};

proto.pause = function(pause){
  if (_.isUndefined(pause) || pause){
    this._selectInteraction.setActive(false);
    this._translateInteraction.setActive(false);
  }
  else {
    this._selectInteraction.setActive(true);
    this._translateInteraction.setActive(true);
  }
};

proto.stop = function(){
  var map = MapService.viewer.map;
  this._selectInteraction.getFeatures().clear();
  map.removeInteraction(this._selectInteraction);
  this._selectInteraction = null;
  map.removeInteraction(this._translateInteraction);
  this._translateInteraction = null;
  return true;
};

proto._moveFeature = function(feature){
  this.editor.emit('moveend',feature);
  this.editor.updateFeature(feature);
  this._selectInteraction.getFeatures().clear();
  this._busy = false;
  this.pause(false);
  return true;
};

proto._fallBack = function(feature){
  this._busy = false;
  this.pause(false);
};

},{"g3w/core/g3wobject":28,"g3w/core/mapservice":33,"g3w/core/utils":40}],77:[function(require,module,exports){
var inherit = require('g3w/core/utils').inherit;
var base = require('g3w/core/utils').base;
var noop = require('g3w/core/utils').noop;
var G3WObject = require('g3w/core/g3wobject');
var PickFeatureInteraction = require('g3w-ol3/src/interactions/pickfeatureinteraction');

var MapService = require('g3w/core/mapservice');

function PickFeatureTool(editor){
  var self = this;
  this.editor = editor;
  this.isPausable = true;
  this.pickFeatureInteraction = null;
  this._running = false;
  this._busy = false;
  
  // qui si definiscono i metodi che vogliamo poter intercettare, ed eventualmente bloccare (vedi API G3WObject)
  this.setters = {
    pickFeature: noop,
  };
  
  base(this);
}
inherit(PickFeatureTool,G3WObject);
module.exports = PickFeatureTool;

var proto = PickFeatureTool.prototype;

// metodo eseguito all'avvio del tool
proto.run = function(){
  var self = this;
  //var map = MapService.viewer.map;
  var layers = [this.editor.getVectorLayer().getLayer(),this.editor.getEditVectorLayer().getLayer()];
  
  this.pickFeatureInteraction = new PickFeatureInteraction({
    layers: layers
  });
  
  this.pickFeatureInteraction.on('picked',function(e){
    if (!self._busy){
      self._busy = true;
      self.pause(true);
      self.pickFeature(e.feature)
      .then(function(res){
        self._busy = false;
        self.pause(false);
      })
    }
  });
  
  //map.addInteraction(this.pickFeatureInteraction);
  //this.pickFeatureInteraction.setActive(true);
  MapService.pushInteraction(this.pickFeatureInteraction);
};

proto.pause = function(pause){
  if (_.isUndefined(pause) || pause){
    this.pickFeatureInteraction.setActive(false);
  }
  else {
    this.pickFeatureInteraction.setActive(true);
  }
};

// metodo eseguito alla disattivazione del tool
proto.stop = function(){
  MapService.popInteraction();
  return true;
};

proto._fallBack = function(feature){
  this._busy = false;
  this.pause(false);
};

},{"g3w-ol3/src/interactions/pickfeatureinteraction":22,"g3w/core/g3wobject":28,"g3w/core/mapservice":33,"g3w/core/utils":40}],78:[function(require,module,exports){
var inherit = require('g3w/core/utils').inherit;
var base = require('g3w/core/utils').base;
var G3WObject = require('g3w/core/g3wobject');
var MapService = require('g3w/core/mapservice');

function EditingTool(editor,options){
  this.editor = editor;
  this.layer = this.editor.getVectorLayer().getLayer();
  this.editingLayer = this.editor.getEditVectorLayer().getLayer();
  this.map = MapService.viewer.map;
  this.isPausable = false;
  this.options = options || {};
  this.steps = null;
  
  base(this);
}
inherit(EditingTool,G3WObject);

var proto = EditingTool.prototype;

proto.stop = function(){
  if (this.steps) {
    this.steps.destroy();
  }
  return true;
}

EditingTool.Steps = function(steps){
  var index = -1;
  var steps = steps;
  
  this.next = function(){
    index += 1;
    var step = steps[index];
    this.emit('step',index,step);
  };
  
  this.currentStep = function(){
    return steps[index];
  };
  
  this.currentStepIndex = function(){
    return index;
  };
  
  this.totalSteps = function(){
    return steps.length;
  };
  
  this.reset = function(){
    index = 0;
  };
  
  this.destroy = function(){
    this.removeAllListeners();
  };
  
  this.completed = function(){
    this.emit('complete');
    this.reset();
  };
  
  this.insertStepAt = function(idx,step){
    steps.splice(idx,0,step);
  }
}
inherit(EditingTool.Steps,G3WObject);

module.exports = EditingTool

},{"g3w/core/g3wobject":28,"g3w/core/mapservice":33,"g3w/core/utils":40}],79:[function(require,module,exports){
module.exports = "<div class=\"g3w-iternet-editing-panel\">\n  <template v-for=\"toolbar in editorstoolbars\">\n    <div class=\"panel panel-primary\">\n      <div class=\"panel-heading\">\n        <h3 class=\"panel-title\">{{ toolbar.name }}</h3>\n      </div>\n      <div class=\"panel-body\">\n        <template v-for=\"tool in toolbar.tools\">\n          <div class=\"editbtn\" :class=\"{'enabled' : (state.editing.on && editingtoolbtnEnabled(tool)), 'toggled' : editingtoolbtnToggled(toolbar.layercode,tool.tooltype)}\">\n            <img height=\"30px\" width=\"30px\" @click=\"toggleEditTool(toolbar.layercode,tool.tooltype)\" :alt.once=\"tool.title\" :title.once=\"tool.title\" :src.once=\"resourcesurl+'images/'+tool.icon\"></img>\n          </div>\n        </template>\n      </div>\n    </div>\n  </template>\n  <div>\n    <button class=\"btn btn-primary\" v-disabled=\"editingbtnEnabled\" :class=\"{'btn-success' : state.editingOn}\" @click=\"toggleEditing\">{{ editingbtnlabel }}</button>\n    <button class=\"btn btn-danger\" v-disabled=\"!state.hasEdits\" @click=\"saveEdits\">{{ savebtnlabel }}</button>\n    <img v-show=\"state.retrievingData\" :src=\"resourcesurl +'images/loader.svg'\">\n  </div>\n  <div class=\"message\">\n    {{{ message }}}\n  </div>\n</div>\n";

},{}],80:[function(require,module,exports){
var resolvedValue = require('g3w/core/utils').resolvedValue;
var GUI = require('g3w/gui/gui');
var Service = require('./iternetservice');

var PanelComponent = Vue.extend({
  template: require('./editorpanel.html'),
  data: function(){
    return {
      state: Service.state,
      resourcesurl: GUI.getResourcesUrl(),
      editorstoolbars: [
        {
          name: "Accessi",
          layercode: "accessi",
          tools:[
            {
              title: "Aggiungi accesso",
              tooltype: 'addfeature',
              icon: 'iternetAddPoint.png'
            },
            {
              title: "Sposta accesso",
              tooltype: 'movefeature',
              icon: 'iternetMovePoint.png'
            },
            {
              title: "Rimuovi accesso",
              tooltype: 'deletefeature',
              icon: 'iternetDeletePoint.png'
            },
            {
              title: "Edita attributi",
              tooltype: 'editattributes',
              icon: 'editAttributes.png'
            }
          ]
        },
        {
          name: "Giunzioni stradali",
          layercode: "giunzioni",
          tools:[
            {
              title: "Aggiungi giunzione",
              tooltype: 'addfeature',
              icon: 'iternetAddPoint.png'
            },
            {
              title: "Sposta giunzione",
              tooltype: 'movefeature',
              icon: 'iternetMovePoint.png'
            },
            {
              title: "Rimuovi giunzione",
              tooltype: 'deletefeature',
              icon: 'iternetDeletePoint.png'
            },
            {
              title: "Edita attributi",
              tooltype: 'editattributes',
              icon: 'editAttributes.png'
            }
          ]
        },
        {
          name: "Elementi stradali",
          layercode: "strade",
          tools:[
            {
              title: "Aggiungi strada",
              tooltype: 'addfeature',
              icon: 'iternetAddLine.png'
            },
            {
              title: "Sposta vertice strada",
              tooltype: 'modifyvertex',
              icon: 'iternetMoveVertex.png'
            },
            {
              title: "Taglia su giunzione",
              tooltype: 'cutline',
              icon: 'iternetCutOnVertex.png'
            },
            {
              title: "Sposta strada",
              tooltype: 'movefeature',
              icon: 'iternetMoveLine.png'
            },
            {
              title: "Rimuovi strada",
              tooltype: 'deletefeature',
              icon: 'iternetDeleteLine.png'
            },
            {
              title: "Edita attributi",
              tooltype: 'editattributes',
              icon: 'editAttributes.png'
            }
          ]
        }
      ],
      savebtnlabel: "Salva"
    }
  },
  methods: {
    toggleEditing: function(){
      Service.toggleEditing();
    },
    saveEdits: function(){
      Service.saveEdits();
    },
    toggleEditTool: function(layerCode,toolType){
      if (toolType == ''){
        return;
      }
      if (this.state.editing.on) {
        Service.toggleEditTool(layerCode,toolType);
      }
    },
    editingtoolbtnToggled: function(layerCode,toolType){
      return (this.state.editing.layerCode == layerCode && this.state.editing.toolType == toolType);
    },
    editingtoolbtnEnabled: function(tool){
      return tool.tooltype != '';
    }
  },
  computed: {
    editingbtnlabel: function(){
      return this.state.editing.on ? "Termina editing" : "Avvia editing";
    },
    editingbtnEnabled: function(){
      return (this.state.editing.enabled || this.state.editing.on) ? "" : "disabled";
    },
    message: function(){
      var message = "";
      if (!this.state.editing.enabled){
        message = '<span style="color: red">Aumentare il livello di zoom per abilitare l\'editing';
      }
      else if (this.state.editing.toolstep.message){
        var n = this.state.editing.toolstep.n;
        var total = this.state.editing.toolstep.total;
        var stepmessage = this.state.editing.toolstep.message;
        message = '<div style="margin-top:20px">GUIDA STRUMENTO:</div>' +
          '<div><span>['+n+'/'+total+'] </span><span style="color: yellow">'+stepmessage+'</span></div>';
      }
      return message;
    }
  }
});

function Panel(){
  // proprietà necessarie. In futuro le mettermo in una classe Panel da cui deriveranno tutti i pannelli che vogliono essere mostrati nella sidebar
  this.id = "iternet-editing-panel";
  this.name = "Gestione dati ITERNET";
  this.panelComponent = null;
}

var proto = Panel.prototype;

// viene richiamato dalla toolbar quando il plugin chiede di mostrare un proprio pannello nella GUI (GUI.showPanel)
proto.onShow = function(container){
  var panel = this.panelComponent = new PanelComponent();
  panel.$mount().$appendTo(container);
  return resolvedValue(true);
};

// richiamato quando la GUI chiede di chiudere il pannello. Se ritorna false il pannello non viene chiuso
proto.onClose = function(){
  var self = this;
  var deferred = $.Deferred();
  Service.stop()
  .then(function(){
    self.panelComponent.$destroy(true);
    self.panelComponent = null;
    deferred.resolve();
  })
  .fail(function(){
    deferred.reject();
  })
  
  return deferred.promise();
};

module.exports = Panel;

},{"./editorpanel.html":79,"./iternetservice":86,"g3w/core/utils":40,"g3w/gui/gui":55}],81:[function(require,module,exports){
var inherit = require('g3w/core/utils').inherit;
var base = require('g3w/core/utils').base;
var IternetEditor = require('./iterneteditor');

function AccessiEditor(options){
  base(this,options);
}
inherit(AccessiEditor,IternetEditor);
module.exports = AccessiEditor;

},{"./iterneteditor":84,"g3w/core/utils":40}],82:[function(require,module,exports){
var inherit = require('g3w/core/utils').inherit;
var base = require('g3w/core/utils').base;
var ProjectService = require('g3w/core/projectservice').ProjectService;
var FormPanel = require('g3w/gui/form').FormPanel;
var Form = require('g3w/gui/form').Form;

var IternetFormPanel = FormPanel.extend({});

function IternetForm(options){
  base(this,options);
  this._formPanel = IternetFormPanel;
}
inherit(IternetForm,Form);

var proto = IternetForm.prototype;

proto._isVisible = function(field){
  var ret = true;
  switch (field.name){
    case "cod_acc_est":
      var tip_acc = this._getField("tip_acc");
      if (tip_acc.value=="0101"){
        ret = false;
      }
      break;
    case "cod_acc_int":
      var tip_acc = this._getField("tip_acc");
      if (tip_acc.value=="0101" || tip_acc.value=="0501"){
        ret = false;
      }
      break;
  }
  return ret;
};

proto._isEditable = function(field){
  if (field.name == "tip_acc" && !this._isNew()){
    return false;
  };
  return Form.prototype._isEditable.call(this,field);
};

proto._shouldShowRelation = function(relation){
  if (relation.name=="numero_civico"){
    var tip_acc = this._getField("tip_acc");
    if (tip_acc.value == '0102'){
      return false;
    }
  }
  return true;
};

proto._pickLayer = function(field){
  var self = this;
  var layerId = field.input.options.layerid;
  
  Form.prototype._pickLayer.call(this,field)
  .then(function(attributes){
    var linkedField;
    var linkedFieldAttributeName;
    
    switch (field.name) {
      case 'cod_ele':
        linkedField = self._getRelationField("cod_top","numero_civico");
        break;
      case 'cod_top':
        linkedField = self._getField("cod_ele");;
    }
    
    if (linkedField) {
      linkedFieldAttributeName = ProjectService.getLayerAttributeLabel(layerId,linkedField.input.options.field);
      if (linkedField && attributes[linkedFieldAttributeName]){
        linkedField.value = attributes[linkedFieldAttributeName];
      }
    }
  })
};

module.exports = IternetForm;

},{"g3w/core/projectservice":36,"g3w/core/utils":40,"g3w/gui/form":49}],83:[function(require,module,exports){
var inherit = require('g3w/core/utils').inherit;
var base = require('g3w/core/utils').base;
var IternetEditor = require('./iterneteditor');

function GiunzioniEditor(options){
  base(this,options);
  
  this._service = null;
  this._stradeEditor = null;
  this._giunzioneGeomListener = null;
  
  /* INIZIO MODIFICA TOPOLOGICA DELLE GIUNZIONI */
  
  this._setupMoveGiunzioniListener = function(){
    var self = this;
    this.on('movestart',function(feature){
      // rimuovo eventuali precedenti listeners
      self._startMovingGiunzione(feature);
    });
  };
  
  this._stradeToUpdate = [];
  
  this._startMovingGiunzione = function(feature){
    var self = this;
    var vectorLayer = this.getVectorLayer();
    var stradeEditor = this._stradeEditor;
    var giunzione = feature;
    var cod_gnz = giunzione.get('cod_gnz');
    // devo avviare l'editor delle strade
    this._stradeToUpdate = [];
    var strade = stradeEditor.getVectorLayer().getSource().getFeatures();
    _.forEach(strade,function(strada){
      var nod_ini = strada.get('nod_ini');
      var nod_fin = strada.get('nod_fin');
      var ini = (nod_ini == cod_gnz);
      var fin = (nod_fin == cod_gnz);
      if (ini || fin){
        var initial = ini ? true : false;
        self._stradeToUpdate.push(strada);
        self._startGiunzioniStradeTopologicalEditing(giunzione,strada,initial)
      }
    })
    this.once('moveend',function(feature){
      if ( self._stradeToUpdate.length){
        if (!stradeEditor.isStarted()){
          stradeEditor.start(this._service);
        }
        _.forEach( self._stradeToUpdate,function(strada){
          stradeEditor.updateFeature(strada);
        })
      }
    });
  };
  
  this._startGiunzioniStradeTopologicalEditing = function(giunzione,strada,initial){
    var stradaGeom = strada.getGeometry();
    var stradaCoords = strada.getGeometry().getCoordinates();
    var coordIndex = initial ? 0 : stradaCoords.length-1;
    var giunzioneGeom = giunzione.getGeometry();
    var listenerKey = giunzioneGeom.on('change',function(e){
      stradaCoords[coordIndex] = e.target.getCoordinates();
      stradaGeom.setCoordinates(stradaCoords);
    });
    this._giunzioneGeomListener = listenerKey;
  };
  
  /* FINE MODIFICA TOPOLOGICA GIUNZIONI */
  
  /* INIZIO RIMOZIONE GIUNZIONI */
  
  this._setupDeleteGiunzioniListener = function(){
    var self = this;
    var stradeEditor = this._stradeEditor;
    this.onbeforeasync('deleteFeature',function(feature,isNew,next){
      var stopDeletion = false;
      var stradeVectorLayer = stradeEditor.getVectorLayer();
      _.forEach(stradeVectorLayer.getFeatures(),function(strada){
        var cod_gnz = feature.get('cod_gnz');
        var nod_ini = strada.get('nod_ini');
        var nod_fin = strada.get('nod_fin');
        var ini = (nod_ini == cod_gnz);
        var fin = (nod_fin == cod_gnz);
        if (ini || fin){
          stopDeletion = true;
        }
      });
      
      if (stopDeletion){
        GUI.notify.error("Non è possibile rimuovere la giunzioni perché risulta connessa ad una o più strade");
      }
      next(!stopDeletion);
    });
  };
  
  /* FINE */
}
inherit(GiunzioniEditor,IternetEditor);
module.exports = GiunzioniEditor;

var proto = GiunzioniEditor.prototype;

proto.start = function(iternetService){
  this._service = iternetService;
  this._stradeEditor = iternetService._layers[iternetService.layerCodes.STRADE].editor;
  this._setupMoveGiunzioniListener();
  this._setupDeleteGiunzioniListener();
  return IternetEditor.prototype.start.call(this);
};

proto.stop = function(){
  var ret = false;
  if (IternetEditor.prototype.stop.call(this)){
    ret = true;
    ol.Observable.unByKey(this._giunzioneGeomListener);
  }
  return ret;
};

proto.setTool = function(toolType){
  var options;
  if (toolType=='addfeature'){
    options = {
      snap: {
        vectorLayer: this._stradeEditor.getVectorLayer()
      }
    }
  }
  return IternetEditor.prototype.setTool.call(this,toolType,options);
}

},{"./iterneteditor":84,"g3w/core/utils":40}],84:[function(require,module,exports){
var inherit = require('g3w/core/utils').inherit;
var base = require('g3w/core/utils').base;
var GUI = require('g3w/gui/gui');
var Editor = require('g3w-editing/editor');
var Form = require('./attributesform');

function IternetEditor(options){
  base(this,options);
  
  // apre form attributi per inserimento
  this._askConfirmToDeleteEditingListener = function(){
    var self = this;
    this.onbeforeasync('deleteFeature',function(feature,isNew,next){
      GUI.dialog.confirm("Vuoi eliminare l'elemento selezionato?",function(result){
        next(result);
      })
    });
  };
  
  // apre form attributi per inserimento
  this._setupAddFeatureAttributesEditingListeners = function(){
    var self = this;
    this.onbeforeasync('addFeature',function(feature,next){
      self._openEditorForm('new',feature,next)
    });
  };
  
  // apre form attributi per editazione
  this._setupEditAttributesListeners = function(){
    var self = this;
    this.onafter('pickFeature',function(feature){
      self._openEditorForm('old',feature)
    });
  };
  
  this._openEditorForm = function(isNew,feature,next){
    var self = this;
    var fid = feature.getId();
    var vectorLayer = this.getVectorLayer();
    var fields = vectorLayer.getFieldsWithAttributes(feature);
    
    // nel caso qualcuno, durante la catena di setterListeners, abbia settato un attributo (solo nel caso di un nuovo inserimento)
    // usato ad esempio nell'editing delle strade, dove viene settato in fase di inserimento/modifica il codice dei campi nod_ini e nod_fin
    var pk = vectorLayer.pk;
    if (pk && _.isNull(this.getField(pk))){
      _.forEach(feature.getProperties(),function(value,attribute){
        var field = self.getField(attribute,fields);
        if(field){
          field.value = value;
        }
      });
    }
    
    var relationsPromise = this.getRelationsWithAttributes(feature);
    relationsPromise
    .then(function(relations){
      var form = new Form({
        name: "Edita attributi "+vectorLayer.name,
        id: "attributes-edit-"+vectorLayer.name,
        dataid: vectorLayer.name,
        pk: vectorLayer.pk,
        isnew: self.isNewFeature(feature.getId()),
        fields: fields,
        relations: relations,
        buttons:[
          {
            title: "Salva",
            type: "save",
            class: "btn-danger",
            cbk: function(fields,relations){
              self.setFieldsWithAttributes(feature,fields,relations);
              if (next){
                next(true);
              }
            }
          },
          {
            title: "Cancella",
            type: "cancel",
            class: "btn-primary",
            cbk: function(){
              if (next){
                next(false);
              }
            }
          }
        ]
      });
      GUI.showForm(form,{
        modal: true,
        closable: false
      });
    })
    .fail(function(){
      if (next){
        next(false);
      }
    })
  };
}
inherit(IternetEditor,Editor);
module.exports = IternetEditor;

var proto = IternetEditor.prototype;

proto.start = function(){
  var ret = Editor.prototype.start.call(this);
  this._setupAddFeatureAttributesEditingListeners();
  this._setupEditAttributesListeners();
  this._askConfirmToDeleteEditingListener();
  return ret;
};

},{"./attributesform":82,"g3w-editing/editor":70,"g3w/core/utils":40,"g3w/gui/gui":55}],85:[function(require,module,exports){
var inherit = require('g3w/core/utils').inherit;
var base = require('g3w/core/utils').base;
var MapService = require('g3w/core/mapservice');
var GUI = require('g3w/gui/gui');
var IternetEditor = require('./iterneteditor');

function StradeEditor(options){
  base(this,options);
  
  this._service = null;
  this._giunzioniEditor = null;
  
  this._stradeSnaps = null;
  
  this._stradeSnapsCollection = function(){
    var snaps = [];
    this.length = 0;
    
    this.push = function(feature){
      var pushed = false;
      if (this.canSnap(feature)){
        snaps.push(feature);
        this.length += 1;
        pushed = true;
      }
      return pushed;
    };
    
    this.getLast = function(){
      return snaps[snaps.length-1];
    };
    
    this.getFirst = function(){
      return snaps[0];
    };
    
    this.clear = function(){
      snaps.splice(0,snaps.length);
      this.length = 0;
    };
    
    this.getSnaps = function(){
      return snaps;
    };
    
    this.canSnap = function(feature){
      if (this.isAlreadySnapped(feature)){
        return false;
      }
      var cod_gnz = feature.get('cod_gnz');
      return (!_.isNil(cod_gnz) && cod_gnz != '');
    };
    
    this.isAlreadySnapped = function(feature){
      return _.includes(this.snaps,feature);
    }
  };
  
  this._updateStradaAttributes = function(feature){
    var snaps = this._stradeSnaps;
    feature.set('nod_ini',snaps.getSnaps()[0].get('cod_gnz'));
    feature.set('nod_fin',snaps.getSnaps()[1].get('cod_gnz'));
  };
  
  /* CONTROLLO GIUNZIONI PER LE STRADE NON COMPLETAMENTE CONTENUTE NELLA VISTA */
  
  // per le strade presenti nella vista carica le giunzioni eventualmente mancanti (esterne alla vista)
  this._loadMissingGiunzioniInView = function(){
    var vectorLayer = this.getVectorLayer();
    var giunzioniVectorLayer = this._giunzioniEditor.getVectorLayer();
    
    var stradeSource = vectorLayer.getSource();
    var extent = ol.extent.buffer(stradeSource.getExtent(),1);
    this._service._loadVectorData(giunzioniVectorLayer,extent);
  };
  
  /* FINE */
  
  /* INIZIO GESTIONE VINCOLO SNAP SU GIUNZIONI DURANTE IL DISEGNO DELLE STRADE */
  
  this._drawRemoveLastPoint = _.bind(function(e){
    var self = this;
    var toolType = this.getActiveTool().getType();
    // il listener viene attivato per tutti i tool dell'editor strade, per cui devo controllare che sia quello giusto
    if (toolType == 'addfeature'){
      // CANC
      if(e.keyCode==46){
        e.preventDefault();
        e.stopPropagation();
        self.getActiveTool().getTool().removeLastPoint();
      }
    }
  },this);
  
  this._setupDrawStradeConstraints = function(){
    var self = this;
    var mapId = MapService.viewer.map.getTargetElement().id;
    var map = MapService.viewer.map;
    
    var drawingGeometry = null;
    
    this.onbefore('addFeature',function(feature){
      var snaps = self._stradeSnaps;
      if (snaps.length == 2){
        self._updateStradaAttributes(feature);
        snaps.clear();
        return true;
      }
      return false;
    });
  };
  
  this._getCheckSnapsCondition = function(){
    var self = this;
    // ad ogni click controllo se ci sono degli snap con le giunzioni
    return function(e){
      var snaps = self._stradeSnaps;
      if (snaps.length == 2){
        return true;
      }
      GUI.notify.error("L'ultimo vertice deve corrispondere con una giunzione");
      return false;
    }
  };
  
  // ad ogni click controllo se ci sono degli snap con le giunzioni
  this._getStradaIsBeingSnappedCondition = function(){
    var self = this;
    var map = MapService.viewer.map;
    var giunzioniVectorLayer = this._giunzioniEditor.getVectorLayer();
    
    return function(e){
      var snaps = self._stradeSnaps;
      var c = map.getCoordinateFromPixel(e.pixel);
      var giunzioniSource = giunzioniVectorLayer.getSource();
      var extent = ol.extent.buffer([c[0],c[1],c[0],c[1]],1);
      var snappedFeature = giunzioniSource.getFeaturesInExtent(extent)[0];
      
      // se ho già due snap e questo click non è su un'altra giunzione, oppure se ho più di 2 snap, non posso inserire un ulteriore vertice
      if ((snaps.length == 2 && (!snappedFeature || snappedFeature != snaps.getSnaps()[1]))){
        var lastSnapped
        GUI.notify.error("Una strada non può avere vertici intermedi in corrispondenza di giunzioni.<br> Premere <b>CANC</b> per rimuovere l'ultimo vertice.");
        return false;
      }
      
      if (snappedFeature && snaps.length < 2){
        snaps.push(snappedFeature);
      }
      
      // se non ci sono snap, vuol dire che sono ancora al primo click e non ho snappato con la giunzione iniziale
      if (snaps.length == 0){
        GUI.notify.error("Il primo vertice deve corrispondere con una giunzione");
        return false;
      }
      return true;
    }
  };
  
  /* FINE DISEGNO */
  
  /* INIZIO CONTROLLI SU MODIFICA */
  
  this._modifyRemovePoint = _.bind(function(e){
    var self = this;
    var toolType = this.getActiveTool().getType();
    if (toolType == 'modifyvertex'){
      if(e.keyCode==46){
        e.preventDefault();
        e.stopPropagation();
        self.getActiveTool().getTool().removePoint();
      }
    }
  },this);
  
  this._setupModifyVertexStradeConstraints = function(){
    var self = this;
    var map = MapService.viewer.map;
    this.onbefore('modifyFeature',function(feature){
      var snaps = self._stradeSnaps;
      var correct = self._checkStradaIsCorrectlySnapped(feature.getGeometry());
      if (correct){
        self._updateStradaAttributes(feature);
        snaps.clear();
      }
      return correct;
    });
  };
  
  this._checkStradaIsCorrectlySnapped = function(geometry){
    var self = this;
    var ret = true;
    var map = MapService.viewer.map;
    var giunzioniVectorLayer = this._giunzioniEditor.getVectorLayer();
    this._stradeSnaps.clear();
    var snaps = this._stradeSnaps;
    var coordinates = geometry.getCoordinates();
    
    var firstVertexSnapped = false;
    var lastVertexSnapped = false;
    
    _.forEach(coordinates,function(c,index){      
      var giunzioniSource = giunzioniVectorLayer.getSource();
      
      var extent = ol.extent.buffer([c[0],c[1],c[0],c[1]],0.1);
      
      var snappedFeature = giunzioniSource.getFeaturesInExtent(extent)[0];
      
      if (snappedFeature){
        if (index == 0 && snaps.push(snappedFeature)){
          firstVertexSnapped = true;
        }
        else if (index == (coordinates.length-1) && snaps.push(snappedFeature)){
          lastVertexSnapped = true;
        }
        
      }
    });
    
    if (snaps.length > 2){
      GUI.notify.error("Una strada non può avere vertici intermedi in corrispondenza di giunzioni");
      ret = false;
    }
    
    if (!firstVertexSnapped){
      GUI.notify.error("Il primo vertice deve corrispondere con una giunzione");
      ret = false;
    }
    
    if (!lastVertexSnapped){
      GUI.notify.error("L'ultimo vertice deve corrispondere con una giunzione");
      ret = false;
    }
    return ret;
  };
  
  /* FINE MODIFICA */
  
  /* INIZIO TAGLIO */
  
  this._setupStradeCutterPostSelection = function(){
    var self = this;
    this.onbeforeasync('cutLine',function(data,modType,next){
      if (modType == 'MODONCUT'){
        // la prima feature in data.add è quella da aggiungere come nuova
        var newFeature = data.added[0];
        var newFeatureSnaps = self._getFirstLastSnappedGiunzioni(newFeature.getGeometry());
        newFeature.set('nod_ini',newFeatureSnaps[0].get('cod_gnz'));
        newFeature.set('nod_fin',newFeatureSnaps[1].get('cod_gnz'));
        
        var updateFeature = data.updated;
        var updateFeatureSnaps = self._getFirstLastSnappedGiunzioni(updateFeature.getGeometry());
        updateFeature.set('nod_ini',updateFeatureSnaps[0].get('cod_gnz'));
        updateFeature.set('nod_fin',updateFeatureSnaps[1].get('cod_gnz'));
        
        self._openEditorForm('new',newFeature,next);
        
      }
      else {
        next(true);
      }
    });
  };
  
  this._getFirstLastSnappedGiunzioni = function(geometry){
    var coordinates = geometry.getCoordinates();
    var giunzioniVectorLayer = this._giunzioniEditor.getVectorLayer();
    var firstVertexSnapped = null;
    var lastVertexSnapped = null;
    
    _.forEach(coordinates,function(c,index){      
      var giunzioniSource = giunzioniVectorLayer.getSource();
      
      var extent = ol.extent.buffer([c[0],c[1],c[0],c[1]],0.1);
      
      var snappedFeature = giunzioniSource.getFeaturesInExtent(extent)[0];
      
      if (snappedFeature){
        if (index == 0){
          firstVertexSnapped = snappedFeature;
        }
        else if (index == (coordinates.length-1)){
          lastVertexSnapped = snappedFeature;
        }
      }
    });
    return [firstVertexSnapped,lastVertexSnapped];
  }
  
  /* FINE TAGLIO */
};
inherit(StradeEditor,IternetEditor);
module.exports = StradeEditor;

var proto = StradeEditor.prototype;

proto.start = function(iternetService){
  this._service = iternetService;
  this._giunzioniEditor = iternetService._layers[iternetService.layerCodes.GIUNZIONI].editor;
  
  this._loadMissingGiunzioniInView();
  this._setupDrawStradeConstraints();
  this._setupModifyVertexStradeConstraints();
  this._setupStradeCutterPostSelection();
        
  return IternetEditor.prototype.start.call(this);
};

proto.setTool = function(toolType){
  var giunzioniVectorLayer = this._giunzioniEditor.getVectorLayer();
  var stepsInfo = [];
  var options;
  if (toolType=='addfeature'){
    options = {
      snap: {
        vectorLayer: giunzioniVectorLayer
      },
      finishCondition: this._getCheckSnapsCondition(),
      condition: this._getStradaIsBeingSnappedCondition()
    }
  }
  if (toolType=='modifyvertex'){
    options = {
      snap: {
        vectorLayer: giunzioniVectorLayer
      },
      deleteCondition: _.constant(false)
    }
  }
  if (toolType=='cutline'){
    options = {
      pointLayer: giunzioniVectorLayer.getLayer()
    }
  }
  
  var start =  IternetEditor.prototype.setTool.call(this,toolType,options);
  
  if (start){
    //this.toolProgress.setStepsInfo(stepsInfo);
    this._stradeSnaps = new this._stradeSnapsCollection;
    $('body').keyup(this._drawRemoveLastPoint);
    $('body').keyup(this._modifyRemovePoint);
  };
  
  return start;
};

proto.stopTool = function(){
  var stop = false;
  stop = IternetEditor.prototype.stopTool.call(this);
  
  if (stop){
    this._stradeSnaps = null;
    $('body').off('keyup',this._drawRemoveLastPoint);
    $('body').off('keyup',this._modifyRemovePoint);
  }
  
  return stop; 
};

},{"./iterneteditor":84,"g3w/core/mapservice":33,"g3w/core/utils":40,"g3w/gui/gui":55}],86:[function(require,module,exports){
var inherit = require('g3w/core/utils').inherit;
var resolvedValue = require('g3w/core/utils').resolvedValue;
var rejectedValue = require('g3w/core/utils').rejectedValue;
var G3WObject = require('g3w/core/g3wobject');
var ProjectService = require('g3w/core/projectservice');
var MapService = require('g3w/core/mapservice');
var VectorLayer = require('g3w/core/vectorlayer');

var GUI = require('g3w/gui/gui');

var AccessiEditor = require('./editors/accessieditor');
var GiunzioniEditor = require('./editors/giunzionieditor');
var StradeEditor = require('./editors/stradeeditor');

var toolStepsMessages = {
  'cutline': [
    "Seleziona la strada da tagliare",
    "Seleziona la giunzione di taglio",
    "Seleziona la porizione di strada originale da mantenere"
  ]
}

function IternetService(){
  var self = this;
  
  this._runningEditor = null;
  
  var layerCodes = this.layerCodes = {
    STRADE: 'strade',
    GIUNZIONI: 'giunzioni',
    ACCESSI: 'accessi' 
  };
  
  this._editorClasses = {};
  this._editorClasses[layerCodes.ACCESSI] = AccessiEditor;
  this._editorClasses[layerCodes.GIUNZIONI] = GiunzioniEditor;
  this._editorClasses[layerCodes.STRADE] = StradeEditor;
  
  this._layers = {};
  this._layers[layerCodes.ACCESSI] = {
    layerCode: layerCodes.ACCESSI,
    vector: null,
    editor: null,
    style: function(feature){
      var color = '#d9b581';
      switch (feature.get('tip_acc')){
        case "0101":
          color = '#d9b581';
          break;
        case "0102":
          color = '#d9bc29';
          break;
        case "0501":
          color = '#68aad9';
          break;
        default:
          color = '#d9b581';
      }
      return [
        new ol.style.Style({
          image: new ol.style.Circle({
            radius: 5,
            fill: new ol.style.Fill({
              color: color
            })
          })
        })
      ]
    }
  };
  this._layers[layerCodes.GIUNZIONI] = {
    layerCode: layerCodes.GIUNZIONI,
    vector: null,
    editor: null,
    style: new ol.style.Style({
      image: new ol.style.Circle({
        radius: 5,
        fill: new ol.style.Fill({
          color: '#0000ff'
        })
      })
    })
  };
  this._layers[layerCodes.STRADE] = {
    layerCode: layerCodes.STRADE,
    vector: null,
    editor: null,
    style: new ol.style.Style({
      stroke: new ol.style.Stroke({
        width: 3,
        color: '#ff7d2d'
      })
    })
  };
  
  this._loadDataOnMapViewChangeListener = null;
  
  this._currentEditingLayer = null;
  
  this._loadedExtent = null;
  
  this.state = {
    editing: {
      on: false,
      enabled: false,
      layerCode: null,
      toolType: null,
      toolstep: {
        n: null,
        total: null,
        message: null
      },
    },
    retrievingData: false,
    hasEdits: false
  };
  
  // vincoli alla possibilità di attivare l'editing
  var editingConstraints = {
    resolution: 2 // vincolo di risoluzione massima
  }
  
  MapService.onafter('setMapView',function(bbox,resolution,center){
    self.state.editing.enabled = (resolution < editingConstraints.resolution) ? true : false;
  });
  
  this.init = function(config){
    this.config = config;
    _.forEach(this._layers,function(iternetLayer,layerCode){
      iternetLayer.name = config.layers[layerCode].name;
      iternetLayer.id = config.layers[layerCode].id;
    })
  };
  
  this.stop = function(){
    var deferred = $.Deferred();
    if (this.state.editing.on) {
      this._cancelOrSave()
      .then(function(){
        self._stopEditing();
        deferred.resolve();
      })
      .fail(function(){
        deferred.reject();
      })
    }
    else {
      deferred.resolve();
    };
    return deferred.promise();
  };
  
  // avvio o termino la sessione di editing generale
  this.toggleEditing = function(){
    var deferred = $.Deferred();
    var self = this;
    if (this.state.editing.enabled && !this.state.editing.on){
      this._startEditing();
    }
    else if (this.state.editing.on) {
      return this.stop();
    }
    return deferred.promise();
  };
  
  this.saveEdits = function(){
    this._cancelOrSave(2);
  };
  
  // avvia uno dei tool di editing tra quelli supportati da Editor (addfeature, ecc.)
  this.toggleEditTool = function(layerCode,toolType){
    var self = this;
    var layer = this._layers[layerCode];
    if (layer) {
      var currentEditingLayer = this._getCurrentEditingLayer();
      
      // se si sta chiedendo lo stesso editor
      if (currentEditingLayer && layerCode == currentEditingLayer.layerCode){
        // e lo stesso tool allora disattivo l'editor (untoggle)
        if (toolType == currentEditingLayer.editor.getActiveTool().getType()){
          this._stopEditingTool();
        }
        // altrimenti attivo il tool richiesto
        else {
          this._stopEditingTool();
          this._startEditingTool(currentEditingLayer,toolType);
        }
      }
      // altrimenti
      else {
        // nel caso sia già attivo un editor verifico di poterlo stoppare
        if (currentEditingLayer && currentEditingLayer.editor.isStarted()){
          // se la terminazione dell'editing sarà andata a buon fine, setto il tool
          // provo a stoppare
          this._cancelOrSave(2)
          .then(function(){
            if(self._stopEditor()){
              self._startEditingTool(layer,toolType);
            }
          })
        }
        else {
          this._startEditingTool(layer,toolType);
        }
      }
    }
  };  
  
  this.getLayerCodes = function(){
    return _.values(this.layerCodes);
  };
  
  /* METODI PRIVATI */
  
  this._startEditing = function(){
    var self = this;
    //try {
      this._setupAndLoadAllVectorsData()
      .then(function(data){
        // se tutto è andato a buon fine aggiungo i VectorLayer alla mappa
        self._addToMap();
        self.state.editing.on = true;
        self.emit("editingstarted");
        
        if (!self._loadDataOnMapViewChangeListener){
          self._loadDataOnMapViewChangeListener = MapService.onafter('setMapView',function(){
            if (self.state.editing.on && self.state.editing.enabled){
              self._loadAllVectorsData();
            }
          });
        }
      })
    //}
    /*catch(e) {
      console.log(e);
      this.state.retrievingData = false;
    }*/
  };
  
  this._stopEditing = function(reset){
    // se posso stoppare tutti gli editor...    
    if (this._stopEditor(reset)){
      _.forEach(this._layers,function(layer, layerCode){
        var vector = layer.vector;
        MapService.viewer.removeLayerByName(vector.name);
        layer.vector= null;
        layer.editor= null;
        self._unlockLayer(self.config.layers[layerCode]);
      });
      this._updateEditingState();
      self.state.editing.on = false;
      self._cleanUp()
      self.emit("editingstopped");
    }
  };
  
  this._cleanUp = function(){
    this._loadedExtent = null;
  };
  
  this._startEditor = function(layer){
    // avvio l'editor 
    if (layer.editor.start(this)){
      // e registro i listeners
      this._setCurrentEditingLayer(layer);
      return true;
    }
    return false;
  };
  
  this._startEditingTool = function(layer,toolType,options){
    var canStartTool = true;
    if (!layer.editor.isStarted()){
      canStartTool = this._startEditor(layer);
    }
    if(canStartTool && layer.editor.setTool(toolType,options)){
      this._updateEditingState();
      return true;
    }
    return false;
  };
  
  this._stopEditor = function(reset){
    var ret = true;
    var layer = this._getCurrentEditingLayer();
    if (layer) {
      ret = layer.editor.stop(reset);
      if (ret){
        this._setCurrentEditingLayer();
      }
    }
    return ret;
  };
  
  this._stopEditingTool = function(){
    var ret = true;
    var layer = this._getCurrentEditingLayer();
    if(layer){
      ret = layer.editor.stopTool();
      if (ret){
        this._updateEditingState();
      }
    }
    return ret;
  };
  
  this._cancelOrSave = function(type){
    var deferred = $.Deferred();
    // per sicurezza tengo tutto dentro un grosso try/catch, per non rischiare di provocare inconsistenze nei dati durante il salvataggio
    try {
      var _askType = 1;
      if (type){
        _askType = type
      }
      var self = this;
      var choice = "cancel";
      var dirtyEditors = {};
      _.forEach(this._layers,function(layer,layerCode){
        if (layer.editor.isDirty()){
          dirtyEditors[layerCode] = layer.editor;
        }
      });

      if(_.keys(dirtyEditors).length){
        this._askCancelOrSave(_askType).
        then(function(action){
          if (action === 'save'){
            self._saveEdits(dirtyEditors).
            then(function(result){
              deferred.resolve();
            })
            .fail(function(result){
              deferred.reject();
            })
          }
          else if (action == 'nosave') {
            deferred.resolve();
          }
          else if (action == 'cancel') {
            deferred.reject();
          }
        })
      }
      else {
        deferred.resolve();
      }
    }
    catch (e) {
      deferred.reject();
    }
    return deferred.promise();
  };
  
  this._askCancelOrSave = function(type){
    var deferred = $.Deferred();
    var buttonTypes = {
      SAVE: {
        label: "Salva",
        className: "btn-success",
        callback: function(){
          deferred.resolve('save');
        }
      },
      NOSAVE: {
        label: "Termina senza salvare",
        className: "btn-danger",
        callback: function(){
          deferred.resolve('nosave');
        }
      },
      CANCEL: {
        label: "Annulla",
        className: "btn-primary",
        callback: function(){
          deferred.resolve('cancel');
        }
      }
    };
    switch (type){
      case 1:
        buttons = {
          save: buttonTypes.SAVE,
          nosave: buttonTypes.NOSAVE,
          cancel: buttonTypes.CANCEL
        };
        break;
      case 2:
       buttons = {
          save: buttonTypes.SAVE,
          cancel: buttonTypes.CANCEL
        };
        break;
    }
    GUI.dialog.dialog({
        message: "Vuoi salvare definitivamente le modifiche?",
        title: "Salvataggio modifica",
        buttons: buttons
      });
    return deferred.promise();
  };
  
  this._saveEdits = function(dirtyEditors){
    var deferred = $.Deferred();
    this._sendEdits(dirtyEditors)
    .then(function(response){
      GUI.notify.success("I dati sono stati salvati correttamente"); 
      self._commitEdits(dirtyEditors,response);
      MapService.refreshMap();
      deferred.resolve();
    })
    .fail(function(errors){
      GUI.notify.error("Errore nel salvataggio sul server"); 
      deferred.resolve();
    })
    return deferred.promise();
  };
  
  this._sendEdits = function(dirtyEditors){
    var deferred = $.Deferred();

    var editsToPush = _.map(dirtyEditors,function(editor){
      return {
        layername: editor.getVectorLayer().name,
        edits: editor.getEditedFeatures()
      }
    });

    this._postData(editsToPush)
    .then(function(returned){
      if (returned.result){
        deferred.resolve(returned.response);
      }
      else {
        deferred.reject(returned.response);
      }
    })
    .fail(function(returned){
      deferred.reject(returned.response);
    });
    return deferred.promise();
  };
  
  this._commitEdits = function(editors,response){
    var self = this;
    _.forEach(editors,function(editor){
      var newAttributesFromServer = null;
      if (response && response.new){
        _.forEach(response.new,function(updatedFeatureAttributes){
          var oldfid = updatedFeatureAttributes.clientid;
          var fid = updatedFeatureAttributes.id;
          editor.getEditVectorLayer().setFeatureData(oldfid,fid,null,updatedFeatureAttributes);
        })
      }
      editor.commit();
    });
  };
  
  this._undoEdits = function(dirtyEditors){
    var currentEditingLayerCode = this._getCurrentEditingLayer().layerCode;
    var editor = dirtyEditors[currentEditingLayerCode];
    this._stopEditing(true);
  };
  
  this._updateEditingState = function(){
    var layer = this._getCurrentEditingLayer();
    if (layer){
      this.state.editing.layerCode = layer.layerCode;
      this.state.editing.toolType = layer.editor.getActiveTool().getType();
    }
    else {
      this.state.editing.layerCode = null;
      this.state.editing.toolType = null;
    }
    this._updateToolStepsState();
  };
  
  this._updateToolStepsState = function(activeTool){
    var self = this;
    var layer = this._getCurrentEditingLayer();
    var activeTool;
    
    if (layer) {
      activeTool = layer.editor.getActiveTool();
    }
    
    if (activeTool && activeTool.getTool()) {
      var toolInstance = activeTool.getTool();
      if (toolInstance.steps){
        this._setToolStepState(activeTool);
        toolInstance.steps.on('step',function(index,step){
          self._setToolStepState(activeTool);
        })
        toolInstance.steps.on('complete',function(){
          self._setToolStepState();
        })
      }
    }
    else {
      self._setToolStepState();
    }
  };
  
  this._setToolStepState = function(activeTool){
    var index, total, message;
    if (_.isUndefined(activeTool)){
      index = null;
      total = null;
      message = null;
    }
    else {
      var tool = activeTool.getTool();
      var messages = toolStepsMessages[activeTool.getType()];
      index = tool.steps.currentStepIndex();
      total = tool.steps.totalSteps();
      message = messages[index];
      if (_.isUndefined(message)) {
        index = null;
        total = null;
        message = null;
      }
    }
    this.state.editing.toolstep.n = index + 1;
    this.state.editing.toolstep.total = total;
    this.state.editing.toolstep.message = message;
  };
  
  this._getCurrentEditingLayer = function(){
    return this._currentEditingLayer;
  };
  
  this._setCurrentEditingLayer = function(layer){
    if (!layer){
      this._currentEditingLayer = null;
    }
    else {
      this._currentEditingLayer = layer;
    }
  };
  
  this._addToMap = function(){
    var map = MapService.viewer.map;
    var layerCodes = this.getLayerCodes();
    _.forEach(layerCodes,function(layerCode){
      self._layers[layerCode].vector.addToMap(map);
    })
  };
  
  this._setupAndLoadAllVectorsData = function(){
    var self = this;
    var deferred = $.Deferred();
    var layerCodes = this.getLayerCodes();
    var layersReady = _.reduce(layerCodes,function(ready,layerCode){
      return !_.isNull(self._layers[layerCode].vector);
    });
    self.state.retrievingData = true;
    if (!layersReady){
      // eseguo le richieste delle configurazioni e mi tengo le promesse
      var vectorLayersSetup = _.map(layerCodes,function(layerCode){
        return self._setupVectorLayer(self._layers[layerCode]);
      });
      // aspetto tutte le promesse
      $.when.apply(this,vectorLayersSetup)
      .then(function(){
        var vectorLayers = Array.prototype.slice.call(arguments);
        var layerCodes = self.getLayerCodes();
        var vectorLayersForIternetCode = _.zipObject(layerCodes,vectorLayers);
        
        _.forEach(vectorLayersForIternetCode,function(vectorLayer,layerCode){
          self._layers[layerCode].vector = vectorLayer;
          var editor = new self._editorClasses[layerCode];
          editor.setVectorLayer(vectorLayer);
          editor.on("dirty",function(dirty){
            self.state.hasEdits = dirty;
          })        
          self._layers[layerCode].editor = editor;
        });

        self._loadAllVectorsData()
        .then(function(){
          deferred.resolve();
        })
        .fail(function(){
          deferred.reject();
        })
        .always(function(){
          self.state.retrievingData = false;
        })
      })
      .fail(function(){
        deferred.reject();
      })
    }
    else{
      this._loadAllVectorsData()
      .then(function(){
        deferred.resolve();
      })
      .fail(function(){
        deferred.reject();
      })
      .always(function(){
        self.state.retrievingData = false;
      })
    }
    return deferred.promise();
  };
  
  this._loadAllVectorsData = function(vectorLayers){
    
    // verifico che il BBOX attuale non sia stato già caricato
    var bbox = MapService.state.bbox;
    var loadedExtent = this._loadedExtent;
    if (loadedExtent && ol.extent.containsExtent(loadedExtent,bbox)){
        return resolvedValue();
    }
    if (!loadedExtent){
      this._loadedExtent = bbox;
    }
    else {
      this._loadedExtent = ol.extent.extend(loadedExtent,bbox);
    }
    
    
    var deferred = $.Deferred();
    var self = this;
    var vectorDataRequests = _.map(self._layers,function(iternetLayer){
      return self._loadVectorData(iternetLayer.vector,bbox);
    });
    $.when.apply(this,vectorDataRequests)
    .then(function(){
      var vectorsDataResponse = Array.prototype.slice.call(arguments);
      var layerCodes = self.getLayerCodes();
      var vectorDataResponseForIternetCode = _.zipObject(layerCodes,vectorsDataResponse);
      _.forEach(vectorDataResponseForIternetCode,function(vectorDataResponse,layerCode){
        if (vectorDataResponse.featurelocks){
          self._layers[layerCode].editor.setFeatureLocks(vectorDataResponse.featurelocks);
        }
      })
      deferred.resolve();
    })
    .fail(function(){
      deferred.reject();
    });
    
    return deferred.promise();
  };
  
  this._setupVectorLayer = function(layerConfig){
    var deferred = $.Deferred();
    // eseguo le richieste delle configurazioni e mi tengo le promesse
    self._getVectorLayerConfig(layerConfig.name)
    .then(function(vectorConfigResponse){
      // instanzio il VectorLayer
      var vectorConfig = vectorConfigResponse.vector;
      var vectorLayer = self._createVectorLayer({
        geometrytype: vectorConfig.geometrytype,
        format: vectorConfig.format,
        crs: "EPSG:3003",
        id: layerConfig.id,
        name: layerConfig.name,
        pk: vectorConfig.pk  
      });
      // ottengo la definizione dei campi
      vectorLayer.setFields(vectorConfig.fields);
      
      var relations = vectorConfig.relations;
      
      if(relations){
        // per dire a vectorLayer che i dati delle relazioni verranno caricati solo quando richiesti (es. aperture form di editing)
        vectorLayer.lazyRelations = true;
        vectorLayer.setRelations(relations);
      }
      // setto lo stile del layer OL
      if (layerConfig.style) {
        vectorLayer.setStyle(layerConfig.style);
      }
      deferred.resolve(vectorLayer);
    })
    .fail(function(){
      deferred.reject();
    })
    return deferred.promise();
  };
  
  this._loadVectorData = function(vectorLayer,bbox){
    var self = this;
    // eseguo le richieste de dati e mi tengo le promesse
    return self._getVectorLayerData(vectorLayer,bbox)
    .then(function(vectorDataResponse){
      vectorLayer.setData(vectorDataResponse.vector.data);
      return vectorDataResponse;
    })
  };
  
  // ottiene la configurazione del vettoriale (qui richiesto solo per la definizione degli input)
  this._getVectorLayerConfig = function(layerName){
    var d = $.Deferred();
    $.get(this.config.baseurl+layerName+"/?config")
    .done(function(data){
      d.resolve(data);
    })
    .fail(function(){
      d.reject();
    })
    return d.promise();
  };
  
  // ottiene il vettoriale in modalità editing
  this._getVectorLayerData = function(vectorLayer,bbox){
    var d = $.Deferred();
    $.get(this.config.baseurl+vectorLayer.name+"/?editing&in_bbox="+bbox[0]+","+bbox[1]+","+bbox[2]+","+bbox[3])
    .done(function(data){
      d.resolve(data);
    })
    .fail(function(){
      d.reject();
    })
    return d.promise();
  };
  
  this._postData = function(editsToPush){
    // mando un oggetto come nel caso del batch, ma in questo caso devo prendere solo il primo, e unico, elemento
    if (editsToPush.length>1){
      return this._postBatchData(editsToPush);
    }
    var layerName = editsToPush[0].layername;
    var edits = editsToPush[0].edits;
    var jsonData = JSON.stringify(edits);
    return $.post({
      url: this.config.baseurl+layerName+"/",
      data: jsonData,
      contentType: "application/json"
    });
  };
  
  this._postBatchData = function(multiEditsToPush){
    var edits = {};
    _.forEach(multiEditsToPush,function(editsToPush){
      edits[editsToPush.layername] = editsToPush.edits;
    });
    var jsonData = JSON.stringify(edits);
    return $.post({
      url: this.config.baseurl,
      data: jsonData,
      contentType: "application/json"
    });
  };
  
  this._unlock = function(){
    var layerCodes = this.getLayerCodes();
    // eseguo le richieste delle configurazioni e mi tengo le promesse
    var unlockRequests = _.map(layerCodes,function(layerCode){
      return self._unlockLayer(self.config.layers[layerCode]);
    });
  };
  
  this._unlockLayer = function(layerConfig){
    $.get(this.config.baseurl+layerConfig.name+"/?unlock");
  };
  
  this._createVectorLayer = function(options,data){
    var vector = new VectorLayer(options);
    return vector;
  };
}
inherit(IternetService,G3WObject);

module.exports = new IternetService;

},{"./editors/accessieditor":81,"./editors/giunzionieditor":83,"./editors/stradeeditor":85,"g3w/core/g3wobject":28,"g3w/core/mapservice":33,"g3w/core/projectservice":36,"g3w/core/utils":40,"g3w/core/vectorlayer":41,"g3w/gui/gui":55}],87:[function(require,module,exports){
var inherit = require('g3w/core/utils').inherit;
var resolvedValue = require('g3w/core/utils').resolvedValue;
var rejectedValue = require('g3w/core/utils').rejectedValue;
var ProjectsRegistry = require('g3w/core/projectsregistry');
var PluginsRegistry = require('g3w/core/pluginsregistry');
var GUI = require('g3w/gui/gui');
var G3WPlugin = require('g3w/core/plugin');

var Service = require('./iternetservice');

var EditingPanel = require('./editorpanel')

function IternetPlugin(){
  var self = this;
  this.config = null;
  this.name = "iternet"
  this.tools = [
    {
      name: "ITERNET",
      actions: [
        {id: "iternet:startEditing", name: "Gestione dati"}
      ]
    }
  ];
  
  this.init = function(config){
    this.config = config;
  };
  
  ProjectsRegistry.onafter('setCurrentProject',function(project){
    if (self.isCurrentProjectCompatible) {
      Service.init(self.config);
      PluginsRegistry.activate(self);
    }
  })
  
  this.isCurrentProjectCompatible = function(config){
    var gid = config.gid;
    var project = ProjectsRegistry.getCurrentProject();
    if (gid == project.gid) {
      return true;
    }
    return false;
  };
  
  // metodo in risposta all'azione iternet:startEditing; aggiunge il pannello alla sidebar
  this.startEditing = function(){
    var panel = new EditingPanel();
    GUI.showPanel(panel);
  };
}
inherit(IternetPlugin,G3WPlugin);

module.exports = new IternetPlugin;

},{"./editorpanel":80,"./iternetservice":86,"g3w/core/plugin":34,"g3w/core/pluginsregistry":35,"g3w/core/projectsregistry":37,"g3w/core/utils":40,"g3w/gui/gui":55}]},{},[3])


//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvYXBwL2NvbmZpZy9jb25maWcuanMiLCJzcmMvYXBwL2NvbmZpZy9sb2NhbGVzL2FwcC5qcyIsInNyYy9hcHAvaW5kZXguanMiLCJzcmMvYXBwL3RlbXBsYXRlcy9hcHAuaHRtbCIsInNyYy9hcHAvdGVtcGxhdGVzL2Zsb2F0YmFyLmh0bWwiLCJzcmMvYXBwL3RlbXBsYXRlcy9zaWRlYmFyLmh0bWwiLCJzcmMvbGlicy9jb21tb24vZzN3LWJhc2UtYXBwL2Jvb3RzdHJhcC5qcyIsInNyYy9saWJzL2NvbW1vbi9nM3ctYmFzZS1hcHAvanMvYXBwLnNlcnZpY2UuanMiLCJzcmMvbGlicy9jb21tb24vZzN3LWJhc2UtYXBwL2pzL2FwcC51aS5qcyIsInNyYy9saWJzL2NvbW1vbi9nM3ctYmFzZS1hcHAvanMvbGF5b3V0L2JhcnN0YWNrLmpzIiwic3JjL2xpYnMvY29tbW9uL2czdy1iYXNlLWFwcC9qcy9sYXlvdXQvZmxvYXRiYXIuanMiLCJzcmMvbGlicy9jb21tb24vZzN3LWJhc2UtYXBwL2pzL2xheW91dC9sYXlvdXQuanMiLCJzcmMvbGlicy9jb21tb24vZzN3LWJhc2UtYXBwL2pzL2xheW91dC9zaWRlYmFyLmpzIiwic3JjL2xpYnMvY29tbW9uL2czdy1iYXNlLWFwcC9qcy9sYXlvdXQvdGVtcGxhdGVzL3NpZGViYXItaXRlbS5odG1sIiwic3JjL2xpYnMvY29tbW9uL2czdy1vbDMvc3JjL2NvbnRyb2xzL2NvbnRyb2wuanMiLCJzcmMvbGlicy9jb21tb24vZzN3LW9sMy9zcmMvY29udHJvbHMvaW50ZXJhY3Rpb25jb250cm9sLmpzIiwic3JjL2xpYnMvY29tbW9uL2czdy1vbDMvc3JjL2NvbnRyb2xzL3F1ZXJ5Y29udHJvbC5qcyIsInNyYy9saWJzL2NvbW1vbi9nM3ctb2wzL3NyYy9jb250cm9scy9yZXNldGNvbnRyb2wuanMiLCJzcmMvbGlicy9jb21tb24vZzN3LW9sMy9zcmMvY29udHJvbHMvem9vbWJveGNvbnRyb2wuanMiLCJzcmMvbGlicy9jb21tb24vZzN3LW9sMy9zcmMvZzN3Lm9sMy5qcyIsInNyYy9saWJzL2NvbW1vbi9nM3ctb2wzL3NyYy9pbnRlcmFjdGlvbnMvcGlja2Nvb3JkaW5hdGVzaW50ZXJhY3Rpb24uanMiLCJzcmMvbGlicy9jb21tb24vZzN3LW9sMy9zcmMvaW50ZXJhY3Rpb25zL3BpY2tmZWF0dXJlaW50ZXJhY3Rpb24uanMiLCJzcmMvbGlicy9jb21tb24vZzN3LW9sMy9zcmMvbGF5ZXJzL2Jhc2VzLmpzIiwic3JjL2xpYnMvY29tbW9uL2czdy1vbDMvc3JjL2xheWVycy9yYXN0ZXJzLmpzIiwic3JjL2xpYnMvY29tbW9uL2czdy1vbDMvc3JjL21hcC9tYXBoZWxwZXJzLmpzIiwic3JjL2xpYnMvY29tbW9uL2czdy1vbDMvc3JjL3V0aWxzLmpzIiwic3JjL2xpYnMvY29tbW9uL2czdy9jb3JlL2FwaXNlcnZpY2UuanMiLCJzcmMvbGlicy9jb21tb24vZzN3L2NvcmUvZzN3b2JqZWN0LmpzIiwic3JjL2xpYnMvY29tbW9uL2czdy9jb3JlL2dlb2NvZGluZ3NlcnZpY2UuanMiLCJzcmMvbGlicy9jb21tb24vZzN3L2NvcmUvZ2VvbS5qcyIsInNyYy9saWJzL2NvbW1vbi9nM3cvY29yZS9sYXllci5qcyIsInNyYy9saWJzL2NvbW1vbi9nM3cvY29yZS9tYXBxdWVyeXNlcnZpY2UuanMiLCJzcmMvbGlicy9jb21tb24vZzN3L2NvcmUvbWFwc2VydmljZS5qcyIsInNyYy9saWJzL2NvbW1vbi9nM3cvY29yZS9wbHVnaW4uanMiLCJzcmMvbGlicy9jb21tb24vZzN3L2NvcmUvcGx1Z2luc3JlZ2lzdHJ5LmpzIiwic3JjL2xpYnMvY29tbW9uL2czdy9jb3JlL3Byb2plY3RzZXJ2aWNlLmpzIiwic3JjL2xpYnMvY29tbW9uL2czdy9jb3JlL3Byb2plY3RzcmVnaXN0cnkuanMiLCJzcmMvbGlicy9jb21tb24vZzN3L2NvcmUvcm91dGVyLmpzIiwic3JjL2xpYnMvY29tbW9uL2czdy9jb3JlL3Rvb2xzc2VydmljZS5qcyIsInNyYy9saWJzL2NvbW1vbi9nM3cvY29yZS91dGlscy5qcyIsInNyYy9saWJzL2NvbW1vbi9nM3cvY29yZS92ZWN0b3JsYXllci5qcyIsInNyYy9saWJzL2NvbW1vbi9nM3cvY29yZS93bXNtdWx0aWxheWVyLmpzIiwic3JjL2xpYnMvY29tbW9uL2czdy9jb3JlL3dtc3NpbmdsZWxheWVyLmpzIiwic3JjL2xpYnMvY29tbW9uL2czdy9ndWkvY2F0YWxvZy9jYXRhbG9nLmh0bWwiLCJzcmMvbGlicy9jb21tb24vZzN3L2d1aS9jYXRhbG9nL2NhdGFsb2cuanMiLCJzcmMvbGlicy9jb21tb24vZzN3L2d1aS9jYXRhbG9nL2xlZ2VuZC5odG1sIiwic3JjL2xpYnMvY29tbW9uL2czdy9ndWkvY2F0YWxvZy9sZWdlbmRfaXRlbS5odG1sIiwic3JjL2xpYnMvY29tbW9uL2czdy9ndWkvY2F0YWxvZy90cmlzdGF0ZS10cmVlLmh0bWwiLCJzcmMvbGlicy9jb21tb24vZzN3L2d1aS9mb3JtLmpzIiwic3JjL2xpYnMvY29tbW9uL2czdy9ndWkvZm9ybXBhbmVsLmh0bWwiLCJzcmMvbGlicy9jb21tb24vZzN3L2d1aS9nZW9jb2RpbmcvZ2VvY29kaW5nLmh0bWwiLCJzcmMvbGlicy9jb21tb24vZzN3L2d1aS9nZW9jb2RpbmcvZ2VvY29kaW5nLmpzIiwic3JjL2xpYnMvY29tbW9uL2czdy9ndWkvZ2VvY29kaW5nL2xpc3RwYW5lbC5odG1sIiwic3JjL2xpYnMvY29tbW9uL2czdy9ndWkvZ2VvY29kaW5nL2xpc3RwYW5lbC5qcyIsInNyYy9saWJzL2NvbW1vbi9nM3cvZ3VpL2d1aS5qcyIsInNyYy9saWJzL2NvbW1vbi9nM3cvZ3VpL2xpc3RwYW5lbC5odG1sIiwic3JjL2xpYnMvY29tbW9uL2czdy9ndWkvbGlzdHBhbmVsLmpzIiwic3JjL2xpYnMvY29tbW9uL2czdy9ndWkvbWFwL21hcC5odG1sIiwic3JjL2xpYnMvY29tbW9uL2czdy9ndWkvbWFwL21hcC5qcyIsInNyYy9saWJzL2NvbW1vbi9nM3cvZ3VpL3NlYXJjaC9zZWFyY2guaHRtbCIsInNyYy9saWJzL2NvbW1vbi9nM3cvZ3VpL3NlYXJjaC9zZWFyY2guanMiLCJzcmMvbGlicy9jb21tb24vZzN3L2d1aS90b29scy90b29scy5odG1sIiwic3JjL2xpYnMvY29tbW9uL2czdy9ndWkvdG9vbHMvdG9vbHMuanMiLCJzcmMvbGlicy9jb21tb24vZzN3L2d1aS92aWV3L3ZpZXdwb3J0Lmh0bWwiLCJzcmMvbGlicy9jb21tb24vZzN3L2d1aS92aWV3L3ZpZXdwb3J0LmpzIiwic3JjL2xpYnMvY29tbW9uL2czdy9ndWkvdnVlLmRpcmVjdGl2ZXMuanMiLCJzcmMvbGlicy9jb21tb24vZzN3L2d1aS92dWUubWl4aW5zLmpzIiwic3JjL2xpYnMvY29tbW9uL2kxOG4vaTE4bi5zZXJ2aWNlLmpzIiwic3JjL2xpYnMvbW9kdWxlcy9nM3ctZWRpdGluZy9lZGl0YnVmZmVyLmpzIiwic3JjL2xpYnMvbW9kdWxlcy9nM3ctZWRpdGluZy9lZGl0b3IuanMiLCJzcmMvbGlicy9tb2R1bGVzL2czdy1lZGl0aW5nL3Rvb2xzL2FkZGZlYXR1cmV0b29sLmpzIiwic3JjL2xpYnMvbW9kdWxlcy9nM3ctZWRpdGluZy90b29scy9jdXRsaW5ldG9vbC5qcyIsInNyYy9saWJzL21vZHVsZXMvZzN3LWVkaXRpbmcvdG9vbHMvZGVsZXRlZmVhdHVyZWludGVyYWN0aW9uLmpzIiwic3JjL2xpYnMvbW9kdWxlcy9nM3ctZWRpdGluZy90b29scy9kZWxldGVmZWF0dXJldG9vbC5qcyIsInNyYy9saWJzL21vZHVsZXMvZzN3LWVkaXRpbmcvdG9vbHMvbW9kaWZ5ZmVhdHVyZXRvb2wuanMiLCJzcmMvbGlicy9tb2R1bGVzL2czdy1lZGl0aW5nL3Rvb2xzL21vdmVwb2ludHRvb2wuanMiLCJzcmMvbGlicy9tb2R1bGVzL2czdy1lZGl0aW5nL3Rvb2xzL3BpY2tmZWF0dXJldG9vbC5qcyIsInNyYy9saWJzL21vZHVsZXMvZzN3LWVkaXRpbmcvdG9vbHMvdG9vbC5qcyIsInNyYy9saWJzL3BsdWdpbnMvZzN3LWl0ZXJuZXQvZWRpdG9ycGFuZWwuaHRtbCIsInNyYy9saWJzL3BsdWdpbnMvZzN3LWl0ZXJuZXQvZWRpdG9ycGFuZWwuanMiLCJzcmMvbGlicy9wbHVnaW5zL2czdy1pdGVybmV0L2VkaXRvcnMvYWNjZXNzaWVkaXRvci5qcyIsInNyYy9saWJzL3BsdWdpbnMvZzN3LWl0ZXJuZXQvZWRpdG9ycy9hdHRyaWJ1dGVzZm9ybS5qcyIsInNyYy9saWJzL3BsdWdpbnMvZzN3LWl0ZXJuZXQvZWRpdG9ycy9naXVuemlvbmllZGl0b3IuanMiLCJzcmMvbGlicy9wbHVnaW5zL2czdy1pdGVybmV0L2VkaXRvcnMvaXRlcm5ldGVkaXRvci5qcyIsInNyYy9saWJzL3BsdWdpbnMvZzN3LWl0ZXJuZXQvZWRpdG9ycy9zdHJhZGVlZGl0b3IuanMiLCJzcmMvbGlicy9wbHVnaW5zL2czdy1pdGVybmV0L2l0ZXJuZXRzZXJ2aWNlLmpzIiwic3JjL2xpYnMvcGx1Z2lucy9nM3ctaXRlcm5ldC9wbHVnaW4uanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUNBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzlDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNmQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzVCQTtBQUNBOztBQ0RBO0FBQ0E7O0FDREE7QUFDQTs7QUNEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDeEdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzNFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbEdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDckNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbkhBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3Z2QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzdFQTtBQUNBOztBQ0RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDakRBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN6Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMvQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN6QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNyQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN0QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2xEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDNUZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDaEVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3ZGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM1TUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNWQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbERBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdE5BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzNCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMxQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdERBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNoa0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3hCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzFEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMzS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDekpBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ25EQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDckRBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2hKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2pWQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNwSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDckhBO0FBQ0E7O0FDREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3BLQTtBQUNBOztBQ0RBO0FBQ0E7O0FDREE7QUFDQTs7QUNEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzFTQTtBQUNBOztBQ0RBO0FBQ0E7O0FDREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM1QkE7QUFDQTs7QUNEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNsQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3pDQTtBQUNBOztBQ0RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDaEVBO0FBQ0E7O0FDREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN0SEE7QUFDQTs7QUNEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2JBO0FBQ0E7O0FDREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNoQkE7QUFDQTs7QUNEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNmQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDN0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ1RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDL0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDeE9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDcmRBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzlIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNuWUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNyRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2xNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzlJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDOUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMxRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDckVBO0FBQ0E7O0FDREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdkxBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ1RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDL0VBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbElBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDaEhBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdFdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2h3QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiYnVpbGQuanMiLCJzb3VyY2VSb290IjoiL3NvdXJjZS8iLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsInZhciBwbHVnaW5zID0ge1xuICBpdGVybmV0OiAgcmVxdWlyZSgncGx1Z2lucy9nM3ctaXRlcm5ldC9wbHVnaW4nKVxufTtcblxudmFyIHRvb2xzID0ge1xuICB0b29sczogIFtdXG59O1xuXG52YXIgbWFwY29udHJvbHMgPSBbJ3pvb20nLCd6b29tYm94J107XG4vL3ZhciBtYXBjb250cm9scyA9IFsnem9vbScsJ3pvb21ib3gnLCd6b29tdG9leHRlbnQnLCdxdWVyeSddO1xuXG52YXIgaTE4biA9IHtcbiAgcmVzb3VyY2VzOiByZXF1aXJlKCcuL2xvY2FsZXMvYXBwLmpzJylcbn07XG5cbnZhciBjbGllbnQgPSAge1xuICBkZWJ1ZzogIGZhbHNlLFxuICBsb2NhbDogIGZhbHNlXG59O1xuXG52YXIgc2VydmVyID0gIHtcbiAgICB1cmxzOiAge1xuICAgICAgb3dzOiAgJy9vd3MnLFxuICAgICAgYXBpOiAgJy9hcGknLFxuICAgICAgY29uZmlnOiAgJy9hcGkvY29uZmlnJyxcbiAgICAgIHN0YXRpY3VybDogICcnXG4gICAgfVxufTtcblxudmFyIHRlbXBsYXRlcyA9ICB7XG4gIGFwcDogIHJlcXVpcmUoJy4uL3RlbXBsYXRlcy9hcHAuaHRtbCcpLFxuICBzaWRlYmFyOiAgcmVxdWlyZSgnLi4vdGVtcGxhdGVzL3NpZGViYXIuaHRtbCcpLFxuICBmbG9hdGJhcjogIHJlcXVpcmUoJy4uL3RlbXBsYXRlcy9mbG9hdGJhci5odG1sJyksXG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgY2xpZW50OiBjbGllbnQsXG4gIHNlcnZlcjogc2VydmVyLFxuICB0ZW1wbGF0ZXM6IHRlbXBsYXRlcyxcbiAgcGx1Z2luczogIHBsdWdpbnMsXG4gIHRvb2xzOiAgdG9vbHMsXG4gIG1hcDoge1xuICAgIGNvbnRyb2xzOiBtYXBjb250cm9sc1xuICB9LFxuICBpMThuOiBpMThuXG59O1xuIiwidmFyIHRyYW5zbGF0aW9ucyA9IHtcbiAgICBcIml0XCI6IHtcbiAgICAgICAgXCJ0cmFuc2xhdGlvblwiOiB7XG4gICAgICAgICAgICBcInNlYXJjaFwiOiBcIlJpY2VyY2FcIixcbiAgICAgICAgICAgIFwiY2F0YWxvZ1wiOiBcIkNhdGFsb2dvIGRhdGlcIixcbiAgICAgICAgICAgIFwiYmFzZWxheWVyc1wiOiBcIkJhc2lcIixcbiAgICAgICAgICAgIFwidG9vbHNcIjogXCJTdHJ1bWVudGlcIixcbiAgICAgICAgICAgIFwidHJlZVwiOiBcIkRhdGlcIixcbiAgICAgICAgICAgIFwibGVnZW5kXCI6IFwiTGVnZW5kYVwiLFxuICAgICAgICAgICAgXCJzdHJlZXRfc2VhcmNoXCI6IFwiQ2VyY2EgaW5kaXJpenpvXCJcbiAgICAgICAgfVxuICAgIH1cbn07XG5cbm1vZHVsZS5leHBvcnRzID0gdHJhbnNsYXRpb25zO1xuIiwidmFyIGJvb3N0cmFwID0gcmVxdWlyZSgnZzN3LWJhc2UtYXBwL2Jvb3RzdHJhcCcpO1xudmFyIE5vbWluYXRpbSA9IHJlcXVpcmUoJ2czdy9jb3JlL2dlb2NvZGluZ3NlcnZpY2UnKS5Ob21pbmF0aW07XG52YXIgR2VvY29kaW5nTGlzdFBhbmVsQ29tcG9uZW50ID0gcmVxdWlyZSgnZzN3L2d1aS9nZW9jb2RpbmcvbGlzdHBhbmVsJyk7XG52YXIgTGlzdFBhbmVsID0gcmVxdWlyZSgnZzN3L2d1aS9saXN0cGFuZWwnKS5MaXN0UGFuZWw7XG52YXIgR1VJID0gcmVxdWlyZSgnZzN3L2d1aS9ndWknKTtcblxudmFyIGNvbmZpZyA9IHJlcXVpcmUoJy4vY29uZmlnL2NvbmZpZy5qcycpO1xuXG4kKGZ1bmN0aW9uICgpeyAgXG4gIGNvbmZpZy5nZXRXbXNVcmwgPSBmdW5jdGlvbihwcm9qZWN0KXtcbiAgICByZXR1cm4gY29uZmlnLnNlcnZlci51cmxzLm93cysnLycrY29uZmlnLmdyb3VwLmlkKycvJytwcm9qZWN0LnR5cGUrJy8nK3Byb2plY3QuaWQ7XG4gIH07XG4gIGNvbmZpZy5nZXRQcm9qZWN0Q29uZmlnVXJsID0gZnVuY3Rpb24ocHJvamVjdCl7XG4gICAgcmV0dXJuIGNvbmZpZy5zZXJ2ZXIudXJscy5jb25maWcrJy8nK2NvbmZpZy5ncm91cC5pZCsnLycrcHJvamVjdC50eXBlKycvJytwcm9qZWN0LmlkO1xuICB9XG4gIFxuICBib29zdHJhcChjb25maWcpO1xuICBcbiAgTm9taW5hdGltLm9uKFwicmVzdWx0c1wiLGZ1bmN0aW9uKHJlc3VsdCxxdWVyeSl7XG4gICAgdmFyIGxpc3RQYW5lbCA9IG5ldyBMaXN0UGFuZWwoe1xuICAgICAgbmFtZTogXCJSaXN1bHRhdGkgcmljZXJjYSAnXCIrcXVlcnkrXCInXCIsXG4gICAgICBpZDogJ25vbWluYXRpbV9yZXN1bHRzJyxcbiAgICAgIGxpc3Q6IHJlc3VsdCxcbiAgICAgIGxpc3RQYW5lbENvbXBvbmVudDogR2VvY29kaW5nTGlzdFBhbmVsQ29tcG9uZW50XG4gICAgfSk7XG4gICAgR1VJLnNob3dMaXN0aW5nKGxpc3RQYW5lbCk7XG4gIH0pXG59KTtcbiIsIm1vZHVsZS5leHBvcnRzID0gXCI8ZGl2IGNsYXNzPVxcXCJ3cmFwcGVyXFxcIj5cXG4gIDxoZWFkZXIgY2xhc3M9XFxcIm1haW4taGVhZGVyXFxcIj5cXG4gICAgPCEtLSBMb2dvIC0tPlxcbiAgICA8IS0tIFxcbiAgICAtLT5cXG4gICAgPCEtLSBIZWFkZXIgTmF2YmFyOiBzdHlsZSBjYW4gYmUgZm91bmQgaW4gaGVhZGVyLmxlc3MgLS0+XFxuICAgIDxuYXYgY2xhc3M9XFxcIm5hdmJhciBuYXZiYXItc3RhdGljLXRvcFxcXCIgcm9sZT1cXFwibmF2aWdhdGlvblxcXCI+XFxuICAgICAgPCEtLSBUb2dnbGUgYnV0dG9uIG9uIG5hdmJhciBvbmx5IGZvciBtb2JpbGUgLS0+XFxuICAgICAgPGEgdi1pZj1cXFwiaXNNb2JpbGUoKVxcXCIgaHJlZj1cXFwiI1xcXCIgY2xhc3M9XFxcInNpZGViYXItdG9nZ2xlXFxcIiBkYXRhLXRvZ2dsZT1cXFwib2ZmY2FudmFzXFxcIiByb2xlPVxcXCJidXR0b25cXFwiPlxcbiAgICAgICAgPHNwYW4gY2xhc3M9XFxcInNyLW9ubHlcXFwiPkV4cGFuZDwvc3Bhbj5cXG4gICAgICA8L2E+XFxuICAgICAgPGdlb2NvZGVyIHR5cGU9XFxcIk5vbWluYXRpbVxcXCI+PC9nZW9jb2Rlcj5cXG4gICAgICA8ZGl2IGNsYXNzPVxcXCJuYXZiYXItY3VzdG9tLW1lbnVcXFwiPlxcbiAgICAgICAgPHVsIGNsYXNzPVxcXCJuYXYgbmF2YmFyLW5hdlxcXCI+XFxuICAgICAgICA8L3VsPlxcbiAgICAgIDwvZGl2PlxcbiAgICA8L25hdj5cXG4gIDwvaGVhZGVyPlxcbiAgPCEtLSBMZWZ0IHNpZGUgY29sdW1uLiBjb250YWlucyB0aGUgbG9nbyBhbmQgc2lkZWJhciAtLT5cXG4gIDxzaWRlYmFyPjwvc2lkZWJhcj5cXG5cXG4gIDwhLS0gQ29udGVudCBXcmFwcGVyLiBDb250YWlucyBwYWdlIGNvbnRlbnQgLS0+XFxuICA8ZGl2IGNsYXNzPVxcXCJjb250ZW50LXdyYXBwZXJcXFwiIHN0eWxlPVxcXCJiYWNrZ3JvdW5kLWNvbG9yOndoaXRlXFxcIj5cXG4gICAgPHZpZXdwb3J0Pjwvdmlld3BvcnQ+XFxuICA8L2Rpdj5cXG4gIDwhLS0gLy5jb250ZW50LXdyYXBwZXIgLS0+XFxuICBcXG4gIDwhLS0gXFxuICA8Zm9vdGVyIGNsYXNzPVxcXCJtYWluLWZvb3RlclxcXCI+XFxuICAgIDxkaXYgY2xhc3M9XFxcInB1bGwtcmlnaHQgaGlkZGVuLXhzXFxcIj5cXG4gICAgICA8Yj5WZXJzaW9uPC9iPiAyLjMuMlxcbiAgICA8L2Rpdj5cXG4gICAgPHN0cm9uZz5Db3B5cmlnaHQgJmNvcHk7IDIwMTQtMjAxNSA8YSBocmVmPVxcXCJodHRwOi8vYWxtc2FlZWRzdHVkaW8uY29tXFxcIj5BbG1zYWVlZCBTdHVkaW88L2E+Ljwvc3Ryb25nPiBBbGwgcmlnaHRzXFxuICAgIHJlc2VydmVkLlxcbiAgPC9mb290ZXI+XFxuICAtLT5cXG5cXG4gIDwhLS0gQ29udHJvbCBTaWRlYmFyIC0tPlxcbiAgPGZsb2F0YmFyPjwvZmxvYXRiYXI+XFxuICA8IS0tIC8uY29udHJvbC1zaWRlYmFyIC0tPlxcbiAgPCEtLSBBZGQgdGhlIHNpZGViYXIncyBiYWNrZ3JvdW5kLiBUaGlzIGRpdiBtdXN0IGJlIHBsYWNlZFxcbiAgICAgICBpbW1lZGlhdGVseSBhZnRlciB0aGUgY29udHJvbCBzaWRlYmFyIC0tPlxcbiAgPGRpdiBjbGFzcz1cXFwiY29udHJvbC1zaWRlYmFyLWJnXFxcIj48L2Rpdj5cXG48L2Rpdj5cXG5cIjtcbiIsIm1vZHVsZS5leHBvcnRzID0gXCI8YXNpZGUgY2xhc3M9XFxcImNvbnRyb2wtc2lkZWJhciBjb250cm9sLXNpZGViYXItbGlnaHRcXFwiID5cXG4gIDxhIHYtc2hvdz1cXFwicGFuZWxzaW5zdGFja1xcXCIgaHJlZj1cXFwiI1xcXCIgY2xhc3M9XFxcImZsb2F0YmFyLWFzaWRlLXRvZ2dsZVxcXCIgZGF0YS10b2dnbGU9XFxcImNvbnRyb2wtc2lkZWJhclxcXCIgcm9sZT1cXFwiYnV0dG9uXFxcIj5cXG4gICAgPHNwYW4gY2xhc3M9XFxcInNyLW9ubHlcXFwiPkV4cGFuZDwvc3Bhbj5cXG4gIDwvYT5cXG4gIDxkaXYgdi1zaG93PVxcXCJwYW5lbHNpbnN0YWNrXFxcIiBjbGFzcz1cXFwiZzN3LXNpZGViYXJwYW5lbFxcXCI+XFxuICAgIDxkaXYgY2xhc3M9XFxcInJvd1xcXCIgdi1pZj1cXFwiY2xvc2FibGVcXFwiPlxcbiAgICAgIDxkaXYgY2xhc3M9XFxcImNvbC14cy0xMiBjb2wtc20tMTIgY29sLW1kLTEyXFxcIj5cXG4gICAgICAgIDxidXR0b24gY2xhc3M9XFxcImdseXBoaWNvbiBnbHlwaGljb24tcmVtb3ZlIHB1bGwtcmlnaHQgY2xvc2UtcGFuZWwtYnV0dG9uXFxcIiBAY2xpY2s9XFxcImNsb3NlUGFuZWxcXFwiPjwvYnV0dG9uPlxcbiAgICAgIDwvZGl2PlxcbiAgICA8L2Rpdj5cXG4gICAgPGRpdj5cXG4gICAgICA8aDQgY2xhc3M9XFxcImczdy1mbG9hdGJhcnBhbmVsLW5hbWVcXFwiPnt7IHBhbmVsbmFtZSB9fTwvaDI+XFxuICAgIDwvZGl2PlxcbiAgICA8ZGl2IGlkPVxcXCJnM3ctZmxvYXRiYXJwYW5lbC1wbGFjZWhvbGRlclxcXCIgY2xhc3M9XFxcImczdy1mbG9hdGJhcnBhbmVsLXBsYWNlaG9sZGVyXFxcIj48L2Rpdj5cXG4gIDwvZGl2PlxcbjwvYXNpZGU+XFxuXCI7XG4iLCJtb2R1bGUuZXhwb3J0cyA9IFwiPGFzaWRlIGNsYXNzPVxcXCJtYWluLXNpZGViYXJcXFwiPlxcbiAgPCEtLSBzaWRlYmFyOiBzdHlsZSBjYW4gYmUgZm91bmQgaW4gc2lkZWJhci5sZXNzIC0tPlxcbiAgPCEtLSBTaWRlYmFyIHRvZ2dsZSBidXR0b24tLT5cXG4gIDwhLS0gVG9nZ2xlIGJ1dHRvbiBvbiB0aGUgbGVmdCBzaWRlIG9mIG1haW4gc2lkZWJhciBvbmx5IGlmIG5vdCBtb2JpbGUgLS0+XFxuICA8YSB2LWlmPVxcXCIhaXNNb2JpbGUoKVxcXCIgaHJlZj1cXFwiI1xcXCIgY2xhc3M9XFxcInNpZGViYXItYXNpZGUtdG9nZ2xlXFxcIiBkYXRhLXRvZ2dsZT1cXFwib2ZmY2FudmFzXFxcIiByb2xlPVxcXCJidXR0b25cXFwiPlxcbiAgICA8c3BhbiBjbGFzcz1cXFwic3Itb25seVxcXCI+RXhwYW5kPC9zcGFuPlxcbiAgPC9hPlxcblxcdDxzZWN0aW9uIGNsYXNzPVxcXCJzaWRlYmFyXFxcIj5cXG4gICAgPGRpdiB2LXNob3c9XFxcInBhbmVsc2luc3RhY2tcXFwiIGNsYXNzPVxcXCJnM3ctc2lkZWJhcnBhbmVsXFxcIj5cXG4gICAgICA8ZGl2IGNsYXNzPVxcXCJyb3dcXFwiPlxcbiAgICAgICAgPGRpdiBjbGFzcz1cXFwiY29sLXhzLTEyIGNvbC1zbS0xMiBjb2wtbWQtMTJcXFwiPlxcbiAgICAgICAgICA8YnV0dG9uIGNsYXNzPVxcXCJnbHlwaGljb24gZ2x5cGhpY29uLXJlbW92ZSBwdWxsLXJpZ2h0IGNsb3NlLXBhbmVsLWJ1dHRvblxcXCIgQGNsaWNrPVxcXCJjbG9zZVBhbmVsXFxcIj48L2J1dHRvbj48L2Rpdj5cXG4gICAgICA8L2Rpdj5cXG4gICAgICA8ZGl2PlxcbiAgICAgICAgPGg0Pnt7IHBhbmVsbmFtZSB9fTwvaDI+XFxuICAgICAgPC9kaXY+XFxuICAgICAgPGRpdiBpZD1cXFwiZzN3LXNpZGViYXJwYW5lbC1wbGFjZWhvbGRlclxcXCIgY2xhc3M9XFxcImczdy1zaWRlYmFycGFuZWwtcGxhY2Vob2xkZXJcXFwiPjwvZGl2PlxcbiAgICA8L2Rpdj5cXG4gICAgXFxuXFx0ICA8dWwgdi1zaG93PVxcXCIhcGFuZWxzaW5zdGFja1xcXCIgY2xhc3M9XFxcInNpZGViYXItbWVudVxcXCI+XFxuXFx0ICAgIDwhLS08c2lkZWJhci1pdGVtIGRhdGEtaWNvbj1cXFwiZmEgZmEtc2VhcmNoXFxcIiBkYXRhLWxhYmVsPVxcXCJzZWFyY2hcXFwiIGRhdGEtdHlwZT1cXFwiaW5saW5lXFxcIj5cXG4gICAgICAgIDxnM3ctc2VhcmNoPjwvZzN3LXNlYXJjaD5cXG4gICAgICA8L3NpZGViYXItaXRlbT4tLT5cXG4gICAgICA8c2lkZWJhci1pdGVtIG9wZW4tb24tc3RhcnQ9XFxcInRydWVcXFwiIGRhdGEtaWNvbj1cXFwiZmEgZmEtZGF0YWJhc2VcXFwiIGRhdGEtbGFiZWw9XFxcImNhdGFsb2dcXFwiIGRhdGEtdHlwZT1cXFwiaW5saW5lXFxcIj5cXG4gICAgICAgIDxnM3ctY2F0YWxvZz48L2czdy1jYXRhbG9nPlxcbiAgICAgIDwvc2lkZWJhci1pdGVtPlxcbiAgICAgIDxzaWRlYmFyLWl0ZW0gZGF0YS1pY29uPVxcXCJmYSBmYS1nZWFyc1xcXCIgZGF0YS1sYWJlbD1cXFwidG9vbHNcXFwiIGRhdGEtdHlwZT1cXFwiaW5saW5lXFxcIj5cXG4gICAgICAgIDxnM3ctdG9vbHM+PC9nM3ctdG9vbHM+XFxuICAgICAgPC9zaWRlYmFyLWl0ZW0+XFxuXFx0ICA8L3VsPlxcblxcdDwvc2VjdGlvbj5cXG5cXHQ8IS0tIC8uc2lkZWJhciAtLT5cXG48L2FzaWRlPlxcblwiO1xuIiwidmFyIGkxOG5pbml0ID0gcmVxdWlyZSgnaTE4bi9pMThuLnNlcnZpY2UnKS5pbml0O1xudmFyIHQgPSByZXF1aXJlKCdpMThuL2kxOG4uc2VydmljZScpLnQ7XG5yZXF1aXJlKCdnM3cvZ3VpL3Z1ZS5kaXJlY3RpdmVzJyk7XG52YXIgaXNNb2JpbGVNaXhpbiA9IHJlcXVpcmUoJ2czdy9ndWkvdnVlLm1peGlucycpLmlzTW9iaWxlTWl4aW47XG52YXIgbGF5b3V0ID0gcmVxdWlyZSgnLi9qcy9sYXlvdXQvbGF5b3V0Jyk7XG52YXIgYXBwID0gbnVsbDtcbnZhciBhcHBTZXJ2aWNlID0gcmVxdWlyZSgnLi9qcy9hcHAuc2VydmljZScpO1xuXG52YXIgYm9vdHN0cmFwID0gZnVuY3Rpb24gKGJhc2Vjb25maWcpe1xuICBpMThuaW5pdChiYXNlY29uZmlnLmkxOG4pO1xuICBcbiAgLy9jcmVvIHVuIGZpbHRybyB2dWUgY2hlIHRyYWR1Y2UgaWwgdGVzdG8gcGFzc2F0b1xuICBWdWUuZmlsdGVyKCd0JywgZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgcmV0dXJuIHQodmFsdWUpO1xuICB9KTtcbiAgXG4gIGlmIChiYXNlY29uZmlnLmNsaWVudC5kZWJ1Zyl7XG4gICAgVnVlLmNvbmZpZy5kZWJ1ZyA9IHRydWU7XG4gIH1cbiAgXG4gIFZ1ZS5taXhpbihpc01vYmlsZU1peGluKTtcbiAgXG4gIHZhciBTaWRlYmFyQ29tcG9uZW50ID0gcmVxdWlyZSgnZzN3LWJhc2UtYXBwL2pzL2xheW91dC9zaWRlYmFyJykuU2lkZWJhckNvbXBvbmVudDtcbiAgdmFyIEZsb2F0YmFyQ29tcG9uZW50ID0gcmVxdWlyZSgnZzN3LWJhc2UtYXBwL2pzL2xheW91dC9mbG9hdGJhcicpLkZsb2F0YmFyQ29tcG9uZW50O1xuICB2YXIgQXBwVUkgPSByZXF1aXJlKCdnM3ctYmFzZS1hcHAvanMvYXBwLnVpJyk7XG4gIFxuICB2YXIgU2lkZUJhciA9IFNpZGViYXJDb21wb25lbnQuZXh0ZW5kKHtcbiAgICBtaXhpbnM6IFtpc01vYmlsZU1peGluXSxcbiAgICB0ZW1wbGF0ZTogYmFzZWNvbmZpZy50ZW1wbGF0ZXMuc2lkZWJhcixcbiAgfSk7XG4gIFZ1ZS5jb21wb25lbnQoJ3NpZGViYXInLFNpZGVCYXIpO1xuICBcbiAgdmFyIEZsb2F0QmFyID0gRmxvYXRiYXJDb21wb25lbnQuZXh0ZW5kKHtcbiAgICB0ZW1wbGF0ZTogYmFzZWNvbmZpZy50ZW1wbGF0ZXMuZmxvYXRiYXIsXG4gIH0pO1xuICBWdWUuY29tcG9uZW50KCdmbG9hdGJhcicsRmxvYXRCYXIpO1xuICBcbiAgdmFyIFVJID0gQXBwVUkuZXh0ZW5kKHtcbiAgICB0ZW1wbGF0ZTogYmFzZWNvbmZpZy50ZW1wbGF0ZXMuYXBwLFxuICB9KTtcbiAgVnVlLmNvbXBvbmVudCgnYXBwJyxVSSk7XG4gIFxuICBmdW5jdGlvbiBjcmVhdGVDb25maWcoY29uZmlnKXtcbiAgICByZXR1cm4ge1xuICAgICAgZGVidWc6IGJhc2Vjb25maWcuY2xpZW50LmRlYnVnIHx8IGZhbHNlLFxuICAgICAgZ3JvdXA6IG51bGwsXG4gICAgICB1cmxzOiBiYXNlY29uZmlnLnNlcnZlci51cmxzLFxuICAgICAgcmVzb3VyY2VzdXJsOiBiYXNlY29uZmlnLnNlcnZlci51cmxzLnN0YXRpY3VybCxcbiAgICAgIHByb2plY3RzOiBiYXNlY29uZmlnLmdyb3VwLnByb2plY3RzLFxuICAgICAgaW5pdHByb2plY3Q6IGJhc2Vjb25maWcuZ3JvdXAuaW5pdHByb2plY3QsXG4gICAgICBiYXNlbGF5ZXJzOiBiYXNlY29uZmlnLmdyb3VwLmJhc2VsYXllcnMsXG4gICAgICBjcnM6IGJhc2Vjb25maWcuZ3JvdXAuY3JzLFxuICAgICAgbWluc2NhbGU6IGJhc2Vjb25maWcuZ3JvdXAubWluc2NhbGUsXG4gICAgICBtYXhzY2FsZTogYmFzZWNvbmZpZy5ncm91cC5tYXhzY2FsZSxcbiAgICAgIC8vIHJpY2hpZXN0byBkYSBQcm9qZWN0U2VydmljZVxuICAgICAgZ2V0V21zVXJsOiBiYXNlY29uZmlnLmdldFdtc1VybCxcbiAgICAgIC8vIHJpY2hpZXN0byBkYSBQcm9qZWN0c1JlZ2lzdHJ5XG4gICAgICBnZXRQcm9qZWN0Q29uZmlnVXJsOiBiYXNlY29uZmlnLmdldFByb2plY3RDb25maWdVcmwsXG4gICAgICBwbHVnaW5zOiB7XG4gICAgICAgIHBsdWdpbnM6IGJhc2Vjb25maWcucGx1Z2lucyxcbiAgICAgICAgY29uZmlnczogYmFzZWNvbmZpZy5ncm91cC5wbHVnaW5zXG4gICAgICB9LFxuICAgICAgdG9vbHM6IGJhc2Vjb25maWcudG9vbHMsXG4gICAgICB2aWV3czogYmFzZWNvbmZpZy52aWV3cyB8fCB7fSxcbiAgICAgIG1hcDogYmFzZWNvbmZpZy5tYXBcbiAgICB9XG4gIH07XG4gIFxuICAvL2luaXppYWxpenphIGxhIHZ1ZSBhcHBpY2F6aW9uZVxuICBmdW5jdGlvbiBydW4oKXtcbiAgICBhcHAgPSBuZXcgVnVlKHtcbiAgICAgIGVsOiAnYm9keScsXG4gICAgICByZWFkeTogZnVuY3Rpb24oKXtcbiAgICAgICAgJChkb2N1bWVudCkubG9jYWxpemUoKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfTtcbiAgXG4gIGxheW91dC5sb2FkaW5nKCk7XG4gIFxuICAvLyBpIHNlcnZpemkgc29ubyBzdGF0aSBpbml6aWFsaXp6YXRpLCBwb3NzbyBhdnZpYXJlIGwnaXN0YW56YSBWdWVcbiAgYXBwU2VydmljZS5vbigncmVhZHknLGZ1bmN0aW9uKCl7XG4gICAgcnVuKCk7XG4gIH0pO1xuICBcbiAgLy8gc2Ugc3RvIGNhcmljYW5kbyBkYWwgY2xpZW50IGczdy1hZG1pbiBpbml0Y29uZmlnIMOoIGdpw6AgaW5saW5lZFxuICBpZiAod2luZG93LmluaXRDb25maWcpIHtcbiAgICBiYXNlY29uZmlnLnNlcnZlci51cmxzLnN0YXRpY3VybCA9IGluaXRDb25maWcuc3RhdGljdXJsO1xuICAgIGJhc2Vjb25maWcuZ3JvdXAgPSB3aW5kb3cuaW5pdENvbmZpZy5ncm91cDsgLy8gY29uZmlnIGlzIGlubGluZWQgYnkgZzN3LWFkbWluIGluc2lkZSB0aGUgaW5kZXggdGVtcGxhdGUgYXMgYSA8c2NyaXB0PiB0YWdcbiAgICB2YXIgY29uZmlnID0gY3JlYXRlQ29uZmlnKGNvbmZpZyk7XG4gICAgYXBwU2VydmljZS5pbml0KGNvbmZpZyk7Ly8gZW1ldHRlIGV2ZW50byByZWFkeSBkb3BvIGF2ZXIgbGV0dG8gbGEgY29uZmlndXJhemlvbmVcbiAgfVxuICAvLyBhbHRyaW1lbnRpIGRldm8gYXNwZXR0YXJlIGNoZSBsb2NhbC5pbml0Y29uZmlnLmpzIGFiYmlhIGNhcmljYXRvIGwnaW5pdGNvbmZpZ1xuICBlbHNle1xuICAgICQoZG9jdW1lbnQpLm9uKCdpbml0Y29uZmlnUmVhZHknLGZ1bmN0aW9uKGUsaW5pdGNvbmZpZyl7XG4gICAgICBiYXNlY29uZmlnLnNlcnZlci51cmxzLnN0YXRpY3VybCA9IGluaXRjb25maWcuc3RhdGljdXJsO1xuICAgICAgYmFzZWNvbmZpZy5ncm91cCA9IGluaXRjb25maWcuZ3JvdXA7XG4gICAgICB2YXIgY29uZmlnID0gY3JlYXRlQ29uZmlnKGNvbmZpZyk7XG4gICAgICBhcHBTZXJ2aWNlLmluaXQoY29uZmlnKTtcbiAgICB9KVxuICB9XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IGJvb3RzdHJhcDtcbiIsInZhciBpbmhlcml0ID0gcmVxdWlyZSgnZzN3L2NvcmUvdXRpbHMnKS5pbmhlcml0O1xudmFyIGJhc2UgPSByZXF1aXJlKCdnM3cvY29yZS91dGlscycpLmJhc2U7XG52YXIgRzNXT2JqZWN0ID0gcmVxdWlyZSgnZzN3L2NvcmUvZzN3b2JqZWN0Jyk7XG52YXIgQXBpU2VydmljZSA9IHJlcXVpcmUoJ2czdy9jb3JlL2FwaXNlcnZpY2UnKTtcbnZhciBQcm9qZWN0c1JlZ2lzdHJ5ID0gcmVxdWlyZSgnZzN3L2NvcmUvcHJvamVjdHNyZWdpc3RyeScpO1xudmFyIFBsdWdpbnNSZWdpc3RyeSA9IHJlcXVpcmUoJ2czdy9jb3JlL3BsdWdpbnNyZWdpc3RyeScpO1xudmFyIE1hcFNlcnZpY2UgPSByZXF1aXJlKCdnM3cvY29yZS9tYXBzZXJ2aWNlJyk7XG52YXIgVG9vbHNTZXJ2aWNlID0gcmVxdWlyZSgnZzN3L2NvcmUvdG9vbHNzZXJ2aWNlJyk7XG5cbnZhciBNYXBWaWV3ID0gcmVxdWlyZSgnZzN3L2d1aS9tYXAvbWFwJyk7XG5cbnZhciBBcHBTZXJ2aWNlID0gZnVuY3Rpb24oKXtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICB0aGlzLmluaXRpYWxpemVkID0gZmFsc2U7XG4gIHRoaXMuX21vZGFsT3ZlcmxheSA9IG51bGw7XG4gIHRoaXMuY29uZmlnID0ge307XG4gIFxuICAvLyBjaGlhbWEgaWwgY29zdHJ1dHRvcmUgZGkgRzNXT2JqZWN0IChjaGUgaW4gcXVlc3RvIG1vbWVudG8gbm9uIGZhIG5pZW50ZSlcbiAgYmFzZSh0aGlzKTtcbn07XG5pbmhlcml0KEFwcFNlcnZpY2UsRzNXT2JqZWN0KTtcblxudmFyIHByb3RvID0gQXBwU2VydmljZS5wcm90b3R5cGU7XG5cbnByb3RvLmluaXQgPSBmdW5jdGlvbihjb25maWcpe1xuICB0aGlzLmNvbmZpZyA9IGNvbmZpZztcbiAgdGhpcy5fYm9vdHN0cmFwKCk7XG59O1xuXG5wcm90by5fYm9vdHN0cmFwID0gZnVuY3Rpb24oKXtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICBpZiAoIXRoaXMuaW5pdGlhbGl6ZWQpe1xuICAgIFxuICAgIC8vaW5pemlhbGl6emEgbGEgY29uZmlndXJhemlvbmUgZGVpIHNlcnZpemkuIE9nbnVuZ28gY2VyY2hlcsOgIGRhbCBjb25maWcgcXVlbGxvIGRpIGN1aSBhdnLDoCBiaXNvZ25vXG4gICAgLy91bmEgdm9sdGEgZmluaXRhIGxhIGNvbmZpZ3VyYXppb25lIGVtZXR0byBsJ2V2ZW50byByZWFkeS4gQSBxdWVzdG8gcHVudG8gcG90csOyIGF2dmlhcmUgbCdpc3RhbnphIFZ1ZSBnbG9iYWxlXG4gICAgJC53aGVuKFxuICAgICAgQXBpU2VydmljZS5pbml0KHRoaXMuY29uZmlnKSxcbiAgICAgIFByb2plY3RzUmVnaXN0cnkuaW5pdCh0aGlzLmNvbmZpZyksXG4gICAgICBQbHVnaW5zUmVnaXN0cnkuaW5pdCh0aGlzLmNvbmZpZy5wbHVnaW5zKSxcbiAgICAgIE1hcFNlcnZpY2UuaW5pdCh0aGlzLmNvbmZpZy5tYXApLFxuICAgICAgVG9vbHNTZXJ2aWNlLmluaXQodGhpcy5jb25maWcudG9vbHMpXG4gICAgKS50aGVuKGZ1bmN0aW9uKCl7XG4gICAgICBzZWxmLmVtaXQoJ3JlYWR5Jyk7XG4gICAgICB0aGlzLmluaXRpYWxpemVkID0gdHJ1ZTtcbiAgICB9KTtcbiAgfTtcbn07XG5cbnByb3RvLnNob3dNb2RhbE92ZXJsYXkgPSBmdW5jdGlvbihib29sKXtcbiAgaWYgKCF0aGlzLl9tb2RhbE92ZXJsYXkpe1xuICAgIHRoaXMuX21vZGFsT3ZlcmxheSA9ICQoJzxkaXYgaWQ9XCJnM3ctbW9kYWwtb3ZlcmxheVwiIHN0eWxlPVwiYmFja2dyb3VuZC1jb2xvcjogIzAwMDAwMDsgb3BhY2l0eTogMC43O3otaW5kZXg6NDAwMDtwb3NpdGlvbjpmaXhlZDt0b3A6MHB4O2xlZnQ6MHB4XCI+PC9kaXY+Jyk7XG4gICAgJChcImJvZHlcIikuYXBwZW5kKHRoaXMuX21vZGFsT3ZlcmxheSk7XG4gICAgdGhpcy5fbW9kYWxPdmVybGF5LndpZHRoKCQod2luZG93KS5pbm5lcldpZHRoKCkpO1xuICAgIHRoaXMuX21vZGFsT3ZlcmxheS5oZWlnaHQoJCh3aW5kb3cpLmlubmVySGVpZ2h0KCkpO1xuICB9XG4gIGlmIChfLmlzVW5kZWZpbmVkKGJvb2wpIHx8IGJvb2wgPT09IHRydWUpe1xuICAgIHRoaXMuX21vZGFsT3ZlcmxheS5zaG93KCk7XG4gIH1cbiAgZWxzZSB7XG4gICAgdGhpcy5fbW9kYWxPdmVybGF5LmhpZGUoKTtcbiAgfVxufTtcblxucHJvdG8uZ2V0RGVmYXVsdFZpZXcgPSBmdW5jdGlvbigpe1xuICB2YXIgdmlldztcbiAgaWYgKHRoaXMuY29uZmlnLnZpZXdzICYmIHRoaXMuY29uZmlnLnZpZXdzLmRlZmF1bHQpIHtcbiAgICB2aWV3ID0gdGhpcy5jb25maWcudmlld3MuZGVmYXVsdDtcbiAgfVxuICBlbHNlIHtcbiAgICB2aWV3ID0gcmVxdWlyZSgnZzN3L2d1aS9tYXAvbWFwJyk7XG4gIH1cbiAgcmV0dXJuIHZpZXcuZ2V0Vmlld0NvbXBvbmVudCgpO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBuZXcgQXBwU2VydmljZTtcbiIsInZhciB0ID0gcmVxdWlyZSgnaTE4bi9pMThuLnNlcnZpY2UnKS50O1xudmFyIE1hcFNlcnZpY2UgPSByZXF1aXJlKCdnM3cvY29yZS9tYXBzZXJ2aWNlJyk7XG52YXIgR1VJID0gcmVxdWlyZSgnZzN3L2d1aS9ndWkuanMnKTtcbnZhciBWaWV3cG9ydFNlcnZpY2UgPSByZXF1aXJlKCdnM3cvZ3VpL3ZpZXcvdmlld3BvcnQnKTtcbnJlcXVpcmUoJ2czdy9ndWkvZ2VvY29kaW5nL2dlb2NvZGluZycpO1xucmVxdWlyZSgnZzN3L2d1aS92dWUuZGlyZWN0aXZlcycpO1xuXG52YXIgbGF5b3V0ID0gcmVxdWlyZSgnLi9sYXlvdXQvbGF5b3V0Jyk7XG52YXIgU2lkZWJhclNlcnZpY2UgPSByZXF1aXJlKCcuL2xheW91dC9zaWRlYmFyJykuU2lkZWJhclNlcnZpY2U7XG52YXIgRmxvYXRiYXJTZXJ2aWNlID0gcmVxdWlyZSgnLi9sYXlvdXQvZmxvYXRiYXInKS5GbG9hdGJhclNlcnZpY2U7XG5cbnZhciBBcHBTZXJ2aWNlID0gcmVxdWlyZSgnLi9hcHAuc2VydmljZS5qcycpXG5cbnZhciBCYXNlVUkgPSBWdWUuZXh0ZW5kKHtcbiAgICByZWFkeTogZnVuY3Rpb24oKXtcbiAgICAgIC8qIHN0YXJ0IHRvIHJlbmRlciBMYXlvdXRNYW5hZ2VyIGxheW91dCAqL1xuICAgICAgbGF5b3V0LmxvYWRpbmcoZmFsc2UpO1xuICAgICAgbGF5b3V0LnNldHVwKCk7XG4gICAgICAkKFwiYm9keVwiKS50b2dnbGVDbGFzcyhcImZpeGVkXCIpO1xuICAgICAgXG4gICAgICBsYXlvdXQubGF5b3V0LmZpeFNpZGViYXIoKTtcbiAgICAgIC8vRml4IHRoZSBwcm9ibGVtIHdpdGggcmlnaHQgc2lkZWJhciBhbmQgbGF5b3V0IGJveGVkXG4gICAgICBsYXlvdXQucHVzaE1lbnUuZXhwYW5kT25Ib3ZlcigpO1xuICAgICAgbGF5b3V0LmxheW91dC5hY3RpdmF0ZSgpO1xuICAgICAgbGF5b3V0LmNvbnRyb2xTaWRlYmFyLl9maXgoJChcIi5jb250cm9sLXNpZGViYXItYmdcIikpO1xuICAgICAgbGF5b3V0LmNvbnRyb2xTaWRlYmFyLl9maXgoJChcIi5jb250cm9sLXNpZGViYXJcIikpO1xuICAgICAgXG4gICAgICBGbG9hdGJhclNlcnZpY2UuaW5pdChsYXlvdXQpO1xuXG4gICAgICBcbiAgICAgIHZhciBjb250cm9sc2lkZWJhckVsID0gbGF5b3V0Lm9wdGlvbnMuY29udHJvbFNpZGViYXJPcHRpb25zLnNlbGVjdG9yO1xuICAgICAgXG4gICAgICBmdW5jdGlvbiBzZXRGbG9hdEJhck1heEhlaWdodCgpe1xuICAgICAgICAkKGNvbnRyb2xzaWRlYmFyRWwpLmNzcygnbWF4LWhlaWdodCcsJCh3aW5kb3cpLmlubmVySGVpZ2h0KCkpO1xuICAgICAgICAkKCcuZzN3LXNpZGViYXJwYW5lbCcpLmhlaWdodCgkKHdpbmRvdykuaW5uZXJIZWlnaHQoKS0kKCcubWFpbi1oZWFkZXInKS5pbm5lckhlaWdodCgpKTtcbiAgICAgIH1cbiAgICAgIHNldEZsb2F0QmFyTWF4SGVpZ2h0KCk7XG4gICAgICBcbiAgICAgIGZ1bmN0aW9uIHNldE1vZGFsSGVpZ2h0KCl7XG4gICAgICAgICQoJyNnM3ctbW9kYWwtb3ZlcmxheScpLmhlaWdodCgkKHdpbmRvdykuaW5uZXJIZWlnaHQoKSk7XG4gICAgICB9XG4gICAgICBcbiAgICAgICQod2luZG93KS5yZXNpemUoZnVuY3Rpb24oKSB7XG4gICAgICAgIHNldEZsb2F0QmFyTWF4SGVpZ2h0KCk7XG4gICAgICAgIHNldE1vZGFsSGVpZ2h0KCk7XG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgLyokKGNvbnRyb2xzaWRlYmFyRWwpLnNsaW1TY3JvbGwoe1xuICAgICAgICAgIGhlaWdodDogbWFpbkhlaWdodCgpXG4gICAgICB9KTsqL1xuICAgICAgXG4gICAgICBWaWV3cG9ydFNlcnZpY2Uuc2V0VmlldyhBcHBTZXJ2aWNlLmdldERlZmF1bHRWaWV3KCkpO1xuICAgICAgXG4gICAgICAgICAgLy8gZGVmaW5pc2NvIChpbXBsZW1lbnRvKSBpIG1ldG9kaSBkZWxsJ0FQSSBnbG9iYWxlIGRlbGxhIEdVSVxuICAgICAgR1VJLmdldFJlc291cmNlc1VybCA9IGZ1bmN0aW9uKCl7IHJldHVybiBBcHBTZXJ2aWNlLmNvbmZpZy5yZXNvdXJjZXN1cmwgfTtcbiAgICAgIC8vIG1vc3RyYSB1biBwYW5uZWxsbyBuZWxsYSBmbG9hdGJhclxuICAgICAgR1VJLnNob3dGb3JtID0gXy5iaW5kKEZsb2F0YmFyU2VydmljZS5zaG93UGFuZWwsRmxvYXRiYXJTZXJ2aWNlKTtcbiAgICAgIEdVSS5jbG9zZUZvcm0gPSBfLmJpbmQoRmxvYXRiYXJTZXJ2aWNlLmNsb3NlUGFuZWwsRmxvYXRiYXJTZXJ2aWNlKTtcbiAgICAgIEdVSS5zaG93TGlzdGluZyA9IF8uYmluZChGbG9hdGJhclNlcnZpY2Uuc2hvd1BhbmVsLEZsb2F0YmFyU2VydmljZSk7XG4gICAgICBHVUkuY2xvc2VMaXN0aW5nID0gXy5iaW5kKEZsb2F0YmFyU2VydmljZS5jbG9zZVBhbmVsLEZsb2F0YmFyU2VydmljZSk7XG4gICAgICBHVUkuaGlkZUxpc3RpbmcgPSBfLmJpbmQoRmxvYXRiYXJTZXJ2aWNlLmhpZGVQYW5lbCxGbG9hdGJhclNlcnZpY2UpO1xuICAgICAgLy8gbW9zdHJhIHVuIHBhbm5lbGxvIG5lbGxhIHNpZGViYXJcbiAgICAgIEdVSS5zaG93UGFuZWwgPSBfLmJpbmQoU2lkZWJhclNlcnZpY2Uuc2hvd1BhbmVsLFNpZGViYXJTZXJ2aWNlKTtcblxuICAgICAgR1VJLnNldE1vZGFsID0gXy5iaW5kKEFwcFNlcnZpY2Uuc2hvd01vZGFsT3ZlcmxheSxBcHBTZXJ2aWNlKTtcbiAgICAgIFxuICAgICAgR1VJLnNob3dTcGlubmVyID0gZnVuY3Rpb24ob3B0aW9ucyl7XG4gICAgICAgIHZhciBjb250YWluZXIgPSBvcHRpb25zLmNvbnRhaW5lciB8fCAnYm9keSc7XG4gICAgICAgIHZhciBpZCA9IG9wdGlvbnMuaWQgfHwgJ2xvYWRzcGlubmVyJztcbiAgICAgICAgdmFyIHdoZXJlID0gb3B0aW9ucy53aGVyZSB8fCAncHJlcGVuZCc7IC8vIGFwcGVuZCB8IHByZXBlbmRcbiAgICAgICAgdmFyIHN0eWxlID0gb3B0aW9ucy5zdHlsZSB8fCAnJztcbiAgICAgICAgdmFyIHRyYW5zcGFyZW50ID0gb3B0aW9ucy50cmFuc3BhcmVudCA/ICdiYWNrZ3JvdW5kLWNvbG9yOiB0cmFuc3BhcmVudCcgOiAnJztcbiAgICAgICAgJChjb250YWluZXIpW3doZXJlXS5jYWxsKCQoY29udGFpbmVyKSwnPGRpdiBpZD1cIicraWQrJ1wiIGNsYXNzPVwic3Bpbm5lci13cmFwcGVyICcrc3R5bGUrJ1wiIHN0eWxlPVwiJyt0cmFuc3BhcmVudCsnXCI+PGRpdiBjbGFzcz1cInNwaW5uZXIgJytzdHlsZSsnXCI+PC9kaXY+PC9kaXY+Jyk7XG4gICAgICB9O1xuICAgICAgXG4gICAgICBHVUkuaGlkZVNwaW5uZXIgPSBmdW5jdGlvbihpZCl7XG4gICAgICAgICQoXCIjXCIraWQpLnJlbW92ZSgpO1xuICAgICAgfVxuICAgICAgXG4gICAgICBHVUkucmVhZHkoKTtcbiAgICAgIFxuICAgICAgJChNYXBTZXJ2aWNlLmdldFZpZXdwb3J0KCkpLnByZXBlbmQoJzxkaXYgaWQ9XCJtYXAtc3Bpbm5lclwiIHN0eWxlPVwicG9zaXRpb246YWJzb2x1dGU7cmlnaHQ6MHB4O1wiPjwvZGl2PicpXG4gICAgICBcbiAgICAgIE1hcFNlcnZpY2Uub24oJ2xvYWRzdGFydCcsZnVuY3Rpb24oKXtcbiAgICAgICAgR1VJLnNob3dTcGlubmVyKHtcbiAgICAgICAgICBjb250YWluZXI6ICQoJyNtYXAtc3Bpbm5lcicpLFxuICAgICAgICAgIGlkOiAnbWFwbG9hZHNwaW5uZXInLFxuICAgICAgICAgIHN0eWxlOiAnYmx1ZSdcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgTWFwU2VydmljZS5vbignbG9hZGVuZCcsZnVuY3Rpb24oKXtcbiAgICAgICAgR1VJLmhpZGVTcGlubmVyKCdtYXBsb2Fkc3Bpbm5lcicpO1xuICAgICAgfSk7XG4gICAgfVxufSk7XG5cbm1vZHVsZS5leHBvcnRzID0gQmFzZVVJO1xuIiwidmFyIGluaGVyaXQgPSByZXF1aXJlKCdnM3cvY29yZS91dGlscycpLmluaGVyaXQ7XG52YXIgRzNXT2JqZWN0ID0gcmVxdWlyZSgnZzN3L2NvcmUvZzN3b2JqZWN0Jyk7XG5cbmZ1bmN0aW9uIEJhclN0YWNrKCl7XG4gIHRoaXMuX3BhbmVscyA9IFtdO1xuICB0aGlzLnN0YXRlID0ge1xuICAgIHBhbmVsczogW11cbiAgfTtcbn1cbmluaGVyaXQoQmFyU3RhY2ssRzNXT2JqZWN0KTtcblxudmFyIHByb3RvID0gQmFyU3RhY2sucHJvdG90eXBlO1xuXG5wcm90by5wdXNoID0gZnVuY3Rpb24ocGFuZWwsY29udGFpbmVyKXtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICByZXR1cm4gcGFuZWwub25TaG93KGNvbnRhaW5lcilcbiAgLnRoZW4oZnVuY3Rpb24oKXtcbiAgICBzZWxmLl9wYW5lbHMucHVzaChwYW5lbCk7XG4gICAgc2VsZi5zdGF0ZS5wYW5lbHMucHVzaCh7XG4gICAgICBpZDogcGFuZWwuaWQsXG4gICAgICBuYW1lOiBwYW5lbC5uYW1lXG4gICAgfSk7XG4gIH0pO1xufTtcblxucHJvdG8ucG9wID0gZnVuY3Rpb24oKXtcbiAgLy8gcXVpIHBvdHJlbW8gY2hpZWRlcmUgYWwgcGFubmVsbG8gc2UgcHXDsiBlc3NlcmUgY2hpdXNvLi4uXG4gIHZhciBzZWxmID0gdGhpcztcbiAgdmFyIHBhbmVsID0gdGhpcy5fcGFuZWxzLnNsaWNlKC0xKVswXTtcbiAgcmV0dXJuIHBhbmVsLm9uQ2xvc2UoKVxuICAudGhlbihmdW5jdGlvbigpe1xuICAgIHNlbGYuc3RhdGUucGFuZWxzLnBvcCgpO1xuICAgIHNlbGYuX3BhbmVscy5wb3AoKTtcbiAgfSk7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IEJhclN0YWNrO1xuIiwidmFyIHQgPSByZXF1aXJlKCdpMThuL2kxOG4uc2VydmljZScpLnQ7XG52YXIgU3RhY2sgPSByZXF1aXJlKCcuL2JhcnN0YWNrLmpzJyk7XG52YXIgR1VJID0gcmVxdWlyZSgnZzN3L2d1aS9ndWknKTtcblxuZnVuY3Rpb24gRmxvYXRiYXJTZXJ2aWNlKCl7XG4gIHRoaXMuc3RhY2sgPSBuZXcgU3RhY2soKTtcbiAgXG4gIHRoaXMuaW5pdCA9IGZ1bmN0aW9uKGxheW91dCl7XG4gICAgdGhpcy5sYXlvdXQgPSBsYXlvdXQ7XG4gICAgdGhpcy5jbG9zYWJsZSA9IHRydWU7XG4gICAgdGhpcy5zaWRlYmFyRWwgPSAkKHRoaXMubGF5b3V0Lm9wdGlvbnMuY29udHJvbFNpZGViYXJPcHRpb25zLnNlbGVjdG9yKTtcbiAgICB0aGlzLl96aW5kZXggPSB0aGlzLnNpZGViYXJFbC5jc3MoXCJ6LWluZGV4XCIpO1xuICAgIHRoaXMuX21vZGFsT3ZlcmxheSA9IG51bGw7XG4gICAgdGhpcy5fbW9kYWwgPSBmYWxzZTtcbiAgfTtcbiAgXG4gIHRoaXMuc2hvd1BhbmVsID0gZnVuY3Rpb24ocGFuZWwsb3B0aW9ucyl7XG4gICAgdmFyIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuICAgIHZhciBtb2RhbCA9IG9wdGlvbnMubW9kYWwgfHwgZmFsc2U7XG4gICAgdGhpcy5jbG9zYWJsZSA9IG9wdGlvbnMuY2xvc2FibGUgfHwgdHJ1ZTtcbiAgICB0aGlzLnN0YWNrLnB1c2gocGFuZWwsXCIjZzN3LWZsb2F0YmFycGFuZWwtcGxhY2Vob2xkZXJcIilcbiAgICAudGhlbihmdW5jdGlvbigpe1xuICAgICAgLyokKCdpbnB1dCcpLmlDaGVjayh7XG4gICAgICAgIGNoZWNrYm94Q2xhc3M6ICdpY2hlY2tib3hfc3F1YXJlLWJsdWUnXG4gICAgICB9KTsqL1xuICAgIH0pXG4gICAgdGhpcy5sYXlvdXQuZmxvYXRCYXIub3Blbih0aGlzLnNpZGViYXJFbCx0cnVlKTtcbiAgICBpZiAobW9kYWwpe1xuICAgICAgdGhpcy5fbW9kYWwgPSB0cnVlO1xuICAgICAgR1VJLnNldE1vZGFsKCk7XG4gICAgICB0aGlzLnNpZGViYXJFbC5jc3MoXCJ6LWluZGV4XCIsNTAwMCk7XG4gICAgICB0aGlzLnNpZGViYXJFbC5jc3MoXCJwYWRkaW5nLXRvcFwiLFwiMHB4XCIpO1xuICAgICAgJCgnLmNvbnRyb2wtc2lkZWJhci1iZycpLmNzcyhcInotaW5kZXhcIiw0OTk5KTtcbiAgICAgICQoJy5jb250cm9sLXNpZGViYXItYmcnKS50b2dnbGVDbGFzcygnY29udHJvbC1zaWRlYmFyLWJnLXNoYWRvdycpO1xuICAgIH1cbiAgICBcbiAgfTtcbiAgXG4gIHRoaXMuY2xvc2VQYW5lbCA9IGZ1bmN0aW9uKCl7XG4gICAgdmFyIHBhbmVsID0gdGhpcy5zdGFjay5wb3AoKTtcbiAgICBpZiAocGFuZWwpe1xuICAgICAgaWYgKF8uaGFzSW4ocGFuZWwsXCIkZGVzdHJveVwiKSl7XG4gICAgICAgIHBhbmVsLiRkZXN0cm95KCk7XG4gICAgICB9XG4gICAgfTtcbiAgICBpZiAoIXRoaXMuc3RhY2subGVuZ3RoKSB7XG4gICAgICBpZiAodGhpcy5fbW9kYWwpe1xuICAgICAgICBHVUkuc2V0TW9kYWwoZmFsc2UpO1xuICAgICAgICB0aGlzLmxheW91dC5mbG9hdEJhci5jbG9zZSh0aGlzLnNpZGViYXJFbCx0cnVlKTtcbiAgICAgICAgJCgnLmNvbnRyb2wtc2lkZWJhci1iZycpLnRvZ2dsZUNsYXNzKCdjb250cm9sLXNpZGViYXItYmctc2hhZG93Jyk7XG4gICAgICAgIHRoaXMuc2lkZWJhckVsLmNzcyhcInotaW5kZXhcIixcIlwiKTtcbiAgICAgICAgdGhpcy5zaWRlYmFyRWwuY3NzKFwicGFkZGluZy10b3BcIixcIjUwcHhcIik7XG4gICAgICAgICQoJy5jb250cm9sLXNpZGViYXItYmcnKS5jc3MoXCJ6LWluZGV4XCIsXCJcIik7XG4gICAgICAgIHRoaXMuX21vZGFsID0gZmFsc2U7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgdGhpcy5sYXlvdXQuZmxvYXRCYXIuY2xvc2UodGhpcy5zaWRlYmFyRWwsdHJ1ZSk7XG4gICAgICB9XG4gICAgfVxuICB9O1xuICBcbiAgdGhpcy5oaWRlUGFuZWwgPSBmdW5jdGlvbigpe1xuICAgIHRoaXMubGF5b3V0LmZsb2F0QmFyLmNsb3NlKHRoaXMuc2lkZWJhckVsLHRydWUpO1xuICB9O1xufVxuXG52YXIgZmxvYXRiYXJTZXJ2aWNlID0gbmV3IEZsb2F0YmFyU2VydmljZSgpO1xuXG52YXIgRmxvYXRiYXJDb21wb25lbnQgPSBWdWUuZXh0ZW5kKHtcbiAgICBkYXRhOiBmdW5jdGlvbigpIHtcbiAgICBcdHJldHVybiB7XG4gICAgICAgIHN0YWNrOiBmbG9hdGJhclNlcnZpY2Uuc3RhY2suc3RhdGUsXG4gICAgICB9O1xuICAgIH0sXG4gICAgY29tcHV0ZWQ6IHtcbiAgICAgIC8vIHF1YW50aSBwYW5uZWxsaSBzb25vIGF0dGl2aSBuZWxsbyBzdGFja1xuICAgICAgcGFuZWxzaW5zdGFjazogZnVuY3Rpb24oKXtcbiAgICAgICAgcmV0dXJuIHRoaXMuc3RhY2sucGFuZWxzLmxlbmd0aD4wO1xuICAgICAgfSxcbiAgICAgIHBhbmVsbmFtZTogZnVuY3Rpb24oKXtcbiAgICAgICAgdmFyIG5hbWUgPSBcIlwiO1xuICAgICAgICBpZiAodGhpcy5zdGFjay5wYW5lbHMubGVuZ3RoKXtcbiAgICAgICAgICBuYW1lID0gdGhpcy5zdGFjay5wYW5lbHMuc2xpY2UoLTEpWzBdLm5hbWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG5hbWU7XG4gICAgICB9LFxuICAgICAgY2xvc2FibGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gZmxvYXRiYXJTZXJ2aWNlLmNsb3NhYmxlO1xuICAgICAgfVxuICAgIH0sXG4gICAgd2F0Y2g6IHtcbiAgICAgIC8vIFRPRE86IEJydXR0bywgbWEgw6ggbCd1bmljbyAocGVyIG9yYSkgbW9kbyBmbGVzc2liaWxlIGNoZSBobyB0cm92YXRvIHBlciBpbXBsZW1lbnRhcmUgaWwgY29uY2V0dG8gZGkgc3RhY2suLi4gXG4gICAgICBcInN0YWNrLnBhbmVsc1wiOiBmdW5jdGlvbigpe1xuICAgICAgICB2YXIgY2hpbGRyZW4gPSAkKFwiI2czdy1mbG9hdGJhcnBhbmVsLXBsYWNlaG9sZGVyXCIpLmNoaWxkcmVuKCk7XG4gICAgICAgIF8uZm9yRWFjaChjaGlsZHJlbixmdW5jdGlvbihjaGlsZCxpbmRleCl7XG4gICAgICAgICAgaWYgKGluZGV4ID09IGNoaWxkcmVuLmxlbmd0aC0xKXtcbiAgICAgICAgICAgICQoY2hpbGQpLnNob3coKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAkKGNoaWxkKS5oaWRlKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9KVxuICAgICAgfVxuICAgIH0sXG4gICAgbWV0aG9kczoge1xuICAgICAgY2xvc2VQYW5lbDogZnVuY3Rpb24oKXtcbiAgICAgICAgZmxvYXRiYXJTZXJ2aWNlLmNsb3NlUGFuZWwoKTtcbiAgICAgIH1cbiAgICB9XG59KTtcblxubW9kdWxlLmV4cG9ydHMgPSB7XG4gIEZsb2F0YmFyU2VydmljZTogZmxvYXRiYXJTZXJ2aWNlLFxuICBGbG9hdGJhckNvbXBvbmVudDogRmxvYXRiYXJDb21wb25lbnRcbn1cbiIsIi8vTWFrZSBzdXJlIGpRdWVyeSBoYXMgYmVlbiBsb2FkZWQgYmVmb3JlIGFwcC5qc1xuaWYgKHR5cGVvZiBqUXVlcnkgPT09IFwidW5kZWZpbmVkXCIpIHtcbiAgdGhyb3cgbmV3IEVycm9yKFwiTGF5b3V0TWFuYWdlciByZXF1aXJlcyBqUXVlcnlcIik7XG59XG5cbiQuTGF5b3V0TWFuYWdlciA9IHt9O1xuXG4vKiAtLS0tLS0tLS0tLS0tLS0tLS0tLVxuICogLSBMYXlvdXRNYW5hZ2VyIE9wdGlvbnMgLVxuICogLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAqIE1vZGlmeSB0aGVzZSBvcHRpb25zIHRvIHN1aXQgeW91ciBpbXBsZW1lbnRhdGlvblxuICovXG4kLkxheW91dE1hbmFnZXIub3B0aW9ucyA9IHtcbiAgLy9BZGQgc2xpbXNjcm9sbCB0byBuYXZiYXIgbWVudXNcbiAgLy9UaGlzIHJlcXVpcmVzIHlvdSB0byBsb2FkIHRoZSBzbGltc2Nyb2xsIHBsdWdpblxuICAvL2luIGV2ZXJ5IHBhZ2UgYmVmb3JlIGFwcC5qc1xuICBuYXZiYXJNZW51U2xpbXNjcm9sbDogdHJ1ZSxcbiAgbmF2YmFyTWVudVNsaW1zY3JvbGxXaWR0aDogXCIwcHhcIiwgLy9UaGUgd2lkdGggb2YgdGhlIHNjcm9sbCBiYXJcbiAgbmF2YmFyTWVudUhlaWdodDogXCIyMDBweFwiLCAvL1RoZSBoZWlnaHQgb2YgdGhlIGlubmVyIG1lbnVcbiAgLy9HZW5lcmFsIGFuaW1hdGlvbiBzcGVlZCBmb3IgSlMgYW5pbWF0ZWQgZWxlbWVudHMgc3VjaCBhcyBib3ggY29sbGFwc2UvZXhwYW5kIGFuZFxuICAvL3NpZGViYXIgdHJlZXZpZXcgc2xpZGUgdXAvZG93bi4gVGhpcyBvcHRpb25zIGFjY2VwdHMgYW4gaW50ZWdlciBhcyBtaWxsaXNlY29uZHMsXG4gIC8vJ2Zhc3QnLCAnbm9ybWFsJywgb3IgJ3Nsb3cnXG4gIGFuaW1hdGlvblNwZWVkOidmYXN0JyxcbiAgLy9TaWRlYmFyIHB1c2ggbWVudSB0b2dnbGUgYnV0dG9uIHNlbGVjdG9yXG4gIHNpZGViYXJUb2dnbGVTZWxlY3RvcjogXCJbZGF0YS10b2dnbGU9J29mZmNhbnZhcyddXCIsXG4gIC8vQWN0aXZhdGUgc2lkZWJhciBwdXNoIG1lbnVcbiAgc2lkZWJhclB1c2hNZW51OiB0cnVlLFxuICAvL0FjdGl2YXRlIHNpZGViYXIgc2xpbXNjcm9sbCBpZiB0aGUgZml4ZWQgbGF5b3V0IGlzIHNldCAocmVxdWlyZXMgU2xpbVNjcm9sbCBQbHVnaW4pXG4gIHNpZGViYXJTbGltU2Nyb2xsOiBmYWxzZSxcbiAgLy9FbmFibGUgc2lkZWJhciBleHBhbmQgb24gaG92ZXIgZWZmZWN0IGZvciBzaWRlYmFyIG1pbmlcbiAgLy9UaGlzIG9wdGlvbiBpcyBmb3JjZWQgdG8gdHJ1ZSBpZiBib3RoIHRoZSBmaXhlZCBsYXlvdXQgYW5kIHNpZGViYXIgbWluaVxuICAvL2FyZSB1c2VkIHRvZ2V0aGVyXG4gIHNpZGViYXJFeHBhbmRPbkhvdmVyOiBmYWxzZSxcbiAgLy9Cb3hSZWZyZXNoIFBsdWdpblxuICBlbmFibGVCb3hSZWZyZXNoOiB0cnVlLFxuICAvL0Jvb3RzdHJhcC5qcyB0b29sdGlwXG4gIGVuYWJsZUJTVG9wcGx0aXA6IHRydWUsXG4gIEJTVG9vbHRpcFNlbGVjdG9yOiBcIltkYXRhLXRvZ2dsZT0ndG9vbHRpcCddXCIsXG4gIC8vRW5hYmxlIEZhc3QgQ2xpY2suIEZhc3RjbGljay5qcyBjcmVhdGVzIGEgbW9yZVxuICAvL25hdGl2ZSB0b3VjaCBleHBlcmllbmNlIHdpdGggdG91Y2ggZGV2aWNlcy4gSWYgeW91XG4gIC8vY2hvb3NlIHRvIGVuYWJsZSB0aGUgcGx1Z2luLCBtYWtlIHN1cmUgeW91IGxvYWQgdGhlIHNjcmlwdFxuICAvL2JlZm9yZSBMYXlvdXRNYW5hZ2VyJ3MgYXBwLmpzXG4gIGVuYWJsZUZhc3RjbGljazogdHJ1ZSxcbiAgLy9Db250cm9sIFNpZGViYXIgT3B0aW9uc1xuICBlbmFibGVDb250cm9sU2lkZWJhcjogdHJ1ZSxcbiAgY29udHJvbFNpZGViYXJPcHRpb25zOiB7XG4gICAgLy9XaGljaCBidXR0b24gc2hvdWxkIHRyaWdnZXIgdGhlIG9wZW4vY2xvc2UgZXZlbnRcbiAgICB0b2dnbGVCdG5TZWxlY3RvcjogXCJbZGF0YS10b2dnbGU9J2NvbnRyb2wtc2lkZWJhciddXCIsXG4gICAgLy9UaGUgc2lkZWJhciBzZWxlY3RvclxuICAgIHNlbGVjdG9yOiBcIi5jb250cm9sLXNpZGViYXJcIixcbiAgICAvL0VuYWJsZSBzbGlkZSBvdmVyIGNvbnRlbnRcbiAgICBzbGlkZTogdHJ1ZVxuICB9LFxuICAvL0JveCBXaWRnZXQgUGx1Z2luLiBFbmFibGUgdGhpcyBwbHVnaW5cbiAgLy90byBhbGxvdyBib3hlcyB0byBiZSBjb2xsYXBzZWQgYW5kL29yIHJlbW92ZWRcbiAgZW5hYmxlQm94V2lkZ2V0OiB0cnVlLFxuICAvL0JveCBXaWRnZXQgcGx1Z2luIG9wdGlvbnNcbiAgYm94V2lkZ2V0T3B0aW9uczoge1xuICAgIGJveFdpZGdldEljb25zOiB7XG4gICAgICAvL0NvbGxhcHNlIGljb25cbiAgICAgIGNvbGxhcHNlOiAnZmEtbWludXMnLFxuICAgICAgLy9PcGVuIGljb25cbiAgICAgIG9wZW46ICdmYS1wbHVzJyxcbiAgICAgIC8vUmVtb3ZlIGljb25cbiAgICAgIHJlbW92ZTogJ2ZhLXRpbWVzJ1xuICAgIH0sXG4gICAgYm94V2lkZ2V0U2VsZWN0b3JzOiB7XG4gICAgICAvL1JlbW92ZSBidXR0b24gc2VsZWN0b3JcbiAgICAgIHJlbW92ZTogJ1tkYXRhLXdpZGdldD1cInJlbW92ZVwiXScsXG4gICAgICAvL0NvbGxhcHNlIGJ1dHRvbiBzZWxlY3RvclxuICAgICAgY29sbGFwc2U6ICdbZGF0YS13aWRnZXQ9XCJjb2xsYXBzZVwiXSdcbiAgICB9XG4gIH0sXG4gIC8vRGlyZWN0IENoYXQgcGx1Z2luIG9wdGlvbnNcbiAgZGlyZWN0Q2hhdDoge1xuICAgIC8vRW5hYmxlIGRpcmVjdCBjaGF0IGJ5IGRlZmF1bHRcbiAgICBlbmFibGU6IHRydWUsXG4gICAgLy9UaGUgYnV0dG9uIHRvIG9wZW4gYW5kIGNsb3NlIHRoZSBjaGF0IGNvbnRhY3RzIHBhbmVcbiAgICBjb250YWN0VG9nZ2xlU2VsZWN0b3I6ICdbZGF0YS13aWRnZXQ9XCJjaGF0LXBhbmUtdG9nZ2xlXCJdJ1xuICB9LFxuICAvL0RlZmluZSB0aGUgc2V0IG9mIGNvbG9ycyB0byB1c2UgZ2xvYmFsbHkgYXJvdW5kIHRoZSB3ZWJzaXRlXG4gIGNvbG9yczoge1xuICAgIGxpZ2h0Qmx1ZTogXCIjM2M4ZGJjXCIsXG4gICAgcmVkOiBcIiNmNTY5NTRcIixcbiAgICBncmVlbjogXCIjMDBhNjVhXCIsXG4gICAgYXF1YTogXCIjMDBjMGVmXCIsXG4gICAgeWVsbG93OiBcIiNmMzljMTJcIixcbiAgICBibHVlOiBcIiMwMDczYjdcIixcbiAgICBuYXZ5OiBcIiMwMDFGM0ZcIixcbiAgICB0ZWFsOiBcIiMzOUNDQ0NcIixcbiAgICBvbGl2ZTogXCIjM0Q5OTcwXCIsXG4gICAgbGltZTogXCIjMDFGRjcwXCIsXG4gICAgb3JhbmdlOiBcIiNGRjg1MUJcIixcbiAgICBmdWNoc2lhOiBcIiNGMDEyQkVcIixcbiAgICBwdXJwbGU6IFwiIzhFMjRBQVwiLFxuICAgIG1hcm9vbjogXCIjRDgxQjYwXCIsXG4gICAgYmxhY2s6IFwiIzIyMjIyMlwiLFxuICAgIGdyYXk6IFwiI2QyZDZkZVwiXG4gIH0sXG4gIC8vVGhlIHN0YW5kYXJkIHNjcmVlbiBzaXplcyB0aGF0IGJvb3RzdHJhcCB1c2VzLlxuICAvL0lmIHlvdSBjaGFuZ2UgdGhlc2UgaW4gdGhlIHZhcmlhYmxlcy5sZXNzIGZpbGUsIGNoYW5nZVxuICAvL3RoZW0gaGVyZSB0b28uXG4gIHNjcmVlblNpemVzOiB7XG4gICAgeHM6IDQ4MCxcbiAgICBzbTogNzY4LFxuICAgIG1kOiA5OTIsXG4gICAgbGc6IDEyMDBcbiAgfVxufTtcblxuXG4vKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gKiAtIEluaXRpYWxpemUgdGhlIExheW91dE1hbmFnZXIgT2JqZWN0IC1cbiAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAqIEFsbCBMYXlvdXRNYW5hZ2VyIGZ1bmN0aW9ucyBhcmUgaW1wbGVtZW50ZWQgYmVsb3cuXG4gKi9cbiQuTGF5b3V0TWFuYWdlci5faW5pdCA9IGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG4gIC8qIExheW91dFxuICAgKiA9PT09PT1cbiAgICogRml4ZXMgdGhlIGxheW91dCBoZWlnaHQgaW4gY2FzZSBtaW4taGVpZ2h0IGZhaWxzLlxuICAgKlxuICAgKiBAdHlwZSBPYmplY3RcbiAgICogQHVzYWdlICQuTGF5b3V0TWFuYWdlci5sYXlvdXQuYWN0aXZhdGUoKVxuICAgKiAgICAgICAgJC5MYXlvdXRNYW5hZ2VyLmxheW91dC5maXgoKVxuICAgKiAgICAgICAgJC5MYXlvdXRNYW5hZ2VyLmxheW91dC5maXhTaWRlYmFyKClcbiAgICovXG4gICQuTGF5b3V0TWFuYWdlci5sYXlvdXQgPSB7XG4gICAgYWN0aXZhdGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICBfdGhpcy5maXgoKTtcbiAgICAgIF90aGlzLmZpeFNpZGViYXIoKTtcbiAgICAgICQod2luZG93LCBcIi53cmFwcGVyXCIpLnJlc2l6ZShmdW5jdGlvbiAoKSB7XG4gICAgICAgIF90aGlzLmZpeCgpO1xuICAgICAgICBfdGhpcy5maXhTaWRlYmFyKCk7XG4gICAgICB9KTtcbiAgICB9LFxuICAgIGZpeDogZnVuY3Rpb24gKCkge1xuICAgICAgLy9HZXQgd2luZG93IGhlaWdodCBhbmQgdGhlIHdyYXBwZXIgaGVpZ2h0XG4gICAgICB2YXIgbmVnID0gJCgnLm1haW4taGVhZGVyJykub3V0ZXJIZWlnaHQoKSArICQoJy5tYWluLWZvb3RlcicpLm91dGVySGVpZ2h0KCk7XG4gICAgICB2YXIgd2luZG93X2hlaWdodCA9ICQod2luZG93KS5oZWlnaHQoKTtcbiAgICAgIHZhciBzaWRlYmFyX2hlaWdodCA9ICQoXCIuc2lkZWJhclwiKS5oZWlnaHQoKTtcbiAgICAgIC8vU2V0IHRoZSBtaW4taGVpZ2h0IG9mIHRoZSBjb250ZW50IGFuZCBzaWRlYmFyIGJhc2VkIG9uIHRoZVxuICAgICAgLy90aGUgaGVpZ2h0IG9mIHRoZSBkb2N1bWVudC5cbiAgICAgIGlmICgkKFwiYm9keVwiKS5oYXNDbGFzcyhcImZpeGVkXCIpKSB7XG4gICAgICAgICQoXCIuY29udGVudC13cmFwcGVyLCAucmlnaHQtc2lkZVwiKS5jc3MoJ21pbi1oZWlnaHQnLCB3aW5kb3dfaGVpZ2h0IC0gJCgnLm1haW4tZm9vdGVyJykub3V0ZXJIZWlnaHQoKSk7XG4gICAgICAgICQoXCIuY29udGVudC13cmFwcGVyLCAucmlnaHQtc2lkZVwiKS5jc3MoJ2hlaWdodCcsIHdpbmRvd19oZWlnaHQgLSAkKCcubWFpbi1mb290ZXInKS5vdXRlckhlaWdodCgpKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZhciBwb3N0U2V0V2lkdGg7XG4gICAgICAgIGlmICh3aW5kb3dfaGVpZ2h0ID49IHNpZGViYXJfaGVpZ2h0KSB7XG4gICAgICAgICAgJChcIi5jb250ZW50LXdyYXBwZXIsIC5yaWdodC1zaWRlXCIpLmNzcygnbWluLWhlaWdodCcsIHdpbmRvd19oZWlnaHQgLSBuZWcpO1xuICAgICAgICAgIHBvc3RTZXRXaWR0aCA9IHdpbmRvd19oZWlnaHQgLSBuZWc7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgJChcIi5jb250ZW50LXdyYXBwZXIsIC5yaWdodC1zaWRlXCIpLmNzcygnbWluLWhlaWdodCcsIHNpZGViYXJfaGVpZ2h0KTtcbiAgICAgICAgICBwb3N0U2V0V2lkdGggPSBzaWRlYmFyX2hlaWdodDtcbiAgICAgICAgfVxuICAgICAgICAvL0ZpeCBmb3IgdGhlIGNvbnRyb2wgc2lkZWJhciBoZWlnaHRcbiAgICAgICAgdmFyIGNvbnRyb2xTaWRlYmFyID0gJCgkLkxheW91dE1hbmFnZXIub3B0aW9ucy5jb250cm9sU2lkZWJhck9wdGlvbnMuc2VsZWN0b3IpO1xuICAgICAgICBpZiAodHlwZW9mIGNvbnRyb2xTaWRlYmFyICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgICAgaWYgKGNvbnRyb2xTaWRlYmFyLmhlaWdodCgpID4gcG9zdFNldFdpZHRoKVxuICAgICAgICAgICAgJChcIi5jb250ZW50LXdyYXBwZXIsIC5yaWdodC1zaWRlXCIpLmNzcygnbWluLWhlaWdodCcsIGNvbnRyb2xTaWRlYmFyLmhlaWdodCgpKTtcbiAgICAgICAgfVxuXG4gICAgICB9XG4gICAgfSxcbiAgICBmaXhTaWRlYmFyOiBmdW5jdGlvbiAoKSB7XG4gICAgICAvL01ha2Ugc3VyZSB0aGUgYm9keSB0YWcgaGFzIHRoZSAuZml4ZWQgY2xhc3NcbiAgICAgIGlmICghJChcImJvZHlcIikuaGFzQ2xhc3MoXCJmaXhlZFwiKSkge1xuICAgICAgICBpZiAodHlwZW9mICQuZm4uc2xpbVNjcm9sbCAhPSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICQoXCIuc2lkZWJhclwiKS5zbGltU2Nyb2xsKHtkZXN0cm95OiB0cnVlfSkuaGVpZ2h0KFwiYXV0b1wiKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm47XG4gICAgICB9IGVsc2UgaWYgKHR5cGVvZiAkLmZuLnNsaW1TY3JvbGwgPT0gJ3VuZGVmaW5lZCcgJiYgd2luZG93LmNvbnNvbGUpIHtcbiAgICAgICAgd2luZG93LmNvbnNvbGUuZXJyb3IoXCJFcnJvcjogdGhlIGZpeGVkIGxheW91dCByZXF1aXJlcyB0aGUgc2xpbXNjcm9sbCBwbHVnaW4hXCIpO1xuICAgICAgfVxuICAgICAgLy9FbmFibGUgc2xpbXNjcm9sbCBmb3IgZml4ZWQgbGF5b3V0XG4gICAgICBpZiAoJC5MYXlvdXRNYW5hZ2VyLm9wdGlvbnMuc2lkZWJhclNsaW1TY3JvbGwpIHtcbiAgICAgICAgaWYgKHR5cGVvZiAkLmZuLnNsaW1TY3JvbGwgIT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAvL0Rlc3Ryb3kgaWYgaXQgZXhpc3RzXG4gICAgICAgICAgJChcIi5zaWRlYmFyXCIpLnNsaW1TY3JvbGwoe2Rlc3Ryb3k6IHRydWV9KS5oZWlnaHQoXCJhdXRvXCIpO1xuICAgICAgICAgIC8vQWRkIHNsaW1zY3JvbGxcbiAgICAgICAgICAkKFwiLnNpZGViYXJcIikuc2xpbXNjcm9sbCh7XG4gICAgICAgICAgICBoZWlnaHQ6ICgkKHdpbmRvdykuaGVpZ2h0KCkgLSAkKFwiLm1haW4taGVhZGVyXCIpLmhlaWdodCgpKSArIFwicHhcIixcbiAgICAgICAgICAgIGNvbG9yOiBcInJnYmEoMjU1LDI1NSwyNTUsMC43KVwiLFxuICAgICAgICAgICAgc2l6ZTogXCIzcHhcIlxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgICQoXCIuc2lkZWJhclwiKS5jc3MoeydoZWlnaHQnOiAoJCh3aW5kb3cpLmhlaWdodCgpIC0gJChcIi5tYWluLWhlYWRlclwiKS5oZWlnaHQoKSkgKyBcInB4XCJ9KVxuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICAvKiBQdXNoTWVudSgpXG4gICAqID09PT09PT09PT1cbiAgICogQWRkcyB0aGUgcHVzaCBtZW51IGZ1bmN0aW9uYWxpdHkgdG8gdGhlIHNpZGViYXIuXG4gICAqXG4gICAqIEB0eXBlIEZ1bmN0aW9uXG4gICAqIEB1c2FnZTogJC5MYXlvdXRNYW5hZ2VyLnB1c2hNZW51KFwiW2RhdGEtdG9nZ2xlPSdvZmZjYW52YXMnXVwiKVxuICAgKi9cbiAgJC5MYXlvdXRNYW5hZ2VyLnB1c2hNZW51ID0ge1xuICAgIGFjdGl2YXRlOiBmdW5jdGlvbiAodG9nZ2xlQnRuKSB7XG4gICAgICAvL0dldCB0aGUgc2NyZWVuIHNpemVzXG4gICAgICB2YXIgc2NyZWVuU2l6ZXMgPSAkLkxheW91dE1hbmFnZXIub3B0aW9ucy5zY3JlZW5TaXplcztcblxuICAgICAgLy9FbmFibGUgc2lkZWJhciB0b2dnbGVcbiAgICAgICQodG9nZ2xlQnRuKS5vbignY2xpY2snLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgLy9FbmFibGUgc2lkZWJhciBwdXNoIG1lbnVcbiAgICAgICAgaWYgKCQod2luZG93KS53aWR0aCgpID4gKHNjcmVlblNpemVzLnNtIC0gMSkpIHtcbiAgICAgICAgICBpZiAoJChcImJvZHlcIikuaGFzQ2xhc3MoJ3NpZGViYXItY29sbGFwc2UnKSkge1xuICAgICAgICAgICAgJChcImJvZHlcIikucmVtb3ZlQ2xhc3MoJ3NpZGViYXItY29sbGFwc2UnKS50cmlnZ2VyKCdleHBhbmRlZC5wdXNoTWVudScpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAkKFwiYm9keVwiKS5hZGRDbGFzcygnc2lkZWJhci1jb2xsYXBzZScpLnRyaWdnZXIoJ2NvbGxhcHNlZC5wdXNoTWVudScpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvL0hhbmRsZSBzaWRlYmFyIHB1c2ggbWVudSBmb3Igc21hbGwgc2NyZWVuc1xuICAgICAgICBlbHNlIHtcbiAgICAgICAgICBpZiAoJChcImJvZHlcIikuaGFzQ2xhc3MoJ3NpZGViYXItb3BlbicpKSB7XG4gICAgICAgICAgICAkKFwiYm9keVwiKS5yZW1vdmVDbGFzcygnc2lkZWJhci1vcGVuJykucmVtb3ZlQ2xhc3MoJ3NpZGViYXItY29sbGFwc2UnKS50cmlnZ2VyKCdjb2xsYXBzZWQucHVzaE1lbnUnKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgJChcImJvZHlcIikuYWRkQ2xhc3MoJ3NpZGViYXItb3BlbicpLnRyaWdnZXIoJ2V4cGFuZGVkLnB1c2hNZW51Jyk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgICAgJChcIi5jb250ZW50LXdyYXBwZXJcIikuY2xpY2soZnVuY3Rpb24gKCkge1xuICAgICAgICAvL0VuYWJsZSBoaWRlIG1lbnUgd2hlbiBjbGlja2luZyBvbiB0aGUgY29udGVudC13cmFwcGVyIG9uIHNtYWxsIHNjcmVlbnNcbiAgICAgICAgaWYgKCQod2luZG93KS53aWR0aCgpIDw9IChzY3JlZW5TaXplcy5zbSAtIDEpICYmICQoXCJib2R5XCIpLmhhc0NsYXNzKFwic2lkZWJhci1vcGVuXCIpKSB7XG4gICAgICAgICAgJChcImJvZHlcIikucmVtb3ZlQ2xhc3MoJ3NpZGViYXItb3BlbicpO1xuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgICAgLy9FbmFibGUgZXhwYW5kIG9uIGhvdmVyIGZvciBzaWRlYmFyIG1pbmlcbiAgICAgIGlmICgkLkxheW91dE1hbmFnZXIub3B0aW9ucy5zaWRlYmFyRXhwYW5kT25Ib3ZlciB8fCAoJCgnYm9keScpLmhhc0NsYXNzKCdmaXhlZCcpICYmICQoJ2JvZHknKS5oYXNDbGFzcygnc2lkZWJhci1taW5pJykpKSB7XG4gICAgICAgIHRoaXMuZXhwYW5kT25Ib3ZlcigpO1xuICAgICAgfVxuICAgIH0sXG4gICAgZXhwYW5kT25Ib3ZlcjogZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgIHZhciBzY3JlZW5XaWR0aCA9ICQuTGF5b3V0TWFuYWdlci5vcHRpb25zLnNjcmVlblNpemVzLnNtIC0gMTtcbiAgICAgIC8vRXhwYW5kIHNpZGViYXIgb24gaG92ZXJcbiAgICAgICQoJy5tYWluLXNpZGViYXInKS5ob3ZlcihmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICgkKCdib2R5JykuaGFzQ2xhc3MoJ3NpZGViYXItbWluaScpICYmICQoXCJib2R5XCIpLmhhc0NsYXNzKCdzaWRlYmFyLWNvbGxhcHNlJykgJiYgJCh3aW5kb3cpLndpZHRoKCkgPiBzY3JlZW5XaWR0aCkge1xuICAgICAgICAgIF90aGlzLmV4cGFuZCgpO1xuICAgICAgICB9XG4gICAgICB9LCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICgkKCdib2R5JykuaGFzQ2xhc3MoJ3NpZGViYXItbWluaScpICYmICQoJ2JvZHknKS5oYXNDbGFzcygnc2lkZWJhci1leHBhbmRlZC1vbi1ob3ZlcicpICYmICQod2luZG93KS53aWR0aCgpID4gc2NyZWVuV2lkdGgpIHtcbiAgICAgICAgICBfdGhpcy5jb2xsYXBzZSgpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9LFxuICAgIGV4cGFuZDogZnVuY3Rpb24gKCkge1xuICAgICAgJChcImJvZHlcIikucmVtb3ZlQ2xhc3MoJ3NpZGViYXItY29sbGFwc2UnKS5hZGRDbGFzcygnc2lkZWJhci1leHBhbmRlZC1vbi1ob3ZlcicpO1xuICAgIH0sXG4gICAgY29sbGFwc2U6IGZ1bmN0aW9uICgpIHtcbiAgICAgIGlmICgkKCdib2R5JykuaGFzQ2xhc3MoJ3NpZGViYXItZXhwYW5kZWQtb24taG92ZXInKSkge1xuICAgICAgICAkKCdib2R5JykucmVtb3ZlQ2xhc3MoJ3NpZGViYXItZXhwYW5kZWQtb24taG92ZXInKS5hZGRDbGFzcygnc2lkZWJhci1jb2xsYXBzZScpO1xuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICAvKiBUcmVlKClcbiAgICogPT09PT09XG4gICAqIENvbnZlcnRzIHRoZSBzaWRlYmFyIGludG8gYSBtdWx0aWxldmVsXG4gICAqIHRyZWUgdmlldyBtZW51LlxuICAgKlxuICAgKiBAdHlwZSBGdW5jdGlvblxuICAgKiBAVXNhZ2U6ICQuTGF5b3V0TWFuYWdlci50cmVlKCcuc2lkZWJhcicpXG4gICAqL1xuICAkLkxheW91dE1hbmFnZXIudHJlZSA9IGZ1bmN0aW9uIChtZW51KSB7XG4gICAgdmFyIF90aGlzID0gdGhpcztcbiAgICB2YXIgYW5pbWF0aW9uU3BlZWQgPSAkLkxheW91dE1hbmFnZXIub3B0aW9ucy5hbmltYXRpb25TcGVlZDtcbiAgICAvL2NsaWNrIGV2ZW50IC8vXG4gICAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgbWVudSArICcgbGkgYScsIGZ1bmN0aW9uIChlKSB7XG5cbiAgICAgIC8vR2V0IHRoZSBjbGlja2VkIGxpbmsgYW5kIHRoZSBuZXh0IGVsZW1lbnRcbiAgICAgIHZhciAkdGhpcyA9ICQodGhpcyk7XG4gICAgICAvL2lzIHRoZSBjb250ZW50IG9mIHRoZSBcImFjY29yZGlvblwiIHVsIC8vXG4gICAgICB2YXIgY2hlY2tFbGVtZW50ID0gJHRoaXMubmV4dCgpO1xuXG4gICAgICAvL0NoZWNrIGlmIHRoZSBuZXh0IGVsZW1lbnQgaXMgYSBtZW51IGFuZCBpcyB2aXNpYmxlXG4gICAgICBpZiAoKGNoZWNrRWxlbWVudC5pcygnLnRyZWV2aWV3LW1lbnUnKSkgJiYgKGNoZWNrRWxlbWVudC5pcygnOnZpc2libGUnKSkpIHtcbiAgICAgICAgLy9DbG9zZSB0aGUgbWVudVxuICAgICAgICBjaGVja0VsZW1lbnQuc2xpZGVVcChhbmltYXRpb25TcGVlZCwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGNoZWNrRWxlbWVudC5wYXJlbnQoXCJsaS50cmVldmlld1wiKS5yZW1vdmVDbGFzcyhcImFjdGl2ZVwiKTtcbiAgICAgICAgICBjaGVja0VsZW1lbnQucmVtb3ZlQ2xhc3MoJ21lbnUtb3BlbicpO1xuICAgICAgICAgIC8vRml4IHRoZSBsYXlvdXQgaW4gY2FzZSB0aGUgc2lkZWJhciBzdHJldGNoZXMgb3ZlciB0aGUgaGVpZ2h0IG9mIHRoZSB3aW5kb3dcbiAgICAgICAgICAvL190aGlzLmxheW91dC5maXgoKTtcbiAgICAgICAgfSk7XG5cbiAgICAgIH1cbiAgICAgIC8vSWYgdGhlIG1lbnUgaXMgbm90IHZpc2libGVcbiAgICAgIGVsc2UgaWYgKChjaGVja0VsZW1lbnQuaXMoJy50cmVldmlldy1tZW51JykpICYmICghY2hlY2tFbGVtZW50LmlzKCc6dmlzaWJsZScpKSkge1xuICAgICAgICAvL0dldCB0aGUgcGFyZW50IG1lbnVcbiAgICAgICAgdmFyIHBhcmVudCA9ICR0aGlzLnBhcmVudHMoJ3VsJykuZmlyc3QoKTtcbiAgICAgICAgdmFyIHBhcmVudF9saSA9ICR0aGlzLnBhcmVudChcImxpXCIpO1xuICAgICAgICB2YXIgbGlfc2libGluZ3MgPSBwYXJlbnRfbGkuc2libGluZ3MoKTtcbiAgICAgICAgdmFyIHBhcmVudF9maW5kX2FjdGl2ZTtcbiAgICAgICAgdmFyIHNpZGViYXJfY29udGVudF9oZWlnaHQgPSBwYXJlbnQuaGVpZ2h0KCkgLSBwYXJlbnQuZmluZCgnbGkuaGVhZGVyJykub3V0ZXJIZWlnaHQoKTtcbiAgICAgICAgdmFyIHRyZWV2aWV3SGVpZ2h0ID0gcGFyZW50X2xpLm91dGVySGVpZ2h0KCk7XG4gICAgICAgIGxpX3NpYmxpbmdzLm5vdCgnLmhlYWRlcicpLmVhY2goZnVuY3Rpb24oaW5kZXgsIGVsKSB7XG4gICAgICAgICAgICAgICAgdHJlZXZpZXdIZWlnaHQrPSQoZWwpLmZpbmQoJ2EnKS5vdXRlckhlaWdodCgpO1xuICAgICAgICB9KTtcbiAgICAgICAgdmFyIHNlY3Rpb25faGVpZ2h0ID0gKHNpZGViYXJfY29udGVudF9oZWlnaHQgLSB0cmVldmlld0hlaWdodCk7XG4gICAgICAgIGNoZWNrRWxlbWVudC5jc3Moe1xuICAgICAgICAgICdoZWlnaHQnOiBzZWN0aW9uX2hlaWdodCArICdweCcsXG4gICAgICAgICAgJ21heC1oZWlnaHQnOnNlY3Rpb25faGVpZ2h0ICsgJ3B4JyxcbiAgICAgICAgICAnb3ZlcmZsb3cteSc6ICdhdXRvJ1xuICAgICAgICB9KTtcbiAgICAgICAgLy9DbG9zZSBhbGwgb3BlbiBtZW51cyB3aXRoaW4gdGhlIHBhcmVudFxuICAgICAgICB2YXIgdWwgPSBwYXJlbnQuZmluZCgndWwudHJlZXZpZXctbWVudTp2aXNpYmxlJykuc2xpZGVVcChhbmltYXRpb25TcGVlZCk7XG4gICAgICAgIC8vUmVtb3ZlIHRoZSBtZW51LW9wZW4gY2xhc3MgZnJvbSB0aGUgcGFyZW50XG4gICAgICAgIHVsLnJlbW92ZUNsYXNzKCdtZW51LW9wZW4nKTtcbiAgICAgICAgLy9HZXQgdGhlIHBhcmVudCBsaVxuICAgICAgICAvL09wZW4gdGhlIHRhcmdldCBtZW51IGFuZCBhZGQgdGhlIG1lbnUtb3BlbiBjbGFzc1xuICAgICAgICBjaGVja0VsZW1lbnQuc2xpZGVEb3duKGFuaW1hdGlvblNwZWVkLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgLy9BZGQgdGhlIGNsYXNzIGFjdGl2ZSB0byB0aGUgcGFyZW50IGxpXG4gICAgICAgICAgY2hlY2tFbGVtZW50LmFkZENsYXNzKCdtZW51LW9wZW4nKTtcbiAgICAgICAgICBwYXJlbnRfZmluZF9hY3RpdmUgPSBwYXJlbnQuZmluZCgnbGkudHJlZXZpZXcuYWN0aXZlJyk7XG4gICAgICAgICAgcGFyZW50X2ZpbmRfYWN0aXZlLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTtcbiAgICAgICAgICBwYXJlbnRfbGkuYWRkQ2xhc3MoJ2FjdGl2ZScpO1xuICAgICAgICAgIC8vRml4IHRoZSBsYXlvdXQgaW4gY2FzZSB0aGUgc2lkZWJhciBzdHJldGNoZXMgb3ZlciB0aGUgaGVpZ2h0IG9mIHRoZSB3aW5kb3dcbiAgICAgICAgICBfdGhpcy5sYXlvdXQuZml4KCk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgLy9pZiB0aGlzIGlzbid0IGEgbGluaywgcHJldmVudCB0aGUgcGFnZSBmcm9tIGJlaW5nIHJlZGlyZWN0ZWRcbiAgICAgIGlmIChjaGVja0VsZW1lbnQuaXMoJy50cmVldmlldy1tZW51JykpIHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgfVxuICAgIH0pO1xuICB9O1xuXG4gIC8qIENvbnRyb2xTaWRlYmFyXG4gICAqID09PT09PT09PT09PT09XG4gICAqIEFkZHMgZnVuY3Rpb25hbGl0eSB0byB0aGUgcmlnaHQgc2lkZWJhclxuICAgKlxuICAgKiBAdHlwZSBPYmplY3RcbiAgICogQHVzYWdlICQuTGF5b3V0TWFuYWdlci5jb250cm9sU2lkZWJhci5hY3RpdmF0ZShvcHRpb25zKVxuICAgKi9cbiAgJC5MYXlvdXRNYW5hZ2VyLmZsb2F0QmFyID0gJC5MYXlvdXRNYW5hZ2VyLmNvbnRyb2xTaWRlYmFyID0ge1xuICAgIC8vaW5zdGFudGlhdGUgdGhlIG9iamVjdFxuICAgIGFjdGl2YXRlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAvL0dldCB0aGUgb2JqZWN0XG4gICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgLy9VcGRhdGUgb3B0aW9uc1xuICAgICAgdmFyIG8gPSAkLkxheW91dE1hbmFnZXIub3B0aW9ucy5jb250cm9sU2lkZWJhck9wdGlvbnM7XG4gICAgICAvL0dldCB0aGUgc2lkZWJhclxuICAgICAgdmFyIHNpZGViYXIgPSAkKG8uc2VsZWN0b3IpO1xuICAgICAgLy9UaGUgdG9nZ2xlIGJ1dHRvblxuICAgICAgdmFyIGJ0biA9ICQoby50b2dnbGVCdG5TZWxlY3Rvcik7XG5cbiAgICAgIC8vTGlzdGVuIHRvIHRoZSBjbGljayBldmVudFxuICAgICAgYnRuLm9uKCdjbGljaycsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgLy9JZiB0aGUgc2lkZWJhciBpcyBub3Qgb3BlblxuICAgICAgICBpZiAoIXNpZGViYXIuaGFzQ2xhc3MoJ2NvbnRyb2wtc2lkZWJhci1vcGVuJykgJiYgISQoJ2JvZHknKS5oYXNDbGFzcygnY29udHJvbC1zaWRlYmFyLW9wZW4nKSkge1xuICAgICAgICAgIC8vT3BlbiB0aGUgc2lkZWJhclxuICAgICAgICAgIF90aGlzLm9wZW4oc2lkZWJhciwgby5zbGlkZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgX3RoaXMuY2xvc2Uoc2lkZWJhciwgby5zbGlkZSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICAvL0lmIHRoZSBib2R5IGhhcyBhIGJveGVkIGxheW91dCwgZml4IHRoZSBzaWRlYmFyIGJnIHBvc2l0aW9uXG4gICAgICB2YXIgYmcgPSAkKFwiLmNvbnRyb2wtc2lkZWJhci1iZ1wiKTtcbiAgICAgIF90aGlzLl9maXgoYmcpO1xuXG4gICAgICAvL0lmIHRoZSBib2R5IGhhcyBhIGZpeGVkIGxheW91dCwgbWFrZSB0aGUgY29udHJvbCBzaWRlYmFyIGZpeGVkXG4gICAgICBpZiAoJCgnYm9keScpLmhhc0NsYXNzKCdmaXhlZCcpKSB7XG4gICAgICAgIF90aGlzLl9maXhGb3JGaXhlZChzaWRlYmFyKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vSWYgdGhlIGNvbnRlbnQgaGVpZ2h0IGlzIGxlc3MgdGhhbiB0aGUgc2lkZWJhcidzIGhlaWdodCwgZm9yY2UgbWF4IGhlaWdodFxuICAgICAgICBpZiAoJCgnLmNvbnRlbnQtd3JhcHBlciwgLnJpZ2h0LXNpZGUnKS5oZWlnaHQoKSA8IHNpZGViYXIuaGVpZ2h0KCkpIHtcbiAgICAgICAgICBfdGhpcy5fZml4Rm9yQ29udGVudChzaWRlYmFyKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0sXG4gICAgLy9PcGVuIHRoZSBjb250cm9sIHNpZGViYXJcbiAgICBvcGVuOiBmdW5jdGlvbiAoc2lkZWJhciwgc2xpZGUpIHtcbiAgICAgIC8vU2xpZGUgb3ZlciBjb250ZW50XG4gICAgICBpZiAoc2xpZGUpIHtcbiAgICAgICAgc2lkZWJhci5hZGRDbGFzcygnY29udHJvbC1zaWRlYmFyLW9wZW4nKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vUHVzaCB0aGUgY29udGVudCBieSBhZGRpbmcgdGhlIG9wZW4gY2xhc3MgdG8gdGhlIGJvZHkgaW5zdGVhZFxuICAgICAgICAvL29mIHRoZSBzaWRlYmFyIGl0c2VsZlxuICAgICAgICAkKCdib2R5JykuYWRkQ2xhc3MoJ2NvbnRyb2wtc2lkZWJhci1vcGVuJyk7XG4gICAgICB9XG4gICAgfSxcbiAgICAvL0Nsb3NlIHRoZSBjb250cm9sIHNpZGViYXJcbiAgICBjbG9zZTogZnVuY3Rpb24gKHNpZGViYXIsIHNsaWRlKSB7XG4gICAgICBpZiAoc2xpZGUpIHtcbiAgICAgICAgc2lkZWJhci5yZW1vdmVDbGFzcygnY29udHJvbC1zaWRlYmFyLW9wZW4nKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgICQoJ2JvZHknKS5yZW1vdmVDbGFzcygnY29udHJvbC1zaWRlYmFyLW9wZW4nKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIF9maXg6IGZ1bmN0aW9uIChzaWRlYmFyKSB7XG4gICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgaWYgKCQoXCJib2R5XCIpLmhhc0NsYXNzKCdsYXlvdXQtYm94ZWQnKSkge1xuICAgICAgICBzaWRlYmFyLmNzcygncG9zaXRpb24nLCAnYWJzb2x1dGUnKTtcbiAgICAgICAgc2lkZWJhci5oZWlnaHQoJChcIi53cmFwcGVyXCIpLmhlaWdodCgpKTtcbiAgICAgICAgJCh3aW5kb3cpLnJlc2l6ZShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgX3RoaXMuX2ZpeChzaWRlYmFyKTtcbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBzaWRlYmFyLmNzcyh7XG4gICAgICAgICAgJ3Bvc2l0aW9uJzogJ2ZpeGVkJyxcbiAgICAgICAgICAnaGVpZ2h0JzogJ2F1dG8nXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0sXG4gICAgX2ZpeEZvckZpeGVkOiBmdW5jdGlvbiAoc2lkZWJhcikge1xuICAgICAgc2lkZWJhci5jc3Moe1xuICAgICAgICAncG9zaXRpb24nOiAnZml4ZWQnLFxuICAgICAgICAnbWF4LWhlaWdodCc6ICcxMDAlJyxcbiAgICAgICAgJ292ZXJmbG93JzogJ2F1dG8nLFxuICAgICAgICAncGFkZGluZy1ib3R0b20nOiAnNTBweCdcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgX2ZpeEZvckNvbnRlbnQ6IGZ1bmN0aW9uIChzaWRlYmFyKSB7XG4gICAgICAkKFwiLmNvbnRlbnQtd3JhcHBlciwgLnJpZ2h0LXNpZGVcIikuY3NzKCdtaW4taGVpZ2h0Jywgc2lkZWJhci5oZWlnaHQoKSk7XG4gICAgfVxuICB9O1xuXG4gIC8qIEJveFdpZGdldFxuICAgKiA9PT09PT09PT1cbiAgICogQm94V2lkZ2V0IGlzIGEgcGx1Z2luIHRvIGhhbmRsZSBjb2xsYXBzaW5nIGFuZFxuICAgKiByZW1vdmluZyBib3hlcyBmcm9tIHRoZSBzY3JlZW4uXG4gICAqXG4gICAqIEB0eXBlIE9iamVjdFxuICAgKiBAdXNhZ2UgJC5MYXlvdXRNYW5hZ2VyLmJveFdpZGdldC5hY3RpdmF0ZSgpXG4gICAqICAgICAgICBTZXQgYWxsIHlvdXIgb3B0aW9ucyBpbiB0aGUgbWFpbiAkLkxheW91dE1hbmFnZXIub3B0aW9ucyBvYmplY3RcbiAgICovXG4gICQuTGF5b3V0TWFuYWdlci5ib3hXaWRnZXQgPSB7XG4gICAgc2VsZWN0b3JzOiAkLkxheW91dE1hbmFnZXIub3B0aW9ucy5ib3hXaWRnZXRPcHRpb25zLmJveFdpZGdldFNlbGVjdG9ycyxcbiAgICBpY29uczogJC5MYXlvdXRNYW5hZ2VyLm9wdGlvbnMuYm94V2lkZ2V0T3B0aW9ucy5ib3hXaWRnZXRJY29ucyxcbiAgICBhbmltYXRpb25TcGVlZDogJC5MYXlvdXRNYW5hZ2VyLm9wdGlvbnMuYW5pbWF0aW9uU3BlZWQsXG4gICAgYWN0aXZhdGU6IGZ1bmN0aW9uIChfYm94KSB7XG4gICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgaWYgKCFfYm94KSB7XG4gICAgICAgIF9ib3ggPSBkb2N1bWVudDsgLy8gYWN0aXZhdGUgYWxsIGJveGVzIHBlciBkZWZhdWx0XG4gICAgICB9XG4gICAgICAvL0xpc3RlbiBmb3IgY29sbGFwc2UgZXZlbnQgdHJpZ2dlcnNcbiAgICAgICQoX2JveCkub24oJ2NsaWNrJywgX3RoaXMuc2VsZWN0b3JzLmNvbGxhcHNlLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIF90aGlzLmNvbGxhcHNlKCQodGhpcykpO1xuICAgICAgfSk7XG5cbiAgICAgIC8vTGlzdGVuIGZvciByZW1vdmUgZXZlbnQgdHJpZ2dlcnNcbiAgICAgICQoX2JveCkub24oJ2NsaWNrJywgX3RoaXMuc2VsZWN0b3JzLnJlbW92ZSwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBfdGhpcy5yZW1vdmUoJCh0aGlzKSk7XG4gICAgICB9KTtcbiAgICB9LFxuICAgIGNvbGxhcHNlOiBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgIC8vRmluZCB0aGUgYm94IHBhcmVudFxuICAgICAgdmFyIGJveCA9IGVsZW1lbnQucGFyZW50cyhcIi5ib3hcIikuZmlyc3QoKTtcbiAgICAgIC8vRmluZCB0aGUgYm9keSBhbmQgdGhlIGZvb3RlclxuICAgICAgdmFyIGJveF9jb250ZW50ID0gYm94LmZpbmQoXCI+IC5ib3gtYm9keSwgPiAuYm94LWZvb3RlciwgPiBmb3JtICA+LmJveC1ib2R5LCA+IGZvcm0gPiAuYm94LWZvb3RlclwiKTtcbiAgICAgIGlmICghYm94Lmhhc0NsYXNzKFwiY29sbGFwc2VkLWJveFwiKSkge1xuICAgICAgICAvL0NvbnZlcnQgbWludXMgaW50byBwbHVzXG4gICAgICAgIGVsZW1lbnQuY2hpbGRyZW4oXCI6Zmlyc3RcIilcbiAgICAgICAgICAgICAgICAucmVtb3ZlQ2xhc3MoX3RoaXMuaWNvbnMuY29sbGFwc2UpXG4gICAgICAgICAgICAgICAgLmFkZENsYXNzKF90aGlzLmljb25zLm9wZW4pO1xuICAgICAgICAvL0hpZGUgdGhlIGNvbnRlbnRcbiAgICAgICAgYm94X2NvbnRlbnQuc2xpZGVVcChfdGhpcy5hbmltYXRpb25TcGVlZCwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGJveC5hZGRDbGFzcyhcImNvbGxhcHNlZC1ib3hcIik7XG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy9Db252ZXJ0IHBsdXMgaW50byBtaW51c1xuICAgICAgICBlbGVtZW50LmNoaWxkcmVuKFwiOmZpcnN0XCIpXG4gICAgICAgICAgICAgICAgLnJlbW92ZUNsYXNzKF90aGlzLmljb25zLm9wZW4pXG4gICAgICAgICAgICAgICAgLmFkZENsYXNzKF90aGlzLmljb25zLmNvbGxhcHNlKTtcbiAgICAgICAgLy9TaG93IHRoZSBjb250ZW50XG4gICAgICAgIGJveF9jb250ZW50LnNsaWRlRG93bihfdGhpcy5hbmltYXRpb25TcGVlZCwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGJveC5yZW1vdmVDbGFzcyhcImNvbGxhcHNlZC1ib3hcIik7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0sXG4gICAgcmVtb3ZlOiBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgLy9GaW5kIHRoZSBib3ggcGFyZW50XG4gICAgICB2YXIgYm94ID0gZWxlbWVudC5wYXJlbnRzKFwiLmJveFwiKS5maXJzdCgpO1xuICAgICAgYm94LnNsaWRlVXAodGhpcy5hbmltYXRpb25TcGVlZCk7XG4gICAgfVxuICB9O1xuICBcbiAgcmV0dXJuICQuTGF5b3V0TWFuYWdlcjtcbn07XG5cbi8qIC0tLS0tLS0tLS0tLS0tLS0tLVxuICogLSBDdXN0b20gUGx1Z2lucyAtXG4gKiAtLS0tLS0tLS0tLS0tLS0tLS1cbiAqIEFsbCBjdXN0b20gcGx1Z2lucyBhcmUgZGVmaW5lZCBiZWxvdy5cbiAqL1xuXG4vKlxuICogQk9YIFJFRlJFU0ggQlVUVE9OXG4gKiAtLS0tLS0tLS0tLS0tLS0tLS1cbiAqIFRoaXMgaXMgYSBjdXN0b20gcGx1Z2luIHRvIHVzZSB3aXRoIHRoZSBjb21wb25lbnQgQk9YLiBJdCBhbGxvd3MgeW91IHRvIGFkZFxuICogYSByZWZyZXNoIGJ1dHRvbiB0byB0aGUgYm94LiBJdCBjb252ZXJ0cyB0aGUgYm94J3Mgc3RhdGUgdG8gYSBsb2FkaW5nIHN0YXRlLlxuICpcbiAqIEB0eXBlIHBsdWdpblxuICogQHVzYWdlICQoXCIjYm94LXdpZGdldFwiKS5ib3hSZWZyZXNoKCBvcHRpb25zICk7XG4gKi9cbiQuTGF5b3V0TWFuYWdlci5hZGRSZWZyZXNoQnV0dG9uID0gZnVuY3Rpb24gKCkge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICAkLmZuLmJveFJlZnJlc2ggPSBmdW5jdGlvbiAob3B0aW9ucykge1xuXG4gICAgLy8gUmVuZGVyIG9wdGlvbnNcbiAgICB2YXIgc2V0dGluZ3MgPSAkLmV4dGVuZCh7XG4gICAgICAvL1JlZnJlc2ggYnV0dG9uIHNlbGVjdG9yXG4gICAgICB0cmlnZ2VyOiBcIi5yZWZyZXNoLWJ0blwiLFxuICAgICAgLy9GaWxlIHNvdXJjZSB0byBiZSBsb2FkZWQgKGUuZzogYWpheC9zcmMucGhwKVxuICAgICAgc291cmNlOiBcIlwiLFxuICAgICAgLy9DYWxsYmFja3NcbiAgICAgIG9uTG9hZFN0YXJ0OiBmdW5jdGlvbiAoYm94KSB7XG4gICAgICAgIHJldHVybiBib3g7XG4gICAgICB9LCAvL1JpZ2h0IGFmdGVyIHRoZSBidXR0b24gaGFzIGJlZW4gY2xpY2tlZFxuICAgICAgb25Mb2FkRG9uZTogZnVuY3Rpb24gKGJveCkge1xuICAgICAgICByZXR1cm4gYm94O1xuICAgICAgfSAvL1doZW4gdGhlIHNvdXJjZSBoYXMgYmVlbiBsb2FkZWRcblxuICAgIH0sIG9wdGlvbnMpO1xuXG4gICAgLy9UaGUgb3ZlcmxheVxuICAgIHZhciBvdmVybGF5ID0gJCgnPGRpdiBjbGFzcz1cIm92ZXJsYXlcIj48ZGl2IGNsYXNzPVwiZmEgZmEtcmVmcmVzaCBmYS1zcGluXCI+PC9kaXY+PC9kaXY+Jyk7XG5cbiAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uICgpIHtcbiAgICAgIC8vaWYgYSBzb3VyY2UgaXMgc3BlY2lmaWVkXG4gICAgICBpZiAoc2V0dGluZ3Muc291cmNlID09PSBcIlwiKSB7XG4gICAgICAgIGlmICh3aW5kb3cuY29uc29sZSkge1xuICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmxvZyhcIlBsZWFzZSBzcGVjaWZ5IGEgc291cmNlIGZpcnN0IC0gYm94UmVmcmVzaCgpXCIpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIC8vdGhlIGJveFxuICAgICAgdmFyIGJveCA9ICQodGhpcyk7XG4gICAgICAvL3RoZSBidXR0b25cbiAgICAgIHZhciByQnRuID0gYm94LmZpbmQoc2V0dGluZ3MudHJpZ2dlcikuZmlyc3QoKTtcblxuICAgICAgLy9PbiB0cmlnZ2VyIGNsaWNrXG4gICAgICByQnRuLm9uKCdjbGljaycsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgLy9BZGQgbG9hZGluZyBvdmVybGF5XG4gICAgICAgIHN0YXJ0KGJveCk7XG5cbiAgICAgICAgLy9QZXJmb3JtIGFqYXggY2FsbFxuICAgICAgICBib3guZmluZChcIi5ib3gtYm9keVwiKS5sb2FkKHNldHRpbmdzLnNvdXJjZSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGRvbmUoYm94KTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGZ1bmN0aW9uIHN0YXJ0KGJveCkge1xuICAgICAgLy9BZGQgb3ZlcmxheSBhbmQgbG9hZGluZyBpbWdcbiAgICAgIGJveC5hcHBlbmQob3ZlcmxheSk7XG5cbiAgICAgIHNldHRpbmdzLm9uTG9hZFN0YXJ0LmNhbGwoYm94KTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBkb25lKGJveCkge1xuICAgICAgLy9SZW1vdmUgb3ZlcmxheSBhbmQgbG9hZGluZyBpbWdcbiAgICAgIGJveC5maW5kKG92ZXJsYXkpLnJlbW92ZSgpO1xuXG4gICAgICBzZXR0aW5ncy5vbkxvYWREb25lLmNhbGwoYm94KTtcbiAgICB9XG5cbiAgfTtcbiAgcmV0dXJuICQuTGF5b3V0TWFuYWdlcjtcbn07XG5cbi8qXG4gKiBFWFBMSUNJVCBCT1ggQUNUSVZBVElPTlxuICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAqIFRoaXMgaXMgYSBjdXN0b20gcGx1Z2luIHRvIHVzZSB3aXRoIHRoZSBjb21wb25lbnQgQk9YLiBJdCBhbGxvd3MgeW91IHRvIGFjdGl2YXRlXG4gKiBhIGJveCBpbnNlcnRlZCBpbiB0aGUgRE9NIGFmdGVyIHRoZSBhcHAuanMgd2FzIGxvYWRlZC5cbiAqXG4gKiBAdHlwZSBwbHVnaW5cbiAqIEB1c2FnZSAkKFwiI2JveC13aWRnZXRcIikuYWN0aXZhdGVCb3goKTtcbiAqL1xuJC5MYXlvdXRNYW5hZ2VyLmFjdGl2YXRlQm94ID0gZnVuY3Rpb24gKCkge1xuICAndXNlIHN0cmljdCc7XG5cbiAgJC5mbi5hY3RpdmF0ZUJveCA9IGZ1bmN0aW9uICgpIHtcbiAgICAkLkxheW91dE1hbmFnZXIuYm94V2lkZ2V0LmFjdGl2YXRlKHRoaXMpO1xuICB9O1xuICBcbiAgcmV0dXJuICQuTGF5b3V0TWFuYWdlcjtcbn07XG5cbi8qXG4gKiBUT0RPIExJU1QgQ1VTVE9NIFBMVUdJTlxuICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAqIFRoaXMgcGx1Z2luIGRlcGVuZHMgb24gaUNoZWNrIHBsdWdpbiBmb3IgY2hlY2tib3ggYW5kIHJhZGlvIGlucHV0c1xuICpcbiAqIEB0eXBlIHBsdWdpblxuICogQHVzYWdlICQoXCIjdG9kby13aWRnZXRcIikudG9kb2xpc3QoIG9wdGlvbnMgKTtcbiAqL1xuXG4kLkxheW91dE1hbmFnZXIubGlzdEN1c3RvbVBsdWdpbiA9IGZ1bmN0aW9uICgpIHtcblxuXHQgICd1c2Ugc3RyaWN0JztcblxuXHQgICQuZm4udG9kb2xpc3QgPSBmdW5jdGlvbiAob3B0aW9ucykge1xuXHQgICAgLy8gUmVuZGVyIG9wdGlvbnNcblx0ICAgIHZhciBzZXR0aW5ncyA9ICQuZXh0ZW5kKHtcblx0ICAgICAgLy9XaGVuIHRoZSB1c2VyIGNoZWNrcyB0aGUgaW5wdXRcblx0ICAgICAgb25DaGVjazogZnVuY3Rpb24gKGVsZSkge1xuXHQgICAgICAgIHJldHVybiBlbGU7XG5cdCAgICAgIH0sXG5cdCAgICAgIC8vV2hlbiB0aGUgdXNlciB1bmNoZWNrcyB0aGUgaW5wdXRcblx0ICAgICAgb25VbmNoZWNrOiBmdW5jdGlvbiAoZWxlKSB7XG5cdCAgICAgICAgcmV0dXJuIGVsZTtcblx0ICAgICAgfVxuXHQgICAgfSwgb3B0aW9ucyk7XG5cblx0ICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24gKCkge1xuXG5cdCAgICAgIGlmICh0eXBlb2YgJC5mbi5pQ2hlY2sgIT0gJ3VuZGVmaW5lZCcpIHtcblx0ICAgICAgICAkKCdpbnB1dCcsIHRoaXMpLm9uKCdpZkNoZWNrZWQnLCBmdW5jdGlvbiAoKSB7XG5cdCAgICAgICAgICB2YXIgZWxlID0gJCh0aGlzKS5wYXJlbnRzKFwibGlcIikuZmlyc3QoKTtcblx0ICAgICAgICAgIGVsZS50b2dnbGVDbGFzcyhcImRvbmVcIik7XG5cdCAgICAgICAgICBzZXR0aW5ncy5vbkNoZWNrLmNhbGwoZWxlKTtcblx0ICAgICAgICB9KTtcblxuXHQgICAgICAgICQoJ2lucHV0JywgdGhpcykub24oJ2lmVW5jaGVja2VkJywgZnVuY3Rpb24gKCkge1xuXHQgICAgICAgICAgdmFyIGVsZSA9ICQodGhpcykucGFyZW50cyhcImxpXCIpLmZpcnN0KCk7XG5cdCAgICAgICAgICBlbGUudG9nZ2xlQ2xhc3MoXCJkb25lXCIpO1xuXHQgICAgICAgICAgc2V0dGluZ3Mub25VbmNoZWNrLmNhbGwoZWxlKTtcblx0ICAgICAgICB9KTtcblx0ICAgICAgfSBlbHNlIHtcblx0ICAgICAgICAkKCdpbnB1dCcsIHRoaXMpLm9uKCdjaGFuZ2UnLCBmdW5jdGlvbiAoKSB7XG5cdCAgICAgICAgICB2YXIgZWxlID0gJCh0aGlzKS5wYXJlbnRzKFwibGlcIikuZmlyc3QoKTtcblx0ICAgICAgICAgIGVsZS50b2dnbGVDbGFzcyhcImRvbmVcIik7XG5cdCAgICAgICAgICBpZiAoJCgnaW5wdXQnLCBlbGUpLmlzKFwiOmNoZWNrZWRcIikpIHtcblx0ICAgICAgICAgICAgc2V0dGluZ3Mub25DaGVjay5jYWxsKGVsZSk7XG5cdCAgICAgICAgICB9IGVsc2Uge1xuXHQgICAgICAgICAgICBzZXR0aW5ncy5vblVuY2hlY2suY2FsbChlbGUpO1xuXHQgICAgICAgICAgfVxuXHQgICAgICAgIH0pO1xuXHQgICAgICB9XG5cdCAgICB9KTtcblx0ICB9O1xuXHQgIHJldHVybiAkLkxheW91dE1hbmFnZXI7XG5cdH07XG5cdFxuXHQvKiAtLS0tLS0tLS0tLS0tLS0tLS1cblx0ICogLSBJbXBsZW1lbnRhdGlvbiAtXG5cdCAqIC0tLS0tLS0tLS0tLS0tLS0tLVxuXHQgKiBUaGUgbmV4dCBibG9jayBvZiBjb2RlIGltcGxlbWVudHMgTGF5b3V0TWFuYWdlcidzXG5cdCAqIGZ1bmN0aW9ucyBhbmQgcGx1Z2lucyBhcyBzcGVjaWZpZWQgYnkgdGhlXG5cdCAqIG9wdGlvbnMgYWJvdmUuXG5cdCAqL1xuXHQkLkxheW91dE1hbmFnZXIuc2V0dXAgPSBmdW5jdGlvbiAoKVxuXHR7XG5cdCAgXCJ1c2Ugc3RyaWN0XCI7XG5cblx0ICAvL0ZpeCBmb3IgSUUgcGFnZSB0cmFuc2l0aW9uc1xuXHQgICQoXCJib2R5XCIpLnJlbW92ZUNsYXNzKFwiaG9sZC10cmFuc2l0aW9uXCIpO1xuXG5cdCAgLy9FeHRlbmQgb3B0aW9ucyBpZiBleHRlcm5hbCBvcHRpb25zIGV4aXN0XG5cdCAgaWYgKHR5cGVvZiBMYXlvdXRNYW5hZ2VyT3B0aW9ucyAhPT0gXCJ1bmRlZmluZWRcIikge1xuXHQgICAgJC5leHRlbmQodHJ1ZSxcblx0ICAgICAgICAgICAgJC5MYXlvdXRNYW5hZ2VyLm9wdGlvbnMsXG5cdCAgICAgICAgICAgIExheW91dE1hbmFnZXJPcHRpb25zKTtcblx0ICB9XG5cblx0ICAvL0Vhc3kgYWNjZXNzIHRvIG9wdGlvbnNcblx0ICB2YXIgbyA9ICQuTGF5b3V0TWFuYWdlci5vcHRpb25zO1xuXG5cdCAgLy9TZXQgdXAgdGhlIG9iamVjdFxuXHQgICQuTGF5b3V0TWFuYWdlci5faW5pdCgpO1xuXG5cdCAgLy9BY3RpdmF0ZSB0aGUgbGF5b3V0IG1ha2VyXG5cdCAgJC5MYXlvdXRNYW5hZ2VyLmxheW91dC5hY3RpdmF0ZSgpO1xuXG5cdCAgLy9FbmFibGUgc2lkZWJhciB0cmVlIHZpZXcgY29udHJvbHNcblx0ICAkLkxheW91dE1hbmFnZXIudHJlZSgnLnNpZGViYXInKTtcblxuXHQgIC8vRW5hYmxlIGNvbnRyb2wgc2lkZWJhclxuXHQgIGlmIChvLmVuYWJsZUNvbnRyb2xTaWRlYmFyKSB7XG5cdCAgICAkLkxheW91dE1hbmFnZXIuY29udHJvbFNpZGViYXIuYWN0aXZhdGUoKTtcblx0ICB9XG5cblx0ICAvL0FkZCBzbGltc2Nyb2xsIHRvIG5hdmJhciBkcm9wZG93blxuXHQgIGlmIChvLm5hdmJhck1lbnVTbGltc2Nyb2xsICYmIHR5cGVvZiAkLmZuLnNsaW1zY3JvbGwgIT0gJ3VuZGVmaW5lZCcpIHtcblx0ICAgICQoXCIubmF2YmFyIC5tZW51XCIpLnNsaW1zY3JvbGwoe1xuXHQgICAgICBoZWlnaHQ6IG8ubmF2YmFyTWVudUhlaWdodCxcblx0ICAgICAgYWx3YXlzVmlzaWJsZTogZmFsc2UsXG5cdCAgICAgIHNpemU6IG8ubmF2YmFyTWVudVNsaW1zY3JvbGxXaWR0aFxuXHQgICAgfSkuY3NzKFwid2lkdGhcIiwgXCIxMDAlXCIpO1xuXHQgIH1cblxuXHQgIC8vQWN0aXZhdGUgc2lkZWJhciBwdXNoIG1lbnVcblx0ICBpZiAoby5zaWRlYmFyUHVzaE1lbnUpIHtcblx0ICAgICQuTGF5b3V0TWFuYWdlci5wdXNoTWVudS5hY3RpdmF0ZShvLnNpZGViYXJUb2dnbGVTZWxlY3Rvcik7XG5cdCAgfVxuXG5cdCAgLy9BY3RpdmF0ZSBCb290c3RyYXAgdG9vbHRpcFxuXHQgIGlmIChvLmVuYWJsZUJTVG9wcGx0aXApIHtcblx0ICAgICQoJ2JvZHknKS50b29sdGlwKHtcblx0ICAgICAgc2VsZWN0b3I6IG8uQlNUb29sdGlwU2VsZWN0b3Jcblx0ICAgIH0pO1xuXHQgIH1cblxuXHQgIC8vQWN0aXZhdGUgYm94IHdpZGdldFxuXHQgIGlmIChvLmVuYWJsZUJveFdpZGdldCkge1xuXHQgICAgJC5MYXlvdXRNYW5hZ2VyLmJveFdpZGdldC5hY3RpdmF0ZSgpO1xuXHQgIH1cblxuXHQgIC8vQWN0aXZhdGUgZmFzdCBjbGlja1xuXHQgIGlmIChvLmVuYWJsZUZhc3RjbGljayAmJiB0eXBlb2YgRmFzdENsaWNrICE9ICd1bmRlZmluZWQnKSB7XG5cdCAgICBGYXN0Q2xpY2suYXR0YWNoKGRvY3VtZW50LmJvZHkpO1xuXHQgIH1cblxuXHQgIC8vQWN0aXZhdGUgZGlyZWN0IGNoYXQgd2lkZ2V0XG5cdCAgaWYgKG8uZGlyZWN0Q2hhdC5lbmFibGUpIHtcblx0ICAgICQoZG9jdW1lbnQpLm9uKCdjbGljaycsIG8uZGlyZWN0Q2hhdC5jb250YWN0VG9nZ2xlU2VsZWN0b3IsIGZ1bmN0aW9uICgpIHtcblx0ICAgICAgdmFyIGJveCA9ICQodGhpcykucGFyZW50cygnLmRpcmVjdC1jaGF0JykuZmlyc3QoKTtcblx0ICAgICAgYm94LnRvZ2dsZUNsYXNzKCdkaXJlY3QtY2hhdC1jb250YWN0cy1vcGVuJyk7XG5cdCAgICB9KTtcblx0ICB9XG5cblx0ICAvKlxuXHQgICAqIElOSVRJQUxJWkUgQlVUVE9OIFRPR0dMRVxuXHQgICAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXHQgICAqL1xuXHQgICQoJy5idG4tZ3JvdXBbZGF0YS10b2dnbGU9XCJidG4tdG9nZ2xlXCJdJykuZWFjaChmdW5jdGlvbiAoKSB7XG5cdCAgICB2YXIgZ3JvdXAgPSAkKHRoaXMpO1xuXHQgICAgJCh0aGlzKS5maW5kKFwiLmJ0blwiKS5vbignY2xpY2snLCBmdW5jdGlvbiAoZSkge1xuXHQgICAgICBncm91cC5maW5kKFwiLmJ0bi5hY3RpdmVcIikucmVtb3ZlQ2xhc3MoXCJhY3RpdmVcIik7XG5cdCAgICAgICQodGhpcykuYWRkQ2xhc3MoXCJhY3RpdmVcIik7XG5cdCAgICAgIGUucHJldmVudERlZmF1bHQoKTtcblx0ICAgIH0pO1xuXG5cdCAgfSk7XG5cdCAgXG5cdCAgcmV0dXJuICQuTGF5b3V0TWFuYWdlclxuXHQgIFx0LmFkZFJlZnJlc2hCdXR0b24oKVxuXHQgIFx0LmFjdGl2YXRlQm94KClcblx0ICBcdC5saXN0Q3VzdG9tUGx1Z2luKCk7XG5cdH07XG5cbiQuTGF5b3V0TWFuYWdlci5sb2FkaW5nID0gZnVuY3Rpb24oc3RhcnQpe1xuICB2YXIgc3RhcnQgPSBfLmlzQm9vbGVhbihzdGFydCkgPyBzdGFydCA6IHRydWU7XG4gIGlmIChzdGFydCkge1xuICAgICQoJ2JvZHknKS5hcHBlbmQoJzxkaXYgaWQ9XCJsb2Fkc3Bpbm5lclwiIGNsYXNzPVwibG9hZGluZ1wiPjwvZGl2PicpO1xuICB9XG4gIGVsc2Uge1xuICAgICQoJyNsb2Fkc3Bpbm5lcicpLnJlbW92ZSgpO1xuICB9XG59XG5cbm1vZHVsZS5leHBvcnRzID0gJC5MYXlvdXRNYW5hZ2VyO1xuIiwidmFyIHQgPSByZXF1aXJlKCdpMThuL2kxOG4uc2VydmljZScpLnQ7XG5yZXF1aXJlKCdnM3cvZ3VpL2NhdGFsb2cvY2F0YWxvZycpO1xucmVxdWlyZSgnZzN3L2d1aS9zZWFyY2gvc2VhcmNoJyk7XG5yZXF1aXJlKCdnM3cvZ3VpL3Rvb2xzL3Rvb2xzJyk7XG52YXIgU3RhY2sgPSByZXF1aXJlKCcuL2JhcnN0YWNrLmpzJyk7XG5cbmZ1bmN0aW9uIFNpZGViYXJTZXJ2aWNlKCl7XG4gIHRoaXMuc3RhY2sgPSBuZXcgU3RhY2soKTtcbiAgXG4gIHRoaXMuaW5pdCA9IGZ1bmN0aW9uKGxheW91dCl7XG4gICAgdGhpcy5sYXlvdXQgPSBsYXlvdXQ7XG4gIH07XG4gIFxuICB0aGlzLnNob3dQYW5lbCA9IGZ1bmN0aW9uKHBhbmVsKXtcbiAgICB0aGlzLnN0YWNrLnB1c2gocGFuZWwsXCIjZzN3LXNpZGViYXJwYW5lbC1wbGFjZWhvbGRlclwiKTtcbiAgfTtcbiAgXG4gIHRoaXMuY2xvc2VQYW5lbCA9IGZ1bmN0aW9uKCl7XG4gICAgdmFyIHBhbmVsID0gdGhpcy5zdGFjay5wb3AoKTtcbiAgICBpZiAocGFuZWwpe1xuICAgICAgaWYgKF8uaGFzSW4ocGFuZWwsXCIkZGVzdHJveVwiKSl7XG4gICAgICAgIHBhbmVsLiRkZXN0cm95KCk7XG4gICAgICB9XG4gICAgfVxuICB9XG59XG5cbnZhciBzaWRlYmFyU2VydmljZSA9IG5ldyBTaWRlYmFyU2VydmljZSgpO1xuXG52YXIgU2lkZWJhckNvbXBvbmVudCA9IFZ1ZS5leHRlbmQoe1xuICAgIGRhdGE6IGZ1bmN0aW9uKCkge1xuICAgIFx0cmV0dXJuIHtcbiAgICAgICAgcGFuZWxzOiBzaWRlYmFyU2VydmljZS5zdGFjay5zdGF0ZS5wYW5lbHMsXG4gICAgICAgIGJPcGVuOiB0cnVlLFxuICAgIFx0XHRiUGFnZU1vZGU6IGZhbHNlLFxuICAgIFx0XHRoZWFkZXI6IHQoJ21haW4gbmF2aWdhdGlvbicpLFxuICAgICAgICB9O1xuICAgIH0sXG4gICAgY29tcHV0ZWQ6IHtcbiAgICAgIC8vIHF1YW50aSBwYW5uZWxsaSBzb25vIGF0dGl2aSBuZWxsbyBzdGFja1xuICAgICAgcGFuZWxzaW5zdGFjazogZnVuY3Rpb24oKXtcbiAgICAgICAgcmV0dXJuIHRoaXMucGFuZWxzLmxlbmd0aD4wO1xuICAgICAgfSxcbiAgICAgIHBhbmVsbmFtZTogZnVuY3Rpb24oKXtcbiAgICAgICAgdmFyIG5hbWUgPSBcIlwiO1xuICAgICAgICBpZiAodGhpcy5wYW5lbHMubGVuZ3RoKXtcbiAgICAgICAgICBuYW1lID0gdGhpcy5wYW5lbHMuc2xpY2UoLTEpWzBdLm5hbWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG5hbWU7XG4gICAgICB9XG4gICAgfSxcbiAgICBtZXRob2RzOiB7XG4gICAgICBjbG9zZVBhbmVsOiBmdW5jdGlvbigpe1xuICAgICAgICBzaWRlYmFyU2VydmljZS5jbG9zZVBhbmVsKCk7XG4gICAgICB9XG4gICAgfSxcbiAgICByZWFkeTogZnVuY3Rpb24oKXtcbiAgICAgIC8vIHRlbXBvcmFuZW8sIHBlciBhdnZpYXJlIGRpcmV0dGFtZW50ZSBpdGVybmV0XG4gICAgICAvL3ZhciBpdGVybmV0ID0gcmVxdWlyZSgnZzN3LWl0ZXJuZXQvcGx1Z2luJyk7XG4gICAgICAvL2l0ZXJuZXQuc3RhcnRFZGl0aW5nKCk7XG4gICAgfVxufSk7XG5cblZ1ZS5jb21wb25lbnQoJ3NpZGViYXItaXRlbScse1xuXHRwcm9wczogWydkYXRhLWljb24nLCdkYXRhLWxhYmVsJywnZGF0YS10eXBlJywnb3Blbi1vbi1zdGFydCddLFxuICB0ZW1wbGF0ZTogcmVxdWlyZSgnLi90ZW1wbGF0ZXMvc2lkZWJhci1pdGVtLmh0bWwnKSxcbiAgZGF0YTogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgbWFpbjogdHJ1ZSxcbiAgICAgIH07XG4gIH1cbn0pO1xuXG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgU2lkZWJhclNlcnZpY2U6IHNpZGViYXJTZXJ2aWNlLFxuICBTaWRlYmFyQ29tcG9uZW50OiBTaWRlYmFyQ29tcG9uZW50XG59XG4iLCJtb2R1bGUuZXhwb3J0cyA9IFwiPGxpIGNsYXNzPVxcXCJ0cmVldmlld1xcXCIgOmNsYXNzPVxcXCJ7J2FjdGl2ZSc6IG9wZW5PblN0YXJ0fVxcXCI+XFxuICA8YSBocmVmPVxcXCIjXFxcIj5cXG4gICAgPGkgOmNsYXNzPVxcXCJkYXRhSWNvblxcXCI+PC9pPlxcbiAgICA8c3BhbiBjbGFzcz1cXFwidHJlZXZpZXctbGFiZWxcXFwiPnt7ZGF0YUxhYmVsIHwgdH19PC9zcGFuPiBcXG4gICAgPGkgdi1pZj1cXFwiKGRhdGFUeXBlID09PSAnaW5saW5lJylcXFwiIGNsYXNzPVxcXCJmYSBmYS1hbmdsZS1sZWZ0IHB1bGwtcmlnaHRcXFwiPjwvaT5cXG4gIDwvYT5cXG4gIDx1bCB2LWlmPVxcXCIoZGF0YVR5cGUgPT09ICdpbmxpbmUnKVxcXCIgY2xhc3M9XFxcInRyZWV2aWV3LW1lbnVcXFwiPlxcbiAgICA8c2xvdD48L3Nsb3Q+XFxuICA8L3VsPlxcbjwvbGk+XFxuXCI7XG4iLCJ2YXIgQ29udHJvbCA9IGZ1bmN0aW9uKG9wdGlvbnMpe1xuICB2YXIgbmFtZSA9IG9wdGlvbnMubmFtZSB8fCBcIj9cIjtcbiAgdGhpcy5uYW1lID0gbmFtZS5zcGxpdCgnICcpLmpvaW4oJy0nKS50b0xvd2VyQ2FzZSgpO1xuICB0aGlzLmlkID0gdGhpcy5uYW1lKydfJysoTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTAwMDAwMCkpO1xuICBcbiAgaWYgKCFvcHRpb25zLmVsZW1lbnQpIHtcbiAgICB2YXIgY2xhc3NOYW1lID0gXCJvbC1cIit0aGlzLm5hbWUuc3BsaXQoJyAnKS5qb2luKCctJykudG9Mb3dlckNhc2UoKTtcbiAgICB2YXIgdGlwTGFiZWwgPSBvcHRpb25zLnRpcExhYmVsIHx8IHRoaXMubmFtZTtcbiAgICB2YXIgbGFiZWwgPSBvcHRpb25zLmxhYmVsIHx8IFwiP1wiO1xuICAgIFxuICAgIG9wdGlvbnMuZWxlbWVudCA9ICQoJzxkaXYgY2xhc3M9XCInK2NsYXNzTmFtZSsnIG9sLXVuc2VsZWN0YWJsZSBvbC1jb250cm9sXCI+PGJ1dHRvbiB0eXBlPVwiYnV0dG9uXCIgdGl0bGU9XCInK3RpcExhYmVsKydcIj4nK2xhYmVsKyc8L2J1dHRvbj48L2Rpdj4nKVswXTtcbiAgfVxuICBcbiAgdmFyIGJ1dHRvbkNsaWNrSGFuZGxlciA9IG9wdGlvbnMuYnV0dG9uQ2xpY2tIYW5kbGVyIHx8IENvbnRyb2wucHJvdG90eXBlLl9oYW5kbGVDbGljay5iaW5kKHRoaXMpO1xuICBcbiAgJChvcHRpb25zLmVsZW1lbnQpLm9uKCdjbGljaycsYnV0dG9uQ2xpY2tIYW5kbGVyKTtcbiAgXG4gIG9sLmNvbnRyb2wuQ29udHJvbC5jYWxsKHRoaXMsb3B0aW9ucyk7XG4gIFxuICB0aGlzLl9wb3N0UmVuZGVyKCk7XG59XG5vbC5pbmhlcml0cyhDb250cm9sLCBvbC5jb250cm9sLkNvbnRyb2wpO1xuXG5cbnZhciBwcm90byA9IENvbnRyb2wucHJvdG90eXBlO1xuXG5wcm90by5faGFuZGxlQ2xpY2sgPSBmdW5jdGlvbigpe1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIHZhciBtYXAgPSB0aGlzLmdldE1hcCgpO1xuICBcbiAgdmFyIHJlc2V0Q29udHJvbCA9IG51bGw7XG4gIC8vIHJlbW92ZSBhbGwgdGhlIG90aGVyLCBldmVudHVhbGx5IHRvZ2dsZWQsIGludGVyYWN0aW9uY29udHJvbHNcbiAgdmFyIGNvbnRyb2xzID0gbWFwLmdldENvbnRyb2xzKCk7XG4gIGNvbnRyb2xzLmZvckVhY2goZnVuY3Rpb24oY29udHJvbCl7XG4gICAgaWYoY29udHJvbC5pZCAmJiBjb250cm9sLnRvZ2dsZSAmJiAoY29udHJvbC5pZCAhPSBzZWxmLmlkKSkge1xuICAgICAgY29udHJvbC50b2dnbGUoZmFsc2UpO1xuICAgICAgaWYgKGNvbnRyb2wubmFtZSA9PSAncmVzZXQnKSB7XG4gICAgICAgIHJlc2V0Q29udHJvbCA9IGNvbnRyb2w7XG4gICAgICB9XG4gICAgfVxuICB9KTtcbiAgaWYgKCFzZWxmLl90b2dnbGVkICYmIHJlc2V0Q29udHJvbCkge1xuICAgIHJlc2V0Q29udHJvbC50b2dnbGUodHJ1ZSk7XG4gIH1cbn07XG5cbnByb3RvLl9wb3N0UmVuZGVyID0gZnVuY3Rpb24oKXt9O1xuXG5tb2R1bGUuZXhwb3J0cyA9IENvbnRyb2w7XG4iLCJ2YXIgQ29udHJvbCA9IHJlcXVpcmUoJy4vY29udHJvbCcpO1xuXG52YXIgSW50ZXJhY3Rpb25Db250cm9sID0gZnVuY3Rpb24ob3B0aW9ucyl7XG4gIHRoaXMuX3RvZ2dsZWQgPSB0aGlzLl90b2dnbGVkIHx8IGZhbHNlO1xuICB0aGlzLl9pbnRlcmFjdGlvbiA9IG9wdGlvbnMuaW50ZXJhY3Rpb24gfHwgbnVsbDtcbiAgdGhpcy5fYXV0b3VudG9nZ2xlID0gb3B0aW9ucy5hdXRvdW50b2dnbGUgfHwgZmFsc2U7XG4gIFxuICBvcHRpb25zLmJ1dHRvbkNsaWNrSGFuZGxlciA9IEludGVyYWN0aW9uQ29udHJvbC5wcm90b3R5cGUuX2hhbmRsZUNsaWNrLmJpbmQodGhpcyk7XG4gIFxuICBDb250cm9sLmNhbGwodGhpcyxvcHRpb25zKTtcbn07XG5vbC5pbmhlcml0cyhJbnRlcmFjdGlvbkNvbnRyb2wsIENvbnRyb2wpO1xuXG52YXIgcHJvdG8gPSBJbnRlcmFjdGlvbkNvbnRyb2wucHJvdG90eXBlO1xuXG5wcm90by50b2dnbGUgPSBmdW5jdGlvbih0b2dnbGUpe1xuICB2YXIgdG9nZ2xlID0gdG9nZ2xlICE9PSB1bmRlZmluZWQgPyB0b2dnbGUgOiAhdGhpcy5fdG9nZ2xlZFxuICB0aGlzLl90b2dnbGVkID0gdG9nZ2xlO1xuICB2YXIgbWFwID0gdGhpcy5nZXRNYXAoKTtcbiAgdmFyIGNvbnRyb2xCdXR0b24gPSAkKHRoaXMuZWxlbWVudCkuZmluZCgnYnV0dG9uJykuZmlyc3QoKTtcbiAgXG4gIGlmICh0b2dnbGUpIHtcbiAgICBpZiAodGhpcy5faW50ZXJhY3Rpb24pIHtcbiAgICAgIG1hcC5hZGRJbnRlcmFjdGlvbih0aGlzLl9pbnRlcmFjdGlvbik7XG4gICAgfVxuICAgIGNvbnRyb2xCdXR0b24uYWRkQ2xhc3MoJ2czdy1vbC10b2dnbGVkJyk7XG4gIH1cbiAgZWxzZSB7XG4gICAgaWYgKHRoaXMuX2ludGVyYWN0aW9uKSB7XG4gICAgICBtYXAucmVtb3ZlSW50ZXJhY3Rpb24odGhpcy5faW50ZXJhY3Rpb24pO1xuICAgIH1cbiAgICBjb250cm9sQnV0dG9uLnJlbW92ZUNsYXNzKCdnM3ctb2wtdG9nZ2xlZCcpO1xuICB9XG59XG5cbnByb3RvLl9oYW5kbGVDbGljayA9IGZ1bmN0aW9uKGUpe1xuICB0aGlzLnRvZ2dsZSgpO1xuICBDb250cm9sLnByb3RvdHlwZS5faGFuZGxlQ2xpY2suY2FsbCh0aGlzLGUpO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBJbnRlcmFjdGlvbkNvbnRyb2w7XG4iLCJ2YXIgdXRpbHMgPSByZXF1aXJlKCcuLi91dGlscycpO1xudmFyIEludGVyYWN0aW9uQ29udHJvbCA9IHJlcXVpcmUoJy4vaW50ZXJhY3Rpb25jb250cm9sJyk7XG5cbnZhciBQaWNrQ29vcmRpbmF0ZXNJbnRlcmFjdGlvbiA9IHJlcXVpcmUoJy4uL2ludGVyYWN0aW9ucy9waWNrY29vcmRpbmF0ZXNpbnRlcmFjdGlvbicpO1xuXG52YXIgUXVlcnlDb250cm9sID0gZnVuY3Rpb24ob3B0aW9ucyl7XG4gIHZhciBzZWxmID0gdGhpcztcbiAgdmFyIF9vcHRpb25zID0ge1xuICAgIG5hbWU6IFwicXVlcnlsYXllclwiLFxuICAgIHRpcExhYmVsOiBcIlF1ZXJ5IGxheWVyXCIsXG4gICAgbGFiZWw6IFwiXFx1ZWEwZlwiLFxuICAgIGludGVyYWN0aW9uOiBuZXcgUGlja0Nvb3JkaW5hdGVzSW50ZXJhY3Rpb25cbiAgfTtcbiAgXG4gIG9wdGlvbnMgPSB1dGlscy5tZXJnZShvcHRpb25zLF9vcHRpb25zKTtcbiAgXG4gIEludGVyYWN0aW9uQ29udHJvbC5jYWxsKHRoaXMsb3B0aW9ucyk7XG4gIFxuICB0aGlzLl9pbnRlcmFjdGlvbi5vbigncGlja2VkJyxmdW5jdGlvbihlKXtcbiAgICBzZWxmLmRpc3BhdGNoRXZlbnQoe1xuICAgICAgdHlwZTogJ3BpY2tlZCcsXG4gICAgICBjb29yZGluYXRlczogZS5jb29yZGluYXRlXG4gICAgfSk7XG4gICAgaWYgKHNlbGYuX2F1dG91bnRvZ2dsZSkge1xuICAgICAgc2VsZi50b2dnbGUoKTtcbiAgICB9XG4gIH0pO1xufVxub2wuaW5oZXJpdHMoUXVlcnlDb250cm9sLCBJbnRlcmFjdGlvbkNvbnRyb2wpO1xuXG5tb2R1bGUuZXhwb3J0cyA9IFF1ZXJ5Q29udHJvbDtcbiIsInZhciB1dGlscyA9IHJlcXVpcmUoJy4uL3V0aWxzJyk7XG52YXIgSW50ZXJhY3Rpb25Db250cm9sID0gcmVxdWlyZSgnLi9pbnRlcmFjdGlvbmNvbnRyb2wnKTtcblxudmFyIFJlc2V0Q29udHJvbCA9IGZ1bmN0aW9uKG9wdGlvbnMpe1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIHRoaXMuX3RvZ2dsZWQgPSB0cnVlO1xuICB0aGlzLl9zdGFydENvb3JkaW5hdGUgPSBudWxsO1xuICB2YXIgX29wdGlvbnMgPSB7XG4gICAgICBuYW1lOiBcInJlc2V0XCIsXG4gICAgICB0aXBMYWJlbDogXCJQYW5cIixcbiAgICAgIGxhYmVsOiBcIlxcdWU5MDFcIixcbiAgICB9O1xuICBcbiAgb3B0aW9ucyA9IHV0aWxzLm1lcmdlKG9wdGlvbnMsX29wdGlvbnMpO1xuICBcbiAgSW50ZXJhY3Rpb25Db250cm9sLmNhbGwodGhpcyxvcHRpb25zKTtcbn1cbm9sLmluaGVyaXRzKFJlc2V0Q29udHJvbCwgSW50ZXJhY3Rpb25Db250cm9sKTtcbm1vZHVsZS5leHBvcnRzID0gUmVzZXRDb250cm9sO1xuXG52YXIgcHJvdG8gPSBSZXNldENvbnRyb2wucHJvdG90eXBlO1xuXG5wcm90by5fcG9zdFJlbmRlciA9IGZ1bmN0aW9uKCl7XG4gIHRoaXMudG9nZ2xlKHRydWUpO1xufTtcbiIsInZhciB1dGlscyA9IHJlcXVpcmUoJy4uL3V0aWxzJyk7XG52YXIgSW50ZXJhY3Rpb25Db250cm9sID0gcmVxdWlyZSgnLi9pbnRlcmFjdGlvbmNvbnRyb2wnKTtcblxudmFyIFpvb21Cb3hDb250cm9sID0gZnVuY3Rpb24ob3B0aW9ucyl7XG4gIHZhciBzZWxmID0gdGhpcztcbiAgdGhpcy5fc3RhcnRDb29yZGluYXRlID0gbnVsbDtcbiAgdmFyIF9vcHRpb25zID0ge1xuICAgICAgbmFtZTogXCJ6b29tYm94XCIsXG4gICAgICB0aXBMYWJlbDogXCJab29tIHRvIGJveFwiLFxuICAgICAgbGFiZWw6IFwiXFx1ZTkwMFwiLFxuICAgICAgaW50ZXJhY3Rpb246IG5ldyBvbC5pbnRlcmFjdGlvbi5EcmFnQm94XG4gICAgfTtcbiAgXG4gIG9wdGlvbnMgPSB1dGlscy5tZXJnZShvcHRpb25zLF9vcHRpb25zKTtcbiAgXG4gIEludGVyYWN0aW9uQ29udHJvbC5jYWxsKHRoaXMsb3B0aW9ucyk7XG4gIFxuICB0aGlzLl9pbnRlcmFjdGlvbi5vbignYm94c3RhcnQnLGZ1bmN0aW9uKGUpe1xuICAgIHNlbGYuX3N0YXJ0Q29vcmRpbmF0ZSA9IGUuY29vcmRpbmF0ZTtcbiAgfSk7XG4gIFxuICB0aGlzLl9pbnRlcmFjdGlvbi5vbignYm94ZW5kJyxmdW5jdGlvbihlKXtcbiAgICB2YXIgc3RhcnRfY29vcmRpbmF0ZSA9IHNlbGYuX3N0YXJ0Q29vcmRpbmF0ZTtcbiAgICB2YXIgZW5kX2Nvb3JkaW5hdGUgPSBlLmNvb3JkaW5hdGU7XG4gICAgdmFyIGV4dGVudCA9IG9sLmV4dGVudC5ib3VuZGluZ0V4dGVudChbc3RhcnRfY29vcmRpbmF0ZSxlbmRfY29vcmRpbmF0ZV0pO1xuICAgIHNlbGYuZGlzcGF0Y2hFdmVudCh7XG4gICAgICB0eXBlOiAnem9vbWVuZCcsXG4gICAgICBleHRlbnQ6IGV4dGVudFxuICAgIH0pO1xuICAgIHNlbGYuX3N0YXJ0Q29vcmRpbmF0ZSA9IG51bGw7XG4gICAgaWYgKHNlbGYuX2F1dG91bnRvZ2dsZSkge1xuICAgICAgc2VsZi50b2dnbGUoKTtcbiAgICB9XG4gIH0pXG59XG5vbC5pbmhlcml0cyhab29tQm94Q29udHJvbCwgSW50ZXJhY3Rpb25Db250cm9sKTtcbm1vZHVsZS5leHBvcnRzID0gWm9vbUJveENvbnRyb2w7XG4iLCJ2YXIgdXRpbHMgPSByZXF1aXJlKCcuL3V0aWxzJyk7XG52YXIgbWFwaGVscGVycyA9IHJlcXVpcmUoJy4vbWFwL21hcGhlbHBlcnMnKTtcblxuKGZ1bmN0aW9uIChuYW1lLCByb290LCBmYWN0b3J5KSB7XG4gIGlmICh0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpIHtcbiAgICBkZWZpbmUoZmFjdG9yeSk7XG4gIH1cbiAgZWxzZSBpZiAodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnKSB7XG4gICAgbW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KCk7XG4gIH1cbiAgZWxzZSB7XG4gICAgcm9vdFtuYW1lXSA9IGZhY3RvcnkoKTtcbiAgfVxufSkoJ2czd29sMycsIHRoaXMsIGZ1bmN0aW9uICgpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBcbiAgdmFyIGhlbHBlcnMgPSB1dGlscy5tZXJnZSh7fSxtYXBoZWxwZXJzKTtcbiAgXG4gIHJldHVybiB7XG4gICAgaGVscGVyczogaGVscGVyc1xuICB9XG59KTtcbiIsInZhciBQaWNrQ29vcmRpbmF0ZXNFdmVudFR5cGUgPSB7XG4gIFBJQ0tFRDogJ3BpY2tlZCdcbn07XG5cbnZhciBQaWNrQ29vcmRpbmF0ZXNFdmVudCA9IGZ1bmN0aW9uKHR5cGUsIGNvb3JkaW5hdGUpIHtcbiAgdGhpcy50eXBlID0gdHlwZTtcbiAgdGhpcy5jb29yZGluYXRlID0gY29vcmRpbmF0ZTtcbn07XG5cbnZhciBQaWNrQ29vcmRpbmF0ZXNJbnRlcmFjdGlvbiA9IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgdGhpcy5wcmV2aW91c0N1cnNvcl8gPSBudWxsO1xuICBcbiAgb2wuaW50ZXJhY3Rpb24uUG9pbnRlci5jYWxsKHRoaXMsIHtcbiAgICBoYW5kbGVEb3duRXZlbnQ6IFBpY2tDb29yZGluYXRlc0ludGVyYWN0aW9uLmhhbmRsZURvd25FdmVudF8sXG4gICAgaGFuZGxlVXBFdmVudDogUGlja0Nvb3JkaW5hdGVzSW50ZXJhY3Rpb24uaGFuZGxlVXBFdmVudF8sXG4gICAgaGFuZGxlTW92ZUV2ZW50OiBQaWNrQ29vcmRpbmF0ZXNJbnRlcmFjdGlvbi5oYW5kbGVNb3ZlRXZlbnRfLFxuICB9KTtcbn07XG5vbC5pbmhlcml0cyhQaWNrQ29vcmRpbmF0ZXNJbnRlcmFjdGlvbiwgb2wuaW50ZXJhY3Rpb24uUG9pbnRlcik7XG5cblBpY2tDb29yZGluYXRlc0ludGVyYWN0aW9uLmhhbmRsZURvd25FdmVudF8gPSBmdW5jdGlvbihldmVudCkge1xuICByZXR1cm4gdHJ1ZTtcbn07XG5cblBpY2tDb29yZGluYXRlc0ludGVyYWN0aW9uLmhhbmRsZVVwRXZlbnRfID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgdGhpcy5kaXNwYXRjaEV2ZW50KFxuICAgICAgICAgIG5ldyBQaWNrQ29vcmRpbmF0ZXNFdmVudChcbiAgICAgICAgICAgICAgUGlja0Nvb3JkaW5hdGVzRXZlbnRUeXBlLlBJQ0tFRCxcbiAgICAgICAgICAgICAgZXZlbnQuY29vcmRpbmF0ZSkpO1xuICByZXR1cm4gdHJ1ZTtcbn07XG5cblBpY2tDb29yZGluYXRlc0ludGVyYWN0aW9uLmhhbmRsZU1vdmVFdmVudF8gPSBmdW5jdGlvbihldmVudCkge1xuICB2YXIgZWxlbSA9IGV2ZW50Lm1hcC5nZXRUYXJnZXRFbGVtZW50KCk7XG4gIGVsZW0uc3R5bGUuY3Vyc29yID0gICdwb2ludGVyJztcbn07XG5cblBpY2tDb29yZGluYXRlc0ludGVyYWN0aW9uLnByb3RvdHlwZS5zaG91bGRTdG9wRXZlbnQgPSBmdW5jdGlvbigpe1xuICByZXR1cm4gZmFsc2U7XG59O1xuXG5QaWNrQ29vcmRpbmF0ZXNJbnRlcmFjdGlvbi5wcm90b3R5cGUuc2V0TWFwID0gZnVuY3Rpb24obWFwKXtcbiAgaWYgKCFtYXApIHtcbiAgICB2YXIgZWxlbSA9IHRoaXMuZ2V0TWFwKCkuZ2V0VGFyZ2V0RWxlbWVudCgpO1xuICAgIGVsZW0uc3R5bGUuY3Vyc29yID0gJyc7XG4gIH1cbiAgb2wuaW50ZXJhY3Rpb24uUG9pbnRlci5wcm90b3R5cGUuc2V0TWFwLmNhbGwodGhpcyxtYXApO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBQaWNrQ29vcmRpbmF0ZXNJbnRlcmFjdGlvbjtcbiIsIiAgdmFyIFBpY2tGZWF0dXJlRXZlbnRUeXBlID0ge1xuICBQSUNLRUQ6ICdwaWNrZWQnXG59O1xuXG52YXIgUGlja0ZlYXR1cmVFdmVudCA9IGZ1bmN0aW9uKHR5cGUsIGNvb3JkaW5hdGUsIGZlYXR1cmUpIHtcbiAgdGhpcy50eXBlID0gdHlwZTtcbiAgdGhpcy5mZWF0dXJlID0gZmVhdHVyZTtcbiAgdGhpcy5jb29yZGluYXRlID0gY29vcmRpbmF0ZTtcbn07XG5cbnZhciBQaWNrRmVhdHVyZUludGVyYWN0aW9uID0gZnVuY3Rpb24ob3B0aW9ucykge1xuICBvbC5pbnRlcmFjdGlvbi5Qb2ludGVyLmNhbGwodGhpcywge1xuICAgIGhhbmRsZURvd25FdmVudDogUGlja0ZlYXR1cmVJbnRlcmFjdGlvbi5oYW5kbGVEb3duRXZlbnRfLFxuICAgIGhhbmRsZVVwRXZlbnQ6IFBpY2tGZWF0dXJlSW50ZXJhY3Rpb24uaGFuZGxlVXBFdmVudF8sXG4gICAgaGFuZGxlTW92ZUV2ZW50OiBQaWNrRmVhdHVyZUludGVyYWN0aW9uLmhhbmRsZU1vdmVFdmVudF8sXG4gIH0pO1xuICBcbiAgdGhpcy5mZWF0dXJlc18gPSBvcHRpb25zLmZlYXR1cmVzIHx8IG51bGw7XG4gIFxuICB0aGlzLmxheWVyc18gPSBvcHRpb25zLmxheWVycyB8fCBudWxsO1xuICBcbiAgdGhpcy5waWNrZWRGZWF0dXJlXyA9IG51bGw7XG4gIFxuICB2YXIgc2VsZiA9IHRoaXM7XG4gIHRoaXMubGF5ZXJGaWx0ZXJfID0gZnVuY3Rpb24obGF5ZXIpIHtcbiAgICByZXR1cm4gXy5pbmNsdWRlcyhzZWxmLmxheWVyc18sIGxheWVyKTtcbiAgfTtcbn07XG5vbC5pbmhlcml0cyhQaWNrRmVhdHVyZUludGVyYWN0aW9uLCBvbC5pbnRlcmFjdGlvbi5Qb2ludGVyKTtcblxuUGlja0ZlYXR1cmVJbnRlcmFjdGlvbi5oYW5kbGVEb3duRXZlbnRfID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgdGhpcy5waWNrZWRGZWF0dXJlXyA9IHRoaXMuZmVhdHVyZXNBdFBpeGVsXyhldmVudC5waXhlbCwgZXZlbnQubWFwKTtcbiAgcmV0dXJuIHRydWU7XG59O1xuXG5QaWNrRmVhdHVyZUludGVyYWN0aW9uLmhhbmRsZVVwRXZlbnRfID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgaWYodGhpcy5waWNrZWRGZWF0dXJlXyl7XG4gICAgdGhpcy5kaXNwYXRjaEV2ZW50KFxuICAgICAgICAgICAgbmV3IFBpY2tGZWF0dXJlRXZlbnQoXG4gICAgICAgICAgICAgICAgUGlja0ZlYXR1cmVFdmVudFR5cGUuUElDS0VELFxuICAgICAgICAgICAgICAgIGV2ZW50LmNvb3JkaW5hdGUsXG4gICAgICAgICAgICAgICAgdGhpcy5waWNrZWRGZWF0dXJlXykpO1xuICB9XG4gIHJldHVybiB0cnVlO1xufTtcblxuUGlja0ZlYXR1cmVJbnRlcmFjdGlvbi5oYW5kbGVNb3ZlRXZlbnRfID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgdmFyIGVsZW0gPSBldmVudC5tYXAuZ2V0VGFyZ2V0RWxlbWVudCgpO1xuICB2YXIgaW50ZXJzZWN0aW5nRmVhdHVyZSA9IHRoaXMuZmVhdHVyZXNBdFBpeGVsXyhldmVudC5waXhlbCwgZXZlbnQubWFwKTtcblxuICBpZiAoaW50ZXJzZWN0aW5nRmVhdHVyZSkge1xuICAgIGVsZW0uc3R5bGUuY3Vyc29yID0gICdwb2ludGVyJztcbiAgfSBlbHNlIHtcbiAgICBlbGVtLnN0eWxlLmN1cnNvciA9ICcnO1xuICB9XG59O1xuXG5QaWNrRmVhdHVyZUludGVyYWN0aW9uLnByb3RvdHlwZS5mZWF0dXJlc0F0UGl4ZWxfID0gZnVuY3Rpb24ocGl4ZWwsIG1hcCkge1xuICB2YXIgZm91bmQgPSBudWxsO1xuXG4gIHZhciBpbnRlcnNlY3RpbmdGZWF0dXJlID0gbWFwLmZvckVhY2hGZWF0dXJlQXRQaXhlbChwaXhlbCxcbiAgICAgIGZ1bmN0aW9uKGZlYXR1cmUpIHtcbiAgICAgICAgaWYgKHRoaXMuZmVhdHVyZXNfKSB7XG4gICAgICAgICAgaWYgKHRoaXMuZmVhdHVyZXNfLmluZGV4T2YoZmVhdHVyZSkgPiAtMSl7XG4gICAgICAgICAgICByZXR1cm4gZmVhdHVyZVxuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNle1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmZWF0dXJlO1xuICAgICAgfSx0aGlzLHRoaXMubGF5ZXJGaWx0ZXJfKTtcbiAgXG4gIGlmKGludGVyc2VjdGluZ0ZlYXR1cmUpe1xuICAgIGZvdW5kID0gaW50ZXJzZWN0aW5nRmVhdHVyZTtcbiAgfVxuICByZXR1cm4gZm91bmQ7XG59O1xuXG5QaWNrRmVhdHVyZUludGVyYWN0aW9uLnByb3RvdHlwZS5zaG91bGRTdG9wRXZlbnQgPSBmdW5jdGlvbigpe1xuICByZXR1cm4gZmFsc2U7XG59O1xuXG5QaWNrRmVhdHVyZUludGVyYWN0aW9uLnByb3RvdHlwZS5zZXRNYXAgPSBmdW5jdGlvbihtYXApe1xuICBpZiAoIW1hcCkge1xuICAgIHZhciBlbGVtID0gdGhpcy5nZXRNYXAoKS5nZXRUYXJnZXRFbGVtZW50KCk7XG4gICAgZWxlbS5zdHlsZS5jdXJzb3IgPSAnJztcbiAgfVxuICBvbC5pbnRlcmFjdGlvbi5Qb2ludGVyLnByb3RvdHlwZS5zZXRNYXAuY2FsbCh0aGlzLG1hcCk7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFBpY2tGZWF0dXJlSW50ZXJhY3Rpb247XG4iLCJ2YXIgQmFzZUxheWVycyA9IHt9O1xuXG5CYXNlTGF5ZXJzLk9TTSA9IG5ldyBvbC5sYXllci5UaWxlKHtcbiAgc291cmNlOiBuZXcgb2wuc291cmNlLk9TTSh7XG4gICAgYXR0cmlidXRpb25zOiBbXG4gICAgICBuZXcgb2wuQXR0cmlidXRpb24oe1xuICAgICAgICBodG1sOiAnQWxsIG1hcHMgJmNvcHk7ICcgK1xuICAgICAgICAgICAgJzxhIGhyZWY9XCJodHRwOi8vd3d3Lm9wZW5zdHJlZXRtYXAub3JnL1wiPk9wZW5TdHJlZXRNYXA8L2E+J1xuICAgICAgfSksXG4gICAgICBvbC5zb3VyY2UuT1NNLkFUVFJJQlVUSU9OXG4gICAgXSxcbiAgICB1cmw6ICdodHRwOi8ve2EtY30udGlsZS5vcGVuc3RyZWV0bWFwLm9yZy97en0ve3h9L3t5fS5wbmcnLFxuICAgIGNyb3NzT3JpZ2luOiBudWxsXG4gIH0pLFxuICBpZDogJ29zbScsXG4gIHRpdGxlOiAnT1NNJyxcbiAgYmFzZW1hcDogdHJ1ZVxufSk7XG5cbkJhc2VMYXllcnMuQklORyA9IHt9O1xuXG5CYXNlTGF5ZXJzLkJJTkcuUm9hZCA9IG5ldyBvbC5sYXllci5UaWxlKHtcbiAgbmFtZTonUm9hZCcsXG4gIHZpc2libGU6IGZhbHNlLFxuICBwcmVsb2FkOiBJbmZpbml0eSxcbiAgc291cmNlOiBuZXcgb2wuc291cmNlLkJpbmdNYXBzKHtcbiAgICBrZXk6ICdBbV9tQVNuVUEtanRXM08zTXhJWW1PT1BMT3ZMMzlkd012Um55b0h4ZktmX0VQTllnZldNOWltcUdFVFdLR1ZuJyxcbiAgICBpbWFnZXJ5U2V0OiAnUm9hZCdcbiAgICAgIC8vIHVzZSBtYXhab29tIDE5IHRvIHNlZSBzdHJldGNoZWQgdGlsZXMgaW5zdGVhZCBvZiB0aGUgQmluZ01hcHNcbiAgICAgIC8vIFwibm8gcGhvdG9zIGF0IHRoaXMgem9vbSBsZXZlbFwiIHRpbGVzXG4gICAgICAvLyBtYXhab29tOiAxOVxuICB9KSxcbiAgYmFzZW1hcDogdHJ1ZVxufSk7XG5cbkJhc2VMYXllcnMuQklORy5BZXJpYWxXaXRoTGFiZWxzID0gbmV3IG9sLmxheWVyLlRpbGUoe1xuICBuYW1lOiAnQWVyaWFsV2l0aExhYmVscycsXG4gIHZpc2libGU6IHRydWUsXG4gIHByZWxvYWQ6IEluZmluaXR5LFxuICBzb3VyY2U6IG5ldyBvbC5zb3VyY2UuQmluZ01hcHMoe1xuICAgIGtleTogJ0FtX21BU25VQS1qdFczTzNNeElZbU9PUExPdkwzOWR3TXZSbnlvSHhmS2ZfRVBOWWdmV005aW1xR0VUV0tHVm4nLFxuICAgIGltYWdlcnlTZXQ6ICdBZXJpYWxXaXRoTGFiZWxzJ1xuICAgICAgLy8gdXNlIG1heFpvb20gMTkgdG8gc2VlIHN0cmV0Y2hlZCB0aWxlcyBpbnN0ZWFkIG9mIHRoZSBCaW5nTWFwc1xuICAgICAgLy8gXCJubyBwaG90b3MgYXQgdGhpcyB6b29tIGxldmVsXCIgdGlsZXNcbiAgICAgIC8vIG1heFpvb206IDE5XG4gIH0pLFxuICBiYXNlbWFwOiB0cnVlXG59KTtcblxuQmFzZUxheWVycy5CSU5HLkFlcmlhbCA9IG5ldyBvbC5sYXllci5UaWxlKHtcbiAgbmFtZTogJ0FlcmlhbCcsXG4gIHZpc2libGU6IGZhbHNlLFxuICBwcmVsb2FkOiBJbmZpbml0eSxcbiAgc291cmNlOiBuZXcgb2wuc291cmNlLkJpbmdNYXBzKHtcbiAgICBrZXk6ICdBbV9tQVNuVUEtanRXM08zTXhJWW1PT1BMT3ZMMzlkd012Um55b0h4ZktmX0VQTllnZldNOWltcUdFVFdLR1ZuJyxcbiAgICBpbWFnZXJ5U2V0OiAnQWVyaWFsJ1xuICAgICAgLy8gdXNlIG1heFpvb20gMTkgdG8gc2VlIHN0cmV0Y2hlZCB0aWxlcyBpbnN0ZWFkIG9mIHRoZSBCaW5nTWFwc1xuICAgICAgLy8gXCJubyBwaG90b3MgYXQgdGhpcyB6b29tIGxldmVsXCIgdGlsZXNcbiAgICAgIC8vIG1heFpvb206IDE5XG4gIH0pLFxuICBiYXNlbWFwOiB0cnVlXG59KTtcblxubW9kdWxlLmV4cG9ydHMgPSBCYXNlTGF5ZXJzO1xuIiwidmFyIHV0aWxzID0gcmVxdWlyZSgnLi4vdXRpbHMnKTtcbnZhciBSYXN0ZXJMYXllcnMgPSB7fTtcblxuUmFzdGVyTGF5ZXJzLlRpbGVkV01TTGF5ZXIgPSBmdW5jdGlvbihsYXllck9iaixleHRyYVBhcmFtcyl7XG4gIHZhciBvcHRpb25zID0ge1xuICAgIGxheWVyT2JqOiBsYXllck9iaixcbiAgICBleHRyYVBhcmFtczogZXh0cmFQYXJhbXMgfHwge30sXG4gICAgdGlsZWQ6IHRydWVcbiAgfVxuICByZXR1cm4gUmFzdGVyTGF5ZXJzLl9XTVNMYXllcihvcHRpb25zKTtcbn07XG5cblJhc3RlckxheWVycy5XTVNMYXllciA9IGZ1bmN0aW9uKGxheWVyT2JqLGV4dHJhUGFyYW1zKXtcbiAgdmFyIG9wdGlvbnMgPSB7XG4gICAgbGF5ZXJPYmo6IGxheWVyT2JqLFxuICAgIGV4dHJhUGFyYW1zOiBleHRyYVBhcmFtcyB8fCB7fVxuICB9XG4gIHJldHVybiBSYXN0ZXJMYXllcnMuX1dNU0xheWVyKG9wdGlvbnMpO1xufTtcblxuUmFzdGVyTGF5ZXJzLl9XTVNMYXllciA9IGZ1bmN0aW9uKG9wdGlvbnMpe1xuICB2YXIgbGF5ZXJPYmogPSBvcHRpb25zLmxheWVyT2JqO1xuICB2YXIgZXh0cmFQYXJhbXMgPSBvcHRpb25zLmV4dHJhUGFyYW1zO1xuICB2YXIgdGlsZWQgPSBvcHRpb25zLnRpbGVkIHx8IGZhbHNlO1xuICBcbiAgdmFyIHBhcmFtcyA9IHtcbiAgICBMQVlFUlM6IGxheWVyT2JqLmxheWVycyB8fCAnJyxcbiAgICBWRVJTSU9OOiAnMS4zLjAnLFxuICAgIFRSQU5TUEFSRU5UOiB0cnVlLFxuICAgIFNMRF9WRVJTSU9OOiAnMS4xLjAnXG4gIH07XG4gIFxuICBwYXJhbXMgPSB1dGlscy5tZXJnZShwYXJhbXMsZXh0cmFQYXJhbXMpO1xuICBcbiAgdmFyIHNvdXJjZU9wdGlvbnMgPSB7XG4gICAgdXJsOiBsYXllck9iai51cmwsXG4gICAgcGFyYW1zOiBwYXJhbXMsXG4gICAgcmF0aW86IDFcbiAgfTtcbiAgXG4gIHZhciBpbWFnZU9wdGlvbnMgPSB7XG4gICAgaWQ6IGxheWVyT2JqLmlkLFxuICAgIG5hbWU6IGxheWVyT2JqLm5hbWUsXG4gICAgb3BhY2l0eTogbGF5ZXJPYmoub3BhY2l0eSB8fCAxLjAsXG4gICAgdmlzaWJsZTpsYXllck9iai52aXNpYmxlLFxuICAgIG1heFJlc29sdXRpb246IGxheWVyT2JqLm1heFJlc29sdXRpb25cbiAgfVxuICBcbiAgdmFyIGltYWdlQ2xhc3M7XG4gIHZhciBzb3VyY2U7XG4gIGlmICh0aWxlZCkge1xuICAgIHNvdXJjZSA9IG5ldyBvbC5zb3VyY2UuVGlsZVdNUyhzb3VyY2VPcHRpb25zKTtcbiAgICBpbWFnZUNsYXNzID0gb2wubGF5ZXIuVGlsZTtcbiAgICAvL2ltYWdlT3B0aW9ucy5leHRlbnQgPSBbMTEzNDg2NywzODczMDAyLDI1MDU5NjQsNTU5Njk0NF07XG4gIH1cbiAgZWxzZSB7XG4gICAgc291cmNlID0gbmV3IG9sLnNvdXJjZS5JbWFnZVdNUyhzb3VyY2VPcHRpb25zKVxuICAgIGltYWdlQ2xhc3MgPSBvbC5sYXllci5JbWFnZTtcbiAgfVxuICBcbiAgaW1hZ2VPcHRpb25zLnNvdXJjZSA9IHNvdXJjZTtcbiAgXG4gIHZhciBsYXllciA9IG5ldyBpbWFnZUNsYXNzKGltYWdlT3B0aW9ucyk7XG4gIFxuICByZXR1cm4gbGF5ZXI7XG59O1xuXG4vKlJhc3RlckxheWVycy5UaWxlZFdNU0xheWVyID0gZnVuY3Rpb24obGF5ZXJPYmope1xuICB2YXIgbGF5ZXIgPSBuZXcgb2wubGF5ZXIuVGlsZSh7XG4gICAgbmFtZTogbGF5ZXJPYmoubmFtZSxcbiAgICBvcGFjaXR5OiAxLjAsXG4gICAgc291cmNlOiBuZXcgb2wuc291cmNlLlRpbGVXTVMoe1xuICAgICAgdXJsOiBsYXllck9iai51cmwsXG4gICAgICBwYXJhbXM6IHtcbiAgICAgICAgTEFZRVJTOiBsYXllck9iai5sYXllcnMgfHwgJycsXG4gICAgICAgIFZFUlNJT046ICcxLjMuMCcsXG4gICAgICAgIFRSQU5TUEFSRU5UOiB0cnVlXG4gICAgICB9XG4gICAgfSksXG4gICAgdmlzaWJsZTogbGF5ZXJPYmoudmlzaWJsZVxuICB9KTtcbiAgXG4gIHJldHVybiBsYXllcjtcbn07Ki9cblxubW9kdWxlLmV4cG9ydHMgPSBSYXN0ZXJMYXllcnM7XG5cbiIsIkJhc2VMYXllcnMgPSByZXF1aXJlKCcuLi9sYXllcnMvYmFzZXMnKTtcblxudmFyIE1hcEhlbHBlcnMgPSB7XG4gIGNyZWF0ZVZpZXdlcjogZnVuY3Rpb24ob3B0cyl7XG4gICAgcmV0dXJuIG5ldyBfVmlld2VyKG9wdHMpO1xuICB9XG59O1xuXG52YXIgX1ZpZXdlciA9IGZ1bmN0aW9uKG9wdHMpe1xuICB2YXIgY29udHJvbHMgPSBvbC5jb250cm9sLmRlZmF1bHRzKHtcbiAgICBhdHRyaWJ1dGlvbk9wdGlvbnM6IHtcbiAgICAgIGNvbGxhcHNpYmxlOiBmYWxzZVxuICAgIH0sXG4gICAgem9vbTogZmFsc2UsXG4gICAgYXR0cmlidXRpb246IGZhbHNlXG4gIH0pOy8vLmV4dGVuZChbbmV3IG9sLmNvbnRyb2wuWm9vbSgpXSk7XG4gIFxuICB2YXIgaW50ZXJhY3Rpb25zID0gb2wuaW50ZXJhY3Rpb24uZGVmYXVsdHMoKVxuICAgIC5leHRlbmQoW1xuICAgICAgbmV3IG9sLmludGVyYWN0aW9uLkRyYWdSb3RhdGUoKVxuICAgIF0pO1xuICBpbnRlcmFjdGlvbnMucmVtb3ZlQXQoMSkgLy8gcmltdW92byBkb3VjbGlja3pvb21cbiAgXG4gIHZhciB2aWV3ID0gbmV3IG9sLlZpZXcob3B0cy52aWV3KTtcbiAgdmFyIG9wdGlvbnMgPSB7XG4gICAgY29udHJvbHM6IGNvbnRyb2xzLFxuICAgIGludGVyYWN0aW9uczogaW50ZXJhY3Rpb25zLFxuICAgIG9sM0xvZ286IGZhbHNlLFxuICAgIHZpZXc6IHZpZXcsXG4gICAga2V5Ym9hcmRFdmVudFRhcmdldDogZG9jdW1lbnRcbiAgfTtcbiAgaWYgKG9wdHMuaWQpe1xuICAgIG9wdGlvbnMudGFyZ2V0ID0gb3B0cy5pZDtcbiAgfVxuICB2YXIgbWFwICA9IG5ldyBvbC5NYXAob3B0aW9ucyk7XG4gIHRoaXMubWFwID0gbWFwO1xufTtcblxuX1ZpZXdlci5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uKCl7XG4gIGlmICh0aGlzLm1hcCkge1xuICAgIHRoaXMubWFwLmRpc3Bvc2UoKTtcbiAgICB0aGlzLm1hcCA9IG51bGxcbiAgfVxufTtcblxuX1ZpZXdlci5wcm90b3R5cGUudXBkYXRlTWFwID0gZnVuY3Rpb24obWFwT2JqZWN0KXt9O1xuXG5fVmlld2VyLnByb3RvdHlwZS51cGRhdGVWaWV3ID0gZnVuY3Rpb24oKXt9O1xuXG5fVmlld2VyLnByb3RvdHlwZS5nZXRNYXAgPSBmdW5jdGlvbigpe1xuICByZXR1cm4gdGhpcy5tYXA7XG59O1xuXG5fVmlld2VyLnByb3RvdHlwZS5zZXRUYXJnZXQgPSBmdW5jdGlvbihpZCl7XG4gIHRoaXMubWFwLnNldFRhcmdldChpZCk7XG59O1xuXG5fVmlld2VyLnByb3RvdHlwZS5nb1RvID0gZnVuY3Rpb24oY29vcmRpbmF0ZXMsIHpvb20pe1xuICB2YXIgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307XG4gIHZhciBhbmltYXRlID0gb3B0aW9ucy5hbmltYXRlIHx8IHRydWU7XG4gIHZhciB2aWV3ID0gdGhpcy5tYXAuZ2V0VmlldygpO1xuICBcbiAgaWYgKGFuaW1hdGUpIHtcbiAgICB2YXIgcGFuID0gb2wuYW5pbWF0aW9uLnBhbih7XG4gICAgICBkdXJhdGlvbjogNTAwLFxuICAgICAgc291cmNlOiB2aWV3LmdldENlbnRlcigpXG4gICAgfSk7XG4gICAgdmFyIHpvb20gPSBvbC5hbmltYXRpb24uem9vbSh7XG4gICAgICBkdXJhdGlvbjogNTAwLFxuICAgICAgcmVzb2x1dGlvbjogdmlldy5nZXRSZXNvbHV0aW9uKClcbiAgICB9KTtcbiAgICB0aGlzLm1hcC5iZWZvcmVSZW5kZXIocGFuLHpvb20pO1xuICB9XG4gIFxuICB2aWV3LnNldENlbnRlcihjb29yZGluYXRlcyk7XG4gIHZpZXcuc2V0Wm9vbSh6b29tKTtcbn07XG5cbl9WaWV3ZXIucHJvdG90eXBlLmdvVG9SZXMgPSBmdW5jdGlvbihjb29yZGluYXRlcywgcmVzb2x1dGlvbil7XG4gIHZhciBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcbiAgdmFyIGFuaW1hdGUgPSBvcHRpb25zLmFuaW1hdGUgfHwgdHJ1ZTtcbiAgdmFyIHZpZXcgPSB0aGlzLm1hcC5nZXRWaWV3KCk7XG4gIFxuICBpZiAoYW5pbWF0ZSkge1xuICAgIHZhciBwYW4gPSBvbC5hbmltYXRpb24ucGFuKHtcbiAgICAgIGR1cmF0aW9uOiA1MDAsXG4gICAgICBzb3VyY2U6IHZpZXcuZ2V0Q2VudGVyKClcbiAgICB9KTtcbiAgICB2YXIgem9vbSA9IG9sLmFuaW1hdGlvbi56b29tKHtcbiAgICAgIGR1cmF0aW9uOiA1MDAsXG4gICAgICByZXNvbHV0aW9uOiB2aWV3LmdldFJlc29sdXRpb24oKVxuICAgIH0pO1xuICAgIHRoaXMubWFwLmJlZm9yZVJlbmRlcihwYW4sem9vbSk7XG4gIH1cblxuICB2aWV3LnNldENlbnRlcihjb29yZGluYXRlcyk7XG4gIHZpZXcuc2V0UmVzb2x1dGlvbihyZXNvbHV0aW9uKTtcbn07XG5cbl9WaWV3ZXIucHJvdG90eXBlLmZpdCA9IGZ1bmN0aW9uKGdlb21ldHJ5LCBvcHRpb25zKXtcbiAgdmFyIHZpZXcgPSB0aGlzLm1hcC5nZXRWaWV3KCk7XG4gIFxuICB2YXIgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307XG4gIHZhciBhbmltYXRlID0gb3B0aW9ucy5hbmltYXRlIHx8IHRydWU7XG4gIFxuICBpZiAoYW5pbWF0ZSkge1xuICAgIHZhciBwYW4gPSBvbC5hbmltYXRpb24ucGFuKHtcbiAgICAgIGR1cmF0aW9uOiA1MDAsXG4gICAgICBzb3VyY2U6IHZpZXcuZ2V0Q2VudGVyKClcbiAgICB9KTtcbiAgICB2YXIgem9vbSA9IG9sLmFuaW1hdGlvbi56b29tKHtcbiAgICAgIGR1cmF0aW9uOiA1MDAsXG4gICAgICByZXNvbHV0aW9uOiB2aWV3LmdldFJlc29sdXRpb24oKVxuICAgIH0pO1xuICAgIHRoaXMubWFwLmJlZm9yZVJlbmRlcihwYW4sem9vbSk7XG4gIH1cbiAgXG4gIGlmIChvcHRpb25zLmFuaW1hdGUpIHtcbiAgICBkZWxldGUgb3B0aW9ucy5hbmltYXRlOyAvLyBub24gbG8gcGFzc28gYWwgbWV0b2RvIGRpIE9MMyBwZXJjaMOpIMOoIHVuJ29wemlvbmUgaW50ZXJuYVxuICB9XG4gIG9wdGlvbnMuY29uc3RyYWluUmVzb2x1dGlvbiA9IG9wdGlvbnMuY29uc3RyYWluUmVzb2x1dGlvbiB8fCBmYWxzZTtcbiAgXG4gIHZpZXcuZml0KGdlb21ldHJ5LHRoaXMubWFwLmdldFNpemUoKSxvcHRpb25zKTtcbn07XG5cbl9WaWV3ZXIucHJvdG90eXBlLmdldFpvb20gPSBmdW5jdGlvbigpe1xuICB2YXIgdmlldyA9IHRoaXMubWFwLmdldFZpZXcoKTtcbiAgcmV0dXJuIHZpZXcuZ2V0Wm9vbSgpO1xufTtcblxuX1ZpZXdlci5wcm90b3R5cGUuZ2V0UmVzb2x1dGlvbiA9IGZ1bmN0aW9uKCl7XG4gIHZhciB2aWV3ID0gdGhpcy5tYXAuZ2V0VmlldygpO1xuICByZXR1cm4gdmlldy5nZXRSZXNvbHV0aW9uKCk7XG59O1xuXG5fVmlld2VyLnByb3RvdHlwZS5nZXRDZW50ZXIgPSBmdW5jdGlvbigpe1xuICB2YXIgdmlldyA9IHRoaXMubWFwLmdldFZpZXcoKTtcbiAgcmV0dXJuIHZpZXcuZ2V0Q2VudGVyKCk7XG59O1xuXG5fVmlld2VyLnByb3RvdHlwZS5nZXRCQk9YID0gZnVuY3Rpb24oKXtcbiAgcmV0dXJuIHRoaXMubWFwLmdldFZpZXcoKS5jYWxjdWxhdGVFeHRlbnQodGhpcy5tYXAuZ2V0U2l6ZSgpKTtcbn07XG5cbl9WaWV3ZXIucHJvdG90eXBlLmdldExheWVyQnlOYW1lID0gZnVuY3Rpb24obGF5ZXJOYW1lKSB7XG4gIHZhciBsYXllcnMgPSB0aGlzLm1hcC5nZXRMYXllcnMoKTtcbiAgdmFyIGxlbmd0aCA9IGxheWVycy5nZXRMZW5ndGgoKTtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgIGlmIChsYXllck5hbWUgPT09IGxheWVycy5pdGVtKGkpLmdldCgnbmFtZScpKSB7XG4gICAgICByZXR1cm4gbGF5ZXJzLml0ZW0oaSk7XG4gICAgfVxuICB9XG4gIHJldHVybiBudWxsO1xufTtcblxuX1ZpZXdlci5wcm90b3R5cGUucmVtb3ZlTGF5ZXJCeU5hbWUgPSBmdW5jdGlvbihsYXllck5hbWUpe1xuICB2YXIgbGF5ZXIgPSB0aGlzLmdldExheWVyQnlOYW1lKGxheWVyTmFtZSk7XG4gIGlmIChsYXllcil7XG4gICAgdGhpcy5tYXAucmVtb3ZlTGF5ZXIobGF5ZXIpO1xuICAgIGRlbGV0ZSBsYXllcjtcbiAgfVxufTtcblxuX1ZpZXdlci5wcm90b3R5cGUuZ2V0QWN0aXZlTGF5ZXJzID0gZnVuY3Rpb24oKXtcbiAgdmFyIGFjdGl2ZWxheWVycyA9IFtdO1xuICB0aGlzLm1hcC5nZXRMYXllcnMoKS5mb3JFYWNoKGZ1bmN0aW9uKGxheWVyKSB7XG4gICAgdmFyIHByb3BzID0gbGF5ZXIuZ2V0UHJvcGVydGllcygpO1xuICAgIGlmIChwcm9wcy5iYXNlbWFwICE9IHRydWUgJiYgcHJvcHMudmlzaWJsZSl7XG4gICAgICAgYWN0aXZlbGF5ZXJzLnB1c2gobGF5ZXIpO1xuICAgIH1cbiAgfSk7XG4gIFxuICByZXR1cm4gYWN0aXZlbGF5ZXJzO1xufTtcblxuX1ZpZXdlci5wcm90b3R5cGUucmVtb3ZlTGF5ZXJzID0gZnVuY3Rpb24oKXtcbiAgdGhpcy5tYXAuZ2V0TGF5ZXJzKCkuY2xlYXIoKTtcbn07XG5cbl9WaWV3ZXIucHJvdG90eXBlLmdldExheWVyc05vQmFzZSA9IGZ1bmN0aW9uKCl7XG4gIHZhciBsYXllcnMgPSBbXTtcbiAgdGhpcy5tYXAuZ2V0TGF5ZXJzKCkuZm9yRWFjaChmdW5jdGlvbihsYXllcikge1xuICAgIHZhciBwcm9wcyA9IGxheWVyLmdldFByb3BlcnRpZXMoKTtcbiAgICBpZiAocHJvcHMuYmFzZW1hcCAhPSB0cnVlKXtcbiAgICAgIGxheWVycy5wdXNoKGxheWVyKTtcbiAgICB9XG4gIH0pO1xuICBcbiAgcmV0dXJuIGxheWVycztcbn07XG5cbl9WaWV3ZXIucHJvdG90eXBlLmFkZEJhc2VMYXllciA9IGZ1bmN0aW9uKHR5cGUpe1xuICB2YXIgbGF5ZXI7XG4gIHR5cGUgPyBsYXllciA9IEJhc2VMYXllcnNbdHlwZV06ICBsYXllciA9IEJhc2VMYXllcnMuQklORy5BZXJpYWw7XG4gIHRoaXMubWFwLmFkZExheWVyKGxheWVyKTtcbn07XG5cbl9WaWV3ZXIucHJvdG90eXBlLmNoYW5nZUJhc2VMYXllciA9IGZ1bmN0aW9uKGxheWVyTmFtZSl7XG4gIHZhciBiYXNlTGF5ZXIgPSB0aGlzLmdldExheWVyQnlOYW1lKGxheWVybmFtZSk7XG4gIHZhciBsYXllcnMgPSB0aGlzLm1hcC5nZXRMYXllcnMoKTtcbiAgbGF5ZXJzLmluc2VydEF0KDAsIGJhc2VMYXllcik7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IE1hcEhlbHBlcnM7XG4iLCJ2YXIgdXRpbHMgPSB7XG4gIG1lcmdlOiBmdW5jdGlvbihvYmoxLG9iajIpe1xuICAgIHZhciBvYmozID0ge307XG4gICAgZm9yICh2YXIgYXR0cm5hbWUgaW4gb2JqMSkgeyBvYmozW2F0dHJuYW1lXSA9IG9iajFbYXR0cm5hbWVdOyB9XG4gICAgZm9yICh2YXIgYXR0cm5hbWUgaW4gb2JqMikgeyBvYmozW2F0dHJuYW1lXSA9IG9iajJbYXR0cm5hbWVdOyB9XG4gICAgcmV0dXJuIG9iajM7XG4gIH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSB1dGlscztcbiIsInZhciBpbmhlcml0ID0gcmVxdWlyZSgnLi91dGlscycpLmluaGVyaXQ7XG52YXIgYmFzZSA9IHJlcXVpcmUoJy4vdXRpbHMnKS5iYXNlO1xudmFyIEczV09iamVjdCA9IHJlcXVpcmUoJ2czdy9jb3JlL2czd29iamVjdCcpO1xudmFyIHJlamVjdGVkVmFsdWUgPSByZXF1aXJlKCcuL3V0aWxzJykucmVqZWN0ZWRWYWx1ZTtcblxuZnVuY3Rpb24gQXBpU2VydmljZSgpe1xuICB0aGlzLl9jb25maWcgPSBudWxsO1xuICB0aGlzLl9iYXNlVXJsID0gbnVsbDtcbiAgdGhpcy5fYXBpVXJscyA9IHt9O1xuICBcbiAgdGhpcy5pbml0ID0gZnVuY3Rpb24oY29uZmlnKSB7XG4gICAgdGhpcy5fY29uZmlnID0gY29uZmlnO1xuICAgIHRoaXMuX2Jhc2VVcmwgPSBjb25maWcudXJscy5hcGk7XG4gICAgdGhpcy5fYXBpRW5kcG9pbnRzID0gY29uZmlnLnVybHMuYXBpRW5kcG9pbnRzO1xuICB9O1xuICBcbiAgdGhpcy5nZXQgPSBmdW5jdGlvbihhcGksb3B0aW9ucykge1xuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICB2YXIgYXBpRW5kUG9pbnQgPSB0aGlzLl9hcGlFbmRwb2ludHNbYXBpXTtcbiAgICBpZiAoYXBpRW5kUG9pbnQpIHtcbiAgICAgIHZhciBjb21wbGV0ZVVybCA9IHRoaXMuX2Jhc2VVcmwgKyAnLycgKyBhcGlFbmRQb2ludDtcbiAgICAgIGlmIChvcHRpb25zLnJlcXVlc3QpIHtcbiAgICAgICAgIGNvbXBsZXRlVXJsID0rICcvJyArIHJlcXVlc3RcbiAgICAgIH1cbiAgICAgIHZhciBwYXJhbXMgPSBvcHRpb25zLnBhcmFtcyB8fCB7fTtcbiAgICAgIFxuICAgICAgc2VsZi5lbWl0KCdhcGlxdWVyeXN0YXJ0Jyk7XG4gICAgICBzZWxmLmVtaXQoYXBpKydxdWVyeXN0YXJ0Jyk7XG4gICAgICByZXR1cm4gJC5nZXQoY29tcGxldGVVcmwscGFyYW1zKVxuICAgICAgLmRvbmUoZnVuY3Rpb24ocmVzcG9uc2Upe1xuICAgICAgICBzZWxmLmVtaXQoJ2FwaXF1ZXJ5ZW5kJyxyZXNwb25zZSk7XG4gICAgICAgIHNlbGYuZW1pdChhcGkrJ3F1ZXJ5ZW5kJyxyZXNwb25zZSk7XG4gICAgICAgIHJldHVybiByZXNwb25zZTtcbiAgICAgIH0pXG4gICAgICAuZmFpbChmdW5jdGlvbihlKXtcbiAgICAgICAgc2VsZi5lbWl0KCdhcGlxdWVyeWZhaWwnLGUpO1xuICAgICAgICBzZWxmLmVtaXQoYXBpKydxdWVyeWZhaWwnLGUpO1xuICAgICAgICByZXR1cm4gZTtcbiAgICAgIH0pO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIHJldHVybiByZWplY3RlZFZhbHVlKCk7XG4gICAgfVxuICB9O1xuICBcbiAgYmFzZSh0aGlzKTtcbn1cbmluaGVyaXQoQXBpU2VydmljZSxHM1dPYmplY3QpO1xuXG5tb2R1bGUuZXhwb3J0cyA9IG5ldyBBcGlTZXJ2aWNlO1xuIiwidmFyIGluaGVyaXQgPSByZXF1aXJlKCdnM3cvY29yZS91dGlscycpLmluaGVyaXQ7XG52YXIgbm9vcCA9IHJlcXVpcmUoJ2czdy9jb3JlL3V0aWxzJykubm9vcDtcblxuLyoqXG4gKiBVbiBvZ2dldHRvIGJhc2UgaW4gZ3JhZG8gZGkgZ2VzdGlyZSBldmVudHVhbGkgc2V0dGVyIGUgcmVsYXRpdmEgY2F0ZW5hIGRpIGxpc3RlbmVycy5cbiAqIEBjb25zdHJ1Y3RvclxuICovXG52YXIgRzNXT2JqZWN0ID0gZnVuY3Rpb24oKXtcbiAgaWYgKHRoaXMuc2V0dGVycyl7XG4gICAgdGhpcy5fc2V0dXBMaXN0ZW5lcnNDaGFpbih0aGlzLnNldHRlcnMpO1xuICB9XG59O1xuaW5oZXJpdChHM1dPYmplY3QsRXZlbnRFbWl0dGVyKTtcblxudmFyIHByb3RvID0gRzNXT2JqZWN0LnByb3RvdHlwZTtcblxuLyoqXG4gKiBJbnNlcmlzY2UgdW4gbGlzdGVuZXIgZG9wbyBjaGUgw6ggc3RhdG8gZXNlZ3VpdG8gaWwgc2V0dGVyXG4gKiBAcGFyYW0ge3N0cmluZ30gc2V0dGVyIC0gSWwgbm9tZSBkZWwgbWV0b2RvIHN1IGN1aSBzaSBjdW9sZSByZWdpc3RyYXJlIHVuYSBmdW56aW9uZSBsaXN0ZW5lclxuICogQHBhcmFtIHtmdW5jdGlvbn0gbGlzdGVuZXIgLSBVbmEgZnVuemlvbmUgbGlzdGVuZXIgKHNvbG8gc2luY3JvbmEpXG4gKi9cbnByb3RvLm9uYWZ0ZXIgPSBmdW5jdGlvbihzZXR0ZXIsbGlzdGVuZXIpe1xuICByZXR1cm4gdGhpcy5fb25zZXR0ZXIoJ2FmdGVyJyxzZXR0ZXIsbGlzdGVuZXIsZmFsc2UpO1xufTtcblxuLy8gdW4gbGlzdGVuZXIgcHXDsiByZWdpc3RyYXJzaSBpbiBtb2RvIGRhIGVzc2VyZSBlc2VndWl0byBQUklNQSBkZWxsJ2VzZWN1emlvbmUgZGVsIG1ldG9kbyBzZXR0ZXIuIFB1w7Igcml0b3JuYXJlIHRydWUvZmFsc2UgcGVyXG4vLyB2b3RhcmUgYSBmYXZvcmUgbyBtZW5vIGRlbGwnZXNlY3V6aW9uZSBkZWwgc2V0dGVyLiBTZSBub24gcml0b3JuYSBudWxsYSBvIHVuZGVmaW5lZCwgbm9uIHZpZW5lIGNvbnNpZGVyYXRvIHZvdGFudGVcbi8qKlxuICogSW5zZXJpc2NlIHVuIGxpc3RlbmVyIHByaW1hIGNoZSB2ZW5nYSBlc2VndWl0byBpbCBzZXR0ZXIuIFNlIHJpdG9ybmEgZmFsc2UgaWwgc2V0dGVyIG5vbiB2aWVuZSBlc2VndWl0b1xuICogQHBhcmFtIHtzdHJpbmd9IHNldHRlciAtIElsIG5vbWUgZGVsIG1ldG9kbyBzdSBjdWkgc2kgY3VvbGUgcmVnaXN0cmFyZSB1bmEgZnVuemlvbmUgbGlzdGVuZXJcbiAqIEBwYXJhbSB7ZnVuY3Rpb259IGxpc3RlbmVyIC0gVW5hIGZ1bnppb25lIGxpc3RlbmVyLCBhIGN1aSB2aWVuZSBwYXNzYXRvIHVuYSBmdW56aW9uZSBcIm5leHRcIiBjb21lIHVsdGltbyBwYXJhbWV0cm8sIGRhIHVzYXJlIG5lbCBjYXNvIGRpIGxpc3RlbmVyIGFzaW5jcm9uaVxuICovXG5wcm90by5vbmJlZm9yZSA9IGZ1bmN0aW9uKHNldHRlcixsaXN0ZW5lcil7XG4gIHJldHVybiB0aGlzLl9vbnNldHRlcignYmVmb3JlJyxzZXR0ZXIsbGlzdGVuZXIsZmFsc2UpO1xufTtcblxuLyoqXG4gKiBJbnNlcmlzY2UgdW4gbGlzdGVuZXIgcHJpbWEgY2hlIHZlbmdhIGVzZWd1aXRvIGlsIHNldHRlci4gQWwgbGlzdGVuZXIgdmllbmUgcGFzc2F0byB1bmEgZnVuemlvbmUgXCJuZXh0XCIgY29tZSB1bHRpbW8gcGFyYW1ldHJvLCBkYSBjaGlhbWFyZSBjb24gcGFyYW1ldHJvIHRydWUvZmFsc2UgcGVyIGZhciBwcm9zZWd1aXJlIG8gbWVubyBpbCBzZXR0ZXJcbiAqIEBwYXJhbSB7c3RyaW5nfSBzZXR0ZXIgLSBJbCBub21lIGRlbCBtZXRvZG8gc3UgY3VpIHNpIGN1b2xlIHJlZ2lzdHJhcmUgdW5hIGZ1bnppb25lIGxpc3RlbmVyXG4gKiBAcGFyYW0ge2Z1bmN0aW9ufSBsaXN0ZW5lciAtIFVuYSBmdW56aW9uZSBsaXN0ZW5lciwgYSBjdWkgXG4gKi9cbnByb3RvLm9uYmVmb3JlYXN5bmMgPSBmdW5jdGlvbihzZXR0ZXIsbGlzdGVuZXIpe1xuICByZXR1cm4gdGhpcy5fb25zZXR0ZXIoJ2JlZm9yZScsc2V0dGVyLGxpc3RlbmVyLHRydWUpO1xufTtcblxucHJvdG8udW4gPSBmdW5jdGlvbihzZXR0ZXIsa2V5KXtcbiAgXy5mb3JFYWNoKHRoaXMuc2V0dGVyc0xpc3RlbmVycyxmdW5jdGlvbihzZXR0ZXJzTGlzdGVuZXJzLHdoZW4pe1xuICAgIF8uZm9yRWFjaChzZXR0ZXJzTGlzdGVuZXJzW3NldHRlcl0sZnVuY3Rpb24oc2V0dGVyTGlzdGVuZXIpe1xuICAgICAgaWYoc2V0dGVyTGlzdGVuZXIua2V5ID09IGtleSl7XG4gICAgICAgIGRlbGV0ZSBzZXR0ZXJMaXN0ZW5lcjtcbiAgICAgIH1cbiAgICB9KVxuICB9KVxufTtcblxucHJvdG8uX29uc2V0dGVyID0gZnVuY3Rpb24od2hlbixzZXR0ZXIsbGlzdGVuZXIsYXN5bmMpeyAvKndoZW49YmVmb3JlfGFmdGVyLCB0eXBlPXN5bmN8YXN5bmMqL1xuICB2YXIgc2V0dGVyc0xpc3RlbmVycyA9IHRoaXMuc2V0dGVyc0xpc3RlbmVyc1t3aGVuXTtcbiAgdmFyIGxpc3RlbmVyS2V5ID0gXCJcIitNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkqMTAwMDAwMCkrXCJcIitEYXRlLm5vdygpO1xuICAvKmlmICgod2hlbiA9PSAnYmVmb3JlJykgJiYgIWFzeW5jKXtcbiAgICBsaXN0ZW5lciA9IHRoaXMuX21ha2VDaGFpbmFibGUobGlzdGVuZXIpO1xuICB9Ki9cbiAgc2V0dGVyc0xpc3RlbmVyc1tzZXR0ZXJdLnB1c2goe1xuICAgIGtleTogbGlzdGVuZXJLZXksXG4gICAgZm5jOiBsaXN0ZW5lcixcbiAgICBhc3luYzogYXN5bmNcbiAgfSk7XG4gIHJldHVybiBsaXN0ZW5lcktleTtcbiAgLy9yZXR1cm4gdGhpcy5nZW5lcmF0ZVVuTGlzdGVuZXIoc2V0dGVyLGxpc3RlbmVyS2V5KTtcbn07XG5cbi8vIHRyYXNmb3JtbyB1biBsaXN0ZW5lciBzaW5jcm9ubyBpbiBtb2RvIGRhIHBvdGVyIGVzc2VyZSB1c2F0byBuZWxsYSBjYXRlbmEgZGkgbGlzdGVuZXJzIChyaWNoaWFtYW5kbyBuZXh0IGNvbCB2YWxvcmUgZGkgcml0b3JubyBkZWwgbGlzdGVuZXIpXG4vKnByb3RvLl9tYWtlQ2hhaW5hYmxlID0gZnVuY3Rpb24obGlzdGVuZXIpe1xuICB2YXIgc2VsZiA9IHRoaXNcbiAgcmV0dXJuIGZ1bmN0aW9uKCl7XG4gICAgdmFyIGFyZ3MgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMpO1xuICAgIC8vIHJpbXVvdm8gbmV4dCBkYWkgcGFyYW1ldHJpIHByaW1hIGRpIGNoaWFtYXJlIGlsIGxpc3RlbmVyXG4gICAgdmFyIG5leHQgPSBhcmdzLnBvcCgpO1xuICAgIHZhciBjYW5TZXQgPSBsaXN0ZW5lci5hcHBseShzZWxmLGFyZ3VtZW50cyk7XG4gICAgdmFyIF9jYW5TZXQgPSB0cnVlO1xuICAgIGlmIChfLmlzQm9vbGVhbihjYW5TZXQpKXtcbiAgICAgIF9jYW5TZXQgPSBjYW5TZXQ7XG4gICAgfVxuICAgIG5leHQoY2FuU2V0KTtcbiAgfVxufTsqL1xuXG5wcm90by5fc2V0dXBMaXN0ZW5lcnNDaGFpbiA9IGZ1bmN0aW9uKHNldHRlcnMpe1xuICAvLyBpbml6aWFsaXp6YSB0dXR0aSBpIG1ldG9kaSBkZWZpbml0aSBuZWxsJ29nZ2V0dG8gXCJzZXR0ZXJzXCIgZGVsbGEgY2xhc3NlIGZpZ2xpYS5cbiAgdmFyIHNlbGYgPSB0aGlzO1xuICB0aGlzLnNldHRlcnNMaXN0ZW5lcnMgPSB7XG4gICAgYWZ0ZXI6e30sXG4gICAgYmVmb3JlOnt9XG4gIH07XG4gIC8vIHBlciBvZ25pIHNldHRlciB2aWVuZSBkZWZpbml0byBsJ2FycmF5IGRlaSBsaXN0ZW5lcnMgZSBmaWVuZSBzb3N0aXR1aXRvIGlsIG1ldG9kbyBvcmlnaW5hbGUgY29uIGxhIGZ1bnppb25pIGNoZSBnZXN0aXNjZSBsYSBjb2RhIGRpIGxpc3RlbmVyc1xuICBfLmZvckVhY2goc2V0dGVycyxmdW5jdGlvbihzZXR0ZXJPcHRpb24sc2V0dGVyKXtcbiAgICB2YXIgc2V0dGVyRm5jID0gbm9vcDtcbiAgICB2YXIgc2V0dGVyRmFsbGJhY2sgPSBub29wO1xuICAgIGlmIChfLmlzRnVuY3Rpb24oc2V0dGVyT3B0aW9uKSl7XG4gICAgICBzZXR0ZXJGbmMgPSBzZXR0ZXJPcHRpb25cbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICBzZXR0ZXJGbmMgPSBzZXR0ZXJPcHRpb24uZm5jO1xuICAgICAgc2V0dGVyRmFsbGJhY2sgPSBzZXR0ZXJPcHRpb24uZmFsbGJhY2sgfHwgbm9vcDtcbiAgICB9XG4gICAgc2VsZi5zZXR0ZXJzTGlzdGVuZXJzLmFmdGVyW3NldHRlcl0gPSBbXTtcbiAgICBzZWxmLnNldHRlcnNMaXN0ZW5lcnMuYmVmb3JlW3NldHRlcl0gPSBbXTtcbiAgICAvLyBzZXR0ZXIgc29zdGl0dWl0b1xuICAgIHNlbGZbc2V0dGVyXSA9IGZ1bmN0aW9uKCl7XG4gICAgICB2YXIgYXJncyA9IGFyZ3VtZW50cztcbiAgICAgIC8vIGVzZWd1byBpIGxpc3RlbmVyIHJlZ2lzdHJhdGkgcGVyIGlsIGJlZm9yZVxuICAgICAgdmFyIGRlZmVycmVkID0gJC5EZWZlcnJlZCgpO1xuICAgICAgdmFyIHJldHVyblZhbCA9IG51bGw7XG4gICAgICB2YXIgY291bnRlciA9IDA7XG4gICAgICB2YXIgY2FuU2V0ID0gdHJ1ZTtcbiAgICAgIFxuICAgICAgLy8gcmljaGlhbWF0YSBhbGxhIGZpbmUgZGVsbGEgY2F0ZW5hIGRpIGxpc3RlbmVyc1xuICAgICAgZnVuY3Rpb24gZG9uZSgpe1xuICAgICAgICBpZihjYW5TZXQpe1xuICAgICAgICAgIC8vIGVzZWd1byBsYSBmdW56aW9uZVxuICAgICAgICAgIHJldHVyblZhbCA9IHNldHRlckZuYy5hcHBseShzZWxmLGFyZ3MpO1xuICAgICAgICAgIC8vIGUgcmlzb2x2byBsYSBwcm9tZXNzYSAoZXZlbnR1YWxtZW50ZSB1dGlsaXp6YXRhIGRhIGNoaSBoYSBpbnZvY2F0byBpbCBzZXR0ZXJcbiAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJldHVyblZhbCk7XG4gICAgICAgICAgXG4gICAgICAgICAgdmFyIGFmdGVyTGlzdGVuZXJzID0gc2VsZi5zZXR0ZXJzTGlzdGVuZXJzLmFmdGVyW3NldHRlcl07XG4gICAgICAgICAgXy5mb3JFYWNoKGFmdGVyTGlzdGVuZXJzLGZ1bmN0aW9uKGxpc3RlbmVyLCBrZXkpe1xuICAgICAgICAgICAgbGlzdGVuZXIuZm5jLmFwcGx5KHNlbGYsYXJncyk7XG4gICAgICAgICAgfSlcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAvLyBzZSBub24gcG9zc28gcHJvc2VndWlyZSBcbiAgICAgICAgICAvLyBjaGlhbW8gbCdldmVudHVhbGUgZnVuemlvbmUgZGkgZmFsbGJhY2tcbiAgICAgICAgICBzZXR0ZXJGYWxsYmFjay5hcHBseShzZWxmLGFyZ3MpO1xuICAgICAgICAgIC8vIGUgcmlnZXR0byBsYSBwcm9tZXNzYVxuICAgICAgICAgIGRlZmVycmVkLnJlamVjdCgpO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgXG4gICAgICBmdW5jdGlvbiBjb21wbGV0ZSgpe1xuICAgICAgICAvLyBlc2VndW8gbGEgZnVuemlvbmVcbiAgICAgICAgcmV0dXJuVmFsID0gc2V0dGVyRm5jLmFwcGx5KHNlbGYsYXJncyk7XG4gICAgICAgIC8vIGUgcmlzb2x2byBsYSBwcm9tZXNzYSAoZXZlbnR1YWxtZW50ZSB1dGlsaXp6YXRhIGRhIGNoaSBoYSBpbnZvY2F0byBpbCBzZXR0ZXJcbiAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXR1cm5WYWwpO1xuICAgICAgICBcbiAgICAgICAgdmFyIGFmdGVyTGlzdGVuZXJzID0gc2VsZi5zZXR0ZXJzTGlzdGVuZXJzLmFmdGVyW3NldHRlcl07XG4gICAgICAgIF8uZm9yRWFjaChhZnRlckxpc3RlbmVycyxmdW5jdGlvbihsaXN0ZW5lciwga2V5KXtcbiAgICAgICAgICBsaXN0ZW5lci5mbmMuYXBwbHkoc2VsZixhcmdzKTtcbiAgICAgICAgfSlcbiAgICAgIH1cbiAgICAgIFxuICAgICAgZnVuY3Rpb24gYWJvcnQoKXtcbiAgICAgICAgICAvLyBzZSBub24gcG9zc28gcHJvc2VndWlyZSAuLi5cbiAgICAgICAgICAvLyBjaGlhbW8gbCdldmVudHVhbGUgZnVuemlvbmUgZGkgZmFsbGJhY2tcbiAgICAgICAgICBzZXR0ZXJGYWxsYmFjay5hcHBseShzZWxmLGFyZ3MpO1xuICAgICAgICAgIC8vIGUgcmlnZXR0byBsYSBwcm9tZXNzYVxuICAgICAgICAgIGRlZmVycmVkLnJlamVjdCgpO1xuICAgICAgfVxuICAgICAgXG4gICAgICB2YXIgYmVmb3JlTGlzdGVuZXJzID0gdGhpcy5zZXR0ZXJzTGlzdGVuZXJzWydiZWZvcmUnXVtzZXR0ZXJdO1xuICAgICAgLy8gY29udGF0b3JlIGRlaSBsaXN0ZW5lciBjaGUgdmVycsOgIGRlY3JlbWVudGF0byBhZCBvZ25pIGNoaWFtYXRhIGEgbmV4dCgpXG4gICAgICBjb3VudGVyID0gMDtcbiAgICAgIFxuICAgICAgLy8gZnVuemlvbmUgcGFzc2F0YSBjb21lIHVsdGltbyBwYXJhbWV0cm8gYWkgbGlzdGVuZXJzLCBjaGUgKioqU0UgU09OTyBTVEFUSSBBR0dJVU5USSBDT01FIEFTSU5DUk9OSSBsYSBERVZPTk8qKiogcmljaGlhbWFyZSBwZXIgcG90ZXIgcHJvc2VndWlyZSBsYSBjYXRlbmFcbiAgICAgIGZ1bmN0aW9uIG5leHQoYm9vbCl7XG4gICAgICAgIHZhciBjb250ID0gdHJ1ZTtcbiAgICAgICAgaWYgKF8uaXNCb29sZWFuKGJvb2wpKXtcbiAgICAgICAgICBjb250ID0gYm9vbDtcbiAgICAgICAgfVxuICAgICAgICB2YXIgX2FyZ3MgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmdzKTtcbiAgICAgICAgLy8gc2UgbGEgY2F0ZW5hIMOoIHN0YXRhIGJsb2NjYXRhIG8gc2Ugc2lhbW8gYXJyaXZhdGkgYWxsYSBmaW5lIGRlaSBiZWZvcmVsaXN0ZW5lcnNcbiAgICAgICAgaWYgKGNvbnQgPT09IGZhbHNlIHx8IChjb3VudGVyID09IGJlZm9yZUxpc3RlbmVycy5sZW5ndGgpKXtcbiAgICAgICAgICBpZihjb250ID09PSBmYWxzZSlcbiAgICAgICAgICAgIGFib3J0LmFwcGx5KHNlbGYsYXJncyk7XG4gICAgICAgICAgZWxzZXtcbiAgICAgICAgICAgIGNvbXBsZXRlZCA9IGNvbXBsZXRlLmFwcGx5KHNlbGYsYXJncyk7XG4gICAgICAgICAgICBpZihfLmlzVW5kZWZpbmVkKGNvbXBsZXRlZCkgfHwgY29tcGxldGVkID09PSB0cnVlKXtcbiAgICAgICAgICAgICAgc2VsZi5lbWl0RXZlbnQoJ3NldDonK3NldHRlcixhcmdzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgaWYgKGNvbnQpe1xuICAgICAgICAgICAgdmFyIGxpc3RlbmVyRm5jID0gYmVmb3JlTGlzdGVuZXJzW2NvdW50ZXJdLmZuYztcbiAgICAgICAgICAgIGlmIChiZWZvcmVMaXN0ZW5lcnNbY291bnRlcl0uYXN5bmMpe1xuICAgICAgICAgICAgICAvLyBhZ2dpdW5nbyBuZXh0IGNvbWUgdWxpdG1vIHBhcmFtZXRyb1xuICAgICAgICAgICAgICBfYXJncy5wdXNoKG5leHQpO1xuICAgICAgICAgICAgICBjb3VudGVyICs9IDE7XG4gICAgICAgICAgICAgIGxpc3RlbmVyRm5jLmFwcGx5KHNlbGYsX2FyZ3MpXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgdmFyIF9jb250ID0gbGlzdGVuZXJGbmMuYXBwbHkoc2VsZixfYXJncyk7XG4gICAgICAgICAgICAgIGNvdW50ZXIgKz0gMTtcbiAgICAgICAgICAgICAgbmV4dChfY29udCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICBcbiAgICAgIG5leHQoKTtcbiAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlKCk7XG4gICAgfVxuICB9KVxufTtcblxuLypcbnByb3RvLmdlbmVyYXRlVW5MaXN0ZW5lciA9IGZ1bmN0aW9uKHNldHRlcnNMaXN0ZW5lcnMsc2V0dGVyLGxpc3RlbmVyS2V5KXtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICByZXR1cm4gZnVuY3Rpb24oKXtcbiAgICBzZXR0ZXJzTGlzdGVuZXJzW3NldHRlcl1bbGlzdGVuZXJLZXldID0gbnVsbDtcbiAgICBkZWxldGUgc2V0dGVyc0xpc3RlbmVyc1tzZXR0ZXJdW2xpc3RlbmVyS2V5XTtcbiAgfVxufTtcbiovXG5cbm1vZHVsZS5leHBvcnRzID0gRzNXT2JqZWN0O1xuIiwidmFyIGluaGVyaXQgPSByZXF1aXJlKCdnM3cvY29yZS91dGlscycpLmluaGVyaXQ7XG52YXIgYmFzZSA9IHJlcXVpcmUoJ2czdy9jb3JlL3V0aWxzJykuYmFzZTtcbnZhciBHM1dPYmplY3QgPSByZXF1aXJlKCdnM3cvY29yZS9nM3dvYmplY3QnKTtcbnZhciBQcm9qZWN0U2VydmljZSA9IHJlcXVpcmUoJ2czdy9jb3JlL3Byb2plY3RzZXJ2aWNlJykuUHJvamVjdFNlcnZpY2U7XG52YXIgTWFwU2VydmljZSA9IHJlcXVpcmUoJ2czdy9jb3JlL21hcHNlcnZpY2UnKTtcblxuZnVuY3Rpb24gTm9taW5hdGltKCl7XG4gIHZhciBzZWxmID0gdGhpcztcbiAgdGhpcy51cmwgPSBcImh0dHA6Ly9ub21pbmF0aW0ub3BlbnN0cmVldG1hcC5vcmdcIjtcbiAgXG4gIHRoaXMuc2VhcmNoID0gZnVuY3Rpb24ocXVlcnkpe1xuICAgIHZhciBkZWZlcnJlZCA9ICQuRGVmZXJyZWQoKTtcbiAgICB2YXIgZXh0ZW50ID0gTWFwU2VydmljZS5leHRlbnRUb1dHUzg0KFByb2plY3RTZXJ2aWNlLnN0YXRlLnByb2plY3QuZXh0ZW50KTtcbiAgICBiYm94c3RyaW5nID0gXy5qb2luKGV4dGVudCwnLCcpO1xuICAgIHZhciBzZWFyY2hVcmwgPSB0aGlzLnVybCtcIi9zZWFyY2g/dmlld2JveGxicnQ9XCIrYmJveHN0cmluZytcIiZib3VuZGVkPTEmZm9ybWF0PWpzb24mcG9seWdvbl9nZW9qc29uPTEmcT1cIitxdWVyeTtcbiAgICAkLmdldChzZWFyY2hVcmwsZnVuY3Rpb24ocmVzdWx0KXtcbiAgICAgIHNlbGYuZW1pdChcInJlc3VsdHNcIixyZXN1bHQscXVlcnkpO1xuICAgIH0pO1xuICB9O1xuICBcbiAgYmFzZSh0aGlzKTtcbn1cbmluaGVyaXQoTm9taW5hdGltLEczV09iamVjdCk7XG5cbm1vZHVsZS5leHBvcnRzID0ge1xuICBOb21pbmF0aW06IG5ldyBOb21pbmF0aW1cbn07XG4iLCJ2YXIgZ2VvbSA9IHtcbiAgZGlzdGFuY2U6IGZ1bmN0aW9uKGMxLGMyKXtcbiAgICByZXR1cm4gTWF0aC5zcXJ0KGdlb20uc3F1YXJlZERpc3RhbmNlKGMxLGMyKSk7XG4gIH0sXG4gIHNxdWFyZWREaXN0YW5jZTogZnVuY3Rpb24oYzEsYzIpe1xuICAgIHZhciB4MSA9IGMxWzBdO1xuICAgIHZhciB5MSA9IGMxWzFdO1xuICAgIHZhciB4MiA9IGMyWzBdO1xuICAgIHZhciB5MiA9IGMyWzFdO1xuICAgIHZhciBkeCA9IHgyIC0geDE7XG4gICAgdmFyIGR5ID0geTIgLSB5MTtcbiAgICByZXR1cm4gZHggKiBkeCArIGR5ICogZHk7XG4gIH0sXG4gIGNsb3Nlc3RPblNlZ21lbnQ6IGZ1bmN0aW9uKGNvb3JkaW5hdGUsIHNlZ21lbnQpIHtcbiAgICB2YXIgeDAgPSBjb29yZGluYXRlWzBdO1xuICAgIHZhciB5MCA9IGNvb3JkaW5hdGVbMV07XG4gICAgdmFyIHN0YXJ0ID0gc2VnbWVudFswXTtcbiAgICB2YXIgZW5kID0gc2VnbWVudFsxXTtcbiAgICB2YXIgeDEgPSBzdGFydFswXTtcbiAgICB2YXIgeTEgPSBzdGFydFsxXTtcbiAgICB2YXIgeDIgPSBlbmRbMF07XG4gICAgdmFyIHkyID0gZW5kWzFdO1xuICAgIHZhciBkeCA9IHgyIC0geDE7XG4gICAgdmFyIGR5ID0geTIgLSB5MTtcbiAgICB2YXIgYWxvbmcgPSAoZHggPT09IDAgJiYgZHkgPT09IDApID8gMCA6XG4gICAgICAgICgoZHggKiAoeDAgLSB4MSkpICsgKGR5ICogKHkwIC0geTEpKSkgLyAoKGR4ICogZHggKyBkeSAqIGR5KSB8fCAwKTtcbiAgICB2YXIgeCwgeTtcbiAgICBpZiAoYWxvbmcgPD0gMCkge1xuICAgICAgeCA9IHgxO1xuICAgICAgeSA9IHkxO1xuICAgIH0gZWxzZSBpZiAoYWxvbmcgPj0gMSkge1xuICAgICAgeCA9IHgyO1xuICAgICAgeSA9IHkyO1xuICAgIH0gZWxzZSB7XG4gICAgICB4ID0geDEgKyBhbG9uZyAqIGR4O1xuICAgICAgeSA9IHkxICsgYWxvbmcgKiBkeTtcbiAgICB9XG4gICAgcmV0dXJuIFt4LCB5XTtcbiAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IGdlb207XG4iLCJ2YXIgaW5oZXJpdCA9IHJlcXVpcmUoJy4vdXRpbHMnKS5pbmhlcml0O1xudmFyIGJhc2UgPSByZXF1aXJlKCcuL3V0aWxzJykuYmFzZTtcbnZhciBHM1dPYmplY3QgPSByZXF1aXJlKCdnM3cvY29yZS9nM3dvYmplY3QnKTtcblxudmFyIENBUEFCSUxJVElFUyA9IHtcbiAgUVVFUlk6IDEsXG4gIEVESVQ6IDJcbn07XG5cbnZhciBFRElUT1BTID0ge1xuICBJTlNFUlQ6IDEsXG4gIFVQREFURTogMixcbiAgREVMRVRFOiA0XG59O1xuXG5mdW5jdGlvbiBMYXllcihjb25maWcpe1xuICB0aGlzLmNvbmZpZyA9IGNvbmZpZyB8fCB7fTtcbiAgdGhpcy5pZCA9IGNvbmZpZy5pZDtcbiAgYmFzZSh0aGlzKTtcbn1cbmluaGVyaXQoTGF5ZXIsRzNXT2JqZWN0KTtcblxudmFyIHByb3RvID0gTGF5ZXIucHJvdG90eXBlO1xuXG5wcm90by5nZXRRdWVyeVVybCA9IGZ1bmN0aW9uKCl7XG4gIC8vXG59O1xuXG5wcm90by5nZXRRdWVyeUxheWVycyA9IGZ1bmN0aW9uKCl7XG4gLy9cbn07XG5cbkxheWVyLmlzUXVlcnlhYmxlID0gZnVuY3Rpb24obGF5ZXJTdGF0ZSl7XG4gIHZhciBxdWVyeUVuYWJsZWQgPSBmYWxzZTtcbiAgdmFyIHF1ZXJ5YWJsZUZvckNhYmFiaWxpdGllcyA9IChsYXllclN0YXRlLmNhcGFiaWxpdGllcyAmJiAobGF5ZXJTdGF0ZS5jYXBhYmlsaXRpZXMgJiYgQ0FQQUJJTElUSUVTLlFVRVJZKSkgPyB0cnVlIDogZmFsc2U7XG4gIGlmIChxdWVyeWFibGVGb3JDYWJhYmlsaXRpZXMpIHtcbiAgICAvLyDDqCBpbnRlcnJvZ2FiaWxlIHNlIHZpc2liaWxlIGUgbm9uIGRpc2FiaWxpdGF0byAocGVyIHNjYWxhKSBvcHB1cmUgc2UgaW50ZXJyb2dhYmlsZSBjb211bnF1ZSAoZm9yemF0byBkYWxsYSBwcm9wcmlldMOgIGluZm93aGVubm90dmlzaWJsZSlcbiAgICB2YXIgcXVlcnlFbmFibGVkID0gKGxheWVyU3RhdGUudmlzaWJsZSAmJiAhbGF5ZXJTdGF0ZS5kaXNhYmxlZCkgfHwgKGxheWVyU3RhdGUuaW5mb3doZW5ub3R2aXNpYmxlICYmIChsYXllclN0YXRlLmluZm93aGVubm90dmlzaWJsZSA9PT0gdHJ1ZSkpO1xuICB9XG4gIHJldHVybiBxdWVyeUVuYWJsZWQ7XG59O1xuXG5MYXllci5nZXRRdWVyeUxheWVyTmFtZSA9IGZ1bmN0aW9uKGxheWVyU3RhdGUpIHtcbiAgdmFyIHF1ZXJ5TGF5ZXJOYW1lO1xuICBpZiAobGF5ZXJTdGF0ZS5pbmZvbGF5ZXIgJiYgbGF5ZXJTdGF0ZS5pbmZvbGF5ZXIgIT0gJycpIHtcbiAgICBxdWVyeUxheWVyTmFtZSA9IGxheWVyU3RhdGUuaW5mb2xheWVyO1xuICB9XG4gIGVsc2Uge1xuICAgIHF1ZXJ5TGF5ZXJOYW1lID0gbGF5ZXJTdGF0ZS5uYW1lO1xuICB9XG4gIHJldHVybiBxdWVyeUxheWVyTmFtZTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gTGF5ZXI7XG4iLCJ2YXIgaW5oZXJpdCA9IHJlcXVpcmUoJy4vdXRpbHMnKS5pbmhlcml0O1xudmFyIGJhc2UgPSByZXF1aXJlKCcuL3V0aWxzJykuYmFzZTtcbnZhciBHM1dPYmplY3QgPSByZXF1aXJlKCcuL2czd29iamVjdCcpO1xudmFyIEdVSSA9IHJlcXVpcmUoJy4uL2d1aS9ndWknKTtcbnZhciBQcm9qZWN0U2VydmljZSA9IHJlcXVpcmUoJy4vcHJvamVjdHNlcnZpY2UnKS5Qcm9qZWN0U2VydmljZTtcblxudmFyIExheWVyID0gcmVxdWlyZSgnLi9sYXllcicpO1xuXG5mdW5jdGlvbiBNYXBRdWVyeVNlcnZpY2UoKSB7XG4gIGJhc2UodGhpcyk7XG4gIFxuICB0aGlzLmluaXQgPSBmdW5jdGlvbihtYXApe1xuICAgIHRoaXMubWFwID0gbWFwO1xuICB9XG4gIFxuICB0aGlzLnF1ZXJ5UG9pbnQgPSBmdW5jdGlvbihjb29yZGluYXRlcyxtYXBMYXllcnMpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgdmFyIGQgPSAkLkRlZmVycmVkKCk7XG4gICAgdmFyIHVybHNGb3JMYXllcnMgPSB7fTtcbiAgICBfLmZvckVhY2gobWFwTGF5ZXJzLGZ1bmN0aW9uKG1hcExheWVyKXtcbiAgICAgIHZhciB1cmwgPSBtYXBMYXllci5nZXRRdWVyeVVybCgpO1xuICAgICAgdmFyIHVybEhhc2ggPSB1cmwuaGFzaENvZGUoKS50b1N0cmluZygpO1xuICAgICAgaWYgKF8ua2V5cyh1cmxzRm9yTGF5ZXJzKS5pbmRleE9mKHVybEhhc2gpID09IC0xKSB7XG4gICAgICAgIHVybHNGb3JMYXllcnNbdXJsSGFzaF0gPSB7XG4gICAgICAgICAgdXJsOiB1cmwsXG4gICAgICAgICAgbWFwTGF5ZXJzOiBbXVxuICAgICAgICB9O1xuICAgICAgfVxuICAgICAgdXJsc0ZvckxheWVyc1t1cmxIYXNoXS5tYXBMYXllcnMucHVzaChtYXBMYXllcik7XG4gICAgfSlcbiAgICBcbiAgICB2YXIgcXVlcnlVcmxzRm9yTGF5ZXJzID0gW107XG4gICAgXy5mb3JFYWNoKHVybHNGb3JMYXllcnMsZnVuY3Rpb24odXJsRm9yTGF5ZXJzKXtcbiAgICAgIHZhciBmaXJzdExheWVyID0gdXJsRm9yTGF5ZXJzLm1hcExheWVyc1swXTtcbiAgICAgIHZhciBfZ2V0RmVhdHVyZUluZm9VcmwgPSBzZWxmLmdldEdldEZlYXR1cmVJbmZvVXJsKGZpcnN0TGF5ZXIsY29vcmRpbmF0ZXMpO1xuICAgICAgdmFyIHF1ZXJ5QmFzZSA9IF9nZXRGZWF0dXJlSW5mb1VybC5zcGxpdCgnPycpWzBdO1xuICAgICAgdmFyIHF1ZXJ5U3RyaW5nID0gX2dldEZlYXR1cmVJbmZvVXJsLnNwbGl0KCc/JylbMV07XG4gICAgICB2YXIgcXVlcnlQYXJhbXMgPSB7fTtcbiAgICAgIF8uZm9yRWFjaChxdWVyeVN0cmluZy5zcGxpdCgnJicpLGZ1bmN0aW9uKHF1ZXJ5U3RyaW5nUGFpcil7XG4gICAgICAgIHZhciBxdWVyeVBhaXIgPSBxdWVyeVN0cmluZ1BhaXIuc3BsaXQoJz0nKTtcbiAgICAgICAgdmFyIGtleSA9IHF1ZXJ5UGFpclswXTtcbiAgICAgICAgdmFyIHZhbHVlID0gcXVlcnlQYWlyWzFdO1xuICAgICAgICBxdWVyeVBhcmFtc1trZXldID0gdmFsdWU7XG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgdmFyIGxheWVyTmFtZXMgPSBbXTtcbiAgICAgIHZhciBxdWVyeUxheWVycyA9IFtdO1xuICAgICAgXy5mb3JFYWNoKHVybEZvckxheWVycy5tYXBMYXllcnMsZnVuY3Rpb24obWFwTGF5ZXIpe1xuICAgICAgICAvL3ZhciBtYXBMYXllckxheWVyc05hbWVzID0gbWFwTGF5ZXIuZ2V0TGF5ZXIoKS5nZXRTb3VyY2UoKS5nZXRQYXJhbXMoKVsnTEFZRVJTJ107XG4gICAgICAgIC8vbGF5ZXJOYW1lcyA9IF8uY29uY2F0KGxheWVyTmFtZXMsbWFwTGF5ZXJMYXllcnNOYW1lcyk7XG4gICAgICAgIHZhciBtYXBMYXllclF1ZXJ5TGF5ZXJzID0gbWFwTGF5ZXIuZ2V0UXVlcnlMYXllcnMoKTtcbiAgICAgICAgXG4gICAgICAgIGlmIChtYXBMYXllclF1ZXJ5TGF5ZXJzLmxlbmd0aCkge1xuICAgICAgICAgIHF1ZXJ5TGF5ZXJzID0gXy5jb25jYXQocXVlcnlMYXllcnMsbWFwTGF5ZXJRdWVyeUxheWVycyk7XG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgICBcbiAgICAgIGlmIChxdWVyeUxheWVycy5sZW5ndGgpIHtcbiAgICAgICAgZGVsZXRlIHF1ZXJ5UGFyYW1zWydTVFlMRVMnXTtcbiAgICAgIFxuICAgICAgICBxdWVyeVBhcmFtc1snTEFZRVJTJ10gPSBfLm1hcChxdWVyeUxheWVycywncXVlcnlMYXllck5hbWUnKTtcbiAgICAgICAgcXVlcnlQYXJhbXNbJ1FVRVJZX0xBWUVSUyddID0gXy5tYXAocXVlcnlMYXllcnMsJ3F1ZXJ5TGF5ZXJOYW1lJyk7XG4gICAgICAgIHF1ZXJ5UGFyYW1zWydGRUFUVVJFX0NPVU5UJ10gPSAxMDAwO1xuICAgICAgICBcbiAgICAgICAgdmFyIGdldEZlYXR1cmVJbmZvVXJsID0gcXVlcnlCYXNlO1xuICAgICAgICB2YXIgbmV3UXVlcnlQYWlycyA9IFtdO1xuICAgICAgICBfLmZvckVhY2gocXVlcnlQYXJhbXMsZnVuY3Rpb24odmFsdWUsa2V5KXtcbiAgICAgICAgICBuZXdRdWVyeVBhaXJzLnB1c2goa2V5Kyc9Jyt2YWx1ZSk7XG4gICAgICAgIH0pO1xuICAgICAgICBnZXRGZWF0dXJlSW5mb1VybCA9IHF1ZXJ5QmFzZSsnPycrbmV3UXVlcnlQYWlycy5qb2luKCcmJylcbiAgICAgICAgXG4gICAgICAgIHF1ZXJ5VXJsc0ZvckxheWVycy5wdXNoKHtcbiAgICAgICAgICB1cmw6IGdldEZlYXR1cmVJbmZvVXJsLFxuICAgICAgICAgIHF1ZXJ5TGF5ZXJzOiBxdWVyeUxheWVyc1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9KVxuICAgIFxuICAgIHZhciBmZWF0dXJlc0ZvckxheWVyTmFtZXMgPSB7fTtcbiAgICBpZiAocXVlcnlVcmxzRm9yTGF5ZXJzLmxlbmd0aCA+IDApIHtcbiAgICAgIF8uZm9yRWFjaChxdWVyeVVybHNGb3JMYXllcnMsZnVuY3Rpb24ocXVlcnlVcmxGb3JMYXllcnMpe1xuICAgICAgICB2YXIgdXJsID0gcXVlcnlVcmxGb3JMYXllcnMudXJsO1xuICAgICAgICB2YXIgcXVlcnlMYXllcnMgPSBxdWVyeVVybEZvckxheWVycy5xdWVyeUxheWVycztcblxuICAgICAgICAkLmdldCh1cmwpLlxuICAgICAgICB0aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKXtcbiAgICAgICAgICB2YXIgbmZlYXR1cmVzID0gMFxuICAgICAgICAgIF8uZm9yRWFjaChxdWVyeUxheWVycyxmdW5jdGlvbihxdWVyeUxheWVyKXtcbiAgICAgICAgICAgIHZhciBwYXJzZXIgPSBuZXcgb2wuZm9ybWF0LldNU0dldEZlYXR1cmVJbmZvKHtcbiAgICAgICAgICAgICAgbGF5ZXJzOiBbcXVlcnlMYXllci5xdWVyeUxheWVyTmFtZV1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdmFyIGZlYXR1cmVzID0gcGFyc2VyLnJlYWRGZWF0dXJlcyhyZXNwb25zZSk7XG4gICAgICAgICAgICBuZmVhdHVyZXMgKz0gZmVhdHVyZXMubGVuZ3RoO1xuICAgICAgICAgICAgZmVhdHVyZXNGb3JMYXllck5hbWVzW3F1ZXJ5TGF5ZXIubGF5ZXJOYW1lXSA9IGZlYXR1cmVzO1xuICAgICAgICAgIH0pXG4gICAgICAgICAgZC5yZXNvbHZlKGNvb3JkaW5hdGVzLG5mZWF0dXJlcyxmZWF0dXJlc0ZvckxheWVyTmFtZXMpO1xuICAgICAgICB9KVxuICAgICAgICAuZmFpbChmdW5jdGlvbihlKXtcbiAgICAgICAgICBkLnJlamVjdChlKTtcbiAgICAgICAgfSlcbiAgICAgIH0pO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIGQucmVzb2x2ZShjb29yZGluYXRlcywwLGZlYXR1cmVzRm9yTGF5ZXJOYW1lcyk7XG4gICAgfVxuICAgIFxuICAgIHJldHVybiBkLnByb21pc2UoKTtcbiAgfTtcbiAgXG4gIHRoaXMucXVlcnlSZWN0ID0gZnVuY3Rpb24ocmVjdCxsYXllcklkKSB7XG4gICAgXG4gIH07XG4gIFxuICB0aGlzLl9xdWVyeSA9IGZ1bmN0aW9uKHJlY3QsbGF5ZXJJZCkge1xuICAgIHZhciBsYXllcnM7XG4gICAgaWYgKGxheWVySWQpIHtcbiAgICAgIGxheWVycyA9IFtQcm9qZWN0U2VydmljZS5nZXRMYXllcihsYXllcklkKV07XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgbGF5ZXJzID0gUHJvamVjdFNlcnZpY2UuZ2V0TGF5ZXJzKCk7XG4gICAgfVxuICB9O1xuICBcbiAgdGhpcy5nZXRHZXRGZWF0dXJlSW5mb1VybCA9IGZ1bmN0aW9uKG1hcExheWVyLGNvb3JkaW5hdGUpe1xuICAgIC8vdmFyIHBhcnNlciA9IG5ldyBvbC5mb3JtYXQuV01TR2V0RmVhdHVyZUluZm8oKTtcbiAgICB2YXIgcmVzb2x1dGlvbiA9IHRoaXMubWFwLmdldFZpZXcoKS5nZXRSZXNvbHV0aW9uKCk7XG4gICAgdmFyIGVwc2cgPSB0aGlzLm1hcC5nZXRWaWV3KCkuZ2V0UHJvamVjdGlvbigpLmdldENvZGUoKTtcbiAgICB2YXIgcGFyYW1zID0ge1xuICAgICAgUVVFUllfTEFZRVJTOiBtYXBMYXllci5nZXRMYXllcigpLmdldFNvdXJjZSgpLmdldFBhcmFtcygpWydMQVlFUlMnXSxcbiAgICAgIElORk9fRk9STUFUOiAnYXBwbGljYXRpb24vdm5kLm9nYy5nbWwnXG4gICAgfVxuICAgIHZhciB1cmwgPSBtYXBMYXllci5nZXRMYXllcigpLmdldFNvdXJjZSgpLmdldEdldEZlYXR1cmVJbmZvVXJsKGNvb3JkaW5hdGUscmVzb2x1dGlvbixlcHNnLHBhcmFtcyk7XG4gICAgcmV0dXJuIHVybDtcbiAgfTtcbn1cbmluaGVyaXQoTWFwUXVlcnlTZXJ2aWNlLEczV09iamVjdCk7XG5cbm1vZHVsZS5leHBvcnRzID0gbmV3IE1hcFF1ZXJ5U2VydmljZTtcbiIsInZhciBpbmhlcml0ID0gcmVxdWlyZSgnLi91dGlscycpLmluaGVyaXQ7XG52YXIgYmFzZSA9IHJlcXVpcmUoJy4vdXRpbHMnKS5iYXNlO1xudmFyIEczV09iamVjdCA9IHJlcXVpcmUoJ2czdy9jb3JlL2czd29iamVjdCcpO1xudmFyIEdVSSA9IHJlcXVpcmUoJ2czdy9ndWkvZ3VpJyk7XG52YXIgUHJvamVjdHNSZWdpc3RyeSA9IHJlcXVpcmUoJy4vcHJvamVjdHNyZWdpc3RyeScpO1xudmFyIFByb2plY3RTZXJ2aWNlID0gcmVxdWlyZSgnLi9wcm9qZWN0c2VydmljZScpLlByb2plY3RTZXJ2aWNlO1xudmFyIFByb2plY3RUeXBlcyA9IHJlcXVpcmUoJy4vcHJvamVjdHNlcnZpY2UnKS5Qcm9qZWN0VHlwZXM7XG52YXIgR2VvbWV0cnlUeXBlcyA9IHJlcXVpcmUoJy4vcHJvamVjdHNlcnZpY2UnKS5HZW9tZXRyeVR5cGVzO1xudmFyIG9sM2hlbHBlcnMgPSByZXF1aXJlKCdnM3ctb2wzL3NyYy9nM3cub2wzJykuaGVscGVycztcbnZhciBSZXNldENvbnRyb2wgPSByZXF1aXJlKCdnM3ctb2wzL3NyYy9jb250cm9scy9yZXNldGNvbnRyb2wnKTtcbnZhciBRdWVyeUNvbnRyb2wgPSByZXF1aXJlKCdnM3ctb2wzL3NyYy9jb250cm9scy9xdWVyeWNvbnRyb2wnKTtcbnZhciBab29tQm94Q29udHJvbCA9IHJlcXVpcmUoJ2czdy1vbDMvc3JjL2NvbnRyb2xzL3pvb21ib3hjb250cm9sJyk7XG52YXIgUGlja0Nvb3JkaW5hdGVzSW50ZXJhY3Rpb24gPSByZXF1aXJlKCdnM3ctb2wzL3NyYy9pbnRlcmFjdGlvbnMvcGlja2Nvb3JkaW5hdGVzaW50ZXJhY3Rpb24nKTtcbnZhciBXTVNTaW5nbGVMYXllciA9IHJlcXVpcmUoJy4vd21zc2luZ2xlbGF5ZXInKTtcbnZhciBXTVNNdWx0aUxheWVyID0gcmVxdWlyZSgnLi93bXNtdWx0aWxheWVyJyk7XG52YXIgTWFwUXVlcnlTZXJ2aWNlID0gcmVxdWlyZSgnLi9tYXBxdWVyeXNlcnZpY2UnKTtcblxudmFyIFBpY2tUb2xlcmFuY2VQYXJhbXMgPSB7fTtcblBpY2tUb2xlcmFuY2VQYXJhbXNbUHJvamVjdFR5cGVzLlFESkFOR09dID0ge307XG5QaWNrVG9sZXJhbmNlUGFyYW1zW1Byb2plY3RUeXBlcy5RREpBTkdPXVtHZW9tZXRyeVR5cGVzLlBPSU5UXSA9IFwiRklfUE9JTlRfVE9MRVJBTkNFXCI7XG5QaWNrVG9sZXJhbmNlUGFyYW1zW1Byb2plY3RUeXBlcy5RREpBTkdPXVtHZW9tZXRyeVR5cGVzLkxJTkVTVFJJTkddID0gXCJGSV9MSU5FX1RPTEVSQU5DRVwiO1xuUGlja1RvbGVyYW5jZVBhcmFtc1tQcm9qZWN0VHlwZXMuUURKQU5HT11bR2VvbWV0cnlUeXBlcy5QT0xZR09OXSA9IFwiRklfUE9MWUdPTl9UT0xFUkFOQ0VcIjtcblxudmFyIFBpY2tUb2xlcmFuY2VWYWx1ZXMgPSB7fVxuUGlja1RvbGVyYW5jZVZhbHVlc1tHZW9tZXRyeVR5cGVzLlBPSU5UXSA9IDU7XG5QaWNrVG9sZXJhbmNlVmFsdWVzW0dlb21ldHJ5VHlwZXMuTElORVNUUklOR10gPSA1O1xuUGlja1RvbGVyYW5jZVZhbHVlc1tHZW9tZXRyeVR5cGVzLlBPTFlHT05dID0gNTtcblxuZnVuY3Rpb24gTWFwU2VydmljZSgpe1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIHRoaXMuY29uZmlnO1xuICB0aGlzLnZpZXdlcjtcbiAgdGhpcy5tYXBMYXllcnMgPSB7fTtcbiAgdGhpcy5tYXBCYXNlTGF5ZXJzID0ge307XG4gIHRoaXMubGF5ZXJzQXNzb2NpYXRpb24gPSB7fTtcbiAgdGhpcy5sYXllcnNFeHRyYVBhcmFtcyA9IHt9O1xuICB0aGlzLnN0YXRlID0ge1xuICAgICAgYmJveDogW10sXG4gICAgICByZXNvbHV0aW9uOiBudWxsLFxuICAgICAgY2VudGVyOiBudWxsLFxuICAgICAgbG9hZGluZzogZmFsc2VcbiAgfTtcbiAgXG4gIHRoaXMuaW5pdCA9IGZ1bmN0aW9uKGNvbmZpZykge1xuICAgIHRoaXMuY29uZmlnID0gY29uZmlnO1xuICB9XG4gIFxuICB0aGlzLl9ob3dNYW55QXJlTG9hZGluZyA9IDA7XG4gIFxuICB0aGlzLl9pbnRlcmFjdGlvbnNTdGFjayA9IFtdO1xuICBcbiAgdGhpcy5zZXR0ZXJzID0ge1xuICAgIHNldE1hcFZpZXc6IGZ1bmN0aW9uKGJib3gscmVzb2x1dGlvbixjZW50ZXIpe1xuICAgICAgdGhpcy5zdGF0ZS5iYm94ID0gYmJveDtcbiAgICAgIHRoaXMuc3RhdGUucmVzb2x1dGlvbiA9IHJlc29sdXRpb247XG4gICAgICB0aGlzLnN0YXRlLmNlbnRlciA9IGNlbnRlcjtcbiAgICAgIHRoaXMuY2hlY2tMYXllcnNEaXNhYmxlZChyZXNvbHV0aW9uKTtcbiAgICB9LFxuICAgIHNldElzTG9hZGluZzogZnVuY3Rpb24oYm9vbCl7XG4gICAgICB2YXIgZGVsdGEgPSBib29sID8gMSA6IC0xO1xuICAgICAgdmFyIGlzRmlyc3RJbmNyZW1lbnQgPSAodGhpcy5faG93TWFueUFyZUxvYWRpbmcgPT0gMCkgJiYgKGRlbHRhID09IDEpO1xuICAgICAgdmFyIGlzTGFzdERlY3JlbWVudCA9ICh0aGlzLl9ob3dNYW55QXJlTG9hZGluZyA9PSAxKSAmJiAoZGVsdGEgPT0gLTEpO1xuICAgICAgdGhpcy5faG93TWFueUFyZUxvYWRpbmcgKz0gZGVsdGE7XG5cbiAgICAgIGlmIChpc0ZpcnN0SW5jcmVtZW50IHx8IGlzTGFzdERlY3JlbWVudCl7XG4gICAgICAgIHRoaXMuc3RhdGUubG9hZGluZyA9IGJvb2w7XG4gICAgICAgIGlmIChib29sKSB7XG4gICAgICAgICAgdGhpcy5lbWl0KCdsb2Fkc3RhcnQnKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICB0aGlzLmVtaXQoJ2xvYWRlbmQnKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0sXG4gICAgc2V0dXBWaWV3ZXI6IGZ1bmN0aW9uKCl7XG4gICAgICAkc2NyaXB0KFwiaHR0cDovL2Vwc2cuaW8vXCIrUHJvamVjdFNlcnZpY2Uuc3RhdGUucHJvamVjdC5jcnMrXCIuanNcIik7XG4gICAgICBpZiAoc2VsZi52aWV3ZXIpIHtcbiAgICAgICAgdGhpcy52aWV3ZXIuZGVzdHJveSgpO1xuICAgICAgICB0aGlzLnZpZXdlciA9IG51bGw7XG4gICAgICB9XG4gICAgICBzZWxmLl9zZXR1cFZpZXdlcigpO1xuICAgICAgc2VsZi5zZXR1cENvbnRyb2xzKCk7XG4gICAgICBzZWxmLnNldHVwTGF5ZXJzKCk7XG4gICAgICBzZWxmLmVtaXQoJ3ZpZXdlcnNldCcpO1xuICAgIH1cbiAgfTtcbiAgXG4gIFByb2plY3RTZXJ2aWNlLm9uKCdwcm9qZWN0c2V0JyxmdW5jdGlvbigpe1xuICAgIHNlbGYuc2V0dXBWaWV3ZXIoKTtcbiAgfSk7XG4gIFxuICBQcm9qZWN0U2VydmljZS5vbigncHJvamVjdHN3aXRjaCcsZnVuY3Rpb24oKXtcbiAgICBzZWxmLnNldHVwTGF5ZXJzKCk7XG4gIH0pO1xuICBcbiAgUHJvamVjdFNlcnZpY2Uub25hZnRlcignc2V0TGF5ZXJzVmlzaWJsZScsZnVuY3Rpb24obGF5ZXJzKXtcbiAgICBfLmZvckVhY2gobGF5ZXJzLGZ1bmN0aW9uKGxheWVyKXtcbiAgICAgIHZhciBtYXBMYXllciA9IHNlbGYuZ2V0TWFwTGF5ZXJGb3JMYXllcihsYXllcik7XG4gICAgICBtYXBMYXllci51cGRhdGUoKTtcbiAgICB9KVxuICB9KTtcbiAgXG4gIHRoaXMuY2hlY2tMYXllckRpc2FibGVkID0gZnVuY3Rpb24obGF5ZXIscmVzb2x1dGlvbikge1xuICAgIHZhciBkaXNhYmxlZCA9IGxheWVyLmRpc2FibGVkIHx8IGZhbHNlO1xuICAgIGlmIChsYXllci5tYXhyZXNvbHV0aW9uKXtcbiAgICAgIGRpc2FibGVkID0gbGF5ZXIubWF4cmVzb2x1dGlvbiA8IHJlc29sdXRpb247XG4gICAgfVxuICAgIGlmIChsYXllci5taW5yZXNvbHV0aW9uKXtcbiAgICAgIGxheWVyLmRpc2FibGVkID0gZGlzYWJsZWQgJiYgKGxheWVyLm1pbnJlc29sdXRpb24gPiByZXNvbHV0aW9uKTtcbiAgICB9XG4gICAgbGF5ZXIuZGlzYWJsZWQgPSBkaXNhYmxlZDtcbiAgfTtcbiAgXG4gIHRoaXMuY2hlY2tMYXllcnNEaXNhYmxlZCA9IGZ1bmN0aW9uKHJlc29sdXRpb24pe1xuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICBfLmZvckVhY2godGhpcy5tYXBMYXllcnMsZnVuY3Rpb24obWFwTGF5ZXIpe1xuICAgICAgXy5mb3JFYWNoKG1hcExheWVyLmdldExheWVyQ29uZmlncygpLGZ1bmN0aW9uKGxheWVyKXtcbiAgICAgICAgc2VsZi5jaGVja0xheWVyRGlzYWJsZWQobGF5ZXIscmVzb2x1dGlvbik7XG4gICAgICB9KTsgXG4gICAgfSlcbiAgfTtcbiAgXG4gIFByb2plY3RTZXJ2aWNlLm9uYWZ0ZXIoJ3NldEJhc2VMYXllcicsZnVuY3Rpb24oKXtcbiAgICBfLmZvckVhY2goc2VsZi5tYXBCYXNlTGF5ZXJzLGZ1bmN0aW9uKG1hcEJhc2VMYXllcil7XG4gICAgICBtYXBCYXNlTGF5ZXIudXBkYXRlKCk7XG4gICAgfSlcbiAgfSlcbiAgXG4gIHRoaXMuX3NldHVwVmlld2VyID0gZnVuY3Rpb24oKXtcbiAgICB2YXIgZXh0ZW50ID0gUHJvamVjdFNlcnZpY2Uuc3RhdGUucHJvamVjdC5leHRlbnQ7XG4gICAgdmFyIHByb2plY3Rpb24gPSBuZXcgb2wucHJvai5Qcm9qZWN0aW9uKHtcbiAgICAgIGNvZGU6IFwiRVBTRzpcIitQcm9qZWN0U2VydmljZS5zdGF0ZS5wcm9qZWN0LmNycyxcbiAgICAgIGV4dGVudDogZXh0ZW50XG4gICAgfSk7XG4gICAgXG4gICAgLyp2YXIgY29uc3RyYWluX2V4dGVudDtcbiAgICBpZiAodGhpcy5jb25maWcuY29uc3RyYWludGV4dGVudCkge1xuICAgICAgdmFyIGV4dGVudCA9IHRoaXMuY29uZmlnLmNvbnN0cmFpbnRleHRlbnQ7XG4gICAgICB2YXIgZHggPSBleHRlbnRbMl0tZXh0ZW50WzBdO1xuICAgICAgdmFyIGR5ID0gZXh0ZW50WzNdLWV4dGVudFsxXTtcbiAgICAgIHZhciBkeDQgPSBkeC80O1xuICAgICAgdmFyIGR5NCA9IGR5LzQ7XG4gICAgICB2YXIgYmJveF94bWluID0gZXh0ZW50WzBdICsgZHg0O1xuICAgICAgdmFyIGJib3hfeG1heCA9IGV4dGVudFsyXSAtIGR4NDtcbiAgICAgIHZhciBiYm94X3ltaW4gPSBleHRlbnRbMV0gKyBkeTQ7XG4gICAgICB2YXIgYmJveF95bWF4ID0gZXh0ZW50WzNdIC0gZHk0O1xuICAgICAgXG4gICAgICBjb25zdHJhaW5fZXh0ZW50ID0gW2Jib3hfeG1pbixiYm94X3ltaW4sYmJveF94bWF4LGJib3hfeW1heF07XG4gICAgfSovXG4gICAgXG4gICAgdGhpcy52aWV3ZXIgPSBvbDNoZWxwZXJzLmNyZWF0ZVZpZXdlcih7XG4gICAgICB2aWV3OiB7XG4gICAgICAgIHByb2plY3Rpb246IHByb2plY3Rpb24sXG4gICAgICAgIGNlbnRlcjogdGhpcy5jb25maWcuaW5pdGNlbnRlciB8fCBvbC5leHRlbnQuZ2V0Q2VudGVyKFByb2plY3RTZXJ2aWNlLnN0YXRlLnByb2plY3QuZXh0ZW50KSxcbiAgICAgICAgem9vbTogdGhpcy5jb25maWcuaW5pdHpvb20gfHwgMCxcbiAgICAgICAgZXh0ZW50OiB0aGlzLmNvbmZpZy5jb25zdHJhaW50ZXh0ZW50IHx8IGV4dGVudCxcbiAgICAgICAgbWluWm9vbTogdGhpcy5jb25maWcubWluem9vbSB8fCAwLCAvLyBkZWZhdWx0IGRpIE9MMyAzLjE2LjBcbiAgICAgICAgbWF4Wm9vbTogdGhpcy5jb25maWcubWF4em9vbSB8fCAyOCAvLyBkZWZhdWx0IGRpIE9MMyAzLjE2LjBcbiAgICAgIH1cbiAgICB9KTtcbiAgICBcbiAgICAvL3ZhciB2aWV3ID0gdGhpcy52aWV3ZXIubWFwLmdldFZpZXcoKTtcbiAgICAvKnZpZXcub24oJ2NoYW5nZTpyZXNvbHV0aW9uJyxmdW5jdGlvbihlKXtcbiAgICAgIHNlbGYuc2V0Vmlld0JCT1goc2VsZi52aWV3ZXIuZ2V0QkJPWCgpKTtcbiAgICAgIHNlbGYuc2V0UmVzb2x1dGlvbihzZWxmLnZpZXdlci5nZXRSZXNvbHV0aW9uKCkpO1xuICAgIH0pOyovXG4gICAgXG4gICAgdGhpcy52aWV3ZXIubWFwLm9uKCdtb3ZlZW5kJyxmdW5jdGlvbihlKXtcbiAgICAgIHNlbGYuX3NldE1hcFZpZXcoKTtcbiAgICB9KTtcbiAgICBcbiAgICBNYXBRdWVyeVNlcnZpY2UuaW5pdCh0aGlzLnZpZXdlci5tYXApO1xuICAgIFxuICAgIHRoaXMuZW1pdCgncmVhZHknKTtcbiAgfTtcbiAgXG4gIHRoaXMuZ2V0Vmlld2VyRWxlbWVudCA9IGZ1bmN0aW9uKCl7XG4gICAgdGhpcy52aWV3ZXIubWFwLmdldFRhcmdldEVsZW1lbnQoKTtcbiAgfTtcbiAgXG4gIHRoaXMuZ2V0Vmlld3BvcnQgPSBmdW5jdGlvbigpe1xuICAgIHJldHVybiB0aGlzLnZpZXdlci5tYXAuZ2V0Vmlld3BvcnQoKTtcbiAgfTtcbiAgXG4gIHRoaXMuc2V0dXBDb250cm9scyA9IGZ1bmN0aW9uKCl7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIHZhciBtYXAgPSBzZWxmLnZpZXdlci5tYXA7XG4gICAgaWYgKHRoaXMuY29uZmlnICYmIHRoaXMuY29uZmlnLmNvbnRyb2xzKSB7XG4gICAgICBfLmZvckVhY2godGhpcy5jb25maWcuY29udHJvbHMsZnVuY3Rpb24oY29udHJvbFR5cGUpe1xuICAgICAgICB2YXIgY29udHJvbDtcbiAgICAgICAgc3dpdGNoIChjb250cm9sVHlwZSkge1xuICAgICAgICAgIGNhc2UgJ3Jlc2V0JzpcbiAgICAgICAgICAgIGlmICghaXNNb2JpbGUuYW55KSB7XG4gICAgICAgICAgICAgIGNvbnRyb2wgPSBuZXcgUmVzZXRDb250cm9sKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlICd6b29tJzpcbiAgICAgICAgICAgIGNvbnRyb2wgPSBuZXcgb2wuY29udHJvbC5ab29tKHtcbiAgICAgICAgICAgICAgem9vbUluTGFiZWw6IFwiXFx1ZTk4YVwiLFxuICAgICAgICAgICAgICB6b29tT3V0TGFiZWw6IFwiXFx1ZTk4YlwiXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgJ3pvb21ib3gnOiBcbiAgICAgICAgICAgIGlmICghaXNNb2JpbGUuYW55KSB7XG4gICAgICAgICAgICAgIGNvbnRyb2wgPSBuZXcgWm9vbUJveENvbnRyb2woKTtcbiAgICAgICAgICAgICAgY29udHJvbC5vbignem9vbWVuZCcsZnVuY3Rpb24oZSl7XG4gICAgICAgICAgICAgICAgc2VsZi52aWV3ZXIuZml0KGUuZXh0ZW50KTtcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgJ3pvb210b2V4dGVudCc6XG4gICAgICAgICAgICBjb250cm9sID0gbmV3IG9sLmNvbnRyb2wuWm9vbVRvRXh0ZW50KHtcbiAgICAgICAgICAgICAgbGFiZWw6ICBcIlxcdWU5OGNcIixcbiAgICAgICAgICAgICAgZXh0ZW50OiBzZWxmLmNvbmZpZy5jb25zdHJhaW50ZXh0ZW50XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgJ3F1ZXJ5JzpcbiAgICAgICAgICAgIGNvbnRyb2wgPSBuZXcgUXVlcnlDb250cm9sKCk7XG4gICAgICAgICAgICBjb250cm9sLm9uKCdwaWNrZWQnLGZ1bmN0aW9uKGUpe1xuICAgICAgICAgICAgICB2YXIgY29vcmRpbmF0ZXMgPSBlLmNvb3JkaW5hdGVzO1xuIFxuICAgICAgICAgICAgICBNYXBRdWVyeVNlcnZpY2UucXVlcnlQb2ludChjb29yZGluYXRlcyxzZWxmLm1hcExheWVycylcbiAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oY29vcmRpbmF0ZXMsbmZlYXR1cmVzLGZlYXR1cmVzRm9yTGF5ZXJOYW1lcyl7XG4gICAgICAgICAgICAgICAgdmFyIGZlYXR1cmVzRm9yTGF5ZXJzID0gW107XG4gICAgICAgICAgICAgICAgXy5mb3JFYWNoKGZlYXR1cmVzRm9yTGF5ZXJOYW1lcyxmdW5jdGlvbihmZWF0dXJlcyxsYXllck5hbWUpe1xuICAgICAgICAgICAgICAgICAgdmFyIGxheWVyID0gUHJvamVjdFNlcnZpY2UubGF5ZXJzW2xheWVyTmFtZV07XG4gICAgICAgICAgICAgICAgICBmZWF0dXJlc0ZvckxheWVycy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgbGF5ZXI6IGxheWVyLFxuICAgICAgICAgICAgICAgICAgICBmZWF0dXJlczogZmVhdHVyZXNcbiAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBzZWxmLmVtaXQoJ21hcHF1ZXJ5ZW5kJyxmZWF0dXJlc0ZvckxheWVycyxuZmVhdHVyZXMsY29vcmRpbmF0ZXMsc2VsZi5zdGF0ZS5yZXNvbHV0aW9uKTtcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGlmIChjb250cm9sKSB7XG4gICAgICAgICAgc2VsZi5hZGRDb250cm9sKGNvbnRyb2wpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gIH07XG4gIFxuICB0aGlzLmFkZENvbnRyb2wgPSBmdW5jdGlvbihjb250cm9sKXtcbiAgICB0aGlzLnZpZXdlci5tYXAuYWRkQ29udHJvbChjb250cm9sKTtcbiAgfTtcbiAgXG4gIHRoaXMuc2V0TGF5ZXJzRXh0cmFQYXJhbXMgPSBmdW5jdGlvbihwYXJhbXMsdXBkYXRlKXtcbiAgICB0aGlzLmxheWVyc0V4dHJhUGFyYW1zID0gXy5hc3NpZ24odGhpcy5sYXllcnNFeHRyYVBhcmFtcyxwYXJhbXMpO1xuICAgIHRoaXMuZW1pdCgnZXh0cmFQYXJhbXNTZXQnLHBhcmFtcyx1cGRhdGUpO1xuICB9O1xuICBcbiAgdGhpcy5zZXR1cEJhc2VMYXllcnMgPSBmdW5jdGlvbigpe1xuICAgIGlmICghUHJvamVjdHNSZWdpc3RyeS5zdGF0ZS5iYXNlTGF5ZXJzKXtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIHRoaXMubWFwQmFzZUxheWVycyA9IHt9O1xuICAgIFxuICAgIHZhciBpbml0QmFzZUxheWVyID0gUHJvamVjdFNlcnZpY2UuY29uZmlnLmluaXRiYXNlbGF5ZXI7XG4gICAgdmFyIGJhc2VMYXllcnNBcnJheSA9IFByb2plY3RTZXJ2aWNlLnN0YXRlLmJhc2VMYXllcnM7XG4gICAgXG4gICAgXy5mb3JFYWNoKGJhc2VMYXllcnNBcnJheSxmdW5jdGlvbihiYXNlTGF5ZXIpe1xuICAgICAgdmFyIHZpc2libGUgPSB0cnVlO1xuICAgICAgaWYgKFByb2plY3RTZXJ2aWNlLnN0YXRlLnByb2plY3QuaW5pdGJhc2VsYXllcikge1xuICAgICAgICB2aXNpYmxlID0gYmFzZUxheWVyLmlkID09IChQcm9qZWN0U2VydmljZS5zdGF0ZS5wcm9qZWN0LmluaXRiYXNlbGF5ZXIpO1xuICAgICAgfVxuICAgICAgaWYgKGJhc2VMYXllci5maXhlZCkge1xuICAgICAgICB2aXNpYmxlID0gYmFzZUxheWVyLmZpeGVkO1xuICAgICAgfVxuICAgICAgYmFzZUxheWVyLnZpc2libGUgPSB2aXNpYmxlO1xuICAgIH0pXG4gICAgXG4gICAgYmFzZUxheWVyc0FycmF5LmZvckVhY2goZnVuY3Rpb24obGF5ZXIpeyAgICAgXG4gICAgICB2YXIgY29uZmlnID0ge1xuICAgICAgICBkZWZhdWx0VXJsOiBQcm9qZWN0U2VydmljZS5nZXRXbXNVcmwoKSxcbiAgICAgICAgaWQ6IGxheWVyLmlkLFxuICAgICAgICB0aWxlZDogdHJ1ZVxuICAgICAgfTtcbiAgICAgIFxuICAgICAgdmFyIG1hcExheWVyID0gbmV3IFdNU1NpbmdsZUxheWVyKGNvbmZpZyk7XG4gICAgICBzZWxmLnJlZ2lzdGVyTGlzdGVuZXJzKG1hcExheWVyKTtcbiAgICAgIFxuICAgICAgbWFwTGF5ZXIuYWRkTGF5ZXIobGF5ZXIpO1xuICAgICAgc2VsZi5tYXBCYXNlTGF5ZXJzW2xheWVyLmlkXSA9IG1hcExheWVyO1xuICAgIH0pO1xuICAgIFxuICAgIF8uZm9yRWFjaChfLnZhbHVlcyh0aGlzLm1hcEJhc2VMYXllcnMpLnJldmVyc2UoKSxmdW5jdGlvbihtYXBMYXllcil7XG4gICAgICBzZWxmLnZpZXdlci5tYXAuYWRkTGF5ZXIobWFwTGF5ZXIuZ2V0TGF5ZXIoKSk7XG4gICAgICBtYXBMYXllci51cGRhdGUoKTtcbiAgICB9KVxuICB9O1xuICBcbiAgdGhpcy5zZXR1cExheWVycyA9IGZ1bmN0aW9uKCl7XG4gICAgdGhpcy52aWV3ZXIucmVtb3ZlTGF5ZXJzKCk7XG4gICAgXG4gICAgdGhpcy5zZXR1cEJhc2VMYXllcnMoKTtcbiAgICBcbiAgICB0aGlzLm1hcExheWVycyA9IHt9O1xuICAgIHRoaXMubGF5ZXJzQXNzb2NpYXRpb24gPSB7fTtcbiAgICB2YXIgbGF5ZXJzQXJyYXkgPSB0aGlzLnRyYXZlcnNlTGF5ZXJzVHJlZShQcm9qZWN0U2VydmljZS5zdGF0ZS5wcm9qZWN0LmxheWVyc3RyZWUpO1xuICAgIC8vIHByZW5kbyBzb2xvIGkgbGF5ZXIgdmVyaSBlIG5vbiBpIGZvbGRlclxuICAgIHZhciBsZWFmTGF5ZXJzQXJyYXkgPSBfLmZpbHRlcihsYXllcnNBcnJheSxmdW5jdGlvbihsYXllcil7XG4gICAgICByZXR1cm4gIV8uZ2V0KGxheWVyLCdub2RlcycpO1xuICAgIH0pO1xuICAgIHZhciBtdWx0aUxheWVycyA9IF8uZ3JvdXBCeShsZWFmTGF5ZXJzQXJyYXksZnVuY3Rpb24obGF5ZXIpe1xuICAgICAgcmV0dXJuIGxheWVyLm11bHRpbGF5ZXI7XG4gICAgfSk7XG4gICAgXy5mb3JFYWNoKG11bHRpTGF5ZXJzLGZ1bmN0aW9uKGxheWVycyxpZCl7XG4gICAgICB2YXIgbiA9IGxheWVycy5sZW5ndGg7XG4gICAgICB2YXIgbGF5ZXJJZCA9ICdsYXllcl8nK2lkXG4gICAgICB2YXIgbWFwTGF5ZXIgPSBfLmdldChzZWxmLm1hcExheWVycyxsYXllcklkKTtcbiAgICAgIHZhciB0aWxlZCA9IGxheWVyc1swXS50aWxlZCAvLyBCUlVUVElTU0lNTywgZGEgc2lzdGVtYXJlIHF1YW5kbyByaW9yZ2FuaXp6ZXJlbW8gaSBtZXRhbGF5ZXIgKGRhIGZhciBkaXZlbnRhcmUgbXVsdGlsYXllcikuIFBlciBvcmEgcG9zc28gY29uZmlndXJhcmUgdGlsZWQgc29sbyBpIGxheWVyIHNpbmdvbGlcbiAgICAgIC8vIHNlIGhvIHBpw7kgbGF5ZXIgcGVyIHVuIGRhdG8gbWV0YWxheWVyIHNpZ25pZmljYS4uLiBjaGUgc2kgdHJhdHRhIGVmZmV0dGl2YW1lbnRlIGRpIHVuIG1ldGFseWVyXG4gICAgICB2YXIgV01TTGF5ZXJDbGFzcyA9IG4+MSA/IFdNU011bHRpTGF5ZXIgOiBXTVNTaW5nbGVMYXllcjtcbiAgICAgIHZhciBjb25maWcgPSB7XG4gICAgICAgIGRlZmF1bHRVcmw6IFByb2plY3RTZXJ2aWNlLmdldFdtc1VybCgpLFxuICAgICAgICBpZDogbGF5ZXJJZCxcbiAgICAgICAgdGlsZWQ6IHRpbGVkXG4gICAgICB9O1xuICAgICAgbWFwTGF5ZXIgPSBzZWxmLm1hcExheWVyc1tsYXllcklkXSA9IG5ldyBXTVNMYXllckNsYXNzKGNvbmZpZyxzZWxmLmxheWVyc0V4dHJhUGFyYW1zKTtcbiAgICAgIHNlbGYucmVnaXN0ZXJMaXN0ZW5lcnMobWFwTGF5ZXIpO1xuICAgICAgXG4gICAgICBsYXllcnMuZm9yRWFjaChmdW5jdGlvbihsYXllcil7XG4gICAgICAgIC8vIElOSUVUVE8gUVVBIExBIFBST1BSSUVUQScgXCJkaXNhYmxlZFwiIHBlciBnZXN0aXJlIGkgbGF5ZXIgZ3JpZ2lhdGlcbiAgICAgICAgdmFyIHJlc29sdXRpb24gPSBzZWxmLnZpZXdlci5tYXAuZ2V0VmlldygpLmdldFJlc29sdXRpb24oKTtcbiAgICAgICAgc2VsZi5jaGVja0xheWVyRGlzYWJsZWQobGF5ZXIscmVzb2x1dGlvbik7XG4gICAgICAgIG1hcExheWVyLmFkZExheWVyKGxheWVyKTtcbiAgICAgICAgc2VsZi5sYXllcnNBc3NvY2lhdGlvbltsYXllci5pZF0gPSBsYXllcklkO1xuICAgICAgfSk7XG4gICAgfSlcbiAgICBcbiAgICBfLmZvckVhY2goXy52YWx1ZXModGhpcy5tYXBMYXllcnMpLnJldmVyc2UoKSxmdW5jdGlvbihtYXBMYXllcil7XG4gICAgICBzZWxmLnZpZXdlci5tYXAuYWRkTGF5ZXIobWFwTGF5ZXIuZ2V0TGF5ZXIoKSk7XG4gICAgICBtYXBMYXllci51cGRhdGUoc2VsZi5sYXllcnNFeHRyYVBhcmFtcyk7XG4gICAgfSlcbiAgfTtcbiAgXG4gIHRoaXMuZ2V0TWFwTGF5ZXJGb3JMYXllciA9IGZ1bmN0aW9uKGxheWVyKXtcbiAgICByZXR1cm4gdGhpcy5tYXBMYXllcnNbJ2xheWVyXycrbGF5ZXIubXVsdGlsYXllcl07XG4gIH07XG4gIFxuICB0aGlzLnRyYXZlcnNlTGF5ZXJzVHJlZSA9IGZ1bmN0aW9uKGxheWVyc1RyZWUpe1xuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICB2YXIgbGF5ZXJzQXJyYXkgPSBbXTtcbiAgICBmdW5jdGlvbiB0cmF2ZXJzZShvYmope1xuICAgICAgXy5mb3JJbihvYmosIGZ1bmN0aW9uICh2YWwsIGtleSkge1xuICAgICAgICAgIGlmICghXy5pc05pbCh2YWwuaWQpKSB7XG4gICAgICAgICAgICAgIGxheWVyc0FycmF5LnVuc2hpZnQodmFsKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKCFfLmlzTmlsKHZhbC5ub2RlcykpIHtcbiAgICAgICAgICAgICAgdHJhdmVyc2UodmFsLm5vZGVzKTtcbiAgICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gICAgdHJhdmVyc2UobGF5ZXJzVHJlZSk7XG4gICAgcmV0dXJuIGxheWVyc0FycmF5O1xuICB9O1xuICBcbiAgdGhpcy5yZWdpc3Rlckxpc3RlbmVycyA9IGZ1bmN0aW9uKG1hcExheWVyKXtcbiAgICBtYXBMYXllci5vbignbG9hZHN0YXJ0JyxmdW5jdGlvbigpe1xuICAgICAgc2VsZi5zZXRJc0xvYWRpbmcodHJ1ZSk7XG4gICAgfSk7XG4gICAgbWFwTGF5ZXIub24oJ2xvYWRlbmQnLGZ1bmN0aW9uKCl7XG4gICAgICBzZWxmLnNldElzTG9hZGluZyhmYWxzZSk7XG4gICAgfSk7XG4gICAgXG4gICAgdGhpcy5vbignZXh0cmFQYXJhbXNTZXQnLGZ1bmN0aW9uKGV4dHJhUGFyYW1zLHVwZGF0ZSl7XG4gICAgICBpZiAodXBkYXRlKSB7XG4gICAgICAgIG1hcExheWVyLnVwZGF0ZShleHRyYVBhcmFtcyk7XG4gICAgICB9XG4gICAgfSlcbiAgfTtcbiAgXG4gIHRoaXMuc2hvd1ZpZXdlciA9IGZ1bmN0aW9uKGVsSWQpe1xuICAgIHRoaXMudmlld2VyLnNldFRhcmdldChlbElkKTtcbiAgICB2YXIgbWFwID0gdGhpcy52aWV3ZXIubWFwO1xuICAgIEdVSS5vbignZ3VpcmVhZHknLGZ1bmN0aW9uKCl7XG4gICAgICBzZWxmLl9zZXRNYXBWaWV3KCk7XG4gICAgfSk7XG4gIH07XG4gIFxuICBcbiAgLy8gcGVyIGNyZWFyZSB1bmEgcGlsYSBkaSBvbC5pbnRlcmFjdGlvbiBpbiBjdWkgbCd1bHRpbW8gY2hlIHNpIGFnZ2l1bmdlIGRpc2F0dGl2YSB0ZW1wb3JhZW1lbnRlIGkgcHJlY2VkZW50aSAocGVyIHBvaSB0b2dsaWVyc2kgZGkgbWV6em8gY29uIHBvcEludGVyYWN0aW9uISlcbiAgLy8gVXNhdG8gYWQgZXMuIGRhIHBpY2tmZWF0dXJldG9vbCBlIGdldGZlYXR1cmVpbmZvXG4gIHRoaXMucHVzaEludGVyYWN0aW9uID0gZnVuY3Rpb24oaW50ZXJhY3Rpb24pe1xuICAgIGlmICh0aGlzLl9pbnRlcmFjdGlvbnNTdGFjay5sZW5ndGgpe1xuICAgICAgdmFyIHByZXZJbnRlcmFjdGlvbiA9IHRoaXMuX2ludGVyYWN0aW9uc1N0YWNrLnNsaWNlKC0xKVswXTtcbiAgICAgIGlmIChfLmlzQXJyYXkocHJldkludGVyYWN0aW9uKSl7XG4gICAgICAgIF8uZm9yRWFjaChwcmV2SW50ZXJhY3Rpb24sZnVuY3Rpb24oaW50ZXJhY3Rpb24pe1xuICAgICAgICAgIGludGVyYWN0aW9uLnNldEFjdGl2ZShmYWxzZSk7XG4gICAgICAgIH0pXG4gICAgICB9XG4gICAgICBlbHNle1xuICAgICAgICBwcmV2SW50ZXJhY3Rpb24uc2V0QWN0aXZlKGZhbHNlKTtcbiAgICAgIH07XG4gICAgfVxuICAgIFxuICAgIHRoaXMudmlld2VyLm1hcC5hZGRJbnRlcmFjdGlvbihpbnRlcmFjdGlvbik7XG4gICAgaW50ZXJhY3Rpb24uc2V0QWN0aXZlKHRydWUpO1xuICAgIHRoaXMuX2ludGVyYWN0aW9uc1N0YWNrLnB1c2goaW50ZXJhY3Rpb24pXG4gIH07XG4gIFxuICB0aGlzLnBvcEludGVyYWN0aW9uID0gZnVuY3Rpb24oKXtcbiAgICB2YXIgaW50ZXJhY3Rpb24gPSB0aGlzLl9pbnRlcmFjdGlvbnNTdGFjay5wb3AoKTtcbiAgICB0aGlzLnZpZXdlci5tYXAucmVtb3ZlSW50ZXJhY3Rpb24oaW50ZXJhY3Rpb24pO1xuICAgIFxuICAgIGlmICh0aGlzLl9pbnRlcmFjdGlvbnNTdGFjay5sZW5ndGgpe1xuICAgICAgdmFyIHByZXZJbnRlcmFjdGlvbiA9IHRoaXMuX2ludGVyYWN0aW9uc1N0YWNrLnNsaWNlKC0xKVswXTtcbiAgICAgIGlmIChfLmlzQXJyYXkocHJldkludGVyYWN0aW9uKSl7XG4gICAgICAgIF8uZm9yRWFjaChwcmV2SW50ZXJhY3Rpb24sZnVuY3Rpb24oaW50ZXJhY3Rpb24pe1xuICAgICAgICAgIGludGVyYWN0aW9uLnNldEFjdGl2ZSh0cnVlKTtcbiAgICAgICAgfSlcbiAgICAgIH1cbiAgICAgIGVsc2V7XG4gICAgICAgIHByZXZJbnRlcmFjdGlvbi5zZXRBY3RpdmUodHJ1ZSk7XG4gICAgICB9O1xuICAgIH1cbiAgfTtcbiAgXG4gIHRoaXMuZ29UbyA9IGZ1bmN0aW9uKGNvb3JkaW5hdGVzLHpvb20pe1xuICAgIHZhciB6b29tID0gem9vbSB8fCA2O1xuICAgIHRoaXMudmlld2VyLmdvVG8oY29vcmRpbmF0ZXMsem9vbSk7XG4gIH07XG4gIFxuICB0aGlzLmdvVG9XR1M4NCA9IGZ1bmN0aW9uKGNvb3JkaW5hdGVzLHpvb20pe1xuICAgIHZhciBjb29yZGluYXRlcyA9IG9sLnByb2oudHJhbnNmb3JtKGNvb3JkaW5hdGVzLCdFUFNHOjQzMjYnLCdFUFNHOicrUHJvamVjdFNlcnZpY2Uuc3RhdGUucHJvamVjdC5jcnMpO1xuICAgIHRoaXMuZ29Ubyhjb29yZGluYXRlcyx6b29tKTtcbiAgfTtcbiAgXG4gIHRoaXMuZXh0ZW50VG9XR1M4NCA9IGZ1bmN0aW9uKGV4dGVudCl7XG4gICAgcmV0dXJuIG9sLnByb2oudHJhbnNmb3JtRXh0ZW50KGV4dGVudCwnRVBTRzonK1Byb2plY3RTZXJ2aWNlLnN0YXRlLnByb2plY3QuY3JzLCdFUFNHOjQzMjYnKTtcbiAgfTtcbiAgXG4gIHRoaXMuZ2V0RmVhdHVyZUluZm8gPSBmdW5jdGlvbihsYXllcklkKXtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgdmFyIGRlZmVycmVkID0gJC5EZWZlcnJlZCgpO1xuICAgIHRoaXMuX3BpY2tJbnRlcmFjdGlvbiA9IG5ldyBQaWNrQ29vcmRpbmF0ZXNJbnRlcmFjdGlvbigpO1xuICAgIC8vdGhpcy52aWV3ZXIubWFwLmFkZEludGVyYWN0aW9uKHRoaXMuX3BpY2tJbnRlcmFjdGlvbik7XG4gICAgLy90aGlzLl9waWNrSW50ZXJhY3Rpb24uc2V0QWN0aXZlKHRydWUpO1xuICAgIHRoaXMucHVzaEludGVyYWN0aW9uKHRoaXMuX3BpY2tJbnRlcmFjdGlvbik7XG4gICAgdGhpcy5fcGlja0ludGVyYWN0aW9uLm9uKCdwaWNrZWQnLGZ1bmN0aW9uKGUpe1xuICAgICAgc2VsZi5fY29tcGxldGVHZXRGZWF0dXJlSW5mbyhsYXllcklkLGUuY29vcmRpbmF0ZSxkZWZlcnJlZCk7XG4gICAgfSlcbiAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZSgpO1xuICB9O1xuICBcbiAgdGhpcy5fY29tcGxldGVHZXRGZWF0dXJlSW5mbyA9IGZ1bmN0aW9uKGxheWVySWQsY29vcmRpbmF0ZSxkZWZlcnJlZCl7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIHZhciBwcm9qZWN0VHlwZSA9IFByb2plY3RTZXJ2aWNlLnN0YXRlLnByb2plY3QudHlwZTtcbiAgICBcbiAgICB2YXIgbWFwTGF5ZXIgPSB0aGlzLm1hcExheWVyc1t0aGlzLmxheWVyc0Fzc29jaWF0aW9uW2xheWVySWRdXTtcbiAgICB2YXIgcmVzb2x1dGlvbiA9IHNlbGYudmlld2VyLmdldFJlc29sdXRpb24oKTtcbiAgICB2YXIgZXBzZyA9IHNlbGYudmlld2VyLm1hcC5nZXRWaWV3KCkuZ2V0UHJvamVjdGlvbigpLmdldENvZGUoKTtcbiAgICB2YXIgcGFyYW1zID0ge1xuICAgICAgUVVFUllfTEFZRVJTOiBQcm9qZWN0U2VydmljZS5nZXRMYXllcihsYXllcklkKS5uYW1lLFxuICAgICAgSU5GT19GT1JNQVQ6IFwidGV4dC94bWxcIlxuICAgIH1cbiAgICBcbiAgICBpZiAocHJvamVjdFR5cGUgPT0gUHJvamVjdFR5cGVzLlFESkFOR08pe1xuICAgICAgdmFyIHRvbGVyYW5jZVBhcmFtcyA9IFBpY2tUb2xlcmFuY2VQYXJhbXNbcHJvamVjdFR5cGVdO1xuICAgICAgaWYgKHRvbGVyYW5jZVBhcmFtcyl7XG4gICAgICAgIHZhciBnZW9tZXRyeXR5cGUgPSBQcm9qZWN0U2VydmljZS5nZXRMYXllcihsYXllcklkKS5nZW9tZXRyeXR5cGU7XG4gICAgICAgIHBhcmFtc1t0b2xlcmFuY2VQYXJhbXNbZ2VvbWV0cnl0eXBlXV0gPSBQaWNrVG9sZXJhbmNlVmFsdWVzW2dlb21ldHJ5dHlwZV07XG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIHZhciBnZXRGZWF0dXJlSW5mb1VybCA9IG1hcExheWVyLmdldFNvdXJjZSgpLmdldEdldEZlYXR1cmVJbmZvVXJsKGNvb3JkaW5hdGUscmVzb2x1dGlvbixlcHNnLHBhcmFtcyk7XG4gICAgJC5nZXQoZ2V0RmVhdHVyZUluZm9VcmwpXG4gICAgLnRoZW4oZnVuY3Rpb24oZGF0YSl7XG4gICAgICB2YXIgeDJqcyA9IG5ldyBYMkpTKCk7XG4gICAgICB2YXIganNvbkRhdGEgPSB4MmpzLnhtbDJqc29uKGRhdGEpO1xuICAgICAgaWYgKGpzb25EYXRhLkdldEZlYXR1cmVJbmZvUmVzcG9uc2UuTGF5ZXIuRmVhdHVyZSl7XG4gICAgICAgIHZhciBhdHRyaWJ1dGVzID0ganNvbkRhdGEuR2V0RmVhdHVyZUluZm9SZXNwb25zZS5MYXllci5GZWF0dXJlLkF0dHJpYnV0ZTtcbiAgICAgICAgdmFyIGF0dHJpYnV0ZXNPYmogPSB7fTtcbiAgICAgICAgXy5mb3JFYWNoKGF0dHJpYnV0ZXMsZnVuY3Rpb24oYXR0cmlidXRlKXtcbiAgICAgICAgICBhdHRyaWJ1dGVzT2JqW2F0dHJpYnV0ZS5fbmFtZV0gPSBhdHRyaWJ1dGUuX3ZhbHVlOyAvLyBYMkpTIGFnZ2l1bmdlIFwiX1wiIGNvbWUgcHJlZmlzc28gZGVnbGkgYXR0cmlidXRpXG4gICAgICAgIH0pXG4gICAgICAgIFxuICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKGF0dHJpYnV0ZXNPYmopO1xuICAgICAgfVxuICAgICAgZGVmZXJyZWQucmVqZWN0KCk7O1xuICAgIH0pXG4gICAgLmZhaWwoZnVuY3Rpb24oKXtcbiAgICAgIGRlZmVycmVkLnJlamVjdCgpO1xuICAgIH0pXG4gICAgLmFsd2F5cyhmdW5jdGlvbigpe1xuICAgICAgLy9zZWxmLnZpZXdlci5tYXAucmVtb3ZlSW50ZXJhY3Rpb24oc2VsZi5fcGlja0ludGVyYWN0aW9uKTtcbiAgICAgIHNlbGYucG9wSW50ZXJhY3Rpb24oKTtcbiAgICAgIHNlbGYuX3BpY2tJbnRlcmFjdGlvbiA9IG51bGw7XG4gICAgfSlcbiAgfTtcbiAgXG4gIHRoaXMuaGlnaGxpZ2h0R2VvbWV0cnkgPSBmdW5jdGlvbihnZW9tZXRyeU9iaixvcHRpb25zKXsgICAgXG4gICAgdmFyIGdlb21ldHJ5O1xuICAgIGlmIChnZW9tZXRyeU9iaiBpbnN0YW5jZW9mIG9sLmdlb20uR2VvbWV0cnkpe1xuICAgICAgZ2VvbWV0cnkgPSBnZW9tZXRyeU9iajtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICBmb3JtYXQgPSBuZXcgb2wuZm9ybWF0Lkdlb0pTT047XG4gICAgICBnZW9tZXRyeSA9IGZvcm1hdC5yZWFkR2VvbWV0cnkoZ2VvbWV0cnlPYmopO1xuICAgIH1cbiAgICBcbiAgICBpZiAob3B0aW9ucy56b29tKSB7XG4gICAgICB0aGlzLnZpZXdlci5maXQoZ2VvbWV0cnkpO1xuICAgIH1cbiAgICBcbiAgICB2YXIgZHVyYXRpb24gPSBvcHRpb25zLmR1cmF0aW9uIHx8IDQwMDA7XG4gICAgXG4gICAgaWYgKG9wdGlvbnMuZnJvbVdHUzg0KSB7XG4gICAgICBnZW9tZXRyeS50cmFuc2Zvcm0oJ0VQU0c6NDMyNicsJ0VQU0c6JytQcm9qZWN0U2VydmljZS5zdGF0ZS5wcm9qZWN0LmNycyk7XG4gICAgfVxuICAgIFxuICAgIHZhciBmZWF0dXJlID0gbmV3IG9sLkZlYXR1cmUoe1xuICAgICAgZ2VvbWV0cnk6IGdlb21ldHJ5XG4gICAgfSk7XG4gICAgdmFyIHNvdXJjZSA9IG5ldyBvbC5zb3VyY2UuVmVjdG9yKCk7XG4gICAgc291cmNlLmFkZEZlYXR1cmVzKFtmZWF0dXJlXSk7XG4gICAgdmFyIGxheWVyID0gbmV3IG9sLmxheWVyLlZlY3Rvcih7XG4gICAgICBzb3VyY2U6IHNvdXJjZSxcbiAgICAgIHN0eWxlOiBmdW5jdGlvbihmZWF0dXJlKXtcbiAgICAgICAgdmFyIHN0eWxlcyA9IFtdO1xuICAgICAgICB2YXIgZ2VvbWV0cnlUeXBlID0gZmVhdHVyZS5nZXRHZW9tZXRyeSgpLmdldFR5cGUoKTtcbiAgICAgICAgaWYgKGdlb21ldHJ5VHlwZSA9PSAnTGluZVN0cmluZycpIHtcbiAgICAgICAgICB2YXIgc3R5bGUgPSBuZXcgb2wuc3R5bGUuU3R5bGUoe1xuICAgICAgICAgICAgc3Ryb2tlOiBuZXcgb2wuc3R5bGUuU3Ryb2tlKHtcbiAgICAgICAgICAgICAgY29sb3I6ICdyZ2IoMjU1LDI1NSwwKScsXG4gICAgICAgICAgICAgIHdpZHRoOiA0XG4gICAgICAgICAgICB9KVxuICAgICAgICAgIH0pXG4gICAgICAgICAgc3R5bGVzLnB1c2goc3R5bGUpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGdlb21ldHJ5VHlwZSA9PSAnUG9pbnQnKXtcbiAgICAgICAgICB2YXIgc3R5bGUgPSBuZXcgb2wuc3R5bGUuU3R5bGUoe1xuICAgICAgICAgICAgaW1hZ2U6IG5ldyBvbC5zdHlsZS5DaXJjbGUoe1xuICAgICAgICAgICAgICByYWRpdXM6IDYsXG4gICAgICAgICAgICAgIGZpbGw6IG5ldyBvbC5zdHlsZS5GaWxsKHtcbiAgICAgICAgICAgICAgICBjb2xvcjogJ3JnYigyNTUsMjU1LDApJyxcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgekluZGV4OiBJbmZpbml0eVxuICAgICAgICAgIH0pO1xuICAgICAgICAgIHN0eWxlcy5wdXNoKHN0eWxlKTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgcmV0dXJuIHN0eWxlcztcbiAgICAgIH1cbiAgICB9KVxuICAgIGxheWVyLnNldE1hcCh0aGlzLnZpZXdlci5tYXApO1xuICAgIFxuICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKXtcbiAgICAgIGxheWVyLnNldE1hcChudWxsKTtcbiAgICB9LGR1cmF0aW9uKTtcbiAgfTtcbiAgXG4gIHRoaXMucmVmcmVzaE1hcCA9IGZ1bmN0aW9uKCl7XG4gICAgXy5mb3JFYWNoKHRoaXMubWFwTGF5ZXJzLGZ1bmN0aW9uKHdtc0xheWVyKXtcbiAgICAgIHdtc0xheWVyLmdldExheWVyKCkuZ2V0U291cmNlKCkudXBkYXRlUGFyYW1zKHtcInRpbWVcIjogRGF0ZS5ub3coKX0pO1xuICAgIH0pXG4gIH07XG4gIFxuICBiYXNlKHRoaXMpO1xuICBcbiAgdGhpcy5fc2V0TWFwVmlldyA9IGZ1bmN0aW9uKCl7XG4gICAgdmFyIGJib3ggPSB0aGlzLnZpZXdlci5nZXRCQk9YKCk7XG4gICAgdmFyIHJlc29sdXRpb24gPSB0aGlzLnZpZXdlci5nZXRSZXNvbHV0aW9uKCk7XG4gICAgdmFyIGNlbnRlciA9IHRoaXMudmlld2VyLmdldENlbnRlcigpO1xuICAgIHRoaXMuc2V0TWFwVmlldyhiYm94LHJlc29sdXRpb24sY2VudGVyKTtcbiAgfTtcbn07XG5cbmluaGVyaXQoTWFwU2VydmljZSxHM1dPYmplY3QpO1xuXG5tb2R1bGUuZXhwb3J0cyA9IG5ldyBNYXBTZXJ2aWNlXG4iLCJ2YXIgaW5oZXJpdCA9IHJlcXVpcmUoJy4vdXRpbHMnKS5pbmhlcml0O1xudmFyIEczV09iamVjdCA9IHJlcXVpcmUoJ2czdy9jb3JlL2czd29iamVjdCcpO1xuXG5mdW5jdGlvbiBQbHVnaW4oKXtcbiAgdGhpcy5pZCA9IFwicGx1Z2luXCI7XG4gIHRoaXMudG9vbHMgPSBbXTtcbn1cbmluaGVyaXQoUGx1Z2luLEczV09iamVjdCk7XG5cbnZhciBwcm90byA9IFBsdWdpbi5wcm90b3R5cGU7XG5cbnByb3RvLnByb3ZpZGVzVG9vbHMgPSBmdW5jdGlvbigpe1xuICByZXR1cm4gdGhpcy50b29scy5sZW5ndGggPiAwO1xufTtcblxucHJvdG8uZ2V0VG9vbHMgPSBmdW5jdGlvbigpe1xuICByZXR1cm4gdGhpcy50b29scztcbn07XG5cbnByb3RvLmdldEFjdGlvbnMgPSBmdW5jdGlvbih0b29sKXtcbiAgcmV0dXJuIHRvb2wuYWN0aW9ucztcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gUGx1Z2luO1xuIiwidmFyIGJhc2UgPSByZXF1aXJlKCcuL3V0aWxzJykuYmFzZTtcbnZhciBpbmhlcml0ID0gcmVxdWlyZSgnLi91dGlscycpLmluaGVyaXQ7XG52YXIgRzNXT2JqZWN0ID0gcmVxdWlyZSgnZzN3L2NvcmUvZzN3b2JqZWN0Jyk7XG5cbnZhciBUb29sc1NlcnZpY2UgPSByZXF1aXJlKCdnM3cvY29yZS90b29sc3NlcnZpY2UnKTtcblxuZnVuY3Rpb24gUGx1Z2luc1JlZ2lzdHJ5KCl7XG4gIHZhciBzZWxmID0gdGhpcztcbiAgdGhpcy5jb25maWcgPSBudWxsO1xuICAvLyB1biBkb21hbmkgcXVlc3RvIHNhcsOgIGRpbmFtaWNvXG4gIHRoaXMucGx1Z2lucyA9IHt9O1xuICB0aGlzLnN0YXRlID0ge1xuICAgIHRvb2xzcHJvdmlkZXJzOiBbXVxuICB9O1xuICBcbiAgdGhpcy5zZXR0ZXJzID0ge1xuICAgIHNldFRvb2xzUHJvdmlkZXI6IGZ1bmN0aW9uKHBsdWdpbikge1xuICAgICAgc2VsZi5zdGF0ZS50b29sc3Byb3ZpZGVycy5wdXNoKHBsdWdpbik7XG4gICAgfVxuICB9XG4gIFxuICBiYXNlKHRoaXMpO1xuICBcbiAgdGhpcy5pbml0ID0gZnVuY3Rpb24oY29uZmlnKXtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgdGhpcy5jb25maWcgPSBjb25maWc7XG4gICAgXy5mb3JFYWNoKGNvbmZpZy5wbHVnaW5zLGZ1bmN0aW9uKHBsdWdpbil7XG4gICAgICBzZWxmLl9zZXR1cChwbHVnaW4pO1xuICAgIH0pXG4gIH07XG4gIFxuICAvLyBQZXIgcGVybWV0dGVyZSBsYSByZWdpc3RyYXppb25lIGFuY2hlIGluIHVuIHNlY29uZG8gbW9tZW50b1xuICB0aGlzLnJlZ2lzdGVyID0gZnVuY3Rpb24ocGx1Z2luKXtcbiAgICBpZiAoIXRoaXMucGx1Z2luc1twbHVnaW4ubmFtZV0pIHtcbiAgICAgIHRoaXMuX3NldHVwKHBsdWdpbik7XG4gICAgfVxuICB9O1xuICBcbiAgdGhpcy5fc2V0dXAgPSBmdW5jdGlvbihwbHVnaW4pIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgdmFyIHBsdWdpbkNvbmZpZyA9IHRoaXMuY29uZmlnLmNvbmZpZ3NbcGx1Z2luLm5hbWVdO1xuICAgIGlmIChwbHVnaW5Db25maWcpe1xuICAgICAgcGx1Z2luLmluaXQocGx1Z2luQ29uZmlnKTtcbiAgICAgIHNlbGYucGx1Z2luc1tuYW1lXSA9IHBsdWdpbjtcbiAgICB9XG4gIH07XG4gIFxuICB0aGlzLmFjdGl2YXRlID0gZnVuY3Rpb24ocGx1Z2luKSB7XG4gICAgdmFyIHRvb2xzID0gcGx1Z2luLmdldFRvb2xzKCk7XG4gICAgaWYgKHRvb2xzLmxlbmd0aCkge1xuICAgICAgVG9vbHNTZXJ2aWNlLnJlZ2lzdGVyVG9vbHNQcm92aWRlcihwbHVnaW4pO1xuICAgIH1cbiAgfTtcbn07XG5cbmluaGVyaXQoUGx1Z2luc1JlZ2lzdHJ5LEczV09iamVjdCk7XG5cbm1vZHVsZS5leHBvcnRzID0gbmV3IFBsdWdpbnNSZWdpc3RyeVxuIiwidmFyIGluaGVyaXQgPSByZXF1aXJlKCcuL3V0aWxzJykuaW5oZXJpdDtcbnZhciBiYXNlID0gcmVxdWlyZSgnLi91dGlscycpLmJhc2U7XG52YXIgRzNXT2JqZWN0ID0gcmVxdWlyZSgnLi9nM3dvYmplY3QnKTtcbnZhciBMYXllciA9IHJlcXVpcmUoJy4vbGF5ZXIuanMnKTtcblxudmFyIFByb2plY3RUeXBlcyA9IHtcbiAgUURKQU5HTzogJ3FkamFuZ28nLFxuICBPR1I6ICdvZ3InXG59O1xuXG52YXIgR2VvbWV0cnlUeXBlcyA9IHtcbiAgUE9JTlQ6IFwiUG9pbnRcIixcbiAgTElORVNUUklORzogXCJMaW5lXCIsXG4gIFBPTFlHT046IFwiUG9seWdvblwiXG59O1xuXG5mdW5jdGlvbiBQcm9qZWN0U2VydmljZSgpe1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIHRoaXMuY29uZmlnID0gbnVsbDtcbiAgdGhpcy5sYXllcnMgPSB7fTtcbiAgdGhpcy5zdGF0ZSA9IHtcbiAgICBwcm9qZWN0OiBudWxsLFxuICAgIGJhc2VMYXllcnM6IFtdXG4gIH07XG4gIFxuICB0aGlzLnNldHRlcnMgPSB7XG4gICAgc2V0TGF5ZXJzVmlzaWJsZTogZnVuY3Rpb24obGF5ZXJzLHZpc2libGUpe1xuICAgICAgXy5mb3JFYWNoKGxheWVycyxmdW5jdGlvbihsYXllcil7XG4gICAgICAgIHNlbGYubGF5ZXJzW2xheWVyLmlkXS52aXNpYmxlID0gdmlzaWJsZTtcbiAgICAgIH0pXG4gICAgfSxcbiAgICBzZXRCYXNlTGF5ZXI6IGZ1bmN0aW9uKGlkKXtcbiAgICAgIF8uZm9yRWFjaChzZWxmLnN0YXRlLmJhc2VMYXllcnMsZnVuY3Rpb24oYmFzZUxheWVyKXtcbiAgICAgICAgYmFzZUxheWVyLnZpc2libGUgPSAoYmFzZUxheWVyLmlkID09IGlkKTtcbiAgICAgIH0pXG4gICAgfVxuICB9O1xuICBcbiAgdGhpcy5pbml0ID0gZnVuY3Rpb24oY29uZmlnKXtcbiAgICB0aGlzLmNvbmZpZyA9IGNvbmZpZztcbiAgfTtcbiAgXG4gIC8vIGdlbmVyYSBsJ29nZ2V0dG8gbGF5ZXJzIChwZXIgcmlmZXJpbWVudG8pLCBwZXIgc2VtcGxpZmljYXJlIGdsaSBhZ2dpb3JuYW1lbnRpIGRlbGxvIHN0YXRvIGRlbCBsYXllcnN0cmVlXG4gIHRoaXMubWFrZUxheWVyc09iaiA9IGZ1bmN0aW9uKGxheWVyc3RyZWUpe1xuICAgIHRoaXMubGF5ZXJzID0ge307XG4gICAgZnVuY3Rpb24gdHJhdmVyc2Uob2JqKXtcbiAgICAgIF8uZm9ySW4ob2JqLCBmdW5jdGlvbiAobGF5ZXIsIGtleSkge1xuICAgICAgICAgICAgLy92ZXJpZmljYSBjaGUgaWwgdmFsb3JlIGRlbGwnaWQgbm9uIHNpYSBudWxsb1xuICAgICAgICAgICAgaWYgKCFfLmlzTmlsKGxheWVyLmlkKSkge1xuICAgICAgICAgICAgICAgIHNlbGYubGF5ZXJzW2xheWVyLmlkXSA9IGxheWVyO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCFfLmlzTmlsKGxheWVyLm5vZGVzKSkge1xuICAgICAgICAgICAgICAgIHRyYXZlcnNlKGxheWVyLm5vZGVzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgIHRyYXZlcnNlKGxheWVyc3RyZWUpO1xuICB9O1xuICBcbiAgdGhpcy5nZXRDdXJyZW50UHJvamVjdCA9IGZ1bmN0aW9uKCl7XG4gICAgcmV0dXJuIHRoaXMuc3RhdGUucHJvamVjdDtcbiAgfTtcbiAgXG4gIHRoaXMuc2V0UHJvamVjdCA9IGZ1bmN0aW9uKHByb2plY3QsZG9zd2l0Y2gpe1xuICAgIC8qIHN0cnV0dHVyYSBvZ2dldHRvICdwcm9qZWN0J1xuICAgIHtcbiAgICAgIGlkLFxuICAgICAgdHlwZSxcbiAgICAgIGdpZCxcbiAgICAgIG5hbWUsXG4gICAgICBjcnMsXG4gICAgICBleHRlbnQsXG4gICAgICBsYXllcnN0cmVlLFxuICAgICAgd2lkZ2V0c1xuICAgIH1cbiAgICAqL1xuICAgIHRoaXMuc3RhdGUucHJvamVjdCA9IHByb2plY3Q7XG4gICAgdGhpcy5zdGF0ZS5iYXNlTGF5ZXJzID0gcHJvamVjdC5iYXNlTGF5ZXJzO1xuICAgIHRoaXMubWFrZUxheWVyc09iaihwcm9qZWN0LmxheWVyc3RyZWUpO1xuICAgIHZhciBldmVudFR5cGUgPSAncHJvamVjdHNldCc7XG4gICAgaWYgKGRvc3dpdGNoICYmIGRvc3dpdGNoID09PSB0cnVlKSB7XG4gICAgICBldmVudFR5cGUgPSAncHJvamVjdHN3aXRjaCc7XG4gICAgfVxuICAgIHRoaXMuZW1pdChldmVudFR5cGUpO1xuICB9O1xuICBcbiAgdGhpcy5zd2l0Y2hQcm9qZWN0ID0gZnVuY3Rpb24ocHJvamVjdCkge1xuICAgIHRoaXMuc2V0UHJvamVjdChwcm9qZWN0LHRydWUpO1xuICB9O1xuICBcbiAgdGhpcy5nZXRMYXllciA9IGZ1bmN0aW9uKGlkKXtcbiAgICByZXR1cm4gdGhpcy5sYXllcnNbaWRdO1xuICB9O1xuICBcbiAgdGhpcy5nZXRMYXllcnMgPSBmdW5jdGlvbigpe1xuICAgIHJldHVybiB0aGlzLmxheWVycztcbiAgfTtcbiAgXG4gIHRoaXMuZ2V0TGF5ZXJCeUlkID0gZnVuY3Rpb24oaWQpIHtcbiAgICB2YXIgbGF5ZXIgPSBudWxsO1xuICAgIF8uZm9yRWFjaCh0aGlzLmdldExheWVycygpLGZ1bmN0aW9uKF9sYXllcil7XG4gICAgICBpZiAoX2xheWVyLmlkID09IGlkKXtcbiAgICAgICAgbGF5ZXIgPSBfbGF5ZXI7XG4gICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuIGxheWVyO1xuICB9O1xuICBcbiAgdGhpcy5nZXRMYXllckJ5TmFtZSA9IGZ1bmN0aW9uKG5hbWUpIHtcbiAgICB2YXIgbGF5ZXIgPSBudWxsO1xuICAgIF8uZm9yRWFjaCh0aGlzLmdldExheWVycygpLGZ1bmN0aW9uKF9sYXllcil7XG4gICAgICBpZiAoX2xheWVyLm5hbWUgPT0gbmFtZSl7XG4gICAgICAgIGxheWVyID0gX2xheWVyO1xuICAgICAgfVxuICAgIH0pO1xuICAgIHJldHVybiBsYXllcjtcbiAgfTtcbiAgXG4gIHRoaXMuZ2V0UXVlcnlhYmxlTGF5ZXJzID0gZnVuY3Rpb24oKXtcbiAgICB2YXIgcXVlcnlhYmxlTGF5ZXJzID0gW107XG4gICAgXy5mb3JFYWNoKHRoaXMuZ2V0TGF5ZXJzKCksZnVuY3Rpb24obGF5ZXIpe1xuICAgICAgaWYgKExheWVyLmlzUXVlcnlhYmxlKGxheWVyKSl7XG4gICAgICAgIHF1ZXJ5YWJsZUxheWVycy5wdXNoKGxheWVyKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4gcXVlcnlhYmxlTGF5ZXJzO1xuICB9O1xuICBcbiAgdGhpcy5nZXRMYXllckF0dHJpYnV0ZXMgPSBmdW5jdGlvbihpZCl7XG4gICAgcmV0dXJuIHRoaXMubGF5ZXJzW2lkXS5hdHRyaWJ1dGVzO1xuICB9O1xuICBcbiAgdGhpcy5nZXRMYXllckF0dHJpYnV0ZUxhYmVsID0gZnVuY3Rpb24oaWQsbmFtZSl7XG4gICAgdmFyIGxhYmVsID0gJyc7XG4gICAgXy5mb3JFYWNoKHRoaXMubGF5ZXJzW2lkXS5hdHRyaWJ1dGVzLGZ1bmN0aW9uKGF0dHJpYnV0ZSl7XG4gICAgICBpZiAoYXR0cmlidXRlLm5hbWUgPT0gbmFtZSl7XG4gICAgICAgIGxhYmVsID0gYXR0cmlidXRlLmxhYmVsO1xuICAgICAgfVxuICAgIH0pXG4gICAgcmV0dXJuIGxhYmVsO1xuICB9O1xuICBcbiAgdGhpcy50b2dnbGVMYXllciA9IGZ1bmN0aW9uKGxheWVyLHZpc2libGUpe1xuICAgIHZhciB2aXNpYmxlID0gdmlzaWJsZSB8fCAhbGF5ZXIudmlzaWJsZTtcbiAgICBzZWxmLnNldExheWVyc1Zpc2libGUoW2xheWVyXSx2aXNpYmxlKTtcbiAgfTtcbiAgXG4gIHRoaXMudG9nZ2xlTGF5ZXJzID0gZnVuY3Rpb24obGF5ZXJzLHZpc2libGUpe1xuICAgIHNlbGYuc2V0TGF5ZXJzVmlzaWJsZShsYXllcnMsdmlzaWJsZSk7XG4gIH07XG4gIFxuICB0aGlzLmdldFdtc1VybCA9IGZ1bmN0aW9uKCl7XG4gICAgcmV0dXJuIHRoaXMuY29uZmlnLmdldFdtc1VybCh0aGlzLnN0YXRlLnByb2plY3QpO1xuICB9O1xuICBcbiAgdGhpcy5nZXRMZWdlbmRVcmwgPSBmdW5jdGlvbihsYXllcil7XG4gICAgdmFyIHVybCA9IHRoaXMuZ2V0V21zVXJsKHRoaXMuc3RhdGUpO1xuICAgIHNlcCA9ICh1cmwuaW5kZXhPZignPycpID4gLTEpID8gJyYnIDogJz8nO1xuICAgIHJldHVybiB0aGlzLmdldFdtc1VybCh0aGlzLnN0YXRlKStzZXArJ1NFUlZJQ0U9V01TJlZFUlNJT049MS4zLjAmUkVRVUVTVD1HZXRMZWdlbmRHcmFwaGljJlNMRF9WRVJTSU9OPTEuMS4wJkZPUk1BVD1pbWFnZS9wbmcmTEFZRVJUSVRMRT1GYWxzZSZJVEVNRk9OVFNJWkU9MTAmTEFZRVI9JytsYXllci5uYW1lO1xuICB9O1xuICBcbiAgYmFzZSh0aGlzKTtcbn07XG5cbmluaGVyaXQoUHJvamVjdFNlcnZpY2UsRzNXT2JqZWN0KTtcblxubW9kdWxlLmV4cG9ydHMgPSB7XG4gIFByb2plY3RTZXJ2aWNlOiBuZXcgUHJvamVjdFNlcnZpY2UsXG4gIFByb2plY3RUeXBlczogUHJvamVjdFR5cGVzLFxuICBHZW9tZXRyeVR5cGVzOiBHZW9tZXRyeVR5cGVzXG59O1xuIiwidmFyIGluaGVyaXQgPSByZXF1aXJlKCcuL3V0aWxzJykuaW5oZXJpdDtcbnZhciBiYXNlID0gcmVxdWlyZSgnZzN3L2NvcmUvdXRpbHMnKS5iYXNlO1xudmFyIEczV09iamVjdCA9IHJlcXVpcmUoJ2czdy9jb3JlL2czd29iamVjdCcpO1xudmFyIHJlc29sdmVkVmFsdWUgPSByZXF1aXJlKCcuL3V0aWxzJykucmVzb2x2ZWRWYWx1ZTtcbnZhciByZWplY3RlZFZhbHVlID0gcmVxdWlyZSgnLi91dGlscycpLnJlamVjdGVkVmFsdWU7XG52YXIgUHJvamVjdFNlcnZpY2UgPSByZXF1aXJlKCcuL3Byb2plY3RzZXJ2aWNlJykuUHJvamVjdFNlcnZpY2U7XG5cbi8qIHNlcnZpY2VcbkZ1bnppb25lIGNvc3RydXR0b3JlIGNvbnRlbnRlbnRlIHRyZSBwcm9wcmlldGEnOlxuICAgIHNldHVwOiBtZXRvZG8gZGkgaW5pemlhbGl6emF6aW9uZVxuICAgIGdldExheWVyc1N0YXRlOiByaXRvcm5hIGwnb2dnZXR0byBMYXllcnNTdGF0ZVxuICAgIGdldExheWVyc1RyZWU6IHJpdG9ybmEgbCdhcnJheSBsYXllcnNUcmVlIGRhbGwnb2dnZXR0byBMYXllcnNTdGF0ZVxuKi9cblxuLy8gUHVibGljIGludGVyZmFjZVxuZnVuY3Rpb24gUHJvamVjdHNSZWdpc3RyeSgpe1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIHRoaXMuY29uZmlnID0gbnVsbDtcbiAgdGhpcy5pbml0aWFsaXplZCA9IGZhbHNlO1xuICBcbiAgdGhpcy5zZXR0ZXJzID0ge1xuICAgIHNldEN1cnJlbnRQcm9qZWN0OiBmdW5jdGlvbihwcm9qZWN0KXtcbiAgICAgIHRoaXMuc3RhdGUuY3VycmVudFByb2plY3QgPSBwcm9qZWN0O1xuICAgIH1cbiAgfTtcbiAgXG4gIHRoaXMuc3RhdGUgPSB7XG4gICAgYmFzZUxheWVyczoge30sXG4gICAgbWluU2NhbGU6IG51bGwsXG4gICAgbWF4c2NhbGU6IG51bGwsXG4gICAgcHJvamVjdHM6IFtdLFxuICAgIGN1cnJlbnRQcm9qZWN0OiBudWxsXG4gIH1cbiAgXG4gIGJhc2UodGhpcyk7XG59XG5pbmhlcml0KFByb2plY3RzUmVnaXN0cnksRzNXT2JqZWN0KTtcblxudmFyIHByb3RvID0gUHJvamVjdHNSZWdpc3RyeS5wcm90b3R5cGU7XG5cbnByb3RvLmluaXQgPSBmdW5jdGlvbihjb25maWcpe1xuICBpZiAoIXRoaXMuaW5pdGlhbGl6ZWQpe1xuICAgIHRoaXMuaW5pdGlhbGl6ZWQgPSB0cnVlO1xuICAgIHRoaXMuY29uZmlnID0gY29uZmlnO1xuICAgIHRoaXMuc2V0dXBTdGF0ZSgpO1xuICAgIFByb2plY3RTZXJ2aWNlLmluaXQoY29uZmlnKTtcbiAgICByZXR1cm4gdGhpcy5zZXRQcm9qZWN0KGNvbmZpZy5pbml0cHJvamVjdCk7XG4gIH1cbn07XG4gIFxucHJvdG8uc2V0dXBTdGF0ZSA9IGZ1bmN0aW9uKCl7XG4gIHZhciBzZWxmID0gdGhpcztcbiAgXG4gIHNlbGYuc3RhdGUuYmFzZUxheWVycyA9IHNlbGYuY29uZmlnLmJhc2VsYXllcnM7XG4gIHNlbGYuc3RhdGUubWluU2NhbGUgPSBzZWxmLmNvbmZpZy5taW5zY2FsZTtcbiAgc2VsZi5zdGF0ZS5tYXhTY2FsZSA9IHNlbGYuY29uZmlnLm1heHNjYWxlO1xuICBzZWxmLnN0YXRlLmNycyA9IHNlbGYuY29uZmlnLmNycztcbiAgc2VsZi5jb25maWcucHJvamVjdHMuZm9yRWFjaChmdW5jdGlvbihwcm9qZWN0KXtcbiAgICBwcm9qZWN0LmJhc2VMYXllcnMgPSBzZWxmLmNvbmZpZy5iYXNlbGF5ZXJzO1xuICAgIHByb2plY3QubWluU2NhbGUgPSBzZWxmLmNvbmZpZy5taW5zY2FsZTtcbiAgICBwcm9qZWN0Lm1heFNjYWxlID0gc2VsZi5jb25maWcubWF4c2NhbGU7XG4gICAgcHJvamVjdC5jcnMgPSBzZWxmLmNvbmZpZy5jcnM7XG4gICAgc2VsZi5zdGF0ZS5wcm9qZWN0cy5wdXNoKHByb2plY3QpO1xuICB9KVxuICAvL3RoaXMuc3RhdGUucHJvamVjdHMgPSBjb25maWcuZ3JvdXAucHJvamVjdHM7XG59O1xuXG5wcm90by5nZXRDdXJyZW50UHJvamVjdCA9IGZ1bmN0aW9uKCl7XG4gIHJldHVybiB0aGlzLnN0YXRlLmN1cnJlbnRQcm9qZWN0O1xufTtcbiAgXG5wcm90by5zZXRQcm9qZWN0ID0gZnVuY3Rpb24ocHJvamVjdEdpZCl7XG4gIHZhciBzZWxmID0gdGhpcztcbiAgcmV0dXJuIHRoaXMuZ2V0UHJvamVjdChwcm9qZWN0R2lkKS5cbiAgdGhlbihmdW5jdGlvbihwcm9qZWN0KXtcbiAgICBQcm9qZWN0U2VydmljZS5zZXRQcm9qZWN0KHByb2plY3QpO1xuICAgIHNlbGYuc2V0Q3VycmVudFByb2plY3QocHJvamVjdCk7XG4gIH0pXG59O1xuICBcbnByb3RvLnN3aXRjaFByb2plY3QgPSBmdW5jdGlvbihwcm9qZWN0R2lkKSB7XG4gIHZhciBzZWxmID0gdGhpcztcbiAgcmV0dXJuIHRoaXMuZ2V0UHJvamVjdChwcm9qZWN0R2lkKS5cbiAgdGhlbihmdW5jdGlvbihwcm9qZWN0KXtcbiAgICBQcm9qZWN0U2VydmljZS5zd2l0Y2hQcm9qZWN0KHByb2plY3QpO1xuICAgIHNlbGYuc2V0Q3VycmVudFByb2plY3QocHJvamVjdCk7XG4gIH0pXG59O1xuICBcbnByb3RvLmJ1aWxkUHJvamVjdFRyZWUgPSBmdW5jdGlvbihwcm9qZWN0KXtcbiAgdmFyIGxheWVycyA9IF8ua2V5QnkocHJvamVjdC5sYXllcnMsJ2lkJyk7XG4gIHZhciBsYXllcnNUcmVlID0gXy5jbG9uZURlZXAocHJvamVjdC5sYXllcnN0cmVlKTtcbiAgXG4gIGZ1bmN0aW9uIHRyYXZlcnNlKG9iail7XG4gICAgXy5mb3JJbihvYmosIGZ1bmN0aW9uIChsYXllciwga2V5KSB7XG4gICAgICAgIC8vdmVyaWZpY2EgY2hlIGlsIG5vZG8gc2lhIHVuIGxheWVyIGUgbm9uIHVuIGZvbGRlclxuICAgICAgICBpZiAoIV8uaXNOaWwobGF5ZXIuaWQpKSB7XG4gICAgICAgICAgICB2YXIgZnVsbGxheWVyID0gXy5tZXJnZShsYXllcixsYXllcnNbbGF5ZXIuaWRdKTtcbiAgICAgICAgICAgIG9ialtwYXJzZUludChrZXkpXSA9IGZ1bGxsYXllcjtcbiAgICAgICAgICAgIHZhciBhID0xO1xuICAgICAgICB9XG4gICAgICAgIGlmICghXy5pc05pbChsYXllci5ub2Rlcykpe1xuICAgICAgICAgIC8vIGFnZ2l1bmdvIHByb3ByaWV0w6AgdGl0bGUgcGVyIGwnYWxiZXJvXG4gICAgICAgICAgbGF5ZXIudGl0bGUgPSBsYXllci5uYW1lO1xuICAgICAgICAgIHRyYXZlcnNlKGxheWVyLm5vZGVzKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfTtcbiAgdHJhdmVyc2UobGF5ZXJzVHJlZSk7XG4gIHByb2plY3QubGF5ZXJzdHJlZSA9IGxheWVyc1RyZWU7XG59O1xuXG5wcm90by5nZXRQcm9qZWN0ID0gZnVuY3Rpb24ocHJvamVjdEdpZCl7XG4gIHZhciBzZWxmID0gdGhpcztcbiAgdmFyIGQgPSAkLkRlZmVycmVkKCk7XG4gIHZhciBwcm9qZWN0ID0gbnVsbDtcbiAgdGhpcy5zdGF0ZS5wcm9qZWN0cy5mb3JFYWNoKGZ1bmN0aW9uKF9wcm9qZWN0KXtcbiAgICBpZiAoX3Byb2plY3QuZ2lkID09IHByb2plY3RHaWQpIHtcbiAgICAgIHByb2plY3QgPSBfcHJvamVjdDtcbiAgICB9XG4gIH0pXG4gIGlmICghcHJvamVjdCkge1xuICAgIHJldHVybiByZWplY3RlZFZhbHVlKFwiUHJvamVjdCBkb2Vzbid0IGV4aXN0XCIpO1xuICB9XG5cbiAgdmFyIGlzRnVsbEZpbGxlZCA9ICFfLmlzTmlsKHByb2plY3QubGF5ZXJzKTtcbiAgaWYgKGlzRnVsbEZpbGxlZCl7XG4gICAgcmV0dXJuIGQucmVzb2x2ZShwcm9qZWN0KTtcbiAgfVxuICBlbHNle1xuICAgIHJldHVybiB0aGlzLmdldFByb2plY3RGdWxsQ29uZmlnKHByb2plY3QpXG4gICAgLnRoZW4oZnVuY3Rpb24ocHJvamVjdEZ1bGxDb25maWcpe1xuICAgICAgcHJvamVjdCA9IF8ubWVyZ2UocHJvamVjdCxwcm9qZWN0RnVsbENvbmZpZyk7XG4gICAgICBzZWxmLmJ1aWxkUHJvamVjdFRyZWUocHJvamVjdCk7XG4gICAgICByZXR1cm4gZC5yZXNvbHZlKHByb2plY3QpO1xuICAgIH0pO1xuICB9XG4gIFxuICByZXR1cm4gZC5wcm9taXNlKCk7XG59O1xuICBcbiAgLy9yaXRvcm5hIHVuYSBwcm9taXNlc1xucHJvdG8uZ2V0UHJvamVjdEZ1bGxDb25maWcgPSBmdW5jdGlvbihwcm9qZWN0QmFzZUNvbmZpZyl7XG4gIHZhciBzZWxmID0gdGhpcztcbiAgdmFyIGRlZmVycmVkID0gJC5EZWZlcnJlZCgpO1xuICB2YXIgdXJsID0gdGhpcy5jb25maWcuZ2V0UHJvamVjdENvbmZpZ1VybChwcm9qZWN0QmFzZUNvbmZpZyk7XG4gICQuZ2V0KHVybCkuZG9uZShmdW5jdGlvbihwcm9qZWN0RnVsbENvbmZpZyl7XG4gICAgICBkZWZlcnJlZC5yZXNvbHZlKHByb2plY3RGdWxsQ29uZmlnKTtcbiAgfSlcbiAgcmV0dXJuIGRlZmVycmVkLnByb21pc2UoKTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gbmV3IFByb2plY3RzUmVnaXN0cnkoKTtcbiIsInZhciBpbmhlcml0ID0gcmVxdWlyZSgnZzN3L2NvcmUvdXRpbHMnKS5pbmhlcml0O1xudmFyIGJhc2UgPSByZXF1aXJlKCdnM3cvY29yZS91dGlscycpLmJhc2U7XG52YXIgRzNXT2JqZWN0ID0gcmVxdWlyZSgnZzN3L2NvcmUvZzN3b2JqZWN0Jyk7XG5cbnZhciBSb3V0ZXJTZXJ2aWNlID0gZnVuY3Rpb24oKXtcbiAgdGhpcy5fcm91dGUgPSAnJztcbiAgdGhpcy5zZXR0ZXJzID0ge1xuICAgIHNldFJvdXRlOiBmdW5jdGlvbihwYXRoKXtcbiAgICAgIHRoaXMuX3JvdXRlID0gcGF0aDtcbiAgICB9XG4gIH1cbiAgYmFzZSh0aGlzKTtcbn07XG5pbmhlcml0KFJvdXRlclNlcnZpY2UsRzNXT2JqZWN0KTtcblxudmFyIHByb3RvID0gUm91dGVyU2VydmljZS5wcm90b3R5cGU7XG5cbnByb3RvLmdvdG8gPSBmdW5jdGlvbihwYXRoKXtcbiAgdGhpcy5zZXRSb3V0ZShwYXRoKTtcbn07XG5cbnByb3RvLnNsaWNlUGF0aCA9IGZ1bmN0aW9uKHBhdGgpe1xuICByZXR1cm4gcGF0aC5zcGxpdCgnPycpWzBdLnNwbGl0KCcvJyk7XG59O1xuICBcbnByb3RvLnNsaWNlRmlyc3QgPSBmdW5jdGlvbihwYXRoKXtcbiAgICB2YXIgcGF0aEFuZFF1ZXJ5ID0gcGF0aC5zcGxpdCgnPycpO1xuICAgIHZhciBxdWVyeVN0cmluZyA9IHBhdGhBbmRRdWVyeVsxXTtcbiAgICB2YXIgcGF0aEFyciA9IHBhdGhBbmRRdWVyeVswXS5zcGxpdCgnLycpXG4gICAgdmFyIGZpcnN0UGF0aCA9IHBhdGhBcnJbMF07XG4gICAgcGF0aCA9IHBhdGhBcnIuc2xpY2UoMSkuam9pbignLycpO1xuICAgIHBhdGggPSBbcGF0aCxxdWVyeVN0cmluZ10uam9pbignPycpXG4gICAgcmV0dXJuIFtmaXJzdFBhdGgscGF0aF07XG4gIH07XG4gIFxucHJvdG8uZ2V0UXVlcnlQYXJhbXMgPSBmdW5jdGlvbihwYXRoKXtcbiAgICB2YXIgcXVlcnlTdHJpbmcgPSBwYXRoLnNwbGl0KCc/JylbMV07XG4gICAgdmFyIHF1ZXJ5UGFpcnMgPSBxdWVyeVN0cmluZy5zcGxpdCgnJicpO1xuICAgIHZhciBxdWVyeVBhcmFtcyA9IHt9O1xuICAgIF8uZm9yRWFjaChxdWVyeVBhaXJzLGZ1bmN0aW9uKHF1ZXJ5UGFpcil7XG4gICAgICB2YXIgcGFpciA9IHF1ZXJ5UGFpci5zcGxpdCgnPScpO1xuICAgICAgdmFyIGtleSA9IHBhaXJbMF07XG4gICAgICB2YXIgdmFsdWUgPSBwYWlyWzFdO1xuICAgICAgcXVlcnlQYXJhbXNba2V5XSA9IHZhbHVlO1xuICAgIH0pO1xuICAgIHJldHVybiBxdWVyeVBhcmFtcztcbiAgfTtcbiAgXG5wcm90by5tYWtlUXVlcnlTdHJpbmcgPSBmdW5jdGlvbihxdWVyeVBhcmFtcyl7fTtcblxubW9kdWxlLmV4cG9ydHMgPSBuZXcgUm91dGVyU2VydmljZTtcbiIsInZhciBpbmhlcml0ID0gcmVxdWlyZSgnLi91dGlscycpLmluaGVyaXQ7XG52YXIgRzNXT2JqZWN0ID0gcmVxdWlyZSgnZzN3L2NvcmUvZzN3b2JqZWN0Jyk7XG5cbmZ1bmN0aW9uIFRvb2xzU2VydmljZSgpe1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIHRoaXMuY29uZmlnID0gbnVsbDtcbiAgdGhpcy5fYWN0aW9ucyA9IHt9O1xuICB0aGlzLnN0YXRlID0ge1xuICAgIHRvb2xzOiBbXVxuICB9O1xuICBcbiAgdGhpcy5pbml0ID0gZnVuY3Rpb24oY29uZmlnKXtcbiAgICB0aGlzLmNvbmZpZyA9IGNvbmZpZztcbiAgICB0aGlzLnNldFN0YXRlKCk7XG4gIH07XG4gIFxuICB0aGlzLnNldFN0YXRlID0gZnVuY3Rpb24oKXtcbiAgICB0aGlzLl9tZXJnZVRvb2xzKHRoaXMuY29uZmlnLnRvb2xzKTtcbiAgfTtcbiAgXG4gIHRoaXMucmVnaXN0ZXJUb29sc1Byb3ZpZGVyID0gZnVuY3Rpb24ocGx1Z2luKXtcbiAgICBzZWxmLl9tZXJnZVRvb2xzKHBsdWdpbi5nZXRUb29scygpKTtcbiAgICBzZWxmLl9hZGRBY3Rpb25zKHBsdWdpbik7XG4gIH1cbiAgXG4gIHRoaXMuZmlyZUFjdGlvbiA9IGZ1bmN0aW9uKGFjdGlvbmlkKXtcbiAgICB2YXIgcGx1Z2luID0gdGhpcy5fYWN0aW9uc1thY3Rpb25pZF07XG4gICAgdmFyIG1ldGhvZCA9IHRoaXMuX2FjdGlvbk1ldGhvZChhY3Rpb25pZCk7XG4gICAgcGx1Z2luW21ldGhvZF0oKTtcbiAgfTtcbiAgXG4gIHRoaXMuX2FjdGlvbk1ldGhvZCA9IGZ1bmN0aW9uKGFjdGlvbmlkKXtcbiAgICB2YXIgbmFtZXNwYWNlID0gYWN0aW9uaWQuc3BsaXQoXCI6XCIpO1xuICAgIHJldHVybiBuYW1lc3BhY2UucG9wKCk7XG4gIH07XG4gIFxuICB0aGlzLl9tZXJnZVRvb2xzID0gZnVuY3Rpb24odG9vbHMpe1xuICAgIHNlbGYuc3RhdGUudG9vbHMgPSBfLmNvbmNhdChzZWxmLnN0YXRlLnRvb2xzLHRvb2xzKTtcbiAgfTtcbiAgXG4gIHRoaXMuX2FkZEFjdGlvbnMgPSBmdW5jdGlvbihwbHVnaW4pe1xuICAgIF8uZm9yRWFjaChwbHVnaW4uZ2V0VG9vbHMoKSxmdW5jdGlvbih0b29sKXtcbiAgICAgIF8uZm9yRWFjaChwbHVnaW4uZ2V0QWN0aW9ucyh0b29sKSxmdW5jdGlvbihhY3Rpb24pe1xuICAgICAgICBzZWxmLl9hY3Rpb25zW2FjdGlvbi5pZF0gPSBwbHVnaW47XG4gICAgICB9KVxuICAgIH0pXG4gIH07XG59O1xuXG4vLyBNYWtlIHRoZSBwdWJsaWMgc2VydmljZSBlbiBFdmVudCBFbWl0dGVyXG5pbmhlcml0KFRvb2xzU2VydmljZSxHM1dPYmplY3QpO1xuXG5tb2R1bGUuZXhwb3J0cyA9IG5ldyBUb29sc1NlcnZpY2VcbiIsIlxuLyoqXG4gKiBEZWNpbWFsIGFkanVzdG1lbnQgb2YgYSBudW1iZXIuXG4gKlxuICogQHBhcmFtIHtTdHJpbmd9ICB0eXBlICBUaGUgdHlwZSBvZiBhZGp1c3RtZW50LlxuICogQHBhcmFtIHtOdW1iZXJ9ICB2YWx1ZSBUaGUgbnVtYmVyLlxuICogQHBhcmFtIHtJbnRlZ2VyfSBleHAgICBUaGUgZXhwb25lbnQgKHRoZSAxMCBsb2dhcml0aG0gb2YgdGhlIGFkanVzdG1lbnQgYmFzZSkuXG4gKiBAcmV0dXJucyB7TnVtYmVyfSBUaGUgYWRqdXN0ZWQgdmFsdWUuXG4gKi9cbmZ1bmN0aW9uIGRlY2ltYWxBZGp1c3QodHlwZSwgdmFsdWUsIGV4cCkge1xuICAvLyBJZiB0aGUgZXhwIGlzIHVuZGVmaW5lZCBvciB6ZXJvLi4uXG4gIGlmICh0eXBlb2YgZXhwID09PSAndW5kZWZpbmVkJyB8fCArZXhwID09PSAwKSB7XG4gICAgcmV0dXJuIE1hdGhbdHlwZV0odmFsdWUpO1xuICB9XG4gIHZhbHVlID0gK3ZhbHVlO1xuICBleHAgPSArZXhwO1xuICAvLyBJZiB0aGUgdmFsdWUgaXMgbm90IGEgbnVtYmVyIG9yIHRoZSBleHAgaXMgbm90IGFuIGludGVnZXIuLi5cbiAgaWYgKGlzTmFOKHZhbHVlKSB8fCAhKHR5cGVvZiBleHAgPT09ICdudW1iZXInICYmIGV4cCAlIDEgPT09IDApKSB7XG4gICAgcmV0dXJuIE5hTjtcbiAgfVxuICAvLyBTaGlmdFxuICB2YWx1ZSA9IHZhbHVlLnRvU3RyaW5nKCkuc3BsaXQoJ2UnKTtcbiAgdmFsdWUgPSBNYXRoW3R5cGVdKCsodmFsdWVbMF0gKyAnZScgKyAodmFsdWVbMV0gPyAoK3ZhbHVlWzFdIC0gZXhwKSA6IC1leHApKSk7XG4gIC8vIFNoaWZ0IGJhY2tcbiAgdmFsdWUgPSB2YWx1ZS50b1N0cmluZygpLnNwbGl0KCdlJyk7XG4gIHJldHVybiArKHZhbHVlWzBdICsgJ2UnICsgKHZhbHVlWzFdID8gKCt2YWx1ZVsxXSArIGV4cCkgOiBleHApKTtcbn1cblxuLy8gRGVjaW1hbCByb3VuZFxuaWYgKCFNYXRoLnJvdW5kMTApIHtcbiAgTWF0aC5yb3VuZDEwID0gZnVuY3Rpb24odmFsdWUsIGV4cCkge1xuICAgIHJldHVybiBkZWNpbWFsQWRqdXN0KCdyb3VuZCcsIHZhbHVlLCBleHApO1xuICB9O1xufVxuLy8gRGVjaW1hbCBmbG9vclxuaWYgKCFNYXRoLmZsb29yMTApIHtcbiAgTWF0aC5mbG9vcjEwID0gZnVuY3Rpb24odmFsdWUsIGV4cCkge1xuICAgIHJldHVybiBkZWNpbWFsQWRqdXN0KCdmbG9vcicsIHZhbHVlLCBleHApO1xuICB9O1xufVxuLy8gRGVjaW1hbCBjZWlsXG5pZiAoIU1hdGguY2VpbDEwKSB7XG4gIE1hdGguY2VpbDEwID0gZnVuY3Rpb24odmFsdWUsIGV4cCkge1xuICAgIHJldHVybiBkZWNpbWFsQWRqdXN0KCdjZWlsJywgdmFsdWUsIGV4cCk7XG4gIH07XG59XG5cblN0cmluZy5wcm90b3R5cGUuaGFzaENvZGUgPSBmdW5jdGlvbigpIHtcbiAgdmFyIGhhc2ggPSAwLCBpLCBjaHIsIGxlbjtcbiAgaWYgKHRoaXMubGVuZ3RoID09PSAwKSByZXR1cm4gaGFzaDtcbiAgZm9yIChpID0gMCwgbGVuID0gdGhpcy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgIGNociAgID0gdGhpcy5jaGFyQ29kZUF0KGkpO1xuICAgIGhhc2ggID0gKChoYXNoIDw8IDUpIC0gaGFzaCkgKyBjaHI7XG4gICAgaGFzaCB8PSAwO1xuICB9XG4gIHJldHVybiBoYXNoO1xufTtcblxudmFyIHV0aWxzID0ge1xuICBtaXhpbjogZnVuY3Rpb24gbWl4aW4oZGVzdGluYXRpb24sIHNvdXJjZSkge1xuICAgICAgcmV0dXJuIHV0aWxzLm1lcmdlKGRlc3RpbmF0aW9uLnByb3RvdHlwZSwgc291cmNlKTtcbiAgfSxcbiAgXG4gIG1peGluaW5zdGFuY2U6IGZ1bmN0aW9uIG1peGluaW5zdGFuY2UoZGVzdGluYXRpb24sc291cmNlKXtcbiAgICAgIHZhciBzb3VyY2VJbnN0YW5jZSA9IG5ldyBzb3VyY2U7XG4gICAgICB1dGlscy5tZXJnZShkZXN0aW5hdGlvbiwgc291cmNlSW5zdGFuY2UpO1xuICAgICAgdXRpbHMubWVyZ2UoZGVzdGluYXRpb24ucHJvdG90eXBlLCBzb3VyY2UucHJvdG90eXBlKTtcbiAgfSxcblxuXG4gIG1lcmdlOiBmdW5jdGlvbiBtZXJnZShkZXN0aW5hdGlvbiwgc291cmNlKSB7XG4gICAgICB2YXIga2V5O1xuXG4gICAgICBmb3IgKGtleSBpbiBzb3VyY2UpIHtcbiAgICAgICAgICBpZiAodXRpbHMuaGFzT3duKHNvdXJjZSwga2V5KSkge1xuICAgICAgICAgICAgICBkZXN0aW5hdGlvbltrZXldID0gc291cmNlW2tleV07XG4gICAgICAgICAgfVxuICAgICAgfVxuICB9LFxuXG4gIGhhc093bjogZnVuY3Rpb24gaGFzT3duKG9iamVjdCwga2V5KSB7XG4gICAgICByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwga2V5KTtcbiAgfSxcbiAgXG4gIGluaGVyaXQ6ZnVuY3Rpb24oY2hpbGRDdG9yLCBwYXJlbnRDdG9yKSB7XG4gICAgZnVuY3Rpb24gdGVtcEN0b3IoKSB7fTtcbiAgICB0ZW1wQ3Rvci5wcm90b3R5cGUgPSBwYXJlbnRDdG9yLnByb3RvdHlwZTtcbiAgICBjaGlsZEN0b3Iuc3VwZXJDbGFzc18gPSBwYXJlbnRDdG9yLnByb3RvdHlwZTtcbiAgICBjaGlsZEN0b3IucHJvdG90eXBlID0gbmV3IHRlbXBDdG9yKCk7XG4gICAgY2hpbGRDdG9yLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IGNoaWxkQ3RvcjtcbiAgfSxcbiAgXG4gIGJhc2U6IGZ1bmN0aW9uKG1lLCBvcHRfbWV0aG9kTmFtZSwgdmFyX2FyZ3MpIHtcbiAgICB2YXIgY2FsbGVyID0gYXJndW1lbnRzLmNhbGxlZS5jYWxsZXI7XG4gICAgaWYgKGNhbGxlci5zdXBlckNsYXNzXykge1xuICAgICAgLy8gVGhpcyBpcyBhIGNvbnN0cnVjdG9yLiBDYWxsIHRoZSBzdXBlcmNsYXNzIGNvbnN0cnVjdG9yLlxuICAgICAgcmV0dXJuIGNhbGxlci5zdXBlckNsYXNzXy5jb25zdHJ1Y3Rvci5hcHBseShcbiAgICAgICAgICBtZSwgQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKSk7XG4gICAgfVxuXG4gICAgdmFyIGFyZ3MgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDIpO1xuICAgIHZhciBmb3VuZENhbGxlciA9IGZhbHNlO1xuICAgIGZvciAodmFyIGN0b3IgPSBtZS5jb25zdHJ1Y3RvcjtcbiAgICAgICAgIGN0b3I7IGN0b3IgPSBjdG9yLnN1cGVyQ2xhc3NfICYmIGN0b3Iuc3VwZXJDbGFzc18uY29uc3RydWN0b3IpIHtcbiAgICAgIGlmIChjdG9yLnByb3RvdHlwZVtvcHRfbWV0aG9kTmFtZV0gPT09IGNhbGxlcikge1xuICAgICAgICBmb3VuZENhbGxlciA9IHRydWU7XG4gICAgICB9IGVsc2UgaWYgKGZvdW5kQ2FsbGVyKSB7XG4gICAgICAgIHJldHVybiBjdG9yLnByb3RvdHlwZVtvcHRfbWV0aG9kTmFtZV0uYXBwbHkobWUsIGFyZ3MpO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIElmIHdlIGRpZCBub3QgZmluZCB0aGUgY2FsbGVyIGluIHRoZSBwcm90b3R5cGUgY2hhaW4sXG4gICAgLy8gdGhlbiBvbmUgb2YgdHdvIHRoaW5ncyBoYXBwZW5lZDpcbiAgICAvLyAxKSBUaGUgY2FsbGVyIGlzIGFuIGluc3RhbmNlIG1ldGhvZC5cbiAgICAvLyAyKSBUaGlzIG1ldGhvZCB3YXMgbm90IGNhbGxlZCBieSB0aGUgcmlnaHQgY2FsbGVyLlxuICAgIGlmIChtZVtvcHRfbWV0aG9kTmFtZV0gPT09IGNhbGxlcikge1xuICAgICAgcmV0dXJuIG1lLmNvbnN0cnVjdG9yLnByb3RvdHlwZVtvcHRfbWV0aG9kTmFtZV0uYXBwbHkobWUsIGFyZ3MpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyBFcnJvcihcbiAgICAgICAgICAnYmFzZSBjYWxsZWQgZnJvbSBhIG1ldGhvZCBvZiBvbmUgbmFtZSAnICtcbiAgICAgICAgICAndG8gYSBtZXRob2Qgb2YgYSBkaWZmZXJlbnQgbmFtZScpO1xuICAgIH1cbiAgfSxcbiAgXG4gIG5vb3A6IGZ1bmN0aW9uKCl7fSxcbiAgXG4gIHRydWVmbmM6IGZ1bmN0aW9uKCl7cmV0dXJuIHRydWV9LFxuICBcbiAgZmFsc2VmbmM6IGZ1bmN0aW9uKCl7cmV0dXJuIHRydWV9LFxuICBcbiAgcmVzb2x2ZWRWYWx1ZTogZnVuY3Rpb24odmFsdWUpe1xuICAgIHZhciBkZWZlcnJlZCA9ICQuRGVmZXJyZWQoKTtcbiAgICBkZWZlcnJlZC5yZXNvbHZlKHZhbHVlKTtcbiAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZSgpO1xuICB9LFxuICBcbiAgcmVqZWN0ZWRWYWx1ZTogZnVuY3Rpb24odmFsdWUpe1xuICAgIHZhciBkZWZlcnJlZCA9ICQuRGVmZXJyZWQoKTtcbiAgICBkZWZlcnJlZC5yZWplY3QodmFsdWUpO1xuICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlKCk7XG4gIH1cbn07XG5cbm1vZHVsZS5leHBvcnRzID0gdXRpbHM7XG4iLCJ2YXIgaW5oZXJpdCA9IHJlcXVpcmUoJ2czdy9jb3JlL3V0aWxzJykuaW5oZXJpdDtcbnZhciB0cnVlZm5jID0gcmVxdWlyZSgnZzN3L2NvcmUvdXRpbHMnKS50cnVlZm5jO1xudmFyIHJlc29sdmVkVmFsdWUgPSByZXF1aXJlKCdnM3cvY29yZS91dGlscycpLnJlc29sdmVkVmFsdWU7XG52YXIgcmVqZWN0ZWRWYWx1ZSA9IHJlcXVpcmUoJ2czdy9jb3JlL3V0aWxzJykucmVqZWN0ZWRWYWx1ZTtcbnZhciBHM1dPYmplY3QgPSByZXF1aXJlKCdnM3cvY29yZS9nM3dvYmplY3QnKTtcblxuZnVuY3Rpb24gVmVjdG9yTGF5ZXIoY29uZmlnKXtcbiAgdmFyIGNvbmZpZyA9IGNvbmZpZyB8fCB7fTtcbiAgdGhpcy5nZW9tZXRyeXR5cGUgPSBjb25maWcuZ2VvbWV0cnl0eXBlIHx8IG51bGw7XG4gIHRoaXMuZm9ybWF0ID0gY29uZmlnLmZvcm1hdCB8fCBudWxsO1xuICB0aGlzLmNycyA9IGNvbmZpZy5jcnMgIHx8IG51bGw7XG4gIHRoaXMuaWQgPSBjb25maWcuaWQgfHwgbnVsbDtcbiAgdGhpcy5uYW1lID0gY29uZmlnLm5hbWUgfHwgXCJcIjtcbiAgdGhpcy5wayA9IGNvbmZpZy5wayB8fCBcImlkXCI7IC8vIFRPRE86IGlsIEdlb0pTT04gc2V0dGEgbCdpZCBkZWxsYSBmZWF0dXJlIGRhIHPDqSwgZSBuYXNjb25kZSBpbCBjYW1wbyBQSyBkYWxsZSBwcm9wZXJ0aWVzLiBJbiBhbHRyaSBmb3JtYXRpIHZhIHZlcmlmaWNhdG8sIGUgY2Fzb21haSB1c2FyZSBmZWF0dXJlLnNldElkKClcbiAgXG4gIHRoaXMuX29sU291cmNlID0gbmV3IG9sLnNvdXJjZS5WZWN0b3Ioe1xuICAgIGZlYXR1cmVzOiBuZXcgb2wuQ29sbGVjdGlvbigpXG4gIH0pO1xuICB0aGlzLl9vbExheWVyID0gbmV3IG9sLmxheWVyLlZlY3Rvcih7XG4gICAgbmFtZTogdGhpcy5uYW1lLFxuICAgIHNvdXJjZTogdGhpcy5fb2xTb3VyY2VcbiAgfSk7XG4gIFxuICAvKlxuICAgKiBBcnJheSBkaSBvZ2dldHRpOlxuICAgKiB7XG4gICAqICBuYW1lOiBOb21lIGRlbGwnYXR0cmlidXRvLFxuICAgKiAgdHlwZTogaW50ZWdlciB8IGZsb2F0IHwgc3RyaW5nIHwgYm9vbGVhbiB8IGRhdGUgfCB0aW1lIHwgZGF0ZXRpbWUsXG4gICAqICBpbnB1dDoge1xuICAgKiAgICBsYWJlbDogTm9tZSBkZWwgY2FtcG8gZGkgaW5wdXQsXG4gICAqICAgIHR5cGU6IHNlbGVjdCB8IGNoZWNrIHwgcmFkaW8gfCBjb29yZHNwaWNrZXIgfCBib3hwaWNrZXIgfCBsYXllcnBpY2tlciB8IGZpZWxkZGVwZW5kLFxuICAgKiAgICBvcHRpb25zOiB7XG4gICAqICAgICAgTGUgb3B6aW9uaSBwZXIgbG8gc3BjaWZpY28gdGlwbyBkaSBpbnB1dCAoZXMuIFwidmFsdWVzXCIgcGVyIGxhIGxpc3RhIGRpIHZhbG9yaSBkaSBzZWxlY3QsIGNoZWNrIGUgcmFkaW8pXG4gICAqICAgIH1cbiAgICogIH1cbiAgICogfVxuICAqL1xuICB0aGlzLl9QS2luQXR0cmlidXRlcyA9IGZhbHNlO1xuICB0aGlzLl9mZWF0dXJlc0ZpbHRlciA9IG51bGw7XG4gIHRoaXMuX2ZpZWxkcyA9IG51bGxcbiAgdGhpcy5sYXp5UmVsYXRpb25zID0gdHJ1ZTtcbiAgdGhpcy5fcmVsYXRpb25zID0gbnVsbDtcbn1cbmluaGVyaXQoVmVjdG9yTGF5ZXIsRzNXT2JqZWN0KTtcbm1vZHVsZS5leHBvcnRzID0gVmVjdG9yTGF5ZXI7XG5cbnZhciBwcm90byA9IFZlY3RvckxheWVyLnByb3RvdHlwZTtcblxucHJvdG8uc2V0RGF0YSA9IGZ1bmN0aW9uKGZlYXR1cmVzRGF0YSl7XG4gIHZhciBzZWxmID0gdGhpcztcbiAgdmFyIGZlYXR1cmVzO1xuICBpZiAodGhpcy5mb3JtYXQpIHtcbiAgICBzd2l0Y2ggKHRoaXMuZm9ybWF0KXtcbiAgICAgIGNhc2UgXCJHZW9KU09OXCI6XG4gICAgICAgIHZhciBnZW9qc29uID0gbmV3IG9sLmZvcm1hdC5HZW9KU09OKHtcbiAgICAgICAgICBkZWZhdWx0RGF0YVByb2plY3Rpb246IHRoaXMuY3JzLFxuICAgICAgICAgIGdlb21ldHJ5TmFtZTogXCJnZW9tZXRyeVwiXG4gICAgICAgIH0pO1xuICAgICAgICBmZWF0dXJlcyA9IGdlb2pzb24ucmVhZEZlYXR1cmVzKGZlYXR1cmVzRGF0YSk7XG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgICBcbiAgICBpZiAoZmVhdHVyZXMgJiYgZmVhdHVyZXMubGVuZ3RoKSB7XG4gICAgICBpZiAoIV8uaXNOdWxsKHRoaXMuX2ZlYXR1cmVzRmlsdGVyKSl7XG4gICAgICAgIHZhciBmZWF0dXJlcyA9IF8ubWFwKGZlYXR1cmVzLGZ1bmN0aW9uKGZlYXR1cmUpe1xuICAgICAgICAgIHJldHVybiBzZWxmLl9mZWF0dXJlc0ZpbHRlcihmZWF0dXJlKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIHZhciBhbHJlYWR5TG9hZGVkSWRzID0gdGhpcy5nZXRGZWF0dXJlSWRzKCk7XG4gICAgICB2YXIgZmVhdHVyZXNUb0xvYWQgPSBfLmZpbHRlcihmZWF0dXJlcyxmdW5jdGlvbihmZWF0dXJlKXtcbiAgICAgICAgcmV0dXJuICFfLmluY2x1ZGVzKGFscmVhZHlMb2FkZWRJZHMsZmVhdHVyZS5nZXRJZCgpKTtcbiAgICAgIH0pXG4gICAgICBcbiAgICAgIHRoaXMuX29sU291cmNlLmFkZEZlYXR1cmVzKGZlYXR1cmVzVG9Mb2FkKTtcbiAgICAgIFxuICAgICAgLy8gdmVyaWZpY28sIHByZW5kZW5kbyBsYSBwcmltYSBmZWF0dXJlLCBzZSBsYSBQSyDDqCBwcmVzZW50ZSBvIG1lbm8gdHJhIGdsaSBhdHRyaWJ1dGlcbiAgICAgIHZhciBhdHRyaWJ1dGVzID0gdGhpcy5nZXRTb3VyY2UoKS5nZXRGZWF0dXJlcygpWzBdLmdldFByb3BlcnRpZXMoKTtcbiAgICAgIHRoaXMuX1BLaW5BdHRyaWJ1dGVzID0gXy5nZXQoYXR0cmlidXRlcyx0aGlzLnBrKSA/IHRydWUgOiBmYWxzZTtcbiAgICB9XG4gIH1cbiAgZWxzZSB7XG4gICAgY29uc29sZS5sb2coXCJWZWN0b3JMYXllciBmb3JtYXQgbm90IGRlZmluZWRcIik7XG4gIH1cbn07XG5cbnByb3RvLnNldEZlYXR1cmVEYXRhID0gZnVuY3Rpb24ob2xkZmlkLGZpZCxnZW9tZXRyeSxhdHRyaWJ1dGVzKXtcbiAgdmFyIGZlYXR1cmUgPSB0aGlzLmdldEZlYXR1cmVCeUlkKG9sZGZpZCk7XG4gIGlmIChmaWQpe1xuICAgIGZlYXR1cmUuc2V0SWQoZmlkKTtcbiAgfVxuICBcbiAgaWYgKGdlb21ldHJ5KXtcbiAgICBmZWF0dXJlLnNldEdlb21ldHJ5KGdlb21ldHJ5KTtcbiAgfVxuICBcbiAgaWYgKGF0dHJpYnV0ZXMpe1xuICAgIHZhciBvbGRBdHRyaWJ1dGVzID0gZmVhdHVyZS5nZXRQcm9wZXJ0aWVzKCk7XG4gICAgdmFyIG5ld0F0dHJpYnV0ZXMgPV8uYXNzaWduKG9sZEF0dHJpYnV0ZXMsYXR0cmlidXRlcyk7XG4gICAgZmVhdHVyZS5zZXRQcm9wZXJ0aWVzKG5ld0F0dHJpYnV0ZXMpO1xuICB9XG4gIFxuICByZXR1cm4gZmVhdHVyZTtcbn07XG5cbnByb3RvLmFkZEZlYXR1cmVzID0gZnVuY3Rpb24oZmVhdHVyZXMpe1xuICB0aGlzLmdldFNvdXJjZSgpLmFkZEZlYXR1cmVzKGZlYXR1cmVzKTtcbn07XG5cbnByb3RvLnNldEZlYXR1cmVzRmlsdGVyID0gZnVuY3Rpb24oZmVhdHVyZXNGaWx0ZXIpe1xuICB0aGlzLl9mZWF0dXJlc0ZpbHRlciA9IGZlYXR1cmVzRmlsdGVyO1xufTtcblxucHJvdG8uc2V0RmllbGRzID0gZnVuY3Rpb24oZmllbGRzKXtcbiAgdGhpcy5fZmllbGRzID0gZmllbGRzO1xufTtcblxucHJvdG8uc2V0UGtGaWVsZCA9IGZ1bmN0aW9uKCl7XG4gIHZhciBzZWxmID0gdGhpcztcbiAgdmFyIHBrZmllbGRTZXQgPSBmYWxzZTtcbiAgXy5mb3JFYWNoKHRoaXMuX2ZpZWxkcyxmdW5jdGlvbihmaWVsZCl7XG4gICAgaWYgKGZpZWxkLm5hbWUgPT0gc2VsZi5wayApe1xuICAgICAgcGtmaWVsZFNldCA9IHRydWU7XG4gICAgfVxuICB9KTtcbiAgXG4gIGlmICghcGtmaWVsZFNldCl7XG4gICAgdGhpcy5fZmllbGRzXG4gIH1cbn07XG5cbnByb3RvLmdldEZlYXR1cmVzID0gZnVuY3Rpb24oKXtcbiAgcmV0dXJuIHRoaXMuZ2V0U291cmNlKCkuZ2V0RmVhdHVyZXMoKTtcbn07XG5cbnByb3RvLmdldEZlYXR1cmVJZHMgPSBmdW5jdGlvbigpe1xuICB2YXIgZmVhdHVyZUlkcyA9IF8ubWFwKHRoaXMuZ2V0U291cmNlKCkuZ2V0RmVhdHVyZXMoKSxmdW5jdGlvbihmZWF0dXJlKXtcbiAgICByZXR1cm4gZmVhdHVyZS5nZXRJZCgpO1xuICB9KVxuICByZXR1cm4gZmVhdHVyZUlkc1xufTtcblxucHJvdG8uZ2V0RmllbGRzID0gZnVuY3Rpb24oKXtcbiAgcmV0dXJuIF8uY2xvbmVEZWVwKHRoaXMuX2ZpZWxkcyk7XG59O1xuXG5wcm90by5nZXRGaWVsZHNOYW1lcyA9IGZ1bmN0aW9uKCl7XG4gIHJldHVybiBfLm1hcCh0aGlzLl9maWVsZHMsZnVuY3Rpb24oZmllbGQpe1xuICAgIHJldHVybiBmaWVsZC5uYW1lO1xuICB9KTtcbn07XG5cbnByb3RvLmdldEZpZWxkc1dpdGhBdHRyaWJ1dGVzID0gZnVuY3Rpb24ob2JqKXtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICAvKnZhciBmaWVsZHMgPSBfLmNsb25lRGVlcChfLmZpbHRlcih0aGlzLl9maWVsZHMsZnVuY3Rpb24oZmllbGQpe1xuICAgIHJldHVybiAoKGZpZWxkLm5hbWUgIT0gc2VsZi5waykgJiYgZmllbGQuZWRpdGFibGUpO1xuICB9KSk7Ki9cbiAgdmFyIGZpZWxkcyA9IF8uY2xvbmVEZWVwKHRoaXMuX2ZpZWxkcyk7XG4gIFxuICB2YXIgZmVhdHVyZSwgYXR0cmlidXRlcztcbiAgXG4gIC8vIGlsIG1ldG9kbyBhY2NldHRhIHNpYSBmZWF0dXJlIGNoZSBmaWRcbiAgaWYgKG9iaiBpbnN0YW5jZW9mIG9sLkZlYXR1cmUpe1xuICAgIGZlYXR1cmUgPSBvYmo7XG4gIH1cbiAgZWxzZSBpZiAob2JqKXtcbiAgICBmZWF0dXJlID0gdGhpcy5nZXRGZWF0dXJlQnlJZChvYmopO1xuICB9XG4gIGlmIChmZWF0dXJlKXtcbiAgICBhdHRyaWJ1dGVzID0gZmVhdHVyZS5nZXRQcm9wZXJ0aWVzKCk7XG4gIH1cbiAgXG4gIF8uZm9yRWFjaChmaWVsZHMsZnVuY3Rpb24oZmllbGQpe1xuICAgIGlmIChmZWF0dXJlKXtcbiAgICAgIGlmICghdGhpcy5fUEtpbkF0dHJpYnV0ZXMgJiYgZmllbGQubmFtZSA9PSBzZWxmLnBrKXtcbiAgICAgICAgZmllbGQudmFsdWUgPSBmZWF0dXJlLmdldElkKCk7XG4gICAgICB9XG4gICAgICBlbHNle1xuICAgICAgICBmaWVsZC52YWx1ZSA9IGF0dHJpYnV0ZXNbZmllbGQubmFtZV07XG4gICAgICB9XG4gICAgfVxuICAgIGVsc2V7XG4gICAgICBmaWVsZC52YWx1ZSA9IG51bGw7XG4gICAgfVxuICB9KTtcbiAgcmV0dXJuIGZpZWxkcztcbn07XG5cbnByb3RvLnNldFJlbGF0aW9ucyA9IGZ1bmN0aW9uKHJlbGF0aW9ucyl7XG4gIF8uZm9yRWFjaChyZWxhdGlvbnMsZnVuY3Rpb24ocmVsYXRpb24scmVsYXRpb25LZXkpe1xuICAgIHJlbGF0aW9uLm5hbWUgPSByZWxhdGlvbktleTtcbiAgfSk7XG4gIHRoaXMuX3JlbGF0aW9ucyA9IHJlbGF0aW9ucztcbn07XG5cbnByb3RvLmdldFJlbGF0aW9ucyA9IGZ1bmN0aW9uKCl7XG4gIHJldHVybiB0aGlzLl9yZWxhdGlvbnM7XG59O1xuXG5wcm90by5oYXNSZWxhdGlvbnMgPSBmdW5jdGlvbigpe1xuICByZXR1cm4gIV8uaXNOdWxsKHRoaXMuX3JlbGF0aW9ucyk7XG59O1xuXG5wcm90by5nZXRSZWxhdGlvbnNOYW1lcyA9IGZ1bmN0aW9uKCl7XG4gIHJldHVybiBfLmtleXModGhpcy5fcmVsYXRpb25zKTtcbn07XG5cbnByb3RvLmdldFJlbGF0aW9uc0Zrc0tleXMgPSBmdW5jdGlvbigpe1xuICB2YXIgZmtzID0gW107XG4gIF8uZm9yRWFjaCh0aGlzLl9yZWxhdGlvbnMsZnVuY3Rpb24ocmVsYXRpb24pe1xuICAgIGZrcy5wdXNoKHJlbGF0aW9uLmZrKTtcbiAgfSlcbiAgcmV0dXJuIGZrcztcbn07XG5cbnByb3RvLmdldFJlbGF0aW9uRmllbGRzTmFtZXMgPSBmdW5jdGlvbihyZWxhdGlvbil7XG4gIHZhciByZWxhdGlvbkZpZWxkcyA9IHRoaXMuX3JlbGF0aW9uc1tyZWxhdGlvbl07XG4gIGlmIChyZWxhdGlvbkZpZWxkcyl7XG4gICAgcmV0dXJuIF8ubWFwKHJlbGF0aW9uRmllbGRzLGZ1bmN0aW9uKGZpZWxkKXtcbiAgICAgIHJldHVybiBmaWVsZC5uYW1lO1xuICAgIH0pO1xuICB9XG4gIHJldHVybiBudWxsO1xufTtcblxuLy8gb3R0ZW5nbyBsZSByZWxhemlvbmkgYSBwYXJ0aXJlIGRhbCBmaWQgZGkgdW5hIGZlYXR1cmUgZXNpc3RlbnRlXG5wcm90by5nZXRSZWxhdGlvbnNXaXRoQXR0cmlidXRlcyA9IGZ1bmN0aW9uKGZpZCl7XG4gIHZhciByZWxhdGlvbnMgPSBfLmNsb25lRGVlcCh0aGlzLl9yZWxhdGlvbnMpO1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIGlmICghZmlkIHx8ICF0aGlzLmdldEZlYXR1cmVCeUlkKGZpZCkpe1xuICAgIF8uZm9yRWFjaChyZWxhdGlvbnMsZnVuY3Rpb24ocmVsYXRpb24scmVsYXRpb25LZXkpe1xuICAgICAgICAvLyBpbml6aWFsbWVudGUgc2V0dG8gYSBudWxsIGkgdmFsb3JpXG4gICAgICBfLmZvckVhY2gocmVsYXRpb24uZmllbGRzLGZ1bmN0aW9uKGZpZWxkKXtcbiAgICAgICAgZmllbGQudmFsdWUgPSBudWxsO1xuICAgICAgfSlcbiAgICB9KTtcbiAgICByZXR1cm4gcmVzb2x2ZWRWYWx1ZShyZWxhdGlvbnMpO1xuICB9XG4gIGVsc2Uge1xuICAgIGlmICh0aGlzLmxhenlSZWxhdGlvbnMpe1xuICAgICAgdmFyIGRlZmVycmVkID0gJC5EZWZlcnJlZCgpO1xuICAgICAgdmFyIGF0dHJpYnV0ZXMgPSB0aGlzLmdldEZlYXR1cmVCeUlkKGZpZCkuZ2V0UHJvcGVydGllcygpO1xuICAgICAgdmFyIGZrcyA9IHt9O1xuICAgICAgXy5mb3JFYWNoKHJlbGF0aW9ucyxmdW5jdGlvbihyZWxhdGlvbixyZWxhdGlvbktleSl7XG4gICAgICAgIHZhciB1cmwgPSByZWxhdGlvbi51cmw7XG4gICAgICAgIHZhciBrZXlWYWxzID0gW107XG4gICAgICAgIF8uZm9yRWFjaChyZWxhdGlvbi5mayxmdW5jdGlvbihma0tleSl7XG4gICAgICAgICAgZmtzW2ZrS2V5XSA9IGF0dHJpYnV0ZXNbZmtLZXldO1xuICAgICAgICB9KTtcbiAgICAgIH0pXG4gICAgICBcbiAgICAgIHRoaXMuZ2V0UmVsYXRpb25zV2l0aEF0dHJpYnV0ZXNGcm9tRmtzKGZrcylcbiAgICAgIC50aGVuKGZ1bmN0aW9uKHJlbGF0aW9uc1Jlc3BvbnNlKXtcbiAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZWxhdGlvbnNSZXNwb25zZSk7XG4gICAgICB9KVxuICAgICAgLmZhaWwoZnVuY3Rpb24oKXtcbiAgICAgICAgZGVmZXJyZWQucmVqZWN0KCk7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlKCk7XG4gICAgfVxuICB9XG59O1xuXG4vLyBvdHRlbmdvIGxlIHJlbGF6aW9uaSB2YWxvcml6emF0ZSBhIHBhcnRpcmUgZGEgdW4gb2dnZXR0byBjb24gbGUgY2hpYXZpIEZLIGNvbWUga2V5cyBlIGkgbG9ybyB2YWxvcmkgY29tZSB2YWx1ZXNcbnByb3RvLmdldFJlbGF0aW9uc1dpdGhBdHRyaWJ1dGVzRnJvbUZrcyA9IGZ1bmN0aW9uKGZrcyl7XG4gIHZhciBzZWxmID0gdGhpcztcbiAgdmFyIHJlbGF0aW9ucyA9IF8uY2xvbmVEZWVwKHRoaXMuX3JlbGF0aW9ucyk7XG4gIHZhciByZWxhdGlvbnNSZXF1ZXN0cyA9IFtdO1xuXG4gIF8uZm9yRWFjaChyZWxhdGlvbnMsZnVuY3Rpb24ocmVsYXRpb24scmVsYXRpb25LZXkpe1xuICAgIHZhciB1cmwgPSByZWxhdGlvbi51cmw7XG4gICAgdmFyIGtleVZhbHMgPSBbXTtcbiAgICBfLmZvckVhY2gocmVsYXRpb24uZmssZnVuY3Rpb24oZmtLZXkpe1xuICAgICAgdmFyIGZrVmFsdWUgPSBma3NbZmtLZXldO1xuICAgICAga2V5VmFscy5wdXNoKGZrS2V5K1wiPVwiK2ZrVmFsdWUpO1xuICAgIH0pO1xuICAgIHZhciBma1BhcmFtcyA9IF8uam9pbihrZXlWYWxzLFwiJlwiKTtcbiAgICB1cmwgKz0gXCI/XCIrZmtQYXJhbXM7XG4gICAgcmVsYXRpb25zUmVxdWVzdHMucHVzaCgkLmdldCh1cmwpXG4gICAgICAudGhlbihmdW5jdGlvbihyZWxhdGlvbkF0dHJpYnV0ZXMpe1xuICAgICAgICBfLmZvckVhY2gocmVsYXRpb24uZmllbGRzLGZ1bmN0aW9uKGZpZWxkKXtcbiAgICAgICAgICBmaWVsZC52YWx1ZSA9IHJlbGF0aW9uQXR0cmlidXRlc1swXVtmaWVsZC5uYW1lXTtcbiAgICAgICAgfSk7XG4gICAgICB9KVxuICAgIClcbiAgfSlcbiAgXG4gIHJldHVybiAkLndoZW4uYXBwbHkodGhpcyxyZWxhdGlvbnNSZXF1ZXN0cylcbiAgLnRoZW4oZnVuY3Rpb24oKXtcbiAgICByZXR1cm4gcmVsYXRpb25zO1xuICB9KTtcbn1cblxucHJvdG8uc2V0U3R5bGUgPSBmdW5jdGlvbihzdHlsZSl7XG4gIHRoaXMuX29sTGF5ZXIuc2V0U3R5bGUoc3R5bGUpO1xufTtcblxucHJvdG8uZ2V0TGF5ZXIgPSBmdW5jdGlvbigpe1xuICByZXR1cm4gdGhpcy5fb2xMYXllcjtcbn07XG5cbnByb3RvLmdldFNvdXJjZSA9IGZ1bmN0aW9uKCl7XG4gIHJldHVybiB0aGlzLl9vbExheWVyLmdldFNvdXJjZSgpO1xufTtcblxucHJvdG8uZ2V0RmVhdHVyZUJ5SWQgPSBmdW5jdGlvbihpZCl7XG4gIHJldHVybiB0aGlzLl9vbExheWVyLmdldFNvdXJjZSgpLmdldEZlYXR1cmVCeUlkKGlkKTtcbn07XG5cbnByb3RvLmNsZWFyID0gZnVuY3Rpb24oKXtcbiAgdGhpcy5nZXRTb3VyY2UoKS5jbGVhcigpO1xufTtcblxucHJvdG8uYWRkVG9NYXAgPSBmdW5jdGlvbihtYXApe1xuICBtYXAuYWRkTGF5ZXIodGhpcy5fb2xMYXllcik7XG59O1xuXG4vLyBkYXRhIHVuYSBmZWF0dXJlIHZlcmlmaWNvIHNlIGhhIHRyYSBnbGkgYXR0cmlidXRpIGkgdmFsb3JpIGRlbGxlIEZLIGRlbGxlIChldmVudHVhbGkpIHJlbGF6aW9uaVxucHJvdG8uZmVhdHVyZUhhc1JlbGF0aW9uc0Zrc1dpdGhWYWx1ZXMgPSBmdW5jdGlvbihmZWF0dXJlKXtcbiAgdmFyIGF0dHJpYnV0ZXMgPSBmZWF0dXJlLmdldFByb3BlcnRpZXMoKTtcbiAgdmFyIGZrc0tleXMgPSB0aGlzLmdldFJlbGF0aW9uc0Zrc0tleXMoKTtcbiAgcmV0dXJuIF8uZXZlcnkoZmtzS2V5cyxmdW5jdGlvbihma0tleSl7XG4gICAgdmFyIHZhbHVlID0gYXR0cmlidXRlc1tma0tleV07XG4gICAgcmV0dXJuICghXy5pc05pbCh2YWx1ZSkgJiYgdmFsdWUgIT0gJycpO1xuICB9KVxufTtcblxuLy8gZGF0YSB1bmEgZmVhdHVyZSBwb3BvbG8gdW4gb2dnZXR0byBjb24gY2hpYXZpL3ZhbG9yaSBkZWxsZSBGSyBkZWxsZSAoZXZlbnR1YWxpKSByZWxhemlvbmVcbnByb3RvLmdldFJlbGF0aW9uc0Zrc1dpdGhWYWx1ZXNGb3JGZWF0dXJlID0gZnVuY3Rpb24oZmVhdHVyZSl7XG4gIHZhciBhdHRyaWJ1dGVzID0gZmVhdHVyZS5nZXRQcm9wZXJ0aWVzKCk7XG4gIHZhciBma3MgPSB7fTtcbiAgdmFyIGZrc0tleXMgPSB0aGlzLmdldFJlbGF0aW9uc0Zrc0tleXMoKTtcbiAgXy5mb3JFYWNoKGZrc0tleXMsZnVuY3Rpb24oZmtLZXkpe1xuICAgIGZrc1tma0tleV0gPSBhdHRyaWJ1dGVzW2ZrS2V5XTtcbiAgfSlcbiAgcmV0dXJuIGZrcztcbn07XG4iLCJ2YXIgaW5oZXJpdCA9IHJlcXVpcmUoJy4vdXRpbHMnKS5pbmhlcml0O1xudmFyIGJhc2UgPSByZXF1aXJlKCcuL3V0aWxzJykuYmFzZTtcbnZhciBMYXllciA9IHJlcXVpcmUoJy4vbGF5ZXInKTtcbnZhciBSYXN0ZXJMYXllcnMgPSByZXF1aXJlKCdnM3ctb2wzL3NyYy9sYXllcnMvcmFzdGVycycpO1xuXG5mdW5jdGlvbiBXTVNNdWx0aUxheWVyKGNvbmZpZyxleHRyYVBhcmFtcyl7XG4gIGJhc2UodGhpcyxjb25maWcpO1xuICBcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICB0aGlzLl9vbExheWVyID0gbnVsbDtcbiAgdGhpcy5sYXllcnMgPSBbXTtcbiAgdGhpcy5leHRyYVBhcmFtcyA9IGV4dHJhUGFyYW1zO1xuICBcbiAgdGhpcy5fb2xMYXllciA9IG51bGw7XG59XG5pbmhlcml0KFdNU011bHRpTGF5ZXIsTGF5ZXIpXG52YXIgcHJvdG8gPSBXTVNNdWx0aUxheWVyLnByb3RvdHlwZTtcblxucHJvdG8uZ2V0TGF5ZXIgPSBmdW5jdGlvbigpe1xuICB2YXIgb2xMYXllciA9IHRoaXMuX29sTGF5ZXI7XG4gIGlmICghb2xMYXllcil7XG4gICAgb2xMYXllciA9IHRoaXMuX29sTGF5ZXIgPSB0aGlzLl9tYWtlT2xMYXllcigpO1xuICB9XG4gIHJldHVybiBvbExheWVyO1xufTtcblxucHJvdG8uZ2V0TGF5ZXJDb25maWdzID0gZnVuY3Rpb24oKXtcbiAgcmV0dXJuIHRoaXMubGF5ZXJzO1xufTtcblxucHJvdG8uZ2V0U291cmNlID0gZnVuY3Rpb24oKXtcbiAgcmV0dXJuIHRoaXMuX29sTGF5ZXIuZ2V0U291cmNlKCk7XG59O1xuXG5wcm90by5nZXRJZCA9IGZ1bmN0aW9uKCl7XG4gIHJldHVybiB0aGlzLmlkO1xufTtcblxucHJvdG8uX21ha2VPbExheWVyID0gZnVuY3Rpb24oKXtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICB2YXIgd21zQ29uZmlnID0ge1xuICAgIHVybDogdGhpcy5jb25maWcuZGVmYXVsdFVybCxcbiAgICBpZDogdGhpcy5jb25maWcuaWRcbiAgfTtcbiAgXG4gIHZhciBvbExheWVyID0gbmV3IFJhc3RlckxheWVycy5XTVNMYXllcih3bXNDb25maWcsdGhpcy5leHRyYVBhcmFtcyk7XG4gIFxuICBvbExheWVyLmdldFNvdXJjZSgpLm9uKCdpbWFnZWxvYWRzdGFydCcsIGZ1bmN0aW9uKCkge1xuICAgICAgICBzZWxmLmVtaXQoXCJsb2Fkc3RhcnRcIik7XG4gICAgICB9KTtcbiAgb2xMYXllci5nZXRTb3VyY2UoKS5vbignaW1hZ2Vsb2FkZW5kJywgZnVuY3Rpb24oKSB7XG4gICAgICBzZWxmLmVtaXQoXCJsb2FkZW5kXCIpO1xuICB9KTtcbiAgXG4gIHJldHVybiBvbExheWVyXG59O1xuXG5wcm90by5hZGRMYXllciA9IGZ1bmN0aW9uKGxheWVyQ29uZmlnKXtcbiAgdGhpcy5sYXllcnMucHVzaChsYXllckNvbmZpZyk7XG59O1xuXG5wcm90by50b2dnbGVMYXllciA9IGZ1bmN0aW9uKGxheWVyKXtcbiAgXy5mb3JFYWNoKHRoaXMubGF5ZXJzLGZ1bmN0aW9uKF9sYXllcil7XG4gICAgaWYgKF9sYXllci5pZCA9PSBsYXllci5pZCl7XG4gICAgICBfbGF5ZXIudmlzaWJsZSA9IGxheWVyLnZpc2libGU7XG4gICAgfVxuICB9KTtcbiAgdGhpcy5fdXBkYXRlTGF5ZXJzKCk7XG59O1xuICBcbnByb3RvLnVwZGF0ZSA9IGZ1bmN0aW9uKGV4dHJhUGFyYW1zKXtcbiAgdGhpcy5fdXBkYXRlTGF5ZXJzKGV4dHJhUGFyYW1zKTtcbn07XG5cbnByb3RvLmlzVmlzaWJsZSA9IGZ1bmN0aW9uKCl7XG4gIHJldHVybiB0aGlzLl9nZXRWaXNpYmxlTGF5ZXJzKCkubGVuZ3RoID4gMDtcbn07XG5cbnByb3RvLl9nZXRWaXNpYmxlTGF5ZXJzID0gZnVuY3Rpb24oKXtcbiAgdmFyIHZpc2libGVMYXllcnMgPSBbXTtcbiAgXy5mb3JFYWNoKHRoaXMubGF5ZXJzLGZ1bmN0aW9uKGxheWVyKXtcbiAgICBpZiAobGF5ZXIudmlzaWJsZSl7XG4gICAgICB2aXNpYmxlTGF5ZXJzLnB1c2gobGF5ZXIpO1xuICAgIH0gICAgXG4gIH0pXG4gIHJldHVybiB2aXNpYmxlTGF5ZXJzO1xufVxuXG5wcm90by5fdXBkYXRlTGF5ZXJzID0gZnVuY3Rpb24oZXh0cmFQYXJhbXMpe1xuICB2YXIgdmlzaWJsZUxheWVycyA9IHRoaXMuX2dldFZpc2libGVMYXllcnMoKTtcbiAgaWYgKHZpc2libGVMYXllcnMubGVuZ3RoID4gMCkge1xuICAgIHZhciBwYXJhbXMgPSB7XG4gICAgICBMQVlFUlM6IF8uam9pbihfLm1hcCh2aXNpYmxlTGF5ZXJzLCduYW1lJyksJywnKVxuICAgIH07XG4gICAgaWYgKGV4dHJhUGFyYW1zKSB7XG4gICAgICBwYXJhbXMgPSBfLmFzc2lnbihleHRyYVBhcmFtcyxwYXJhbXMpO1xuICAgIH1cbiAgICB0aGlzLl9vbExheWVyLnNldFZpc2libGUodHJ1ZSk7XG4gICAgdGhpcy5fb2xMYXllci5nZXRTb3VyY2UoKS51cGRhdGVQYXJhbXMocGFyYW1zKTtcbiAgfVxuICBlbHNlIHtcbiAgICB0aGlzLl9vbExheWVyLnNldFZpc2libGUoZmFsc2UpO1xuICB9XG59O1xuXG5wcm90by5nZXRRdWVyeVVybCA9IGZ1bmN0aW9uKCl7XG4gIHZhciBsYXllciA9IHRoaXMubGF5ZXJzWzBdO1xuICBpZiAobGF5ZXIuaW5mb3VybCAmJiBsYXllci5pbmZvdXJsICE9ICcnKSB7XG4gICAgcmV0dXJuIGxheWVyLmluZm91cmw7XG4gIH1cbiAgcmV0dXJuIHRoaXMuY29uZmlnLmRlZmF1bHRVcmw7XG59O1xuXG5wcm90by5nZXRRdWVyeUxheWVycyA9IGZ1bmN0aW9uKCl7XG4gIFxuICAvLyBEQSBSRUlNUExFTUVOVEFSRSBTVUxMQSBCQVNFIERJIFdNU1NpbmdsZUxheWVyXG4gIFxuICAvKnZhciBsYXllciA9IHRoaXMubGF5ZXJzWzBdO1xuICB2YXIgcXVlcnlMYXllcnMgPSBbXTtcbiAgXy5mb3JFYWNoKHRoaXMubGF5ZXJzLGZ1bmN0aW9uKGxheWVyKXtcbiAgICBpZiAobGF5ZXIuaW5mb2xheWVyICYmIGxheWVyLmluZm9sYXllciAhPSAnJykge1xuICAgICAgcXVlcnlMYXllcnMucHVzaChsYXllci5pbmZvbGF5ZXIpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIHF1ZXJ5TGF5ZXJzLnB1c2gobGF5ZXIubmFtZSk7XG4gICAgfVxuICB9KVxuICByZXR1cm4gcXVlcnlMYXllcnM7Ki9cbn07XG5cbm1vZHVsZS5leHBvcnRzID0gV01TTXVsdGlMYXllcjtcblxuIiwidmFyIGluaGVyaXQgPSByZXF1aXJlKCcuL3V0aWxzJykuaW5oZXJpdDtcbnZhciBiYXNlID0gcmVxdWlyZSgnLi91dGlscycpLmJhc2U7XG52YXIgTGF5ZXIgPSByZXF1aXJlKCcuL2xheWVyJyk7XG52YXIgUmFzdGVyTGF5ZXJzID0gcmVxdWlyZSgnZzN3LW9sMy9zcmMvbGF5ZXJzL3Jhc3RlcnMnKTtcblxuZnVuY3Rpb24gV01TU2luZ2xlTGF5ZXIoY29uZmlnLGV4dHJhUGFyYW1zKXtcbiAgYmFzZSh0aGlzLGNvbmZpZyk7XG4gIHZhciBzZWxmID0gdGhpcztcbiAgdGhpcy5MQVlFUlRZUEUgPSB7XG4gICAgTEFZRVI6ICdsYXllcicsXG4gICAgTVVMVElMQVlFUjogJ211bHRpbGF5ZXInXG4gIH07XG5cbiAgdGhpcy5fb2xMYXllciA9IG51bGw7XG4gIHRoaXMubGF5ZXIgPSBudWxsO1xuICB0aGlzLmV4dHJhUGFyYW1zID0gZXh0cmFQYXJhbXM7XG59XG5pbmhlcml0KFdNU1NpbmdsZUxheWVyLExheWVyKVxudmFyIHByb3RvID0gV01TU2luZ2xlTGF5ZXIucHJvdG90eXBlO1xuXG5wcm90by5nZXRMYXllciA9IGZ1bmN0aW9uKCl7XG4gdmFyIG9sTGF5ZXIgPSB0aGlzLl9vbExheWVyO1xuICBpZiAoIW9sTGF5ZXIpe1xuICAgIG9sTGF5ZXIgPSB0aGlzLl9vbExheWVyID0gdGhpcy5fbWFrZU9sTGF5ZXIoKTtcbiAgfVxuICByZXR1cm4gb2xMYXllcjtcbn07XG5cbnByb3RvLmdldExheWVyQ29uZmlncyA9IGZ1bmN0aW9uKCl7XG4gIHJldHVybiBbdGhpcy5sYXllcl07XG59O1xuXG5wcm90by5nZXRTb3VyY2UgPSBmdW5jdGlvbigpe1xuICByZXR1cm4gdGhpcy5fb2xMYXllci5nZXRTb3VyY2UoKTtcbn07XG5cbnByb3RvLmdldElkID0gZnVuY3Rpb24oKXtcbiAgcmV0dXJuIHRoaXMuaWQ7XG59O1xuXG5wcm90by5fbWFrZU9sTGF5ZXIgPSBmdW5jdGlvbigpe1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIHZhciB3bXNDb25maWcgPSB7XG4gICAgdXJsOiB0aGlzLmNvbmZpZy5kZWZhdWx0VXJsLFxuICAgIGlkOiB0aGlzLmNvbmZpZy5pZCxcbiAgICBsYXllcnM6IHRoaXMubGF5ZXIubmFtZSxcbiAgICBtYXhSZXNvbHV0aW9uOiB0aGlzLmxheWVyLm1heHJlc29sdXRpb25cbiAgfTtcbiAgXG4gIGlmICh0aGlzLmxheWVyLnNvdXJjZSAmJiB0aGlzLmxheWVyLnNvdXJjZS50eXBlID09ICd3bXMnKXtcbiAgICB3bXNDb25maWcudXJsID0gdGhpcy5sYXllci5zb3VyY2UudXJsO1xuICAgIHdtc0NvbmZpZy5sYXllcnMgPSB0aGlzLmxheWVyLnNvdXJjZS5sYXllcnM7XG4gIH07XG5cbiAgdmFyIFdNU0xheWVyQ2xhc3M7XG4gIGlmICh0aGlzLmNvbmZpZy50aWxlZCkge1xuICAgIFdNU0xheWVyQ2xhc3MgPSBSYXN0ZXJMYXllcnMuVGlsZWRXTVNMYXllcjtcbiAgfVxuICBlbHNlIHtcbiAgICBXTVNMYXllckNsYXNzID0gUmFzdGVyTGF5ZXJzLldNU0xheWVyO1xuICB9XG5cbiAgdmFyIG9sTGF5ZXIgPSBuZXcgV01TTGF5ZXJDbGFzcyh3bXNDb25maWcsdGhpcy5leHRyYVBhcmFtcyk7XG4gIFxuICBvbExheWVyLmdldFNvdXJjZSgpLm9uKCdpbWFnZWxvYWRzdGFydCcsIGZ1bmN0aW9uKCkge1xuICAgICAgICBzZWxmLmVtaXQoXCJsb2Fkc3RhcnRcIik7XG4gICAgICB9KTtcbiAgb2xMYXllci5nZXRTb3VyY2UoKS5vbignaW1hZ2Vsb2FkZW5kJywgZnVuY3Rpb24oKSB7XG4gICAgICBzZWxmLmVtaXQoXCJsb2FkZW5kXCIpO1xuICB9KTtcbiAgXG4gIHJldHVybiBvbExheWVyXG59O1xuXG5wcm90by5hZGRMYXllciA9IGZ1bmN0aW9uKGxheWVyQ29uZmlnKXtcbiAgdGhpcy5sYXllciA9IGxheWVyQ29uZmlnO1xufTtcblxucHJvdG8udG9nZ2xlTGF5ZXIgPSBmdW5jdGlvbihsYXllcil7XG4gIHZhciB2aXNpYmxlID0gdGhpcy5fb2xMYXllci5nZXRWaXNpYmxlKCk7XG4gIHRoaXMuX29sTGF5ZXIuc2V0VmlzaWJsZSghdmlzaWJsZSk7XG59O1xuICBcbnByb3RvLnVwZGF0ZSA9IGZ1bmN0aW9uKGV4dHJhUGFyYW1zKXtcbiAgdmFyIG9sTGF5ZXIgPSB0aGlzLmdldExheWVyKCk7XG4gIGlmIChleHRyYVBhcmFtcyl7XG4gICAgb2xMYXllci5nZXRTb3VyY2UoKS51cGRhdGVQYXJhbXMoZXh0cmFQYXJhbXMpO1xuICB9XG4gIG9sTGF5ZXIuc2V0VmlzaWJsZSh0aGlzLmxheWVyLnZpc2libGUpO1xufTtcblxucHJvdG8uaXNWaXNpYmxlID0gZnVuY3Rpb24oKXtcbiAgcmV0dXJuIHRoaXMubGF5ZXIudmlzaWJsZTtcbn07XG5cbnByb3RvLmdldFF1ZXJ5VXJsID0gZnVuY3Rpb24oKXtcbiAgaWYgKHRoaXMubGF5ZXIuaW5mb3VybCAmJiB0aGlzLmxheWVyLmluZm91cmwgIT0gJycpIHtcbiAgICByZXR1cm4gdGhpcy5sYXllci5pbmZvdXJsO1xuICB9XG4gIHJldHVybiB0aGlzLmNvbmZpZy5kZWZhdWx0VXJsO1xufTtcblxucHJvdG8uZ2V0UXVlcnlMYXllcnMgPSBmdW5jdGlvbigpe1xuICB2YXIgcXVlcnlMYXllcnMgPSBbXTtcbiAgXG4gIGlmIChMYXllci5pc1F1ZXJ5YWJsZSh0aGlzLmxheWVyKSkge1xuICAgIHF1ZXJ5TGF5ZXJzLnB1c2goe1xuICAgICAgbGF5ZXJOYW1lOiB0aGlzLmxheWVyLm5hbWUsXG4gICAgICBxdWVyeUxheWVyTmFtZTogTGF5ZXIuZ2V0UXVlcnlMYXllck5hbWUodGhpcy5sYXllcilcbiAgICB9KTtcbiAgfVxuICBcbiAgcmV0dXJuIHF1ZXJ5TGF5ZXJzO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBXTVNTaW5nbGVMYXllcjtcblxuIiwibW9kdWxlLmV4cG9ydHMgPSBcIjwhLS0gaXRlbSB0ZW1wbGF0ZSAtLT5cXG48ZGl2IGlkPVxcXCJjYXRhbG9nXFxcIiBjbGFzcz1cXFwidGFiYmFibGUtcGFuZWwgY2F0YWxvZ1xcXCI+XFxuICA8ZGl2IGNsYXNzPVxcXCJ0YWJiYWJsZS1saW5lXFxcIj5cXG4gICAgPHVsIGNsYXNzPVxcXCJuYXYgbmF2LXRhYnNcXFwiIHJvbGU9XFxcInRhYmxpc3RcXFwiPlxcbiAgICAgIDxsaSByb2xlPVxcXCJwcmVzZW50YXRpb25cXFwiIGNsYXNzPVxcXCJhY3RpdmVcXFwiPjxhIGhyZWY9XFxcIiN0cmVlXFxcIiBhcmlhLWNvbnRyb2xzPVxcXCJ0cmVlXFxcIiByb2xlPVxcXCJ0YWJcXFwiIGRhdGEtdG9nZ2xlPVxcXCJ0YWJcXFwiIGRhdGEtaTE4bj1cXFwidHJlZVxcXCI+PC9hPjwvbGk+XFxuICAgICAgPGxpIHYtaWY9XFxcImhhc0Jhc2VMYXllcnNcXFwiIHJvbGU9XFxcInByZXNlbnRhdGlvblxcXCI+PGEgaHJlZj1cXFwiI2Jhc2VsYXllcnNcXFwiIGFyaWEtY29udHJvbHM9XFxcImJhc2VsYXllcnNcXFwiIHJvbGU9XFxcInRhYlxcXCIgZGF0YS10b2dnbGU9XFxcInRhYlxcXCIgZGF0YS1pMThuPVxcXCJiYXNlbGF5ZXJzXFxcIj48L2E+PC9saT5cXG4gICAgICA8bGkgcm9sZT1cXFwicHJlc2VudGF0aW9uXFxcIj48YSBocmVmPVxcXCIjbGVnZW5kXFxcIiBhcmlhLWNvbnRyb2xzPVxcXCJsZWdlbmRcXFwiIHJvbGU9XFxcInRhYlxcXCIgZGF0YS10b2dnbGU9XFxcInRhYlxcXCIgZGF0YS1pMThuPVxcXCJsZWdlbmRcXFwiPjwvYT48L2xpPlxcbiAgICA8L3VsPlxcbiAgICA8ZGl2ICBjbGFzcz1cXFwidGFiLWNvbnRlbnRcXFwiPlxcbiAgICAgIDxkaXYgcm9sZT1cXFwidGFicGFuZWxcXFwiIGNsYXNzPVxcXCJ0YWItcGFuZSBhY3RpdmUgdHJlZVxcXCIgaWQ9XFxcInRyZWVcXFwiPlxcbiAgICAgICAgPHVsIGNsYXNzPVxcXCJ0cmVlLXJvb3RcXFwiPlxcbiAgICAgICAgICA8dHJpc3RhdGUtdHJlZSA6bGF5ZXJzdHJlZT1cXFwibGF5ZXJzdHJlZVxcXCIgY2xhc3M9XFxcIml0ZW1cXFwiIHYtZm9yPVxcXCJsYXllcnN0cmVlIGluIGxheWVyc3RyZWVcXFwiPlxcbiAgICAgICAgICA8L3RyaXN0YXRlLXRyZWU+XFxuICAgICAgICA8L3VsPlxcbiAgICAgIDwvZGl2PlxcbiAgICAgIDxkaXYgdi1pZj1cXFwiaGFzQmFzZUxheWVyc1xcXCIgcm9sZT1cXFwidGFicGFuZWxcXFwiIGNsYXNzPVxcXCJ0YWItcGFuZSBiYXNlbGF5ZXJzXFxcIiBpZD1cXFwiYmFzZWxheWVyc1xcXCI+XFxuICAgICAgICA8Zm9ybT5cXG4gICAgICAgICAgPHVsPlxcbiAgICAgICAgICAgIDxsaSB2LWlmPVxcXCIhYmFzZWxheWVyLmZpeGVkXFxcIiB2LWZvcj1cXFwiYmFzZWxheWVyIGluIGJhc2VsYXllcnNcXFwiPlxcbiAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cXFwicmFkaW9cXFwiPlxcbiAgICAgICAgICAgICAgICA8bGFiZWw+PGlucHV0IHR5cGU9XFxcInJhZGlvXFxcIiBuYW1lPVxcXCJiYXNlbGF5ZXJcXFwiIHYtY2hlY2tlZD1cXFwiYmFzZWxheWVyLnZpc2libGVcXFwiIEBjbGljaz1cXFwic2V0QmFzZUxheWVyKGJhc2VsYXllci5pZClcXFwiPnt7IGJhc2VsYXllci50aXRsZSB9fTwvbGFiZWw+XFxuICAgICAgICAgICAgICA8L2Rpdj5cXG4gICAgICAgICAgICA8L2xpPlxcbiAgICAgICAgICA8L3VsPlxcbiAgICAgICAgPC9mb3JtPlxcbiAgICAgIDwvZGl2PlxcbiAgICAgIDxsZWdlbmQgOmxheWVyc3RyZWU9XFxcImxheWVyc3RyZWVcXFwiPjwvbGVnZW5kPlxcbiAgICA8L2Rpdj5cXG4gIDwvZGl2PlxcbjwvZGl2PlxcblwiO1xuIiwidmFyIHQgPSByZXF1aXJlKCdpMThuL2kxOG4uc2VydmljZScpLnQ7XG52YXIgR1VJID0gcmVxdWlyZSgnZzN3L2d1aS9ndWknKTtcbnZhciBQcm9qZWN0c1JlZ2lzdHJ5ID0gcmVxdWlyZSgnZzN3L2NvcmUvcHJvamVjdHNyZWdpc3RyeScpO1xudmFyIFByb2plY3RTZXJ2aWNlID0gcmVxdWlyZSgnZzN3L2NvcmUvcHJvamVjdHNlcnZpY2UnKS5Qcm9qZWN0U2VydmljZTtcblxuVnVlLmNvbXBvbmVudCgnZzN3LWNhdGFsb2cnLHtcbiAgICB0ZW1wbGF0ZTogcmVxdWlyZSgnLi9jYXRhbG9nLmh0bWwnKSxcbiAgICBkYXRhOiBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN0YXRlOiBQcm9qZWN0U2VydmljZS5zdGF0ZVxuICAgICAgfVxuICAgIH0sXG4gICAgY29tcHV0ZWQ6IHtcbiAgICAgIGxheWVyc3RyZWU6IGZ1bmN0aW9uKCl7XG4gICAgICAgIHJldHVybiB0aGlzLnN0YXRlLnByb2plY3QubGF5ZXJzdHJlZTtcbiAgICAgIH0sXG4gICAgICBiYXNlbGF5ZXJzOiBmdW5jdGlvbigpe1xuICAgICAgICByZXR1cm4gdGhpcy5zdGF0ZS5iYXNlTGF5ZXJzO1xuICAgICAgfSxcbiAgICAgIGhhc0Jhc2VMYXllcnM6IGZ1bmN0aW9uKCl7XG4gICAgICAgIHJldHVybiB0aGlzLnN0YXRlLmJhc2VMYXllcnMubGVuZ3RoPjA7XG4gICAgICB9XG4gICAgfSxcbiAgICBtZXRob2RzOiB7XG4gICAgICBzZXRCYXNlTGF5ZXI6IGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgIFByb2plY3RTZXJ2aWNlLnNldEJhc2VMYXllcihpZCk7XG4gICAgICB9XG4gICAgfSxcbiAgICByZWFkeTogZnVuY3Rpb24oKSB7XG4gICAgICAvL1xuICAgIH1cbn0pO1xuXG4vLyB0cmVlIGNvbXBvbmVudFxuVnVlLmNvbXBvbmVudCgndHJpc3RhdGUtdHJlZScsIHtcbiAgdGVtcGxhdGU6IHJlcXVpcmUoJy4vdHJpc3RhdGUtdHJlZS5odG1sJyksXG4gIHByb3BzOiB7XG4gICAgbGF5ZXJzdHJlZTogW10sXG4gICAgLy9lcmVkaXRvIGlsIG51bWVybyBkaSBjaGlsZHMgZGFsIHBhcmVudFxuICAgIG5fcGFyZW50Q2hpbGRzIDogMCxcbiAgICBjaGVja2VkOiBmYWxzZVxuICB9LFxuICBkYXRhOiBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGV4cGFuZGVkOiB0aGlzLmxheWVyc3RyZWUuZXhwYW5kZWQsXG4gICAgICBwYXJlbnRDaGVja2VkOiBmYWxzZSxcbiAgICAgIC8vcHJvcHJpZXRhIGNoZSBzZXJ2ZSBwZXIgZmFyZSBjb25mcm9udG8gcGVyIGlsIHRyaXN0YXRlXG4gICAgICBuX2NoaWxkczogdGhpcy5sYXllcnN0cmVlLm5vZGVzID8gdGhpcy5sYXllcnN0cmVlLm5vZGVzLmxlbmd0aCA6IDBcbiAgICB9XG4gIH0sXG4gIHdhdGNoOiB7XG4gICAgICAnY2hlY2tlZCc6IGZ1bmN0aW9uICh2YWwpe1xuICAgICAgICB0aGlzLmxheWVyc3RyZWUudmlzaWJsZSA9IHZhbDtcbiAgICAgIH1cbiAgfSxcbiAgY29tcHV0ZWQ6IHtcbiAgICBpc0ZvbGRlcjogZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIGlzRm9sZGVyID0gdGhpcy5uX2NoaWxkcyA/IHRydWUgOiBmYWxzZTtcbiAgICAgIGlmIChpc0ZvbGRlcikge1xuICAgICAgICB2YXIgX3Zpc2libGVDaGlsZHMgPSAwO1xuICAgICAgICBfLmZvckVhY2godGhpcy5sYXllcnN0cmVlLm5vZGVzLGZ1bmN0aW9uKGxheWVyKXtcbiAgICAgICAgICBpZiAobGF5ZXIudmlzaWJsZSl7XG4gICAgICAgICAgICBfdmlzaWJsZUNoaWxkcyArPSAxO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMubl9wYXJlbnRDaGlsZHMgPSB0aGlzLm5fY2hpbGRzIC0gX3Zpc2libGVDaGlsZHM7XG4gICAgICB9XG4gICAgICByZXR1cm4gaXNGb2xkZXJcbiAgICB9LFxuICAgIGlzSGlkZGVuOiBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiB0aGlzLmxheWVyc3RyZWUuaGlkZGVuICYmICh0aGlzLmxheWVyc3RyZWUuaGlkZGVuID09PSB0cnVlKTtcbiAgICB9XG4gIH0sXG4gIG1ldGhvZHM6IHtcbiAgICB0b2dnbGU6IGZ1bmN0aW9uIChjaGVja0FsbExheWVycykge1xuICAgICAgdmFyIGNoZWNrQWxsID0gY2hlY2tBbGxMYXllcnMgPT0gJ3RydWUnID8gdHJ1ZSA6IGZhbHNlO1xuICAgICAgaWYgKHRoaXMuaXNGb2xkZXIgJiYgIWNoZWNrQWxsKSB7XG4gICAgICAgIHRoaXMubGF5ZXJzdHJlZS5leHBhbmRlZCA9ICF0aGlzLmxheWVyc3RyZWUuZXhwYW5kZWQ7XG4gICAgICB9XG4gICAgICBlbHNlIGlmIChjaGVja0FsbCl7XG4gICAgICAgIGlmICh0aGlzLnBhcmVudENoZWNrZWQgJiYgIXRoaXMubl9wYXJlbnRDaGlsZHMpe1xuICAgICAgICAgIHRoaXMucGFyZW50Q2hlY2tlZCA9IGZhbHNlO1xuICAgICAgICB9IGVsc2UgaWYgKHRoaXMucGFyZW50Q2hlY2tlZCAmJiB0aGlzLm5fcGFyZW50Q2hpbGRzKSB7XG4gICAgICAgICAgdGhpcy5wYXJlbnRDaGVja2VkID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICB0aGlzLnBhcmVudENoZWNrZWQgPSAhdGhpcy5wYXJlbnRDaGVja2VkO1xuICAgICAgICB9XG4gICAgICAgIFByb2plY3RTZXJ2aWNlLnRvZ2dsZUxheWVycyh0aGlzLmxheWVyc3RyZWUubm9kZXMsdGhpcy5wYXJlbnRDaGVja2VkKTtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICBQcm9qZWN0U2VydmljZS50b2dnbGVMYXllcih0aGlzLmxheWVyc3RyZWUpO1xuICAgICAgfVxuICAgIH0sXG4gICAgdHJpQ2xhc3M6IGZ1bmN0aW9uICgpIHtcbiAgICAgIGlmICghdGhpcy5uX3BhcmVudENoaWxkcykge1xuICAgICAgICByZXR1cm4gJ2ZhLWNoZWNrLXNxdWFyZS1vJztcbiAgICAgIH0gZWxzZSBpZiAoKHRoaXMubl9wYXJlbnRDaGlsZHMgPiAwKSAmJiAodGhpcy5uX3BhcmVudENoaWxkcyA8IHRoaXMubl9jaGlsZHMpKSB7XG4gICAgICAgIHJldHVybiAnZmEtc3F1YXJlJztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiAnZmEtc3F1YXJlLW8nO1xuICAgICAgfVxuICAgIH1cbiAgfVxufSlcblxuVnVlLmNvbXBvbmVudCgnbGVnZW5kJyx7XG4gICAgdGVtcGxhdGU6IHJlcXVpcmUoJy4vbGVnZW5kLmh0bWwnKSxcbiAgICBwcm9wczogWydsYXllcnN0cmVlJ10sXG4gICAgZGF0YTogZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICAvL2RhdGEgcXVpXG4gICAgICB9XG4gICAgfSxcbiAgICBjb21wdXRlZDoge1xuICAgICAgdmlzaWJsZWxheWVyczogZnVuY3Rpb24oKXtcbiAgICAgICAgdmFyIF92aXNpYmxlbGF5ZXJzID0gW107XG4gICAgICAgIHZhciBsYXllcnN0cmVlID0gdGhpcy5sYXllcnN0cmVlO1xuICAgICAgICBmdW5jdGlvbiB0cmF2ZXJzZShvYmope1xuICAgICAgICBfLmZvckluKG9iaiwgZnVuY3Rpb24gKGxheWVyLCBrZXkpIHtcbiAgICAgICAgICAgICAgLy92ZXJpZmljYSBjaGUgaWwgdmFsb3JlIGRlbGwnaWQgbm9uIHNpYSBudWxsb1xuICAgICAgICAgICAgICBpZiAoIV8uaXNOaWwobGF5ZXIuaWQpICYmIGxheWVyLnZpc2libGUpIHtcbiAgICAgICAgICAgICAgICAgIF92aXNpYmxlbGF5ZXJzLnB1c2gobGF5ZXIpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGlmICghXy5pc05pbChsYXllci5ub2RlcykpIHtcbiAgICAgICAgICAgICAgICAgIHRyYXZlcnNlKGxheWVyLm5vZGVzKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIHRyYXZlcnNlKGxheWVyc3RyZWUpO1xuICAgICAgICByZXR1cm4gX3Zpc2libGVsYXllcnM7XG4gICAgICB9XG4gICAgfSxcbiAgICB3YXRjaDoge1xuICAgICAgJ2xheWVyc3RyZWUnOiB7XG4gICAgICAgIGhhbmRsZXI6IGZ1bmN0aW9uKHZhbCwgb2xkKXtcbiAgICAgICAgICAvL2NvZGljZSBxdWlcbiAgICAgICAgfSxcbiAgICAgICAgZGVlcDogdHJ1ZVxuICAgICAgfVxuICAgIH0sXG4gICAgcmVhZHk6IGZ1bmN0aW9uKCkge1xuICAgICAgLy9jb2RpY2UgcXVpXG4gICAgfVxufSk7XG5cblZ1ZS5jb21wb25lbnQoJ2xlZ2VuZC1pdGVtJyx7XG4gIHRlbXBsYXRlOiByZXF1aXJlKCcuL2xlZ2VuZF9pdGVtLmh0bWwnKSxcbiAgcHJvcHM6IFsnbGF5ZXInXSxcbiAgY29tcHV0ZWQ6IHtcbiAgICBsZWdlbmR1cmw6IGZ1bmN0aW9uKCl7XG4gICAgICAvLyBpbiBhdHRlc2EgZGkgcmlzb2x2ZXJlIGxvIHNjaGlhbnRvIGRpIFFHU0kgU2VydmVyLi4uXG4gICAgICAvL3JldHVybiBcImh0dHA6Ly9sb2NhbGhvc3QvY2dpLWJpbi9xZ2lzX21hcHNlcnYuZmNnaT9tYXA9L2hvbWUvZ2lvaGFwcHkvU2NyaXZhbmlhL0Rldi9HM1cvZzN3LWNsaWVudC90ZXN0L3Byb2dldHRvL3Rlc3QucWdzJlNFUlZJQ0U9V01TJlZFUlNJT049MS4zLjAmUkVRVUVTVD1HZXRMZWdlbmRHcmFwaGljJkZPUk1BVD1pbWFnZS9wbmcmTEFZRVJUSVRMRT1GYWxzZSZJVEVNRk9OVFNJWkU9MTAmTEFZRVI9XCIrdGhpcy5sYXllci5uYW1lO1xuICAgICAgcmV0dXJuIFByb2plY3RTZXJ2aWNlLmdldExlZ2VuZFVybCh0aGlzLmxheWVyKTtcbiAgICB9XG4gIH0sXG4gIG1ldGhvZHM6IHtcbiAgICAvLyBlc2VtcGlvIHV0aWxpenpvIGRlbCBzZXJ2aXppbyBHVUlcbiAgICBvcGVuZm9ybTogZnVuY3Rpb24oKXtcbiAgICAgIC8vR1VJLm5vdGlmeS5zdWNjZXNzKFwiQXBybyB1biBmb3JtXCIpO1xuICAgICAgLy9HVUkuc2hvd0Zvcm0oKTtcbiAgICB9XG4gIH1cbn0pXG4iLCJtb2R1bGUuZXhwb3J0cyA9IFwiPGRpdiByb2xlPVxcXCJ0YWJwYW5lbFxcXCIgY2xhc3M9XFxcInRhYi1wYW5lXFxcIiBpZD1cXFwibGVnZW5kXFxcIj5cXG4gIDxsZWdlbmQtaXRlbSA6bGF5ZXI9XFxcImxheWVyXFxcIiB2LWZvcj1cXFwibGF5ZXIgaW4gdmlzaWJsZWxheWVyc1xcXCI+PC9sZWdlbmQtaXRlbT5cXG48L2Rpdj5cXG5cIjtcbiIsIm1vZHVsZS5leHBvcnRzID0gXCI8ZGl2IEBjbGljaz1cXFwib3BlbmZvcm0oKVxcXCI+e3sgbGF5ZXIudGl0bGUgfX08L2Rpdj5cXG48ZGl2PjxpbWcgOnNyYz1cXFwibGVnZW5kdXJsXFxcIj48L2Rpdj5cXG5cIjtcbiIsIm1vZHVsZS5leHBvcnRzID0gXCI8bGkgdi1pZj1cXFwiIWlzSGlkZGVuXFxcIiBjbGFzcz1cXFwidHJlZS1pdGVtXFxcIj5cXG4gIDxzcGFuIDpjbGFzcz1cXFwie2JvbGQ6IGlzRm9sZGVyLCAnZmEtY2hldnJvbi1kb3duJzogbGF5ZXJzdHJlZS5leHBhbmRlZCwgJ2ZhLWNoZXZyb24tcmlnaHQnOiAhbGF5ZXJzdHJlZS5leHBhbmRlZH1cXFwiIEBjbGljaz1cXFwidG9nZ2xlXFxcIiB2LWlmPVxcXCJpc0ZvbGRlclxcXCIgY2xhc3M9XFxcImZhXFxcIj48L3NwYW4+XFxuICA8c3BhbiB2LWlmPVxcXCJpc0ZvbGRlclxcXCIgQGNsaWNrPVxcXCJ0b2dnbGUoJ3RydWUnKVxcXCIgOmNsYXNzPVxcXCJbdHJpQ2xhc3MoKV1cXFwiIGNsYXNzPVxcXCJmYVxcXCI+PC9zcGFuPlxcbiAgPHNwYW4gdi1lbHNlIEBjbGljaz1cXFwidG9nZ2xlXFxcIiA6Y2xhc3M9XFxcIltsYXllcnN0cmVlLnZpc2libGUgID8gJ2ZhLWNoZWNrLXNxdWFyZS1vJzogJ2ZhLXNxdWFyZS1vJyxsYXllcnN0cmVlLmRpc2FibGVkICA/ICdkaXNhYmxlZCc6ICcnXVxcXCIgY2xhc3M9XFxcImZhXFxcIiBzdHlsZT1cXFwiY3Vyc29yOmRlZmF1bHRcXFwiPjwvc3Bhbj5cXG4gIDxzcGFuIDpjbGFzcz1cXFwie2JvbGQ6IGlzRm9sZGVyLCBkaXNhYmxlZDogbGF5ZXJzdHJlZS5kaXNhYmxlZH1cXFwiIEBjbGljaz1cXFwidG9nZ2xlXFxcIj57e2xheWVyc3RyZWUudGl0bGV9fTwvc3Bhbj5cXG4gIDx1bCB2LXNob3c9XFxcImxheWVyc3RyZWUuZXhwYW5kZWRcXFwiIHYtaWY9XFxcImlzRm9sZGVyXFxcIj5cXG4gICAgPHRyaXN0YXRlLXRyZWUgOm5fcGFyZW50LWNoaWxkcy5zeW5jPVxcXCJuX3BhcmVudENoaWxkc1xcXCIgOmxheWVyc3RyZWU9XFxcImxheWVyc3RyZWVcXFwiIDpjaGVja2VkPVxcXCJwYXJlbnRDaGVja2VkXFxcIiB2LWZvcj1cXFwibGF5ZXJzdHJlZSBpbiBsYXllcnN0cmVlLm5vZGVzXFxcIj5cXG4gICAgPC90cmlzdGF0ZS10cmVlPlxcbiAgPC91bD5cXG48L2xpPlxcblxcblxcblxcblwiO1xuIiwidmFyIHJlc29sdmVkVmFsdWUgPSByZXF1aXJlKCdnM3cvY29yZS91dGlscycpLnJlc29sdmVkVmFsdWU7XG52YXIgcmVqZWN0ZWRWYWx1ZSA9IHJlcXVpcmUoJ2czdy9jb3JlL3V0aWxzJykucmVqZWN0ZWRWYWx1ZTtcbnZhciBHVUkgPSByZXF1aXJlKCdnM3cvZ3VpL2d1aScpO1xudmFyIFByb2plY3RTZXJ2aWNlID0gcmVxdWlyZSgnZzN3L2NvcmUvcHJvamVjdHNlcnZpY2UnKS5Qcm9qZWN0U2VydmljZTtcbnZhciBNYXBTZXJ2aWNlID0gcmVxdWlyZSgnZzN3L2NvcmUvbWFwc2VydmljZScpO1xuXG5WdWUuZmlsdGVyKCdzdGFydGNhc2UnLCBmdW5jdGlvbiAodmFsdWUpIHtcbiAgcmV0dXJuIF8uc3RhcnRDYXNlKHZhbHVlKTtcbn0pO1xuXG5WdWUudmFsaWRhdG9yKCdlbWFpbCcsIGZ1bmN0aW9uICh2YWwpIHtcbiAgcmV0dXJuIC9eKChbXjw+KClbXFxdXFxcXC4sOzpcXHNAXFxcIl0rKFxcLltePD4oKVtcXF1cXFxcLiw7Olxcc0BcXFwiXSspKil8KFxcXCIuK1xcXCIpKUAoKFxcW1swLTldezEsM31cXC5bMC05XXsxLDN9XFwuWzAtOV17MSwzfVxcLlswLTldezEsM31cXF0pfCgoW2EtekEtWlxcLTAtOV0rXFwuKStbYS16QS1aXXsyLH0pKSQvLnRlc3QodmFsKVxufSk7XG5cblZ1ZS52YWxpZGF0b3IoJ2ludGVnZXInLCBmdW5jdGlvbiAodmFsKSB7XG4gIHJldHVybiAvXigtP1sxLTldXFxkKnwwKSQvLnRlc3QodmFsKTtcbn0pXG5cbnZhciBGb3JtUGFuZWwgPSBWdWUuZXh0ZW5kKHtcbiAgdGVtcGxhdGU6IHJlcXVpcmUoJy4vZm9ybXBhbmVsLmh0bWwnKSxcbiAgbWV0aG9kczoge1xuICAgIGV4ZWM6IGZ1bmN0aW9uKGNiayl7XG4gICAgICB2YXIgcmVsYXRpb25zID0gdGhpcy5zdGF0ZS5yZWxhdGlvbnMgfHwgbnVsbDtcbiAgICAgIGNiayh0aGlzLnN0YXRlLmZpZWxkcyxyZWxhdGlvbnMpO1xuICAgICAgR1VJLmNsb3NlRm9ybSgpO1xuICAgIH0sXG4gICAgYnRuRW5hYmxlZDogZnVuY3Rpb24oYnV0dG9uKSB7XG4gICAgICByZXR1cm4gYnV0dG9uLnR5cGUgIT0gJ3NhdmUnIHx8IChidXR0b24udHlwZSA9PSAnc2F2ZScgJiYgdGhpcy4kdmFsaWRhdGlvbi52YWxpZCk7XG4gICAgfSxcbiAgICBoYXNGaWVsZHNSZXF1aXJlZDogZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gdGhpcy4kb3B0aW9ucy5mb3JtLl9oYXNGaWVsZHNSZXF1aXJlZCgpO1xuICAgIH0sXG4gICAgaXNFZGl0YWJsZTogZnVuY3Rpb24oZmllbGQpe1xuICAgICAgcmV0dXJuIHRoaXMuJG9wdGlvbnMuZm9ybS5faXNFZGl0YWJsZShmaWVsZCk7XG4gICAgfSxcbiAgICBpc1NpbXBsZTogZnVuY3Rpb24oZmllbGQpe1xuICAgICAgcmV0dXJuIHRoaXMuJG9wdGlvbnMuZm9ybS5faXNTaW1wbGUoZmllbGQpO1xuICAgIH0sXG4gICAgaXNCb29sZWFuOiBmdW5jdGlvbihmaWVsZCkge1xuICAgICAgcmV0dXJuIHRoaXMuJG9wdGlvbnMuZm9ybS5faXNCb29sZWFuKGZpZWxkKTtcbiAgICB9LFxuICAgIGlzU2VsZWN0OiBmdW5jdGlvbihmaWVsZCl7XG4gICAgICByZXR1cm4gdGhpcy4kb3B0aW9ucy5mb3JtLl9pc1NlbGVjdChmaWVsZCk7XG4gICAgfSxcbiAgICBpc0xheWVyUGlja2VyOiBmdW5jdGlvbihmaWVsZCl7XG4gICAgICByZXR1cm4gdGhpcy4kb3B0aW9ucy5mb3JtLl9pc0xheWVyUGlja2VyKGZpZWxkKTtcbiAgICB9LFxuICAgIGxheWVyUGlja2VyUGxhY2VIb2xkZXI6IGZ1bmN0aW9uKGZpZWxkKXtcbiAgICAgIHJldHVybiB0aGlzLiRvcHRpb25zLmZvcm0uX2dldGxheWVyUGlja2VyTGF5ZXJOYW1lKGZpZWxkLmlucHV0Lm9wdGlvbnMubGF5ZXJpZCk7XG4gICAgfSxcbiAgICBwaWNrTGF5ZXI6IGZ1bmN0aW9uKGZpZWxkKXtcbiAgICAgIHRoaXMuJG9wdGlvbnMuZm9ybS5fcGlja0xheWVyKGZpZWxkKTtcbiAgICB9LFxuICAgIGlzVmlzaWJsZTogZnVuY3Rpb24oZmllbGQpe1xuICAgICAgcmV0dXJuIHRoaXMuJG9wdGlvbnMuZm9ybS5faXNWaXNpYmxlKGZpZWxkKTtcbiAgICB9LFxuICAgIHNob3dSZWxhdGlvbjogZnVuY3Rpb24ocmVsYXRpb24pe1xuICAgICAgcmV0dXJuIHRoaXMuJG9wdGlvbnMuZm9ybS5fc2hvdWxkU2hvd1JlbGF0aW9uKHJlbGF0aW9uKTtcbiAgICB9XG4gIH0sXG4gIGNvbXB1dGVkOiB7XG4gICAgaXNWYWxpZDogZnVuY3Rpb24oZmllbGQpIHtcbiAgICAgIHJldHVybiB0aGlzLiR2YWxpZGF0ZShmaWVsZC5uYW1lKTtcbiAgICB9LFxuICB9XG59KTtcblxudmFyIElucHV0cyA9IHt9O1xuSW5wdXRzLlNUUklORyA9ICdzdHJpbmcnO1xuSW5wdXRzLklOVEVHRVIgPSAnaW50ZWdlcic7XG5JbnB1dHMuRkxPQVQgPSAnZmxvYXQnO1xuSW5wdXRzLkJPT0xFQU4gPSAnYm9vbGVhbic7XG5cbklucHV0cy5kZWZhdWx0cyA9IHt9O1xuSW5wdXRzLmRlZmF1bHRzW0lucHV0cy5TVFJJTkddID0gXCJcIjtcbklucHV0cy5kZWZhdWx0c1tJbnB1dHMuSU5URUdFUl0gPSAwO1xuSW5wdXRzLmRlZmF1bHRzW0lucHV0cy5GTE9BVF0gPSAwLjA7XG5JbnB1dHMuZGVmYXVsdHNbSW5wdXRzLkJPT0xFQU5dID0gZmFsc2U7XG5JbnB1dHMuc2ltcGxlRmllbGRUeXBlcyA9IFtJbnB1dHMuU1RSSU5HLElucHV0cy5JTlRFR0VSLElucHV0cy5GTE9BVF07XG5cbklucHV0cy5TRUxFQ1QgPSAnc2VsZWN0JztcbklucHV0cy5MQVlFUlBJQ0tFUiA9ICdsYXllcnBpY2tlcic7XG5cbklucHV0cy5zcGVjaWFsSW5wdXRzID0gW0lucHV0cy5TRUxFQ1QsSW5wdXRzLkxBWUVSUElDS0VSXTtcblxuZnVuY3Rpb24gRm9ybShvcHRpb25zKXtcbiAgLy8gcHJvcHJpZXTDoCBuZWNlc3NhcmllLiBJbiBmdXR1cm8gbGUgbWV0dGVybW8gaW4gdW5hIGNsYXNzZSBQYW5lbCBkYSBjdWkgZGVyaXZlcmFubm8gdHV0dGkgaSBwYW5uZWxsaSBjaGUgdm9nbGlvbm8gZXNzZXJlIG1vc3RyYXRpIG5lbGxhIHNpZGViYXJcbiAgdGhpcy5wYW5lbENvbXBvbmVudCA9IG51bGw7XG4gIHRoaXMub3B0aW9ucyA9ICBvcHRpb25zIHx8IHt9O1xuICB0aGlzLmlkID0gb3B0aW9ucy5pZDsgLy8gaWQgZGVsIGZvcm1cbiAgdGhpcy5uYW1lID0gb3B0aW9ucy5uYW1lOyAvLyBub21lIGRlbCBmb3JtXG4gIHRoaXMuZGF0YWlkID0gb3B0aW9ucy5kYXRhaWQ7IC8vIFwiYWNjZXNzaVwiLCBcImdpdW56aW9uaVwiLCBlY2MuXG4gIHRoaXMucGsgPSBvcHRpb25zLnBrIHx8IG51bGwsIC8vIGV2ZW50dWFsZSBjaGlhdmUgcHJpbWFyaWEgKG5vbiB0dXR0aSBpIGZvcm0gcG90cmViYmVybyBhdmVyY2VsYSBvIGF2ZXJuZSBiaXNvZ25vXG4gIHRoaXMuaXNuZXcgPSAoIV8uaXNOaWwob3B0aW9ucy5pc25ldykgJiYgXy5pc0Jvb2xlYW4ob3B0aW9ucy5pc25ldykpID8gb3B0aW9ucy5pc25ldyA6IHRydWU7XG4gIFxuICB0aGlzLnN0YXRlID0ge1xuICAgIC8vIGkgZGF0aSBkZWwgZm9ybSBwb3Nzb25vIGF2ZXJlIG8gbWVubyB1bmEgcHJpbWFyeSBrZXlcbiAgICBmaWVsZHM6IG9wdGlvbnMuZmllbGRzLFxuICAgIHJlbGF0aW9uczogb3B0aW9ucy5yZWxhdGlvbnNcbiAgfVxuICBcbiAgdGhpcy5fZm9ybVBhbmVsID0gb3B0aW9ucy5mb3JtUGFuZWwgfHwgRm9ybVBhbmVsO1xuICB0aGlzLl9kZWZhdWx0cyA9IG9wdGlvbnMuZGVmYXVsdHMgfHwgSW5wdXRzLmRlZmF1bHRzO1xufVxuXG52YXIgcHJvdG8gPSBGb3JtLnByb3RvdHlwZTtcblxuLy8gdmllbmUgcmljaGlhbWF0byBkYWxsYSB0b29sYmFyIHF1YW5kbyBpbCBwbHVnaW4gY2hpZWRlIGRpIG1vc3RyYXJlIHVuIHByb3ByaW8gcGFubmVsbG8gbmVsbGEgR1VJIChHVUkuc2hvd1BhbmVsKVxucHJvdG8ub25TaG93ID0gZnVuY3Rpb24oY29udGFpbmVyKXtcbiAgdGhpcy5fc2V0dXBGaWVsZHMoKTtcbiAgdmFyIHBhbmVsID0gdGhpcy5fc2V0dXBQYW5lbCgpO1xuICB0aGlzLl9tb3VudFBhbmVsKHBhbmVsLGNvbnRhaW5lcik7XG4gIHJldHVybiByZXNvbHZlZFZhbHVlKHRydWUpO1xufTtcblxuLy8gcmljaGlhbWF0byBxdWFuZG8gbGEgR1VJIGNoaWVkZSBkaSBjaGl1ZGVyZSBpbCBwYW5uZWxsby4gU2Ugcml0b3JuYSBmYWxzZSBpbCBwYW5uZWxsbyBub24gdmllbmUgY2hpdXNvXG5wcm90by5vbkNsb3NlID0gZnVuY3Rpb24oKXtcbiAgdGhpcy5wYW5lbENvbXBvbmVudC4kZGVzdHJveSh0cnVlKTtcbiAgdGhpcy5wYW5lbENvbXBvbmVudCA9IG51bGw7XG4gIHJldHVybiByZXNvbHZlZFZhbHVlKHRydWUpO1xufTtcblxucHJvdG8uX2lzTmV3ID0gZnVuY3Rpb24oKXtcbiAgcmV0dXJuIHRoaXMuaXNuZXc7XG59O1xuXG5wcm90by5faGFzRmllbGRzUmVxdWlyZWQgPSBmdW5jdGlvbigpIHtcbiAgdmFyIHNvbWVGaWVsZHNSZXF1aXJlZCA9IF8uc29tZSh0aGlzLnN0YXRlLmZpZWxkcyxmdW5jdGlvbihmaWVsZCl7XG4gICAgcmV0dXJuIGZpZWxkLnZhbGlkYXRlICYmIGZpZWxkLnZhbGlkYXRlLnJlcXVpcmVkO1xuICB9KTtcbiAgdmFyIHNvbWVSZWxhdGlvbnNSZXF1aXJlZCA9IF8uc29tZSh0aGlzLnN0YXRlLnJlbGF0aW9ucyxmdW5jdGlvbihyZWxhdGlvbil7XG4gICAgcmV0dXJuIHJlbGF0aW9uLnZhbGlkYXRlICYmIHJlbGF0aW9uLnZhbGlkYXRlLnJlcXVpcmVkO1xuICB9KTtcbiAgcmV0dXJuIHNvbWVGaWVsZHNSZXF1aXJlZCB8fCBzb21lUmVsYXRpb25zUmVxdWlyZWQ7XG59O1xuXG5wcm90by5faXNWaXNpYmxlID0gZnVuY3Rpb24oZmllbGQpe1xuICBpZighZmllbGQuZWRpdGFibGUgJiYgKGZpZWxkLnZhbHVlID09IFwiXCIgfHwgXy5pc051bGwoZmllbGQudmFsdWUpKSl7XG4gICAgcmV0dXJuIGZhbHNlXG4gIH1cbiAgcmV0dXJuIHRydWU7XG59O1xuXG5wcm90by5faXNFZGl0YWJsZSA9IGZ1bmN0aW9uKGZpZWxkKXtcbiAgcmV0dXJuIGZpZWxkLmVkaXRhYmxlO1xufTtcblxucHJvdG8uX2lzU2ltcGxlID0gZnVuY3Rpb24oZmllbGQpe1xuICBpZiAoXy5pbmNsdWRlcyhJbnB1dHMuc3BlY2lhbElucHV0cyxmaWVsZC5pbnB1dC50eXBlKSl7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIHJldHVybiBfLmluY2x1ZGVzKElucHV0cy5zaW1wbGVGaWVsZFR5cGVzLGZpZWxkLnR5cGUpXG59O1xuXG5wcm90by5faXNCb29sZWFuID0gZnVuY3Rpb24oZmllbGQpIHtcbiAgcmV0dXJuIGZpZWxkLnR5cGUgPT0gSW5wdXRzLkJPT0xFQU47XG59O1xuXG5wcm90by5faXNTZWxlY3QgPSBmdW5jdGlvbihmaWVsZCl7XG4gIHJldHVybiAoXy5pbmNsdWRlcyhJbnB1dHMuc3BlY2lhbElucHV0cyxmaWVsZC5pbnB1dC50eXBlKSAmJiBmaWVsZC5pbnB1dC50eXBlID09IElucHV0cy5TRUxFQ1QpO1xufTtcblxucHJvdG8uX2lzTGF5ZXJQaWNrZXIgPSBmdW5jdGlvbihmaWVsZCl7XG4gIHJldHVybiAoXy5pbmNsdWRlcyhJbnB1dHMuc3BlY2lhbElucHV0cyxmaWVsZC5pbnB1dC50eXBlKSAmJiBmaWVsZC5pbnB1dC50eXBlID09IElucHV0cy5MQVlFUlBJQ0tFUik7XG59O1xuXG5wcm90by5fcGlja0xheWVyID0gZnVuY3Rpb24oZmllbGQpe1xuICAvLyByaXRvcm5vIHVuYSBwcm9tZXNzYSwgc2UgcXVhbGN1biBhbHRybyB2b2xlc3NlIHVzYXJlIGlsIHJpc3VsdGF0byAoZXMuIHBlciBzZXR0YXJlIGFsdHJpIGNhbXBpIGluIGJhc2UgYWxsYSBmZWF0dXJlIHNlbGV6aW9uYXRhKVxuICB2YXIgZCA9ICQuRGVmZXJyZWQoKTtcbiAgLy8gZGlzYWJpbGl0byB0ZW1wb3JhbmVtYW50ZSBsbyBzdHJhdG8gbW9kYWxlIHBlciBwZXJtZXR0ZXJlIGwnaW50ZXJhemlvbmUgY29uIGxhIG1hcHBhXG4gIEdVSS5zZXRNb2RhbChmYWxzZSk7XG4gIHZhciBsYXllcklkID0gZmllbGQuaW5wdXQub3B0aW9ucy5sYXllcmlkO1xuICB2YXIgcmVsRmllbGROYW1lID0gZmllbGQuaW5wdXQub3B0aW9ucy5maWVsZDtcbiAgdmFyIHJlbEZpZWxkTGFiZWwgPSBQcm9qZWN0U2VydmljZS5nZXRMYXllckF0dHJpYnV0ZUxhYmVsKGxheWVySWQsZmllbGQuaW5wdXQub3B0aW9ucy5maWVsZCk7XG4gIE1hcFNlcnZpY2UuZ2V0RmVhdHVyZUluZm8obGF5ZXJJZClcbiAgLnRoZW4oZnVuY3Rpb24oYXR0cmlidXRlcyl7XG4gICAgdmFyIHZhbHVlID0gYXR0cmlidXRlc1tyZWxGaWVsZE5hbWVdID8gYXR0cmlidXRlc1tyZWxGaWVsZE5hbWVdIDogYXR0cmlidXRlc1tyZWxGaWVsZExhYmVsXTtcbiAgICBmaWVsZC52YWx1ZSA9IHZhbHVlO1xuICAgIGQucmVzb2x2ZShhdHRyaWJ1dGVzKTtcbiAgfSlcbiAgLmFsd2F5cyhmdW5jdGlvbigpe1xuICAgIEdVSS5zZXRNb2RhbCh0cnVlKTtcbiAgICBkLnJlamVjdCgpO1xuICB9KTtcbiAgcmV0dXJuIGQucHJvbWlzZSgpO1xufTtcblxucHJvdG8uX2dldERlZmF1bHRWYWx1ZSA9IGZ1bmN0aW9uKGZpZWxkKXtcbiAgdmFyIGRlZmF1bHRWYWx1ZSA9IG51bGw7XG4gIGlmIChmaWVsZC5pbnB1dCkge1xuICAgIGlmIChmaWVsZC5pbnB1dC5vcHRpb25zICYmIGZpZWxkLmlucHV0Lm9wdGlvbnMuZGVmYXVsdCl7XG4gICAgICBkZWZhdWx0VmFsdWUgPSBmaWVsZC5pbnB1dC5vcHRpb25zLmRlZmF1bHQ7XG4gICAgfVxuICAgIGVsc2UgaWYgKHRoaXMuX2lzU2VsZWN0KGZpZWxkKSl7XG4gICAgICBkZWZhdWx0VmFsdWUgPSBmaWVsZC5pbnB1dC5vcHRpb25zLnZhbHVlc1swXS5rZXk7XG4gICAgfVxuICAgIGVsc2UgaWYgKHRoaXMuX2lzQm9vbGVhbihmaWVsZCkpe1xuICAgICAgZGVmYXVsdFZhbHVlID0gdGhpcy5fZGVmYXVsdHNbSW5wdXRzLkJPT0xFQU5dO1xuICAgIH1cbiAgfVxuICBcbiAgLyplbHNlIHtcbiAgICBkZWZhdWx0VmFsdWUgPSB0aGlzLl9kZWZhdWx0c1tmaWVsZC50eXBlXTtcbiAgfSovXG4gIHJldHVybiBkZWZhdWx0VmFsdWU7XG59O1xuXG5wcm90by5fZ2V0bGF5ZXJQaWNrZXJMYXllck5hbWUgPSBmdW5jdGlvbihpZCl7XG4gIHZhciBsYXllciA9IFByb2plY3RTZXJ2aWNlLmdldExheWVyKGlkKTtcbiAgaWYgKGxheWVyKXtcbiAgICByZXR1cm4gbGF5ZXIubmFtZTtcbiAgfVxuICByZXR1cm4gXCJcIjtcbn07XG5cbnByb3RvLl9zaG91bGRTaG93UmVsYXRpb24gPSBmdW5jdGlvbihyZWxhdGlvbil7XG4gIHJldHVybiB0cnVlO1xufTtcblxuLy8gcGVyIGRlZmluaXJlIGkgdmFsb3JpIGRpIGRlZmF1bHQgbmVsIGNhc28gc2kgdHJhdHRhIGRpIHVuIG51b3ZvIGluc2VyaW1lbnRvXG5wcm90by5fc2V0dXBGaWVsZHMgPSBmdW5jdGlvbigpe1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIFxuICB2YXIgZmllbGRzID0gXy5maWx0ZXIodGhpcy5zdGF0ZS5maWVsZHMsZnVuY3Rpb24oZmllbGQpe1xuICAgIC8vIHR1dHRpIGkgY2FtcGkgZWNjZXR0byBsYSBQSyAoc2Ugbm9uIG51bGxhKVxuICAgIGlmIChzZWxmLnBrICYmIGZpZWxkLnZhbHVlPT1udWxsKXtcbiAgICAgIHJldHVybiAoKGZpZWxkLm5hbWUgIT0gc2VsZi5waykpO1xuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfSk7XG4gIFxuICBfLmZvckVhY2goZmllbGRzLGZ1bmN0aW9uKGZpZWxkKXtcbiAgICBpZihfLmlzTmlsKGZpZWxkLnZhbHVlKSl7XG4gICAgICB2YXIgZGVmYXVsdFZhbHVlID0gc2VsZi5fZ2V0RGVmYXVsdFZhbHVlKGZpZWxkKTtcbiAgICAgIGlmIChkZWZhdWx0VmFsdWUpe1xuICAgICAgICBmaWVsZC52YWx1ZSA9IGRlZmF1bHRWYWx1ZTtcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xuICBcbiAgaWYgKHRoaXMuc3RhdGUucmVsYXRpb25zKXtcbiAgICB2YXIgcmVsYXRpb25zID0gdGhpcy5zdGF0ZS5yZWxhdGlvbnM7XG4gICAgXy5mb3JFYWNoKHJlbGF0aW9ucyxmdW5jdGlvbihyZWxhdGlvbil7XG4gICAgICBfLmZvckVhY2gocmVsYXRpb24uZmllbGRzLGZ1bmN0aW9uKGZpZWxkKXtcbiAgICAgICAgaWYoXy5pc05pbChmaWVsZC52YWx1ZSkpe1xuICAgICAgICAgIHZhciBkZWZhdWx0VmFsdWUgPSBzZWxmLl9nZXREZWZhdWx0VmFsdWUoZmllbGQpO1xuICAgICAgICAgIGlmIChkZWZhdWx0VmFsdWUpe1xuICAgICAgICAgICAgZmllbGQudmFsdWUgPSBkZWZhdWx0VmFsdWU7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9KVxuICB9XG59O1xuXG5wcm90by5fc2V0dXBQYW5lbCA9IGZ1bmN0aW9uKCl7XG4gIHZhciBwYW5lbCA9IHRoaXMucGFuZWxDb21wb25lbnQgPSBuZXcgdGhpcy5fZm9ybVBhbmVsKHtcbiAgICBmb3JtOiB0aGlzXG4gIH0pO1xuICBpZiAodGhpcy5vcHRpb25zLmJ1dHRvbnMpIHtcbiAgICBwYW5lbC5idXR0b25zID0gdGhpcy5vcHRpb25zLmJ1dHRvbnM7XG4gIH1cbiAgcGFuZWwuc3RhdGUgPSB0aGlzLnN0YXRlO1xuICByZXR1cm4gcGFuZWxcbn07XG5cbnByb3RvLl9tb3VudFBhbmVsID0gZnVuY3Rpb24ocGFuZWwsY29udGFpbmVyKXtcbiAgcGFuZWwuJG1vdW50KCkuJGFwcGVuZFRvKGNvbnRhaW5lcik7XG59O1xuXG5wcm90by5fZ2V0RmllbGQgPSBmdW5jdGlvbihmaWVsZE5hbWUpe1xuICB2YXIgZmllbGQgPSBudWxsO1xuICBfLmZvckVhY2godGhpcy5zdGF0ZS5maWVsZHMsZnVuY3Rpb24oZil7XG4gICAgaWYgKGYubmFtZSA9PSBmaWVsZE5hbWUpe1xuICAgICAgZmllbGQgPSBmO1xuICAgIH1cbiAgfSlcbiAgcmV0dXJuIGZpZWxkO1xufTtcblxucHJvdG8uX2dldFJlbGF0aW9uRmllbGQgPSBmdW5jdGlvbihmaWVsZE5hbWUscmVsYXRpb25OYW1lKXtcbiAgdmFyIGZpZWxkID0gbnVsbDtcbiAgXy5mb3JFYWNoKHRoaXMuc3RhdGUucmVsYXRpb25zLGZ1bmN0aW9uKHJlbGF0aW9uLG5hbWUpe1xuICAgIGlmIChyZWxhdGlvbk5hbWUgPT0gbmFtZSl7XG4gICAgICBfLmZvckVhY2gocmVsYXRpb24uZmllbGRzLGZ1bmN0aW9uKGYpe1xuICAgICAgICBpZiAoZi5uYW1lID09IGZpZWxkTmFtZSl7XG4gICAgICAgICAgZmllbGQgPSBmO1xuICAgICAgICB9XG4gICAgICB9KVxuICAgIH1cbiAgfSlcbiAgcmV0dXJuIGZpZWxkO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSB7XG4gIEZvcm06IEZvcm0sXG4gIEZvcm1QYW5lbDogRm9ybVBhbmVsXG59XG4iLCJtb2R1bGUuZXhwb3J0cyA9IFwiPGRpdj5cXG4gIDx2YWxpZGF0b3IgbmFtZT1cXFwidmFsaWRhdGlvblxcXCI+XFxuICAgIDxmb3JtIG5vdmFsaWRhdGUgY2xhc3M9XFxcImZvcm0taG9yaXpvbnRhbCBnM3ctZm9ybVxcXCIgOmNsYXNzPVxcXCJbJHZhbGlkYXRpb25bcmVsZmllbGQubmFtZV0uaW52YWxpZCA/ICdoYXMtZXJyb3InOiAnJ11cXFwiPlxcbiAgICAgIDx0ZW1wbGF0ZSB2LWZvcj1cXFwiZmllbGQgaW4gc3RhdGUuZmllbGRzXFxcIj5cXG4gICAgICAgIDxkaXYgdi1pZj1cXFwiaXNWaXNpYmxlKGZpZWxkKVxcXCIgY2xhc3M9XFxcImZvcm0tZ3JvdXAgaGFzLWZlZWRiYWNrXFxcIiA6Y2xhc3M9XFxcIlskdmFsaWRhdGlvbltmaWVsZC5uYW1lXS5pbnZhbGlkID8gJ2hhcy1lcnJvcic6ICcnXVxcXCI+XFxuICAgICAgICAgIDxsYWJlbCA6Zm9yPVxcXCJmaWVsZC5uYW1lXFxcIiBjbGFzcz1cXFwiY29sLXNtLTQgY29udHJvbC1sYWJlbFxcXCI+e3sgZmllbGQubGFiZWwgfX08c3BhbiB2LWlmPVxcXCJmaWVsZC52YWxpZGF0ZSAmJiBmaWVsZC52YWxpZGF0ZS5yZXF1aXJlZFxcXCI+Kjwvc3Bhbj48L2xhYmVsPlxcbiAgICAgICAgICA8ZGl2IGNsYXNzPVxcXCJjb2wtc20tOFxcXCI+XFxuICAgICAgICAgICAgPGlucHV0IHYtaWY9XFxcImlzU2ltcGxlKGZpZWxkKVxcXCIgOmZpZWxkPVxcXCJmaWVsZC5uYW1lXFxcIiB2LXZhbGlkYXRlPVxcXCJmaWVsZC52YWxpZGF0ZVxcXCIgdi1kaXNhYmxlZD1cXFwiIWlzRWRpdGFibGUoZmllbGQpXFxcIiBjbGFzcz1cXFwiZm9ybS1jb250cm9sXFxcIiB2LW1vZGVsPVxcXCJmaWVsZC52YWx1ZVxcXCIgOmlkPVxcXCJmaWVsZC5uYW1lXFxcIiA6cGxhY2Vob2xkZXI9XFxcImZpZWxkLmlucHV0LmxhYmVsXFxcIj5cXG4gICAgICAgICAgICA8c2VsZWN0IHYtaWY9XFxcImlzU2VsZWN0KGZpZWxkKVxcXCIgOmZpZWxkPVxcXCJmaWVsZC5uYW1lXFxcIiB2LXZhbGlkYXRlPVxcXCJmaWVsZC52YWxpZGF0ZVxcXCIgdi1kaXNhYmxlZD1cXFwiIWlzRWRpdGFibGUoZmllbGQpXFxcIiBjbGFzcz1cXFwiZm9ybS1jb250cm9sXFxcIiB2LW1vZGVsPVxcXCJmaWVsZC52YWx1ZVxcXCIgOmlkPVxcXCJmaWVsZC5uYW1lXFxcIiA6cGxhY2Vob2xkZXI9XFxcImZpZWxkLmlucHV0LmxhYmVsXFxcIj5cXG4gICAgICAgICAgICAgIDxvcHRpb24gdi1mb3I9XFxcInZhbHVlIGluIGZpZWxkLmlucHV0Lm9wdGlvbnMudmFsdWVzXFxcIiB2YWx1ZT1cXFwie3sgdmFsdWUua2V5IH19XFxcIj57eyB2YWx1ZS52YWx1ZSB9fTwvb3B0aW9uPlxcbiAgICAgICAgICAgIDwvc2VsZWN0PlxcbiAgICAgICAgICAgIDxkaXYgdi1pZj1cXFwiaXNCb29sZWFuKGZpZWxkKVxcXCIgY2xhc3M9XFxcImNoZWNrYm94XFxcIj5cXG4gICAgICAgICAgICAgIDxsYWJlbD48aW5wdXQgdHlwZT1cXFwiY2hlY2tib3hcXFwiIHYtbW9kZWw9XFxcImZpZWxkLnZhbHVlXFxcIiA6aWQ9XFxcImZpZWxkLm5hbWVcXFwiIHYtZGlzYWJsZWQ9XFxcIiFpc0VkaXRhYmxlKGZpZWxkKVxcXCI+PC9sYWJlbD5cXG4gICAgICAgICAgICA8L2Rpdj5cXG4gICAgICAgICAgICA8ZGl2IHYtaWY9XFxcImlzTGF5ZXJQaWNrZXIoZmllbGQpXFxcIj5cXG4gICAgICAgICAgICAgIDxpbnB1dCBjbGFzcz1cXFwiZm9ybS1jb250cm9sXFxcIiBAY2xpY2s9XFxcInBpY2tMYXllcihmaWVsZClcXFwiIDpmaWVsZD1cXFwiZmllbGQubmFtZVxcXCIgdi12YWxpZGF0ZT1cXFwiZmllbGQudmFsaWRhdGVcXFwiIHYtZGlzYWJsZWQ9XFxcIiFpc0VkaXRhYmxlKGZpZWxkKVxcXCIgb25mb2N1cz1cXFwiYmx1cigpXFxcIiBkYXRhLXRvZ2dsZT1cXFwidG9vbHRpcFxcXCIgdGl0bGU9XFxcIk90dGllbmkgaWwgZGF0byBkYSB1biBlbGVtZW50byBkZWwgbGF5ZXIgJ3t7IGxheWVyUGlja2VyUGxhY2VIb2xkZXIoZmllbGQpIH19J1xcXCIgdi1tb2RlbD1cXFwiZmllbGQudmFsdWVcXFwiIDppZD1cXFwiZmllbGQubmFtZVxcXCIgOnBsYWNlaG9sZGVyPVxcXCInWycrbGF5ZXJQaWNrZXJQbGFjZUhvbGRlcihmaWVsZCkrJ10nXFxcIj5cXG4gICAgICAgICAgICAgIDxpIGNsYXNzPVxcXCJnbHlwaGljb24gZ2x5cGhpY29uLXNjcmVlbnNob3QgZm9ybS1jb250cm9sLWZlZWRiYWNrXFxcIj48L2k+XFxuICAgICAgICAgICAgPC9kaXY+ICBcXG4gICAgICAgICAgPC9kaXY+XFxuICAgICAgICA8L2Rpdj5cXG4gICAgICA8L3RlbXBsYXRlPlxcbiAgICAgIDxkaXYgdi1mb3I9XFxcInJlbGF0aW9uIGluIHN0YXRlLnJlbGF0aW9uc1xcXCI+XFxuICAgICAgICA8ZGl2IHYtaWY9XFxcInNob3dSZWxhdGlvbihyZWxhdGlvbilcXFwiIHRyYW5zaXRpb249XFxcImV4cGFuZFxcXCI+XFxuICAgICAgICAgIDxkaXYgY2xhc3M9XFxcImczdy1yZWxhdGlvbm5hbWVcXFwiPnt7IHJlbGF0aW9uLm5hbWUgfCBzdGFydGNhc2UgfX08L2Rpdj5cXG4gICAgICAgICAgPHRlbXBsYXRlIHYtZm9yPVxcXCJyZWxmaWVsZCBpbiByZWxhdGlvbi5maWVsZHNcXFwiPlxcbiAgICAgICAgICAgIDxkaXYgdi1pZj1cXFwiaXNWaXNpYmxlKHJlbGZpZWxkKVxcXCIgY2xhc3M9XFxcImZvcm0tZ3JvdXAgaGFzLWZlZWRiYWNrXFxcIiA6Y2xhc3M9XFxcIlskdmFsaWRhdGlvbltyZWxmaWVsZC5uYW1lXS5pbnZhbGlkID8gJ2hhcy1lcnJvcic6ICcnXVxcXCI+XFxuICAgICAgICAgICAgICA8bGFiZWwgOmZvcj1cXFwicmVsZmllbGQubmFtZVxcXCIgY2xhc3M9XFxcImNvbC1zbS00IGNvbnRyb2wtbGFiZWxcXFwiPnt7cmVsZmllbGQubGFiZWx9fTxzcGFuIHYtaWY9XFxcInJlbGZpZWxkLnZhbGlkYXRlICYmIHJlbGZpZWxkLnZhbGlkYXRlLnJlcXVpcmVkXFxcIj4qPC9zcGFuPjwvbGFiZWw+XFxuICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVxcXCJjb2wtc20tOFxcXCI+XFxuICAgICAgICAgICAgICAgIDxpbnB1dCB2LWlmPVxcXCJpc1NpbXBsZShyZWxmaWVsZClcXFwiIDpmaWVsZD1cXFwicmVsZmllbGQubmFtZVxcXCIgdi12YWxpZGF0ZT1cXFwicmVsZmllbGQudmFsaWRhdGVcXFwiIHYtZGlzYWJsZWQ9XFxcIiFpc0VkaXRhYmxlKHJlbGZpZWxkKVxcXCIgY2xhc3M9XFxcImZvcm0tY29udHJvbFxcXCIgdi1tb2RlbD1cXFwicmVsZmllbGQudmFsdWVcXFwiIDppZD1cXFwicmVsZmllbGQubmFtZVxcXCIgOnBsYWNlaG9sZGVyPVxcXCJyZWxmaWVsZC5pbnB1dC5sYWJlbFxcXCI+XFxuICAgICAgICAgICAgICAgIDxzZWxlY3Qgdi1pZj1cXFwiaXNTZWxlY3QocmVsZmllbGQpXFxcIiA6ZmllbGQ9XFxcInJlbGZpZWxkLm5hbWVcXFwiIHYtdmFsaWRhdGU9XFxcInJlbGZpZWxkLnZhbGlkYXRlXFxcIiB2LWRpc2FibGVkPVxcXCIhaXNFZGl0YWJsZShyZWxmaWVsZClcXFwiIGNsYXNzPVxcXCJmb3JtLWNvbnRyb2xcXFwiIHYtbW9kZWw9XFxcInJlbGZpZWxkLnZhbHVlXFxcIiA6aWQ9XFxcInJlbGZpZWxkLm5hbWVcXFwiIDpwbGFjZWhvbGRlcj1cXFwicmVsZmllbGQuaW5wdXQubGFiZWxcXFwiPlxcbiAgICAgICAgICAgICAgICAgIDxvcHRpb24gdi1mb3I9XFxcInJlbHZhbHVlIGluIHJlbGZpZWxkLmlucHV0Lm9wdGlvbnMudmFsdWVzXFxcIiB2YWx1ZT1cXFwie3sgcmVsdmFsdWUua2V5IH19XFxcIj57eyByZWx2YWx1ZS52YWx1ZSB9fTwvb3B0aW9uPlxcbiAgICAgICAgICAgICAgICA8L3NlbGVjdD5cXG4gICAgICAgICAgICAgICAgPGlucHV0IHYtaWY9XFxcImlzQm9vbGVhbihyZWxmaWVsZClcXFwiIHR5cGU9XFxcImNoZWNrYm94XFxcIiB2LW1vZGVsPVxcXCJyZWxmaWVsZC52YWx1ZVxcXCIgOmlkPVxcXCJyZWxmaWVsZC5uYW1lXFxcIiB2LWRpc2FibGVkPVxcXCIhaXNFZGl0YWJsZShyZWxmaWVsZClcXFwiPlxcbiAgICAgICAgICAgICAgICA8ZGl2IHYtaWY9XFxcImlzTGF5ZXJQaWNrZXIocmVsZmllbGQpXFxcIj5cXG4gICAgICAgICAgICAgICAgICA8aW5wdXQgY2xhc3M9XFxcImZvcm0tY29udHJvbFxcXCIgQGNsaWNrPVxcXCJwaWNrTGF5ZXIocmVsZmllbGQpXFxcIiA6ZmllbGQ9XFxcInJlbGZpZWxkLm5hbWVcXFwiIHYtdmFsaWRhdGU9XFxcInJlbGZpZWxkLnZhbGlkYXRlXFxcIiB2LWRpc2FibGVkPVxcXCIhaXNFZGl0YWJsZShyZWxmaWVsZClcXFwiIG9uZm9jdXM9XFxcImJsdXIoKVxcXCIgc3R5bGU9XFxcImN1cnNvcjpwb2ludGVyXFxcIiBkYXRhLXRvZ2dsZT1cXFwidG9vbHRpcFxcXCIgdGl0bGU9XFxcIk90dGllbmkgaWwgZGF0byBkYSB1biBlbGVtZW50byBkZWwgbGF5ZXIgJ3t7IGxheWVyUGlja2VyUGxhY2VIb2xkZXIocmVsZmllbGQpIH19J1xcXCIgdi1tb2RlbD1cXFwicmVsZmllbGQudmFsdWVcXFwiIDppZD1cXFwicmVsZmllbGQubmFtZVxcXCIgOnBsYWNlaG9sZGVyPVxcXCInWycrbGF5ZXJQaWNrZXJQbGFjZUhvbGRlcihyZWxmaWVsZCkrJ10nXFxcIj5cXG4gICAgICAgICAgICAgICAgICA8aSBjbGFzcz1cXFwiZ2x5cGhpY29uIGdseXBoaWNvbi1zY3JlZW5zaG90IGZvcm0tY29udHJvbC1mZWVkYmFja1xcXCI+PC9pPlxcbiAgICAgICAgICAgICAgICA8L2Rpdj5cXG4gICAgICAgICAgICAgIDwvZGl2PlxcbiAgICAgICAgICAgIDwvZGl2PlxcbiAgICAgICAgICA8L3RlbXBsYXRlPlxcbiAgICAgICAgPC9kaXY+XFxuICAgICAgPC9kaXY+XFxuICAgICAgPGRpdiBjbGFzcz1cXFwiZm9ybS1ncm91cFxcXCI+XFxuICAgICAgICA8ZGl2IGNsYXNzPVxcXCJjb2wtc20tb2Zmc2V0LTQgY29sLXNtLThcXFwiPlxcbiAgICAgICAgICA8ZGl2IHYtaWY9XFxcImhhc0ZpZWxkc1JlcXVpcmVkXFxcIiBzdHlsZT1cXFwibWFyZ2luLWJvdHRvbToxMHB4XFxcIj5cXG4gICAgICAgICAgICA8c3Bhbj4qIENhbXBpIHJpY2hpZXN0aTwvc3Bhbj5cXG4gICAgICAgICAgPC9kaXY+XFxuICAgICAgICAgIDxzcGFuIHYtZm9yPVxcXCJidXR0b24gaW4gYnV0dG9uc1xcXCI+XFxuICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz1cXFwiYnRuIFxcXCIgOmNsYXNzPVxcXCJbYnV0dG9uLmNsYXNzXVxcXCIgQGNsaWNrLnN0b3AucHJldmVudD1cXFwiZXhlYyhidXR0b24uY2JrKVxcXCIgdi1kaXNhYmxlZD1cXFwiIWJ0bkVuYWJsZWQoYnV0dG9uKVxcXCI+e3sgYnV0dG9uLnRpdGxlIH19PC9idXR0b24+XFxuICAgICAgICAgIDwvc3Bhbj5cXG4gICAgICAgIDwvZGl2PlxcbiAgICAgIDwvZGl2PlxcbiAgICA8L2Zvcm0+XFxuICA8L3ZhbGlkYXRvcj5cXG48L2Rpdj5cXG5cIjtcbiIsIm1vZHVsZS5leHBvcnRzID0gXCI8Zm9ybSBjbGFzcz1cXFwibmF2YmFyLWZvcm1cXFwiIHJvbGU9XFxcInNlYXJjaFxcXCIgQHN1Ym1pdC5wcmV2ZW50PlxcbiAgPGRpdiBjbGFzcz1cXFwiaW5wdXQtZ3JvdXBcXFwiPlxcbiAgICA8aW5wdXQgdHlwZT1cXFwidGV4dFxcXCIgY2xhc3M9XFxcImZvcm0tY29udHJvbFxcXCIgOnBsYWNlaG9sZGVyPVxcXCJwbGFjZWhvbGRlclxcXCIgdi1tb2RlbD1cXFwicXVlcnlcXFwiICBuYW1lPVxcXCJzcmNoLXRlcm1cXFwiIGlkPVxcXCJzcmNoLXRlcm1cXFwiPlxcbiAgICA8ZGl2IGNsYXNzPVxcXCJpbnB1dC1ncm91cC1idG5cXFwiPlxcbiAgICAgICAgPGJ1dHRvbiBjbGFzcz1cXFwiYnRuIGJ0bi1kZWZhdWx0XFxcIiB0eXBlPVxcXCJzdWJtaXRcXFwiIEBjbGljaz1cXFwic2VhcmNoXFxcIj48aSBjbGFzcz1cXFwiZ2x5cGhpY29uIGdseXBoaWNvbi1zZWFyY2hcXFwiPjwvaT48L2J1dHRvbj5cXG4gICAgPC9kaXY+XFxuICA8L2Rpdj5cXG48L2Zvcm0+XFxuXCI7XG4iLCJ2YXIgdCA9IHJlcXVpcmUoJ2kxOG4vaTE4bi5zZXJ2aWNlJykudDtcbnZhciBHVUkgPSByZXF1aXJlKCdnM3cvZ3VpL2d1aScpO1xudmFyIEdlb2NvZGluZ1NlcnZpY2UgPSByZXF1aXJlKCdnM3cvY29yZS9nZW9jb2RpbmdzZXJ2aWNlJyk7XG5cblZ1ZS5jb21wb25lbnQoXCJnZW9jb2RlclwiLHtcbiAgdGVtcGxhdGU6IHJlcXVpcmUoXCIuL2dlb2NvZGluZy5odG1sXCIpLFxuICBwcm9wczogWyd0eXBlJ10sXG4gIGRhdGE6IGZ1bmN0aW9uKCl7XG4gICAgcmV0dXJuIHtcbiAgICAgIHF1ZXJ5OiBcIlwiLFxuICAgICAgcGxhY2Vob2xkZXI6IHQoXCJzdHJlZXRfc2VhcmNoXCIpXG4gICAgfVxuICB9LFxuICBtZXRob2RzOiB7XG4gICAgc2VhcmNoOiBmdW5jdGlvbihlKXtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIHZhciBxdWVyeSA9IHRoaXMucXVlcnk7XG4gICAgICB0aGlzLnNlcnZpY2Uuc2VhcmNoKHF1ZXJ5KTtcbiAgICB9XG4gIH0sXG4gIHJlYWR5OiBmdW5jdGlvbigpe1xuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICB0aGlzLnNlcnZpY2UgPSBHZW9jb2RpbmdTZXJ2aWNlW3RoaXMudHlwZV07XG4gICAgdGhpcy5zZXJ2aWNlLm9uKFwicmVzdWx0c1wiLGZ1bmN0aW9uKCl7XG4gICAgICBzZWxmLnF1ZXJ5ID0gXCJcIjtcbiAgICB9KVxuICB9XG59KTtcbiIsIm1vZHVsZS5leHBvcnRzID0gXCI8ZGl2PlxcbiAgPHVsPlxcbiAgICA8bGkgdi1mb3I9XFxcIml0ZW0gaW4gc3RhdGUubGlzdFxcXCIgQGNsaWNrPVxcXCJnb3RvKGl0ZW0pXFxcIiBzdHlsZT1cXFwiY3Vyc29yOnBvaW50ZXJcXFwiPnt7IGl0ZW0uZGlzcGxheV9uYW1lIH19PC9saT5cXG4gIDwvdWw+XFxuPC9kaXY+XFxuXCI7XG4iLCJ2YXIgR1VJID0gcmVxdWlyZSgnZzN3L2d1aS9ndWknKTtcbnZhciBNYXBTZXJ2aWNlID0gcmVxdWlyZSgnZzN3L2NvcmUvbWFwc2VydmljZScpO1xuXG52YXIgR2VvY29kaW5nTGlzdFBhbmVsQ29tcG9uZW50ID0gVnVlLmV4dGVuZCh7XG4gIHRlbXBsYXRlOiByZXF1aXJlKCcuL2xpc3RwYW5lbC5odG1sJyksXG4gIG1ldGhvZHM6IHtcbiAgICBnb3RvOiBmdW5jdGlvbihpdGVtKXtcbiAgICAgIHZhciB4ID0gcGFyc2VGbG9hdChpdGVtLmxvbik7XG4gICAgICB2YXIgeSA9IHBhcnNlRmxvYXQoaXRlbS5sYXQpO1xuICAgICAgTWFwU2VydmljZS5nb1RvV0dTODQoW3gseV0pO1xuICAgICAgdmFyIGdlb2pzb24gPSBpdGVtLmdlb2pzb247XG4gICAgICBNYXBTZXJ2aWNlLmhpZ2hsaWdodEdlb21ldHJ5KGdlb2pzb24sNDAwMCx0cnVlKTtcbiAgICAgIEdVSS5jbG9zZUxpc3RpbmcoKTtcbiAgICB9XG4gIH1cbn0pO1xuXG5tb2R1bGUuZXhwb3J0cyA9IEdlb2NvZGluZ0xpc3RQYW5lbENvbXBvbmVudDtcbiIsIm5vb3AgPSByZXF1aXJlKCdnM3cvY29yZS91dGlscycpLm5vb3A7XG52YXIgaW5oZXJpdCA9IHJlcXVpcmUoJ2czdy9jb3JlL3V0aWxzJykuaW5oZXJpdDtcbnZhciBHM1dPYmplY3QgPSByZXF1aXJlKCdnM3cvY29yZS9nM3dvYmplY3QnKTtcblxuLy8gcmFwcHJlc2VudGEgbCdpbnRlcmZhY2NpYSBnbG9iYWxlIGRlbGwnQVBJIGRlbGxhIEdVSS4gXG4vLyBtZXRvZGkgZGV2b25vIGVzc2VyZSBpbXBsZW1lbnRhdGkgKGRlZmluaXRpKSBkYWxsJ2FwcGxpY2F6aW9uZSBvc3BpdGVcbi8vIGwnYXBwIG9zcGl0ZSBkb3ZyZWJiZSBjaGlhbWFyZSBhbmNoZSBsYSBmdW56aW9uZSBHVUkucmVhZHkoKSBxdWFuZG8gbGEgVUkgw6ggcHJvbnRhXG5mdW5jdGlvbiBHVUkoKXtcbiAgLy8gdXJsIGRlbGxlIHJpc29yc2VcbiAgdGhpcy5nZXRSZXNvdXJjZXNVcmwgPSBub29wO1xuICAvLyBzaG93IGEgVnVlIGZvcm1cbiAgdGhpcy5zaG93Rm9ybSA9IG5vb3A7XG4gIHRoaXMuY2xvc2VGb3JtID0gbm9vcDtcbiAgXG4gIC8vIG1vc3RyYSB1bmEgbGlzdGEgZGkgb2dnZXR0aSAoZXMuIGxpc3RhIGRpIHJpc3VsdGF0aSlcbiAgdGhpcy5zaG93TGlzdGluZyA9IG5vb3A7XG4gIHRoaXMuY2xvc2VMaXN0aW5nID0gbm9vcDtcbiAgdGhpcy5oaWRlTGlzdGluZyA9IG5vb3A7XG5cbiAgdGhpcy5zaG93UGFuZWwgPSBub29wO1xuICBcbiAgdGhpcy5yZWFkeSA9IGZ1bmN0aW9uKCl7XG4gICAgdGhpcy5lbWl0KCdndWlyZWFkeScpO1xuICB9O1xuICBcbiAgdGhpcy5ndWlSZXNpemVkID0gZnVuY3Rpb24oKXtcbiAgICB0aGlzLmVtaXQoJ2d1aXJlc2l6ZWQnKTtcbiAgfTtcbiAgXG4gIHRoaXMuc2hvd1NwaW5uZXIgPSBub29wOyAvLyBwZXIgbW9zdHJhcmUgdW4naWNvbmEgc3Bpbm5lciBjaGUgbm90aWZpY2EgdW4gY2FyaWNhbWVudG8gZGF0aSBpbiBjb3Jzb1xuICB0aGlzLmhpZGVTcGlubmVyID0gbm9vcDtcbiAgXG4gIHRvYXN0ci5vcHRpb25zLnBvc2l0aW9uQ2xhc3MgPSAndG9hc3QtdG9wLWNlbnRlcic7XG4gIHRvYXN0ci5vcHRpb25zLnByZXZlbnREdXBsaWNhdGVzID0gdHJ1ZTtcbiAgLy8gcHJveHkgZGVsbGEgbGlicmVyaWEgdG9hc3RyXG4gIHRoaXMubm90aWZ5ID0gdG9hc3RyO1xuICB0aGlzLmRpYWxvZyA9IGJvb3Rib3g7XG59XG5pbmhlcml0KEdVSSxHM1dPYmplY3QpO1xuXG5tb2R1bGUuZXhwb3J0cyA9IG5ldyBHVUk7XG4iLCJtb2R1bGUuZXhwb3J0cyA9IFwiPGRpdj5cXG4gIExpc3RhIGRpIG9nZ2V0dGlcXG48L2Rpdj5cXG5cIjtcbiIsInZhciByZXNvbHZlZFZhbHVlID0gcmVxdWlyZSgnZzN3L2NvcmUvdXRpbHMnKS5yZXNvbHZlZFZhbHVlO1xudmFyIHJlamVjdGVkVmFsdWUgPSByZXF1aXJlKCdnM3cvY29yZS91dGlscycpLnJlamVjdGVkVmFsdWU7XG52YXIgR1VJID0gcmVxdWlyZSgnZzN3L2d1aS9ndWknKTtcbnZhciBQcm9qZWN0U2VydmljZSA9IHJlcXVpcmUoJ2czdy9jb3JlL3Byb2plY3RzZXJ2aWNlJykuUHJvamVjdFNlcnZpY2U7XG52YXIgTWFwU2VydmljZSA9IHJlcXVpcmUoJ2czdy9jb3JlL21hcHNlcnZpY2UnKTtcblxudmFyIExpc3RQYW5lbENvbXBvbmVudCA9IFZ1ZS5leHRlbmQoe1xuICB0ZW1wbGF0ZTogcmVxdWlyZSgnLi9saXN0cGFuZWwuaHRtbCcpLFxuICBtZXRob2RzOiB7XG4gICAgZXhlYzogZnVuY3Rpb24oY2JrKXtcbiAgICAgIHZhciByZWxhdGlvbnMgPSB0aGlzLnN0YXRlLnJlbGF0aW9ucyB8fCBudWxsO1xuICAgICAgY2JrKHRoaXMuc3RhdGUuZmllbGRzLHJlbGF0aW9ucyk7XG4gICAgICBHVUkuY2xvc2VGb3JtKCk7XG4gICAgfVxuICB9XG59KTtcblxuXG5mdW5jdGlvbiBMaXN0UGFuZWwob3B0aW9ucyl7XG4gIC8vIHByb3ByaWV0w6AgbmVjZXNzYXJpZS4gSW4gZnV0dXJvIGxlIG1ldHRlcm1vIGluIHVuYSBjbGFzc2UgUGFuZWwgZGEgY3VpIGRlcml2ZXJhbm5vIHR1dHRpIGkgcGFubmVsbGkgY2hlIHZvZ2xpb25vIGVzc2VyZSBtb3N0cmF0aSBuZWxsYSBzaWRlYmFyXG4gIHRoaXMucGFuZWxDb21wb25lbnQgPSBudWxsO1xuICB0aGlzLm9wdGlvbnMgPSAgb3B0aW9ucyB8fCB7fTtcbiAgdGhpcy5pZCA9IG9wdGlvbnMuaWQgfHwgbnVsbDsgLy8gaWQgZGVsIGZvcm1cbiAgdGhpcy5uYW1lID0gb3B0aW9ucy5uYW1lIHx8IG51bGw7IC8vIG5vbWUgZGVsIGZvcm1cbiAgXG4gIHRoaXMuc3RhdGUgPSB7XG4gICAgbGlzdDogb3B0aW9ucy5saXN0IHx8IFtdXG4gIH1cbiAgXG4gIHRoaXMuX2xpc3RQYW5lbENvbXBvbmVudCA9IG9wdGlvbnMubGlzdFBhbmVsQ29tcG9uZW50IHx8IExpc3RQYW5lbENvbXBvbmVudDtcbn1cblxudmFyIHByb3RvID0gTGlzdFBhbmVsLnByb3RvdHlwZTtcblxuLy8gdmllbmUgcmljaGlhbWF0byBkYWxsYSB0b29sYmFyIHF1YW5kbyBpbCBwbHVnaW4gY2hpZWRlIGRpIG1vc3RyYXJlIHVuIHByb3ByaW8gcGFubmVsbG8gbmVsbGEgR1VJIChHVUkuc2hvd1BhbmVsKVxucHJvdG8ub25TaG93ID0gZnVuY3Rpb24oY29udGFpbmVyKXtcbiAgdmFyIHBhbmVsID0gdGhpcy5fc2V0dXBQYW5lbCgpO1xuICB0aGlzLl9tb3VudFBhbmVsKHBhbmVsLGNvbnRhaW5lcik7XG4gIHJldHVybiByZXNvbHZlZFZhbHVlKHRydWUpO1xufTtcblxuLy8gcmljaGlhbWF0byBxdWFuZG8gbGEgR1VJIGNoaWVkZSBkaSBjaGl1ZGVyZSBpbCBwYW5uZWxsby4gU2Ugcml0b3JuYSBmYWxzZSBpbCBwYW5uZWxsbyBub24gdmllbmUgY2hpdXNvXG5wcm90by5vbkNsb3NlID0gZnVuY3Rpb24oKXtcbiAgdGhpcy5wYW5lbENvbXBvbmVudC4kZGVzdHJveSh0cnVlKTtcbiAgdGhpcy5wYW5lbENvbXBvbmVudCA9IG51bGw7XG4gIHJldHVybiByZXNvbHZlZFZhbHVlKHRydWUpO1xufTtcblxucHJvdG8uX3NldHVwUGFuZWwgPSBmdW5jdGlvbigpe1xuICB2YXIgcGFuZWwgPSB0aGlzLnBhbmVsQ29tcG9uZW50ID0gbmV3IHRoaXMuX2xpc3RQYW5lbENvbXBvbmVudCh7XG4gICAgcGFuZWw6IHRoaXNcbiAgfSk7XG4gIHBhbmVsLnN0YXRlID0gdGhpcy5zdGF0ZTtcbiAgcmV0dXJuIHBhbmVsXG59O1xuXG5wcm90by5fbW91bnRQYW5lbCA9IGZ1bmN0aW9uKHBhbmVsLGNvbnRhaW5lcil7XG4gIHBhbmVsLiRtb3VudCgpLiRhcHBlbmRUbyhjb250YWluZXIpO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSB7XG4gIExpc3RQYW5lbENvbXBvbmVudDogTGlzdFBhbmVsQ29tcG9uZW50LFxuICBMaXN0UGFuZWw6IExpc3RQYW5lbFxufVxuIiwibW9kdWxlLmV4cG9ydHMgPSBcIjxkaXYgaWQ9XFxcIm1hcFxcXCIgc3R5bGU9XFxcIndpZHRoOjEwMCU7aGVpZ2h0OjEwMCVcXFwiPlxcbjwvZGl2PlxcblwiO1xuIiwidmFyIHQgPSByZXF1aXJlKCdpMThuL2kxOG4uc2VydmljZScpLnQ7XG52YXIgR1VJID0gcmVxdWlyZSgnZzN3L2d1aS9ndWkuanMnKTsgICBcbnZhciBSb3V0ZXJTZXJ2aWNlID0gcmVxdWlyZSgnZzN3L2NvcmUvcm91dGVyJyk7XG52YXIgTWFwU2VydmljZSA9IHJlcXVpcmUoJ2czdy9jb3JlL21hcHNlcnZpY2UnKTtcbnZhciBvbDNoZWxwZXJzID0gcmVxdWlyZSgnZzN3LW9sMy9zcmMvZzN3Lm9sMycpLmhlbHBlcnM7XG5cbmZ1bmN0aW9uIG1haW5IZWlnaHQoKXtcbiAgLy9yZXR1cm4gJCh3aW5kb3cpLmlubmVySGVpZ2h0KCktJChcIi5uYXZiYXJcIikuaW5uZXJIZWlnaHQoKTtcbiAgLy9yZXR1cm4gJCh3aW5kb3cpLmlubmVySGVpZ2h0KCk7XG4gIHZhciB0b3BIZWlnaHQgPSAkKFwiLm5hdmJhclwiKS5pbm5lckhlaWdodCgpO1xuICB2YXIgYm90dG9tSGVpZ2h0ID0gMDtcbiAgXG4gIGlmICgkKFwiLmJvdHRvbWJhclwiKS5pcyhcIjp2aXNpYmxlXCIpKSB7XG4gICAgYm90dG9tSGVpZ2h0ID0gJChcIi5ib3R0b21iYXJcIikuaW5uZXJIZWlnaHQoKVxuICB9XG4gIHJldHVybiAkKHdpbmRvdykuaW5uZXJIZWlnaHQoKSAtIHRvcEhlaWdodCAtIGJvdHRvbUhlaWdodDtcbn1cblxuLyogbWFwIHJlc2l6ZSBjYWxjdWxhdGlvbnMgKi9cbmZ1bmN0aW9uIHNldE1hcERpdkhlaWdodCgpe1xuICB2YXIgaGVpZ2h0ID0gbWFpbkhlaWdodCgpO1xuICAkKFwiI21hcFwiKS5oZWlnaHQoaGVpZ2h0KTtcbiAgTWFwU2VydmljZS52aWV3ZXIubWFwLnVwZGF0ZVNpemUoKTtcbn1cblxuZnVuY3Rpb24gc2V0TWFwRGl2V2lkdGgoKXtcbiAgdmFyIG9mZnNldCA9ICQoXCIubWFpbi1zaWRlYmFyXCIpLm9mZnNldCgpLmxlZnQ7XG4gIHZhciB3aWR0aCA9ICQoXCIubWFpbi1zaWRlYmFyXCIpLmlubmVyV2lkdGgoKTtcbiAgdmFyIHNpZGVCYXJTcGFjZSA9IHdpZHRoICsgb2Zmc2V0O1xuICAkKFwiI21hcFwiKS53aWR0aCgkKHdpbmRvdykuaW5uZXJXaWR0aCgpIC0gc2lkZUJhclNwYWNlKTtcbiAgTWFwU2VydmljZS52aWV3ZXIubWFwLnVwZGF0ZVNpemUoKTtcbn1cblxudmFyIE1hcFZpZXdDb21wb25lbnQgPSBWdWUuY29tcG9uZW50KCdnM3ctbWFwJyx7XG4gIHRlbXBsYXRlOiByZXF1aXJlKCcuL21hcC5odG1sJyksXG4gIHJlYWR5OiBmdW5jdGlvbigpe1xuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICBcbiAgICBNYXBTZXJ2aWNlLnNob3dWaWV3ZXIodGhpcy4kZWwuaWQpO1xuICAgIFxuICAgIC8vIHF1ZXN0byBzZXJ2ZSBwZXIgcXVhbmRvIHZpZW5lIGNhbWJpYXRvIHByb2dldHRvL3Zpc3RhIGNhcnRvZ3JhZmljYSwgaW4gY3VpIHZpZW5lIHJpY3JlYXRvIGlsIHZpZXdlciAoZSBxdWluZGkgbGEgbWFwcGEpXG4gICAgTWFwU2VydmljZS5vbmFmdGVyKCdzZXR1cFZpZXdlcicsZnVuY3Rpb24oKXtcbiAgICAgIE1hcFNlcnZpY2Uuc2hvd1ZpZXdlcihzZWxmLiRlbC5pZCk7XG4gICAgfSk7XG4gICAgXG4gICAgR1VJLm9uKCdndWlyZWFkeScsZnVuY3Rpb24oKXtcbiAgICAgIHNldE1hcERpdkhlaWdodCgpO1xuICAgICAgXG4gICAgICAkKCcubWFpbi1zaWRlYmFyJykub24oJ3dlYmtpdFRyYW5zaXRpb25FbmQgdHJhbnNpdGlvbmVuZCBtc1RyYW5zaXRpb25FbmQgb1RyYW5zaXRpb25FbmQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgJCh0aGlzKS50cmlnZ2VyKCd0cmFucy1lbmQnKTtcbiAgICAgICAgICBzZXRNYXBEaXZXaWR0aCgpO1xuICAgICAgfSk7XG4gICAgICBcbiAgICAgIHZhciBkcmF3aW5nID0gZmFsc2U7XG4gICAgICB2YXIgcmVzaXplRmlyZWQgPSBmYWxzZTtcbiAgICAgIFxuICAgICAgR1VJLm9uKCdndWlyZXNpemVkJyxmdW5jdGlvbigpe1xuICAgICAgICByZXNpemVGaXJlZCA9IHRydWU7XG4gICAgICAgIGRyYXdSZXNpemUoKTtcbiAgICAgIH0pO1xuICAgICAgXG4gICAgICAkKHdpbmRvdykucmVzaXplKGZ1bmN0aW9uKCkge1xuICAgICAgICAvLyBzZXQgcmVzaXplZEZpcmVkIHRvIHRydWUgYW5kIGV4ZWN1dGUgZHJhd1Jlc2l6ZSBpZiBpdCdzIG5vdCBhbHJlYWR5IHJ1bm5pbmdcbiAgICAgICAgaWYgKGRyYXdpbmcgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICByZXNpemVGaXJlZCA9IHRydWU7XG4gICAgICAgICAgICBkcmF3UmVzaXplKCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICBmdW5jdGlvbiBkcmF3UmVzaXplKCkge1xuICAgICAgICB2YXIgaGVpZ2h0O1xuICAgICAgICAvLyByZW5kZXIgZnJpZW5kbHkgcmVzaXplIGxvb3BcbiAgICAgICAgaWYgKHJlc2l6ZUZpcmVkID09PSB0cnVlKSB7XG4gICAgICAgICAgICByZXNpemVGaXJlZCA9IGZhbHNlO1xuICAgICAgICAgICAgZHJhd2luZyA9IHRydWU7XG4gICAgICAgICAgICBzZXRNYXBEaXZIZWlnaHQoKTtcbiAgICAgICAgICAgIHNldE1hcERpdldpZHRoKCk7XG4gICAgICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoZHJhd1Jlc2l6ZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBkcmF3aW5nID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIFxuICAgIH0pXG4gIH1cbn0pO1xuXG5mdW5jdGlvbiBNYXBWaWV3KCkge1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIHZhciBfdmlld0NvbXBvbmVudDtcbiAgXG4gIHRoaXMuZ2V0Vmlld0NvbXBvbmVudCA9IGZ1bmN0aW9uKCl7XG4gICAgaWYgKCFfdmlld0NvbXBvbmVudCkge1xuICAgICAgX3ZpZXdDb21wb25lbnQgPSBuZXcgTWFwVmlld0NvbXBvbmVudDtcbiAgICB9XG4gICAgcmV0dXJuIF92aWV3Q29tcG9uZW50O1xuICB9O1xuICBcbiAgdGhpcy5zaG93ID0gZnVuY3Rpb24ocGF0aCl7XG4gICAgdmFyIHZpZXcgPSBSb3V0ZXJTZXJ2aWNlLnNsaWNlRmlyc3QocGF0aClbMF07XG4gICAgaWYgKHZpZXcgPT0gJ21hcCcpIHtcbiAgICAgIHZhciBxdWVyeSA9IFJvdXRlclNlcnZpY2UuZ2V0UXVlcnlQYXJhbXMocGF0aCk7XG4gICAgICBpZiAocXVlcnlbJ3BvaW50J10pIHtcbiAgICAgICAgdmFyIGNvb3JkaW5hdGVzID0gcXVlcnlbJ3BvaW50J10uc3BsaXQoJywnKTtcbiAgICAgICAgaWYgKGNvb3JkaW5hdGVzLmxlbmd0aCA9PSAyKSB7XG4gICAgICAgICAgTWFwU2VydmljZS52aWV3ZXIuZ29Ub1Jlcyhjb29yZGluYXRlcywwLjUpO1xuICAgICAgICAgIE1hcFNlcnZpY2UuaGlnaGxpZ2h0R2VvbWV0cnkobmV3IG9sLmdlb20uUG9pbnQoY29vcmRpbmF0ZXMpLDEwMDAwKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfTtcbiAgXG4gIFJvdXRlclNlcnZpY2Uub25hZnRlcignc2V0Um91dGUnLGZ1bmN0aW9uKHBhdGgpe1xuICAgIHNlbGYuc2hvdyhwYXRoKTtcbiAgfSk7XG59XG5cbm1vZHVsZS5leHBvcnRzID0gbmV3IE1hcFZpZXc7XG4iLCJtb2R1bGUuZXhwb3J0cyA9IFwiPGxpPlxcbjxmb3JtIHJvbGU9XFxcImZvcm1cXFwiPlxcbiAgPGRpdiBjbGFzcz1cXFwiYm94LWJvZHlcXFwiPlxcbiAgICA8ZGl2IGNsYXNzPVxcXCJmb3JtLWdyb3VwXFxcIj5cXG4gICAgICA8bGFiZWwgZm9yPVxcXCJleGFtcGxlSW5wdXRFbWFpbDFcXFwiIHN0eWxlPVxcXCJjb2xvcjogd2hpdGVcXFwiPkVtYWlsIGFkZHJlc3M8L2xhYmVsPlxcbiAgICAgIDxpbnB1dCB0eXBlPVxcXCJlbWFpbFxcXCIgY2xhc3M9XFxcImZvcm0tY29udHJvbFxcXCIgaWQ9XFxcImV4YW1wbGVJbnB1dEVtYWlsMVxcXCIgcGxhY2Vob2xkZXI9XFxcIlxcXCI+XFxuICAgIDwvZGl2PlxcbiAgICA8ZGl2IGNsYXNzPVxcXCJmb3JtLWdyb3VwXFxcIj5cXG4gICAgICA8YnV0dG9uIHR5cGU9XFxcImJ1dHRvblxcXCIgY2xhc3M9XFxcImJ0biBidG4tcHJpbWFyeVxcXCI+Q2lhbzwvYnV0dG9uPlxcbiAgICA8L2Rpdj5cXG4gIDwvZGl2PlxcbjwvZm9ybT5cXG48L2xpPlwiO1xuIiwidmFyIHQgPSByZXF1aXJlKCdpMThuL2kxOG4uc2VydmljZScpLnQ7XG5cblZ1ZS5jb21wb25lbnQoJ2czdy1zZWFyY2gnLHtcbiAgICB0ZW1wbGF0ZTogcmVxdWlyZSgnLi9zZWFyY2guaHRtbCcpLFxuICAgIGRhdGE6IGZ1bmN0aW9uKCkge1xuICAgIFx0cmV0dXJuIHtcbiAgICAgICAgXHRcbiAgICAgICAgfTtcbiAgICB9LFxuICAgIG1ldGhvZHM6IHtcbiAgICBcdFxuXHR9XG59KTtcbiIsIm1vZHVsZS5leHBvcnRzID0gXCI8ZGl2IGNsYXNzPVxcXCJnM3ctdG9vbHNcXFwiPlxcbiAgPHVsPlxcbiAgICA8bGkgdi1mb3I9XFxcInRvb2wgaW4gdG9vbHNcXFwiPlxcbiAgICAgIDxkaXYgZGF0YS10b2dnbGU9XFxcImNvbGxhcHNlXFxcIiBkYXRhLXRhcmdldD1cXFwiI2l0ZXJuZXQtdG9vbHNcXFwiIGNsYXNzPVxcXCJ0b29sLWhlYWRlclxcXCI+XFxuICAgICAgICA8c3BhbiBzdHlsZT1cXFwiXFxcIj57eyB0b29sLm5hbWUgfX08L3NwYW4+XFxuICAgICAgPC9kaXY+XFxuICAgICAgPGRpdiBpZD1cXFwiaXRlcm5ldC10b29sc1xcXCIgY2xhc3M9XFxcInRvb2wtYm94IGNvbGxhcHNlXFxcIj5cXG4gICAgICAgIDx0ZW1wbGF0ZSB2LWZvcj1cXFwiYWN0aW9uIGluIHRvb2wuYWN0aW9uc1xcXCI+XFxuICAgICAgICAgIDxpIGNsYXNzPVxcXCJnbHlwaGljb24gZ2x5cGhpY29uLWNvZ1xcXCI+PC9pPlxcbiAgICAgICAgICA8c3BhbiBAY2xpY2s9XFxcImZpcmVBY3Rpb24oYWN0aW9uLmlkKVxcXCI+e3sgYWN0aW9uLm5hbWUgfX08L3NwYW4+XFxuICAgICAgICA8L3RlbXBsYXRlPlxcbiAgICAgIDwvZGl2PlxcbiAgICA8L2xpPlxcbiAgPC91bD5cXG48L2Rpdj5cXG5cIjtcbiIsInZhciB0ID0gcmVxdWlyZSgnaTE4bi9pMThuLnNlcnZpY2UnKS50O1xudmFyIFRvb2xzU2VydmljZSA9IHJlcXVpcmUoJ2czdy9jb3JlL3Rvb2xzc2VydmljZScpO1xuXG5WdWUuY29tcG9uZW50KCdnM3ctdG9vbHMnLHtcbiAgICB0ZW1wbGF0ZTogcmVxdWlyZSgnLi90b29scy5odG1sJyksXG4gICAgZGF0YTogZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB0b29sczogVG9vbHNTZXJ2aWNlLnN0YXRlLnRvb2xzXG4gICAgICB9XG4gICAgfSxcbiAgICBtZXRob2RzOiB7XG4gICAgICBmaXJlQWN0aW9uOiBmdW5jdGlvbihhY3Rpb25pZCl7XG4gICAgICAgIFRvb2xzU2VydmljZS5maXJlQWN0aW9uKGFjdGlvbmlkKTtcbiAgICAgIH1cbiAgICB9XG59KTtcbiIsIm1vZHVsZS5leHBvcnRzID0gXCI8ZGl2IGlkPVxcXCJ2aWV3cG9ydFxcXCIgY2xhc3M9XFxcInZpZXdwb3J0XFxcIj48L2Rpdj5cXG5cIjtcbiIsIlZ1ZS5jb21wb25lbnQoJ3ZpZXdwb3J0Jyx7XG4gIHRlbXBsYXRlOiByZXF1aXJlKCcuL3ZpZXdwb3J0Lmh0bWwnKVxufSk7XG5cbnZhciBWaWV3cG9ydFNlcnZpY2UgPSBmdW5jdGlvbigpe1xuICB2YXIgY29udGFpbmVyU2VsZWN0b3IgPSAnI3ZpZXdwb3J0JztcbiAgdGhpcy5pbml0ID0gZnVuY3Rpb24oY29uZmlnKXtcbiAgfTtcbiAgXG4gIHRoaXMuc2V0VmlldyA9IGZ1bmN0aW9uKHZpZXcpe1xuICAgIHZpZXcuJG1vdW50KCkuJGFwcGVuZFRvKGNvbnRhaW5lclNlbGVjdG9yKTtcbiAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IG5ldyBWaWV3cG9ydFNlcnZpY2U7XG4iLCJWdWUuZGlyZWN0aXZlKFwiZGlzYWJsZWRcIixmdW5jdGlvbih2YWx1ZSl7XG4gICAgaWYgKHZhbHVlKXtcbiAgICAgIHRoaXMuZWwuc2V0QXR0cmlidXRlKCdkaXNhYmxlZCcsJ2Rpc2FibGVkJyk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgdGhpcy5lbC5yZW1vdmVBdHRyaWJ1dGUoJ2Rpc2FibGVkJyk7XG4gICAgfVxuICB9XG4pO1xuXG5WdWUuZGlyZWN0aXZlKFwiY2hlY2tlZFwiLGZ1bmN0aW9uKHZhbHVlKXtcbiAgICBpZiAodmFsdWUpe1xuICAgICAgdGhpcy5lbC5zZXRBdHRyaWJ1dGUoJ2NoZWNrZWQnLCdjaGVja2VkJyk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgdGhpcy5lbC5yZW1vdmVBdHRyaWJ1dGUoJ2NoZWNrZWQnKTtcbiAgICB9XG4gIH1cbik7XG5cblZ1ZS5kaXJlY3RpdmUoXCJzZWxlY3RlZC1maXJzdFwiLGZ1bmN0aW9uKHZhbHVlKXtcbiAgICBpZiAodmFsdWU9PTApe1xuICAgICAgdGhpcy5lbC5zZXRBdHRyaWJ1dGUoJ3NlbGVjdGVkJywnJyk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgdGhpcy5lbC5yZW1vdmVBdHRyaWJ1dGUoJ3NlbGVjdGVkJyk7XG4gICAgfVxuICB9XG4pO1xuIiwidmFyIGlzTW9iaWxlTWl4aW4gPSB7XG4gIG1ldGhvZHM6IHtcbiAgICBpc01vYmlsZTogZnVuY3Rpb24oKXtyZXR1cm4gaXNNb2JpbGUuYW55fVxuICB9XG59XG5cbm1vZHVsZS5leHBvcnRzID0ge1xuICBpc01vYmlsZU1peGluOiBpc01vYmlsZU1peGluXG59O1xuIiwiZnVuY3Rpb24gaW5pdChjb25maWcpIHtcbiAgaTE4bmV4dFxuICAudXNlKGkxOG5leHRYSFJCYWNrZW5kKVxuICAuaW5pdCh7IFxuICAgICAgbG5nOiAnaXQnLFxuICAgICAgbnM6ICdhcHAnLFxuICAgICAgZmFsbGJhY2tMbmc6ICdpdCcsXG4gICAgICByZXNvdXJjZXM6IGNvbmZpZy5yZXNvdXJjZXNcbiAgfSk7XG4gIFxuICBqcXVlcnlJMThuZXh0LmluaXQoaTE4bmV4dCwgJCwge1xuICAgIHROYW1lOiAndCcsIC8vIC0tPiBhcHBlbmRzICQudCA9IGkxOG5leHQudFxuICAgIGkxOG5OYW1lOiAnaTE4bicsIC8vIC0tPiBhcHBlbmRzICQuaTE4biA9IGkxOG5leHRcbiAgICBoYW5kbGVOYW1lOiAnbG9jYWxpemUnLCAvLyAtLT4gYXBwZW5kcyAkKHNlbGVjdG9yKS5sb2NhbGl6ZShvcHRzKTtcbiAgICBzZWxlY3RvckF0dHI6ICdkYXRhLWkxOG4nLCAvLyBzZWxlY3RvciBmb3IgdHJhbnNsYXRpbmcgZWxlbWVudHNcbiAgICB0YXJnZXRBdHRyOiAnZGF0YS1pMThuLXRhcmdldCcsIC8vIGVsZW1lbnQgYXR0cmlidXRlIHRvIGdyYWIgdGFyZ2V0IGVsZW1lbnQgdG8gdHJhbnNsYXRlIChpZiBkaWZmcmVudCB0aGVuIGl0c2VsZilcbiAgICBvcHRpb25zQXR0cjogJ2RhdGEtaTE4bi1vcHRpb25zJywgLy8gZWxlbWVudCBhdHRyaWJ1dGUgdGhhdCBjb250YWlucyBvcHRpb25zLCB3aWxsIGxvYWQvc2V0IGlmIHVzZU9wdGlvbnNBdHRyID0gdHJ1ZVxuICAgIHVzZU9wdGlvbnNBdHRyOiBmYWxzZSwgLy8gc2VlIG9wdGlvbnNBdHRyXG4gICAgcGFyc2VEZWZhdWx0VmFsdWVGcm9tQ29udGVudDogdHJ1ZSAvLyBwYXJzZXMgZGVmYXVsdCB2YWx1ZXMgZnJvbSBjb250ZW50IGVsZS52YWwgb3IgZWxlLnRleHRcbiAgfSk7XG59XG4gICAgXG52YXIgdCA9IGZ1bmN0aW9uKHRleHQpe1xuICAgIHZhciB0cmFkID0gaTE4bmV4dC50KHRleHQpO1xuICAgIHJldHVybiB0cmFkO1xufTtcbiAgICBcbm1vZHVsZS5leHBvcnRzID0ge1xuICBpbml0OiBpbml0LFxuICB0OiB0XG59XG4iLCJ2YXIgaW5oZXJpdCA9IHJlcXVpcmUoJ2czdy9jb3JlL3V0aWxzJykuaW5oZXJpdDtcbnZhciBHM1dPYmplY3QgPSByZXF1aXJlKCdnM3cvY29yZS9nM3dvYmplY3QnKTtcblxuZnVuY3Rpb24gRWRpdEJ1ZmZlcihlZGl0b3Ipe1xuICB0aGlzLl9lZGl0b3IgPSBlZGl0b3I7XG4gIFxuICB0aGlzLl9vcmlnVmVjdG9yTGF5ZXIgPSBuZXcgb2wubGF5ZXIuVmVjdG9yKHtcbiAgICBzb3VyY2U6IG5ldyBvbC5zb3VyY2UuVmVjdG9yKClcbiAgfSk7XG4gIHRoaXMuX2Nsb25lTGF5ZXIoKTtcbiAgXG4gIC8vYnVmZmVyIGRlbGxlIGdlb21ldHJpZVxuICB0aGlzLl9nZW9tZXRyaWVzQnVmZmVyID0ge307XG4gIFxuICAvLyBidWZmZXIgZGVnbGkgYXR0cmlidXRpXG4gIHRoaXMuX2F0dHJpYnV0ZXNCdWZmZXIgPSB7fTtcbiAgXG4gIC8vIGJ1ZmZlciBkZWdsaSBhdHRyaWJ1dGkgZGVsbGUgcmVsYXppb25pXG4gIHRoaXMuX3JlbGF0aW9uc0F0dHJpYnV0ZXNCdWZmZXIgPSB7fTtcbn1cbmluaGVyaXQoRWRpdEJ1ZmZlcixHM1dPYmplY3QpO1xubW9kdWxlLmV4cG9ydHMgPSBFZGl0QnVmZmVyO1xuXG52YXIgcHJvdG8gPSBFZGl0QnVmZmVyLnByb3RvdHlwZTtcblxucHJvdG8uY29tbWl0ID0gZnVuY3Rpb24oKXtcbiAgdmFyIG5ld0ZlYXR1cmVzID0gdGhpcy5fZWRpdG9yLmdldEVkaXRWZWN0b3JMYXllcigpLmdldEZlYXR1cmVzKCk7XG4gIHRoaXMuX2VkaXRvci5nZXRWZWN0b3JMYXllcigpLmFkZEZlYXR1cmVzKG5ld0ZlYXR1cmVzKTtcbiAgdGhpcy5fZWRpdG9yLmdldEVkaXRWZWN0b3JMYXllcigpLmNsZWFyKCk7XG4gIHRoaXMuX2NsZWFyQnVmZmVycygpO1xuICB0aGlzLl9jbG9uZUxheWVyKCk7XG59O1xuXG5wcm90by51bmRvQWxsID0gZnVuY3Rpb24oKXtcbiAgdGhpcy5fcmVzZXRWZWN0b3JMYXllcigpO1xuICB0aGlzLl9jbGVhckJ1ZmZlcnMoKTtcbn07XG5cbnByb3RvLmRlc3Ryb3kgPSBmdW5jdGlvbigpe1xuICB0aGlzLl9jbGVhckJ1ZmZlcnMoKTtcbn07XG5cbnByb3RvLmdlbmVyYXRlSWQgPSBmdW5jdGlvbigpe1xuICByZXR1cm4gdGhpcy5fZWRpdG9yLmdlbmVyYXRlSWQoKTtcbn07XG5cbnByb3RvLmFkZEZlYXR1cmUgPSBmdW5jdGlvbihmZWF0dXJlKXtcbiAgaWYoIWZlYXR1cmUuZ2V0SWQoKSl7XG4gICAgZmVhdHVyZS5zZXRJZCh0aGlzLmdlbmVyYXRlSWQoKSk7XG4gIH1cbiAgdGhpcy5fYWRkRWRpdFRvR2VvbWV0cnlCdWZmZXIoZmVhdHVyZSwnYWRkJyk7XG4gIGNvbnNvbGUubG9nKFwiSW5zZXJpdGEgbnVvdmEgZmVhdHVyZTogKElEOiBcIitmZWF0dXJlLmdldElkKCkrXCIgXCIrZmVhdHVyZS5nZXRHZW9tZXRyeSgpLmdldENvb3JkaW5hdGVzKCkrXCIpIG5lbCBidWZmZXJcIik7XG59O1xuXG5wcm90by51cGRhdGVGZWF0dXJlID0gZnVuY3Rpb24oZmVhdHVyZSl7XG4gIHRoaXMuX2FkZEVkaXRUb0dlb21ldHJ5QnVmZmVyKGZlYXR1cmUsJ3VwZGF0ZScpO1xuICBjb25zb2xlLmxvZyhcIk1vZGlmaWNhdGEgZmVhdHVyZTogKElEOiBcIitmZWF0dXJlLmdldElkKCkrXCIgXCIrZmVhdHVyZS5nZXRHZW9tZXRyeSgpLmdldENvb3JkaW5hdGVzKCkrXCIpIG5lbCBidWZmZXJcIik7XG59O1xuXG5wcm90by5kZWxldGVGZWF0dXJlID0gZnVuY3Rpb24oZmVhdHVyZSl7XG4gIHRoaXMuX2FkZEVkaXRUb0dlb21ldHJ5QnVmZmVyKGZlYXR1cmUsJ2RlbGV0ZScpO1xuICBjb25zb2xlLmxvZyhcIlJpbW9zc2EgZmVhdHVyZTogKElEOiBcIitmZWF0dXJlLmdldElkKCkrXCIgXCIrZmVhdHVyZS5nZXRHZW9tZXRyeSgpLmdldENvb3JkaW5hdGVzKCkrXCIpIG5lbCBidWZmZXJcIik7XG59O1xuXG5wcm90by51cGRhdGVBdHRyaWJ1dGVzID0gZnVuY3Rpb24oZmVhdHVyZSxyZWxhdGlvbnNBdHRyaWJ1dGVzKXtcbiAgaWYoIWZlYXR1cmUuZ2V0SWQoKSl7XG4gICAgZmVhdHVyZS5zZXRJZCh0aGlzLmdlbmVyYXRlSWQoKSk7XG4gIH1cbiAgdGhpcy5fYWRkRWRpdFRvQXR0cmlidXRlc0J1ZmZlcihmZWF0dXJlLHJlbGF0aW9uc0F0dHJpYnV0ZXMpO1xuICBjb25zb2xlLmxvZyhcIk1vZGlmaWNhdGkgYXR0cmlidXRpIGZlYXR1cmU6IChJRDogXCIrZmVhdHVyZS5nZXRJZCgpK1wiKVwiKTtcbn07XG5cbnByb3RvLmdldEZlYXR1cmVBdHRyaWJ1dGVzID0gZnVuY3Rpb24oZmlkKXtcbiAgaWYodGhpcy5fYXR0cmlidXRlc0J1ZmZlcltmaWRdKXtcbiAgICByZXR1cm4gdGhpcy5fYXR0cmlidXRlc0J1ZmZlcltmaWRdLnNsaWNlKC0xKVswXTtcbiAgfVxuICByZXR1cm4gbnVsbDtcbn07XG5cbnByb3RvLmFyZUZlYXR1cmVBdHRyaWJ1dGVzRWRpdGVkID0gZnVuY3Rpb24oZmlkKXtcbiAgaWYgKHRoaXMuX2F0dHJpYnV0ZXNCdWZmZXJbZmlkXSl7XG4gICAgcmV0dXJuIHRoaXMuX2F0dHJpYnV0ZXNCdWZmZXJbZmlkXS5sZW5ndGggPiAtMTtcbiAgfVxuICByZXR1cm4gZmFsc2U7XG59O1xuXG5wcm90by5nZXRSZWxhdGlvbnNBdHRyaWJ1dGVzID0gZnVuY3Rpb24oZmlkKXtcbiAgcmV0dXJuIHRoaXMuX3JlbGF0aW9uc0F0dHJpYnV0ZXNCdWZmZXJbZmlkXS5zbGljZSgtMSlbMF07XG59O1xuXG5wcm90by5hcmVGZWF0dXJlUmVsYXRpb25zRWRpdGVkID0gZnVuY3Rpb24oZmlkKXtcbiAgaWYgKHRoaXMuX3JlbGF0aW9uc0F0dHJpYnV0ZXNCdWZmZXJbZmlkXSl7XG4gICAgcmV0dXJuIHRoaXMuX3JlbGF0aW9uc0F0dHJpYnV0ZXNCdWZmZXJbZmlkXS5sZW5ndGggPiAtMTtcbiAgfVxuICByZXR1cm4gZmFsc2U7XG59O1xuXG5wcm90by5jb2xsZWN0RmVhdHVyZUlkcyA9IGZ1bmN0aW9uKCl7XG4gIHZhciBnZW9tZXRyaWVzQnVmZmVycyA9IHRoaXMuX2dlb21ldHJpZXNCdWZmZXI7XG4gIHZhciBhdHRyaWJ1dGVzQnVmZmVycyA9IHRoaXMuX2F0dHJpYnV0ZXNCdWZmZXI7XG4gIFxuICB2YXIgbW9kaWZpZWRGaWRzID0gW107XG5cbiAgbW9kaWZpZWRGaWRzID0gXy5jb25jYXQobW9kaWZpZWRGaWRzLF8ua2V5cyhnZW9tZXRyaWVzQnVmZmVycykpO1xuICBtb2RpZmllZEZpZHMgPSBfLmNvbmNhdChtb2RpZmllZEZpZHMsXy5rZXlzKGF0dHJpYnV0ZXNCdWZmZXJzKSk7XG4gIFxuICByZXR1cm4gXy51bmlxKG1vZGlmaWVkRmlkcyk7XG59O1xuXG5wcm90by5jb2xsZWN0RmVhdHVyZXMgPSBmdW5jdGlvbihzdGF0ZSxhc0dlb0pTT04pe1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIHZhciBnZW9tZXRyaWVzQnVmZmVycyA9IHRoaXMuX2dlb21ldHJpZXNCdWZmZXI7XG4gIHZhciBhdHRyaWJ1dGVzQnVmZmVycyA9IHRoaXMuX2F0dHJpYnV0ZXNCdWZmZXI7XG4gIHZhciBhc0dlb0pTT04gPSBhc0dlb0pTT04gfHwgZmFsc2U7XG4gIHZhciBHZW9KU09ORm9ybWF0ID0gbmV3IG9sLmZvcm1hdC5HZW9KU09OKCk7XG4gIFxuICB2YXIgbW9kaWZpZWRGaWRzID0gdGhpcy5jb2xsZWN0RmVhdHVyZUlkcygpO1xuICBcbiAgdmFyIGxheWVyO1xuICBpZiAoc3RhdGUgPT0gJ25ldycpIHtcbiAgICBsYXllciA9IHNlbGYuX2VkaXRvci5nZXRFZGl0VmVjdG9yTGF5ZXIoKTtcbiAgfVxuICBlbHNlIHtcbiAgICBsYXllciA9IHNlbGYuX2VkaXRvci5nZXRWZWN0b3JMYXllcigpO1xuICB9XG4gIFxuICB2YXIgZmVhdHVyZXMgPSBbXTtcbiAgXy5mb3JFYWNoKG1vZGlmaWVkRmlkcyxmdW5jdGlvbihmaWQpe1xuICAgIFxuICAgIHZhciBmZWF0dXJlID0gbGF5ZXIuZ2V0RmVhdHVyZUJ5SWQoZmlkKTtcbiAgICB2YXIgaXNOZXcgPSBzZWxmLl9pc05ld0ZlYXR1cmUoZmlkKTtcbiAgICB2YXIgYWRkZWRGZWF0dXJlID0gKHN0YXRlID09ICduZXcnICYmIGlzTmV3ICYmIGZlYXR1cmUpO1xuICAgIHZhciB1cGRhdGVkRmVhdHVyZSA9IChzdGF0ZSA9PSAndXBkYXRlZCcgJiYgIWlzTmV3ICYmIGZlYXR1cmUpO1xuICAgIHZhciBkZWxldGVkRmVhdHVyZSA9IChzdGF0ZSA9PSAnZGVsZXRlZCcgJiYgIWlzTmV3ICYmICFmZWF0dXJlKTtcbiAgICBcbiAgICBpZiAoYWRkZWRGZWF0dXJlIHx8IHVwZGF0ZWRGZWF0dXJlKXtcbiAgICAgIGlmIChhc0dlb0pTT04pe1xuICAgICAgICBmZWF0dXJlID0gR2VvSlNPTkZvcm1hdC53cml0ZUZlYXR1cmVPYmplY3QoZmVhdHVyZSk7XG4gICAgICB9XG4gICAgICBmZWF0dXJlcy5wdXNoKGZlYXR1cmUpO1xuICAgIH1cbiAgICBlbHNlIGlmIChkZWxldGVkRmVhdHVyZSkge1xuICAgICAgZmVhdHVyZXMucHVzaChmaWQpO1xuICAgIH1cbiAgfSk7XG4gIHJldHVybiBmZWF0dXJlcztcbn07XG5cbnByb3RvLmNyZWF0ZUZlYXR1cmUgPSBmdW5jdGlvbihmaWQsZ2VvbWV0cnksYXR0cmlidXRlcyl7XG4gIHZhciBmZWF0dXJlID0gbmV3IG9sLkZlYXR1cmUoKTtcbiAgZmVhdHVyZS5zZXRJZChmaWQpO1xuICBmZWF0dXJlLnNldEdlb21ldHJ5KGdlb21ldHJ5KTtcbiAgZmVhdHVyZS5zZXRQcm9wZXJ0aWVzKGF0dHJpYnV0ZXMpO1xuICByZXR1cm4gZmVhdHVyZTtcbn07XG5cbnByb3RvLmNvbGxlY3RSZWxhdGlvbnNBdHRyaWJ1dGVzID0gZnVuY3Rpb24oKXtcbiAgdmFyIHJlbGF0aW9uc0F0dHJpYnV0ZXMgPSB7fTtcbiAgXy5mb3JFYWNoKHRoaXMuX3JlbGF0aW9uc0F0dHJpYnV0ZXNCdWZmZXIsZnVuY3Rpb24ocmVsYXRpb25zQnVmZmVyLGZpZCl7XG4gICAgbGFzdFJlbGF0aW9uc0F0dHJpYnV0ZXMgPSByZWxhdGlvbnNCdWZmZXJbcmVsYXRpb25zQnVmZmVyLmxlbmd0aC0xXTtcbiAgICByZWxhdGlvbnNBdHRyaWJ1dGVzW2ZpZF0gPSBsYXN0UmVsYXRpb25zQXR0cmlidXRlcztcbiAgfSlcbiAgcmV0dXJuIHJlbGF0aW9uc0F0dHJpYnV0ZXM7XG59O1xuXG5wcm90by5fYWRkRWRpdFRvR2VvbWV0cnlCdWZmZXIgPSBmdW5jdGlvbihmZWF0dXJlLG9wZXJhdGlvbil7XG4gIHZhciBnZW9tZXRyaWVzQnVmZmVyID0gdGhpcy5fZ2VvbWV0cmllc0J1ZmZlcjtcbiAgXG4gIHZhciBpZCA9IGZlYXR1cmUuZ2V0SWQoKTtcbiAgdmFyIGdlb21ldHJ5ID0gZmVhdHVyZS5nZXRHZW9tZXRyeSgpO1xuICBcbiAgaWYgKG9wZXJhdGlvbiA9PSAnZGVsZXRlJyl7XG4gICAgICBnZW9tZXRyeSA9IG51bGw7XG4gICAgICB2YXIgbGF5ZXIgPSB0aGlzLl9pc05ld0ZlYXR1cmUoaWQpID8gdGhpcy5fZWRpdG9yLl9lZGl0VmVjdG9yTGF5ZXIgOiB0aGlzLl9lZGl0b3IuX3ZlY3RvckxheWVyO1xuICAgICAgbGF5ZXIuZ2V0U291cmNlKCkucmVtb3ZlRmVhdHVyZShmZWF0dXJlKTtcbiAgfSBcbiAgXG4gIGlmICghXy5oYXMoZ2VvbWV0cmllc0J1ZmZlcixpZCkpe1xuICAgIGdlb21ldHJpZXNCdWZmZXJbaWRdID0gW107XG4gIH1cbiAgZ2VvbWV0cmllc0J1ZmZlcltpZF0ucHVzaChnZW9tZXRyeSk7XG4gIHRoaXMuX3NldERpcnR5KCk7XG59O1xuXG5wcm90by5fYWRkRWRpdFRvQXR0cmlidXRlc0J1ZmZlciA9IGZ1bmN0aW9uKGZlYXR1cmUscmVsYXRpb25zQXR0cmlidXRlcyl7XG4gIHZhciBmaWQgPSBmZWF0dXJlLmdldElkKCk7XG4gIHZhciBhdHRyaWJ1dGVzID0gZmVhdHVyZS5nZXRQcm9wZXJ0aWVzKCk7XG4gIHZhciBhdHRyaWJ1dGVzQnVmZmVyID0gdGhpcy5fYXR0cmlidXRlc0J1ZmZlcjtcblxuICBpZiAoIV8uaGFzKGF0dHJpYnV0ZXNCdWZmZXIsZmlkKSl7XG4gICAgYXR0cmlidXRlc0J1ZmZlcltmaWRdID0gW107XG4gIH1cbiAgYXR0cmlidXRlc0J1ZmZlcltmaWRdLnB1c2goYXR0cmlidXRlcyk7XG4gIFxuICBpZiAocmVsYXRpb25zQXR0cmlidXRlcyl7XG4gICAgaWYgKCFfLmhhcyh0aGlzLl9yZWxhdGlvbnNBdHRyaWJ1dGVzQnVmZmVyLGZpZCkpe1xuICAgIHRoaXMuX3JlbGF0aW9uc0F0dHJpYnV0ZXNCdWZmZXJbZmlkXSA9IFtdO1xuICB9XG4gICAgdGhpcy5fcmVsYXRpb25zQXR0cmlidXRlc0J1ZmZlcltmaWRdLnB1c2gocmVsYXRpb25zQXR0cmlidXRlcyk7XG4gIH1cbiAgdGhpcy5fc2V0RGlydHkoKTtcbn07XG5cbi8vIGd1YXJkbyBzZSDDqCB1bmEgZmVhdHVyZSBnacOgIHByZXNlbnRlIG5lbCBidWZmZXIgZGVsbGUgbnVvdmUgZ2VvbWV0cmllXG5wcm90by5faXNOZXdGZWF0dXJlID0gZnVuY3Rpb24oZmlkKXtcbiAgLy9yZXR1cm4gaWQudG9TdHJpbmcoKS5pbmRleE9mKCdfbmV3XycpID4gLTE7XG4gIHJldHVybiB0aGlzLl9lZGl0b3IuaXNOZXdGZWF0dXJlKGZpZCk7XG59O1xuXG5wcm90by5fc2V0RGlydHkgPSBmdW5jdGlvbigpe1xuICB0aGlzLl9lZGl0b3IuX3NldERpcnR5KCk7XG59O1xuXG5wcm90by5fcmVzZXRWZWN0b3JMYXllciA9IGZ1bmN0aW9uKCl7XG4gIHRoaXMuX2VkaXRvci52ZWN0b0xheWVyID0gdGhpcy5fb3JpZ1ZlY3RvckxheWVyO1xuICB0aGlzLl9vcmlnVmVjdG9yTGF5ZXIuZ2V0U291cmNlKCkuY2xlYXIoKTtcbn07XG5cbnByb3RvLl9jbGVhckJ1ZmZlcnMgPSBmdW5jdGlvbigpe1xuICB0aGlzLl9nZW9tZXRyaWVzQnVmZmVyID0ge307XG4gIHRoaXMuX2F0dHJpYnV0ZXNCdWZmZXIgPSB7fTtcbiAgdGhpcy5fcmVsYXRpb25zQXR0cmlidXRlc0J1ZmZlciA9IHt9O1xuICB0aGlzLl9lZGl0b3IuX3NldERpcnR5KGZhbHNlKTtcbn07XG5cbnByb3RvLl9jbG9uZUxheWVyID0gZnVuY3Rpb24oKXtcbiAgdmFyIGNsb25lZEZlYXR1cmVzID0gW107XG4gIHRoaXMuX2VkaXRvci5fdmVjdG9yTGF5ZXIuZ2V0U291cmNlKCkuZm9yRWFjaEZlYXR1cmUoZnVuY3Rpb24oZmVhdHVyZSl7XG4gICAgY2xvbmVkRmVhdHVyZXMucHVzaChmZWF0dXJlLmNsb25lKCkpO1xuICB9LHRoaXMpO1xuICB0aGlzLl9vcmlnVmVjdG9yTGF5ZXIuZ2V0U291cmNlKCkuYWRkRmVhdHVyZXMoY2xvbmVkRmVhdHVyZXMpO1xufTtcbiIsInZhciBpbmhlcml0ID0gcmVxdWlyZSgnZzN3L2NvcmUvdXRpbHMnKS5pbmhlcml0O1xudmFyIGJhc2UgPSByZXF1aXJlKCdnM3cvY29yZS91dGlscycpLmJhc2U7XG52YXIgcmVzb2x2ZWRWYWx1ZSA9IHJlcXVpcmUoJ2czdy9jb3JlL3V0aWxzJykucmVzb2x2ZWRWYWx1ZTtcbnZhciByZWplY3RlZFZhbHVlID0gcmVxdWlyZSgnZzN3L2NvcmUvdXRpbHMnKS5yZWplY3RlZFZhbHVlO1xudmFyIEczV09iamVjdCA9IHJlcXVpcmUoJ2czdy9jb3JlL2czd29iamVjdCcpO1xudmFyIE1hcFNlcnZpY2UgPSByZXF1aXJlKCdnM3cvY29yZS9tYXBzZXJ2aWNlJyk7XG52YXIgVmVjdG9yTGF5ZXIgPSByZXF1aXJlKCdnM3cvY29yZS92ZWN0b3JsYXllcicpO1xuXG4vL3ZhciBTZXF1ZW5jZXIgPSByZXF1aXJlKCcuL3N0ZXBzZXF1ZW5jZXInKTtcbnZhciBBZGRGZWF0dXJlVG9vbCA9IHJlcXVpcmUoJy4vdG9vbHMvYWRkZmVhdHVyZXRvb2wnKTtcbnZhciBNb3ZlRmVhdHVyZVRvb2wgPSByZXF1aXJlKCcuL3Rvb2xzL21vdmVwb2ludHRvb2wnKTtcbnZhciBNb2RpZnlGZWF0dXJlVG9vbCA9IHJlcXVpcmUoJy4vdG9vbHMvbW9kaWZ5ZmVhdHVyZXRvb2wnKTtcbnZhciBEZWxldGVGZWF0dXJlVG9vbCA9IHJlcXVpcmUoJy4vdG9vbHMvZGVsZXRlZmVhdHVyZXRvb2wnKTtcbnZhciBQaWNrRmVhdHVyZVRvb2wgPSByZXF1aXJlKCcuL3Rvb2xzL3BpY2tmZWF0dXJldG9vbCcpO1xudmFyIEN1dExpbmVUb29sID0gcmVxdWlyZSgnLi90b29scy9jdXRsaW5ldG9vbCcpO1xudmFyIEVkaXRCdWZmZXIgPSByZXF1aXJlKCcuL2VkaXRidWZmZXInKTtcblxudmFyIEVkaXRvckdlb21ldHJ5VHlwZXMgPSBbXG4gICdQb2ludCcsXG4gIC8vJ011bHRpUG9pbnQnLFxuICAnTGluZVN0cmluZycsXG4gICdNdWx0aUxpbmVTdHJpbmcnLFxuICAvLydQb2x5Z29uJyxcbiAgLy8nTXVsdGlQb2x5Z29uJ1xuXTtcblxuLy8gRWRpdG9yIGRpIHZldHRvcmkgcHVudHVhbGlcbmZ1bmN0aW9uIEVkaXRvcihvcHRpb25zKXtcbiAgdGhpcy5fdmVjdG9yTGF5ZXIgPSBudWxsO1xuICB0aGlzLl9lZGl0VmVjdG9yTGF5ZXIgPSBudWxsO1xuICB0aGlzLl9lZGl0QnVmZmVyID0gbnVsbDtcbiAgdGhpcy5fYWN0aXZlVG9vbCA9IG51bGw7XG4gIHRoaXMuX2RpcnR5ID0gZmFsc2U7XG4gIHRoaXMuX25ld1ByZWZpeCA9ICdfbmV3Xyc7XG4gIFxuICB0aGlzLl93aXRoRmVhdHVyZUxvY2tzID0gZmFsc2U7XG4gIHRoaXMuX2ZlYXR1cmVMb2NrcyA9IG51bGw7XG4gIFxuICB0aGlzLl9zdGFydGVkID0gZmFsc2U7XG4gIFxuICB0aGlzLl9zZXR0ZXJzbGlzdGVuZXJzID0ge1xuICAgICAgYmVmb3JlOiB7fSxcbiAgICAgIGFmdGVyOiB7fVxuICB9O1xuICB0aGlzLl9nZW9tZXRyeXR5cGVzID0gW1xuICAgICdQb2ludCcsXG4gICAgLy8nTXVsdGlQb2ludCcsXG4gICAgJ0xpbmVTdHJpbmcnLFxuICAgICdNdWx0aUxpbmVTdHJpbmcnLFxuICAgIC8vJ1BvbHlnb24nLFxuICAgIC8vJ011bHRpUG9seWdvbidcbiAgXTtcbiAgXG4gIC8vIGVsZW5jbyBkZWkgdG9vbCBlIGRlbGxlIHJlbGF0aXZlIGNsYXNzaSBwZXIgdGlwbyBkaSBnZW9tZXRyaWEgKGluIGJhc2UgYSB2ZWN0b3IuZ2VvbWV0cnl0eXBlKVxuICB0aGlzLl90b29sc0Zvckdlb21ldHJ5VHlwZXMgPSB7XG4gICAgICAnUG9pbnQnOiB7XG4gICAgICAgIGFkZGZlYXR1cmU6IEFkZEZlYXR1cmVUb29sLFxuICAgICAgICBtb3ZlZmVhdHVyZTogTW92ZUZlYXR1cmVUb29sLFxuICAgICAgICBkZWxldGVmZWF0dXJlOiBEZWxldGVGZWF0dXJlVG9vbCxcbiAgICAgICAgZWRpdGF0dHJpYnV0ZXM6IFBpY2tGZWF0dXJlVG9vbFxuICAgICAgfSxcbiAgICAgICdMaW5lU3RyaW5nJzoge1xuICAgICAgICBhZGRmZWF0dXJlOiBBZGRGZWF0dXJlVG9vbCxcbiAgICAgICAgbW9kaWZ5dmVydGV4OiBNb2RpZnlGZWF0dXJlVG9vbCxcbiAgICAgICAgbW92ZWZlYXR1cmU6IE1vdmVGZWF0dXJlVG9vbCxcbiAgICAgICAgZGVsZXRlZmVhdHVyZTogRGVsZXRlRmVhdHVyZVRvb2wsXG4gICAgICAgIGVkaXRhdHRyaWJ1dGVzOiBQaWNrRmVhdHVyZVRvb2wsXG4gICAgICAgIGN1dGxpbmU6IEN1dExpbmVUb29sXG4gICAgICB9XG4gIH07XG4gIFxuICB0aGlzLl9hY3RpdmVUb29sID0gbmV3IGZ1bmN0aW9uKCl7XG4gICAgdGhpcy50eXBlID0gbnVsbDtcbiAgICB0aGlzLmluc3RhbmNlID0gbnVsbDtcbiAgICBcbiAgICB0aGlzLnNldFRvb2wgPSBmdW5jdGlvbih0eXBlLGluc3RhbmNlKXtcbiAgICAgIHRoaXMudHlwZSA9IHR5cGU7XG4gICAgICB0aGlzLmluc3RhbmNlID0gaW5zdGFuY2U7XG4gICAgfTtcbiAgICBcbiAgICB0aGlzLmdldFR5cGUgPSBmdW5jdGlvbigpe1xuICAgICAgcmV0dXJuIHRoaXMudHlwZTtcbiAgICB9O1xuICAgIFxuICAgIHRoaXMuZ2V0VG9vbCA9IGZ1bmN0aW9uKCl7XG4gICAgICByZXR1cm4gdGhpcy5pbnN0YW5jZTtcbiAgICB9O1xuICAgIFxuICAgIHRoaXMuY2xlYXIgPSBmdW5jdGlvbigpe1xuICAgICAgdGhpcy50eXBlID0gbnVsbDtcbiAgICAgIHRoaXMuaW5zdGFuY2UgPSBudWxsO1xuICAgIH07XG4gIH1cbiAgXG4gIHRoaXMuX3Rvb2xzID0ge307XG4gIFxuICBiYXNlKHRoaXMpO1xufVxuaW5oZXJpdChFZGl0b3IsRzNXT2JqZWN0KTtcbm1vZHVsZS5leHBvcnRzID0gRWRpdG9yO1xuXG52YXIgcHJvdG8gPSBFZGl0b3IucHJvdG90eXBlO1xuXG4vLyBhc3NvY2lhIGwnb2dnZXR0byBWZWN0b3JMYXllciBzdSBjdWkgc2kgdnVvbGUgZmFyZSBsJ2VkaXRpbmdcbnByb3RvLnNldFZlY3RvckxheWVyID0gZnVuY3Rpb24odmVjdG9yTGF5ZXIpe1xuICB2YXIgZ2VvbWV0cnl0eXBlID0gdmVjdG9yTGF5ZXIuZ2VvbWV0cnl0eXBlO1xuICBpZiAoIWdlb21ldHJ5dHlwZSB8fCAhIHRoaXMuX2lzQ29tcGF0aWJsZVR5cGUoZ2VvbWV0cnl0eXBlKSl7XG4gICAgdGhyb3cgRXJyb3IoXCJWZWN0b3IgZ2VvbWV0cnkgdHlwZSBcIitnZW9tZXRyeXR5cGUrXCIgaXMgbm90IHZhbGlkIGZvciBlZGl0aW5nXCIpO1xuICB9XG4gIHRoaXMuX3NldFRvb2xzRm9yVmVjdG9yVHlwZShnZW9tZXRyeXR5cGUpO1xuICB0aGlzLl92ZWN0b3JMYXllciA9IHZlY3RvckxheWVyO1xufTtcblxuLy8gYXZ2aWEgbGEgc2Vzc2lvbmUgZGkgZWRpdGF6aW9uZSBjb24gdW4gZGV0ZXJtaW5hdG8gdG9vbCAoZXMuIGFkZGZlYXR1cmUpXG5wcm90by5zdGFydCA9IGZ1bmN0aW9uKCl7XG4gIC8vIFRPRE86IGFnZ2l1bmdlcmUgbm90aWZpY2EgbmVsIGNhc28gcXVlc3RvIGlmIG5vbiBzaSB2ZXJpZmljaGlcbiAgdmFyIHJlcyA9IGZhbHNlO1xuICAvLyBzZSDDqCBzdGF0byBzZXR0YXRvIGlsIHZlY3RvckxheWVyXG4gIGlmICh0aGlzLl92ZWN0b3JMYXllcil7XG4gICAgLy8gbmVsIGNhc28gbm9uIHNpYSBnacOgIGF2dmlhdG8gcHJpbWEgbG8gc3RvcHBvO1xuICAgIHRoaXMuc3RvcCgpO1xuICAgIFxuICAgIC8vIGlzdGFuemlvIGwnZWRpdFZlY3RvckxheWVyXG4gICAgdGhpcy5fZWRpdFZlY3RvckxheWVyID0gbmV3IFZlY3RvckxheWVyKHtcbiAgICAgIG5hbWU6IFwiZWRpdHZlY3RvclwiLFxuICAgICAgZ2VvbWV0cnl0eXBlOiB0aGlzLl92ZWN0b3JMYXllci5nZW9tZXRyeXR5cGUsXG4gICAgfSlcbiAgICBNYXBTZXJ2aWNlLnZpZXdlci5tYXAuYWRkTGF5ZXIodGhpcy5fZWRpdFZlY3RvckxheWVyLmdldExheWVyKCkpO1xuICAgIFxuICAgIC8vIGlzdGFuemlvIGwnRWRpdEJ1ZmZlclxuICAgIHRoaXMuX2VkaXRCdWZmZXIgPSBuZXcgRWRpdEJ1ZmZlcih0aGlzKTtcbiAgICB0aGlzLl9zZXRTdGFydGVkKHRydWUpO1xuICAgIHJlcyA9IHRydWU7XG4gIH1cbiAgcmV0dXJuIHJlcztcbn07XG5cbi8vIHRlcm1pbmEgbCdlZGl0YXppb25lXG5wcm90by5zdG9wID0gZnVuY3Rpb24oKXtcbiAgaWYgKHRoaXMuaXNTdGFydGVkKCkpe1xuICAgIGlmICh0aGlzLnN0b3BUb29sKCkpIHtcbiAgICAgIHRoaXMuX2VkaXRCdWZmZXIuZGVzdHJveSgpO1xuICAgICAgdGhpcy5fZWRpdEJ1ZmZlciA9IG51bGw7XG4gICAgICB0aGlzLnJlbW92ZUFsbExpc3RlbmVycygpO1xuICAgICAgTWFwU2VydmljZS52aWV3ZXIucmVtb3ZlTGF5ZXJCeU5hbWUodGhpcy5fZWRpdFZlY3RvckxheWVyLm5hbWUpO1xuICAgICAgdGhpcy5fc2V0U3RhcnRlZChmYWxzZSk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIHJldHVybiB0cnVlO1xufTtcblxucHJvdG8uc2V0VG9vbCA9IGZ1bmN0aW9uKHRvb2xUeXBlLG9wdGlvbnMpe1xuICBpZiAoIXRoaXMuc3RvcFRvb2woKSl7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIHZhciB0b29sQ2xhc3MgPSB0aGlzLl90b29sc1t0b29sVHlwZV07XG4gIFxuICAvLyBzZSBlc2lzdGUgaWwgdG9vbCByaWNoaWVzdG9cbiAgaWYgKHRvb2xDbGFzcyApe1xuICAgIHZhciB0b29sSW5zdGFuY2UgPSBuZXcgdG9vbENsYXNzKHRoaXMsb3B0aW9ucyk7XG4gICAgdGhpcy5fYWN0aXZlVG9vbC5zZXRUb29sKHRvb2xUeXBlLHRvb2xJbnN0YW5jZSk7XG4gICAgdGhpcy5fc2V0VG9vbFNldHRlcnNMaXN0ZW5lcnModG9vbEluc3RhbmNlLHRoaXMuX3NldHRlcnNsaXN0ZW5lcnMpO1xuICAgIHRvb2xJbnN0YW5jZS5ydW4oKTtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxufTtcblxucHJvdG8uc3RvcFRvb2wgPSBmdW5jdGlvbigpe1xuICBpZiAodGhpcy5fYWN0aXZlVG9vbC5pbnN0YW5jZSAmJiAhdGhpcy5fYWN0aXZlVG9vbC5pbnN0YW5jZS5zdG9wKCkpe1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICB0aGlzLl9hY3RpdmVUb29sLmNsZWFyKCk7XG4gIHJldHVybiB0cnVlO1xufTtcblxucHJvdG8uZ2V0QWN0aXZlVG9vbCA9IGZ1bmN0aW9uKCl7XG4gIHJldHVybiB0aGlzLl9hY3RpdmVUb29sO1xufTtcblxucHJvdG8uaXNTdGFydGVkID0gZnVuY3Rpb24oKXtcbiAgcmV0dXJuIHRoaXMuX3N0YXJ0ZWQ7XG59O1xuXG5wcm90by5oYXNBY3RpdmVUb29sID0gZnVuY3Rpb24oKXtcbiAgcmV0dXJuICFfLmlzTnVsbCh0aGlzLl9hY3RpdmVUb29sLmluc3RhbmNlKTtcbn07XG5cbnByb3RvLmlzVG9vbEFjdGl2ZSA9IGZ1bmN0aW9uKHRvb2xUeXBlKXtcbiAgIGlmICh0aGlzLl9hY3RpdmVUb29sLnRvb2xUeXBlKXtcbiAgICByZXR1cm4gdGhpcy5fYWN0aXZlVG9vbC50b29sVHlwZSA9PSB0b29sVHlwZTtcbiAgIH07XG4gICByZXR1cm4gZmFsc2U7XG59O1xuXG5wcm90by5nZW5lcmF0ZUlkID0gZnVuY3Rpb24oKXtcbiAgcmV0dXJuIHRoaXMuX2VkaXRCdWZmZXIuZ2VuZXJhdGVJZCgpO1xufTtcblxucHJvdG8uY29tbWl0ID0gZnVuY3Rpb24obmV3RmVhdHVyZXMpe1xuICB0aGlzLl9lZGl0QnVmZmVyLmNvbW1pdChuZXdGZWF0dXJlcyk7XG59O1xuXG5wcm90by51bmRvQWxsID0gZnVuY3Rpb24oKXtcbiAgdGhpcy5fZWRpdEJ1ZmZlci51bmRvQWxsKCk7XG59O1xuXG5wcm90by5zZXRGZWF0dXJlTG9ja3MgPSBmdW5jdGlvbihmZWF0dXJlTG9ja3Mpe1xuICB0aGlzLl93aXRoRmVhdHVyZUxvY2tzID0gdHJ1ZTtcbiAgdGhpcy5fZmVhdHVyZUxvY2tzID0gZmVhdHVyZUxvY2tzO1xufTtcblxucHJvdG8uZ2V0RmVhdHVyZUxvY2tzID0gZnVuY3Rpb24oZmVhdHVyZUxvY2tzKXtcbiAgcmV0dXJuIHRoaXMuX2ZlYXR1cmVMb2Nrcztcbn07XG5cbnByb3RvLmdldEZlYXR1cmVMb2NrSWRzID0gZnVuY3Rpb24oKXtcbiAgcmV0dXJuIF8ubWFwKHRoaXMuX2ZlYXR1cmVMb2NrcyxmdW5jdGlvbihmZWF0dXJlbG9jayl7XG4gICAgcmV0dXJuIGZlYXR1cmVsb2NrLmxvY2tpZDtcbiAgfSk7XG59O1xuXG5wcm90by5nZXRGZWF0dXJlTG9ja3NMb2NrSWRzID0gZnVuY3Rpb24oZmVhdHVyZUxvY2tzKXtcbiAgdmFyIGZlYXR1cmVMb2NrcyA9IGZlYXR1cmVMb2NrcyB8fCB0aGlzLl9mZWF0dXJlTG9ja3M7XG4gIHJldHVybiBfLm1hcChmZWF0dXJlTG9ja3MsZnVuY3Rpb24oZmVhdHVyZWxvY2spe1xuICAgIHJldHVybiBmZWF0dXJlbG9jay5sb2NraWQ7XG4gIH0pO1xufTtcblxucHJvdG8uZ2V0RmVhdHVyZUxvY2tzRmVhdHVyZUlkcyA9IGZ1bmN0aW9uKGZlYXR1cmVMb2Nrcyl7XG4gIHZhciBmZWF0dXJlTG9ja3MgPSBmZWF0dXJlTG9ja3MgfHwgdGhpcy5fZmVhdHVyZUxvY2tzO1xuICByZXR1cm4gXy5tYXAoZmVhdHVyZUxvY2tzLGZ1bmN0aW9uKGZlYXR1cmVsb2NrKXtcbiAgICByZXR1cm4gZmVhdHVyZWxvY2suZmVhdHVyZWlkO1xuICB9KTtcbn07XG5cbnByb3RvLmdldEZlYXR1cmVMb2NrSWRzRm9yRmVhdHVyZUlkcyA9IGZ1bmN0aW9uKGZpZHMpe1xuICB2YXIgZmVhdHVyZWxvY2tzRm9yRmlkcyA9IF8uZmlsdGVyKHRoaXMuX2ZlYXR1cmVMb2NrcyxmdW5jdGlvbihmZWF0dXJlbG9jayl7XG4gICAgcmV0dXJuIF8uaW5jbHVkZXMoZmlkcyxmZWF0dXJlbG9jay5mZWF0dXJlaWQpO1xuICB9KTtcbiAgXG4gIHJldHVybiB0aGlzLmdldEZlYXR1cmVMb2Nrc0xvY2tJZHMoZmVhdHVyZWxvY2tzRm9yRmlkcyk7XG59O1xuXG5wcm90by5nZXRFZGl0ZWRGZWF0dXJlcyA9IGZ1bmN0aW9uKCl7XG4gIHZhciBtb2RpZmllZEZpZHMgPSB0aGlzLl9lZGl0QnVmZmVyLmNvbGxlY3RGZWF0dXJlSWRzKCk7XG4gIHZhciBsb2NrSWRzID0gdGhpcy5nZXRGZWF0dXJlTG9ja0lkc0ZvckZlYXR1cmVJZHMobW9kaWZpZWRGaWRzKTtcbiAgcmV0dXJuIHtcbiAgICBhZGQ6IHRoaXMuX2VkaXRCdWZmZXIuY29sbGVjdEZlYXR1cmVzKCduZXcnLHRydWUpLFxuICAgIHVwZGF0ZTogdGhpcy5fZWRpdEJ1ZmZlci5jb2xsZWN0RmVhdHVyZXMoJ3VwZGF0ZWQnLHRydWUpLFxuICAgIGRlbGV0ZTogdGhpcy5fZWRpdEJ1ZmZlci5jb2xsZWN0RmVhdHVyZXMoJ2RlbGV0ZWQnLHRydWUpLFxuICAgIHJlbGF0aW9uc2F0dHJpYnV0ZXM6IHRoaXMuX2VkaXRCdWZmZXIuY29sbGVjdFJlbGF0aW9uc0F0dHJpYnV0ZXMoKSxcbiAgICBsb2NraWRzOiBsb2NrSWRzXG4gIH1cbn07XG5cbnByb3RvLnNldEZpZWxkc1dpdGhBdHRyaWJ1dGVzID0gZnVuY3Rpb24oZmVhdHVyZSxmaWVsZHMscmVsYXRpb25zKXtcbiAgdmFyIGF0dHJpYnV0ZXMgPSB7fTtcbiAgXy5mb3JFYWNoKGZpZWxkcyxmdW5jdGlvbihmaWVsZCl7XG4gICAgYXR0cmlidXRlc1tmaWVsZC5uYW1lXSA9IGZpZWxkLnZhbHVlO1xuICB9KTtcbiAgXG4gIHZhciByZWxhdGlvbnNBdHRyaWJ1dGVzID0gbnVsbDtcbiAgaWYgKHJlbGF0aW9ucyl7XG4gICAgdmFyIHJlbGF0aW9uc0F0dHJpYnV0ZXMgPSB7fTtcbiAgICBfLmZvckVhY2gocmVsYXRpb25zLGZ1bmN0aW9uKHJlbGF0aW9uLHJlbGF0aW9uS2V5KXtcbiAgICAgIHZhciBhdHRyaWJ1dGVzID0ge307XG4gICAgICBfLmZvckVhY2gocmVsYXRpb24uZmllbGRzLGZ1bmN0aW9uKGZpZWxkKXtcbiAgICAgICAgYXR0cmlidXRlc1tmaWVsZC5uYW1lXSA9IGZpZWxkLnZhbHVlO1xuICAgICAgfSk7XG4gICAgICByZWxhdGlvbnNBdHRyaWJ1dGVzW3JlbGF0aW9uS2V5XSA9IGF0dHJpYnV0ZXM7XG4gICAgfSk7XG4gIH1cbiAgZmVhdHVyZS5zZXRQcm9wZXJ0aWVzKGF0dHJpYnV0ZXMpO1xuICB0aGlzLl9lZGl0QnVmZmVyLnVwZGF0ZUF0dHJpYnV0ZXMoZmVhdHVyZSxyZWxhdGlvbnNBdHRyaWJ1dGVzKTtcbn07XG5cbnByb3RvLnNldEF0dHJpYnV0ZXMgPSBmdW5jdGlvbihmZWF0dXJlLGF0dHJpYnV0ZXMpe1xuICBmZWF0dXJlLnNldFByb3BlcnRpZXMoYXR0cmlidXRlcyk7XG4gIHRoaXMuX2VkaXRCdWZmZXIudXBkYXRlQXR0cmlidXRlcyhmZWF0dXJlKTtcbn07XG5cbnByb3RvLmdldFJlbGF0aW9uc1dpdGhBdHRyaWJ1dGVzID0gZnVuY3Rpb24oZmVhdHVyZSl7XG4gIHZhciBmaWQgPSBmZWF0dXJlLmdldElkKCk7XG4gIGlmICh0aGlzLl92ZWN0b3JMYXllci5oYXNSZWxhdGlvbnMoKSl7XG4gICAgdmFyIGZpZWxkc1Byb21pc2U7XG4gICAgLy8gc2Ugbm9uIGhhIGZpZCB2dW9sIGRpcmUgY2hlIMOoIG51b3ZvIGUgc2VuemEgYXR0cmlidXRpLCBxdWluZGkgcHJlbmRvIGkgZmllbGRzIHZ1b3RpXG4gICAgaWYgKCFmaWQpe1xuICAgICAgZmllbGRzUHJvbWlzZSA9IHRoaXMuX3ZlY3RvckxheWVyLmdldFJlbGF0aW9uc1dpdGhBdHRyaWJ1dGVzKCk7XG4gICAgfVxuICAgIC8vIHNlIHBlciBjYXNvIGhhIHVuIGZpZCBtYSDDqCB1biB2ZXR0b3JpYWxlIG51b3ZvXG4gICAgZWxzZSBpZiAoIXRoaXMuX3ZlY3RvckxheWVyLmdldEZlYXR1cmVCeUlkKGZpZCkpe1xuICAgICAgLy8gc2UgcXVlc3RhIGZlYXR1cmUsIGFuY29yYSBub24gcHJlc2VudGUgbmVsIHZlY3RvckxheWVyLCBoYSBjb211bnF1ZSBpIHZhbG9yaSBkZWxsZSBGS3MgcG9wb2xhdGUsIGFsbG9yYSBsZSBlc3RyYWdnb1xuICAgICAgaWYgKHRoaXMuX3ZlY3RvckxheWVyLmZlYXR1cmVIYXNSZWxhdGlvbnNGa3NXaXRoVmFsdWVzKGZlYXR1cmUpKXtcbiAgICAgICAgdmFyIGZrcyA9IHRoaXMuX3ZlY3RvckxheWVyLmdldFJlbGF0aW9uc0Zrc1dpdGhWYWx1ZXNGb3JGZWF0dXJlKGZlYXR1cmUpO1xuICAgICAgICBmaWVsZHNQcm9taXNlID0gdGhpcy5fdmVjdG9yTGF5ZXIuZ2V0UmVsYXRpb25zV2l0aEF0dHJpYnV0ZXNGcm9tRmtzKGZrcyk7XG4gICAgICB9XG4gICAgICAvLyBhbHRyaW1lbnRpIHByZW5kbyBpIGZpZWxkcyB2dW90aVxuICAgICAgZWxzZSB7XG4gICAgICAgIGZpZWxkc1Byb21pc2UgPSB0aGlzLl92ZWN0b3JMYXllci5nZXRSZWxhdGlvbnNXaXRoQXR0cmlidXRlcygpO1xuICAgICAgfVxuICAgIH1cbiAgICAvLyBzZSBpbnZlY2Ugw6ggdW4gdmV0dG9yaWFsZSBwcmVlc2lzdGVudGUgY29udHJvbGxvIGludGFudG8gc2UgaGEgZGF0aSBkZWxsZSByZWxhemlvbmkgZ2nDoCBlZGl0YXRpXG4gICAgZWxzZSB7ICAgIFxuICAgICAgdmFyIGhhc0VkaXRzID0gdGhpcy5fZWRpdEJ1ZmZlci5hcmVGZWF0dXJlUmVsYXRpb25zRWRpdGVkKGZpZCk7XG4gICAgICBpZiAoaGFzRWRpdHMpe1xuICAgICAgICB2YXIgcmVsYXRpb25zID0gdGhpcy5fdmVjdG9yTGF5ZXIuZ2V0UmVsYXRpb25zKCk7XG4gICAgICAgIHZhciByZWxhdGlvbnNBdHRyaWJ1dGVzID0gdGhpcy5fZWRpdEJ1ZmZlci5nZXRSZWxhdGlvbnNBdHRyaWJ1dGVzKGZpZCk7XG4gICAgICAgIF8uZm9yRWFjaChyZWxhdGlvbnNBdHRyaWJ1dGVzLGZ1bmN0aW9uKHJlbGF0aW9uLHJlbGF0aW9uS2V5KXtcbiAgICAgICAgICBfLmZvckVhY2gocmVsYXRpb25zW3JlbGF0aW9uS2V5XS5maWVsZHMsZnVuY3Rpb24oZmllbGQpe1xuICAgICAgICAgICAgZmllbGQudmFsdWUgPSByZWxhdGlvbnNBdHRyaWJ1dGVzW3JlbGF0aW9uS2V5XVtmaWVsZC5uYW1lXTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIFxuICAgICAgICBmaWVsZHNQcm9taXNlID0gcmVzb2x2ZWRWYWx1ZShyZWxhdGlvbnMpO1xuICAgICAgfVxuICAgICAgLy8gc2Ugbm9uIGNlIGxpIGhhIHZ1b2wgZGlyZSBjaGUgZGV2byBjYXJpY2FyZSBpIGRhdGkgZGVsbGUgcmVsYXppb25pIGRhIHJlbW90b1xuICAgICAgZWxzZSB7XG4gICAgICAgIGZpZWxkc1Byb21pc2UgPSB0aGlzLl92ZWN0b3JMYXllci5nZXRSZWxhdGlvbnNXaXRoQXR0cmlidXRlcyhmaWQpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICBlbHNlIHtcbiAgICBmaWVsZHNQcm9taXNlID0gcmVzb2x2ZWRWYWx1ZShudWxsKTtcbiAgfVxuICByZXR1cm4gZmllbGRzUHJvbWlzZTtcbn07XG5cbnByb3RvLmdldEZpZWxkID0gZnVuY3Rpb24obmFtZSxmaWVsZHMpe1xuICB2YXIgZmllbGRzID0gZmllbGRzIHx8IHRoaXMuZ2V0VmVjdG9yTGF5ZXIoKS5nZXRGaWVsZHNXaXRoQXR0cmlidXRlcygpO1xuICB2YXIgZmllbGQgPSBudWxsO1xuICBfLmZvckVhY2goZmllbGRzLGZ1bmN0aW9uKGYpe1xuICAgIGlmIChmLm5hbWUgPT0gbmFtZSl7XG4gICAgICBmaWVsZCA9IGY7XG4gICAgfVxuICB9KVxuICByZXR1cm4gZmllbGQ7XG59O1xuXG5wcm90by5pc0RpcnR5ID0gZnVuY3Rpb24oKXtcbiAgcmV0dXJuIHRoaXMuX2RpcnR5O1xufTtcblxucHJvdG8ub25hZnRlciA9IGZ1bmN0aW9uKHNldHRlcixsaXN0ZW5lcil7XG4gIHRoaXMuX29uYWZ0ZXJ0b29sYWN0aW9uKHNldHRlcixsaXN0ZW5lcik7XG59O1xuXG4vLyBwZXJtZXR0ZSBkaSBpbnNlcmlyZSB1biBzZXR0ZXIgbGlzdGVuZXIgc2luY3Jvbm8gcHJpbWEgY2hlIHZlbmdhIGVmZmV0dHVhdGEgdW5hIG9wZXJhemlvbmUgZGEgdW4gdG9vbCAoZXMuIGFkZGZlYXR1cmUpXG5wcm90by5vbmJlZm9yZSA9IGZ1bmN0aW9uKHNldHRlcixsaXN0ZW5lcil7XG4gIHRoaXMuX29uYmVmb3JldG9vbGFjdGlvbihzZXR0ZXIsbGlzdGVuZXIsZmFsc2UpO1xufTtcblxuLy8gY29tZSBvbmJlZm9yZSgpIG1hIHBlciBsaXN0ZW5lciBhc2luY3JvbmlcbnByb3RvLm9uYmVmb3JlYXN5bmMgPSBmdW5jdGlvbihzZXR0ZXIsbGlzdGVuZXIpe1xuICB0aGlzLl9vbmJlZm9yZXRvb2xhY3Rpb24oc2V0dGVyLGxpc3RlbmVyLHRydWUpO1xufTtcblxucHJvdG8uYWRkRmVhdHVyZSA9IGZ1bmN0aW9uKGZlYXR1cmUpe1xuICB0aGlzLl9lZGl0QnVmZmVyLmFkZEZlYXR1cmUoZmVhdHVyZSk7XG59O1xuXG5wcm90by51cGRhdGVGZWF0dXJlID0gZnVuY3Rpb24oZmVhdHVyZSl7XG4gIHRoaXMuX2VkaXRCdWZmZXIudXBkYXRlRmVhdHVyZShmZWF0dXJlKTtcbn07XG5cbnByb3RvLmRlbGV0ZUZlYXR1cmUgPSBmdW5jdGlvbihmZWF0dXJlKXtcbiAgdGhpcy5fZWRpdEJ1ZmZlci5kZWxldGVGZWF0dXJlKGZlYXR1cmUpO1xufTtcblxucHJvdG8uZ2V0VmVjdG9yTGF5ZXIgPSBmdW5jdGlvbigpe1xuICByZXR1cm4gdGhpcy5fdmVjdG9yTGF5ZXI7XG59O1xuXG5wcm90by5nZXRFZGl0VmVjdG9yTGF5ZXIgPSBmdW5jdGlvbigpe1xuICByZXR1cm4gdGhpcy5fZWRpdFZlY3RvckxheWVyO1xufTtcblxucHJvdG8uZ2VuZXJhdGVJZCA9IGZ1bmN0aW9uKCl7XG4gIHJldHVybiB0aGlzLl9uZXdQcmVmaXgrRGF0ZS5ub3coKTtcbn07XG5cbnByb3RvLmlzTmV3RmVhdHVyZSA9IGZ1bmN0aW9uKGZpZCl7XG4gIGlmIChmaWQpIHtcbiAgICByZXR1cm4gZmlkLnRvU3RyaW5nKCkuaW5kZXhPZih0aGlzLl9uZXdQcmVmaXgpID09IDA7XG4gIH1cbiAgcmV0dXJuIHRydWU7XG59O1xuXG4vKnByb3RvLmlzTmV3RmVhdHVyZSA9IGZ1bmN0aW9uKGZpZCl7XG4gIGlmIChmaWQpIHtcbiAgICBpZighdGhpcy5nZXRWZWN0b3JMYXllcigpLmdldEZlYXR1cmVCeUlkKGZpZCkpe1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICBlbHNlIHtcbiAgICByZXR1cm4gdHJ1ZVxuICB9XG59OyovXG5cbnByb3RvLl9pc0NvbXBhdGlibGVUeXBlID0gZnVuY3Rpb24oZ2VvbWV0cnl0eXBlKXtcbiAgcmV0dXJuIHRoaXMuX2dlb21ldHJ5dHlwZXMuaW5kZXhPZihnZW9tZXRyeXR5cGUpID4gLTE7XG59O1xuXG5wcm90by5fc2V0VG9vbHNGb3JWZWN0b3JUeXBlID0gZnVuY3Rpb24oZ2VvbWV0cnl0eXBlKXtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICB2YXIgdG9vbHMgPSB0aGlzLl90b29sc0Zvckdlb21ldHJ5VHlwZXNbZ2VvbWV0cnl0eXBlXTtcbiAgXy5mb3JFYWNoKHRvb2xzLGZ1bmN0aW9uKHRvb2xDbGFzcyx0b29sKXtcbiAgICBzZWxmLl90b29sc1t0b29sXSA9IHRvb2xDbGFzcztcbiAgfSlcbn07XG5cbnByb3RvLl9vbmFmdGVydG9vbGFjdGlvbiA9IGZ1bmN0aW9uKHNldHRlcixsaXN0ZW5lcil7XG4gIGlmICghXy5nZXQodGhpcy5fc2V0dGVyc2xpc3RlbmVycy5hZnRlcixzZXR0ZXIpKXtcbiAgICB0aGlzLl9zZXR0ZXJzbGlzdGVuZXJzLmFmdGVyW3NldHRlcl0gPSBbXTtcbiAgfVxuICB0aGlzLl9zZXR0ZXJzbGlzdGVuZXJzLmFmdGVyW3NldHRlcl0ucHVzaCh7XG4gICAgZm5jOiBsaXN0ZW5lclxuICB9KTtcbn1cblxucHJvdG8uX29uYmVmb3JldG9vbGFjdGlvbiA9IGZ1bmN0aW9uKHNldHRlcixsaXN0ZW5lcixhc3luYyl7XG4gIGlmICghXy5nZXQodGhpcy5fc2V0dGVyc2xpc3RlbmVycy5iZWZvcmUsc2V0dGVyKSl7XG4gICAgdGhpcy5fc2V0dGVyc2xpc3RlbmVycy5iZWZvcmVbc2V0dGVyXSA9IFtdO1xuICB9XG4gIHRoaXMuX3NldHRlcnNsaXN0ZW5lcnMuYmVmb3JlW3NldHRlcl0ucHVzaCh7XG4gICAgZm5jOiBsaXN0ZW5lcixcbiAgICBob3c6IGFzeW5jID8gJ2FzeW5jJyA6ICdzeW5jJ1xuICB9KTtcbn1cblxuLy8gdW5hIHZvbHRhIGlzdGFuemlhdG8gaWwgdG9vbCBhZ2dpdW5nbyBhIHF1ZXN0byB0dXR0aSBpIGxpc3RlbmVyIGRlZmluaXRpIGEgbGl2ZWxsbyBkaSBlZGl0b3JcbnByb3RvLl9zZXRUb29sU2V0dGVyc0xpc3RlbmVycyA9IGZ1bmN0aW9uKHRvb2wsc2V0dGVyc0xpc3RlbmVycyl7XG4gIF8uZm9yRWFjaChzZXR0ZXJzTGlzdGVuZXJzLmJlZm9yZSxmdW5jdGlvbihsaXN0ZW5lcnMsc2V0dGVyKXtcbiAgICBpZiAoXy5oYXNJbih0b29sLnNldHRlcnMsc2V0dGVyKSl7XG4gICAgICBfLmZvckVhY2gobGlzdGVuZXJzLGZ1bmN0aW9uKGxpc3RlbmVyKXtcbiAgICAgICAgaWYgKGxpc3RlbmVyLmhvdyA9PSAnc3luYycpe1xuICAgICAgICAgIHRvb2wub25iZWZvcmUoc2V0dGVyLGxpc3RlbmVyLmZuYyk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgdG9vbC5vbmJlZm9yZWFzeW5jKHNldHRlcixsaXN0ZW5lci5mbmMpO1xuICAgICAgICB9XG4gICAgICB9KVxuICAgIH1cbiAgfSk7XG4gIFxuICBfLmZvckVhY2goc2V0dGVyc0xpc3RlbmVycy5hZnRlcixmdW5jdGlvbihsaXN0ZW5lcnMsc2V0dGVyKXtcbiAgICBpZiAoXy5oYXNJbih0b29sLnNldHRlcnMsc2V0dGVyKSl7XG4gICAgICBfLmZvckVhY2gobGlzdGVuZXJzLGZ1bmN0aW9uKGxpc3RlbmVyKXtcbiAgICAgICAgICB0b29sLm9uYWZ0ZXIoc2V0dGVyLGxpc3RlbmVyLmZuYyk7XG4gICAgICB9KVxuICAgIH1cbiAgfSlcbn07XG5cbnByb3RvLl9zZXRTdGFydGVkID0gZnVuY3Rpb24oYm9vbCl7XG4gIHRoaXMuX3N0YXJ0ZWQgPSBib29sO1xufTtcblxucHJvdG8uX3NldERpcnR5ID0gZnVuY3Rpb24oYm9vbCl7XG4gIGlmIChfLmlzTmlsKGJvb2wpKXtcbiAgICB0aGlzLl9kaXJ0eSA9IHRydWU7XG4gIH1cbiAgZWxzZSB7XG4gICAgdGhpcy5fZGlydHkgPSBib29sO1xuICB9XG4gIHRoaXMuZW1pdChcImRpcnR5XCIsdGhpcy5fZGlydHkpO1xufTtcbiIsInZhciBpbmhlcml0ID0gcmVxdWlyZSgnZzN3L2NvcmUvdXRpbHMnKS5pbmhlcml0O1xudmFyIGJhc2UgPSByZXF1aXJlKCdnM3cvY29yZS91dGlscycpLmJhc2U7XG52YXIgRzNXT2JqZWN0ID0gcmVxdWlyZSgnZzN3L2NvcmUvZzN3b2JqZWN0Jyk7XG5cbnZhciBNYXBTZXJ2aWNlID0gcmVxdWlyZSgnZzN3L2NvcmUvbWFwc2VydmljZScpO1xuXG5mdW5jdGlvbiBBZGRGZWF0dXJlVG9vbChlZGl0b3Isb3B0aW9ucyl7XG4gIHZhciBzZWxmID0gdGhpcztcbiAgdmFyIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuICB0aGlzLl9ydW5uaW5nID0gZmFsc2U7XG4gIHRoaXMuX2J1c3kgPSBmYWxzZTtcbiAgdGhpcy5lZGl0b3IgPSBlZGl0b3I7XG4gIHRoaXMuc291cmNlID0gZWRpdG9yLmdldEVkaXRWZWN0b3JMYXllcigpLmdldExheWVyKCkuZ2V0U291cmNlKCk7XG4gIHRoaXMuaXNQYXVzYWJsZSA9IHRydWU7XG4gIFxuICB0aGlzLmRyYXdJbnRlcmFjdGlvbiA9IG51bGw7XG4gIHRoaXMuX3NuYXAgPSBvcHRpb25zLnNuYXAgfHwgbnVsbDtcbiAgdGhpcy5fc25hcEludGVyYWN0aW9uID0gbnVsbDsgXG4gIFxuICB0aGlzLl9maW5pc2hDb25kaXRpb24gPSBvcHRpb25zLmZpbmlzaENvbmRpdGlvbiB8fCBfLmNvbnN0YW50KHRydWUpO1xuICBcbiAgdGhpcy5fY29uZGl0aW9uID0gb3B0aW9ucy5jb25kaXRpb24gfHwgXy5jb25zdGFudCh0cnVlKTtcbiAgXG4gIC8vIHF1aSBzaSBkZWZpbmlzY29ubyBpIG1ldG9kaSBjaGUgdm9nbGlhbW8gcG90ZXIgaW50ZXJjZXR0YXJlLCBlZCBldmVudHVhbG1lbnRlIGJsb2NjYXJlICh2ZWRpIEFQSSBHM1dPYmplY3QpXG4gIHRoaXMuc2V0dGVycyA9IHtcbiAgICBhZGRGZWF0dXJlOiB7XG4gICAgICBmbmM6IEFkZEZlYXR1cmVUb29sLnByb3RvdHlwZS5fYWRkRmVhdHVyZSxcbiAgICAgIGZhbGxiYWNrOiBBZGRGZWF0dXJlVG9vbC5wcm90b3R5cGUuX2ZhbGxCYWNrXG4gICAgfVxuICB9O1xuICBcbiAgYmFzZSh0aGlzKTtcbn1cbmluaGVyaXQoQWRkRmVhdHVyZVRvb2wsRzNXT2JqZWN0KTtcbm1vZHVsZS5leHBvcnRzID0gQWRkRmVhdHVyZVRvb2w7XG5cbnZhciBwcm90byA9IEFkZEZlYXR1cmVUb29sLnByb3RvdHlwZTtcblxuLy8gbWV0b2RvIGVzZWd1aXRvIGFsbCdhdnZpbyBkZWwgdG9vbFxucHJvdG8ucnVuID0gZnVuY3Rpb24oKXtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICB2YXIgbWFwID0gTWFwU2VydmljZS52aWV3ZXIubWFwO1xuICBcbiAgdGhpcy5kcmF3SW50ZXJhY3Rpb24gPSBuZXcgb2wuaW50ZXJhY3Rpb24uRHJhdyh7XG4gICAgdHlwZTogdGhpcy5lZGl0b3IuZ2V0RWRpdFZlY3RvckxheWVyKCkuZ2VvbWV0cnl0eXBlLFxuICAgIHNvdXJjZTogdGhpcy5zb3VyY2UsXG4gICAgY29uZGl0aW9uOiB0aGlzLl9jb25kaXRpb24sXG4gICAgZmluaXNoQ29uZGl0aW9uOiB0aGlzLl9maW5pc2hDb25kaXRpb24gLy8gZGlzcG9uaWJpbGUgZGEgaHR0cHM6Ly9naXRodWIuY29tL29wZW5sYXllcnMvb2wzL2NvbW1pdC9kNDI1Zjc1YmVhMDVjYjc3NTU5OTIzZTQ5NGY1NDE1NmM2NjkwYzBiXG4gIH0pO1xuICBtYXAuYWRkSW50ZXJhY3Rpb24odGhpcy5kcmF3SW50ZXJhY3Rpb24pO1xuICB0aGlzLmRyYXdJbnRlcmFjdGlvbi5zZXRBY3RpdmUodHJ1ZSk7XG4gIFxuICB0aGlzLmRyYXdJbnRlcmFjdGlvbi5vbignZHJhd3N0YXJ0JyxmdW5jdGlvbihlKXtcbiAgICBzZWxmLmVkaXRvci5lbWl0KCdkcmF3c3RhcnQnLGUpO1xuICB9KTtcbiAgXG4gIHRoaXMuZHJhd0ludGVyYWN0aW9uLm9uKCdkcmF3ZW5kJyxmdW5jdGlvbihlKXtcbiAgICBzZWxmLmVkaXRvci5lbWl0KCdkcmF3ZW5kJyxlKTtcbiAgICBpZiAoIXNlbGYuX2J1c3kpe1xuICAgICAgc2VsZi5fYnVzeSA9IHRydWU7XG4gICAgICBzZWxmLnBhdXNlKCk7XG4gICAgICBzZWxmLmFkZEZlYXR1cmUoZS5mZWF0dXJlKTtcbiAgICB9XG4gIH0pO1xuICBcbiAgaWYgKHRoaXMuX3NuYXApe1xuICAgIHRoaXMuX3NuYXBJbnRlcmFjdGlvbiA9IG5ldyBvbC5pbnRlcmFjdGlvbi5TbmFwKHtcbiAgICAgIHNvdXJjZTogdGhpcy5fc25hcC52ZWN0b3JMYXllci5nZXRTb3VyY2UoKVxuICAgIH0pO1xuICAgIG1hcC5hZGRJbnRlcmFjdGlvbih0aGlzLl9zbmFwSW50ZXJhY3Rpb24pO1xuICB9XG59O1xuXG5wcm90by5wYXVzZSA9IGZ1bmN0aW9uKHBhdXNlKXtcbiAgaWYgKF8uaXNVbmRlZmluZWQocGF1c2UpIHx8IHBhdXNlKXtcbiAgICBpZiAodGhpcy5fc25hcEludGVyYWN0aW9uKXtcbiAgICAgIHRoaXMuX3NuYXBJbnRlcmFjdGlvbi5zZXRBY3RpdmUoZmFsc2UpO1xuICAgIH1cbiAgICB0aGlzLmRyYXdJbnRlcmFjdGlvbi5zZXRBY3RpdmUoZmFsc2UpO1xuICB9XG4gIGVsc2Uge1xuICAgIGlmICh0aGlzLl9zbmFwSW50ZXJhY3Rpb24pe1xuICAgICAgdGhpcy5fc25hcEludGVyYWN0aW9uLnNldEFjdGl2ZSh0cnVlKTtcbiAgICB9XG4gICAgdGhpcy5kcmF3SW50ZXJhY3Rpb24uc2V0QWN0aXZlKHRydWUpO1xuICB9XG59O1xuXG4vLyBtZXRvZG8gZXNlZ3VpdG8gYWxsYSBkaXNhdHRpdmF6aW9uZSBkZWwgdG9vbFxucHJvdG8uc3RvcCA9IGZ1bmN0aW9uKCl7XG4gIHZhciBtYXAgPSBNYXBTZXJ2aWNlLnZpZXdlci5tYXA7XG4gIGlmICh0aGlzLl9zbmFwSW50ZXJhY3Rpb24pe1xuICAgICBtYXAucmVtb3ZlSW50ZXJhY3Rpb24odGhpcy5fc25hcEludGVyYWN0aW9uKTtcbiAgICAgdGhpcy5fc25hcEludGVyYWN0aW9uID0gbnVsbDtcbiAgfVxuICBtYXAucmVtb3ZlSW50ZXJhY3Rpb24odGhpcy5kcmF3SW50ZXJhY3Rpb24pO1xuICB0aGlzLmRyYXdJbnRlcmFjdGlvbiA9IG51bGw7XG4gIHJldHVybiB0cnVlO1xufTtcblxucHJvdG8ucmVtb3ZlTGFzdFBvaW50ID0gZnVuY3Rpb24oKXtcbiAgaWYgKHRoaXMuZHJhd0ludGVyYWN0aW9uKXtcbiAgICAvLyBwcm92byBhIHJpbXVvdmVyZSBsJ3VsdGltbyBwdW50by4gTmVsIGNhc28gbm9uIGVzaXN0YSBsYSBnZW9tZXRyaWEgZ2VzdGlzY28gc2lsZW56aW9zYW1lbnRlIGwnZXJyb3JlXG4gICAgdHJ5e1xuICAgICAgdGhpcy5kcmF3SW50ZXJhY3Rpb24ucmVtb3ZlTGFzdFBvaW50KCk7XG4gICAgfVxuICAgIGNhdGNoIChlKXtcbiAgICAgIC8vXG4gICAgfVxuICB9XG59O1xuXG5wcm90by5fYWRkRmVhdHVyZSA9IGZ1bmN0aW9uKGZlYXR1cmUpe1xuICAvLyBhZ2dpdW5nbyBsYSBnZW9tZXRyaWEgbmVsbCdlZGl0IGJ1ZmZlclxuICB0aGlzLmVkaXRvci5hZGRGZWF0dXJlKGZlYXR1cmUpO1xuICB0aGlzLl9idXN5ID0gZmFsc2U7XG4gIHRoaXMucGF1c2UoZmFsc2UpO1xuICByZXR1cm4gdHJ1ZTtcbn07XG5cbnByb3RvLl9mYWxsQmFjayA9IGZ1bmN0aW9uKGZlYXR1cmUpe1xuICB0aGlzLl9idXN5ID0gZmFsc2U7XG4gIC8vIHJpbXVvdm8gbCd1bHRpbWEgZmVhdHVyZSBpbnNlcml0YSwgb3Z2ZXJvIHF1ZWxsYSBkaXNlZ25hdGEgbWEgY2hlIG5vbiBzaSB2dW9sZSBzYWx2YXJlXG4gIHRoaXMuc291cmNlLmdldEZlYXR1cmVzQ29sbGVjdGlvbigpLnBvcCgpO1xuICB0aGlzLnBhdXNlKGZhbHNlKTtcbn07XG4iLCJ2YXIgaW5oZXJpdCA9IHJlcXVpcmUoJ2czdy9jb3JlL3V0aWxzJykuaW5oZXJpdDtcbnZhciBiYXNlID0gcmVxdWlyZSgnZzN3L2NvcmUvdXRpbHMnKS5iYXNlO1xudmFyIGdlb20gPSByZXF1aXJlKCdnM3cvY29yZS9nZW9tJyk7XG52YXIgTWFwU2VydmljZSA9IHJlcXVpcmUoJ2czdy9jb3JlL21hcHNlcnZpY2UnKTtcbnZhciBQaWNrRmVhdHVyZUludGVyYWN0aW9uID0gcmVxdWlyZSgnZzN3LW9sMy9zcmMvaW50ZXJhY3Rpb25zL3BpY2tmZWF0dXJlaW50ZXJhY3Rpb24nKTtcbnZhciBQaWNrQ29vcmRpbmF0ZXNJbnRlcmFjdGlvbiA9IHJlcXVpcmUoJ2czdy1vbDMvc3JjL2ludGVyYWN0aW9ucy9waWNrY29vcmRpbmF0ZXNpbnRlcmFjdGlvbicpO1xuXG52YXIgRWRpdGluZ1Rvb2wgPSByZXF1aXJlKCcuL3Rvb2wnKTtcblxuXG5cbmZ1bmN0aW9uIEN1dExpbmVUb29sKGVkaXRvcixvcHRpb25zKXtcbiAgdGhpcy5zZXR0ZXJzID0ge1xuICAgIGN1dExpbmU6IEN1dExpbmVUb29sLnByb3RvdHlwZS5fY3V0TGluZVxuICB9O1xuICBcbiAgYmFzZSh0aGlzLGVkaXRvcixvcHRpb25zKTtcbiAgXG4gIHZhciBzZWxmID0gdGhpcztcbiAgdGhpcy5pc1BhdXNhYmxlID0gdHJ1ZTtcbiAgdGhpcy5zdGVwcyA9IG5ldyBFZGl0aW5nVG9vbC5TdGVwcyhDdXRMaW5lVG9vbC5zdGVwcyk7XG4gIFxuICB0aGlzLl9vcmlnRmVhdHVyZSA9IG51bGw7XG4gIHRoaXMuX29yaWdHZW9tZXRyeSA9IG51bGw7XG4gIHRoaXMuX25ld0ZlYXR1cmVzID0gW107XG4gIHRoaXMuX2xpbmVQaWNrSW50ZXJhY3Rpb24gPSBudWxsO1xuICB0aGlzLl9wb2ludFBpY2tJbnRlcmFjdGlvbiA9IG51bGw7XG4gIHRoaXMuX3NlbGVjdExpbmVUb0tlZXBJbnRlcmFjdGlvbiA9IG51bGw7XG4gIHRoaXMuX3BvaW50TGF5ZXIgPSBvcHRpb25zLnBvaW50TGF5ZXIgfHwgbnVsbDtcbiAgdGhpcy5fbWluQ3V0UG9pbnREaXN0YW5jZSA9IG9wdGlvbnMubWluQ3V0UG9pbnREaXN0YW5jZSB8fCBJbmZpbml0eTtcbiAgdGhpcy5fbW9kVHlwZSA9IG9wdGlvbnMubW9kVHlwZSB8fCAnTU9ET05DVVQnOyAvLyAnTkVXT05DVVQnIHwgJ01PRE9OQ1VUJ1xuICBcbiAgdGhpcy5fc2VsZWN0ZWRMaW5lT3ZlcmxheSA9IG5ldyBvbC5sYXllci5WZWN0b3Ioe1xuICAgIHNvdXJjZTogbmV3IG9sLnNvdXJjZS5WZWN0b3IoKSxcbiAgICBzdHlsZTogbmV3IG9sLnN0eWxlLlN0eWxlKHtcbiAgICAgIHN0cm9rZTogbmV3IG9sLnN0eWxlLlN0cm9rZSh7XG4gICAgICAgIGNvbG9yOiAncmdiKDI1NSwyNTUsMCknLFxuICAgICAgICB3aWR0aDogNFxuICAgICAgfSlcbiAgICB9KVxuICB9KTtcbiAgXG4gIC8vdmFyIGN1dExpbmVJZHggPSAwO1xuICAvL3ZhciBjdXRMaW5lQ29sb3JzID0gWydyZ2IoMjU1LDAsMCknLCdyZ2IoMCwwLDI1NSknXVxuICB0aGlzLl9saW5lVG9LZWVwT3ZlcmxheSA9IG5ldyBvbC5sYXllci5WZWN0b3Ioe1xuICAgIHNvdXJjZTogbmV3IG9sLnNvdXJjZS5WZWN0b3IoKSxcbiAgICAvKnN0eWxlOiBmdW5jdGlvbihmZWF0dXJlKXsgXG4gICAgICBjdXRMaW5lSWR4ICs9IDE7XG4gICAgICByZXR1cm4gW25ldyBvbC5zdHlsZS5TdHlsZSh7XG4gICAgICAgIHN0cm9rZTogbmV3IG9sLnN0eWxlLlN0cm9rZSh7XG4gICAgICAgICAgY29sb3I6IGN1dExpbmVDb2xvcnNbY3V0TGluZUlkeCUyXSxcbiAgICAgICAgICB3aWR0aDogNFxuICAgICAgICB9KVxuICAgICAgfSldXG4gICAgfSovXG4gIH0pO1xuXG4gIFxufVxuaW5oZXJpdChDdXRMaW5lVG9vbCxFZGl0aW5nVG9vbCk7XG5tb2R1bGUuZXhwb3J0cyA9IEN1dExpbmVUb29sO1xuXG52YXIgcHJvdG8gPSBDdXRMaW5lVG9vbC5wcm90b3R5cGU7XG5cbnByb3RvLnJ1biA9IGZ1bmN0aW9uKCl7XG4gIHZhciBzZWxmID0gdGhpcztcbiAgXG4gIHRoaXMuX2xpbmVQaWNrSW50ZXJhY3Rpb24gPSBuZXcgUGlja0ZlYXR1cmVJbnRlcmFjdGlvbih7XG4gICAgbGF5ZXJzOiBbdGhpcy5sYXllcix0aGlzLmVkaXRpbmdMYXllcl1cbiAgfSk7XG4gIFxuICB0aGlzLm1hcC5hZGRJbnRlcmFjdGlvbih0aGlzLl9saW5lUGlja0ludGVyYWN0aW9uKTtcbiAgXG4gIC8vIHNlbGV6aW9ubyBsYSBsaW5lYSBkYSB0YWdsaWFyZVxuICBzZWxmLnN0ZXBzLm5leHQoKTtcbiAgdGhpcy5fbGluZVBpY2tJbnRlcmFjdGlvbi5vbigncGlja2VkJyxmdW5jdGlvbihlKXtcbiAgICB2YXIgY3V0RmVhdHVyZTtcbiAgICB2YXIgZmVhdHVyZSA9IHNlbGYuX29yaWdGZWF0dXJlID0gZS5mZWF0dXJlO1xuICAgIHNlbGYuX29yaWdHZW9tZXRyeSA9IGZlYXR1cmUuZ2V0R2VvbWV0cnkoKS5jbG9uZSgpO1xuICAgIHNlbGYuX3Nob3dTZWxlY3Rpb24oc2VsZi5fb3JpZ0dlb21ldHJ5LDMwMCk7XG4gICAgc2VsZi5tYXAucmVtb3ZlSW50ZXJhY3Rpb24odGhpcyk7XG5cbiAgICBcbiAgICBpZiAoc2VsZi5fcG9pbnRMYXllcil7XG4gICAgICBzZWxmLl9wb2ludFBpY2tJbnRlcmFjdGlvbiA9IG5ldyBQaWNrRmVhdHVyZUludGVyYWN0aW9uKHtcbiAgICAgICAgbGF5ZXJzOiBbc2VsZi5fcG9pbnRMYXllcl1cbiAgICAgIH0pO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIHNlbGYuX3BvaW50UGlja0ludGVyYWN0aW9uID0gbmV3IFBpY2tDb29yZGluYXRlc0ludGVyYWN0aW9uKCk7XG4gICAgfVxuICAgIFxuICAgIC8vIHBlc2NvIGNvb3JkaW5hdGEgbyBmZWF0dXJlIGRpIHRhZ2xpbyBzZWxlemlvbmF0YVxuICAgIHNlbGYuc3RlcHMubmV4dCgpO1xuICAgIHNlbGYuX3BvaW50UGlja0ludGVyYWN0aW9uLm9uKCdwaWNrZWQnLGZ1bmN0aW9uKGUpe1xuICAgICAgc2VsZi5tYXAucmVtb3ZlSW50ZXJhY3Rpb24odGhpcyk7XG4gICAgICB2YXIgY29vcmRpbmF0ZTtcbiAgICAgIGlmIChlLmZlYXR1cmUpe1xuICAgICAgICBjdXRGZWF0dXJlID0gZS5mZWF0dXJlO1xuICAgICAgICBjb29yZGluYXRlID0gY3V0RmVhdHVyZS5nZXRHZW9tZXRyeSgpLmdldENvb3JkaW5hdGVzKCk7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgY29vcmRpbmF0ZSA9IGUuY29vcmRpbmF0ZTtcbiAgICAgIH1cbiAgICAgIGlmIChjb29yZGluYXRlKXtcbiAgICAgICAgLy8gc25hcHBvIHN1bGxhIGxpbmVhXG4gICAgICAgIHZhciBjbG9zZXN0Q29vcmRpbmF0ZSA9IGZlYXR1cmUuZ2V0R2VvbWV0cnkoKS5nZXRDbG9zZXN0UG9pbnQoY29vcmRpbmF0ZSk7XG4gICAgICAgIHZhciBkaXN0YW5jZSA9IGdlb20uZGlzdGFuY2UoY29vcmRpbmF0ZSxjbG9zZXN0Q29vcmRpbmF0ZSk7XG4gICAgICAgIC8vIHNlIGxvIHNuYXAgw6ggZW50cm8gbGEgdG9sbGVyYW56YVxuICAgICAgICBpZiAoZGlzdGFuY2UgPCBzZWxmLl9taW5DdXRQb2ludERpc3RhbmNlKXtcbiAgICAgICAgICAvLyB0YWdsaW8gbGEgbGluZWEgZSBvdHRlbmdvIGwnYXJyYXkgY29uIGxlIGR1ZSBudW92ZSBmZWF0dXJlXG4gICAgICAgICAgdmFyIHNsaWNlZExpbmVzID0gc2VsZi5fY3V0KGZlYXR1cmUuZ2V0R2VvbWV0cnkoKSxjbG9zZXN0Q29vcmRpbmF0ZSk7XG4gICAgICAgICAgaWYgKHNsaWNlZExpbmVzKXtcbiAgICAgICAgICAgIHZhciBwcmV2TGluZUZlYXR1cmUgPSBzbGljZWRMaW5lc1swXTtcbiAgICAgICAgICAgIHZhciBuZXh0TGluZUZlYXR1cmUgPSBzbGljZWRMaW5lc1sxXTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgdmFyIG5ld0lkID0gc2VsZi5lZGl0b3IuZ2VuZXJhdGVJZCgpO1xuICAgICAgICAgICAgcHJldkxpbmVGZWF0dXJlLnNldElkKG5ld0lkKydfMScpO1xuICAgICAgICAgICAgbmV4dExpbmVGZWF0dXJlLnNldElkKG5ld0lkKydfMicpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBwcmVuZG8gbGUgcHJvcHJpZXTDoCBkZWxsYSBmZWF0dXJlIG9yaWdpbmFsZSAoZXNjbHVzYSBsYSBnZW9tZXRyaWEpXG4gICAgICAgICAgICB2YXIgb3JpZ1Byb3BlcnRpZXMgPSBmZWF0dXJlLmdldFByb3BlcnRpZXMoKTtcbiAgICAgICAgICAgIGRlbGV0ZSBvcmlnUHJvcGVydGllc1tmZWF0dXJlLmdldEdlb21ldHJ5TmFtZSgpXTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgc2VsZi5fc2hvd1NlbGVjdGlvbihwcmV2TGluZUZlYXR1cmUuZ2V0R2VvbWV0cnkoKSwzMDApO1xuICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICBzZWxmLl9zaG93U2VsZWN0aW9uKG5leHRMaW5lRmVhdHVyZS5nZXRHZW9tZXRyeSgpLDMwMCk7XG4gICAgICAgICAgICB9LDMwMClcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gbmVsIGNhc28gZGkgbW9kaWZpY2Egc3UgdGFnbGlvXG4gICAgICAgICAgICBpZiAoc2VsZi5fbW9kVHlwZSA9PSAnTU9ET05DVVQnKXtcbiAgICAgICAgICAgICAgLy8gc2VsZXppb25vIGxhIHBvcnppb25lIGRhIG1hbnRlbmVyZS9tb2RpZmljYXJlXG4gICAgICAgICAgICAgIHNlbGYuc3RlcHMubmV4dCgpO1xuICAgICAgICAgICAgICBzZWxmLl9zZWxlY3RMaW5lVG9LZWVwKHByZXZMaW5lRmVhdHVyZSxuZXh0TGluZUZlYXR1cmUpXG4gICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGZlYXR1cmVUb0tlZXApe1xuICAgICAgICAgICAgICAgIC8vIGFnZ2lvcm5vIGxhIGZlYXR1cmUgb3JpZ2luYWxlIGNvbiBsYSBnZW9tZXRyaWEgZGVsbGEgZmVhdHVyZSBjaGUgc2kgw6ggc2VsZXppb25hdG8gZGEgbWFudGVuZXJlXG4gICAgICAgICAgICAgICAgZmVhdHVyZS5zZXRHZW9tZXRyeShmZWF0dXJlVG9LZWVwLmdldEdlb21ldHJ5KCkuY2xvbmUoKSk7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgdmFyIGZlYXR1cmVUb0FkZDtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAvLyByaW11b3ZvIHVuYSBkZWxsZSBkdWUgbnVvdmUgZmVhdHVyZSBlIG1pIHRlbmdvIGwndW5pY2EgZmVhdHVyZSBkYSBhZ2dpdW5nZXJlIGNvbWUgbnVvdmFcbiAgICAgICAgICAgICAgICBpZiAocHJldkxpbmVGZWF0dXJlLmdldElkKCkgPT0gZmVhdHVyZVRvS2VlcC5nZXRJZCgpKXtcbiAgICAgICAgICAgICAgICAgIGRlbGV0ZSBwcmV2TGluZUZlYXR1cmU7XG4gICAgICAgICAgICAgICAgICBmZWF0dXJlVG9BZGQgPSBuZXh0TGluZUZlYXR1cmU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKG5leHRMaW5lRmVhdHVyZS5nZXRJZCgpID09IGZlYXR1cmVUb0tlZXAuZ2V0SWQoKSl7XG4gICAgICAgICAgICAgICAgICBkZWxldGUgbmV4dExpbmVGZWF0dXJlO1xuICAgICAgICAgICAgICAgICAgZmVhdHVyZVRvQWRkID0gcHJldkxpbmVGZWF0dXJlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBzZWxmLl9uZXdGZWF0dXJlcy5wdXNoKGZlYXR1cmVUb0FkZCk7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgLy8gdHJhbWl0ZSBsJ2VkaXRvciBhc3NlZ25vIGFsbGEgbnVvdmEgZmVhdHVyZSBnbGkgc3Rlc3NpIGF0dHJpYnV0aSBkZWxsJ2FsdHJhLCBvcmlnaW5hbGUsIG1vZGlmaWNhdGFcbiAgICAgICAgICAgICAgICBmZWF0dXJlVG9BZGQuc2V0UHJvcGVydGllcyhvcmlnUHJvcGVydGllcyk7XG4gICAgICAgICAgICAgICAgLy8gZSBsYSBhZ2dpdW5nbyBhbCBsYXllciBkaSBlZGl0aW5nLCBjb3PDrCBtaSB2aWVuZSBtb3N0cmF0YSBjb21lIG51b3ZhIGZlYXR1cmUgc3VsbGEgbWFwcGFcbiAgICAgICAgICAgICAgICBzZWxmLmVkaXRpbmdMYXllci5nZXRTb3VyY2UoKS5hZGRGZWF0dXJlcyhbZmVhdHVyZVRvQWRkXSk7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgdmFyIGRhdGEgPSB7XG4gICAgICAgICAgICAgICAgICBhZGRlZDogW2ZlYXR1cmVUb0FkZF0sXG4gICAgICAgICAgICAgICAgICB1cGRhdGVkOiBmZWF0dXJlLFxuICAgICAgICAgICAgICAgICAgY3V0ZmVhdHVyZTpjdXRGZWF0dXJlXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIC8vIGEgcXVlc3RvIHB1bnRvIGF2dmlvIGlsIHNldHRlciwgY2hlIHNpIG9jY3VwZXLDsiBkaSBhZ2dpb3JuYXJlIGwnZWRpdGJ1ZmZlciBhIHNlY29uZGEgZGVsIHRpcG8gZGkgbW9kaWZpY2FcbiAgICAgICAgICAgICAgICBzZWxmLmN1dExpbmUoZGF0YSxzZWxmLl9tb2RUeXBlKVxuICAgICAgICAgICAgICAgIC5mYWlsKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICBzZWxmLl9yb2xsQmFjaygpO1xuICAgICAgICAgICAgICAgICAgc2VsZi5yZXJ1bigpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgLy8gbmVsIGNhc28gbGEgbW9kaWZpY2Egc2lhIGFnZ2l1bmdvIHN1IHRhZ2xpYSwgYWxsb3JhIHJpbXVvdm8gbCdvcmlnaW5hbGUgZSBhZ2dpdW5nbyBsZSBkdWUgbnVvdmUgZmVhdHVyZVxuICAgICAgICAgICAgICBzZWxmLmxheWVyLmdldFNvdXJjZSgpLnJlbW92ZUZlYXR1cmUoZmVhdHVyZSk7XG4gICAgICAgICAgICAgIC8vc2VsZi5lZGl0b3Iuc2V0QXR0cmlidXRlcyhwcmV2TGluZUZlYXR1cmUsb3JpZ1Byb3BlcnRpZXMpO1xuICAgICAgICAgICAgICAvL3NlbGYuZWRpdG9yLnNldEF0dHJpYnV0ZXMobmV4dExpbmVGZWF0dXJlLG9yaWdQcm9wZXJ0aWVzKTtcbiAgICAgICAgICAgICAgc2VsZi5fbmV3RmVhdHVyZXMucHVzaChwcmV2TGluZUZlYXR1cmUpO1xuICAgICAgICAgICAgICBzZWxmLl9uZXdGZWF0dXJlcy5wdXNoKG5leHRMaW5lRmVhdHVyZSk7XG4gICAgICAgICAgICAgIHNlbGYuZWRpdGluZ0xheWVyLmdldFNvdXJjZSgpLmFkZEZlYXR1cmVzKFtmZWF0dXJlVG9BZGQscHJldkxpbmVGZWF0dXJlXSk7XG4gICAgICAgICAgICAgIFxuICAgICAgICAgICAgICB2YXIgZGF0YSA9IHtcbiAgICAgICAgICAgICAgICBhZGRlZDogW3ByZXZMaW5lRmVhdHVyZSxuZXh0TGluZUZlYXR1cmVdLFxuICAgICAgICAgICAgICAgIHJlbW92ZWQ6IGZlYXR1cmVcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgc2VsZi5jdXRMaW5lKGRhdGEsc2VsZi5fbW9kVHlwZSlcbiAgICAgICAgICAgICAgLmZhaWwoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICBzZWxmLl9yb2xsQmFjaygpO1xuICAgICAgICAgICAgICAgIHNlbGYucmVydW4oKTtcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBzZWxmLnJlcnVuKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSlcbiAgICBzZWxmLm1hcC5hZGRJbnRlcmFjdGlvbihzZWxmLl9wb2ludFBpY2tJbnRlcmFjdGlvbik7XG4gIH0pO1xufTtcblxucHJvdG8ucGF1c2UgPSBmdW5jdGlvbihwYXVzZSl7XG4gIGlmIChfLmlzVW5kZWZpbmVkKHBhdXNlKSB8fCBwYXVzZSl7XG4gICAgdGhpcy5fbGluZVBpY2tJbnRlcmFjdGlvbi5zZXRBY3RpdmUoZmFsc2UpO1xuICAgIHRoaXMuX3BvaW50UGlja0ludGVyYWN0aW9uLnNldEFjdGl2ZShmYWxzZSk7XG4gIH1cbiAgZWxzZSB7XG4gICAgdGhpcy5fbGluZVBpY2tJbnRlcmFjdGlvbi5zZXRBY3RpdmUodHJ1ZSk7XG4gICAgdGhpcy5fcG9pbnRQaWNrSW50ZXJhY3Rpb24uc2V0QWN0aXZlKHRydWUpO1xuICB9XG59O1xuXG5wcm90by5yZXJ1biA9IGZ1bmN0aW9uKCl7XG4gIHRoaXMuc3RvcCgpO1xuICB0aGlzLnJ1bigpO1xufTtcblxucHJvdG8uc3RvcCA9IGZ1bmN0aW9uKCl7XG4gIHRoaXMuX2NsZWFuVXAoKTtcbiAgXG4gIHZhciBzdG9wID0gRWRpdGluZ1Rvb2wucHJvdG90eXBlLnN0b3AuY2FsbCh0aGlzKTtcbiAgXG4gIGlmIChzdG9wKSB7XG4gICAgdGhpcy5tYXAucmVtb3ZlSW50ZXJhY3Rpb24odGhpcy5fbGluZVBpY2tJbnRlcmFjdGlvbik7XG4gICAgdGhpcy5tYXAucmVtb3ZlSW50ZXJhY3Rpb24odGhpcy5fcG9pbnRQaWNrSW50ZXJhY3Rpb24pO1xuICAgIHRoaXMuX2xpbmVQaWNrSW50ZXJhY3Rpb24gPSBudWxsO1xuICAgIHRoaXMuX3BvaW50UGlja0ludGVyYWN0aW9uID0gbnVsbDtcbiAgfVxuXG4gIHJldHVybiBzdG9wO1xufTtcblxucHJvdG8uX2NsZWFuVXAgPSBmdW5jdGlvbigpe1xuICB0aGlzLl9vcmlnRmVhdHVyZSA9IG51bGw7XG4gIHRoaXMuX29yaWdHZW9tZXRyeSA9IG51bGw7XG4gIHRoaXMuX25ld0ZlYXR1cmVzID0gW107XG4gIHRoaXMuX2xpbmVUb0tlZXBPdmVybGF5LnNldE1hcChudWxsKTtcbiAgdGhpcy5fc2VsZWN0ZWRMaW5lT3ZlcmxheS5zZXRNYXAobnVsbCk7XG59O1xuXG5wcm90by5fcm9sbEJhY2sgPSBmdW5jdGlvbigpe1xuICAvLyByaW1ldHRvIGxhIHZlY2NoaWEgZ2VvbWV0cmlhXG4gIHRoaXMuX29yaWdGZWF0dXJlLnNldEdlb21ldHJ5KHRoaXMuX29yaWdHZW9tZXRyeSk7XG4gIC8vIHJpbXVvdm8gbGUgZmVhdHVyZSAobnVvdmUpIGVkaXRhdGUgZGFsIGxheWVyIGRpIGVkaXRhemlvbmVcbiAgdHJ5IHtcbiAgICBfLmZvckVhY2godGhpcy5fbmV3RmVhdHVyZXMsZnVuY3Rpb24oZmVhdHVyZSl7XG4gICAgICBzZWxmLmVkaXRpbmdMYXllci5nZXRTb3VyY2UoKS5yZW1vdmVGZWF0dXJlKGZlYXR1cmUpO1xuICAgIH0pO1xuICB9XG4gIGNhdGNoIChlKSB7fTtcbn07XG5cbnByb3RvLl9jdXRMaW5lID0gZnVuY3Rpb24oZGF0YSxtb2RUeXBlKXtcbiAgLy8gc2UgbW9kaWZpY28gc3UgdGFnbGlvIGFnZ2lvcm5vIGxhIHZlY2NoaWEgZmVhdHVyZSBlIGFnZ2l1bmdvIGxhIG51b3ZhXG4gIGlmIChtb2RUeXBlID09ICdNT0RPTkNVVCcpe1xuICAgIHZhciBmZWF0dXJlVG9VcGRhdGUgPSBkYXRhLnVwZGF0ZWQ7XG4gICAgdmFyIGZlYXR1cmVUb0FkZCA9IGRhdGEuYWRkZWRbMF07XG4gICAgdGhpcy5lZGl0b3IudXBkYXRlRmVhdHVyZShmZWF0dXJlVG9VcGRhdGUpO1xuICAgIHRoaXMuZWRpdG9yLmFkZEZlYXR1cmUoZmVhdHVyZVRvQWRkKTtcbiAgfVxuICAvLyBhbHRyaW1lbnRpIHJpbXVvdm8gbGEgdmVjY2hpYSBlIGFnZ2l1bmdvIGxlIG51b3ZlXG4gIGVsc2V7XG4gICAgdmFyIGZlYXR1cmVUb1JlbW92ZSA9IGRhdGEucmVtb3ZlZDtcbiAgICB2YXIgZmVhdHVyZVRvQWRkMSA9IGRhdGEuYWRkZWRbMF07XG4gICAgdmFyIGZlYXR1cmVUb0FkZDIgPSBkYXRhLmFkZGVkWzFdO1xuICAgIHRoaXMuZWRpdG9yLmRlbGV0ZUZlYXR1cmUoZmVhdHVyZVRvUmVtb3ZlKTtcbiAgICB0aGlzLmVkaXRvci5hZGRGZWF0dXJlKGZlYXR1cmVUb0FkZDEpO1xuICAgIHRoaXMuZWRpdG9yLmFkZEZlYXR1cmUoZmVhdHVyZVRvQWRkMik7XG4gIH1cbiAgdGhpcy5fYnVzeSA9IGZhbHNlO1xuICB0aGlzLnBhdXNlKGZhbHNlKTtcbiAgdGhpcy5zdGVwcy5jb21wbGV0ZWQoKTtcbiAgdGhpcy5yZXJ1bigpO1xuICByZXR1cm4gdHJ1ZTtcbn07XG5cbnByb3RvLl9zZWxlY3RMaW5lVG9LZWVwID0gZnVuY3Rpb24ocHJldkxpbmVGZWF0dXJlLG5leHRMaW5lRmVhdHVyZSl7XG4gIHZhciBkID0gJC5EZWZlcnJlZCgpO1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIHZhciBsYXllciA9IHRoaXMuX2xpbmVUb0tlZXBPdmVybGF5O1xuICBsYXllci5nZXRTb3VyY2UoKS5hZGRGZWF0dXJlcyhbcHJldkxpbmVGZWF0dXJlLG5leHRMaW5lRmVhdHVyZV0pO1xuICBsYXllci5zZXRNYXAodGhpcy5tYXApO1xuICBcbiAgdmFyIHNlbGVjdExpbmVJbnRlcmFjdGlvbiA9IG5ldyBQaWNrRmVhdHVyZUludGVyYWN0aW9uKHtcbiAgICBsYXllcnM6IFt0aGlzLl9saW5lVG9LZWVwT3ZlcmxheV0sXG4gIH0pO1xuICB0aGlzLm1hcC5hZGRJbnRlcmFjdGlvbihzZWxlY3RMaW5lSW50ZXJhY3Rpb24pO1xuICBcbiAgc2VsZWN0TGluZUludGVyYWN0aW9uLm9uKCdwaWNrZWQnLGZ1bmN0aW9uKGUpe1xuICAgIGxheWVyLnNldE1hcChudWxsKTtcbiAgICBzZWxmLm1hcC5yZW1vdmVJbnRlcmFjdGlvbih0aGlzKTtcbiAgICBkLnJlc29sdmUoZS5mZWF0dXJlKTtcbiAgfSk7XG4gIFxuICByZXR1cm4gZC5wcm9taXNlKCk7XG59O1xuXG5wcm90by5fZmFsbEJhY2sgPSBmdW5jdGlvbihmZWF0dXJlKXtcbiAgdGhpcy5fYnVzeSA9IGZhbHNlO1xuICB0aGlzLnBhdXNlKGZhbHNlKTtcbn07XG5cbnByb3RvLl9jdXQgPSBmdW5jdGlvbihnZW9tZXRyeSxjdXRDb29yZGluYXRlKXtcbiAgd2hpbGUgKGN1dENvb3JkaW5hdGUubGVuZ3RoIDwgZ2VvbWV0cnkuZ2V0U3RyaWRlKCkpIHtcbiAgICBjdXRDb29yZGluYXRlLnB1c2goMCk7XG4gIH1cblxuICB2YXIgbWluRGlzdGFuY2UgPSBJbmZpbml0eTtcbiAgdmFyIGNsb3Nlc3RJbmRleCA9IDA7XG4gIHZhciBpbmRleCA9IDA7XG4gIC8vIGNlcmNvIGwnaW5kaWNlIGRlbCBzZWdtZW50byBsaW5lYXJlIHN1IGN1aSByaWNhZGUgbGEgY29vcmRpbmF0YSBkaSB0YWdsaW9cbiAgZ2VvbWV0cnkuZm9yRWFjaFNlZ21lbnQoZnVuY3Rpb24odjAsdjEpe1xuICAgIHZhciBzZWdtZW50UG9pbnQgPSBnZW9tLmNsb3Nlc3RPblNlZ21lbnQoY3V0Q29vcmRpbmF0ZSxbdjAsdjFdKTtcbiAgICB2YXIgZGlzdGFuY2UgPSBnZW9tLmRpc3RhbmNlKGN1dENvb3JkaW5hdGUsc2VnbWVudFBvaW50KTtcbiAgICBpZiAoZGlzdGFuY2UgPCBtaW5EaXN0YW5jZSl7XG4gICAgICBtaW5EaXN0YW5jZSA9IGRpc3RhbmNlO1xuICAgICAgY2xvc2VzdEluZGV4ID0gaW5kZXg7XG4gICAgfVxuICAgIGluZGV4ICs9IDE7XG4gIH0pXG4gIFxuICB2YXIgY29vcmRpbmF0ZXMgPSBnZW9tZXRyeS5nZXRDb29yZGluYXRlcygpO1xuICAvLyBwcmVuZG8gbGEgcHJpbWEgcG9yemlvbmUgZGkgY29vcmRpbmF0ZVxuICB2YXIgcHJldkNvb3JkcyA9IGNvb3JkaW5hdGVzLnNsaWNlKDAsY2xvc2VzdEluZGV4KzEpO1xuICAvLyBhZ2dpdW5nbyBsYSBjb29yZGluYXRhIGRpIHRhZ2xpbyBhbGxhIHByaW1hIHBvcnppb25lXG4gIHByZXZDb29yZHMuc3BsaWNlKHByZXZDb29yZHMubGVuZ3RoLDAsY3V0Q29vcmRpbmF0ZSk7XG4gIC8vIHByZW5kbyBsYSBzZWNvbmRhIHBvcnppb25lIGRpIGNvb3JkaW5hdGVcbiAgdmFyIG5leHRDb29yZHMgPSBjb29yZGluYXRlcy5zbGljZShjbG9zZXN0SW5kZXgpO1xuICAvLyBhZ2dpdW5nbyBsYSBjb29yZGluYXRhIGRpIHRhZ2xpbyBhbGxhIHNlY29uZGEgcG9yemlvbmVcbiAgbmV4dENvb3Jkcy5zcGxpY2UoMCwxLGN1dENvb3JkaW5hdGUpO1xuICBcbiAgaWYgKHByZXZDb29yZHMubGVuZ3RoIDwgMiB8fCBuZXh0Q29vcmRzLmxlbmd0aCA8IDIpe1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICBcbiAgLy8gY3JlbyBsZSBnZW9tZXRyaWVcbiAgdmFyIHByZXZMaW5lID0gbmV3IG9sLmdlb20uTGluZVN0cmluZygpO1xuICBwcmV2TGluZS5zZXRDb29yZGluYXRlcyhwcmV2Q29vcmRzKTtcbiAgdmFyIG5leHRMaW5lID0gbmV3IG9sLmdlb20uTGluZVN0cmluZygpO1xuICBuZXh0TGluZS5zZXRDb29yZGluYXRlcyhuZXh0Q29vcmRzKTtcbiAgXG4gIC8vIGNyZW8gbGUgbnVvdmUgZmVhdHVyZVxuICB2YXIgcHJldkxpbmVGZWF0ID0gbmV3IG9sLkZlYXR1cmUoe1xuICAgIGdlb21ldHJ5OiBwcmV2TGluZVxuICB9KTtcbiAgdmFyIG5leHRMaW5lRmVhdCA9IG5ldyBvbC5GZWF0dXJlKHtcbiAgICBnZW9tZXRyeTogbmV4dExpbmVcbiAgfSk7XG4gIFxuICByZXR1cm4gW3ByZXZMaW5lRmVhdCxuZXh0TGluZUZlYXRdO1xufTtcblxuXG4vLyBUT0RPIHF1ZXN0byBhbmRyw6Agc3Bvc3RhdG8gZGVudHJvIE1hcFNlcnZpY2UgbyBjb211bnF1ZSBpbiB1bmEgbGlicmVyaWEgY29yZVxucHJvdG8uX3Nob3dTZWxlY3Rpb24gPSBmdW5jdGlvbihnZW9tZXRyeSxkdXJhdGlvbil7XG4gIHZhciBzZWxmID0gdGhpcztcbiAgdmFyIGR1cmF0aW9uID0gZHVyYXRpb24gfHwgbnVsbDtcbiAgdmFyIG92ZXJsYXkgPSB0aGlzLl9zZWxlY3RlZExpbmVPdmVybGF5O1xuICBcbiAgdmFyIGZlYXR1cmUgPSBuZXcgb2wuRmVhdHVyZSgpO1xuICBmZWF0dXJlLnNldEdlb21ldHJ5KGdlb21ldHJ5KTtcbiAgb3ZlcmxheS5nZXRTb3VyY2UoKS5hZGRGZWF0dXJlcyhbZmVhdHVyZV0pO1xuICBvdmVybGF5LnNldE1hcCh0aGlzLm1hcCk7XG4gIGlmKGR1cmF0aW9uKXtcbiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XG4gICAgICBvdmVybGF5LnNldE1hcChudWxsKTtcbiAgICAgIHNlbGYuX3NlbGVjdGVkTGluZU92ZXJsYXkuZ2V0U291cmNlKCkuY2xlYXIoKTtcbiAgICB9LGR1cmF0aW9uKTtcbiAgfVxufTtcblxucHJvdG8uX2lzTmV3ID0gZnVuY3Rpb24oZmVhdHVyZSl7XG4gIHJldHVybiAoIV8uaXNOaWwodGhpcy5lZGl0aW5nTGF5ZXIuZ2V0U291cmNlKCkuZ2V0RmVhdHVyZUJ5SWQoZmVhdHVyZS5nZXRJZCgpKSkpO1xufTtcblxuQ3V0TGluZVRvb2wuc3RlcHMgPSBbXG4gIHtcbiAgICB0eXBlOiBcInNlbGVjdGxpbmVcIlxuICB9LFxuICB7XG4gICAgdHlwZTogXCJzZWxlY3RjdXRwb2ludFwiXG4gIH0sXG4gIHtcbiAgICB0eXBlOiBcInNlbGVjdHBhcnR0b2tlZXBcIlxuICB9XG5dXG4iLCJ2YXIgRGVsZXRlSW50ZXJhY3Rpb25FdmVudCA9IGZ1bmN0aW9uKHR5cGUsIGZlYXR1cmVzLCBjb29yZGluYXRlKSB7XG5cbiAgdGhpcy50eXBlID0gdHlwZTtcbiAgdGhpcy5mZWF0dXJlcyA9IGZlYXR1cmVzO1xuICB0aGlzLmNvb3JkaW5hdGUgPSBjb29yZGluYXRlO1xufTtcblxudmFyIERlbGV0ZUludGVyYWN0aW9uID0gZnVuY3Rpb24ob3B0aW9ucykge1xuICBvbC5pbnRlcmFjdGlvbi5Qb2ludGVyLmNhbGwodGhpcywge1xuICAgIGhhbmRsZURvd25FdmVudDogRGVsZXRlSW50ZXJhY3Rpb24uaGFuZGxlRG93bkV2ZW50XyxcbiAgICBoYW5kbGVNb3ZlRXZlbnQ6IERlbGV0ZUludGVyYWN0aW9uLmhhbmRsZU1vdmVFdmVudF8sXG4gICAgaGFuZGxlVXBFdmVudDogRGVsZXRlSW50ZXJhY3Rpb24uaGFuZGxlVXBFdmVudF8sXG4gICAgaGFuZGxlRXZlbnQ6IERlbGV0ZUludGVyYWN0aW9uLmhhbmRsZUV2ZW50XyxcbiAgfSk7XG5cbiAgdGhpcy5wcmV2aW91c0N1cnNvcl8gPSB1bmRlZmluZWQ7XG4gIHRoaXMubGFzdENvb3JkaW5hdGVfID0gbnVsbDtcbiAgdGhpcy5mZWF0dXJlc18gPSBvcHRpb25zLmZlYXR1cmVzICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLmZlYXR1cmVzIDogbnVsbDtcbn07XG5vbC5pbmhlcml0cyhEZWxldGVJbnRlcmFjdGlvbiwgb2wuaW50ZXJhY3Rpb24uUG9pbnRlcik7XG5cbkRlbGV0ZUludGVyYWN0aW9uLmhhbmRsZUV2ZW50XyA9IGZ1bmN0aW9uKG1hcEJyb3dzZXJFdmVudCkge1xuICBpZiAobWFwQnJvd3NlckV2ZW50LnR5cGUgPT0gJ2tleWRvd24nKXtcbiAgICBpZih0aGlzLmZlYXR1cmVzXy5nZXRBcnJheSgpLmxlbmd0aCAmJiBtYXBCcm93c2VyRXZlbnQub3JpZ2luYWxFdmVudC5rZXlDb2RlID09IDQ2KXtcbiAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChcbiAgICAgICAgICBuZXcgRGVsZXRlSW50ZXJhY3Rpb25FdmVudChcbiAgICAgICAgICAgICAgJ2RlbGV0ZWVuZCcsIHRoaXMuZmVhdHVyZXNfLFxuICAgICAgICAgICAgICBldmVudC5jb29yZGluYXRlKSk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gIH1cbiAgZWxzZXtcbiAgICByZXR1cm4gb2wuaW50ZXJhY3Rpb24uUG9pbnRlci5oYW5kbGVFdmVudC5jYWxsKHRoaXMsbWFwQnJvd3NlckV2ZW50KTtcbiAgfVxufTtcblxuRGVsZXRlSW50ZXJhY3Rpb24uaGFuZGxlRG93bkV2ZW50XyA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gIHRoaXMubGFzdEZlYXR1cmVfID0gdGhpcy5mZWF0dXJlc0F0UGl4ZWxfKGV2ZW50LnBpeGVsLCBldmVudC5tYXApO1xuICBpZiAodGhpcy5sYXN0RmVhdHVyZV8pIHtcbiAgICBEZWxldGVJbnRlcmFjdGlvbi5oYW5kbGVNb3ZlRXZlbnRfLmNhbGwodGhpcywgZXZlbnQpO1xuICAgIHRoaXMuZGlzcGF0Y2hFdmVudChcbiAgICAgICAgICAgIG5ldyBEZWxldGVJbnRlcmFjdGlvbkV2ZW50KFxuICAgICAgICAgICAgICAgICdkZWxldGVlbmQnLCB0aGlzLmZlYXR1cmVzXyxcbiAgICAgICAgICAgICAgICBldmVudC5jb29yZGluYXRlKSk7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbiAgcmV0dXJuIGZhbHNlO1xufTtcblxuRGVsZXRlSW50ZXJhY3Rpb24uaGFuZGxlTW92ZUV2ZW50XyA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gIHZhciBlbGVtID0gZXZlbnQubWFwLmdldFRhcmdldEVsZW1lbnQoKTtcbiAgdmFyIGludGVyc2VjdGluZ0ZlYXR1cmUgPSBldmVudC5tYXAuZm9yRWFjaEZlYXR1cmVBdFBpeGVsKGV2ZW50LnBpeGVsLFxuICAgICAgZnVuY3Rpb24oZmVhdHVyZSkge1xuICAgICAgICByZXR1cm4gZmVhdHVyZTtcbiAgICAgIH0pO1xuXG4gIGlmIChpbnRlcnNlY3RpbmdGZWF0dXJlKSB7XG4gICAgdGhpcy5wcmV2aW91c0N1cnNvcl8gPSBlbGVtLnN0eWxlLmN1cnNvcjtcblxuICAgIGVsZW0uc3R5bGUuY3Vyc29yID0gICdwb2ludGVyJztcblxuICB9IGVsc2Uge1xuICAgIGVsZW0uc3R5bGUuY3Vyc29yID0gdGhpcy5wcmV2aW91c0N1cnNvcl8gIT09IHVuZGVmaW5lZCA/XG4gICAgICAgIHRoaXMucHJldmlvdXNDdXJzb3JfIDogJyc7XG4gICAgdGhpcy5wcmV2aW91c0N1cnNvcl8gPSB1bmRlZmluZWQ7XG4gIH1cbn07XG5cbkRlbGV0ZUludGVyYWN0aW9uLnByb3RvdHlwZS5mZWF0dXJlc0F0UGl4ZWxfID0gZnVuY3Rpb24ocGl4ZWwsIG1hcCkge1xuICB2YXIgZm91bmQgPSBudWxsO1xuXG4gIHZhciBpbnRlcnNlY3RpbmdGZWF0dXJlID0gbWFwLmZvckVhY2hGZWF0dXJlQXRQaXhlbChwaXhlbCxcbiAgICAgIGZ1bmN0aW9uKGZlYXR1cmUpIHtcbiAgICAgICAgcmV0dXJuIGZlYXR1cmU7XG4gICAgICB9KTtcblxuICBpZiAodGhpcy5mZWF0dXJlc18gJiZcbiAgICAgXy5pbmNsdWRlcyh0aGlzLmZlYXR1cmVzXy5nZXRBcnJheSgpLCBpbnRlcnNlY3RpbmdGZWF0dXJlKSkge1xuICAgIGZvdW5kID0gaW50ZXJzZWN0aW5nRmVhdHVyZTtcbiAgfVxuXG4gIHJldHVybiBmb3VuZDtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gRGVsZXRlSW50ZXJhY3Rpb247XG4iLCJ2YXIgaW5oZXJpdCA9IHJlcXVpcmUoJ2czdy9jb3JlL3V0aWxzJykuaW5oZXJpdDtcbnZhciBiYXNlID0gcmVxdWlyZSgnZzN3L2NvcmUvdXRpbHMnKS5iYXNlO1xudmFyIEczV09iamVjdCA9IHJlcXVpcmUoJ2czdy9jb3JlL2czd29iamVjdCcpO1xudmFyIE1hcFNlcnZpY2UgPSByZXF1aXJlKCdnM3cvY29yZS9tYXBzZXJ2aWNlJyk7XG5cbnZhciBEZWxldGVJbnRlcmFjdGlvbiA9IHJlcXVpcmUoJy4vZGVsZXRlZmVhdHVyZWludGVyYWN0aW9uJyk7XG5cbmZ1bmN0aW9uIERlbGV0ZUZlYXR1cmVUb29sKGVkaXRvcil7XG4gIHZhciBzZWxmID0gdGhpcztcbiAgdGhpcy5lZGl0b3IgPSBlZGl0b3I7XG4gIHRoaXMuaXNQYXVzYWJsZSA9IHRydWU7XG4gIHRoaXMuZHJhd0ludGVyYWN0aW9uID0gbnVsbDtcbiAgdGhpcy5sYXllciA9IG51bGw7XG4gIHRoaXMuZWRpdGluZ0xheWVyID0gbnVsbDtcblxuICB0aGlzLnNldHRlcnMgPSB7XG4gICAgZGVsZXRlRmVhdHVyZTogRGVsZXRlRmVhdHVyZVRvb2wucHJvdG90eXBlLl9kZWxldGVGZWF0dXJlXG4gIH07XG4gIFxuICBiYXNlKHRoaXMpO1xufVxuaW5oZXJpdChEZWxldGVGZWF0dXJlVG9vbCxHM1dPYmplY3QpO1xubW9kdWxlLmV4cG9ydHMgPSBEZWxldGVGZWF0dXJlVG9vbDtcblxudmFyIHByb3RvID0gRGVsZXRlRmVhdHVyZVRvb2wucHJvdG90eXBlO1xuXG4vKiBCUlVUVElTU0lNTyEgVG9jY2EgcmlkZWZpbmlyZSB0dXR0ZSBsZSBwYXJ0aSBpbnRlcm5lIGRpIE9MMyBub24gZXNwb3N0ZSBkYWxsZSBBUEkgKi9cblxub2wuZ2VvbS5HZW9tZXRyeVR5cGUgPSB7XG4gIFBPSU5UOiAnUG9pbnQnLFxuICBMSU5FX1NUUklORzogJ0xpbmVTdHJpbmcnLFxuICBMSU5FQVJfUklORzogJ0xpbmVhclJpbmcnLFxuICBQT0xZR09OOiAnUG9seWdvbicsXG4gIE1VTFRJX1BPSU5UOiAnTXVsdGlQb2ludCcsXG4gIE1VTFRJX0xJTkVfU1RSSU5HOiAnTXVsdGlMaW5lU3RyaW5nJyxcbiAgTVVMVElfUE9MWUdPTjogJ011bHRpUG9seWdvbicsXG4gIEdFT01FVFJZX0NPTExFQ1RJT046ICdHZW9tZXRyeUNvbGxlY3Rpb24nLFxuICBDSVJDTEU6ICdDaXJjbGUnXG59O1xuXG52YXIgc3R5bGVzID0ge307XG52YXIgd2hpdGUgPSBbMjU1LCAyNTUsIDI1NSwgMV07XG52YXIgYmx1ZSA9IFswLCAxNTMsIDI1NSwgMV07XG52YXIgcmVkID0gWzI1NSwgMCwgMCwgMV07XG52YXIgd2lkdGggPSAzO1xuc3R5bGVzW29sLmdlb20uR2VvbWV0cnlUeXBlLlBPTFlHT05dID0gW1xuICBuZXcgb2wuc3R5bGUuU3R5bGUoe1xuICAgIGZpbGw6IG5ldyBvbC5zdHlsZS5GaWxsKHtcbiAgICAgIGNvbG9yOiBbMjU1LCAyNTUsIDI1NSwgMC41XVxuICAgIH0pXG4gIH0pXG5dO1xuc3R5bGVzW29sLmdlb20uR2VvbWV0cnlUeXBlLk1VTFRJX1BPTFlHT05dID1cbiAgICBzdHlsZXNbb2wuZ2VvbS5HZW9tZXRyeVR5cGUuUE9MWUdPTl07XG5cbnN0eWxlc1tvbC5nZW9tLkdlb21ldHJ5VHlwZS5MSU5FX1NUUklOR10gPSBbXG4gIG5ldyBvbC5zdHlsZS5TdHlsZSh7XG4gICAgc3Ryb2tlOiBuZXcgb2wuc3R5bGUuU3Ryb2tlKHtcbiAgICAgIGNvbG9yOiB3aGl0ZSxcbiAgICAgIHdpZHRoOiB3aWR0aCArIDJcbiAgICB9KVxuICB9KSxcbiAgbmV3IG9sLnN0eWxlLlN0eWxlKHtcbiAgICBzdHJva2U6IG5ldyBvbC5zdHlsZS5TdHJva2Uoe1xuICAgICAgY29sb3I6IHJlZCxcbiAgICAgIHdpZHRoOiB3aWR0aFxuICAgIH0pXG4gIH0pXG5dO1xuc3R5bGVzW29sLmdlb20uR2VvbWV0cnlUeXBlLk1VTFRJX0xJTkVfU1RSSU5HXSA9XG4gICAgc3R5bGVzW29sLmdlb20uR2VvbWV0cnlUeXBlLkxJTkVfU1RSSU5HXTtcblxuc3R5bGVzW29sLmdlb20uR2VvbWV0cnlUeXBlLkNJUkNMRV0gPVxuICAgIHN0eWxlc1tvbC5nZW9tLkdlb21ldHJ5VHlwZS5QT0xZR09OXS5jb25jYXQoXG4gICAgICAgIHN0eWxlc1tvbC5nZW9tLkdlb21ldHJ5VHlwZS5MSU5FX1NUUklOR11cbiAgICApO1xuXG5cbnN0eWxlc1tvbC5nZW9tLkdlb21ldHJ5VHlwZS5QT0lOVF0gPSBbXG4gIG5ldyBvbC5zdHlsZS5TdHlsZSh7XG4gICAgaW1hZ2U6IG5ldyBvbC5zdHlsZS5DaXJjbGUoe1xuICAgICAgcmFkaXVzOiB3aWR0aCAqIDIsXG4gICAgICBmaWxsOiBuZXcgb2wuc3R5bGUuRmlsbCh7XG4gICAgICAgIGNvbG9yOiByZWRcbiAgICAgIH0pLFxuICAgICAgc3Ryb2tlOiBuZXcgb2wuc3R5bGUuU3Ryb2tlKHtcbiAgICAgICAgY29sb3I6IHdoaXRlLFxuICAgICAgICB3aWR0aDogd2lkdGggLyAyXG4gICAgICB9KVxuICAgIH0pLFxuICAgIHpJbmRleDogSW5maW5pdHlcbiAgfSlcbl07XG5zdHlsZXNbb2wuZ2VvbS5HZW9tZXRyeVR5cGUuTVVMVElfUE9JTlRdID1cbiAgICBzdHlsZXNbb2wuZ2VvbS5HZW9tZXRyeVR5cGUuUE9JTlRdO1xuXG5zdHlsZXNbb2wuZ2VvbS5HZW9tZXRyeVR5cGUuR0VPTUVUUllfQ09MTEVDVElPTl0gPVxuICAgIHN0eWxlc1tvbC5nZW9tLkdlb21ldHJ5VHlwZS5QT0xZR09OXS5jb25jYXQoXG4gICAgICAgIHN0eWxlc1tvbC5nZW9tLkdlb21ldHJ5VHlwZS5MSU5FX1NUUklOR10sXG4gICAgICAgIHN0eWxlc1tvbC5nZW9tLkdlb21ldHJ5VHlwZS5QT0lOVF1cbiAgICApO1xuXG5cbnN0eWxlc1tvbC5nZW9tLkdlb21ldHJ5VHlwZS5QT0xZR09OXSA9IF8uY29uY2F0KHN0eWxlc1tvbC5nZW9tLkdlb21ldHJ5VHlwZS5QT0xZR09OXSxzdHlsZXNbb2wuZ2VvbS5HZW9tZXRyeVR5cGUuTElORV9TVFJJTkddKTtcbnN0eWxlc1tvbC5nZW9tLkdlb21ldHJ5VHlwZS5HRU9NRVRSWV9DT0xMRUNUSU9OXSA9IF8uY29uY2F0KHN0eWxlc1tvbC5nZW9tLkdlb21ldHJ5VHlwZS5HRU9NRVRSWV9DT0xMRUNUSU9OXSxzdHlsZXNbb2wuZ2VvbS5HZW9tZXRyeVR5cGUuTElORV9TVFJJTkddKTtcbiAgICBcbi8qIEZJTkUgQlJVVFRJU1NJTU8hICovXG5cbnByb3RvLnJ1biA9IGZ1bmN0aW9uKCl7XG4gIHZhciBzZWxmID0gdGhpcztcbiAgdmFyIG1hcCA9IE1hcFNlcnZpY2Uudmlld2VyLm1hcDtcbiAgdGhpcy5sYXllciA9IHRoaXMuZWRpdG9yLmdldFZlY3RvckxheWVyKCkuZ2V0TGF5ZXIoKTtcbiAgdGhpcy5lZGl0aW5nTGF5ZXIgPSB0aGlzLmVkaXRvci5nZXRFZGl0VmVjdG9yTGF5ZXIoKS5nZXRMYXllcigpO1xuICBcbiAgdGhpcy5fc2VsZWN0SW50ZXJhY3Rpb24gPSBuZXcgb2wuaW50ZXJhY3Rpb24uU2VsZWN0KHtcbiAgICBsYXllcnM6IFt0aGlzLmxheWVyLHRoaXMuZWRpdGluZ0xheWVyXSxcbiAgICBjb25kaXRpb246IG9sLmV2ZW50cy5jb25kaXRpb24uY2xpY2ssXG4gICAgc3R5bGU6IGZ1bmN0aW9uKGZlYXR1cmUsIHJlc29sdXRpb24pIHtcbiAgICAgIHJldHVybiBzdHlsZXNbZmVhdHVyZS5nZXRHZW9tZXRyeSgpLmdldFR5cGUoKV07XG4gICAgfVxuICB9KTtcbiAgbWFwLmFkZEludGVyYWN0aW9uKHRoaXMuX3NlbGVjdEludGVyYWN0aW9uKTtcbiAgXG4gIHRoaXMuX2RlbGV0ZUludGVyYWN0aW9uID0gbmV3IERlbGV0ZUludGVyYWN0aW9uKHtcbiAgICBmZWF0dXJlczogdGhpcy5fc2VsZWN0SW50ZXJhY3Rpb24uZ2V0RmVhdHVyZXMoKVxuICB9KTtcbiAgbWFwLmFkZEludGVyYWN0aW9uKHRoaXMuX2RlbGV0ZUludGVyYWN0aW9uKTtcbiAgXG4gIHZhciBvcmlnR2VvbWV0cnkgPSBudWxsO1xuICBcbiAgLyp0aGlzLl9zZWxlY3RJbnRlcmFjdGlvbi5vbignc2VsZWN0JyxmdW5jdGlvbihlKXtcbiAgICB2YXIgZmVhdHVyZSA9IGUuc2VsZWN0ZWRbMF07XG4gICAgb3JpZ0dlb21ldHJ5ID0gZmVhdHVyZS5nZXRHZW9tZXRyeSgpO1xuICB9KTsqL1xuICBcbiAgdGhpcy5fZGVsZXRlSW50ZXJhY3Rpb24ub24oJ2RlbGV0ZWVuZCcsZnVuY3Rpb24oZSl7XG4gICAgdmFyIGZlYXR1cmUgPSBlLmZlYXR1cmVzLmdldEFycmF5KClbMF07XG4gICAgdmFyIGlzTmV3ID0gc2VsZi5faXNOZXcoZmVhdHVyZSk7XG4gICAgLy90cnkge1xuICAgICAgaWYgKCFzZWxmLl9idXN5KXtcbiAgICAgICAgc2VsZi5fYnVzeSA9IHRydWU7XG4gICAgICAgIHNlbGYucGF1c2UodHJ1ZSk7XG4gICAgICAgIHNlbGYuZGVsZXRlRmVhdHVyZShmZWF0dXJlLGlzTmV3KVxuICAgICAgICAuYWx3YXlzKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgc2VsZi5fYnVzeSA9IGZhbHNlO1xuICAgICAgICAgIHNlbGYucGF1c2UoZmFsc2UpO1xuICAgICAgICB9KVxuICAgICAgfVxuICAgIC8vfVxuICAgIC8qY2F0Y2ggKGVycm9yKXtcbiAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcbiAgICAgIGZlYXR1cmUuc2V0R2VvbWV0cnkob3JpZ0dlb21ldHJ5KTtcbiAgICB9Ki9cbiAgfSk7XG5cbn07XG5cbnByb3RvLnBhdXNlID0gZnVuY3Rpb24ocGF1c2Upe1xuICBpZiAoXy5pc1VuZGVmaW5lZChwYXVzZSkgfHwgcGF1c2Upe1xuICAgIHRoaXMuX3NlbGVjdEludGVyYWN0aW9uLnNldEFjdGl2ZShmYWxzZSk7XG4gICAgdGhpcy5fZGVsZXRlSW50ZXJhY3Rpb24uc2V0QWN0aXZlKGZhbHNlKTtcbiAgfVxuICBlbHNlIHtcbiAgICB0aGlzLl9zZWxlY3RJbnRlcmFjdGlvbi5zZXRBY3RpdmUodHJ1ZSk7XG4gICAgdGhpcy5fZGVsZXRlSW50ZXJhY3Rpb24uc2V0QWN0aXZlKHRydWUpO1xuICB9XG59O1xuXG5wcm90by5zdG9wID0gZnVuY3Rpb24oKXtcbiAgdmFyIG1hcCA9IE1hcFNlcnZpY2Uudmlld2VyLm1hcDtcbiAgdGhpcy5fc2VsZWN0SW50ZXJhY3Rpb24uZ2V0RmVhdHVyZXMoKS5jbGVhcigpO1xuICBtYXAucmVtb3ZlSW50ZXJhY3Rpb24odGhpcy5fc2VsZWN0SW50ZXJhY3Rpb24pO1xuICB0aGlzLl9zZWxlY3RJbnRlcmFjdGlvbiA9IG51bGw7XG4gIG1hcC5yZW1vdmVJbnRlcmFjdGlvbih0aGlzLl9kZWxldGVJbnRlcmFjdGlvbik7XG4gIHRoaXMuX2RlbGV0ZUludGVyYWN0aW9uID0gbnVsbDtcbiAgcmV0dXJuIHRydWU7XG59O1xuXG5wcm90by5fZGVsZXRlRmVhdHVyZSA9IGZ1bmN0aW9uKGZlYXR1cmUsaXNOZXcpe1xuICB0aGlzLmVkaXRvci5kZWxldGVGZWF0dXJlKGZlYXR1cmUsaXNOZXcpO1xuICB0aGlzLl9zZWxlY3RJbnRlcmFjdGlvbi5nZXRGZWF0dXJlcygpLmNsZWFyKCk7XG4gIHRoaXMuX2J1c3kgPSBmYWxzZTtcbiAgdGhpcy5wYXVzZShmYWxzZSk7XG4gIHJldHVybiB0cnVlO1xufTtcblxucHJvdG8uX2ZhbGxCYWNrID0gZnVuY3Rpb24oZmVhdHVyZSl7XG4gIHRoaXMuX2J1c3kgPSBmYWxzZTtcbiAgdGhpcy5wYXVzZShmYWxzZSk7XG59O1xuXG5wcm90by5faXNOZXcgPSBmdW5jdGlvbihmZWF0dXJlKXtcbiAgcmV0dXJuICghXy5pc05pbCh0aGlzLmVkaXRpbmdMYXllci5nZXRTb3VyY2UoKS5nZXRGZWF0dXJlQnlJZChmZWF0dXJlLmdldElkKCkpKSk7XG59O1xuIiwidmFyIGluaGVyaXQgPSByZXF1aXJlKCdnM3cvY29yZS91dGlscycpLmluaGVyaXQ7XG52YXIgYmFzZSA9IHJlcXVpcmUoJ2czdy9jb3JlL3V0aWxzJykuYmFzZTtcbnZhciBHM1dPYmplY3QgPSByZXF1aXJlKCdnM3cvY29yZS9nM3dvYmplY3QnKTtcbnZhciBNYXBTZXJ2aWNlID0gcmVxdWlyZSgnZzN3L2NvcmUvbWFwc2VydmljZScpO1xuXG5mdW5jdGlvbiBNb2RpZnlGZWF0dXJlVG9vbChlZGl0b3Isb3B0aW9ucyl7XG4gIHZhciBzZWxmID0gdGhpcztcbiAgdGhpcy5lZGl0b3IgPSBlZGl0b3I7XG4gIHRoaXMuaXNQYXVzYWJsZSA9IHRydWU7XG4gIHRoaXMuZHJhd0ludGVyYWN0aW9uID0gbnVsbDtcbiAgdGhpcy5sYXllciA9IG51bGw7XG4gIHRoaXMuZWRpdGluZ0xheWVyID0gbnVsbDtcbiAgdGhpcy5fZGVsZXRlQ29uZGl0aW9uID0gb3B0aW9ucy5kZWxldGVDb25kaXRpb24gfHwgdW5kZWZpbmVkO1xuICB0aGlzLl9zbmFwID0gb3B0aW9ucy5zbmFwIHx8IG51bGw7XG4gIHRoaXMuX3NuYXBJbnRlcmFjdGlvbiA9IG51bGw7IFxuXG4gIHRoaXMuc2V0dGVycyA9IHtcbiAgICBtb2RpZnlGZWF0dXJlOiBNb2RpZnlGZWF0dXJlVG9vbC5wcm90b3R5cGUuX21vZGlmeUZlYXR1cmVcbiAgfTtcbiAgXG4gIGJhc2UodGhpcyk7XG59XG5pbmhlcml0KE1vZGlmeUZlYXR1cmVUb29sLEczV09iamVjdCk7XG5tb2R1bGUuZXhwb3J0cyA9IE1vZGlmeUZlYXR1cmVUb29sO1xuXG52YXIgcHJvdG8gPSBNb2RpZnlGZWF0dXJlVG9vbC5wcm90b3R5cGU7XG5cbnByb3RvLnJ1biA9IGZ1bmN0aW9uKCl7XG4gIHZhciBzZWxmID0gdGhpcztcbiAgdmFyIG1hcCA9IE1hcFNlcnZpY2Uudmlld2VyLm1hcDtcbiAgdGhpcy5sYXllciA9IHRoaXMuZWRpdG9yLmdldFZlY3RvckxheWVyKCkuZ2V0TGF5ZXIoKTtcbiAgdGhpcy5lZGl0aW5nTGF5ZXIgPSB0aGlzLmVkaXRvci5nZXRFZGl0VmVjdG9yTGF5ZXIoKS5nZXRMYXllcigpO1xuICBcbiAgdGhpcy5fc2VsZWN0SW50ZXJhY3Rpb24gPSBuZXcgb2wuaW50ZXJhY3Rpb24uU2VsZWN0KHtcbiAgICBsYXllcnM6IFt0aGlzLmxheWVyLHRoaXMuZWRpdGluZ0xheWVyXSxcbiAgfSk7XG4gIG1hcC5hZGRJbnRlcmFjdGlvbih0aGlzLl9zZWxlY3RJbnRlcmFjdGlvbik7XG4gIFxuICB0aGlzLl9tb2RpZnlJbnRlcmFjdGlvbiA9IG5ldyBvbC5pbnRlcmFjdGlvbi5Nb2RpZnkoe1xuICAgIGZlYXR1cmVzOiB0aGlzLl9zZWxlY3RJbnRlcmFjdGlvbi5nZXRGZWF0dXJlcygpLFxuICAgIGRlbGV0ZUNvbmRpdGlvbjogdGhpcy5fZGVsZXRlQ29uZGl0aW9uLFxuICB9KTtcbiAgbWFwLmFkZEludGVyYWN0aW9uKHRoaXMuX21vZGlmeUludGVyYWN0aW9uKTtcbiAgXG4gIHZhciBvcmlnR2VvbWV0cnkgPSBudWxsO1xuICBcbiAgdGhpcy5fbW9kaWZ5SW50ZXJhY3Rpb24ub24oJ21vZGlmeXN0YXJ0JyxmdW5jdGlvbihlKXtcbiAgICB2YXIgZmVhdHVyZSA9IGUuZmVhdHVyZXMuZ2V0QXJyYXkoKVswXTtcbiAgICBvcmlnR2VvbWV0cnkgPSBmZWF0dXJlLmdldEdlb21ldHJ5KCkuY2xvbmUoKTtcbiAgfSk7XG4gIFxuICB0aGlzLl9tb2RpZnlJbnRlcmFjdGlvbi5vbignbW9kaWZ5ZW5kJyxmdW5jdGlvbihlKXtcbiAgICB2YXIgZmVhdHVyZSA9IGUuZmVhdHVyZXMuZ2V0QXJyYXkoKVswXTtcbiAgICB2YXIgaXNOZXcgPSBzZWxmLl9pc05ldyhmZWF0dXJlKTtcbiAgICAvL3RyeSB7XG4gICAgICBpZiAoIXNlbGYuX2J1c3kpe1xuICAgICAgICBzZWxmLl9idXN5ID0gdHJ1ZTtcbiAgICAgICAgc2VsZi5wYXVzZSh0cnVlKTtcbiAgICAgICAgc2VsZi5tb2RpZnlGZWF0dXJlKGZlYXR1cmUsaXNOZXcpXG4gICAgICAgIC5mYWlsKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgZmVhdHVyZS5zZXRHZW9tZXRyeShvcmlnR2VvbWV0cnkpO1xuICAgICAgICB9KVxuICAgICAgICAuYWx3YXlzKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgc2VsZi5fYnVzeSA9IGZhbHNlO1xuICAgICAgICAgIHNlbGYucGF1c2UoZmFsc2UpO1xuICAgICAgICB9KVxuICAgICAgfVxuICAgIC8vfVxuICAgIC8vY2F0Y2ggKGVycm9yKXtcbiAgICAvLyAgY29uc29sZS5sb2coZXJyb3IpO1xuICAgIC8vICBmZWF0dXJlLnNldEdlb21ldHJ5KG9yaWdHZW9tZXRyeSk7XG4gICAgLy99XG4gIH0pO1xuICBcbiAgaWYgKHRoaXMuX3NuYXApe1xuICAgIHRoaXMuX3NuYXBJbnRlcmFjdGlvbiA9IG5ldyBvbC5pbnRlcmFjdGlvbi5TbmFwKHtcbiAgICAgIHNvdXJjZTogdGhpcy5fc25hcC52ZWN0b3JMYXllci5nZXRTb3VyY2UoKVxuICAgIH0pO1xuICAgIG1hcC5hZGRJbnRlcmFjdGlvbih0aGlzLl9zbmFwSW50ZXJhY3Rpb24pO1xuICB9XG59O1xuXG5wcm90by5wYXVzZSA9IGZ1bmN0aW9uKHBhdXNlKXtcbiAgaWYgKF8uaXNVbmRlZmluZWQocGF1c2UpIHx8IHBhdXNlKXtcbiAgICBpZiAodGhpcy5fc25hcEludGVyYWN0aW9uKXtcbiAgICAgIHRoaXMuX3NuYXBJbnRlcmFjdGlvbi5zZXRBY3RpdmUoZmFsc2UpO1xuICAgIH1cbiAgICB0aGlzLl9zZWxlY3RJbnRlcmFjdGlvbi5zZXRBY3RpdmUoZmFsc2UpO1xuICAgIHRoaXMuX21vZGlmeUludGVyYWN0aW9uLnNldEFjdGl2ZShmYWxzZSk7XG4gIH1cbiAgZWxzZSB7XG4gICAgaWYgKHRoaXMuX3NuYXBJbnRlcmFjdGlvbil7XG4gICAgICB0aGlzLl9zbmFwSW50ZXJhY3Rpb24uc2V0QWN0aXZlKHRydWUpO1xuICAgIH1cbiAgICB0aGlzLl9zZWxlY3RJbnRlcmFjdGlvbi5zZXRBY3RpdmUodHJ1ZSk7XG4gICAgdGhpcy5fbW9kaWZ5SW50ZXJhY3Rpb24uc2V0QWN0aXZlKHRydWUpO1xuICB9XG59O1xuXG5wcm90by5zdG9wID0gZnVuY3Rpb24oKXtcbiAgdmFyIG1hcCA9IE1hcFNlcnZpY2Uudmlld2VyLm1hcDtcbiAgdGhpcy5fc2VsZWN0SW50ZXJhY3Rpb24uZ2V0RmVhdHVyZXMoKS5jbGVhcigpO1xuICBpZiAodGhpcy5fc25hcEludGVyYWN0aW9uKXtcbiAgICAgbWFwLnJlbW92ZUludGVyYWN0aW9uKHRoaXMuX3NuYXBJbnRlcmFjdGlvbik7XG4gICAgIHRoaXMuX3NuYXBJbnRlcmFjdGlvbiA9IG51bGw7XG4gIH1cbiAgbWFwLnJlbW92ZUludGVyYWN0aW9uKHRoaXMuX3NlbGVjdEludGVyYWN0aW9uKTtcbiAgdGhpcy5fc2VsZWN0SW50ZXJhY3Rpb24gPSBudWxsO1xuICBtYXAucmVtb3ZlSW50ZXJhY3Rpb24odGhpcy5fbW9kaWZ5SW50ZXJhY3Rpb24pO1xuICB0aGlzLl9tb2RpZnlJbnRlcmFjdGlvbiA9IG51bGw7XG4gIHJldHVybiB0cnVlO1xufTtcblxucHJvdG8uX21vZGlmeUZlYXR1cmUgPSBmdW5jdGlvbihmZWF0dXJlLGlzTmV3KXtcbiAgLy8gYWdnaW9ucm8gbGEgZ2VvbWV0cmlhIG5lbCBidWZmZXIgZGkgZWRpdGluZ1xuICB0aGlzLmVkaXRvci51cGRhdGVGZWF0dXJlKGZlYXR1cmUsaXNOZXcpO1xuICB0aGlzLl9zZWxlY3RJbnRlcmFjdGlvbi5nZXRGZWF0dXJlcygpLmNsZWFyKCk7XG4gIHRoaXMuX2J1c3kgPSBmYWxzZTtcbiAgdGhpcy5wYXVzZShmYWxzZSk7XG4gIHJldHVybiB0cnVlO1xufTtcblxucHJvdG8ucmVtb3ZlUG9pbnQgPSBmdW5jdGlvbihjb29yZGluYXRlKXtcbiAgaWYgKHRoaXMuX21vZGlmeUludGVyYWN0aW9uKXtcbiAgICAvLyBwcm92byBhIHJpbXVvdmVyZSBsJ3VsdGltbyBwdW50by4gTmVsIGNhc28gbm9uIGVzaXN0YSBsYSBnZW9tZXRyaWEgZ2VzdGlzY28gc2lsZW56aW9zYW1lbnRlIGwnZXJyb3JlXG4gICAgdHJ5e1xuICAgICAgdGhpcy5fbW9kaWZ5SW50ZXJhY3Rpb24ucmVtb3ZlUG9pbnQoKTtcbiAgICB9XG4gICAgY2F0Y2ggKGUpe1xuICAgICAgY29uc29sZS5sb2coZSk7XG4gICAgfVxuICB9XG59O1xuXG5wcm90by5fZmFsbEJhY2sgPSBmdW5jdGlvbihmZWF0dXJlKXtcbiAgdGhpcy5fYnVzeSA9IGZhbHNlO1xuICB0aGlzLnBhdXNlKGZhbHNlKTtcbn07XG5cbnByb3RvLl9pc05ldyA9IGZ1bmN0aW9uKGZlYXR1cmUpe1xuICByZXR1cm4gKCFfLmlzTmlsKHRoaXMuZWRpdGluZ0xheWVyLmdldFNvdXJjZSgpLmdldEZlYXR1cmVCeUlkKGZlYXR1cmUuZ2V0SWQoKSkpKTtcbn07XG4iLCJ2YXIgaW5oZXJpdCA9IHJlcXVpcmUoJ2czdy9jb3JlL3V0aWxzJykuaW5oZXJpdDtcbnZhciBiYXNlID0gcmVxdWlyZSgnZzN3L2NvcmUvdXRpbHMnKS5iYXNlO1xudmFyIEczV09iamVjdCA9IHJlcXVpcmUoJ2czdy9jb3JlL2czd29iamVjdCcpO1xuXG52YXIgTWFwU2VydmljZSA9IHJlcXVpcmUoJ2czdy9jb3JlL21hcHNlcnZpY2UnKTtcblxuZnVuY3Rpb24gTW92ZUZlYXR1cmVUb29sKGVkaXRvcil7XG4gIHZhciBzZWxmID0gdGhpcztcbiAgdGhpcy5lZGl0b3IgPSBlZGl0b3I7XG4gIHRoaXMuaXNQYXVzYWJsZSA9IHRydWU7XG4gIHRoaXMuZHJhd0ludGVyYWN0aW9uID0gbnVsbDtcbiAgdGhpcy5sYXllciA9IG51bGw7XG4gIHRoaXMuZWRpdGluZ0xheWVyID0gbnVsbDtcbiAgXG4gIHRoaXMuX29yaWdHZW9tZXRyeSA9IG51bGw7XG5cbiAgdGhpcy5zZXR0ZXJzID0ge1xuICAgIG1vdmVGZWF0dXJlOiB7XG4gICAgICBmbmM6IE1vdmVGZWF0dXJlVG9vbC5wcm90b3R5cGUuX21vdmVGZWF0dXJlLFxuICAgICAgZmFsbGJhY2s6IE1vdmVGZWF0dXJlVG9vbC5wcm90b3R5cGUuX2ZhbGxCYWNrXG4gICAgfVxuICB9O1xuICBcbiAgYmFzZSh0aGlzKTtcbn1cbmluaGVyaXQoTW92ZUZlYXR1cmVUb29sLEczV09iamVjdCk7XG5tb2R1bGUuZXhwb3J0cyA9IE1vdmVGZWF0dXJlVG9vbDtcblxudmFyIHByb3RvID0gTW92ZUZlYXR1cmVUb29sLnByb3RvdHlwZTtcblxucHJvdG8ucnVuID0gZnVuY3Rpb24oKXtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICB2YXIgbWFwID0gTWFwU2VydmljZS52aWV3ZXIubWFwO1xuICB0aGlzLmxheWVyID0gdGhpcy5lZGl0b3IuZ2V0VmVjdG9yTGF5ZXIoKS5nZXRMYXllcigpO1xuICB0aGlzLmVkaXRpbmdMYXllciA9IHRoaXMuZWRpdG9yLmdldEVkaXRWZWN0b3JMYXllcigpLmdldExheWVyKCk7XG4gIFxuICB0aGlzLl9zZWxlY3RJbnRlcmFjdGlvbiA9IG5ldyBvbC5pbnRlcmFjdGlvbi5TZWxlY3Qoe1xuICAgIGxheWVyczogW3RoaXMubGF5ZXIsdGhpcy5lZGl0aW5nTGF5ZXJdLFxuICAgIGNvbmRpdGlvbjogb2wuZXZlbnRzLmNvbmRpdGlvbi5jbGlja1xuICB9KTtcbiAgbWFwLmFkZEludGVyYWN0aW9uKHRoaXMuX3NlbGVjdEludGVyYWN0aW9uKTtcbiAgXG4gIHRoaXMuX3RyYW5zbGF0ZUludGVyYWN0aW9uID0gbmV3IG9sLmludGVyYWN0aW9uLlRyYW5zbGF0ZSh7XG4gICAgZmVhdHVyZXM6IHRoaXMuX3NlbGVjdEludGVyYWN0aW9uLmdldEZlYXR1cmVzKClcbiAgfSk7XG4gIG1hcC5hZGRJbnRlcmFjdGlvbih0aGlzLl90cmFuc2xhdGVJbnRlcmFjdGlvbik7XG4gIFxuICB0aGlzLl90cmFuc2xhdGVJbnRlcmFjdGlvbi5vbigndHJhbnNsYXRlc3RhcnQnLGZ1bmN0aW9uKGUpe1xuICAgIHZhciBmZWF0dXJlID0gZS5mZWF0dXJlcy5nZXRBcnJheSgpWzBdO1xuICAgIHNlbGYuX29yaWdHZW9tZXRyeSA9IGZlYXR1cmUuZ2V0R2VvbWV0cnkoKS5jbG9uZSgpO1xuICAgIHNlbGYuZWRpdG9yLmVtaXQoJ21vdmVzdGFydCcsZmVhdHVyZSk7XG4gIH0pO1xuICBcbiAgdGhpcy5fdHJhbnNsYXRlSW50ZXJhY3Rpb24ub24oJ3RyYW5zbGF0ZWVuZCcsZnVuY3Rpb24oZSl7XG4gICAgdmFyIGZlYXR1cmUgPSBlLmZlYXR1cmVzLmdldEFycmF5KClbMF07XG4gICAgLy90cnkge1xuICAgICAgaWYgKCFzZWxmLl9idXN5KXtcbiAgICAgICAgc2VsZi5fYnVzeSA9IHRydWU7XG4gICAgICAgIHNlbGYucGF1c2UoKTtcbiAgICAgICAgc2VsZi5tb3ZlRmVhdHVyZShmZWF0dXJlKVxuICAgICAgICAudGhlbihmdW5jdGlvbihyZXMpe1xuICAgICAgICAgIHNlbGYucGF1c2UoZmFsc2UpO1xuICAgICAgICB9KVxuICAgICAgICAuZmFpbChmdW5jdGlvbigpe1xuICAgICAgICAgIGZlYXR1cmUuc2V0R2VvbWV0cnkoc2VsZi5fb3JpZ0dlb21ldHJ5KTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgLy99XG4gICAgLypjYXRjaCAoZXJyb3Ipe1xuICAgICAgY29uc29sZS5sb2coZXJyb3IpO1xuICAgICAgZmVhdHVyZS5zZXRHZW9tZXRyeShzZWxmLl9vcmlnR2VvbWV0cnkpO1xuICAgIH0qL1xuICB9KTtcblxufTtcblxucHJvdG8ucGF1c2UgPSBmdW5jdGlvbihwYXVzZSl7XG4gIGlmIChfLmlzVW5kZWZpbmVkKHBhdXNlKSB8fCBwYXVzZSl7XG4gICAgdGhpcy5fc2VsZWN0SW50ZXJhY3Rpb24uc2V0QWN0aXZlKGZhbHNlKTtcbiAgICB0aGlzLl90cmFuc2xhdGVJbnRlcmFjdGlvbi5zZXRBY3RpdmUoZmFsc2UpO1xuICB9XG4gIGVsc2Uge1xuICAgIHRoaXMuX3NlbGVjdEludGVyYWN0aW9uLnNldEFjdGl2ZSh0cnVlKTtcbiAgICB0aGlzLl90cmFuc2xhdGVJbnRlcmFjdGlvbi5zZXRBY3RpdmUodHJ1ZSk7XG4gIH1cbn07XG5cbnByb3RvLnN0b3AgPSBmdW5jdGlvbigpe1xuICB2YXIgbWFwID0gTWFwU2VydmljZS52aWV3ZXIubWFwO1xuICB0aGlzLl9zZWxlY3RJbnRlcmFjdGlvbi5nZXRGZWF0dXJlcygpLmNsZWFyKCk7XG4gIG1hcC5yZW1vdmVJbnRlcmFjdGlvbih0aGlzLl9zZWxlY3RJbnRlcmFjdGlvbik7XG4gIHRoaXMuX3NlbGVjdEludGVyYWN0aW9uID0gbnVsbDtcbiAgbWFwLnJlbW92ZUludGVyYWN0aW9uKHRoaXMuX3RyYW5zbGF0ZUludGVyYWN0aW9uKTtcbiAgdGhpcy5fdHJhbnNsYXRlSW50ZXJhY3Rpb24gPSBudWxsO1xuICByZXR1cm4gdHJ1ZTtcbn07XG5cbnByb3RvLl9tb3ZlRmVhdHVyZSA9IGZ1bmN0aW9uKGZlYXR1cmUpe1xuICB0aGlzLmVkaXRvci5lbWl0KCdtb3ZlZW5kJyxmZWF0dXJlKTtcbiAgdGhpcy5lZGl0b3IudXBkYXRlRmVhdHVyZShmZWF0dXJlKTtcbiAgdGhpcy5fc2VsZWN0SW50ZXJhY3Rpb24uZ2V0RmVhdHVyZXMoKS5jbGVhcigpO1xuICB0aGlzLl9idXN5ID0gZmFsc2U7XG4gIHRoaXMucGF1c2UoZmFsc2UpO1xuICByZXR1cm4gdHJ1ZTtcbn07XG5cbnByb3RvLl9mYWxsQmFjayA9IGZ1bmN0aW9uKGZlYXR1cmUpe1xuICB0aGlzLl9idXN5ID0gZmFsc2U7XG4gIHRoaXMucGF1c2UoZmFsc2UpO1xufTtcbiIsInZhciBpbmhlcml0ID0gcmVxdWlyZSgnZzN3L2NvcmUvdXRpbHMnKS5pbmhlcml0O1xudmFyIGJhc2UgPSByZXF1aXJlKCdnM3cvY29yZS91dGlscycpLmJhc2U7XG52YXIgbm9vcCA9IHJlcXVpcmUoJ2czdy9jb3JlL3V0aWxzJykubm9vcDtcbnZhciBHM1dPYmplY3QgPSByZXF1aXJlKCdnM3cvY29yZS9nM3dvYmplY3QnKTtcbnZhciBQaWNrRmVhdHVyZUludGVyYWN0aW9uID0gcmVxdWlyZSgnZzN3LW9sMy9zcmMvaW50ZXJhY3Rpb25zL3BpY2tmZWF0dXJlaW50ZXJhY3Rpb24nKTtcblxudmFyIE1hcFNlcnZpY2UgPSByZXF1aXJlKCdnM3cvY29yZS9tYXBzZXJ2aWNlJyk7XG5cbmZ1bmN0aW9uIFBpY2tGZWF0dXJlVG9vbChlZGl0b3Ipe1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIHRoaXMuZWRpdG9yID0gZWRpdG9yO1xuICB0aGlzLmlzUGF1c2FibGUgPSB0cnVlO1xuICB0aGlzLnBpY2tGZWF0dXJlSW50ZXJhY3Rpb24gPSBudWxsO1xuICB0aGlzLl9ydW5uaW5nID0gZmFsc2U7XG4gIHRoaXMuX2J1c3kgPSBmYWxzZTtcbiAgXG4gIC8vIHF1aSBzaSBkZWZpbmlzY29ubyBpIG1ldG9kaSBjaGUgdm9nbGlhbW8gcG90ZXIgaW50ZXJjZXR0YXJlLCBlZCBldmVudHVhbG1lbnRlIGJsb2NjYXJlICh2ZWRpIEFQSSBHM1dPYmplY3QpXG4gIHRoaXMuc2V0dGVycyA9IHtcbiAgICBwaWNrRmVhdHVyZTogbm9vcCxcbiAgfTtcbiAgXG4gIGJhc2UodGhpcyk7XG59XG5pbmhlcml0KFBpY2tGZWF0dXJlVG9vbCxHM1dPYmplY3QpO1xubW9kdWxlLmV4cG9ydHMgPSBQaWNrRmVhdHVyZVRvb2w7XG5cbnZhciBwcm90byA9IFBpY2tGZWF0dXJlVG9vbC5wcm90b3R5cGU7XG5cbi8vIG1ldG9kbyBlc2VndWl0byBhbGwnYXZ2aW8gZGVsIHRvb2xcbnByb3RvLnJ1biA9IGZ1bmN0aW9uKCl7XG4gIHZhciBzZWxmID0gdGhpcztcbiAgLy92YXIgbWFwID0gTWFwU2VydmljZS52aWV3ZXIubWFwO1xuICB2YXIgbGF5ZXJzID0gW3RoaXMuZWRpdG9yLmdldFZlY3RvckxheWVyKCkuZ2V0TGF5ZXIoKSx0aGlzLmVkaXRvci5nZXRFZGl0VmVjdG9yTGF5ZXIoKS5nZXRMYXllcigpXTtcbiAgXG4gIHRoaXMucGlja0ZlYXR1cmVJbnRlcmFjdGlvbiA9IG5ldyBQaWNrRmVhdHVyZUludGVyYWN0aW9uKHtcbiAgICBsYXllcnM6IGxheWVyc1xuICB9KTtcbiAgXG4gIHRoaXMucGlja0ZlYXR1cmVJbnRlcmFjdGlvbi5vbigncGlja2VkJyxmdW5jdGlvbihlKXtcbiAgICBpZiAoIXNlbGYuX2J1c3kpe1xuICAgICAgc2VsZi5fYnVzeSA9IHRydWU7XG4gICAgICBzZWxmLnBhdXNlKHRydWUpO1xuICAgICAgc2VsZi5waWNrRmVhdHVyZShlLmZlYXR1cmUpXG4gICAgICAudGhlbihmdW5jdGlvbihyZXMpe1xuICAgICAgICBzZWxmLl9idXN5ID0gZmFsc2U7XG4gICAgICAgIHNlbGYucGF1c2UoZmFsc2UpO1xuICAgICAgfSlcbiAgICB9XG4gIH0pO1xuICBcbiAgLy9tYXAuYWRkSW50ZXJhY3Rpb24odGhpcy5waWNrRmVhdHVyZUludGVyYWN0aW9uKTtcbiAgLy90aGlzLnBpY2tGZWF0dXJlSW50ZXJhY3Rpb24uc2V0QWN0aXZlKHRydWUpO1xuICBNYXBTZXJ2aWNlLnB1c2hJbnRlcmFjdGlvbih0aGlzLnBpY2tGZWF0dXJlSW50ZXJhY3Rpb24pO1xufTtcblxucHJvdG8ucGF1c2UgPSBmdW5jdGlvbihwYXVzZSl7XG4gIGlmIChfLmlzVW5kZWZpbmVkKHBhdXNlKSB8fCBwYXVzZSl7XG4gICAgdGhpcy5waWNrRmVhdHVyZUludGVyYWN0aW9uLnNldEFjdGl2ZShmYWxzZSk7XG4gIH1cbiAgZWxzZSB7XG4gICAgdGhpcy5waWNrRmVhdHVyZUludGVyYWN0aW9uLnNldEFjdGl2ZSh0cnVlKTtcbiAgfVxufTtcblxuLy8gbWV0b2RvIGVzZWd1aXRvIGFsbGEgZGlzYXR0aXZhemlvbmUgZGVsIHRvb2xcbnByb3RvLnN0b3AgPSBmdW5jdGlvbigpe1xuICBNYXBTZXJ2aWNlLnBvcEludGVyYWN0aW9uKCk7XG4gIHJldHVybiB0cnVlO1xufTtcblxucHJvdG8uX2ZhbGxCYWNrID0gZnVuY3Rpb24oZmVhdHVyZSl7XG4gIHRoaXMuX2J1c3kgPSBmYWxzZTtcbiAgdGhpcy5wYXVzZShmYWxzZSk7XG59O1xuIiwidmFyIGluaGVyaXQgPSByZXF1aXJlKCdnM3cvY29yZS91dGlscycpLmluaGVyaXQ7XG52YXIgYmFzZSA9IHJlcXVpcmUoJ2czdy9jb3JlL3V0aWxzJykuYmFzZTtcbnZhciBHM1dPYmplY3QgPSByZXF1aXJlKCdnM3cvY29yZS9nM3dvYmplY3QnKTtcbnZhciBNYXBTZXJ2aWNlID0gcmVxdWlyZSgnZzN3L2NvcmUvbWFwc2VydmljZScpO1xuXG5mdW5jdGlvbiBFZGl0aW5nVG9vbChlZGl0b3Isb3B0aW9ucyl7XG4gIHRoaXMuZWRpdG9yID0gZWRpdG9yO1xuICB0aGlzLmxheWVyID0gdGhpcy5lZGl0b3IuZ2V0VmVjdG9yTGF5ZXIoKS5nZXRMYXllcigpO1xuICB0aGlzLmVkaXRpbmdMYXllciA9IHRoaXMuZWRpdG9yLmdldEVkaXRWZWN0b3JMYXllcigpLmdldExheWVyKCk7XG4gIHRoaXMubWFwID0gTWFwU2VydmljZS52aWV3ZXIubWFwO1xuICB0aGlzLmlzUGF1c2FibGUgPSBmYWxzZTtcbiAgdGhpcy5vcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcbiAgdGhpcy5zdGVwcyA9IG51bGw7XG4gIFxuICBiYXNlKHRoaXMpO1xufVxuaW5oZXJpdChFZGl0aW5nVG9vbCxHM1dPYmplY3QpO1xuXG52YXIgcHJvdG8gPSBFZGl0aW5nVG9vbC5wcm90b3R5cGU7XG5cbnByb3RvLnN0b3AgPSBmdW5jdGlvbigpe1xuICBpZiAodGhpcy5zdGVwcykge1xuICAgIHRoaXMuc3RlcHMuZGVzdHJveSgpO1xuICB9XG4gIHJldHVybiB0cnVlO1xufVxuXG5FZGl0aW5nVG9vbC5TdGVwcyA9IGZ1bmN0aW9uKHN0ZXBzKXtcbiAgdmFyIGluZGV4ID0gLTE7XG4gIHZhciBzdGVwcyA9IHN0ZXBzO1xuICBcbiAgdGhpcy5uZXh0ID0gZnVuY3Rpb24oKXtcbiAgICBpbmRleCArPSAxO1xuICAgIHZhciBzdGVwID0gc3RlcHNbaW5kZXhdO1xuICAgIHRoaXMuZW1pdCgnc3RlcCcsaW5kZXgsc3RlcCk7XG4gIH07XG4gIFxuICB0aGlzLmN1cnJlbnRTdGVwID0gZnVuY3Rpb24oKXtcbiAgICByZXR1cm4gc3RlcHNbaW5kZXhdO1xuICB9O1xuICBcbiAgdGhpcy5jdXJyZW50U3RlcEluZGV4ID0gZnVuY3Rpb24oKXtcbiAgICByZXR1cm4gaW5kZXg7XG4gIH07XG4gIFxuICB0aGlzLnRvdGFsU3RlcHMgPSBmdW5jdGlvbigpe1xuICAgIHJldHVybiBzdGVwcy5sZW5ndGg7XG4gIH07XG4gIFxuICB0aGlzLnJlc2V0ID0gZnVuY3Rpb24oKXtcbiAgICBpbmRleCA9IDA7XG4gIH07XG4gIFxuICB0aGlzLmRlc3Ryb3kgPSBmdW5jdGlvbigpe1xuICAgIHRoaXMucmVtb3ZlQWxsTGlzdGVuZXJzKCk7XG4gIH07XG4gIFxuICB0aGlzLmNvbXBsZXRlZCA9IGZ1bmN0aW9uKCl7XG4gICAgdGhpcy5lbWl0KCdjb21wbGV0ZScpO1xuICAgIHRoaXMucmVzZXQoKTtcbiAgfTtcbiAgXG4gIHRoaXMuaW5zZXJ0U3RlcEF0ID0gZnVuY3Rpb24oaWR4LHN0ZXApe1xuICAgIHN0ZXBzLnNwbGljZShpZHgsMCxzdGVwKTtcbiAgfVxufVxuaW5oZXJpdChFZGl0aW5nVG9vbC5TdGVwcyxHM1dPYmplY3QpO1xuXG5tb2R1bGUuZXhwb3J0cyA9IEVkaXRpbmdUb29sXG4iLCJtb2R1bGUuZXhwb3J0cyA9IFwiPGRpdiBjbGFzcz1cXFwiZzN3LWl0ZXJuZXQtZWRpdGluZy1wYW5lbFxcXCI+XFxuICA8dGVtcGxhdGUgdi1mb3I9XFxcInRvb2xiYXIgaW4gZWRpdG9yc3Rvb2xiYXJzXFxcIj5cXG4gICAgPGRpdiBjbGFzcz1cXFwicGFuZWwgcGFuZWwtcHJpbWFyeVxcXCI+XFxuICAgICAgPGRpdiBjbGFzcz1cXFwicGFuZWwtaGVhZGluZ1xcXCI+XFxuICAgICAgICA8aDMgY2xhc3M9XFxcInBhbmVsLXRpdGxlXFxcIj57eyB0b29sYmFyLm5hbWUgfX08L2gzPlxcbiAgICAgIDwvZGl2PlxcbiAgICAgIDxkaXYgY2xhc3M9XFxcInBhbmVsLWJvZHlcXFwiPlxcbiAgICAgICAgPHRlbXBsYXRlIHYtZm9yPVxcXCJ0b29sIGluIHRvb2xiYXIudG9vbHNcXFwiPlxcbiAgICAgICAgICA8ZGl2IGNsYXNzPVxcXCJlZGl0YnRuXFxcIiA6Y2xhc3M9XFxcInsnZW5hYmxlZCcgOiAoc3RhdGUuZWRpdGluZy5vbiAmJiBlZGl0aW5ndG9vbGJ0bkVuYWJsZWQodG9vbCkpLCAndG9nZ2xlZCcgOiBlZGl0aW5ndG9vbGJ0blRvZ2dsZWQodG9vbGJhci5sYXllcmNvZGUsdG9vbC50b29sdHlwZSl9XFxcIj5cXG4gICAgICAgICAgICA8aW1nIGhlaWdodD1cXFwiMzBweFxcXCIgd2lkdGg9XFxcIjMwcHhcXFwiIEBjbGljaz1cXFwidG9nZ2xlRWRpdFRvb2wodG9vbGJhci5sYXllcmNvZGUsdG9vbC50b29sdHlwZSlcXFwiIDphbHQub25jZT1cXFwidG9vbC50aXRsZVxcXCIgOnRpdGxlLm9uY2U9XFxcInRvb2wudGl0bGVcXFwiIDpzcmMub25jZT1cXFwicmVzb3VyY2VzdXJsKydpbWFnZXMvJyt0b29sLmljb25cXFwiPjwvaW1nPlxcbiAgICAgICAgICA8L2Rpdj5cXG4gICAgICAgIDwvdGVtcGxhdGU+XFxuICAgICAgPC9kaXY+XFxuICAgIDwvZGl2PlxcbiAgPC90ZW1wbGF0ZT5cXG4gIDxkaXY+XFxuICAgIDxidXR0b24gY2xhc3M9XFxcImJ0biBidG4tcHJpbWFyeVxcXCIgdi1kaXNhYmxlZD1cXFwiZWRpdGluZ2J0bkVuYWJsZWRcXFwiIDpjbGFzcz1cXFwieydidG4tc3VjY2VzcycgOiBzdGF0ZS5lZGl0aW5nT259XFxcIiBAY2xpY2s9XFxcInRvZ2dsZUVkaXRpbmdcXFwiPnt7IGVkaXRpbmdidG5sYWJlbCB9fTwvYnV0dG9uPlxcbiAgICA8YnV0dG9uIGNsYXNzPVxcXCJidG4gYnRuLWRhbmdlclxcXCIgdi1kaXNhYmxlZD1cXFwiIXN0YXRlLmhhc0VkaXRzXFxcIiBAY2xpY2s9XFxcInNhdmVFZGl0c1xcXCI+e3sgc2F2ZWJ0bmxhYmVsIH19PC9idXR0b24+XFxuICAgIDxpbWcgdi1zaG93PVxcXCJzdGF0ZS5yZXRyaWV2aW5nRGF0YVxcXCIgOnNyYz1cXFwicmVzb3VyY2VzdXJsICsnaW1hZ2VzL2xvYWRlci5zdmcnXFxcIj5cXG4gIDwvZGl2PlxcbiAgPGRpdiBjbGFzcz1cXFwibWVzc2FnZVxcXCI+XFxuICAgIHt7eyBtZXNzYWdlIH19fVxcbiAgPC9kaXY+XFxuPC9kaXY+XFxuXCI7XG4iLCJ2YXIgcmVzb2x2ZWRWYWx1ZSA9IHJlcXVpcmUoJ2czdy9jb3JlL3V0aWxzJykucmVzb2x2ZWRWYWx1ZTtcbnZhciBHVUkgPSByZXF1aXJlKCdnM3cvZ3VpL2d1aScpO1xudmFyIFNlcnZpY2UgPSByZXF1aXJlKCcuL2l0ZXJuZXRzZXJ2aWNlJyk7XG5cbnZhciBQYW5lbENvbXBvbmVudCA9IFZ1ZS5leHRlbmQoe1xuICB0ZW1wbGF0ZTogcmVxdWlyZSgnLi9lZGl0b3JwYW5lbC5odG1sJyksXG4gIGRhdGE6IGZ1bmN0aW9uKCl7XG4gICAgcmV0dXJuIHtcbiAgICAgIHN0YXRlOiBTZXJ2aWNlLnN0YXRlLFxuICAgICAgcmVzb3VyY2VzdXJsOiBHVUkuZ2V0UmVzb3VyY2VzVXJsKCksXG4gICAgICBlZGl0b3JzdG9vbGJhcnM6IFtcbiAgICAgICAge1xuICAgICAgICAgIG5hbWU6IFwiQWNjZXNzaVwiLFxuICAgICAgICAgIGxheWVyY29kZTogXCJhY2Nlc3NpXCIsXG4gICAgICAgICAgdG9vbHM6W1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICB0aXRsZTogXCJBZ2dpdW5naSBhY2Nlc3NvXCIsXG4gICAgICAgICAgICAgIHRvb2x0eXBlOiAnYWRkZmVhdHVyZScsXG4gICAgICAgICAgICAgIGljb246ICdpdGVybmV0QWRkUG9pbnQucG5nJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgdGl0bGU6IFwiU3Bvc3RhIGFjY2Vzc29cIixcbiAgICAgICAgICAgICAgdG9vbHR5cGU6ICdtb3ZlZmVhdHVyZScsXG4gICAgICAgICAgICAgIGljb246ICdpdGVybmV0TW92ZVBvaW50LnBuZydcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIHRpdGxlOiBcIlJpbXVvdmkgYWNjZXNzb1wiLFxuICAgICAgICAgICAgICB0b29sdHlwZTogJ2RlbGV0ZWZlYXR1cmUnLFxuICAgICAgICAgICAgICBpY29uOiAnaXRlcm5ldERlbGV0ZVBvaW50LnBuZydcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIHRpdGxlOiBcIkVkaXRhIGF0dHJpYnV0aVwiLFxuICAgICAgICAgICAgICB0b29sdHlwZTogJ2VkaXRhdHRyaWJ1dGVzJyxcbiAgICAgICAgICAgICAgaWNvbjogJ2VkaXRBdHRyaWJ1dGVzLnBuZydcbiAgICAgICAgICAgIH1cbiAgICAgICAgICBdXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBuYW1lOiBcIkdpdW56aW9uaSBzdHJhZGFsaVwiLFxuICAgICAgICAgIGxheWVyY29kZTogXCJnaXVuemlvbmlcIixcbiAgICAgICAgICB0b29sczpbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIHRpdGxlOiBcIkFnZ2l1bmdpIGdpdW56aW9uZVwiLFxuICAgICAgICAgICAgICB0b29sdHlwZTogJ2FkZGZlYXR1cmUnLFxuICAgICAgICAgICAgICBpY29uOiAnaXRlcm5ldEFkZFBvaW50LnBuZydcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIHRpdGxlOiBcIlNwb3N0YSBnaXVuemlvbmVcIixcbiAgICAgICAgICAgICAgdG9vbHR5cGU6ICdtb3ZlZmVhdHVyZScsXG4gICAgICAgICAgICAgIGljb246ICdpdGVybmV0TW92ZVBvaW50LnBuZydcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIHRpdGxlOiBcIlJpbXVvdmkgZ2l1bnppb25lXCIsXG4gICAgICAgICAgICAgIHRvb2x0eXBlOiAnZGVsZXRlZmVhdHVyZScsXG4gICAgICAgICAgICAgIGljb246ICdpdGVybmV0RGVsZXRlUG9pbnQucG5nJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgdGl0bGU6IFwiRWRpdGEgYXR0cmlidXRpXCIsXG4gICAgICAgICAgICAgIHRvb2x0eXBlOiAnZWRpdGF0dHJpYnV0ZXMnLFxuICAgICAgICAgICAgICBpY29uOiAnZWRpdEF0dHJpYnV0ZXMucG5nJ1xuICAgICAgICAgICAgfVxuICAgICAgICAgIF1cbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIG5hbWU6IFwiRWxlbWVudGkgc3RyYWRhbGlcIixcbiAgICAgICAgICBsYXllcmNvZGU6IFwic3RyYWRlXCIsXG4gICAgICAgICAgdG9vbHM6W1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICB0aXRsZTogXCJBZ2dpdW5naSBzdHJhZGFcIixcbiAgICAgICAgICAgICAgdG9vbHR5cGU6ICdhZGRmZWF0dXJlJyxcbiAgICAgICAgICAgICAgaWNvbjogJ2l0ZXJuZXRBZGRMaW5lLnBuZydcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIHRpdGxlOiBcIlNwb3N0YSB2ZXJ0aWNlIHN0cmFkYVwiLFxuICAgICAgICAgICAgICB0b29sdHlwZTogJ21vZGlmeXZlcnRleCcsXG4gICAgICAgICAgICAgIGljb246ICdpdGVybmV0TW92ZVZlcnRleC5wbmcnXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICB0aXRsZTogXCJUYWdsaWEgc3UgZ2l1bnppb25lXCIsXG4gICAgICAgICAgICAgIHRvb2x0eXBlOiAnY3V0bGluZScsXG4gICAgICAgICAgICAgIGljb246ICdpdGVybmV0Q3V0T25WZXJ0ZXgucG5nJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgdGl0bGU6IFwiU3Bvc3RhIHN0cmFkYVwiLFxuICAgICAgICAgICAgICB0b29sdHlwZTogJ21vdmVmZWF0dXJlJyxcbiAgICAgICAgICAgICAgaWNvbjogJ2l0ZXJuZXRNb3ZlTGluZS5wbmcnXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICB0aXRsZTogXCJSaW11b3ZpIHN0cmFkYVwiLFxuICAgICAgICAgICAgICB0b29sdHlwZTogJ2RlbGV0ZWZlYXR1cmUnLFxuICAgICAgICAgICAgICBpY29uOiAnaXRlcm5ldERlbGV0ZUxpbmUucG5nJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgdGl0bGU6IFwiRWRpdGEgYXR0cmlidXRpXCIsXG4gICAgICAgICAgICAgIHRvb2x0eXBlOiAnZWRpdGF0dHJpYnV0ZXMnLFxuICAgICAgICAgICAgICBpY29uOiAnZWRpdEF0dHJpYnV0ZXMucG5nJ1xuICAgICAgICAgICAgfVxuICAgICAgICAgIF1cbiAgICAgICAgfVxuICAgICAgXSxcbiAgICAgIHNhdmVidG5sYWJlbDogXCJTYWx2YVwiXG4gICAgfVxuICB9LFxuICBtZXRob2RzOiB7XG4gICAgdG9nZ2xlRWRpdGluZzogZnVuY3Rpb24oKXtcbiAgICAgIFNlcnZpY2UudG9nZ2xlRWRpdGluZygpO1xuICAgIH0sXG4gICAgc2F2ZUVkaXRzOiBmdW5jdGlvbigpe1xuICAgICAgU2VydmljZS5zYXZlRWRpdHMoKTtcbiAgICB9LFxuICAgIHRvZ2dsZUVkaXRUb29sOiBmdW5jdGlvbihsYXllckNvZGUsdG9vbFR5cGUpe1xuICAgICAgaWYgKHRvb2xUeXBlID09ICcnKXtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMuc3RhdGUuZWRpdGluZy5vbikge1xuICAgICAgICBTZXJ2aWNlLnRvZ2dsZUVkaXRUb29sKGxheWVyQ29kZSx0b29sVHlwZSk7XG4gICAgICB9XG4gICAgfSxcbiAgICBlZGl0aW5ndG9vbGJ0blRvZ2dsZWQ6IGZ1bmN0aW9uKGxheWVyQ29kZSx0b29sVHlwZSl7XG4gICAgICByZXR1cm4gKHRoaXMuc3RhdGUuZWRpdGluZy5sYXllckNvZGUgPT0gbGF5ZXJDb2RlICYmIHRoaXMuc3RhdGUuZWRpdGluZy50b29sVHlwZSA9PSB0b29sVHlwZSk7XG4gICAgfSxcbiAgICBlZGl0aW5ndG9vbGJ0bkVuYWJsZWQ6IGZ1bmN0aW9uKHRvb2wpe1xuICAgICAgcmV0dXJuIHRvb2wudG9vbHR5cGUgIT0gJyc7XG4gICAgfVxuICB9LFxuICBjb21wdXRlZDoge1xuICAgIGVkaXRpbmdidG5sYWJlbDogZnVuY3Rpb24oKXtcbiAgICAgIHJldHVybiB0aGlzLnN0YXRlLmVkaXRpbmcub24gPyBcIlRlcm1pbmEgZWRpdGluZ1wiIDogXCJBdnZpYSBlZGl0aW5nXCI7XG4gICAgfSxcbiAgICBlZGl0aW5nYnRuRW5hYmxlZDogZnVuY3Rpb24oKXtcbiAgICAgIHJldHVybiAodGhpcy5zdGF0ZS5lZGl0aW5nLmVuYWJsZWQgfHwgdGhpcy5zdGF0ZS5lZGl0aW5nLm9uKSA/IFwiXCIgOiBcImRpc2FibGVkXCI7XG4gICAgfSxcbiAgICBtZXNzYWdlOiBmdW5jdGlvbigpe1xuICAgICAgdmFyIG1lc3NhZ2UgPSBcIlwiO1xuICAgICAgaWYgKCF0aGlzLnN0YXRlLmVkaXRpbmcuZW5hYmxlZCl7XG4gICAgICAgIG1lc3NhZ2UgPSAnPHNwYW4gc3R5bGU9XCJjb2xvcjogcmVkXCI+QXVtZW50YXJlIGlsIGxpdmVsbG8gZGkgem9vbSBwZXIgYWJpbGl0YXJlIGxcXCdlZGl0aW5nJztcbiAgICAgIH1cbiAgICAgIGVsc2UgaWYgKHRoaXMuc3RhdGUuZWRpdGluZy50b29sc3RlcC5tZXNzYWdlKXtcbiAgICAgICAgdmFyIG4gPSB0aGlzLnN0YXRlLmVkaXRpbmcudG9vbHN0ZXAubjtcbiAgICAgICAgdmFyIHRvdGFsID0gdGhpcy5zdGF0ZS5lZGl0aW5nLnRvb2xzdGVwLnRvdGFsO1xuICAgICAgICB2YXIgc3RlcG1lc3NhZ2UgPSB0aGlzLnN0YXRlLmVkaXRpbmcudG9vbHN0ZXAubWVzc2FnZTtcbiAgICAgICAgbWVzc2FnZSA9ICc8ZGl2IHN0eWxlPVwibWFyZ2luLXRvcDoyMHB4XCI+R1VJREEgU1RSVU1FTlRPOjwvZGl2PicgK1xuICAgICAgICAgICc8ZGl2PjxzcGFuPlsnK24rJy8nK3RvdGFsKyddIDwvc3Bhbj48c3BhbiBzdHlsZT1cImNvbG9yOiB5ZWxsb3dcIj4nK3N0ZXBtZXNzYWdlKyc8L3NwYW4+PC9kaXY+JztcbiAgICAgIH1cbiAgICAgIHJldHVybiBtZXNzYWdlO1xuICAgIH1cbiAgfVxufSk7XG5cbmZ1bmN0aW9uIFBhbmVsKCl7XG4gIC8vIHByb3ByaWV0w6AgbmVjZXNzYXJpZS4gSW4gZnV0dXJvIGxlIG1ldHRlcm1vIGluIHVuYSBjbGFzc2UgUGFuZWwgZGEgY3VpIGRlcml2ZXJhbm5vIHR1dHRpIGkgcGFubmVsbGkgY2hlIHZvZ2xpb25vIGVzc2VyZSBtb3N0cmF0aSBuZWxsYSBzaWRlYmFyXG4gIHRoaXMuaWQgPSBcIml0ZXJuZXQtZWRpdGluZy1wYW5lbFwiO1xuICB0aGlzLm5hbWUgPSBcIkdlc3Rpb25lIGRhdGkgSVRFUk5FVFwiO1xuICB0aGlzLnBhbmVsQ29tcG9uZW50ID0gbnVsbDtcbn1cblxudmFyIHByb3RvID0gUGFuZWwucHJvdG90eXBlO1xuXG4vLyB2aWVuZSByaWNoaWFtYXRvIGRhbGxhIHRvb2xiYXIgcXVhbmRvIGlsIHBsdWdpbiBjaGllZGUgZGkgbW9zdHJhcmUgdW4gcHJvcHJpbyBwYW5uZWxsbyBuZWxsYSBHVUkgKEdVSS5zaG93UGFuZWwpXG5wcm90by5vblNob3cgPSBmdW5jdGlvbihjb250YWluZXIpe1xuICB2YXIgcGFuZWwgPSB0aGlzLnBhbmVsQ29tcG9uZW50ID0gbmV3IFBhbmVsQ29tcG9uZW50KCk7XG4gIHBhbmVsLiRtb3VudCgpLiRhcHBlbmRUbyhjb250YWluZXIpO1xuICByZXR1cm4gcmVzb2x2ZWRWYWx1ZSh0cnVlKTtcbn07XG5cbi8vIHJpY2hpYW1hdG8gcXVhbmRvIGxhIEdVSSBjaGllZGUgZGkgY2hpdWRlcmUgaWwgcGFubmVsbG8uIFNlIHJpdG9ybmEgZmFsc2UgaWwgcGFubmVsbG8gbm9uIHZpZW5lIGNoaXVzb1xucHJvdG8ub25DbG9zZSA9IGZ1bmN0aW9uKCl7XG4gIHZhciBzZWxmID0gdGhpcztcbiAgdmFyIGRlZmVycmVkID0gJC5EZWZlcnJlZCgpO1xuICBTZXJ2aWNlLnN0b3AoKVxuICAudGhlbihmdW5jdGlvbigpe1xuICAgIHNlbGYucGFuZWxDb21wb25lbnQuJGRlc3Ryb3kodHJ1ZSk7XG4gICAgc2VsZi5wYW5lbENvbXBvbmVudCA9IG51bGw7XG4gICAgZGVmZXJyZWQucmVzb2x2ZSgpO1xuICB9KVxuICAuZmFpbChmdW5jdGlvbigpe1xuICAgIGRlZmVycmVkLnJlamVjdCgpO1xuICB9KVxuICBcbiAgcmV0dXJuIGRlZmVycmVkLnByb21pc2UoKTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gUGFuZWw7XG4iLCJ2YXIgaW5oZXJpdCA9IHJlcXVpcmUoJ2czdy9jb3JlL3V0aWxzJykuaW5oZXJpdDtcbnZhciBiYXNlID0gcmVxdWlyZSgnZzN3L2NvcmUvdXRpbHMnKS5iYXNlO1xudmFyIEl0ZXJuZXRFZGl0b3IgPSByZXF1aXJlKCcuL2l0ZXJuZXRlZGl0b3InKTtcblxuZnVuY3Rpb24gQWNjZXNzaUVkaXRvcihvcHRpb25zKXtcbiAgYmFzZSh0aGlzLG9wdGlvbnMpO1xufVxuaW5oZXJpdChBY2Nlc3NpRWRpdG9yLEl0ZXJuZXRFZGl0b3IpO1xubW9kdWxlLmV4cG9ydHMgPSBBY2Nlc3NpRWRpdG9yO1xuIiwidmFyIGluaGVyaXQgPSByZXF1aXJlKCdnM3cvY29yZS91dGlscycpLmluaGVyaXQ7XG52YXIgYmFzZSA9IHJlcXVpcmUoJ2czdy9jb3JlL3V0aWxzJykuYmFzZTtcbnZhciBQcm9qZWN0U2VydmljZSA9IHJlcXVpcmUoJ2czdy9jb3JlL3Byb2plY3RzZXJ2aWNlJykuUHJvamVjdFNlcnZpY2U7XG52YXIgRm9ybVBhbmVsID0gcmVxdWlyZSgnZzN3L2d1aS9mb3JtJykuRm9ybVBhbmVsO1xudmFyIEZvcm0gPSByZXF1aXJlKCdnM3cvZ3VpL2Zvcm0nKS5Gb3JtO1xuXG52YXIgSXRlcm5ldEZvcm1QYW5lbCA9IEZvcm1QYW5lbC5leHRlbmQoe30pO1xuXG5mdW5jdGlvbiBJdGVybmV0Rm9ybShvcHRpb25zKXtcbiAgYmFzZSh0aGlzLG9wdGlvbnMpO1xuICB0aGlzLl9mb3JtUGFuZWwgPSBJdGVybmV0Rm9ybVBhbmVsO1xufVxuaW5oZXJpdChJdGVybmV0Rm9ybSxGb3JtKTtcblxudmFyIHByb3RvID0gSXRlcm5ldEZvcm0ucHJvdG90eXBlO1xuXG5wcm90by5faXNWaXNpYmxlID0gZnVuY3Rpb24oZmllbGQpe1xuICB2YXIgcmV0ID0gdHJ1ZTtcbiAgc3dpdGNoIChmaWVsZC5uYW1lKXtcbiAgICBjYXNlIFwiY29kX2FjY19lc3RcIjpcbiAgICAgIHZhciB0aXBfYWNjID0gdGhpcy5fZ2V0RmllbGQoXCJ0aXBfYWNjXCIpO1xuICAgICAgaWYgKHRpcF9hY2MudmFsdWU9PVwiMDEwMVwiKXtcbiAgICAgICAgcmV0ID0gZmFsc2U7XG4gICAgICB9XG4gICAgICBicmVhaztcbiAgICBjYXNlIFwiY29kX2FjY19pbnRcIjpcbiAgICAgIHZhciB0aXBfYWNjID0gdGhpcy5fZ2V0RmllbGQoXCJ0aXBfYWNjXCIpO1xuICAgICAgaWYgKHRpcF9hY2MudmFsdWU9PVwiMDEwMVwiIHx8IHRpcF9hY2MudmFsdWU9PVwiMDUwMVwiKXtcbiAgICAgICAgcmV0ID0gZmFsc2U7XG4gICAgICB9XG4gICAgICBicmVhaztcbiAgfVxuICByZXR1cm4gcmV0O1xufTtcblxucHJvdG8uX2lzRWRpdGFibGUgPSBmdW5jdGlvbihmaWVsZCl7XG4gIGlmIChmaWVsZC5uYW1lID09IFwidGlwX2FjY1wiICYmICF0aGlzLl9pc05ldygpKXtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH07XG4gIHJldHVybiBGb3JtLnByb3RvdHlwZS5faXNFZGl0YWJsZS5jYWxsKHRoaXMsZmllbGQpO1xufTtcblxucHJvdG8uX3Nob3VsZFNob3dSZWxhdGlvbiA9IGZ1bmN0aW9uKHJlbGF0aW9uKXtcbiAgaWYgKHJlbGF0aW9uLm5hbWU9PVwibnVtZXJvX2Npdmljb1wiKXtcbiAgICB2YXIgdGlwX2FjYyA9IHRoaXMuX2dldEZpZWxkKFwidGlwX2FjY1wiKTtcbiAgICBpZiAodGlwX2FjYy52YWx1ZSA9PSAnMDEwMicpe1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuICByZXR1cm4gdHJ1ZTtcbn07XG5cbnByb3RvLl9waWNrTGF5ZXIgPSBmdW5jdGlvbihmaWVsZCl7XG4gIHZhciBzZWxmID0gdGhpcztcbiAgdmFyIGxheWVySWQgPSBmaWVsZC5pbnB1dC5vcHRpb25zLmxheWVyaWQ7XG4gIFxuICBGb3JtLnByb3RvdHlwZS5fcGlja0xheWVyLmNhbGwodGhpcyxmaWVsZClcbiAgLnRoZW4oZnVuY3Rpb24oYXR0cmlidXRlcyl7XG4gICAgdmFyIGxpbmtlZEZpZWxkO1xuICAgIHZhciBsaW5rZWRGaWVsZEF0dHJpYnV0ZU5hbWU7XG4gICAgXG4gICAgc3dpdGNoIChmaWVsZC5uYW1lKSB7XG4gICAgICBjYXNlICdjb2RfZWxlJzpcbiAgICAgICAgbGlua2VkRmllbGQgPSBzZWxmLl9nZXRSZWxhdGlvbkZpZWxkKFwiY29kX3RvcFwiLFwibnVtZXJvX2Npdmljb1wiKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdjb2RfdG9wJzpcbiAgICAgICAgbGlua2VkRmllbGQgPSBzZWxmLl9nZXRGaWVsZChcImNvZF9lbGVcIik7O1xuICAgIH1cbiAgICBcbiAgICBpZiAobGlua2VkRmllbGQpIHtcbiAgICAgIGxpbmtlZEZpZWxkQXR0cmlidXRlTmFtZSA9IFByb2plY3RTZXJ2aWNlLmdldExheWVyQXR0cmlidXRlTGFiZWwobGF5ZXJJZCxsaW5rZWRGaWVsZC5pbnB1dC5vcHRpb25zLmZpZWxkKTtcbiAgICAgIGlmIChsaW5rZWRGaWVsZCAmJiBhdHRyaWJ1dGVzW2xpbmtlZEZpZWxkQXR0cmlidXRlTmFtZV0pe1xuICAgICAgICBsaW5rZWRGaWVsZC52YWx1ZSA9IGF0dHJpYnV0ZXNbbGlua2VkRmllbGRBdHRyaWJ1dGVOYW1lXTtcbiAgICAgIH1cbiAgICB9XG4gIH0pXG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IEl0ZXJuZXRGb3JtO1xuIiwidmFyIGluaGVyaXQgPSByZXF1aXJlKCdnM3cvY29yZS91dGlscycpLmluaGVyaXQ7XG52YXIgYmFzZSA9IHJlcXVpcmUoJ2czdy9jb3JlL3V0aWxzJykuYmFzZTtcbnZhciBJdGVybmV0RWRpdG9yID0gcmVxdWlyZSgnLi9pdGVybmV0ZWRpdG9yJyk7XG5cbmZ1bmN0aW9uIEdpdW56aW9uaUVkaXRvcihvcHRpb25zKXtcbiAgYmFzZSh0aGlzLG9wdGlvbnMpO1xuICBcbiAgdGhpcy5fc2VydmljZSA9IG51bGw7XG4gIHRoaXMuX3N0cmFkZUVkaXRvciA9IG51bGw7XG4gIHRoaXMuX2dpdW56aW9uZUdlb21MaXN0ZW5lciA9IG51bGw7XG4gIFxuICAvKiBJTklaSU8gTU9ESUZJQ0EgVE9QT0xPR0lDQSBERUxMRSBHSVVOWklPTkkgKi9cbiAgXG4gIHRoaXMuX3NldHVwTW92ZUdpdW56aW9uaUxpc3RlbmVyID0gZnVuY3Rpb24oKXtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgdGhpcy5vbignbW92ZXN0YXJ0JyxmdW5jdGlvbihmZWF0dXJlKXtcbiAgICAgIC8vIHJpbXVvdm8gZXZlbnR1YWxpIHByZWNlZGVudGkgbGlzdGVuZXJzXG4gICAgICBzZWxmLl9zdGFydE1vdmluZ0dpdW56aW9uZShmZWF0dXJlKTtcbiAgICB9KTtcbiAgfTtcbiAgXG4gIHRoaXMuX3N0cmFkZVRvVXBkYXRlID0gW107XG4gIFxuICB0aGlzLl9zdGFydE1vdmluZ0dpdW56aW9uZSA9IGZ1bmN0aW9uKGZlYXR1cmUpe1xuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICB2YXIgdmVjdG9yTGF5ZXIgPSB0aGlzLmdldFZlY3RvckxheWVyKCk7XG4gICAgdmFyIHN0cmFkZUVkaXRvciA9IHRoaXMuX3N0cmFkZUVkaXRvcjtcbiAgICB2YXIgZ2l1bnppb25lID0gZmVhdHVyZTtcbiAgICB2YXIgY29kX2dueiA9IGdpdW56aW9uZS5nZXQoJ2NvZF9nbnonKTtcbiAgICAvLyBkZXZvIGF2dmlhcmUgbCdlZGl0b3IgZGVsbGUgc3RyYWRlXG4gICAgdGhpcy5fc3RyYWRlVG9VcGRhdGUgPSBbXTtcbiAgICB2YXIgc3RyYWRlID0gc3RyYWRlRWRpdG9yLmdldFZlY3RvckxheWVyKCkuZ2V0U291cmNlKCkuZ2V0RmVhdHVyZXMoKTtcbiAgICBfLmZvckVhY2goc3RyYWRlLGZ1bmN0aW9uKHN0cmFkYSl7XG4gICAgICB2YXIgbm9kX2luaSA9IHN0cmFkYS5nZXQoJ25vZF9pbmknKTtcbiAgICAgIHZhciBub2RfZmluID0gc3RyYWRhLmdldCgnbm9kX2ZpbicpO1xuICAgICAgdmFyIGluaSA9IChub2RfaW5pID09IGNvZF9nbnopO1xuICAgICAgdmFyIGZpbiA9IChub2RfZmluID09IGNvZF9nbnopO1xuICAgICAgaWYgKGluaSB8fCBmaW4pe1xuICAgICAgICB2YXIgaW5pdGlhbCA9IGluaSA/IHRydWUgOiBmYWxzZTtcbiAgICAgICAgc2VsZi5fc3RyYWRlVG9VcGRhdGUucHVzaChzdHJhZGEpO1xuICAgICAgICBzZWxmLl9zdGFydEdpdW56aW9uaVN0cmFkZVRvcG9sb2dpY2FsRWRpdGluZyhnaXVuemlvbmUsc3RyYWRhLGluaXRpYWwpXG4gICAgICB9XG4gICAgfSlcbiAgICB0aGlzLm9uY2UoJ21vdmVlbmQnLGZ1bmN0aW9uKGZlYXR1cmUpe1xuICAgICAgaWYgKCBzZWxmLl9zdHJhZGVUb1VwZGF0ZS5sZW5ndGgpe1xuICAgICAgICBpZiAoIXN0cmFkZUVkaXRvci5pc1N0YXJ0ZWQoKSl7XG4gICAgICAgICAgc3RyYWRlRWRpdG9yLnN0YXJ0KHRoaXMuX3NlcnZpY2UpO1xuICAgICAgICB9XG4gICAgICAgIF8uZm9yRWFjaCggc2VsZi5fc3RyYWRlVG9VcGRhdGUsZnVuY3Rpb24oc3RyYWRhKXtcbiAgICAgICAgICBzdHJhZGVFZGl0b3IudXBkYXRlRmVhdHVyZShzdHJhZGEpO1xuICAgICAgICB9KVxuICAgICAgfVxuICAgIH0pO1xuICB9O1xuICBcbiAgdGhpcy5fc3RhcnRHaXVuemlvbmlTdHJhZGVUb3BvbG9naWNhbEVkaXRpbmcgPSBmdW5jdGlvbihnaXVuemlvbmUsc3RyYWRhLGluaXRpYWwpe1xuICAgIHZhciBzdHJhZGFHZW9tID0gc3RyYWRhLmdldEdlb21ldHJ5KCk7XG4gICAgdmFyIHN0cmFkYUNvb3JkcyA9IHN0cmFkYS5nZXRHZW9tZXRyeSgpLmdldENvb3JkaW5hdGVzKCk7XG4gICAgdmFyIGNvb3JkSW5kZXggPSBpbml0aWFsID8gMCA6IHN0cmFkYUNvb3Jkcy5sZW5ndGgtMTtcbiAgICB2YXIgZ2l1bnppb25lR2VvbSA9IGdpdW56aW9uZS5nZXRHZW9tZXRyeSgpO1xuICAgIHZhciBsaXN0ZW5lcktleSA9IGdpdW56aW9uZUdlb20ub24oJ2NoYW5nZScsZnVuY3Rpb24oZSl7XG4gICAgICBzdHJhZGFDb29yZHNbY29vcmRJbmRleF0gPSBlLnRhcmdldC5nZXRDb29yZGluYXRlcygpO1xuICAgICAgc3RyYWRhR2VvbS5zZXRDb29yZGluYXRlcyhzdHJhZGFDb29yZHMpO1xuICAgIH0pO1xuICAgIHRoaXMuX2dpdW56aW9uZUdlb21MaXN0ZW5lciA9IGxpc3RlbmVyS2V5O1xuICB9O1xuICBcbiAgLyogRklORSBNT0RJRklDQSBUT1BPTE9HSUNBIEdJVU5aSU9OSSAqL1xuICBcbiAgLyogSU5JWklPIFJJTU9aSU9ORSBHSVVOWklPTkkgKi9cbiAgXG4gIHRoaXMuX3NldHVwRGVsZXRlR2l1bnppb25pTGlzdGVuZXIgPSBmdW5jdGlvbigpe1xuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICB2YXIgc3RyYWRlRWRpdG9yID0gdGhpcy5fc3RyYWRlRWRpdG9yO1xuICAgIHRoaXMub25iZWZvcmVhc3luYygnZGVsZXRlRmVhdHVyZScsZnVuY3Rpb24oZmVhdHVyZSxpc05ldyxuZXh0KXtcbiAgICAgIHZhciBzdG9wRGVsZXRpb24gPSBmYWxzZTtcbiAgICAgIHZhciBzdHJhZGVWZWN0b3JMYXllciA9IHN0cmFkZUVkaXRvci5nZXRWZWN0b3JMYXllcigpO1xuICAgICAgXy5mb3JFYWNoKHN0cmFkZVZlY3RvckxheWVyLmdldEZlYXR1cmVzKCksZnVuY3Rpb24oc3RyYWRhKXtcbiAgICAgICAgdmFyIGNvZF9nbnogPSBmZWF0dXJlLmdldCgnY29kX2dueicpO1xuICAgICAgICB2YXIgbm9kX2luaSA9IHN0cmFkYS5nZXQoJ25vZF9pbmknKTtcbiAgICAgICAgdmFyIG5vZF9maW4gPSBzdHJhZGEuZ2V0KCdub2RfZmluJyk7XG4gICAgICAgIHZhciBpbmkgPSAobm9kX2luaSA9PSBjb2RfZ256KTtcbiAgICAgICAgdmFyIGZpbiA9IChub2RfZmluID09IGNvZF9nbnopO1xuICAgICAgICBpZiAoaW5pIHx8IGZpbil7XG4gICAgICAgICAgc3RvcERlbGV0aW9uID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICBcbiAgICAgIGlmIChzdG9wRGVsZXRpb24pe1xuICAgICAgICBHVUkubm90aWZ5LmVycm9yKFwiTm9uIMOoIHBvc3NpYmlsZSByaW11b3ZlcmUgbGEgZ2l1bnppb25pIHBlcmNow6kgcmlzdWx0YSBjb25uZXNzYSBhZCB1bmEgbyBwacO5IHN0cmFkZVwiKTtcbiAgICAgIH1cbiAgICAgIG5leHQoIXN0b3BEZWxldGlvbik7XG4gICAgfSk7XG4gIH07XG4gIFxuICAvKiBGSU5FICovXG59XG5pbmhlcml0KEdpdW56aW9uaUVkaXRvcixJdGVybmV0RWRpdG9yKTtcbm1vZHVsZS5leHBvcnRzID0gR2l1bnppb25pRWRpdG9yO1xuXG52YXIgcHJvdG8gPSBHaXVuemlvbmlFZGl0b3IucHJvdG90eXBlO1xuXG5wcm90by5zdGFydCA9IGZ1bmN0aW9uKGl0ZXJuZXRTZXJ2aWNlKXtcbiAgdGhpcy5fc2VydmljZSA9IGl0ZXJuZXRTZXJ2aWNlO1xuICB0aGlzLl9zdHJhZGVFZGl0b3IgPSBpdGVybmV0U2VydmljZS5fbGF5ZXJzW2l0ZXJuZXRTZXJ2aWNlLmxheWVyQ29kZXMuU1RSQURFXS5lZGl0b3I7XG4gIHRoaXMuX3NldHVwTW92ZUdpdW56aW9uaUxpc3RlbmVyKCk7XG4gIHRoaXMuX3NldHVwRGVsZXRlR2l1bnppb25pTGlzdGVuZXIoKTtcbiAgcmV0dXJuIEl0ZXJuZXRFZGl0b3IucHJvdG90eXBlLnN0YXJ0LmNhbGwodGhpcyk7XG59O1xuXG5wcm90by5zdG9wID0gZnVuY3Rpb24oKXtcbiAgdmFyIHJldCA9IGZhbHNlO1xuICBpZiAoSXRlcm5ldEVkaXRvci5wcm90b3R5cGUuc3RvcC5jYWxsKHRoaXMpKXtcbiAgICByZXQgPSB0cnVlO1xuICAgIG9sLk9ic2VydmFibGUudW5CeUtleSh0aGlzLl9naXVuemlvbmVHZW9tTGlzdGVuZXIpO1xuICB9XG4gIHJldHVybiByZXQ7XG59O1xuXG5wcm90by5zZXRUb29sID0gZnVuY3Rpb24odG9vbFR5cGUpe1xuICB2YXIgb3B0aW9ucztcbiAgaWYgKHRvb2xUeXBlPT0nYWRkZmVhdHVyZScpe1xuICAgIG9wdGlvbnMgPSB7XG4gICAgICBzbmFwOiB7XG4gICAgICAgIHZlY3RvckxheWVyOiB0aGlzLl9zdHJhZGVFZGl0b3IuZ2V0VmVjdG9yTGF5ZXIoKVxuICAgICAgfVxuICAgIH1cbiAgfVxuICByZXR1cm4gSXRlcm5ldEVkaXRvci5wcm90b3R5cGUuc2V0VG9vbC5jYWxsKHRoaXMsdG9vbFR5cGUsb3B0aW9ucyk7XG59XG4iLCJ2YXIgaW5oZXJpdCA9IHJlcXVpcmUoJ2czdy9jb3JlL3V0aWxzJykuaW5oZXJpdDtcbnZhciBiYXNlID0gcmVxdWlyZSgnZzN3L2NvcmUvdXRpbHMnKS5iYXNlO1xudmFyIEdVSSA9IHJlcXVpcmUoJ2czdy9ndWkvZ3VpJyk7XG52YXIgRWRpdG9yID0gcmVxdWlyZSgnZzN3LWVkaXRpbmcvZWRpdG9yJyk7XG52YXIgRm9ybSA9IHJlcXVpcmUoJy4vYXR0cmlidXRlc2Zvcm0nKTtcblxuZnVuY3Rpb24gSXRlcm5ldEVkaXRvcihvcHRpb25zKXtcbiAgYmFzZSh0aGlzLG9wdGlvbnMpO1xuICBcbiAgLy8gYXByZSBmb3JtIGF0dHJpYnV0aSBwZXIgaW5zZXJpbWVudG9cbiAgdGhpcy5fYXNrQ29uZmlybVRvRGVsZXRlRWRpdGluZ0xpc3RlbmVyID0gZnVuY3Rpb24oKXtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgdGhpcy5vbmJlZm9yZWFzeW5jKCdkZWxldGVGZWF0dXJlJyxmdW5jdGlvbihmZWF0dXJlLGlzTmV3LG5leHQpe1xuICAgICAgR1VJLmRpYWxvZy5jb25maXJtKFwiVnVvaSBlbGltaW5hcmUgbCdlbGVtZW50byBzZWxlemlvbmF0bz9cIixmdW5jdGlvbihyZXN1bHQpe1xuICAgICAgICBuZXh0KHJlc3VsdCk7XG4gICAgICB9KVxuICAgIH0pO1xuICB9O1xuICBcbiAgLy8gYXByZSBmb3JtIGF0dHJpYnV0aSBwZXIgaW5zZXJpbWVudG9cbiAgdGhpcy5fc2V0dXBBZGRGZWF0dXJlQXR0cmlidXRlc0VkaXRpbmdMaXN0ZW5lcnMgPSBmdW5jdGlvbigpe1xuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICB0aGlzLm9uYmVmb3JlYXN5bmMoJ2FkZEZlYXR1cmUnLGZ1bmN0aW9uKGZlYXR1cmUsbmV4dCl7XG4gICAgICBzZWxmLl9vcGVuRWRpdG9yRm9ybSgnbmV3JyxmZWF0dXJlLG5leHQpXG4gICAgfSk7XG4gIH07XG4gIFxuICAvLyBhcHJlIGZvcm0gYXR0cmlidXRpIHBlciBlZGl0YXppb25lXG4gIHRoaXMuX3NldHVwRWRpdEF0dHJpYnV0ZXNMaXN0ZW5lcnMgPSBmdW5jdGlvbigpe1xuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICB0aGlzLm9uYWZ0ZXIoJ3BpY2tGZWF0dXJlJyxmdW5jdGlvbihmZWF0dXJlKXtcbiAgICAgIHNlbGYuX29wZW5FZGl0b3JGb3JtKCdvbGQnLGZlYXR1cmUpXG4gICAgfSk7XG4gIH07XG4gIFxuICB0aGlzLl9vcGVuRWRpdG9yRm9ybSA9IGZ1bmN0aW9uKGlzTmV3LGZlYXR1cmUsbmV4dCl7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIHZhciBmaWQgPSBmZWF0dXJlLmdldElkKCk7XG4gICAgdmFyIHZlY3RvckxheWVyID0gdGhpcy5nZXRWZWN0b3JMYXllcigpO1xuICAgIHZhciBmaWVsZHMgPSB2ZWN0b3JMYXllci5nZXRGaWVsZHNXaXRoQXR0cmlidXRlcyhmZWF0dXJlKTtcbiAgICBcbiAgICAvLyBuZWwgY2FzbyBxdWFsY3VubywgZHVyYW50ZSBsYSBjYXRlbmEgZGkgc2V0dGVyTGlzdGVuZXJzLCBhYmJpYSBzZXR0YXRvIHVuIGF0dHJpYnV0byAoc29sbyBuZWwgY2FzbyBkaSB1biBudW92byBpbnNlcmltZW50bylcbiAgICAvLyB1c2F0byBhZCBlc2VtcGlvIG5lbGwnZWRpdGluZyBkZWxsZSBzdHJhZGUsIGRvdmUgdmllbmUgc2V0dGF0byBpbiBmYXNlIGRpIGluc2VyaW1lbnRvL21vZGlmaWNhIGlsIGNvZGljZSBkZWkgY2FtcGkgbm9kX2luaSBlIG5vZF9maW5cbiAgICB2YXIgcGsgPSB2ZWN0b3JMYXllci5waztcbiAgICBpZiAocGsgJiYgXy5pc051bGwodGhpcy5nZXRGaWVsZChwaykpKXtcbiAgICAgIF8uZm9yRWFjaChmZWF0dXJlLmdldFByb3BlcnRpZXMoKSxmdW5jdGlvbih2YWx1ZSxhdHRyaWJ1dGUpe1xuICAgICAgICB2YXIgZmllbGQgPSBzZWxmLmdldEZpZWxkKGF0dHJpYnV0ZSxmaWVsZHMpO1xuICAgICAgICBpZihmaWVsZCl7XG4gICAgICAgICAgZmllbGQudmFsdWUgPSB2YWx1ZTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICAgIFxuICAgIHZhciByZWxhdGlvbnNQcm9taXNlID0gdGhpcy5nZXRSZWxhdGlvbnNXaXRoQXR0cmlidXRlcyhmZWF0dXJlKTtcbiAgICByZWxhdGlvbnNQcm9taXNlXG4gICAgLnRoZW4oZnVuY3Rpb24ocmVsYXRpb25zKXtcbiAgICAgIHZhciBmb3JtID0gbmV3IEZvcm0oe1xuICAgICAgICBuYW1lOiBcIkVkaXRhIGF0dHJpYnV0aSBcIit2ZWN0b3JMYXllci5uYW1lLFxuICAgICAgICBpZDogXCJhdHRyaWJ1dGVzLWVkaXQtXCIrdmVjdG9yTGF5ZXIubmFtZSxcbiAgICAgICAgZGF0YWlkOiB2ZWN0b3JMYXllci5uYW1lLFxuICAgICAgICBwazogdmVjdG9yTGF5ZXIucGssXG4gICAgICAgIGlzbmV3OiBzZWxmLmlzTmV3RmVhdHVyZShmZWF0dXJlLmdldElkKCkpLFxuICAgICAgICBmaWVsZHM6IGZpZWxkcyxcbiAgICAgICAgcmVsYXRpb25zOiByZWxhdGlvbnMsXG4gICAgICAgIGJ1dHRvbnM6W1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIHRpdGxlOiBcIlNhbHZhXCIsXG4gICAgICAgICAgICB0eXBlOiBcInNhdmVcIixcbiAgICAgICAgICAgIGNsYXNzOiBcImJ0bi1kYW5nZXJcIixcbiAgICAgICAgICAgIGNiazogZnVuY3Rpb24oZmllbGRzLHJlbGF0aW9ucyl7XG4gICAgICAgICAgICAgIHNlbGYuc2V0RmllbGRzV2l0aEF0dHJpYnV0ZXMoZmVhdHVyZSxmaWVsZHMscmVsYXRpb25zKTtcbiAgICAgICAgICAgICAgaWYgKG5leHQpe1xuICAgICAgICAgICAgICAgIG5leHQodHJ1ZSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHRpdGxlOiBcIkNhbmNlbGxhXCIsXG4gICAgICAgICAgICB0eXBlOiBcImNhbmNlbFwiLFxuICAgICAgICAgICAgY2xhc3M6IFwiYnRuLXByaW1hcnlcIixcbiAgICAgICAgICAgIGNiazogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgaWYgKG5leHQpe1xuICAgICAgICAgICAgICAgIG5leHQoZmFsc2UpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICBdXG4gICAgICB9KTtcbiAgICAgIEdVSS5zaG93Rm9ybShmb3JtLHtcbiAgICAgICAgbW9kYWw6IHRydWUsXG4gICAgICAgIGNsb3NhYmxlOiBmYWxzZVxuICAgICAgfSk7XG4gICAgfSlcbiAgICAuZmFpbChmdW5jdGlvbigpe1xuICAgICAgaWYgKG5leHQpe1xuICAgICAgICBuZXh0KGZhbHNlKTtcbiAgICAgIH1cbiAgICB9KVxuICB9O1xufVxuaW5oZXJpdChJdGVybmV0RWRpdG9yLEVkaXRvcik7XG5tb2R1bGUuZXhwb3J0cyA9IEl0ZXJuZXRFZGl0b3I7XG5cbnZhciBwcm90byA9IEl0ZXJuZXRFZGl0b3IucHJvdG90eXBlO1xuXG5wcm90by5zdGFydCA9IGZ1bmN0aW9uKCl7XG4gIHZhciByZXQgPSBFZGl0b3IucHJvdG90eXBlLnN0YXJ0LmNhbGwodGhpcyk7XG4gIHRoaXMuX3NldHVwQWRkRmVhdHVyZUF0dHJpYnV0ZXNFZGl0aW5nTGlzdGVuZXJzKCk7XG4gIHRoaXMuX3NldHVwRWRpdEF0dHJpYnV0ZXNMaXN0ZW5lcnMoKTtcbiAgdGhpcy5fYXNrQ29uZmlybVRvRGVsZXRlRWRpdGluZ0xpc3RlbmVyKCk7XG4gIHJldHVybiByZXQ7XG59O1xuIiwidmFyIGluaGVyaXQgPSByZXF1aXJlKCdnM3cvY29yZS91dGlscycpLmluaGVyaXQ7XG52YXIgYmFzZSA9IHJlcXVpcmUoJ2czdy9jb3JlL3V0aWxzJykuYmFzZTtcbnZhciBNYXBTZXJ2aWNlID0gcmVxdWlyZSgnZzN3L2NvcmUvbWFwc2VydmljZScpO1xudmFyIEdVSSA9IHJlcXVpcmUoJ2czdy9ndWkvZ3VpJyk7XG52YXIgSXRlcm5ldEVkaXRvciA9IHJlcXVpcmUoJy4vaXRlcm5ldGVkaXRvcicpO1xuXG5mdW5jdGlvbiBTdHJhZGVFZGl0b3Iob3B0aW9ucyl7XG4gIGJhc2UodGhpcyxvcHRpb25zKTtcbiAgXG4gIHRoaXMuX3NlcnZpY2UgPSBudWxsO1xuICB0aGlzLl9naXVuemlvbmlFZGl0b3IgPSBudWxsO1xuICBcbiAgdGhpcy5fc3RyYWRlU25hcHMgPSBudWxsO1xuICBcbiAgdGhpcy5fc3RyYWRlU25hcHNDb2xsZWN0aW9uID0gZnVuY3Rpb24oKXtcbiAgICB2YXIgc25hcHMgPSBbXTtcbiAgICB0aGlzLmxlbmd0aCA9IDA7XG4gICAgXG4gICAgdGhpcy5wdXNoID0gZnVuY3Rpb24oZmVhdHVyZSl7XG4gICAgICB2YXIgcHVzaGVkID0gZmFsc2U7XG4gICAgICBpZiAodGhpcy5jYW5TbmFwKGZlYXR1cmUpKXtcbiAgICAgICAgc25hcHMucHVzaChmZWF0dXJlKTtcbiAgICAgICAgdGhpcy5sZW5ndGggKz0gMTtcbiAgICAgICAgcHVzaGVkID0gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBwdXNoZWQ7XG4gICAgfTtcbiAgICBcbiAgICB0aGlzLmdldExhc3QgPSBmdW5jdGlvbigpe1xuICAgICAgcmV0dXJuIHNuYXBzW3NuYXBzLmxlbmd0aC0xXTtcbiAgICB9O1xuICAgIFxuICAgIHRoaXMuZ2V0Rmlyc3QgPSBmdW5jdGlvbigpe1xuICAgICAgcmV0dXJuIHNuYXBzWzBdO1xuICAgIH07XG4gICAgXG4gICAgdGhpcy5jbGVhciA9IGZ1bmN0aW9uKCl7XG4gICAgICBzbmFwcy5zcGxpY2UoMCxzbmFwcy5sZW5ndGgpO1xuICAgICAgdGhpcy5sZW5ndGggPSAwO1xuICAgIH07XG4gICAgXG4gICAgdGhpcy5nZXRTbmFwcyA9IGZ1bmN0aW9uKCl7XG4gICAgICByZXR1cm4gc25hcHM7XG4gICAgfTtcbiAgICBcbiAgICB0aGlzLmNhblNuYXAgPSBmdW5jdGlvbihmZWF0dXJlKXtcbiAgICAgIGlmICh0aGlzLmlzQWxyZWFkeVNuYXBwZWQoZmVhdHVyZSkpe1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgICB2YXIgY29kX2dueiA9IGZlYXR1cmUuZ2V0KCdjb2RfZ256Jyk7XG4gICAgICByZXR1cm4gKCFfLmlzTmlsKGNvZF9nbnopICYmIGNvZF9nbnogIT0gJycpO1xuICAgIH07XG4gICAgXG4gICAgdGhpcy5pc0FscmVhZHlTbmFwcGVkID0gZnVuY3Rpb24oZmVhdHVyZSl7XG4gICAgICByZXR1cm4gXy5pbmNsdWRlcyh0aGlzLnNuYXBzLGZlYXR1cmUpO1xuICAgIH1cbiAgfTtcbiAgXG4gIHRoaXMuX3VwZGF0ZVN0cmFkYUF0dHJpYnV0ZXMgPSBmdW5jdGlvbihmZWF0dXJlKXtcbiAgICB2YXIgc25hcHMgPSB0aGlzLl9zdHJhZGVTbmFwcztcbiAgICBmZWF0dXJlLnNldCgnbm9kX2luaScsc25hcHMuZ2V0U25hcHMoKVswXS5nZXQoJ2NvZF9nbnonKSk7XG4gICAgZmVhdHVyZS5zZXQoJ25vZF9maW4nLHNuYXBzLmdldFNuYXBzKClbMV0uZ2V0KCdjb2RfZ256JykpO1xuICB9O1xuICBcbiAgLyogQ09OVFJPTExPIEdJVU5aSU9OSSBQRVIgTEUgU1RSQURFIE5PTiBDT01QTEVUQU1FTlRFIENPTlRFTlVURSBORUxMQSBWSVNUQSAqL1xuICBcbiAgLy8gcGVyIGxlIHN0cmFkZSBwcmVzZW50aSBuZWxsYSB2aXN0YSBjYXJpY2EgbGUgZ2l1bnppb25pIGV2ZW50dWFsbWVudGUgbWFuY2FudGkgKGVzdGVybmUgYWxsYSB2aXN0YSlcbiAgdGhpcy5fbG9hZE1pc3NpbmdHaXVuemlvbmlJblZpZXcgPSBmdW5jdGlvbigpe1xuICAgIHZhciB2ZWN0b3JMYXllciA9IHRoaXMuZ2V0VmVjdG9yTGF5ZXIoKTtcbiAgICB2YXIgZ2l1bnppb25pVmVjdG9yTGF5ZXIgPSB0aGlzLl9naXVuemlvbmlFZGl0b3IuZ2V0VmVjdG9yTGF5ZXIoKTtcbiAgICBcbiAgICB2YXIgc3RyYWRlU291cmNlID0gdmVjdG9yTGF5ZXIuZ2V0U291cmNlKCk7XG4gICAgdmFyIGV4dGVudCA9IG9sLmV4dGVudC5idWZmZXIoc3RyYWRlU291cmNlLmdldEV4dGVudCgpLDEpO1xuICAgIHRoaXMuX3NlcnZpY2UuX2xvYWRWZWN0b3JEYXRhKGdpdW56aW9uaVZlY3RvckxheWVyLGV4dGVudCk7XG4gIH07XG4gIFxuICAvKiBGSU5FICovXG4gIFxuICAvKiBJTklaSU8gR0VTVElPTkUgVklOQ09MTyBTTkFQIFNVIEdJVU5aSU9OSSBEVVJBTlRFIElMIERJU0VHTk8gREVMTEUgU1RSQURFICovXG4gIFxuICB0aGlzLl9kcmF3UmVtb3ZlTGFzdFBvaW50ID0gXy5iaW5kKGZ1bmN0aW9uKGUpe1xuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICB2YXIgdG9vbFR5cGUgPSB0aGlzLmdldEFjdGl2ZVRvb2woKS5nZXRUeXBlKCk7XG4gICAgLy8gaWwgbGlzdGVuZXIgdmllbmUgYXR0aXZhdG8gcGVyIHR1dHRpIGkgdG9vbCBkZWxsJ2VkaXRvciBzdHJhZGUsIHBlciBjdWkgZGV2byBjb250cm9sbGFyZSBjaGUgc2lhIHF1ZWxsbyBnaXVzdG9cbiAgICBpZiAodG9vbFR5cGUgPT0gJ2FkZGZlYXR1cmUnKXtcbiAgICAgIC8vIENBTkNcbiAgICAgIGlmKGUua2V5Q29kZT09NDYpe1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgIHNlbGYuZ2V0QWN0aXZlVG9vbCgpLmdldFRvb2woKS5yZW1vdmVMYXN0UG9pbnQoKTtcbiAgICAgIH1cbiAgICB9XG4gIH0sdGhpcyk7XG4gIFxuICB0aGlzLl9zZXR1cERyYXdTdHJhZGVDb25zdHJhaW50cyA9IGZ1bmN0aW9uKCl7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIHZhciBtYXBJZCA9IE1hcFNlcnZpY2Uudmlld2VyLm1hcC5nZXRUYXJnZXRFbGVtZW50KCkuaWQ7XG4gICAgdmFyIG1hcCA9IE1hcFNlcnZpY2Uudmlld2VyLm1hcDtcbiAgICBcbiAgICB2YXIgZHJhd2luZ0dlb21ldHJ5ID0gbnVsbDtcbiAgICBcbiAgICB0aGlzLm9uYmVmb3JlKCdhZGRGZWF0dXJlJyxmdW5jdGlvbihmZWF0dXJlKXtcbiAgICAgIHZhciBzbmFwcyA9IHNlbGYuX3N0cmFkZVNuYXBzO1xuICAgICAgaWYgKHNuYXBzLmxlbmd0aCA9PSAyKXtcbiAgICAgICAgc2VsZi5fdXBkYXRlU3RyYWRhQXR0cmlidXRlcyhmZWF0dXJlKTtcbiAgICAgICAgc25hcHMuY2xlYXIoKTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSk7XG4gIH07XG4gIFxuICB0aGlzLl9nZXRDaGVja1NuYXBzQ29uZGl0aW9uID0gZnVuY3Rpb24oKXtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgLy8gYWQgb2duaSBjbGljayBjb250cm9sbG8gc2UgY2kgc29ubyBkZWdsaSBzbmFwIGNvbiBsZSBnaXVuemlvbmlcbiAgICByZXR1cm4gZnVuY3Rpb24oZSl7XG4gICAgICB2YXIgc25hcHMgPSBzZWxmLl9zdHJhZGVTbmFwcztcbiAgICAgIGlmIChzbmFwcy5sZW5ndGggPT0gMil7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgICAgR1VJLm5vdGlmeS5lcnJvcihcIkwndWx0aW1vIHZlcnRpY2UgZGV2ZSBjb3JyaXNwb25kZXJlIGNvbiB1bmEgZ2l1bnppb25lXCIpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfTtcbiAgXG4gIC8vIGFkIG9nbmkgY2xpY2sgY29udHJvbGxvIHNlIGNpIHNvbm8gZGVnbGkgc25hcCBjb24gbGUgZ2l1bnppb25pXG4gIHRoaXMuX2dldFN0cmFkYUlzQmVpbmdTbmFwcGVkQ29uZGl0aW9uID0gZnVuY3Rpb24oKXtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgdmFyIG1hcCA9IE1hcFNlcnZpY2Uudmlld2VyLm1hcDtcbiAgICB2YXIgZ2l1bnppb25pVmVjdG9yTGF5ZXIgPSB0aGlzLl9naXVuemlvbmlFZGl0b3IuZ2V0VmVjdG9yTGF5ZXIoKTtcbiAgICBcbiAgICByZXR1cm4gZnVuY3Rpb24oZSl7XG4gICAgICB2YXIgc25hcHMgPSBzZWxmLl9zdHJhZGVTbmFwcztcbiAgICAgIHZhciBjID0gbWFwLmdldENvb3JkaW5hdGVGcm9tUGl4ZWwoZS5waXhlbCk7XG4gICAgICB2YXIgZ2l1bnppb25pU291cmNlID0gZ2l1bnppb25pVmVjdG9yTGF5ZXIuZ2V0U291cmNlKCk7XG4gICAgICB2YXIgZXh0ZW50ID0gb2wuZXh0ZW50LmJ1ZmZlcihbY1swXSxjWzFdLGNbMF0sY1sxXV0sMSk7XG4gICAgICB2YXIgc25hcHBlZEZlYXR1cmUgPSBnaXVuemlvbmlTb3VyY2UuZ2V0RmVhdHVyZXNJbkV4dGVudChleHRlbnQpWzBdO1xuICAgICAgXG4gICAgICAvLyBzZSBobyBnacOgIGR1ZSBzbmFwIGUgcXVlc3RvIGNsaWNrIG5vbiDDqCBzdSB1bidhbHRyYSBnaXVuemlvbmUsIG9wcHVyZSBzZSBobyBwacO5IGRpIDIgc25hcCwgbm9uIHBvc3NvIGluc2VyaXJlIHVuIHVsdGVyaW9yZSB2ZXJ0aWNlXG4gICAgICBpZiAoKHNuYXBzLmxlbmd0aCA9PSAyICYmICghc25hcHBlZEZlYXR1cmUgfHwgc25hcHBlZEZlYXR1cmUgIT0gc25hcHMuZ2V0U25hcHMoKVsxXSkpKXtcbiAgICAgICAgdmFyIGxhc3RTbmFwcGVkXG4gICAgICAgIEdVSS5ub3RpZnkuZXJyb3IoXCJVbmEgc3RyYWRhIG5vbiBwdcOyIGF2ZXJlIHZlcnRpY2kgaW50ZXJtZWRpIGluIGNvcnJpc3BvbmRlbnphIGRpIGdpdW56aW9uaS48YnI+IFByZW1lcmUgPGI+Q0FOQzwvYj4gcGVyIHJpbXVvdmVyZSBsJ3VsdGltbyB2ZXJ0aWNlLlwiKTtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgICAgXG4gICAgICBpZiAoc25hcHBlZEZlYXR1cmUgJiYgc25hcHMubGVuZ3RoIDwgMil7XG4gICAgICAgIHNuYXBzLnB1c2goc25hcHBlZEZlYXR1cmUpO1xuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBzZSBub24gY2kgc29ubyBzbmFwLCB2dW9sIGRpcmUgY2hlIHNvbm8gYW5jb3JhIGFsIHByaW1vIGNsaWNrIGUgbm9uIGhvIHNuYXBwYXRvIGNvbiBsYSBnaXVuemlvbmUgaW5pemlhbGVcbiAgICAgIGlmIChzbmFwcy5sZW5ndGggPT0gMCl7XG4gICAgICAgIEdVSS5ub3RpZnkuZXJyb3IoXCJJbCBwcmltbyB2ZXJ0aWNlIGRldmUgY29ycmlzcG9uZGVyZSBjb24gdW5hIGdpdW56aW9uZVwiKTtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICB9O1xuICBcbiAgLyogRklORSBESVNFR05PICovXG4gIFxuICAvKiBJTklaSU8gQ09OVFJPTExJIFNVIE1PRElGSUNBICovXG4gIFxuICB0aGlzLl9tb2RpZnlSZW1vdmVQb2ludCA9IF8uYmluZChmdW5jdGlvbihlKXtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgdmFyIHRvb2xUeXBlID0gdGhpcy5nZXRBY3RpdmVUb29sKCkuZ2V0VHlwZSgpO1xuICAgIGlmICh0b29sVHlwZSA9PSAnbW9kaWZ5dmVydGV4Jyl7XG4gICAgICBpZihlLmtleUNvZGU9PTQ2KXtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICBzZWxmLmdldEFjdGl2ZVRvb2woKS5nZXRUb29sKCkucmVtb3ZlUG9pbnQoKTtcbiAgICAgIH1cbiAgICB9XG4gIH0sdGhpcyk7XG4gIFxuICB0aGlzLl9zZXR1cE1vZGlmeVZlcnRleFN0cmFkZUNvbnN0cmFpbnRzID0gZnVuY3Rpb24oKXtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgdmFyIG1hcCA9IE1hcFNlcnZpY2Uudmlld2VyLm1hcDtcbiAgICB0aGlzLm9uYmVmb3JlKCdtb2RpZnlGZWF0dXJlJyxmdW5jdGlvbihmZWF0dXJlKXtcbiAgICAgIHZhciBzbmFwcyA9IHNlbGYuX3N0cmFkZVNuYXBzO1xuICAgICAgdmFyIGNvcnJlY3QgPSBzZWxmLl9jaGVja1N0cmFkYUlzQ29ycmVjdGx5U25hcHBlZChmZWF0dXJlLmdldEdlb21ldHJ5KCkpO1xuICAgICAgaWYgKGNvcnJlY3Qpe1xuICAgICAgICBzZWxmLl91cGRhdGVTdHJhZGFBdHRyaWJ1dGVzKGZlYXR1cmUpO1xuICAgICAgICBzbmFwcy5jbGVhcigpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGNvcnJlY3Q7XG4gICAgfSk7XG4gIH07XG4gIFxuICB0aGlzLl9jaGVja1N0cmFkYUlzQ29ycmVjdGx5U25hcHBlZCA9IGZ1bmN0aW9uKGdlb21ldHJ5KXtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgdmFyIHJldCA9IHRydWU7XG4gICAgdmFyIG1hcCA9IE1hcFNlcnZpY2Uudmlld2VyLm1hcDtcbiAgICB2YXIgZ2l1bnppb25pVmVjdG9yTGF5ZXIgPSB0aGlzLl9naXVuemlvbmlFZGl0b3IuZ2V0VmVjdG9yTGF5ZXIoKTtcbiAgICB0aGlzLl9zdHJhZGVTbmFwcy5jbGVhcigpO1xuICAgIHZhciBzbmFwcyA9IHRoaXMuX3N0cmFkZVNuYXBzO1xuICAgIHZhciBjb29yZGluYXRlcyA9IGdlb21ldHJ5LmdldENvb3JkaW5hdGVzKCk7XG4gICAgXG4gICAgdmFyIGZpcnN0VmVydGV4U25hcHBlZCA9IGZhbHNlO1xuICAgIHZhciBsYXN0VmVydGV4U25hcHBlZCA9IGZhbHNlO1xuICAgIFxuICAgIF8uZm9yRWFjaChjb29yZGluYXRlcyxmdW5jdGlvbihjLGluZGV4KXsgICAgICBcbiAgICAgIHZhciBnaXVuemlvbmlTb3VyY2UgPSBnaXVuemlvbmlWZWN0b3JMYXllci5nZXRTb3VyY2UoKTtcbiAgICAgIFxuICAgICAgdmFyIGV4dGVudCA9IG9sLmV4dGVudC5idWZmZXIoW2NbMF0sY1sxXSxjWzBdLGNbMV1dLDAuMSk7XG4gICAgICBcbiAgICAgIHZhciBzbmFwcGVkRmVhdHVyZSA9IGdpdW56aW9uaVNvdXJjZS5nZXRGZWF0dXJlc0luRXh0ZW50KGV4dGVudClbMF07XG4gICAgICBcbiAgICAgIGlmIChzbmFwcGVkRmVhdHVyZSl7XG4gICAgICAgIGlmIChpbmRleCA9PSAwICYmIHNuYXBzLnB1c2goc25hcHBlZEZlYXR1cmUpKXtcbiAgICAgICAgICBmaXJzdFZlcnRleFNuYXBwZWQgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGluZGV4ID09IChjb29yZGluYXRlcy5sZW5ndGgtMSkgJiYgc25hcHMucHVzaChzbmFwcGVkRmVhdHVyZSkpe1xuICAgICAgICAgIGxhc3RWZXJ0ZXhTbmFwcGVkID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgIH1cbiAgICB9KTtcbiAgICBcbiAgICBpZiAoc25hcHMubGVuZ3RoID4gMil7XG4gICAgICBHVUkubm90aWZ5LmVycm9yKFwiVW5hIHN0cmFkYSBub24gcHXDsiBhdmVyZSB2ZXJ0aWNpIGludGVybWVkaSBpbiBjb3JyaXNwb25kZW56YSBkaSBnaXVuemlvbmlcIik7XG4gICAgICByZXQgPSBmYWxzZTtcbiAgICB9XG4gICAgXG4gICAgaWYgKCFmaXJzdFZlcnRleFNuYXBwZWQpe1xuICAgICAgR1VJLm5vdGlmeS5lcnJvcihcIklsIHByaW1vIHZlcnRpY2UgZGV2ZSBjb3JyaXNwb25kZXJlIGNvbiB1bmEgZ2l1bnppb25lXCIpO1xuICAgICAgcmV0ID0gZmFsc2U7XG4gICAgfVxuICAgIFxuICAgIGlmICghbGFzdFZlcnRleFNuYXBwZWQpe1xuICAgICAgR1VJLm5vdGlmeS5lcnJvcihcIkwndWx0aW1vIHZlcnRpY2UgZGV2ZSBjb3JyaXNwb25kZXJlIGNvbiB1bmEgZ2l1bnppb25lXCIpO1xuICAgICAgcmV0ID0gZmFsc2U7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG4gIH07XG4gIFxuICAvKiBGSU5FIE1PRElGSUNBICovXG4gIFxuICAvKiBJTklaSU8gVEFHTElPICovXG4gIFxuICB0aGlzLl9zZXR1cFN0cmFkZUN1dHRlclBvc3RTZWxlY3Rpb24gPSBmdW5jdGlvbigpe1xuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICB0aGlzLm9uYmVmb3JlYXN5bmMoJ2N1dExpbmUnLGZ1bmN0aW9uKGRhdGEsbW9kVHlwZSxuZXh0KXtcbiAgICAgIGlmIChtb2RUeXBlID09ICdNT0RPTkNVVCcpe1xuICAgICAgICAvLyBsYSBwcmltYSBmZWF0dXJlIGluIGRhdGEuYWRkIMOoIHF1ZWxsYSBkYSBhZ2dpdW5nZXJlIGNvbWUgbnVvdmFcbiAgICAgICAgdmFyIG5ld0ZlYXR1cmUgPSBkYXRhLmFkZGVkWzBdO1xuICAgICAgICB2YXIgbmV3RmVhdHVyZVNuYXBzID0gc2VsZi5fZ2V0Rmlyc3RMYXN0U25hcHBlZEdpdW56aW9uaShuZXdGZWF0dXJlLmdldEdlb21ldHJ5KCkpO1xuICAgICAgICBuZXdGZWF0dXJlLnNldCgnbm9kX2luaScsbmV3RmVhdHVyZVNuYXBzWzBdLmdldCgnY29kX2dueicpKTtcbiAgICAgICAgbmV3RmVhdHVyZS5zZXQoJ25vZF9maW4nLG5ld0ZlYXR1cmVTbmFwc1sxXS5nZXQoJ2NvZF9nbnonKSk7XG4gICAgICAgIFxuICAgICAgICB2YXIgdXBkYXRlRmVhdHVyZSA9IGRhdGEudXBkYXRlZDtcbiAgICAgICAgdmFyIHVwZGF0ZUZlYXR1cmVTbmFwcyA9IHNlbGYuX2dldEZpcnN0TGFzdFNuYXBwZWRHaXVuemlvbmkodXBkYXRlRmVhdHVyZS5nZXRHZW9tZXRyeSgpKTtcbiAgICAgICAgdXBkYXRlRmVhdHVyZS5zZXQoJ25vZF9pbmknLHVwZGF0ZUZlYXR1cmVTbmFwc1swXS5nZXQoJ2NvZF9nbnonKSk7XG4gICAgICAgIHVwZGF0ZUZlYXR1cmUuc2V0KCdub2RfZmluJyx1cGRhdGVGZWF0dXJlU25hcHNbMV0uZ2V0KCdjb2RfZ256JykpO1xuICAgICAgICBcbiAgICAgICAgc2VsZi5fb3BlbkVkaXRvckZvcm0oJ25ldycsbmV3RmVhdHVyZSxuZXh0KTtcbiAgICAgICAgXG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgbmV4dCh0cnVlKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfTtcbiAgXG4gIHRoaXMuX2dldEZpcnN0TGFzdFNuYXBwZWRHaXVuemlvbmkgPSBmdW5jdGlvbihnZW9tZXRyeSl7XG4gICAgdmFyIGNvb3JkaW5hdGVzID0gZ2VvbWV0cnkuZ2V0Q29vcmRpbmF0ZXMoKTtcbiAgICB2YXIgZ2l1bnppb25pVmVjdG9yTGF5ZXIgPSB0aGlzLl9naXVuemlvbmlFZGl0b3IuZ2V0VmVjdG9yTGF5ZXIoKTtcbiAgICB2YXIgZmlyc3RWZXJ0ZXhTbmFwcGVkID0gbnVsbDtcbiAgICB2YXIgbGFzdFZlcnRleFNuYXBwZWQgPSBudWxsO1xuICAgIFxuICAgIF8uZm9yRWFjaChjb29yZGluYXRlcyxmdW5jdGlvbihjLGluZGV4KXsgICAgICBcbiAgICAgIHZhciBnaXVuemlvbmlTb3VyY2UgPSBnaXVuemlvbmlWZWN0b3JMYXllci5nZXRTb3VyY2UoKTtcbiAgICAgIFxuICAgICAgdmFyIGV4dGVudCA9IG9sLmV4dGVudC5idWZmZXIoW2NbMF0sY1sxXSxjWzBdLGNbMV1dLDAuMSk7XG4gICAgICBcbiAgICAgIHZhciBzbmFwcGVkRmVhdHVyZSA9IGdpdW56aW9uaVNvdXJjZS5nZXRGZWF0dXJlc0luRXh0ZW50KGV4dGVudClbMF07XG4gICAgICBcbiAgICAgIGlmIChzbmFwcGVkRmVhdHVyZSl7XG4gICAgICAgIGlmIChpbmRleCA9PSAwKXtcbiAgICAgICAgICBmaXJzdFZlcnRleFNuYXBwZWQgPSBzbmFwcGVkRmVhdHVyZTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChpbmRleCA9PSAoY29vcmRpbmF0ZXMubGVuZ3RoLTEpKXtcbiAgICAgICAgICBsYXN0VmVydGV4U25hcHBlZCA9IHNuYXBwZWRGZWF0dXJlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuIFtmaXJzdFZlcnRleFNuYXBwZWQsbGFzdFZlcnRleFNuYXBwZWRdO1xuICB9XG4gIFxuICAvKiBGSU5FIFRBR0xJTyAqL1xufTtcbmluaGVyaXQoU3RyYWRlRWRpdG9yLEl0ZXJuZXRFZGl0b3IpO1xubW9kdWxlLmV4cG9ydHMgPSBTdHJhZGVFZGl0b3I7XG5cbnZhciBwcm90byA9IFN0cmFkZUVkaXRvci5wcm90b3R5cGU7XG5cbnByb3RvLnN0YXJ0ID0gZnVuY3Rpb24oaXRlcm5ldFNlcnZpY2Upe1xuICB0aGlzLl9zZXJ2aWNlID0gaXRlcm5ldFNlcnZpY2U7XG4gIHRoaXMuX2dpdW56aW9uaUVkaXRvciA9IGl0ZXJuZXRTZXJ2aWNlLl9sYXllcnNbaXRlcm5ldFNlcnZpY2UubGF5ZXJDb2Rlcy5HSVVOWklPTkldLmVkaXRvcjtcbiAgXG4gIHRoaXMuX2xvYWRNaXNzaW5nR2l1bnppb25pSW5WaWV3KCk7XG4gIHRoaXMuX3NldHVwRHJhd1N0cmFkZUNvbnN0cmFpbnRzKCk7XG4gIHRoaXMuX3NldHVwTW9kaWZ5VmVydGV4U3RyYWRlQ29uc3RyYWludHMoKTtcbiAgdGhpcy5fc2V0dXBTdHJhZGVDdXR0ZXJQb3N0U2VsZWN0aW9uKCk7XG4gICAgICAgIFxuICByZXR1cm4gSXRlcm5ldEVkaXRvci5wcm90b3R5cGUuc3RhcnQuY2FsbCh0aGlzKTtcbn07XG5cbnByb3RvLnNldFRvb2wgPSBmdW5jdGlvbih0b29sVHlwZSl7XG4gIHZhciBnaXVuemlvbmlWZWN0b3JMYXllciA9IHRoaXMuX2dpdW56aW9uaUVkaXRvci5nZXRWZWN0b3JMYXllcigpO1xuICB2YXIgc3RlcHNJbmZvID0gW107XG4gIHZhciBvcHRpb25zO1xuICBpZiAodG9vbFR5cGU9PSdhZGRmZWF0dXJlJyl7XG4gICAgb3B0aW9ucyA9IHtcbiAgICAgIHNuYXA6IHtcbiAgICAgICAgdmVjdG9yTGF5ZXI6IGdpdW56aW9uaVZlY3RvckxheWVyXG4gICAgICB9LFxuICAgICAgZmluaXNoQ29uZGl0aW9uOiB0aGlzLl9nZXRDaGVja1NuYXBzQ29uZGl0aW9uKCksXG4gICAgICBjb25kaXRpb246IHRoaXMuX2dldFN0cmFkYUlzQmVpbmdTbmFwcGVkQ29uZGl0aW9uKClcbiAgICB9XG4gIH1cbiAgaWYgKHRvb2xUeXBlPT0nbW9kaWZ5dmVydGV4Jyl7XG4gICAgb3B0aW9ucyA9IHtcbiAgICAgIHNuYXA6IHtcbiAgICAgICAgdmVjdG9yTGF5ZXI6IGdpdW56aW9uaVZlY3RvckxheWVyXG4gICAgICB9LFxuICAgICAgZGVsZXRlQ29uZGl0aW9uOiBfLmNvbnN0YW50KGZhbHNlKVxuICAgIH1cbiAgfVxuICBpZiAodG9vbFR5cGU9PSdjdXRsaW5lJyl7XG4gICAgb3B0aW9ucyA9IHtcbiAgICAgIHBvaW50TGF5ZXI6IGdpdW56aW9uaVZlY3RvckxheWVyLmdldExheWVyKClcbiAgICB9XG4gIH1cbiAgXG4gIHZhciBzdGFydCA9ICBJdGVybmV0RWRpdG9yLnByb3RvdHlwZS5zZXRUb29sLmNhbGwodGhpcyx0b29sVHlwZSxvcHRpb25zKTtcbiAgXG4gIGlmIChzdGFydCl7XG4gICAgLy90aGlzLnRvb2xQcm9ncmVzcy5zZXRTdGVwc0luZm8oc3RlcHNJbmZvKTtcbiAgICB0aGlzLl9zdHJhZGVTbmFwcyA9IG5ldyB0aGlzLl9zdHJhZGVTbmFwc0NvbGxlY3Rpb247XG4gICAgJCgnYm9keScpLmtleXVwKHRoaXMuX2RyYXdSZW1vdmVMYXN0UG9pbnQpO1xuICAgICQoJ2JvZHknKS5rZXl1cCh0aGlzLl9tb2RpZnlSZW1vdmVQb2ludCk7XG4gIH07XG4gIFxuICByZXR1cm4gc3RhcnQ7XG59O1xuXG5wcm90by5zdG9wVG9vbCA9IGZ1bmN0aW9uKCl7XG4gIHZhciBzdG9wID0gZmFsc2U7XG4gIHN0b3AgPSBJdGVybmV0RWRpdG9yLnByb3RvdHlwZS5zdG9wVG9vbC5jYWxsKHRoaXMpO1xuICBcbiAgaWYgKHN0b3Ape1xuICAgIHRoaXMuX3N0cmFkZVNuYXBzID0gbnVsbDtcbiAgICAkKCdib2R5Jykub2ZmKCdrZXl1cCcsdGhpcy5fZHJhd1JlbW92ZUxhc3RQb2ludCk7XG4gICAgJCgnYm9keScpLm9mZigna2V5dXAnLHRoaXMuX21vZGlmeVJlbW92ZVBvaW50KTtcbiAgfVxuICBcbiAgcmV0dXJuIHN0b3A7IFxufTtcbiIsInZhciBpbmhlcml0ID0gcmVxdWlyZSgnZzN3L2NvcmUvdXRpbHMnKS5pbmhlcml0O1xudmFyIHJlc29sdmVkVmFsdWUgPSByZXF1aXJlKCdnM3cvY29yZS91dGlscycpLnJlc29sdmVkVmFsdWU7XG52YXIgcmVqZWN0ZWRWYWx1ZSA9IHJlcXVpcmUoJ2czdy9jb3JlL3V0aWxzJykucmVqZWN0ZWRWYWx1ZTtcbnZhciBHM1dPYmplY3QgPSByZXF1aXJlKCdnM3cvY29yZS9nM3dvYmplY3QnKTtcbnZhciBQcm9qZWN0U2VydmljZSA9IHJlcXVpcmUoJ2czdy9jb3JlL3Byb2plY3RzZXJ2aWNlJyk7XG52YXIgTWFwU2VydmljZSA9IHJlcXVpcmUoJ2czdy9jb3JlL21hcHNlcnZpY2UnKTtcbnZhciBWZWN0b3JMYXllciA9IHJlcXVpcmUoJ2czdy9jb3JlL3ZlY3RvcmxheWVyJyk7XG5cbnZhciBHVUkgPSByZXF1aXJlKCdnM3cvZ3VpL2d1aScpO1xuXG52YXIgQWNjZXNzaUVkaXRvciA9IHJlcXVpcmUoJy4vZWRpdG9ycy9hY2Nlc3NpZWRpdG9yJyk7XG52YXIgR2l1bnppb25pRWRpdG9yID0gcmVxdWlyZSgnLi9lZGl0b3JzL2dpdW56aW9uaWVkaXRvcicpO1xudmFyIFN0cmFkZUVkaXRvciA9IHJlcXVpcmUoJy4vZWRpdG9ycy9zdHJhZGVlZGl0b3InKTtcblxudmFyIHRvb2xTdGVwc01lc3NhZ2VzID0ge1xuICAnY3V0bGluZSc6IFtcbiAgICBcIlNlbGV6aW9uYSBsYSBzdHJhZGEgZGEgdGFnbGlhcmVcIixcbiAgICBcIlNlbGV6aW9uYSBsYSBnaXVuemlvbmUgZGkgdGFnbGlvXCIsXG4gICAgXCJTZWxlemlvbmEgbGEgcG9yaXppb25lIGRpIHN0cmFkYSBvcmlnaW5hbGUgZGEgbWFudGVuZXJlXCJcbiAgXVxufVxuXG5mdW5jdGlvbiBJdGVybmV0U2VydmljZSgpe1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIFxuICB0aGlzLl9ydW5uaW5nRWRpdG9yID0gbnVsbDtcbiAgXG4gIHZhciBsYXllckNvZGVzID0gdGhpcy5sYXllckNvZGVzID0ge1xuICAgIFNUUkFERTogJ3N0cmFkZScsXG4gICAgR0lVTlpJT05JOiAnZ2l1bnppb25pJyxcbiAgICBBQ0NFU1NJOiAnYWNjZXNzaScgXG4gIH07XG4gIFxuICB0aGlzLl9lZGl0b3JDbGFzc2VzID0ge307XG4gIHRoaXMuX2VkaXRvckNsYXNzZXNbbGF5ZXJDb2Rlcy5BQ0NFU1NJXSA9IEFjY2Vzc2lFZGl0b3I7XG4gIHRoaXMuX2VkaXRvckNsYXNzZXNbbGF5ZXJDb2Rlcy5HSVVOWklPTkldID0gR2l1bnppb25pRWRpdG9yO1xuICB0aGlzLl9lZGl0b3JDbGFzc2VzW2xheWVyQ29kZXMuU1RSQURFXSA9IFN0cmFkZUVkaXRvcjtcbiAgXG4gIHRoaXMuX2xheWVycyA9IHt9O1xuICB0aGlzLl9sYXllcnNbbGF5ZXJDb2Rlcy5BQ0NFU1NJXSA9IHtcbiAgICBsYXllckNvZGU6IGxheWVyQ29kZXMuQUNDRVNTSSxcbiAgICB2ZWN0b3I6IG51bGwsXG4gICAgZWRpdG9yOiBudWxsLFxuICAgIHN0eWxlOiBmdW5jdGlvbihmZWF0dXJlKXtcbiAgICAgIHZhciBjb2xvciA9ICcjZDliNTgxJztcbiAgICAgIHN3aXRjaCAoZmVhdHVyZS5nZXQoJ3RpcF9hY2MnKSl7XG4gICAgICAgIGNhc2UgXCIwMTAxXCI6XG4gICAgICAgICAgY29sb3IgPSAnI2Q5YjU4MSc7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCIwMTAyXCI6XG4gICAgICAgICAgY29sb3IgPSAnI2Q5YmMyOSc7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCIwNTAxXCI6XG4gICAgICAgICAgY29sb3IgPSAnIzY4YWFkOSc7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgY29sb3IgPSAnI2Q5YjU4MSc7XG4gICAgICB9XG4gICAgICByZXR1cm4gW1xuICAgICAgICBuZXcgb2wuc3R5bGUuU3R5bGUoe1xuICAgICAgICAgIGltYWdlOiBuZXcgb2wuc3R5bGUuQ2lyY2xlKHtcbiAgICAgICAgICAgIHJhZGl1czogNSxcbiAgICAgICAgICAgIGZpbGw6IG5ldyBvbC5zdHlsZS5GaWxsKHtcbiAgICAgICAgICAgICAgY29sb3I6IGNvbG9yXG4gICAgICAgICAgICB9KVxuICAgICAgICAgIH0pXG4gICAgICAgIH0pXG4gICAgICBdXG4gICAgfVxuICB9O1xuICB0aGlzLl9sYXllcnNbbGF5ZXJDb2Rlcy5HSVVOWklPTkldID0ge1xuICAgIGxheWVyQ29kZTogbGF5ZXJDb2Rlcy5HSVVOWklPTkksXG4gICAgdmVjdG9yOiBudWxsLFxuICAgIGVkaXRvcjogbnVsbCxcbiAgICBzdHlsZTogbmV3IG9sLnN0eWxlLlN0eWxlKHtcbiAgICAgIGltYWdlOiBuZXcgb2wuc3R5bGUuQ2lyY2xlKHtcbiAgICAgICAgcmFkaXVzOiA1LFxuICAgICAgICBmaWxsOiBuZXcgb2wuc3R5bGUuRmlsbCh7XG4gICAgICAgICAgY29sb3I6ICcjMDAwMGZmJ1xuICAgICAgICB9KVxuICAgICAgfSlcbiAgICB9KVxuICB9O1xuICB0aGlzLl9sYXllcnNbbGF5ZXJDb2Rlcy5TVFJBREVdID0ge1xuICAgIGxheWVyQ29kZTogbGF5ZXJDb2Rlcy5TVFJBREUsXG4gICAgdmVjdG9yOiBudWxsLFxuICAgIGVkaXRvcjogbnVsbCxcbiAgICBzdHlsZTogbmV3IG9sLnN0eWxlLlN0eWxlKHtcbiAgICAgIHN0cm9rZTogbmV3IG9sLnN0eWxlLlN0cm9rZSh7XG4gICAgICAgIHdpZHRoOiAzLFxuICAgICAgICBjb2xvcjogJyNmZjdkMmQnXG4gICAgICB9KVxuICAgIH0pXG4gIH07XG4gIFxuICB0aGlzLl9sb2FkRGF0YU9uTWFwVmlld0NoYW5nZUxpc3RlbmVyID0gbnVsbDtcbiAgXG4gIHRoaXMuX2N1cnJlbnRFZGl0aW5nTGF5ZXIgPSBudWxsO1xuICBcbiAgdGhpcy5fbG9hZGVkRXh0ZW50ID0gbnVsbDtcbiAgXG4gIHRoaXMuc3RhdGUgPSB7XG4gICAgZWRpdGluZzoge1xuICAgICAgb246IGZhbHNlLFxuICAgICAgZW5hYmxlZDogZmFsc2UsXG4gICAgICBsYXllckNvZGU6IG51bGwsXG4gICAgICB0b29sVHlwZTogbnVsbCxcbiAgICAgIHRvb2xzdGVwOiB7XG4gICAgICAgIG46IG51bGwsXG4gICAgICAgIHRvdGFsOiBudWxsLFxuICAgICAgICBtZXNzYWdlOiBudWxsXG4gICAgICB9LFxuICAgIH0sXG4gICAgcmV0cmlldmluZ0RhdGE6IGZhbHNlLFxuICAgIGhhc0VkaXRzOiBmYWxzZVxuICB9O1xuICBcbiAgLy8gdmluY29saSBhbGxhIHBvc3NpYmlsaXTDoCBkaSBhdHRpdmFyZSBsJ2VkaXRpbmdcbiAgdmFyIGVkaXRpbmdDb25zdHJhaW50cyA9IHtcbiAgICByZXNvbHV0aW9uOiAyIC8vIHZpbmNvbG8gZGkgcmlzb2x1emlvbmUgbWFzc2ltYVxuICB9XG4gIFxuICBNYXBTZXJ2aWNlLm9uYWZ0ZXIoJ3NldE1hcFZpZXcnLGZ1bmN0aW9uKGJib3gscmVzb2x1dGlvbixjZW50ZXIpe1xuICAgIHNlbGYuc3RhdGUuZWRpdGluZy5lbmFibGVkID0gKHJlc29sdXRpb24gPCBlZGl0aW5nQ29uc3RyYWludHMucmVzb2x1dGlvbikgPyB0cnVlIDogZmFsc2U7XG4gIH0pO1xuICBcbiAgdGhpcy5pbml0ID0gZnVuY3Rpb24oY29uZmlnKXtcbiAgICB0aGlzLmNvbmZpZyA9IGNvbmZpZztcbiAgICBfLmZvckVhY2godGhpcy5fbGF5ZXJzLGZ1bmN0aW9uKGl0ZXJuZXRMYXllcixsYXllckNvZGUpe1xuICAgICAgaXRlcm5ldExheWVyLm5hbWUgPSBjb25maWcubGF5ZXJzW2xheWVyQ29kZV0ubmFtZTtcbiAgICAgIGl0ZXJuZXRMYXllci5pZCA9IGNvbmZpZy5sYXllcnNbbGF5ZXJDb2RlXS5pZDtcbiAgICB9KVxuICB9O1xuICBcbiAgdGhpcy5zdG9wID0gZnVuY3Rpb24oKXtcbiAgICB2YXIgZGVmZXJyZWQgPSAkLkRlZmVycmVkKCk7XG4gICAgaWYgKHRoaXMuc3RhdGUuZWRpdGluZy5vbikge1xuICAgICAgdGhpcy5fY2FuY2VsT3JTYXZlKClcbiAgICAgIC50aGVuKGZ1bmN0aW9uKCl7XG4gICAgICAgIHNlbGYuX3N0b3BFZGl0aW5nKCk7XG4gICAgICAgIGRlZmVycmVkLnJlc29sdmUoKTtcbiAgICAgIH0pXG4gICAgICAuZmFpbChmdW5jdGlvbigpe1xuICAgICAgICBkZWZlcnJlZC5yZWplY3QoKTtcbiAgICAgIH0pXG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgZGVmZXJyZWQucmVzb2x2ZSgpO1xuICAgIH07XG4gICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2UoKTtcbiAgfTtcbiAgXG4gIC8vIGF2dmlvIG8gdGVybWlubyBsYSBzZXNzaW9uZSBkaSBlZGl0aW5nIGdlbmVyYWxlXG4gIHRoaXMudG9nZ2xlRWRpdGluZyA9IGZ1bmN0aW9uKCl7XG4gICAgdmFyIGRlZmVycmVkID0gJC5EZWZlcnJlZCgpO1xuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICBpZiAodGhpcy5zdGF0ZS5lZGl0aW5nLmVuYWJsZWQgJiYgIXRoaXMuc3RhdGUuZWRpdGluZy5vbil7XG4gICAgICB0aGlzLl9zdGFydEVkaXRpbmcoKTtcbiAgICB9XG4gICAgZWxzZSBpZiAodGhpcy5zdGF0ZS5lZGl0aW5nLm9uKSB7XG4gICAgICByZXR1cm4gdGhpcy5zdG9wKCk7XG4gICAgfVxuICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlKCk7XG4gIH07XG4gIFxuICB0aGlzLnNhdmVFZGl0cyA9IGZ1bmN0aW9uKCl7XG4gICAgdGhpcy5fY2FuY2VsT3JTYXZlKDIpO1xuICB9O1xuICBcbiAgLy8gYXZ2aWEgdW5vIGRlaSB0b29sIGRpIGVkaXRpbmcgdHJhIHF1ZWxsaSBzdXBwb3J0YXRpIGRhIEVkaXRvciAoYWRkZmVhdHVyZSwgZWNjLilcbiAgdGhpcy50b2dnbGVFZGl0VG9vbCA9IGZ1bmN0aW9uKGxheWVyQ29kZSx0b29sVHlwZSl7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIHZhciBsYXllciA9IHRoaXMuX2xheWVyc1tsYXllckNvZGVdO1xuICAgIGlmIChsYXllcikge1xuICAgICAgdmFyIGN1cnJlbnRFZGl0aW5nTGF5ZXIgPSB0aGlzLl9nZXRDdXJyZW50RWRpdGluZ0xheWVyKCk7XG4gICAgICBcbiAgICAgIC8vIHNlIHNpIHN0YSBjaGllZGVuZG8gbG8gc3Rlc3NvIGVkaXRvclxuICAgICAgaWYgKGN1cnJlbnRFZGl0aW5nTGF5ZXIgJiYgbGF5ZXJDb2RlID09IGN1cnJlbnRFZGl0aW5nTGF5ZXIubGF5ZXJDb2RlKXtcbiAgICAgICAgLy8gZSBsbyBzdGVzc28gdG9vbCBhbGxvcmEgZGlzYXR0aXZvIGwnZWRpdG9yICh1bnRvZ2dsZSlcbiAgICAgICAgaWYgKHRvb2xUeXBlID09IGN1cnJlbnRFZGl0aW5nTGF5ZXIuZWRpdG9yLmdldEFjdGl2ZVRvb2woKS5nZXRUeXBlKCkpe1xuICAgICAgICAgIHRoaXMuX3N0b3BFZGl0aW5nVG9vbCgpO1xuICAgICAgICB9XG4gICAgICAgIC8vIGFsdHJpbWVudGkgYXR0aXZvIGlsIHRvb2wgcmljaGllc3RvXG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgIHRoaXMuX3N0b3BFZGl0aW5nVG9vbCgpO1xuICAgICAgICAgIHRoaXMuX3N0YXJ0RWRpdGluZ1Rvb2woY3VycmVudEVkaXRpbmdMYXllcix0b29sVHlwZSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIC8vIGFsdHJpbWVudGlcbiAgICAgIGVsc2Uge1xuICAgICAgICAvLyBuZWwgY2FzbyBzaWEgZ2nDoCBhdHRpdm8gdW4gZWRpdG9yIHZlcmlmaWNvIGRpIHBvdGVybG8gc3RvcHBhcmVcbiAgICAgICAgaWYgKGN1cnJlbnRFZGl0aW5nTGF5ZXIgJiYgY3VycmVudEVkaXRpbmdMYXllci5lZGl0b3IuaXNTdGFydGVkKCkpe1xuICAgICAgICAgIC8vIHNlIGxhIHRlcm1pbmF6aW9uZSBkZWxsJ2VkaXRpbmcgc2Fyw6AgYW5kYXRhIGEgYnVvbiBmaW5lLCBzZXR0byBpbCB0b29sXG4gICAgICAgICAgLy8gcHJvdm8gYSBzdG9wcGFyZVxuICAgICAgICAgIHRoaXMuX2NhbmNlbE9yU2F2ZSgyKVxuICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICBpZihzZWxmLl9zdG9wRWRpdG9yKCkpe1xuICAgICAgICAgICAgICBzZWxmLl9zdGFydEVkaXRpbmdUb29sKGxheWVyLHRvb2xUeXBlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgIHRoaXMuX3N0YXJ0RWRpdGluZ1Rvb2wobGF5ZXIsdG9vbFR5cGUpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9OyAgXG4gIFxuICB0aGlzLmdldExheWVyQ29kZXMgPSBmdW5jdGlvbigpe1xuICAgIHJldHVybiBfLnZhbHVlcyh0aGlzLmxheWVyQ29kZXMpO1xuICB9O1xuICBcbiAgLyogTUVUT0RJIFBSSVZBVEkgKi9cbiAgXG4gIHRoaXMuX3N0YXJ0RWRpdGluZyA9IGZ1bmN0aW9uKCl7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIC8vdHJ5IHtcbiAgICAgIHRoaXMuX3NldHVwQW5kTG9hZEFsbFZlY3RvcnNEYXRhKClcbiAgICAgIC50aGVuKGZ1bmN0aW9uKGRhdGEpe1xuICAgICAgICAvLyBzZSB0dXR0byDDqCBhbmRhdG8gYSBidW9uIGZpbmUgYWdnaXVuZ28gaSBWZWN0b3JMYXllciBhbGxhIG1hcHBhXG4gICAgICAgIHNlbGYuX2FkZFRvTWFwKCk7XG4gICAgICAgIHNlbGYuc3RhdGUuZWRpdGluZy5vbiA9IHRydWU7XG4gICAgICAgIHNlbGYuZW1pdChcImVkaXRpbmdzdGFydGVkXCIpO1xuICAgICAgICBcbiAgICAgICAgaWYgKCFzZWxmLl9sb2FkRGF0YU9uTWFwVmlld0NoYW5nZUxpc3RlbmVyKXtcbiAgICAgICAgICBzZWxmLl9sb2FkRGF0YU9uTWFwVmlld0NoYW5nZUxpc3RlbmVyID0gTWFwU2VydmljZS5vbmFmdGVyKCdzZXRNYXBWaWV3JyxmdW5jdGlvbigpe1xuICAgICAgICAgICAgaWYgKHNlbGYuc3RhdGUuZWRpdGluZy5vbiAmJiBzZWxmLnN0YXRlLmVkaXRpbmcuZW5hYmxlZCl7XG4gICAgICAgICAgICAgIHNlbGYuX2xvYWRBbGxWZWN0b3JzRGF0YSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9KVxuICAgIC8vfVxuICAgIC8qY2F0Y2goZSkge1xuICAgICAgY29uc29sZS5sb2coZSk7XG4gICAgICB0aGlzLnN0YXRlLnJldHJpZXZpbmdEYXRhID0gZmFsc2U7XG4gICAgfSovXG4gIH07XG4gIFxuICB0aGlzLl9zdG9wRWRpdGluZyA9IGZ1bmN0aW9uKHJlc2V0KXtcbiAgICAvLyBzZSBwb3NzbyBzdG9wcGFyZSB0dXR0aSBnbGkgZWRpdG9yLi4uICAgIFxuICAgIGlmICh0aGlzLl9zdG9wRWRpdG9yKHJlc2V0KSl7XG4gICAgICBfLmZvckVhY2godGhpcy5fbGF5ZXJzLGZ1bmN0aW9uKGxheWVyLCBsYXllckNvZGUpe1xuICAgICAgICB2YXIgdmVjdG9yID0gbGF5ZXIudmVjdG9yO1xuICAgICAgICBNYXBTZXJ2aWNlLnZpZXdlci5yZW1vdmVMYXllckJ5TmFtZSh2ZWN0b3IubmFtZSk7XG4gICAgICAgIGxheWVyLnZlY3Rvcj0gbnVsbDtcbiAgICAgICAgbGF5ZXIuZWRpdG9yPSBudWxsO1xuICAgICAgICBzZWxmLl91bmxvY2tMYXllcihzZWxmLmNvbmZpZy5sYXllcnNbbGF5ZXJDb2RlXSk7XG4gICAgICB9KTtcbiAgICAgIHRoaXMuX3VwZGF0ZUVkaXRpbmdTdGF0ZSgpO1xuICAgICAgc2VsZi5zdGF0ZS5lZGl0aW5nLm9uID0gZmFsc2U7XG4gICAgICBzZWxmLl9jbGVhblVwKClcbiAgICAgIHNlbGYuZW1pdChcImVkaXRpbmdzdG9wcGVkXCIpO1xuICAgIH1cbiAgfTtcbiAgXG4gIHRoaXMuX2NsZWFuVXAgPSBmdW5jdGlvbigpe1xuICAgIHRoaXMuX2xvYWRlZEV4dGVudCA9IG51bGw7XG4gIH07XG4gIFxuICB0aGlzLl9zdGFydEVkaXRvciA9IGZ1bmN0aW9uKGxheWVyKXtcbiAgICAvLyBhdnZpbyBsJ2VkaXRvciBcbiAgICBpZiAobGF5ZXIuZWRpdG9yLnN0YXJ0KHRoaXMpKXtcbiAgICAgIC8vIGUgcmVnaXN0cm8gaSBsaXN0ZW5lcnNcbiAgICAgIHRoaXMuX3NldEN1cnJlbnRFZGl0aW5nTGF5ZXIobGF5ZXIpO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfTtcbiAgXG4gIHRoaXMuX3N0YXJ0RWRpdGluZ1Rvb2wgPSBmdW5jdGlvbihsYXllcix0b29sVHlwZSxvcHRpb25zKXtcbiAgICB2YXIgY2FuU3RhcnRUb29sID0gdHJ1ZTtcbiAgICBpZiAoIWxheWVyLmVkaXRvci5pc1N0YXJ0ZWQoKSl7XG4gICAgICBjYW5TdGFydFRvb2wgPSB0aGlzLl9zdGFydEVkaXRvcihsYXllcik7XG4gICAgfVxuICAgIGlmKGNhblN0YXJ0VG9vbCAmJiBsYXllci5lZGl0b3Iuc2V0VG9vbCh0b29sVHlwZSxvcHRpb25zKSl7XG4gICAgICB0aGlzLl91cGRhdGVFZGl0aW5nU3RhdGUoKTtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH07XG4gIFxuICB0aGlzLl9zdG9wRWRpdG9yID0gZnVuY3Rpb24ocmVzZXQpe1xuICAgIHZhciByZXQgPSB0cnVlO1xuICAgIHZhciBsYXllciA9IHRoaXMuX2dldEN1cnJlbnRFZGl0aW5nTGF5ZXIoKTtcbiAgICBpZiAobGF5ZXIpIHtcbiAgICAgIHJldCA9IGxheWVyLmVkaXRvci5zdG9wKHJlc2V0KTtcbiAgICAgIGlmIChyZXQpe1xuICAgICAgICB0aGlzLl9zZXRDdXJyZW50RWRpdGluZ0xheWVyKCk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG4gIH07XG4gIFxuICB0aGlzLl9zdG9wRWRpdGluZ1Rvb2wgPSBmdW5jdGlvbigpe1xuICAgIHZhciByZXQgPSB0cnVlO1xuICAgIHZhciBsYXllciA9IHRoaXMuX2dldEN1cnJlbnRFZGl0aW5nTGF5ZXIoKTtcbiAgICBpZihsYXllcil7XG4gICAgICByZXQgPSBsYXllci5lZGl0b3Iuc3RvcFRvb2woKTtcbiAgICAgIGlmIChyZXQpe1xuICAgICAgICB0aGlzLl91cGRhdGVFZGl0aW5nU3RhdGUoKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHJldDtcbiAgfTtcbiAgXG4gIHRoaXMuX2NhbmNlbE9yU2F2ZSA9IGZ1bmN0aW9uKHR5cGUpe1xuICAgIHZhciBkZWZlcnJlZCA9ICQuRGVmZXJyZWQoKTtcbiAgICAvLyBwZXIgc2ljdXJlenphIHRlbmdvIHR1dHRvIGRlbnRybyB1biBncm9zc28gdHJ5L2NhdGNoLCBwZXIgbm9uIHJpc2NoaWFyZSBkaSBwcm92b2NhcmUgaW5jb25zaXN0ZW56ZSBuZWkgZGF0aSBkdXJhbnRlIGlsIHNhbHZhdGFnZ2lvXG4gICAgdHJ5IHtcbiAgICAgIHZhciBfYXNrVHlwZSA9IDE7XG4gICAgICBpZiAodHlwZSl7XG4gICAgICAgIF9hc2tUeXBlID0gdHlwZVxuICAgICAgfVxuICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgdmFyIGNob2ljZSA9IFwiY2FuY2VsXCI7XG4gICAgICB2YXIgZGlydHlFZGl0b3JzID0ge307XG4gICAgICBfLmZvckVhY2godGhpcy5fbGF5ZXJzLGZ1bmN0aW9uKGxheWVyLGxheWVyQ29kZSl7XG4gICAgICAgIGlmIChsYXllci5lZGl0b3IuaXNEaXJ0eSgpKXtcbiAgICAgICAgICBkaXJ0eUVkaXRvcnNbbGF5ZXJDb2RlXSA9IGxheWVyLmVkaXRvcjtcbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIGlmKF8ua2V5cyhkaXJ0eUVkaXRvcnMpLmxlbmd0aCl7XG4gICAgICAgIHRoaXMuX2Fza0NhbmNlbE9yU2F2ZShfYXNrVHlwZSkuXG4gICAgICAgIHRoZW4oZnVuY3Rpb24oYWN0aW9uKXtcbiAgICAgICAgICBpZiAoYWN0aW9uID09PSAnc2F2ZScpe1xuICAgICAgICAgICAgc2VsZi5fc2F2ZUVkaXRzKGRpcnR5RWRpdG9ycykuXG4gICAgICAgICAgICB0aGVuKGZ1bmN0aW9uKHJlc3VsdCl7XG4gICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUoKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuZmFpbChmdW5jdGlvbihyZXN1bHQpe1xuICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2UgaWYgKGFjdGlvbiA9PSAnbm9zYXZlJykge1xuICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZSgpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIGlmIChhY3Rpb24gPT0gJ2NhbmNlbCcpIHtcbiAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdCgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKCk7XG4gICAgICB9XG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICBkZWZlcnJlZC5yZWplY3QoKTtcbiAgICB9XG4gICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2UoKTtcbiAgfTtcbiAgXG4gIHRoaXMuX2Fza0NhbmNlbE9yU2F2ZSA9IGZ1bmN0aW9uKHR5cGUpe1xuICAgIHZhciBkZWZlcnJlZCA9ICQuRGVmZXJyZWQoKTtcbiAgICB2YXIgYnV0dG9uVHlwZXMgPSB7XG4gICAgICBTQVZFOiB7XG4gICAgICAgIGxhYmVsOiBcIlNhbHZhXCIsXG4gICAgICAgIGNsYXNzTmFtZTogXCJidG4tc3VjY2Vzc1wiLFxuICAgICAgICBjYWxsYmFjazogZnVuY3Rpb24oKXtcbiAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKCdzYXZlJyk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBOT1NBVkU6IHtcbiAgICAgICAgbGFiZWw6IFwiVGVybWluYSBzZW56YSBzYWx2YXJlXCIsXG4gICAgICAgIGNsYXNzTmFtZTogXCJidG4tZGFuZ2VyXCIsXG4gICAgICAgIGNhbGxiYWNrOiBmdW5jdGlvbigpe1xuICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUoJ25vc2F2ZScpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgQ0FOQ0VMOiB7XG4gICAgICAgIGxhYmVsOiBcIkFubnVsbGFcIixcbiAgICAgICAgY2xhc3NOYW1lOiBcImJ0bi1wcmltYXJ5XCIsXG4gICAgICAgIGNhbGxiYWNrOiBmdW5jdGlvbigpe1xuICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUoJ2NhbmNlbCcpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfTtcbiAgICBzd2l0Y2ggKHR5cGUpe1xuICAgICAgY2FzZSAxOlxuICAgICAgICBidXR0b25zID0ge1xuICAgICAgICAgIHNhdmU6IGJ1dHRvblR5cGVzLlNBVkUsXG4gICAgICAgICAgbm9zYXZlOiBidXR0b25UeXBlcy5OT1NBVkUsXG4gICAgICAgICAgY2FuY2VsOiBidXR0b25UeXBlcy5DQU5DRUxcbiAgICAgICAgfTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI6XG4gICAgICAgYnV0dG9ucyA9IHtcbiAgICAgICAgICBzYXZlOiBidXR0b25UeXBlcy5TQVZFLFxuICAgICAgICAgIGNhbmNlbDogYnV0dG9uVHlwZXMuQ0FOQ0VMXG4gICAgICAgIH07XG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgICBHVUkuZGlhbG9nLmRpYWxvZyh7XG4gICAgICAgIG1lc3NhZ2U6IFwiVnVvaSBzYWx2YXJlIGRlZmluaXRpdmFtZW50ZSBsZSBtb2RpZmljaGU/XCIsXG4gICAgICAgIHRpdGxlOiBcIlNhbHZhdGFnZ2lvIG1vZGlmaWNhXCIsXG4gICAgICAgIGJ1dHRvbnM6IGJ1dHRvbnNcbiAgICAgIH0pO1xuICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlKCk7XG4gIH07XG4gIFxuICB0aGlzLl9zYXZlRWRpdHMgPSBmdW5jdGlvbihkaXJ0eUVkaXRvcnMpe1xuICAgIHZhciBkZWZlcnJlZCA9ICQuRGVmZXJyZWQoKTtcbiAgICB0aGlzLl9zZW5kRWRpdHMoZGlydHlFZGl0b3JzKVxuICAgIC50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKXtcbiAgICAgIEdVSS5ub3RpZnkuc3VjY2VzcyhcIkkgZGF0aSBzb25vIHN0YXRpIHNhbHZhdGkgY29ycmV0dGFtZW50ZVwiKTsgXG4gICAgICBzZWxmLl9jb21taXRFZGl0cyhkaXJ0eUVkaXRvcnMscmVzcG9uc2UpO1xuICAgICAgTWFwU2VydmljZS5yZWZyZXNoTWFwKCk7XG4gICAgICBkZWZlcnJlZC5yZXNvbHZlKCk7XG4gICAgfSlcbiAgICAuZmFpbChmdW5jdGlvbihlcnJvcnMpe1xuICAgICAgR1VJLm5vdGlmeS5lcnJvcihcIkVycm9yZSBuZWwgc2FsdmF0YWdnaW8gc3VsIHNlcnZlclwiKTsgXG4gICAgICBkZWZlcnJlZC5yZXNvbHZlKCk7XG4gICAgfSlcbiAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZSgpO1xuICB9O1xuICBcbiAgdGhpcy5fc2VuZEVkaXRzID0gZnVuY3Rpb24oZGlydHlFZGl0b3JzKXtcbiAgICB2YXIgZGVmZXJyZWQgPSAkLkRlZmVycmVkKCk7XG5cbiAgICB2YXIgZWRpdHNUb1B1c2ggPSBfLm1hcChkaXJ0eUVkaXRvcnMsZnVuY3Rpb24oZWRpdG9yKXtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGxheWVybmFtZTogZWRpdG9yLmdldFZlY3RvckxheWVyKCkubmFtZSxcbiAgICAgICAgZWRpdHM6IGVkaXRvci5nZXRFZGl0ZWRGZWF0dXJlcygpXG4gICAgICB9XG4gICAgfSk7XG5cbiAgICB0aGlzLl9wb3N0RGF0YShlZGl0c1RvUHVzaClcbiAgICAudGhlbihmdW5jdGlvbihyZXR1cm5lZCl7XG4gICAgICBpZiAocmV0dXJuZWQucmVzdWx0KXtcbiAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXR1cm5lZC5yZXNwb25zZSk7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgZGVmZXJyZWQucmVqZWN0KHJldHVybmVkLnJlc3BvbnNlKTtcbiAgICAgIH1cbiAgICB9KVxuICAgIC5mYWlsKGZ1bmN0aW9uKHJldHVybmVkKXtcbiAgICAgIGRlZmVycmVkLnJlamVjdChyZXR1cm5lZC5yZXNwb25zZSk7XG4gICAgfSk7XG4gICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2UoKTtcbiAgfTtcbiAgXG4gIHRoaXMuX2NvbW1pdEVkaXRzID0gZnVuY3Rpb24oZWRpdG9ycyxyZXNwb25zZSl7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIF8uZm9yRWFjaChlZGl0b3JzLGZ1bmN0aW9uKGVkaXRvcil7XG4gICAgICB2YXIgbmV3QXR0cmlidXRlc0Zyb21TZXJ2ZXIgPSBudWxsO1xuICAgICAgaWYgKHJlc3BvbnNlICYmIHJlc3BvbnNlLm5ldyl7XG4gICAgICAgIF8uZm9yRWFjaChyZXNwb25zZS5uZXcsZnVuY3Rpb24odXBkYXRlZEZlYXR1cmVBdHRyaWJ1dGVzKXtcbiAgICAgICAgICB2YXIgb2xkZmlkID0gdXBkYXRlZEZlYXR1cmVBdHRyaWJ1dGVzLmNsaWVudGlkO1xuICAgICAgICAgIHZhciBmaWQgPSB1cGRhdGVkRmVhdHVyZUF0dHJpYnV0ZXMuaWQ7XG4gICAgICAgICAgZWRpdG9yLmdldEVkaXRWZWN0b3JMYXllcigpLnNldEZlYXR1cmVEYXRhKG9sZGZpZCxmaWQsbnVsbCx1cGRhdGVkRmVhdHVyZUF0dHJpYnV0ZXMpO1xuICAgICAgICB9KVxuICAgICAgfVxuICAgICAgZWRpdG9yLmNvbW1pdCgpO1xuICAgIH0pO1xuICB9O1xuICBcbiAgdGhpcy5fdW5kb0VkaXRzID0gZnVuY3Rpb24oZGlydHlFZGl0b3JzKXtcbiAgICB2YXIgY3VycmVudEVkaXRpbmdMYXllckNvZGUgPSB0aGlzLl9nZXRDdXJyZW50RWRpdGluZ0xheWVyKCkubGF5ZXJDb2RlO1xuICAgIHZhciBlZGl0b3IgPSBkaXJ0eUVkaXRvcnNbY3VycmVudEVkaXRpbmdMYXllckNvZGVdO1xuICAgIHRoaXMuX3N0b3BFZGl0aW5nKHRydWUpO1xuICB9O1xuICBcbiAgdGhpcy5fdXBkYXRlRWRpdGluZ1N0YXRlID0gZnVuY3Rpb24oKXtcbiAgICB2YXIgbGF5ZXIgPSB0aGlzLl9nZXRDdXJyZW50RWRpdGluZ0xheWVyKCk7XG4gICAgaWYgKGxheWVyKXtcbiAgICAgIHRoaXMuc3RhdGUuZWRpdGluZy5sYXllckNvZGUgPSBsYXllci5sYXllckNvZGU7XG4gICAgICB0aGlzLnN0YXRlLmVkaXRpbmcudG9vbFR5cGUgPSBsYXllci5lZGl0b3IuZ2V0QWN0aXZlVG9vbCgpLmdldFR5cGUoKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICB0aGlzLnN0YXRlLmVkaXRpbmcubGF5ZXJDb2RlID0gbnVsbDtcbiAgICAgIHRoaXMuc3RhdGUuZWRpdGluZy50b29sVHlwZSA9IG51bGw7XG4gICAgfVxuICAgIHRoaXMuX3VwZGF0ZVRvb2xTdGVwc1N0YXRlKCk7XG4gIH07XG4gIFxuICB0aGlzLl91cGRhdGVUb29sU3RlcHNTdGF0ZSA9IGZ1bmN0aW9uKGFjdGl2ZVRvb2wpe1xuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICB2YXIgbGF5ZXIgPSB0aGlzLl9nZXRDdXJyZW50RWRpdGluZ0xheWVyKCk7XG4gICAgdmFyIGFjdGl2ZVRvb2w7XG4gICAgXG4gICAgaWYgKGxheWVyKSB7XG4gICAgICBhY3RpdmVUb29sID0gbGF5ZXIuZWRpdG9yLmdldEFjdGl2ZVRvb2woKTtcbiAgICB9XG4gICAgXG4gICAgaWYgKGFjdGl2ZVRvb2wgJiYgYWN0aXZlVG9vbC5nZXRUb29sKCkpIHtcbiAgICAgIHZhciB0b29sSW5zdGFuY2UgPSBhY3RpdmVUb29sLmdldFRvb2woKTtcbiAgICAgIGlmICh0b29sSW5zdGFuY2Uuc3RlcHMpe1xuICAgICAgICB0aGlzLl9zZXRUb29sU3RlcFN0YXRlKGFjdGl2ZVRvb2wpO1xuICAgICAgICB0b29sSW5zdGFuY2Uuc3RlcHMub24oJ3N0ZXAnLGZ1bmN0aW9uKGluZGV4LHN0ZXApe1xuICAgICAgICAgIHNlbGYuX3NldFRvb2xTdGVwU3RhdGUoYWN0aXZlVG9vbCk7XG4gICAgICAgIH0pXG4gICAgICAgIHRvb2xJbnN0YW5jZS5zdGVwcy5vbignY29tcGxldGUnLGZ1bmN0aW9uKCl7XG4gICAgICAgICAgc2VsZi5fc2V0VG9vbFN0ZXBTdGF0ZSgpO1xuICAgICAgICB9KVxuICAgICAgfVxuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIHNlbGYuX3NldFRvb2xTdGVwU3RhdGUoKTtcbiAgICB9XG4gIH07XG4gIFxuICB0aGlzLl9zZXRUb29sU3RlcFN0YXRlID0gZnVuY3Rpb24oYWN0aXZlVG9vbCl7XG4gICAgdmFyIGluZGV4LCB0b3RhbCwgbWVzc2FnZTtcbiAgICBpZiAoXy5pc1VuZGVmaW5lZChhY3RpdmVUb29sKSl7XG4gICAgICBpbmRleCA9IG51bGw7XG4gICAgICB0b3RhbCA9IG51bGw7XG4gICAgICBtZXNzYWdlID0gbnVsbDtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICB2YXIgdG9vbCA9IGFjdGl2ZVRvb2wuZ2V0VG9vbCgpO1xuICAgICAgdmFyIG1lc3NhZ2VzID0gdG9vbFN0ZXBzTWVzc2FnZXNbYWN0aXZlVG9vbC5nZXRUeXBlKCldO1xuICAgICAgaW5kZXggPSB0b29sLnN0ZXBzLmN1cnJlbnRTdGVwSW5kZXgoKTtcbiAgICAgIHRvdGFsID0gdG9vbC5zdGVwcy50b3RhbFN0ZXBzKCk7XG4gICAgICBtZXNzYWdlID0gbWVzc2FnZXNbaW5kZXhdO1xuICAgICAgaWYgKF8uaXNVbmRlZmluZWQobWVzc2FnZSkpIHtcbiAgICAgICAgaW5kZXggPSBudWxsO1xuICAgICAgICB0b3RhbCA9IG51bGw7XG4gICAgICAgIG1lc3NhZ2UgPSBudWxsO1xuICAgICAgfVxuICAgIH1cbiAgICB0aGlzLnN0YXRlLmVkaXRpbmcudG9vbHN0ZXAubiA9IGluZGV4ICsgMTtcbiAgICB0aGlzLnN0YXRlLmVkaXRpbmcudG9vbHN0ZXAudG90YWwgPSB0b3RhbDtcbiAgICB0aGlzLnN0YXRlLmVkaXRpbmcudG9vbHN0ZXAubWVzc2FnZSA9IG1lc3NhZ2U7XG4gIH07XG4gIFxuICB0aGlzLl9nZXRDdXJyZW50RWRpdGluZ0xheWVyID0gZnVuY3Rpb24oKXtcbiAgICByZXR1cm4gdGhpcy5fY3VycmVudEVkaXRpbmdMYXllcjtcbiAgfTtcbiAgXG4gIHRoaXMuX3NldEN1cnJlbnRFZGl0aW5nTGF5ZXIgPSBmdW5jdGlvbihsYXllcil7XG4gICAgaWYgKCFsYXllcil7XG4gICAgICB0aGlzLl9jdXJyZW50RWRpdGluZ0xheWVyID0gbnVsbDtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICB0aGlzLl9jdXJyZW50RWRpdGluZ0xheWVyID0gbGF5ZXI7XG4gICAgfVxuICB9O1xuICBcbiAgdGhpcy5fYWRkVG9NYXAgPSBmdW5jdGlvbigpe1xuICAgIHZhciBtYXAgPSBNYXBTZXJ2aWNlLnZpZXdlci5tYXA7XG4gICAgdmFyIGxheWVyQ29kZXMgPSB0aGlzLmdldExheWVyQ29kZXMoKTtcbiAgICBfLmZvckVhY2gobGF5ZXJDb2RlcyxmdW5jdGlvbihsYXllckNvZGUpe1xuICAgICAgc2VsZi5fbGF5ZXJzW2xheWVyQ29kZV0udmVjdG9yLmFkZFRvTWFwKG1hcCk7XG4gICAgfSlcbiAgfTtcbiAgXG4gIHRoaXMuX3NldHVwQW5kTG9hZEFsbFZlY3RvcnNEYXRhID0gZnVuY3Rpb24oKXtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgdmFyIGRlZmVycmVkID0gJC5EZWZlcnJlZCgpO1xuICAgIHZhciBsYXllckNvZGVzID0gdGhpcy5nZXRMYXllckNvZGVzKCk7XG4gICAgdmFyIGxheWVyc1JlYWR5ID0gXy5yZWR1Y2UobGF5ZXJDb2RlcyxmdW5jdGlvbihyZWFkeSxsYXllckNvZGUpe1xuICAgICAgcmV0dXJuICFfLmlzTnVsbChzZWxmLl9sYXllcnNbbGF5ZXJDb2RlXS52ZWN0b3IpO1xuICAgIH0pO1xuICAgIHNlbGYuc3RhdGUucmV0cmlldmluZ0RhdGEgPSB0cnVlO1xuICAgIGlmICghbGF5ZXJzUmVhZHkpe1xuICAgICAgLy8gZXNlZ3VvIGxlIHJpY2hpZXN0ZSBkZWxsZSBjb25maWd1cmF6aW9uaSBlIG1pIHRlbmdvIGxlIHByb21lc3NlXG4gICAgICB2YXIgdmVjdG9yTGF5ZXJzU2V0dXAgPSBfLm1hcChsYXllckNvZGVzLGZ1bmN0aW9uKGxheWVyQ29kZSl7XG4gICAgICAgIHJldHVybiBzZWxmLl9zZXR1cFZlY3RvckxheWVyKHNlbGYuX2xheWVyc1tsYXllckNvZGVdKTtcbiAgICAgIH0pO1xuICAgICAgLy8gYXNwZXR0byB0dXR0ZSBsZSBwcm9tZXNzZVxuICAgICAgJC53aGVuLmFwcGx5KHRoaXMsdmVjdG9yTGF5ZXJzU2V0dXApXG4gICAgICAudGhlbihmdW5jdGlvbigpe1xuICAgICAgICB2YXIgdmVjdG9yTGF5ZXJzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzKTtcbiAgICAgICAgdmFyIGxheWVyQ29kZXMgPSBzZWxmLmdldExheWVyQ29kZXMoKTtcbiAgICAgICAgdmFyIHZlY3RvckxheWVyc0Zvckl0ZXJuZXRDb2RlID0gXy56aXBPYmplY3QobGF5ZXJDb2Rlcyx2ZWN0b3JMYXllcnMpO1xuICAgICAgICBcbiAgICAgICAgXy5mb3JFYWNoKHZlY3RvckxheWVyc0Zvckl0ZXJuZXRDb2RlLGZ1bmN0aW9uKHZlY3RvckxheWVyLGxheWVyQ29kZSl7XG4gICAgICAgICAgc2VsZi5fbGF5ZXJzW2xheWVyQ29kZV0udmVjdG9yID0gdmVjdG9yTGF5ZXI7XG4gICAgICAgICAgdmFyIGVkaXRvciA9IG5ldyBzZWxmLl9lZGl0b3JDbGFzc2VzW2xheWVyQ29kZV07XG4gICAgICAgICAgZWRpdG9yLnNldFZlY3RvckxheWVyKHZlY3RvckxheWVyKTtcbiAgICAgICAgICBlZGl0b3Iub24oXCJkaXJ0eVwiLGZ1bmN0aW9uKGRpcnR5KXtcbiAgICAgICAgICAgIHNlbGYuc3RhdGUuaGFzRWRpdHMgPSBkaXJ0eTtcbiAgICAgICAgICB9KSAgICAgICAgXG4gICAgICAgICAgc2VsZi5fbGF5ZXJzW2xheWVyQ29kZV0uZWRpdG9yID0gZWRpdG9yO1xuICAgICAgICB9KTtcblxuICAgICAgICBzZWxmLl9sb2FkQWxsVmVjdG9yc0RhdGEoKVxuICAgICAgICAudGhlbihmdW5jdGlvbigpe1xuICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUoKTtcbiAgICAgICAgfSlcbiAgICAgICAgLmZhaWwoZnVuY3Rpb24oKXtcbiAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoKTtcbiAgICAgICAgfSlcbiAgICAgICAgLmFsd2F5cyhmdW5jdGlvbigpe1xuICAgICAgICAgIHNlbGYuc3RhdGUucmV0cmlldmluZ0RhdGEgPSBmYWxzZTtcbiAgICAgICAgfSlcbiAgICAgIH0pXG4gICAgICAuZmFpbChmdW5jdGlvbigpe1xuICAgICAgICBkZWZlcnJlZC5yZWplY3QoKTtcbiAgICAgIH0pXG4gICAgfVxuICAgIGVsc2V7XG4gICAgICB0aGlzLl9sb2FkQWxsVmVjdG9yc0RhdGEoKVxuICAgICAgLnRoZW4oZnVuY3Rpb24oKXtcbiAgICAgICAgZGVmZXJyZWQucmVzb2x2ZSgpO1xuICAgICAgfSlcbiAgICAgIC5mYWlsKGZ1bmN0aW9uKCl7XG4gICAgICAgIGRlZmVycmVkLnJlamVjdCgpO1xuICAgICAgfSlcbiAgICAgIC5hbHdheXMoZnVuY3Rpb24oKXtcbiAgICAgICAgc2VsZi5zdGF0ZS5yZXRyaWV2aW5nRGF0YSA9IGZhbHNlO1xuICAgICAgfSlcbiAgICB9XG4gICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2UoKTtcbiAgfTtcbiAgXG4gIHRoaXMuX2xvYWRBbGxWZWN0b3JzRGF0YSA9IGZ1bmN0aW9uKHZlY3RvckxheWVycyl7XG4gICAgXG4gICAgLy8gdmVyaWZpY28gY2hlIGlsIEJCT1ggYXR0dWFsZSBub24gc2lhIHN0YXRvIGdpw6AgY2FyaWNhdG9cbiAgICB2YXIgYmJveCA9IE1hcFNlcnZpY2Uuc3RhdGUuYmJveDtcbiAgICB2YXIgbG9hZGVkRXh0ZW50ID0gdGhpcy5fbG9hZGVkRXh0ZW50O1xuICAgIGlmIChsb2FkZWRFeHRlbnQgJiYgb2wuZXh0ZW50LmNvbnRhaW5zRXh0ZW50KGxvYWRlZEV4dGVudCxiYm94KSl7XG4gICAgICAgIHJldHVybiByZXNvbHZlZFZhbHVlKCk7XG4gICAgfVxuICAgIGlmICghbG9hZGVkRXh0ZW50KXtcbiAgICAgIHRoaXMuX2xvYWRlZEV4dGVudCA9IGJib3g7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgdGhpcy5fbG9hZGVkRXh0ZW50ID0gb2wuZXh0ZW50LmV4dGVuZChsb2FkZWRFeHRlbnQsYmJveCk7XG4gICAgfVxuICAgIFxuICAgIFxuICAgIHZhciBkZWZlcnJlZCA9ICQuRGVmZXJyZWQoKTtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgdmFyIHZlY3RvckRhdGFSZXF1ZXN0cyA9IF8ubWFwKHNlbGYuX2xheWVycyxmdW5jdGlvbihpdGVybmV0TGF5ZXIpe1xuICAgICAgcmV0dXJuIHNlbGYuX2xvYWRWZWN0b3JEYXRhKGl0ZXJuZXRMYXllci52ZWN0b3IsYmJveCk7XG4gICAgfSk7XG4gICAgJC53aGVuLmFwcGx5KHRoaXMsdmVjdG9yRGF0YVJlcXVlc3RzKVxuICAgIC50aGVuKGZ1bmN0aW9uKCl7XG4gICAgICB2YXIgdmVjdG9yc0RhdGFSZXNwb25zZSA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cyk7XG4gICAgICB2YXIgbGF5ZXJDb2RlcyA9IHNlbGYuZ2V0TGF5ZXJDb2RlcygpO1xuICAgICAgdmFyIHZlY3RvckRhdGFSZXNwb25zZUZvckl0ZXJuZXRDb2RlID0gXy56aXBPYmplY3QobGF5ZXJDb2Rlcyx2ZWN0b3JzRGF0YVJlc3BvbnNlKTtcbiAgICAgIF8uZm9yRWFjaCh2ZWN0b3JEYXRhUmVzcG9uc2VGb3JJdGVybmV0Q29kZSxmdW5jdGlvbih2ZWN0b3JEYXRhUmVzcG9uc2UsbGF5ZXJDb2RlKXtcbiAgICAgICAgaWYgKHZlY3RvckRhdGFSZXNwb25zZS5mZWF0dXJlbG9ja3Mpe1xuICAgICAgICAgIHNlbGYuX2xheWVyc1tsYXllckNvZGVdLmVkaXRvci5zZXRGZWF0dXJlTG9ja3ModmVjdG9yRGF0YVJlc3BvbnNlLmZlYXR1cmVsb2Nrcyk7XG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgICBkZWZlcnJlZC5yZXNvbHZlKCk7XG4gICAgfSlcbiAgICAuZmFpbChmdW5jdGlvbigpe1xuICAgICAgZGVmZXJyZWQucmVqZWN0KCk7XG4gICAgfSk7XG4gICAgXG4gICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2UoKTtcbiAgfTtcbiAgXG4gIHRoaXMuX3NldHVwVmVjdG9yTGF5ZXIgPSBmdW5jdGlvbihsYXllckNvbmZpZyl7XG4gICAgdmFyIGRlZmVycmVkID0gJC5EZWZlcnJlZCgpO1xuICAgIC8vIGVzZWd1byBsZSByaWNoaWVzdGUgZGVsbGUgY29uZmlndXJhemlvbmkgZSBtaSB0ZW5nbyBsZSBwcm9tZXNzZVxuICAgIHNlbGYuX2dldFZlY3RvckxheWVyQ29uZmlnKGxheWVyQ29uZmlnLm5hbWUpXG4gICAgLnRoZW4oZnVuY3Rpb24odmVjdG9yQ29uZmlnUmVzcG9uc2Upe1xuICAgICAgLy8gaW5zdGFuemlvIGlsIFZlY3RvckxheWVyXG4gICAgICB2YXIgdmVjdG9yQ29uZmlnID0gdmVjdG9yQ29uZmlnUmVzcG9uc2UudmVjdG9yO1xuICAgICAgdmFyIHZlY3RvckxheWVyID0gc2VsZi5fY3JlYXRlVmVjdG9yTGF5ZXIoe1xuICAgICAgICBnZW9tZXRyeXR5cGU6IHZlY3RvckNvbmZpZy5nZW9tZXRyeXR5cGUsXG4gICAgICAgIGZvcm1hdDogdmVjdG9yQ29uZmlnLmZvcm1hdCxcbiAgICAgICAgY3JzOiBcIkVQU0c6MzAwM1wiLFxuICAgICAgICBpZDogbGF5ZXJDb25maWcuaWQsXG4gICAgICAgIG5hbWU6IGxheWVyQ29uZmlnLm5hbWUsXG4gICAgICAgIHBrOiB2ZWN0b3JDb25maWcucGsgIFxuICAgICAgfSk7XG4gICAgICAvLyBvdHRlbmdvIGxhIGRlZmluaXppb25lIGRlaSBjYW1waVxuICAgICAgdmVjdG9yTGF5ZXIuc2V0RmllbGRzKHZlY3RvckNvbmZpZy5maWVsZHMpO1xuICAgICAgXG4gICAgICB2YXIgcmVsYXRpb25zID0gdmVjdG9yQ29uZmlnLnJlbGF0aW9ucztcbiAgICAgIFxuICAgICAgaWYocmVsYXRpb25zKXtcbiAgICAgICAgLy8gcGVyIGRpcmUgYSB2ZWN0b3JMYXllciBjaGUgaSBkYXRpIGRlbGxlIHJlbGF6aW9uaSB2ZXJyYW5ubyBjYXJpY2F0aSBzb2xvIHF1YW5kbyByaWNoaWVzdGkgKGVzLiBhcGVydHVyZSBmb3JtIGRpIGVkaXRpbmcpXG4gICAgICAgIHZlY3RvckxheWVyLmxhenlSZWxhdGlvbnMgPSB0cnVlO1xuICAgICAgICB2ZWN0b3JMYXllci5zZXRSZWxhdGlvbnMocmVsYXRpb25zKTtcbiAgICAgIH1cbiAgICAgIC8vIHNldHRvIGxvIHN0aWxlIGRlbCBsYXllciBPTFxuICAgICAgaWYgKGxheWVyQ29uZmlnLnN0eWxlKSB7XG4gICAgICAgIHZlY3RvckxheWVyLnNldFN0eWxlKGxheWVyQ29uZmlnLnN0eWxlKTtcbiAgICAgIH1cbiAgICAgIGRlZmVycmVkLnJlc29sdmUodmVjdG9yTGF5ZXIpO1xuICAgIH0pXG4gICAgLmZhaWwoZnVuY3Rpb24oKXtcbiAgICAgIGRlZmVycmVkLnJlamVjdCgpO1xuICAgIH0pXG4gICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2UoKTtcbiAgfTtcbiAgXG4gIHRoaXMuX2xvYWRWZWN0b3JEYXRhID0gZnVuY3Rpb24odmVjdG9yTGF5ZXIsYmJveCl7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIC8vIGVzZWd1byBsZSByaWNoaWVzdGUgZGUgZGF0aSBlIG1pIHRlbmdvIGxlIHByb21lc3NlXG4gICAgcmV0dXJuIHNlbGYuX2dldFZlY3RvckxheWVyRGF0YSh2ZWN0b3JMYXllcixiYm94KVxuICAgIC50aGVuKGZ1bmN0aW9uKHZlY3RvckRhdGFSZXNwb25zZSl7XG4gICAgICB2ZWN0b3JMYXllci5zZXREYXRhKHZlY3RvckRhdGFSZXNwb25zZS52ZWN0b3IuZGF0YSk7XG4gICAgICByZXR1cm4gdmVjdG9yRGF0YVJlc3BvbnNlO1xuICAgIH0pXG4gIH07XG4gIFxuICAvLyBvdHRpZW5lIGxhIGNvbmZpZ3VyYXppb25lIGRlbCB2ZXR0b3JpYWxlIChxdWkgcmljaGllc3RvIHNvbG8gcGVyIGxhIGRlZmluaXppb25lIGRlZ2xpIGlucHV0KVxuICB0aGlzLl9nZXRWZWN0b3JMYXllckNvbmZpZyA9IGZ1bmN0aW9uKGxheWVyTmFtZSl7XG4gICAgdmFyIGQgPSAkLkRlZmVycmVkKCk7XG4gICAgJC5nZXQodGhpcy5jb25maWcuYmFzZXVybCtsYXllck5hbWUrXCIvP2NvbmZpZ1wiKVxuICAgIC5kb25lKGZ1bmN0aW9uKGRhdGEpe1xuICAgICAgZC5yZXNvbHZlKGRhdGEpO1xuICAgIH0pXG4gICAgLmZhaWwoZnVuY3Rpb24oKXtcbiAgICAgIGQucmVqZWN0KCk7XG4gICAgfSlcbiAgICByZXR1cm4gZC5wcm9taXNlKCk7XG4gIH07XG4gIFxuICAvLyBvdHRpZW5lIGlsIHZldHRvcmlhbGUgaW4gbW9kYWxpdMOgIGVkaXRpbmdcbiAgdGhpcy5fZ2V0VmVjdG9yTGF5ZXJEYXRhID0gZnVuY3Rpb24odmVjdG9yTGF5ZXIsYmJveCl7XG4gICAgdmFyIGQgPSAkLkRlZmVycmVkKCk7XG4gICAgJC5nZXQodGhpcy5jb25maWcuYmFzZXVybCt2ZWN0b3JMYXllci5uYW1lK1wiLz9lZGl0aW5nJmluX2Jib3g9XCIrYmJveFswXStcIixcIitiYm94WzFdK1wiLFwiK2Jib3hbMl0rXCIsXCIrYmJveFszXSlcbiAgICAuZG9uZShmdW5jdGlvbihkYXRhKXtcbiAgICAgIGQucmVzb2x2ZShkYXRhKTtcbiAgICB9KVxuICAgIC5mYWlsKGZ1bmN0aW9uKCl7XG4gICAgICBkLnJlamVjdCgpO1xuICAgIH0pXG4gICAgcmV0dXJuIGQucHJvbWlzZSgpO1xuICB9O1xuICBcbiAgdGhpcy5fcG9zdERhdGEgPSBmdW5jdGlvbihlZGl0c1RvUHVzaCl7XG4gICAgLy8gbWFuZG8gdW4gb2dnZXR0byBjb21lIG5lbCBjYXNvIGRlbCBiYXRjaCwgbWEgaW4gcXVlc3RvIGNhc28gZGV2byBwcmVuZGVyZSBzb2xvIGlsIHByaW1vLCBlIHVuaWNvLCBlbGVtZW50b1xuICAgIGlmIChlZGl0c1RvUHVzaC5sZW5ndGg+MSl7XG4gICAgICByZXR1cm4gdGhpcy5fcG9zdEJhdGNoRGF0YShlZGl0c1RvUHVzaCk7XG4gICAgfVxuICAgIHZhciBsYXllck5hbWUgPSBlZGl0c1RvUHVzaFswXS5sYXllcm5hbWU7XG4gICAgdmFyIGVkaXRzID0gZWRpdHNUb1B1c2hbMF0uZWRpdHM7XG4gICAgdmFyIGpzb25EYXRhID0gSlNPTi5zdHJpbmdpZnkoZWRpdHMpO1xuICAgIHJldHVybiAkLnBvc3Qoe1xuICAgICAgdXJsOiB0aGlzLmNvbmZpZy5iYXNldXJsK2xheWVyTmFtZStcIi9cIixcbiAgICAgIGRhdGE6IGpzb25EYXRhLFxuICAgICAgY29udGVudFR5cGU6IFwiYXBwbGljYXRpb24vanNvblwiXG4gICAgfSk7XG4gIH07XG4gIFxuICB0aGlzLl9wb3N0QmF0Y2hEYXRhID0gZnVuY3Rpb24obXVsdGlFZGl0c1RvUHVzaCl7XG4gICAgdmFyIGVkaXRzID0ge307XG4gICAgXy5mb3JFYWNoKG11bHRpRWRpdHNUb1B1c2gsZnVuY3Rpb24oZWRpdHNUb1B1c2gpe1xuICAgICAgZWRpdHNbZWRpdHNUb1B1c2gubGF5ZXJuYW1lXSA9IGVkaXRzVG9QdXNoLmVkaXRzO1xuICAgIH0pO1xuICAgIHZhciBqc29uRGF0YSA9IEpTT04uc3RyaW5naWZ5KGVkaXRzKTtcbiAgICByZXR1cm4gJC5wb3N0KHtcbiAgICAgIHVybDogdGhpcy5jb25maWcuYmFzZXVybCxcbiAgICAgIGRhdGE6IGpzb25EYXRhLFxuICAgICAgY29udGVudFR5cGU6IFwiYXBwbGljYXRpb24vanNvblwiXG4gICAgfSk7XG4gIH07XG4gIFxuICB0aGlzLl91bmxvY2sgPSBmdW5jdGlvbigpe1xuICAgIHZhciBsYXllckNvZGVzID0gdGhpcy5nZXRMYXllckNvZGVzKCk7XG4gICAgLy8gZXNlZ3VvIGxlIHJpY2hpZXN0ZSBkZWxsZSBjb25maWd1cmF6aW9uaSBlIG1pIHRlbmdvIGxlIHByb21lc3NlXG4gICAgdmFyIHVubG9ja1JlcXVlc3RzID0gXy5tYXAobGF5ZXJDb2RlcyxmdW5jdGlvbihsYXllckNvZGUpe1xuICAgICAgcmV0dXJuIHNlbGYuX3VubG9ja0xheWVyKHNlbGYuY29uZmlnLmxheWVyc1tsYXllckNvZGVdKTtcbiAgICB9KTtcbiAgfTtcbiAgXG4gIHRoaXMuX3VubG9ja0xheWVyID0gZnVuY3Rpb24obGF5ZXJDb25maWcpe1xuICAgICQuZ2V0KHRoaXMuY29uZmlnLmJhc2V1cmwrbGF5ZXJDb25maWcubmFtZStcIi8/dW5sb2NrXCIpO1xuICB9O1xuICBcbiAgdGhpcy5fY3JlYXRlVmVjdG9yTGF5ZXIgPSBmdW5jdGlvbihvcHRpb25zLGRhdGEpe1xuICAgIHZhciB2ZWN0b3IgPSBuZXcgVmVjdG9yTGF5ZXIob3B0aW9ucyk7XG4gICAgcmV0dXJuIHZlY3RvcjtcbiAgfTtcbn1cbmluaGVyaXQoSXRlcm5ldFNlcnZpY2UsRzNXT2JqZWN0KTtcblxubW9kdWxlLmV4cG9ydHMgPSBuZXcgSXRlcm5ldFNlcnZpY2U7XG4iLCJ2YXIgaW5oZXJpdCA9IHJlcXVpcmUoJ2czdy9jb3JlL3V0aWxzJykuaW5oZXJpdDtcbnZhciByZXNvbHZlZFZhbHVlID0gcmVxdWlyZSgnZzN3L2NvcmUvdXRpbHMnKS5yZXNvbHZlZFZhbHVlO1xudmFyIHJlamVjdGVkVmFsdWUgPSByZXF1aXJlKCdnM3cvY29yZS91dGlscycpLnJlamVjdGVkVmFsdWU7XG52YXIgUHJvamVjdHNSZWdpc3RyeSA9IHJlcXVpcmUoJ2czdy9jb3JlL3Byb2plY3RzcmVnaXN0cnknKTtcbnZhciBQbHVnaW5zUmVnaXN0cnkgPSByZXF1aXJlKCdnM3cvY29yZS9wbHVnaW5zcmVnaXN0cnknKTtcbnZhciBHVUkgPSByZXF1aXJlKCdnM3cvZ3VpL2d1aScpO1xudmFyIEczV1BsdWdpbiA9IHJlcXVpcmUoJ2czdy9jb3JlL3BsdWdpbicpO1xuXG52YXIgU2VydmljZSA9IHJlcXVpcmUoJy4vaXRlcm5ldHNlcnZpY2UnKTtcblxudmFyIEVkaXRpbmdQYW5lbCA9IHJlcXVpcmUoJy4vZWRpdG9ycGFuZWwnKVxuXG5mdW5jdGlvbiBJdGVybmV0UGx1Z2luKCl7XG4gIHZhciBzZWxmID0gdGhpcztcbiAgdGhpcy5jb25maWcgPSBudWxsO1xuICB0aGlzLm5hbWUgPSBcIml0ZXJuZXRcIlxuICB0aGlzLnRvb2xzID0gW1xuICAgIHtcbiAgICAgIG5hbWU6IFwiSVRFUk5FVFwiLFxuICAgICAgYWN0aW9uczogW1xuICAgICAgICB7aWQ6IFwiaXRlcm5ldDpzdGFydEVkaXRpbmdcIiwgbmFtZTogXCJHZXN0aW9uZSBkYXRpXCJ9XG4gICAgICBdXG4gICAgfVxuICBdO1xuICBcbiAgdGhpcy5pbml0ID0gZnVuY3Rpb24oY29uZmlnKXtcbiAgICB0aGlzLmNvbmZpZyA9IGNvbmZpZztcbiAgfTtcbiAgXG4gIFByb2plY3RzUmVnaXN0cnkub25hZnRlcignc2V0Q3VycmVudFByb2plY3QnLGZ1bmN0aW9uKHByb2plY3Qpe1xuICAgIGlmIChzZWxmLmlzQ3VycmVudFByb2plY3RDb21wYXRpYmxlKSB7XG4gICAgICBTZXJ2aWNlLmluaXQoc2VsZi5jb25maWcpO1xuICAgICAgUGx1Z2luc1JlZ2lzdHJ5LmFjdGl2YXRlKHNlbGYpO1xuICAgIH1cbiAgfSlcbiAgXG4gIHRoaXMuaXNDdXJyZW50UHJvamVjdENvbXBhdGlibGUgPSBmdW5jdGlvbihjb25maWcpe1xuICAgIHZhciBnaWQgPSBjb25maWcuZ2lkO1xuICAgIHZhciBwcm9qZWN0ID0gUHJvamVjdHNSZWdpc3RyeS5nZXRDdXJyZW50UHJvamVjdCgpO1xuICAgIGlmIChnaWQgPT0gcHJvamVjdC5naWQpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH07XG4gIFxuICAvLyBtZXRvZG8gaW4gcmlzcG9zdGEgYWxsJ2F6aW9uZSBpdGVybmV0OnN0YXJ0RWRpdGluZzsgYWdnaXVuZ2UgaWwgcGFubmVsbG8gYWxsYSBzaWRlYmFyXG4gIHRoaXMuc3RhcnRFZGl0aW5nID0gZnVuY3Rpb24oKXtcbiAgICB2YXIgcGFuZWwgPSBuZXcgRWRpdGluZ1BhbmVsKCk7XG4gICAgR1VJLnNob3dQYW5lbChwYW5lbCk7XG4gIH07XG59XG5pbmhlcml0KEl0ZXJuZXRQbHVnaW4sRzNXUGx1Z2luKTtcblxubW9kdWxlLmV4cG9ydHMgPSBuZXcgSXRlcm5ldFBsdWdpbjtcbiJdfQ==
