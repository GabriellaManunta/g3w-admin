!function e(t,i,n){function r(s,a){if(!i[s]){if(!t[s]){var l="function"==typeof require&&require;if(!a&&l)return l(s,!0);if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var u=i[s]={exports:{}};t[s][0].call(u.exports,function(e){var i=t[s][1][e];return r(i?i:e)},u,u.exports,e,t,i,n)}return i[s].exports}for(var o="function"==typeof require&&require,s=0;s<n.length;s++)r(n[s]);return r}({1:[function(e,t,i){var n="G3W Client",r={},o={tools:[]},s={resources:e("./locales/app.js")},a={debug:!0,local:!1},l={urls:{baseurl:"/",ows:"ows",api:"api",initconfig:"api/initconfig",config:"api/config"}};t.exports={apptitle:n,client:a,server:l,plugins:r,tools:o,i18n:s}},{"./locales/app.js":2}],2:[function(e,t,i){var n={it:{translation:{component:"Componente Generico",search:"Ricerche",print:"Stampa",dosearch:"Cerca",catalog:"Mappa",baselayers:"Basi",tools:"Strumenti",tree:"Strati",legend:"Legenda",street_search:"Cerca indirizzo",show:"Mostra",hide:"Nascondi",copy_form_data:"Copia i dati del modulo",paste_form_data:"Incolla",copy_form_data_from_feature:"Copia i dati dalla mappa",could_not_load_vector_layers:"Errore di connessione al server: non è stato possibile caricare i vettoriali richiesti",input_validation_error:"Campo obbligatorio o valore non corretto"}},en:{translation:{component:"Componente Generico",search:"Ricerche",print:"Stampa",dosearch:"Cerca",catalog:"Mappa",baselayers:"Basi",tools:"Strumenti",tree:"Strati",legend:"Legenda",street_search:"Cerca indirizzo",show:"Mostra",hide:"Nascondi",copy_form_data:"Copia i dati del modulo",paste_form_data:"Incolla",copy_form_data_from_feature:"Copia i dati dalla mappa",could_not_load_vector_layers:"Errore di connessione al server: non è stato possibile caricare i vettoriali richiesti",input_validation_error:"Campo obbligatorio o valore non corretto"}}};t.exports=n},{}],3:[function(e,t,i){function n(){return{apptitle:c.apptitle||"",logo_img:c.group.header_logo_img,logo_link:c.group.header_logo_link,terms_of_use_text:c.group.header_terms_of_use_text,terms_of_use_link:c.group.terms_of_use_link,debug:c.client.debug||!1,group:c.group,urls:c.server.urls,mediaurl:c.server.urls.mediaurl,resourcesurl:c.server.urls.clienturl,vectorurl:c.server.urls.vectorurl,projects:c.group.projects,initproject:c.group.initproject,overviewproject:c.group.overviewproject&&c.group.overviewproject.gid?c.group.overviewproject:null,baselayers:c.group.baselayers,mapcontrols:c.group.mapcontrols,background_color:c.group.background_color,crs:c.group.crs,proj4:c.group.proj4,minscale:c.group.minscale,maxscale:c.group.maxscale,getWmsUrl:function(e){return c.server.urls.baseurl+c.server.urls.ows+"/"+c.group.id+"/"+e.type+"/"+e.id},getProjectConfigUrl:function(e){return c.server.urls.baseurl+c.server.urls.config+"/"+c.group.id+"/"+e.type+"/"+e.id},plugins:c.group.plugins,tools:c.tools,views:c.views||{},user:c.user||null}}function r(){var t=e("sdk").gui.vue.CatalogComponent,i=e("sdk").gui.vue.SearchComponent,n=e("sdk").gui.vue.PrintComponent,r=e("sdk").gui.vue.ToolsComponent,o=e("sdk").gui.vue.MapComponent,s=e("./template/js/contentsviewer"),a=e("sdk").gui.vue.QueryResultsComponent;return{title:c.apptitle,placeholders:{navbar:{components:[]},sidebar:{components:[new n({id:"print",open:!1,collapsible:!0,icon:"fa fa-print"}),new i({id:"search",open:!1,collapsible:!0,icon:"fa fa-search"}),new t({id:"catalog",open:!1,collapsible:!1,icon:"fa fa-map-o"}),new r({id:"tools",open:!1,collapsible:!0,icon:"fa fa-gears"})]},floatbar:{components:[]}},othercomponents:[new a({id:"queryresults"})],viewport:{components:{map:new o({id:"map"}),content:new s({id:"contents"})}}}}function o(e,t){t=t&&t.responseJSON&&t.responseJSON.error.data?t.responseJSON.error.data:"Errore di connessione",l.fail(e,t)}var s=e("sdk").core.i18n.init,a=e("sdk/sdk").core.ApplicationService,l=e("./template/js/template"),c=e("./config/config.js");window.g3wsdk=e("sdk"),s(c.i18n),a.on("ready",function(){var e=r();applicationTemplate=new l(e,this),applicationTemplate.init(),applicationTemplate.on("ready",function(){a.postBootstrap()})});var u=function(){a.obtainInitConfig(c.server.urls.initconfig).then(function(e){c.server.urls.baseurl=e.baseurl,c.server.urls.staticurl=e.staticurl,c.server.urls.clienturl=e.staticurl+e.client,c.server.urls.mediaurl=e.mediaurl,c.server.urls.vectorurl=e.vectorurl,c.group=e.group,c.user=e.user;var t=n();a.init(t,!0).then(function(){}).fail(function(e){o(u,e)})}).fail(function(e){o(u,e)})};u()},{"./config/config.js":1,"./template/js/contentsviewer":13,"./template/js/template":19,sdk:181,"sdk/sdk":181}],4:[function(e,t,i){t.exports='<div class="wrapper">\n  <header class="main-header">\n    <!-- Logo -->\n    <!-- Header Navbar: style can be found in header.less -->\n    <nav class="navbar navbar-static-top" role="navigation">\n      <!-- Toggle button on navbar only for mobile -->\n      <a v-if="isMobile()" href="#" class="sidebar-toggle" data-toggle="offcanvas" role="button">\n        <span class="sr-only">Expand</span>\n      </a>\n      <div class="logo-wrapper">\n        <a v-if="logo_url" :href="logo_link" :target="logo_link_target" class=""><img :src="logo_url" style="height:40px"></a>\n        <span class="">{{project_title}}</span>\n      </div>\n      <div v-if="user" class="navbar-custom-menu">\n        <ul class="nav navbar-nav">\n          <li class="dropdown user" v-if="numberOfProjectsInGroup > 1">\n            <a href="#" @click="openProjectsMenu" class="dropdown-toggle" data-toggle="dropdown">\n              <i class="fa fa-th" aria-hidden="true"></i>\n              <span> Cambia Mappa</span>\n            </a>\n          </li>\n          <li class="dropdown user user-menu">\n            <a href="#" class="dropdown-toggle" data-toggle="dropdown">\n              <i class="fa fa-user"></i>\n              <span class="hidden-xs">{{ user.username }}</span>\n            </a>\n            <ul class="dropdown-menu">\n              <li class="user-header">\n                <p>\n                  {{ user.first_name }} {{ user.last_name }}\n                </p>\n              </li>\n              <li class="user-footer">\n                <div class="pull-left">\n                  <a :href="user.admin_url" class="btn btn-default btn-flat"><i class="fa fa-folder"></i> Admin</a>\n                </div>\n                <div class="pull-right">\n                  <a :href="user.logout_url" class="btn btn-default btn-flat"><i class="fa fa-sign-out"></i>Sign out</a>\n                </div>\n              </li>\n            </ul>\n          </li>\n          <li class="dropdown user user-menu">\n            <a href="#" data-toggle="modal" data-target="#credits" class="dropdown-toggle">\n              <span>Credits</span>\n            </a>\n          </li>\n        </ul>\n      </div>\n    </nav>\n  </header>\n  <!-- Left side column. contains the logo and sidebar -->\n  <sidebar></sidebar>\n  <!-- Content Wrapper. Contains page content -->\n  <div class="content-wrapper" style="background-color:white">\n    <viewport></viewport>\n  </div>\n  <!-- /.content-wrapper -->\n  <!-- Control Sidebar -->\n  <floatbar></floatbar>\n  <!-- /.control-sidebar -->\n  <!-- Add the sidebar\'s background. This div must be placed\n       immediately after the control sidebar -->\n  <div class="control-sidebar-bg"></div>\n  <!--full screen modal element-->\n  <div class="modal fade modal-fullscreen force-fullscreen" id="full-screen-modal" tabindex="-1" role="dialog" data-backdrop="static" data-keyboard="false" aria-labelledby="full-screen-modal" aria-hidden="true"></div>\n  <!---->\n  <div id="credits" class="modal fade">\n    <div class="modal-dialog" role="document">\n      <div class="modal-content">\n        <div class="modal-header">\n          <button type="button" class="close" data-dismiss="modal" aria-label="Close">\n            <span aria-hidden="true">&times;</span>\n          </button>\n          <a style="text-align: center!important;" href="http://www.gis3w.it" target="_blank">\n            <img src="http://gis3w.it/wp-content/uploads/sites/7/2017/01/logo_gis3w_156_85.png?x22227" class="img-responsive center-block" alt="">\n            <div style="text-align: center!important; margin-bottom:50px; margin-top:20px; color:#000000">\n              <h4>GIS3W s.n.c.</h4>\n            </div>\n          </a>\n          <address id="address-credits" style="line-height: 2; text-align: center;">\n            <i class="fa fa-map-marker" aria-hidden="true"></i>\n            <span> Viale Verdi, 24 - Montecatini Terme (PT)</span></br>\n            <i class="fa fa-mobile" aria-hidden="true"></i>\n            <span> +39 347 6597931</span></br>\n            <i class="fa fa-fax" aria-hidden="true"></i>\n            <span> +39 0572 901639</span></br>\n            <i class="fa fa-envelope" aria-hidden="true">\n            </i>\n            <span><a href="mailto:info@gis3w.it" style="color:#000000"> info@gis3w.it</a></span>\n          </address>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n'},{}],5:[function(e,t,i){t.exports='<div id="contents" class="contents"></div>\n'},{}],6:[function(e,t,i){t.exports='<aside class="control-sidebar control-sidebar-light" >\n  <a v-show="panelsinstack" href="#" class="floatbar-aside-toggle" data-toggle="control-sidebar" role="button">\n    <span class="sr-only">Expand</span>\n  </a>\n  <div id="floatbar-spinner" style="position:absolute"></div>\n  <div v-show="panelsinstack" class="g3w-sidebarpanel">\n    <div v-if="closable" class="row">\n      <div class="col-xs-12 col-sm-12 col-md-12">\n        <button class="glyphicon glyphicon-remove pull-right close-panel-button" @click="closePanel"></button>\n      </div>\n    </div>\n    <div v-if="panelname">\n      <h4 class="g3w-floatbarpanel-name">{{ panelname }}</h4>\n    </div>\n    <div id="g3w-floatbarpanel-placeholder" class="g3w-floatbarpanel-placeholder"></div>\n  </div>\n</aside>\n'},{}],7:[function(e,t,i){t.exports='<div id="menu-projects" class="container nano">\n  <div v-show="loading" class="bar-loader"></div>\n  <div class="nano-content">\n    <div class="row row-equal">\n      <!-- item -->\n      <div v-for="menuitem in state.menuitems"  @click="trigger(menuitem)" class="col-xs-12 col-sm-4 project-menu">\n        <div class="project-menu-item-image">\n          <img :src="logoSrc(menuitem.thumbnail)" class="img-responsive">\n        </div>\n        <div class="project-menu-item-content">\n          <div class="project-menu-item-text">\n            <h4 class="project-menu-item-title">{{ menuitem.title }}</h4>\n            <div v-html="menuitem.description"></div>\n          </div>\n        </div>\n      </div>\n      <div v-if="!state.menuitems.length" style="margin-left:15px;">\n        <h2>Non ci sono altri progetti in questo gruppo cartografico</h2>\n      </div>\n    </div>\n  </div>\n</div>\n'},{}],8:[function(e,t,i){t.exports='<li  v-show="state.visible" class="treeview sidebaritem" :class="{\'active\': open}">\n  <a @click="onClickItem" href="#">\n    <i :class="icon"></i>\n    <span class="treeview-label">{{title | t}}</span>\n    <i class="fa fa-angle-left pull-right"></i>\n  </a>\n  <div id="g3w-sidebarcomponent-placeholder"></div>\n</li>\n'},{}],9:[function(e,t,i){t.exports='<aside class="main-sidebar">\n  <!-- sidebar: style can be found in sidebar.less -->\n  <!-- Sidebar toggle button-->\n  <!-- Toggle button on the left side of main sidebar only if not mobile -->\n  <a v-if="!isMobile()" href="#" class="sidebar-aside-toggle" data-toggle="offcanvas" role="button">\n    <span class="sr-only">Expand</span>\n  </a>\n  <!--<div class="quick-actions-menu">-->\n    <!--<button class="btn btn-default btn-circle-medium glyphicon glyphicon-share-alt"></button>-->\n    <!--<button class="btn btn-default btn-circle-medium glyphicon glyphicon-modal-window"></button>-->\n    <!--<button class="btn btn-default btn-circle-medium glyphicon glyphicon-print"></button>-->\n    <!--<button class="btn btn-default btn-circle-medium glyphicon glyphicon-search"></button>-->\n  <!--</div>-->\n\t<section class="sidebar">\n    <div v-show="panelsinstack" class="g3w-sidebarpanel">\n      <div style="overflow: hidden;line-height: 14px;margin-top: 4px; font-size:1.5em">\n          <button class="glyphicon glyphicon-remove pull-right close-panel-button" @click="closePanel"></button>\n      </div>\n      <div id="g3w-sidebarpanel-placeholder" class="g3w-sidebarpanel-placeholder"></div>\n    </div>\n\t  <ul id="g3w-sidebarcomponents" v-show="showmainpanel" class="sidebar-menu"></ul>\n\t</section>\n\t<!-- /.sidebar -->\n</aside>\n'},{}],10:[function(e,t,i){t.exports='<div class="g3w-viewport">\n  <div id="g3w-view-map" class="g3w-view map" :style="{width:state.map.sizes.width+\'px\',height:state.map.sizes.height+\'px\'}">\n  </div>\n  <div id="g3w-view-content" class="g3w-view content" :style="{width:state.content.sizes.width+\'px\',height:state.content.sizes.height+\'px\'}">\n    <div v-if="(showtitle && contentTitle) || previousTitle || (state.content.closable && state.content.aside)" class="close-panel-block">\n      <div v-if="previousTitle" class="g3w_contents_back">\n        <span  @click="gotoPreviousContent()"><span class="glyphicon glyphicon-chevron-left"></span> Torna  {{ previousTitle }}</span>\n      </div>\n      <button v-if="state.content.closable && state.content.aside" class="glyphicon glyphicon-remove pull-right close-panel-button" @click="closeContent"></button>\n      <div v-if="showtitle && contentTitle">\n        <span>{{ contentTitle }}</span>\n      </div>\n    </div>\n  </div>\n</div>\n'},{}],11:[function(e,t,i){var n=e("core/applicationservice"),r=e("core/project/projectsregistry"),o=e("./projectsmenu"),s=e("sdk/gui/gui"),a=e("./layout"),l=Vue.extend({template:e("../html/app.html"),mounted:function(){this.$nextTick(function(){function e(){$(i).css("max-height",$(window).innerHeight()),$(".g3w-sidebarpanel").css("height",$(window).height()-$(".main-header").height())}function t(){$("#g3w-modal-overlay").css("height",$(window).height())}a.loading(!1),a.setup(),a.pushMenu.expandOnHover(),a.controlSidebar._fix($(".control-sidebar-bg")),a.controlSidebar._fix($(".control-sidebar"));var i=a.options.controlSidebarOptions.selector;e(),$(window).resize(function(){e(),t()})})},computed:{logo_url:function(){var e,t=n.getConfig();return t.logo_img&&""!=t.logo_img&&(e=t.mediaurl+t.logo_img),e},logo_link:function(){var e=this.getLogoLink();return e?e:"#"},logo_link_target:function(){var e=this.getLogoLink();return e?"_blank":""},project_title:function(){var e=r.getCurrentProject();return e.state.name},user:function(){var e=n.getConfig().user;return _.isEmpty(e)&&(e=null),e},numberOfProjectsInGroup:function(){return r.getProjects().length}},methods:{closePanel:function(){sidebarService.closePanel()},isMobile:function(){return isMobile.any},getLogoLink:function(){var e=null;return n.getConfig().logo_link&&(e=n.getConfig().logo_link),e},openProjectsMenu:function(){var e=s.getComponent("contents");e.getComponentById("projectsmenu")?s.closeContent():s.setContent({content:new o,title:"",perc:100})}}});t.exports=l},{"../html/app.html":4,"./layout":15,"./projectsmenu":17,"core/applicationservice":22,"core/project/projectsregistry":71,"sdk/gui/gui":129}],12:[function(e,t,i){function n(){this._parent=null,this.state={contentsdata:[]}}var r=e("sdk/core/utils/utils"),o=e("sdk/core/utils/utils").inherit,s=e("sdk/core/g3wobject"),a=e("gui/vue/component"),l=e("gui/panel");o(n,s);var c=n.prototype;c.push=function(e,t){return this._parent=t.parent,this._mount(e,t)},c.pop=function(){var e=this,t=$.Deferred();if(this.state.contentsdata.length){var i=this.state.contentsdata.slice(-1)[0].content;return this._unmount(i).then(function(){e.state.contentsdata.pop()})}return t.resolve(),t.promise()},c.clear=function(){var e=this,t=$.Deferred();if(this.state.contentsdata.length){var i=[];_.forEach(this.state.contentsdata,function(t,n){i.push(e._unmount(t.content))}),$.when(i).then(function(){e.state.contentsdata.splice(0,e.state.contentsdata.length),t.resolve()})}else t.resolve();return t.promise()},c.getContentData=function(){return this.state.contentsdata},c.getCurrentContentData=function(){return this.state.contentsdata[this.state.contentsdata.length-1]},c.getPreviousContentData=function(){return this.state.contentsdata[this.state.contentsdata.length-2]},c._mount=function(e,t){if(e instanceof jQuery)return this._setJqueryContent(e);if(_.isString(e)){var i=$(e);return i.length||(i=$("<div>"+e+"</div>")),this._setJqueryContent(i)}return e.mount&&"function"==typeof e.mount?(this._checkDuplicateVueContent(e),this._setVueContent(e,t)):this._setDOMContent(e)},c._setJqueryContent=function(e,t){return $(this._parent).append(e),this.state.contentsdata.push({content:e,options:t}),r.resolve()},c._setDOMContent=function(e,t){return this._parent.appendChild(e),this.state.contentsdata.push({content:e,options:t}),r.resolve()},c._setVueContent=function(e,t){var i=this,n=$.Deferred(),r=t.append||!1;return e.mount(this._parent,r).then(function(){$(parent).localize(),i.state.contentsdata.push({content:e,options:t}),n.resolve()}),n.promise()},c._checkDuplicateVueContent=function(e){var t=this,i=null,n=e.getId();if(_.forEach(this.state.contentsdata,function(e,t){e.content.getId&&e.content.getId()==n&&(i=t)}),!_.isNull(i)){var r=t.state.contentsdata[i];r.content.unmount().then(function(){t.state.contentsdata.splice(i,1)})}},c._unmount=function(e){var t=$.Deferred();return e instanceof a||e instanceof l?e.unmount().then(function(){t.resolve()}):($(this._parent).empty(),t.resolve()),t.promise()},c.forEach=function(e){_.forEach(this.state.contentsdata,function(t){e(t.content)})},c.getLength=function(){return this.state.contentsdata.length},t.exports=n},{"gui/panel":150,"gui/vue/component":179,"sdk/core/g3wobject":30,"sdk/core/utils/utils":77}],13:[function(e,t,i){function n(e){o(this,e),this.stack=new s,this.setService(this),this.title="contents",this.contentsdata=this.stack.state.contentsdata,this.state.visible=!0,this.setInternalComponent(new l({service:this})),this.internalComponent.state=this.state}var r=e("core/utils/utils").inherit,o=e("core/utils/utils").base,s=e("./barstack.js"),a=e("gui/vue/component"),l=Vue.extend({template:e("../html/contentsviewer.html"),data:function(){return{state:null}}});r(n,a);var c=n.prototype;c.setContent=function(e){var t=this,i=$.Deferred(),n=e.push||!1,r=e.content;return n?this.addContent(r,e).then(function(){i.resolve()}):this.clearContents().then(function(){t.addContent(r,e).then(function(){i.resolve()})}),this.setOpen(!0),i.promise()},c.addContent=function(e,t){var i=this;return t.parent=this.internalComponent.$el,t.append=!0,this.stack.push(e,t).then(function(){i.contentsdata=i.stack.state.contentsdata,i.updateContentVisibility()})},c.removeContent=function(){return this.setOpen(!1),this.clearContents()},c.popContent=function(){var e=this;return this.stack.pop().then(function(){e.contentsdata=e.stack.state.contentsdata,e.updateContentVisibility()})},c.getComponentByClass=function(e){var t,i=this.stack.getContentData();return _.forEach(i,function(i){if(i.content instanceof e)return t=i.content,!1}),t},c.getComponentById=function(e){var t,i=this.stack.getContentData();return _.forEach(i,function(i){if(i.content.id==e)return t=i.content,!1}),t},c.getContentData=function(){return this.stack.getContentData()},c.getCurrentContentData=function(){return this.stack.getCurrentContentData()},c.getPreviousContentData=function(){return this.stack.getPreviousContentData()},c.updateContentVisibility=function(){var e=$(this.internalComponent.$el).children();e.hide(),e.last().show()},c.clearContents=function(){var e=this;return this.stack.clear().then(function(){e.contentsdata=e.stack.state.contentsdata})},c.layout=function(e,t){var i=this,n=$(this.internalComponent.$el);Vue.nextTick(function(){var t=n.parent().height()-n.siblings(".close-panel-block").outerHeight(!0)-n.siblings(".g3w_contents_back").outerHeight(!0);n.height(t),n.children().first().height(t);var r=i.stack.state.contentsdata;r.forEach(function(i){"function"==typeof i.content.layout&&i.content.layout(e,t)})})},t.exports=n},{"../html/contentsviewer.html":5,"./barstack.js":12,"core/utils/utils":77,"gui/vue/component":179}],14:[function(e,t,i){function n(){this.stack=new r,this.init=function(e){this.layout=e,this.sidebarEl=$(this.layout.options.controlSidebarOptions.selector),this._zindex=this.sidebarEl.css("z-index"),this._modalOverlay=null,this._modal=!1,this._isopen=!1},this.isOpen=function(){return this._isopen},this.open=function(){this.layout.floatBar.open(this.sidebarEl,!0),this._isopen=!0},this.close=function(){this.layout.floatBar.close(this.sidebarEl,!0),this._isopen=!1},this.showPanel=function(e,t){var t=t||{};t.append||!1,t.modal||!1;t.parent="#g3w-floatbarpanel-placeholder",this.stack.push(e,t),this._isopen||this.open()},this.closePanel=function(e){e?this.stack.remove(e):this.stack.pop(),this.stack.getLength()||(this._modal?(o.setModal(!1),this.close(),$(".control-sidebar-bg").toggleClass("control-sidebar-bg-shadow"),this.sidebarEl.css("z-index",""),this.sidebarEl.css("padding-top","50px"),$(".control-sidebar-bg").css("z-index",""),this._modal=!1):this.close())},this.hidePanel=function(){this.close()}}var r=(e("sdk/core/i18n/i18n.service").t,e("./barstack.js")),o=e("sdk/gui/gui"),s=new n,a=Vue.extend({template:e("../html/floatbar.html"),data:function(){return{stack:s.stack.state}},computed:{panelsinstack:function(){return this.stack.contentsdata.length>0},panelname:function(){var e;return this.stack.contentsdata.length&&(e=this.stack.contentsdata.slice(-1)[0].content.getTitle()),e},closable:function(){return s.closable}},watch:{"stack.contentsdata":function(){var e=$("#g3w-floatbarpanel-placeholder").children();_.forEach(e,function(t,i){i==e.length-1?$(t).show():$(t).hide()})}},methods:{closePanel:function(){s.closePanel()}}});t.exports={FloatbarService:s,FloatbarComponent:a}},{"../html/floatbar.html":6,"./barstack.js":12,"sdk/core/i18n/i18n.service":33,"sdk/gui/gui":129}],15:[function(e,t,i){if("undefined"==typeof jQuery)throw new Error("LayoutManager requires jQuery");$.LayoutManager={},$.LayoutManager.options={navbarMenuSlimscroll:!0,navbarMenuSlimscrollWidth:"0px",navbarMenuHeight:"200px",animationSpeed:"fast",sidebarToggleSelector:"[data-toggle='offcanvas']",sidebarPushMenu:!0,sidebarSlimScroll:!0,sidebarExpandOnHover:!1,enableBoxRefresh:!0,enableBSToppltip:!0,BSTooltipSelector:"[data-toggle='tooltip']",enableFastclick:!0,enableControlSidebar:!0,controlSidebarOptions:{toggleBtnSelector:"[data-toggle='control-sidebar']",selector:".control-sidebar",slide:!0},enableBoxWidget:!0,boxWidgetOptions:{boxWidgetIcons:{collapse:"fa-minus",open:"fa-plus",remove:"fa-times"},boxWidgetSelectors:{remove:'[data-widget="remove"]',collapse:'[data-widget="collapse"]'}},directChat:{enable:!0,contactToggleSelector:'[data-widget="chat-pane-toggle"]'},colors:{lightBlue:"#3c8dbc",red:"#f56954",green:"#00a65a",aqua:"#00c0ef",yellow:"#f39c12",blue:"#0073b7",navy:"#001F3F",teal:"#39CCCC",olive:"#3D9970",lime:"#01FF70",orange:"#FF851B",fuchsia:"#F012BE",purple:"#8E24AA",maroon:"#D81B60",black:"#222222",gray:"#d2d6de"},screenSizes:{xs:480,sm:768,md:992,lg:1200}},$.LayoutManager._init=function(){"use strict";return $.LayoutManager.layout={activate:function(){var e=this;e.fix(),e.fixSidebar(),$(window,".wrapper").resize(function(){e.fix(),e.fixSidebar()})},fix:function(){var e=$(".main-header").outerHeight()+$(".main-footer").outerHeight(),t=$(window).height(),i=$(".sidebar").height();if($("body").hasClass("fixed"))$(".content-wrapper, .right-side").css("min-height",t-$(".main-footer").outerHeight()),$(".content-wrapper, .right-side").css("height",t-$(".main-footer").outerHeight());else{var n;t>=i?($(".content-wrapper, .right-side").css("min-height",t-e),n=t-e):($(".content-wrapper, .right-side").css("min-height",i),n=i);var r=$($.LayoutManager.options.controlSidebarOptions.selector);"undefined"!=typeof r&&r.height()>n&&$(".content-wrapper, .right-side").css("min-height",r.height())}},fixSidebar:function(){return $("body").hasClass("fixed")?("undefined"==typeof $.fn.slimScroll&&window.console&&window.console.error("Error: the fixed layout requires the slimscroll plugin!"),void($.LayoutManager.options.sidebarSlimScroll?"undefined"!=typeof $.fn.slimScroll&&($(".sidebar").slimScroll({destroy:!0}).height("auto"),$(".sidebar").slimscroll({height:$(window).height()-$(".main-header").height()+"px",color:"rgba(255,255,255,0.7)",size:"3px"})):$(".sidebar").css({height:$(window).height()-$(".main-header").height()+"px"}))):void("undefined"!=typeof $.fn.slimScroll&&$(".sidebar").slimScroll({destroy:!0}).height("auto"))}},$.LayoutManager.pushMenu={activate:function(e){var t=$.LayoutManager.options.screenSizes;$(e).on("click",function(e){e.preventDefault(),$(window).width()>t.sm-1?$("body").hasClass("sidebar-collapse")?$("body").removeClass("sidebar-collapse").trigger("expanded.pushMenu"):$("body").addClass("sidebar-collapse").trigger("collapsed.pushMenu"):$("body").hasClass("sidebar-open")?$("body").removeClass("sidebar-open").removeClass("sidebar-collapse").trigger("collapsed.pushMenu"):$("body").addClass("sidebar-open").trigger("expanded.pushMenu")}),($.LayoutManager.options.sidebarExpandOnHover||$("body").hasClass("fixed")&&$("body").hasClass("sidebar-mini"))&&this.expandOnHover()},expandOnHover:function(){var e=this,t=$.LayoutManager.options.screenSizes.sm-1;$(".main-sidebar").hover(function(){$("body").hasClass("sidebar-mini")&&$("body").hasClass("sidebar-collapse")&&$(window).width()>t&&e.expand()},function(){$("body").hasClass("sidebar-mini")&&$("body").hasClass("sidebar-expanded-on-hover")&&$(window).width()>t&&e.collapse()})},expand:function(){$("body").removeClass("sidebar-collapse").addClass("sidebar-expanded-on-hover")},collapse:function(){$("body").hasClass("sidebar-expanded-on-hover")&&$("body").removeClass("sidebar-expanded-on-hover").addClass("sidebar-collapse")}},$.LayoutManager.tree=function(e){var t=this,i=$.LayoutManager.options.animationSpeed;$(document).on("click",e+" li a",function(e){var n=$(this),r=n.next();if(r.is(".treeview-menu")&&r.is(":visible"))r.slideUp(i,function(){r.parent("li.treeview").removeClass("active"),r.removeClass("menu-open")});else if(r.is(".treeview-menu")&&!r.is(":visible")){var o,s=n.parents("ul").first(),a=n.parent("li"),l=a.siblings(),c=(s.height()-s.find("li.header").outerHeight(),a.outerHeight());l.not(".header").each(function(e,t){c+=$(t).find("a").outerHeight()});var u=s.find("ul.treeview-menu:visible").slideUp(i);u.removeClass("menu-open"),r.slideDown(i,function(){r.addClass("menu-open"),o=s.find("li.treeview.active"),o.removeClass("active"),a.addClass("active"),t.layout.fix()})}r.is(".treeview-menu")&&e.preventDefault()})},$.LayoutManager.floatBar=$.LayoutManager.controlSidebar={activate:function(){var e=this,t=$.LayoutManager.options.controlSidebarOptions,i=$(t.selector),n=$(t.toggleBtnSelector);n.on("click",function(n){n.preventDefault(),i.hasClass("control-sidebar-open")||$("body").hasClass("control-sidebar-open")?e.close(i,t.slide):e.open(i,t.slide)});var r=$(".control-sidebar-bg");e._fix(r),$("body").hasClass("fixed")?e._fixForFixed(i):$(".content-wrapper, .right-side").height()<i.height()&&e._fixForContent(i)},open:function(e,t){t?e.addClass("control-sidebar-open"):$("body").addClass("control-sidebar-open")},close:function(e,t){t?e.removeClass("control-sidebar-open"):$("body").removeClass("control-sidebar-open")},_fix:function(e){var t=this;$("body").hasClass("layout-boxed")?(e.css("position","absolute"),e.height($(".wrapper").height()),$(window).resize(function(){t._fix(e)})):e.css({position:"fixed",height:"auto"})},_fixForFixed:function(e){e.css({position:"fixed","max-height":"100%","padding-bottom":"50px"})},_fixForContent:function(e){$(".content-wrapper, .right-side").css("min-height",e.height())}},$.LayoutManager.boxWidget={selectors:$.LayoutManager.options.boxWidgetOptions.boxWidgetSelectors,icons:$.LayoutManager.options.boxWidgetOptions.boxWidgetIcons,animationSpeed:$.LayoutManager.options.animationSpeed,activate:function(e){var t=this;e||(e=document),$(e).on("click",t.selectors.collapse,function(e){e.preventDefault(),t.collapse($(this))}),$(e).on("click",t.selectors.remove,function(e){e.preventDefault(),t.remove($(this))})},collapse:function(e){var t=this,i=e.parents(".box").first(),n=i.find("> .box-body, > .box-footer, > form  >.box-body, > form > .box-footer");i.hasClass("collapsed-box")?(e.find(".btn-collapser").removeClass(t.icons.open).addClass(t.icons.collapse),n.slideDown(t.animationSpeed,function(){i.removeClass("collapsed-box")})):(e.find(".btn-collapser").removeClass(t.icons.collapse).addClass(t.icons.open),n.slideUp(t.animationSpeed,function(){i.addClass("collapsed-box")}))},remove:function(e){var t=e.parents(".box").first();t.slideUp(this.animationSpeed)}},$.LayoutManager},$.LayoutManager.addRefreshButton=function(){"use strict";return $.fn.boxRefresh=function(e){function t(e){e.append(r),n.onLoadStart.call(e)}function i(e){e.find(r).remove(),n.onLoadDone.call(e)}var n=$.extend({trigger:".refresh-btn",source:"",onLoadStart:function(e){return e},onLoadDone:function(e){return e}},e),r=$('<div class="overlay"><div class="fa fa-refresh fa-spin"></div></div>');return this.each(function(){if(""===n.source)return void(window.console&&window.console.log("Please specify a source first - boxRefresh()"));var e=$(this),r=e.find(n.trigger).first();r.on("click",function(r){r.preventDefault(),t(e),e.find(".box-body").load(n.source,function(){i(e)})})})},$.LayoutManager},$.LayoutManager.activateBox=function(){"use strict";return $.fn.activateBox=function(){$.LayoutManager.boxWidget.activate(this)},$.LayoutManager},$.LayoutManager.listCustomPlugin=function(){"use strict";return $.fn.todolist=function(e){var t=$.extend({onCheck:function(e){return e},onUncheck:function(e){return e}},e);return this.each(function(){"undefined"!=typeof $.fn.iCheck?($("input",this).on("ifChecked",function(){var e=$(this).parents("li").first();e.toggleClass("done"),t.onCheck.call(e)}),$("input",this).on("ifUnchecked",function(){var e=$(this).parents("li").first();e.toggleClass("done"),t.onUncheck.call(e)})):$("input",this).on("change",function(){var e=$(this).parents("li").first();e.toggleClass("done"),$("input",e).is(":checked")?t.onCheck.call(e):t.onUncheck.call(e)})})},$.LayoutManager},$.LayoutManager.setup=function(){"use strict";$("body").removeClass("hold-transition"),"undefined"!=typeof LayoutManagerOptions&&$.extend(!0,$.LayoutManager.options,LayoutManagerOptions);var e=$.LayoutManager.options;return $.LayoutManager._init(),$.LayoutManager.layout.activate(),$.LayoutManager.tree(".sidebar"),e.enableControlSidebar&&$.LayoutManager.controlSidebar.activate(),e.navbarMenuSlimscroll&&"undefined"!=typeof $.fn.slimscroll&&$(".navbar .menu").slimscroll({height:e.navbarMenuHeight,alwaysVisible:!1,size:e.navbarMenuSlimscrollWidth}).css("width","100%"),e.sidebarPushMenu&&$.LayoutManager.pushMenu.activate(e.sidebarToggleSelector),e.enableBSToppltip&&$("body").tooltip({selector:e.BSTooltipSelector}),e.enableBoxWidget&&$.LayoutManager.boxWidget.activate(),e.enableFastclick&&"undefined"!=typeof FastClick&&FastClick.attach(document.body),e.directChat.enable&&$(document).on("click",e.directChat.contactToggleSelector,function(){var e=$(this).parents(".direct-chat").first();e.toggleClass("direct-chat-contacts-open")}),$('.btn-group[data-toggle="btn-toggle"]').each(function(){var e=$(this);$(this).find(".btn").on("click",function(t){e.find(".btn.active").removeClass("active"),$(this).addClass("active"),t.preventDefault()})}),$.LayoutManager.addRefreshButton().activateBox().listCustomPlugin()},$.LayoutManager.loading=function(e){$("#initerror").remove();var e=!_.isBoolean(e)||e;e?$("body").append('<div id="loadspinner" class="loading"></div>'):$("#loadspinner").remove();
},$.LayoutManager.reload=function(e){$("body").append('<div id="initerror"><h2>Oops!!! Si è verificato un errore</h2><h4>Causa:  '+e+'</h4><h5>Al momento non è possibile caricare la mappa</h5><button id="reload" type="button" class="btn btn-primary center-block" onclick="$.LayoutManager.loading();$.LayoutManager.bootstrap()"><span class="glyphicon glyphicon-refresh"></span> <strong>Riprova</strong></button></div>')},t.exports=$.LayoutManager},{}],16:[function(e,t,i){function n(e){e=e||{},o(this,e),this.title=e.title||"menu",this.state.visible=!0,this.state.menuitems=e.menuitems,s(this,e),this.internalComponent=new u({service:this}),this.internalComponent.state=this.state}var r=(e("core/i18n/i18n.service").t,e("core/utils/utils").inherit),o=e("core/utils/utils").base,s=e("core/utils/utils").merge,a=e("gui/vue/component"),l=e("gui/gui"),c=e("core/project/projectsregistry"),u=Vue.extend({template:e("../html/menu.html"),data:function(){return{state:null,loading:!1}},methods:{trigger:function(e){var t=this;e.cbk?($("#full-screen-modal").modal("show"),this.loading=!0,e.cbk.apply(e).then(function(){t.loading=!1,$("#full-screen-modal").modal("hide")}).fail(function(){l.notify.error("<h4>Errore di caricamento della nuova mappa.</h4><h5>Controllare la connessione internet o contattare l'amministratore</h5>"),$("#full-screen-modal").modal("hide"),t.loading=!1})):e.href?window.open(e.href,"_blank"):e.route?l["goto"](e.route):console.log("Nessuna azione per "+e.title)},logoSrc:function(e){return e.indexOf("./")>-1?c.config.mediaurl+e:e}},mounted:function(){Vue.nextTick(function(){$("#menu-projects.nano").nanoScroller()})}});r(n,a);var h=n.prototype;h.trigger=function(e){},t.exports=n},{"../html/menu.html":7,"core/i18n/i18n.service":33,"core/project/projectsregistry":71,"core/utils/utils":77,"gui/gui":129,"gui/vue/component":179}],17:[function(e,t,i){function n(e){e=e||{},e.id="projectsmenu",o(this,e);var t=[],i=s.getListableProjects();_.forEach(i,function(e){t.push({title:e.title,description:e.description,thumbnail:e.thumbnail,cbk:function(){var t,i=$.Deferred();return s.getProject(e.gid).then(function(e){u.closeContent().then(function(){t=e;var n=window.location.href,r=n.split("/");r[r.length-1]?(r[r.length-1]=e.getId(),r[r.length-2]=e.getType()):(r[r.length-2]=e.getId(),r[r.length-3]=e.getType()),history.pushState(null,null,r.join("/")),s.setCurrentProject(t),a.reloadPlugins(e),c.reloadComponents(),i.resolve()})}).fail(function(){i.reject()}),i.promise()}})}),this.state.menuitems=t}var r=(e("core/i18n/i18n.service").t,e("core/utils/utils").inherit),o=e("core/utils/utils").base,s=e("core/project/projectsregistry"),a=e("core/plugin/pluginsregistry"),l=e("./menu"),c=e("./sidebar").SidebarService,u=e("sdk").gui.GUI;r(n,l),t.exports=n},{"./menu":16,"./sidebar":18,"core/i18n/i18n.service":33,"core/plugin/pluginsregistry":66,"core/project/projectsregistry":71,"core/utils/utils":77,sdk:181}],18:[function(e,t,i){function n(){this.stack=new s,this.setters={closeSidebarPanel:function(){},openCloseItem:function(e){}},this.state={components:[]},this.init=function(e){this.layout=e},this.addComponents=function(e){var t=this;return _.forEach(e,function(e){t.addComponent(e)}),!0},this.addComponent=function(e,t){var i=new c({service:this});i.title=e.title||i.title,i.open=e.state.open,i.icon=e.icon||i.icon,i.state=e.state||!0,i.collapsible=e.collapsible||!0,i.component=e;var n=i.$mount();return _.isNil(t)?(this.state.components.push(e),$("#g3w-sidebarcomponents").append(n.$el)):(this.state.components=this.state.components.splice(0,0,e),$("#g3w-sidebarcomponents").children().each(function(e,i){t==e&&$(n.$el).insertBefore(i)})),e.mount("#g3w-sidebarcomponent-placeholder"),_.has(e,"initService")&&e.initService(),!0},this.getComponent=function(e){var t;return _.forEach(this.state.components,function(i){if(i.getId()==e)return t=i,!1}),t},this.getComponents=function(){return this.state.components},this.reloadComponent=function(e){var t=this.getComponent(e);t.reload()},this.reloadComponents=function(){this.closePanel(),_.forEach(this.state.components,function(e){e.collapsible&&e.state.open&&($(e.getInternalComponent().$el).siblings().click(),e.setOpen(!1)),e.reload()})},this.removeComponent=function(e){var t=this;_.forEach(this.state.components,function(i,n){if(e==i)return e.unmount(),t.state.components.splice(n,1),!1})},this.showPanel=function(e){var t="#g3w-sidebarpanel-placeholder";this.stack.push(e,{parent:t})},this.closePanel=function(){this.closeSidebarPanel();this.stack.pop()},l(this)}var r=e("sdk/core/i18n/i18n.service").t,o=e("sdk/core/utils/utils").inherit,s=e("./barstack.js"),a=e("sdk/core/g3wobject"),l=e("sdk/core/utils/utils").base,c=Vue.extend({template:e("../html/sidebar-item.html"),data:function(){return{main:!0,component:null,active:!1,title:"component",open:!1,icon:null,state:null}},methods:{onClickItem:function(){var e=this,t=this.$options.service;this.component.setOpen(!this.component.state.open),_.forEach(t.state.components,function(t){t!=e.component&&e.component.collapsible&&t.setOpen(!1)})}}});o(n,a);var u=new n,h=Vue.extend({template:e("../html/sidebar.html"),data:function(){return{components:u.state.components,panels:u.stack.state.contentsdata,bOpen:!0,bPageMode:!1,header:r("main navigation")}},computed:{panelsinstack:function(){return this.panels.length>0},showmainpanel:function(){return this.components.length>0&&!this.panelsinstack},componentname:function(){var e="";return this.components.length&&(e=this.components.slice(-1)[0].getTitle()),e},panelname:function(){var e="";return this.panels.length&&(e=this.panels.slice(-1)[0].content.getTitle()),e}},methods:{closePanel:function(){u.closePanel()},isMobile:function(){return isMobile.any}}});t.exports={SidebarService:u,SidebarComponent:h}},{"../html/sidebar-item.html":8,"../html/sidebar.html":9,"./barstack.js":12,"sdk/core/g3wobject":30,"sdk/core/i18n/i18n.service":33,"sdk/core/utils/utils":77}],19:[function(e,t,i){var n=e("sdk/core/i18n/i18n.service").t;e("sdk/gui/vue/vue.directives");var r=e("core/utils/utils").inherit,o=e("core/utils/utils").base,s=e("core/g3wobject"),a=e("sdk/gui/componentsregistry"),l=e("sdk/gui/gui"),c=e("./sidebar"),u=e("./floatbar"),h=e("./viewport"),p=e("./applicationui"),d=e("./layout");d.loading(!0);var f=function(t,i){self=this,this.templateConfig=t,this.init=function(){i.getConfig();this._setupInterface(),this._setupLayout(),this._setUpServices()},this._setupLayout=function(){Vue.filter("t",function(e){return n(e)}),isMobile.any||$("<style type='text/css'> .ol-control-tl {top: 7px;left:43px;}</style>").appendTo("head"),Vue.component("sidebar",c.SidebarComponent),Vue.component("viewport",h.ViewportComponent),Vue.component("floatbar",u.FloatbarComponent),Vue.component("app",p);new Vue({el:"#app",mounted:function(){self._buildTemplate(),$(document).localize(),this.$nextTick(function(){self._setViewport(self.templateConfig.viewport),self.emit("ready"),l.ready()})}})},this._setUpServices=function(){_.forEach(f.Services,function(e,t){i.registerService(t,e)}),_.forEach(l.getComponents(),function(e){i.registerService(e.id,e.getService())})},this._buildTemplate=function(){var e=this;u.FloatbarService.init(d);var t=this.templateConfig.placeholders;_.forEach(t,function(t,i){e._addComponents(t.components,i)}),this._addOtherComponents()},this._addOtherComponents=function(){var e=this;this.templateConfig.othercomponents&&e._addComponents(this.templateConfig.othercomponents)},this._setViewport=function(e){e&&(f.Services.viewport.init(e),this._addComponents(e.components))},this._addComponent=function(e,t){this._addComponents([e],t)},this._addComponents=function(e,t){var i=!0;if(t&&f.PLACEHOLDERS.indexOf(t)>-1){var n=f.Services[t];n&&(i=n.addComponents(e))}_.forEach(e,function(e){i&&a.registerComponent(e)})},this._removeComponent=function(e){a.unregisterComponent(e)},this._showModalOverlay=function(e){var t=l.getComponent("map").getService();e?t.startDrawGreyCover():t.stopDrawGreyCover()},this._showSidebar=function(){},this._hideSidebar=function(){},this._setupInterface=function(){l.layout=d,l.addComponent=_.bind(this._addComponent,this),l.removeComponent=_.bind(this._removeComponent,this),l.getResourcesUrl=_.bind(function(){return i.getConfig().resourcesurl},this),l.showList=_.bind(u.FloatbarService.showPanel,u.FloatbarService),l.closeList=_.bind(u.FloatbarService.closePanel,u.FloatbarService),l.hideList=_.bind(u.FloatbarService.hidePanel,u.FloatbarService),l.showTable=function(){},l.closeTable=function(){},l.showContentFactory=function(e){var t;switch(e){case"query":t=l.showQueryResults;break;case"form":t=l.showForm}return t},l.showForm=function(t){var i=e("sdk").gui.vue.FormComponent,n=t.formComponent?new t.formComponent(t):new i(t),r=n.getService();return l.setContent({content:n,push:!!t.push,showgoback:!!t.showgoback,closable:!1}),r},l.closeForm=function(){h.ViewportService.removeContent(),l.setModal(!1)},l.hideContent=function(e,t){return h.ViewportService.hideContent(e,t)},l.closeContent=function(){return h.ViewportService.closeContent()},l.showQueryResults=function(e,t){var i=l.getComponent("queryresults"),n=i.getService();n.reset(),t&&n.setQueryResponse(t);var r=l.getComponent("contents");return!r.getContentData().length||1==r.getContentData().length&&"queryresults"==r.getCurrentContentData().content.getId()?l.showContextualContent({content:i,title:"Risultati "+e}):("queryresults"==r.getCurrentContentData().content.getId()&&r.popContent(),l.pushContent({content:i,backonclose:!0,closable:!1,perc:50,title:"Risultati "+e})),n},l.showPanel=_.bind(c.SidebarService.showPanel,c.SidebarService),l.closePanel=_.bind(c.SidebarService.closePanel,c.SidebarService),toastr.options.positionClass="toast-top-center",toastr.options.preventDuplicates=!0,toastr.options.timeOut=2e3,l.notify=toastr,l.dialog=bootbox,l.showSpinner=function(e){var t=e.container||"body",i=e.id||"loadspinner",n=e.where||"prepend",r=e.style||"",o=e.transparent?"background-color: transparent":"",s=e.center?"margin: auto":"";$("#"+i).length||$(t)[n].call($(t),'<div id="'+i+'" class="spinner-wrapper '+r+'" style="'+o+'"><div class="spinner '+r+'" style="'+s+'"></div></div>')},l.hideSpinner=function(e){$("#"+e).remove()},l.showFloatbar=function(){u.FloatbarService.open()},l.hideFloatbar=function(){u.FloatbarService.close()},l.showSidebar=_.bind(this._showSidebar,this),l.hideSidebar=_.bind(this._hideSidebar,this),l.setModal=_.bind(this._showModalOverlay,this),l.setPrimaryView=function(e){h.ViewportService.setPrimaryView(e)},l.showMap=function(){h.ViewportService.showMap()},l.showContextualMap=function(e,t){e=e||30,h.ViewportService.showContextualMap({perc:e,split:t})},l.setContextualMapComponent=function(e){h.ViewportService.setContextualMapComponent(e)},l.resetContextualMapComponent=function(){h.ViewportService.resetContextualMapComponent()},l.showContent=function(e){e=e||{},e.perc=100,l.setContent(e)},l.showContextualContent=function(e){e=e||{},e.perc=e.perc||50,l.setContent(e)},l.pushContent=function(e){e=e||{},e.perc=e.perc||100,e.push=!0,l.setContent(e)},l.pushContextualContent=function(e){e=e||{},e.perc=e.perc||50,e.push=!0,l.setContent(e)},l.popContent=function(){h.ViewportService.popContent()},l.setContent=function(e){e=e||{},e.content=e.content||null,e.title=e.title||"",e.push=!!_.isBoolean(e.push)&&e.push,e.perc=e.perc||0,e.split=e.split||"h",e.backonclose=!!_.isBoolean(e.backonclose)&&e.backonclose,e.showtitle=!_.isBoolean(e.showtitle)||e.showtitle,h.ViewportService.showContent(e)}},o(this)};r(f,s),f.fail=function(e,t){d.loading(!1),d.bootstrap||(d.bootstrap=e),d.reload(t)},f.PLACEHOLDERS=["navbar","sidebar","viewport","floatbar"],f.Services={navbar:null,sidebar:c.SidebarService,viewport:h.ViewportService,floatbar:c.FloatbarService},t.exports=f},{"./applicationui":11,"./floatbar":14,"./layout":15,"./sidebar":18,"./viewport":20,"core/g3wobject":30,"core/utils/utils":77,sdk:181,"sdk/core/i18n/i18n.service":33,"sdk/gui/componentsregistry":119,"sdk/gui/gui":129,"sdk/gui/vue/vue.directives":180}],20:[function(e,t,i){var n=e("sdk").core.utils.inherit,r=e("sdk").core.utils.base,o=e("sdk").core.G3WObject,s=e("sdk").gui.GUI,a=function(){this.state={primaryView:"map",secondaryPerc:0,split:"h",map:{sizes:{width:0,height:0},aside:!1},content:{sizes:{width:0,height:0},aside:!0,showgoback:!0,stack:[],closable:!0,backonclose:!1,contentsdata:[]}},this._components={map:null,content:null},this._defaultMapComponent,this._contextualMapComponent,this._secondaryViewMinWidth=300,this._secondaryViewMinHeight=200,this._immediateComponentsLayout=!0,this.init=function(e){var e=e||{};this.state.primaryView=e.primaryview?e.primaryview:"map",this.state.split=e.split?e.split:"h",this._addComponents(e.components)},this._addComponents=function(e){var t=this;_.forEach(e,function(e,i){["map","content"].indexOf(i)>-1&&e.mount("#g3w-view-"+i,!0).then(function(){t._components[i]=e,"map"==i&&(t._defaultMapComponent=e)})})},this.showMap=function(){this._toggleMapComponentVisibility(this._defaultMapComponent,!0),this._components.map=this._defaultMapComponent,this._showView("map")},this.showContextualMap=function(e){var t=this;if(this._contextualMapComponent||(this._contextualMapComponent=this._defaultMapComponent),this._contextualMapComponent!=this._defaultMapComponent&&this._toggleMapComponentVisibility(this._defaultMapComponent,!1),this._contextualMapComponent.ismount())t._components.map=this._contextualMapComponent,this._toggleMapComponentVisibility(this._contextualMapComponent,!0);else{var i=this._contextualMapComponent;i.mount("#g3w-view-map",!0).then(function(){t._components.map=i})}this._showView("map",e)},this.recoverDefaultMap=function(){this._components.map!=this._defaultMapComponent&&(this._components.map=this._defaultMapComponent,this._toggleMapComponentVisibility(this._contextualMapComponent,!1),this._toggleMapComponentVisibility(this._defaultMapComponent,!0))},this.setContextualMapComponent=function(e){e!=this._defaultMapComponent&&(this._contextualMapComponent&&this._contextualMapComponent.unmount(),this._contextualMapComponent=e)},this.resetContextualMapComponent=function(){this._contextualMapComponent&&this._contextualMapComponent.unmount(),this._contextualMapComponent=this._defaultMapComponent},this._toggleMapComponentVisibility=function(e,t){e.internalComponent.$el.style.display=t?"block":"none"},this.closeMap=function(){this.state.secondaryPerc="map"==this.state.primaryView?100:0,this.recoverDefaultMap(),this._layout()},this.showContent=function(e){var t=this;e.push=e.push||!1,this._prepareContentView(e),this._immediateComponentsLayout=!1,this._showView("content",e,!0),this._components.content.setContent(e).then(function(){t._layoutComponents(),t._immediateComponentsLayout=!0})},this.hideContent=function(e,t){var i=this.state.secondaryPerc;return this.state.secondaryPerc=e?0:t,this.state.secondaryVisible=!e,this._layout(),i},this.popContent=function(){var e=this;if(this.state.content.contentsdata.length){this.recoverDefaultMap();var t=this._components.content.getPreviousContentData();this._prepareContentView(t.options),this._immediateComponentsLayout=!1,this._showView("content"),this._components.content.popContent().then(function(){e._layoutComponents(),e._immediateComponentsLayout=!0})}},this.closeContent=function(){return this._components.content.removeContent(),this.recoverDefaultMap(),this.closeSecondaryView()},this.removeContent=function(){return this.state.content.backonclose&&this.state.content.contentsdata.length>1?void this.popContent():(this._components.content.removeContent(),this.recoverDefaultMap(),this.closeSecondaryView())},this.isPrimaryView=function(e){return this.state.primaryView==e},this.setPrimaryView=function(e){this.state.primaryView!=e&&(this.state.primaryView=e),this._layout()},this.showPrimaryView=function(e){e&&this.state.secondaryVisible&&100==this.state.secondaryPerc&&(this.state.secondaryPerc=100-e,this._layout())},this.showSecondaryView=function(e,t){this.state.secondaryVisible=!0,this.state.split=e?e:this.state.split,this.state.secondaryPerc=t?t:this.state.perc,this._layout()},this.closeSecondaryView=function(e){var t=$.Deferred(),i=this,n=this._components[this._otherView(this.state.primaryView)];return n.clearContents?n.clearContents().then(function(){i.state.secondaryVisible=!1,i._layout(),Vue.nextTick(function(){t.resolve()})}):(this.state.secondaryVisible=!1,this._layout(),Vue.nextTick(function(){t.resolve()})),t.promise()},this.getDefaultViewPerc=function(e){return this.isPrimaryView(e)?100:50},this._otherView=function(e){return"map"==e?"content":"map"},this._isSecondary=function(e){return this.state.primaryView!=e},this._setPrimaryView=function(e){this.state.primaryView!=e&&(this.state.primaryView=e)},this._prepareContentView=function(e){this.state.content.preferredPerc=e.perc||this.getDefaultViewPerc("content"),this.state.content.title=e.title,this.state.content.closable=!!_.isNil(e.closable)||e.closable,this.state.content.backonclose=!!_.isNil(e.backonclose)||e.backonclose,this.state.content.contentsdata=this._components.content.contentsdata,this.state.content.showgoback=!!_.isNil(e.showgoback)||e.showgoback},this._showView=function(e,t){t=t||{};var i,n=t.perc||this.getDefaultViewPerc(e),r=t.split||"h";i=!this.isPrimaryView(e)||"undefined"!=typeof t.aside&&t.aside,this.state[e].aside=i;var o=this.isPrimaryView(e)?100-n:n;return o>0?void this.showSecondaryView(r,o):this.closeSecondaryView()},this._getReducedSizes=function(){var e=$(".content"),t=0,i=0;if(e&&this.state.secondaryVisible&&100==this.state.secondaryPerc){var n=$(".sidebar-aside-toggle");if(n&&n.is(":visible")){var r=n.outerWidth();e.css("padding-left",r+5),t=r-5}}else e.css("padding-left",15);return{reducedWidth:t,reducedHeight:i}},this._layout=function(){var e=this,t="h"==this.state.split?"split-h":"split-v",i="h"==this.state.split?"split-v":"split-c";$(".g3w-viewport .g3w-view").addClass(t),$(".g3w-viewport .g3w-view").removeClass(i);var n=this._getReducedSizes();this._setViewSizes(n.reducedWidth,n.reducedHeight);var r=$("#closemap-btn");if(!r.length){var r=$('<div id="closemap-btn" @click="closeMap" style="        position: absolute;        right: 10px;        top: 7px;        line-height: 1;        padding: 7px 2px;        font-size: 1.5em;        background-color: #3c8dbc;        color: white;        z-index:1000;        height: 39px;        width: 39px">          <button class="glyphicon glyphicon-remove pull-right close-panel-button" style="background-color: transparent;border: 0px;"></button>        </div>');r.on("click",function(){e.closeMap()});var o=$(".g3w-viewport .map");o.append(r)}this.state.secondaryVisible&&this._isSecondary("content")&&this.state.secondaryPerc<this.state.content.preferredPerc?r.show():r.hide(),this._immediateComponentsLayout&&this._layoutComponents()},this._setViewSizes=function(){var e=this.state.primaryView,t=this._otherView(e),i=this._viewportWidth(),n=this._viewportHeight(),r=i,o=n,s=this.state.secondaryPerc/100;"h"==this.state.split?(secondaryWidth=this.state.secondaryVisible?Math.max(i*s,this._secondaryViewMinWidth):0,secondaryHeight=n,r=i-secondaryWidth,o=n):(secondaryWidth=i,secondaryHeight=this.state.secondaryVisible?Math.max(n*s,this._secondaryViewMinHeight):0,r=i,o=n-secondaryHeight),this.state[e].sizes.width=r,this.state[e].sizes.height=o,this.state[t].sizes.width=secondaryWidth,this.state[t].sizes.height=secondaryHeight},this._viewportHeight=function(){var e=$(".navbar").innerHeight();return $(window).innerHeight()-e},this._viewportWidth=function(){var e=$(".main-sidebar").offset().left,t=$(".main-sidebar").innerWidth(),i=t+e;return $(window).innerWidth()-i},this._layoutComponents=function(){var e=this;Vue.nextTick(function(){var t=e._getReducedSizes();reducedWidth=t.reducedWidth||0,reducedHeight=t.reducedHeight||0,_.forEach(e._components,function(t,i){var n=e.state[i].sizes.width-reducedWidth,r=e.state[i].sizes.height-reducedHeight;t.layout(n,r)})})},this._firstLayout=function(){function e(){r=!0,t()}function t(){r===!0?(r=!1,n=!0,i._layout(!0),requestAnimationFrame(t)):n=!1}var i=this,n=!1,r=!1;s.on("ready",function(){var t=i.state.primaryView,r=i._otherView(t),o=$(".g3w-viewport ."+r),a=o.css("min-width");""==a||_.isNaN(parseFloat(a))||(i._secondaryViewMinWidth=parseFloat(a));var l=o.css("min-height");""==l||_.isNaN(parseFloat(l))||(i._secondaryViewMinHeight=parseFloat(l)),i._layout(!0),s.on("guiresized",function(){e()}),$(window).resize(function(){n===!1&&e()}),$(".main-sidebar").on("webkitTransitionEnd transitionend msTransitionEnd oTransitionEnd",function(){$(this).trigger("trans-end"),e()})})},this._firstLayout(),r(this)};n(a,o);var l=new a,c=Vue.extend({template:e("../html/viewport.html"),data:function(){return{state:l.state}},computed:{showtitle:function(){var e=!0,t=this.state.content.contentsdata;if(t.length){var i=t[t.length-1].options;_.isBoolean(i.showtitle)&&(e=i.showtitle)}return e},showContent:function(){return this.state.content.show},contentTitle:function(){var e=this.state.content.contentsdata;if(e.length)return e[e.length-1].options.title},previousTitle:function(){var e=this.state.content.contentsdata;return!!(e.length>1&&this.state.content.showgoback)&&(e[e.length-2].options.title?"a "+e[e.length-2].options.title:"indietro")},contentSmallerThenPreferred:function(){return this.state.secondaryPerc<this.state.content.preferredPerc}},methods:{closeContent:function(){l.removeContent()},closeMap:function(){l.closeMap()},gotoPreviousContent:function(){l.popContent()}}});t.exports={ViewportService:l,ViewportComponent:c}},{"../html/viewport.html":10,sdk:181}],21:[function(e,t,i){function n(){this._config=null,this._baseUrl=null,this.init=function(e){var t=$.Deferred();return this._config=e,this._baseUrl=e.urls.api,this._apiEndpoints=e.urls.apiEndpoints,t.resolve(),t.promise()};var e=0;this._incrementLoaders=function(){0==e&&this.emit("apiquerystart"),e+=1},this._decrementLoaders=function(){e-=1,0==e&&this.emit("apiqueryend")},this.get=function(e,t){var i=this,n=this._apiEndpoints[e];if(n){var r=this._baseUrl+"/"+n;t.request&&(r=r+"/"+t.request);var o=t.params||{};return i.emit(e+"querystart"),this._incrementLoaders(),$.get(r,o).done(function(t){return i.emit(e+"queryend",t),t}).fail(function(t){return i.emit(e+"queryfail",t),t}).always(function(){i._decrementLoaders()})}return a()},o(this)}var r=e("core/utils/utils").inherit,o=e("core/utils/utils").base,s=e("core/g3wobject"),a=e("core/utils/utils").reject;r(n,s),t.exports=new n},{"core/g3wobject":30,"core/utils/utils":77}],22:[function(e,t,i){var n=e("core/utils/utils").inherit,r=e("core/utils/utils").base,o=e("core/g3wobject"),s=e("core/apiservice"),a=e("core/router"),l=e("core/project/projectsregistry"),c=e("core/plugin/pluginsregistry"),u=e("core/clipboardservice"),h="1506689393983",p=function(){var e=this;this.version=h.indexOf("G3W_VERSION")==-1?h:"",this.secret="### G3W Client Application Service ###",this.ready=!1,this.complete=!1,this._modalOverlay=null,this._acquirePostBoostrap=!1,this._applicationServices={},this.config={},this._initConfigUrl=null,this._initConfig={},r(this),this.init=function(e,t){return this._config=e,t&&(this._acquirePostBoostrap=!0),this._bootstrap()},this.getConfig=function(){return this._config},this.getRouterService=function(){return a},this.getClipboardService=function(){return u},this.obtainInitConfig=function(e){var t=this;this._initConfigUrl||(this._initConfigUrl=e);var i=$.Deferred();if(window.initConfig)return this._initConfig=window.initConfig,i.resolve(window.initConfig);var n,r;if(location.search?(r=location.search.substring(1).split("&"),_.forEach(r,function(e){e.indexOf("project")>-1&&(n=e.split("=")[1])})):n=location.pathname.split("/").splice(-4,3).join("/"),n){var o=this._initConfigUrl;n&&(o=o+"/"+n),$.get(o).then(function(e){e.staticurl="../dist/",e.clienturl="../dist/",t._initConfig=e,window.initConfig=e,i.resolve(e)}).fail(function(e){i.reject(e)})}return i.promise()},this.getInitConfig=function(){return this._initConfig},this.getInitConfigUrl=function(){return this._initConfigUrl},this.setInitConfigUrl=function(e){this._initConfigUrl=e},this.postBootstrap=function(){this.complete||(a.init(),c.init({pluginsBaseUrl:e._config.urls.staticurl,pluginsConfigs:e._config.plugins,otherPluginsConfig:l.getCurrentProject().getState()}),this.complete=!0)},this._bootstrap=function(){var e=this,t=$.Deferred();return this.ready||$.when(l.init(this._config),s.init(this._config)).then(function(){e.emit("ready"),e._acquirePostBoostrap||e.postBootstrap(),this.initialized=!0,t.resolve()}).fail(function(e){t.reject(e)}),t.promise()},this.registerService=function(e,t){this._applicationServices[e]=t},this.unregisterService=function(e){delete this._applicationServices[e]},this.getService=function(e){return this._applicationServices[e]},this.errorHandler=function(e){console.log(e)}};n(p,o),t.exports=new p},{"core/apiservice":21,"core/clipboardservice":24,"core/g3wobject":30,"core/plugin/pluginsregistry":66,"core/project/projectsregistry":71,"core/router":75,"core/utils/utils":77}],23:[function(e,t,i){function n(){o(this)}var r=e("core/utils/utils").inherit,o=e("core/utils//utils").base,s=e("core/layers/layersstoresregistry");r(n,s),t.exports=new n},{"core/layers/layersstoresregistry":44,"core/utils//utils":77,"core/utils/utils":77}],24:[function(e,t,i){function n(){this._data={},this.set=function(e,t){var i=e.split("form")[0];this._data[i]=t},this.get=function(e){var t=this._data[e]||{};return this._data[e]={},t}}t.exports=new n},{}],25:[function(e,t,i){function n(){this.execute=function(e,t,i){var r,o;_.forEach(t,function(t){o=t.feature,i&&o[n.Actions[o.getState()].opposite](),r=n.Actions[o.getState()].fnc,e[r](o)})}}n.Actions={add:{fnc:"addFeature",opposite:"delete"},"delete":{fnc:"removeFeature",opposite:"add"},update:{fnc:"updateFeature",opposite:"update"}},t.exports=new n},{}],26:[function(e,t,i){function n(e){e=e||{},this.setters={save:function(){this._save()},addFeature:function(e){this._addFeature(e)},updateFeature:function(e){this._updateFeature(e)},deleteFeature:function(e){this._deleteFeature(e)},setFeatures:function(e){this._setFeatures(e)},getFeatures:function(e){return this._getFeatures(e)}},o(this),this._layer=e.layer,this._started=!1}var r=e("core/utils/utils").inherit,o=e("core/utils//utils").base,s=e("core/g3wobject");e("./session");r(n,s);var a=n.prototype;a.getLayer=function(){return this._layer},a.setLayer=function(e){return this._layer=e,this._layer},a._getFeatures=function(e){var t=$.Deferred();return this._layer.getFeatures(e).then(function(e){e.then(function(e){return t.resolve(e)}).fail(function(e){return t.reject(e)})}).fail(function(e){t.reject(e)}),t.promise()},a.commit=function(e,t){var i=$.Deferred();return this._layer.commit(e,t).then(function(e){e.then(function(e){return i.resolve(e)}).fail(function(e){return i.reject(e)})}).fail(function(e){i.reject(e)}),i.promise()},a.start=function(e){var t=this,i=$.Deferred();return this.getFeatures(e).then(function(e){e.then(function(e){i.resolve(e),t._started=!0}).fail(function(e){i.reject(e)})}).fail(function(e){i.reject(e)}),i.promise()},a._addFeature=function(e){this._layer.addFeature(e)},a._deleteFeature=function(e){this._layer.deleteFeature(e)},a._updateFeature=function(e){this._layer.updateFeature(e)},a._setFeatures=function(e){this._layer.setFeatures(e)},a.stop=function(){var e=$.Deferred(),t=this;return this._layer.unlock().then(function(i){t._started=!1,e.resolve(i)}).fail(function(t){console.log(t),e.reject(t)}),e.promise()},a._save=function(){this._layer.save()},a.isStarted=function(){return this._started},a.clear=function(){this._layer.getFeaturesStore().clear()},t.exports=n},{"./session":28,"core/g3wobject":30,"core/utils//utils":77,"core/utils/utils":77}],27:[function(e,t,i){function n(e){e=e||{},this.id=e.id,o(this),this._maxSteps=10,this._states=[],this.state={commit:!1,undo:!1,redo:!1},this._current=null}var r=e("core/utils/utils").inherit,o=e("core/utils//utils").base,s=e("core/g3wobject");e("core/layers/features/feature");r(n,s);var a=n.prototype;a.add=function(e,t){var i,n=this,r=$.Deferred();return this._states.length&&this._current!=this.getLastState().id&&(_.forEach(this._states,function(e,t){if(n._current==e.id)return i=t,!1}),this._states=this._states.slice(0,i+1)),this._states.push({id:e,items:t}),this._current=e,this._setState(),r.resolve(e),r.promise()},a._setState=function(){this.canUndo(),this.canCommit(),this.canRedo()},a._checkItems=function(e,t){var i=this,n={own:[],dependencies:{}};return _.forEach(e,function(e){_.isArray(e)&&(e=e[t]),i.id==e.layerId?n.own.push(e):(n.dependencies[e.layerId]||(n.dependencies[e.layerId]={own:[],dependencies:{}}),n.dependencies[e.layerId].own.push(e))}),n},a.undo=function(){var e,t=this;return this._current==this.getFirstState().id?(this._current=null,e=this._states[0].items):_.forEach(this._states,function(i,n){if(i.id==t._current)return e=t._states[n].items,t._current=t._states[n-1].id,!1}),e=this._checkItems(e,0),this._setState(),e},a.redo=function(){var e,t=this;return this._current?_.forEach(this._states,function(i,n){if(t._current==i.id)return t._current=t._states[n+1].id,e=t._states[n+1].items,!1}):(e=this._states[0].items,this._current=this._states[0].id,stateIdx=1),e=this._checkItems(e,1),this._setState(),e},a.clear=function(e){var t=this;e?_.forEach(this._states,function(i,n){e.indexOf(i.id)!=-1&&(t._current&&t._current==i.id()&&t.undo(),t._states.splice(n,1))}):this._clearAll()},a._clearAll=function(){this._states=[],this._current=null,this.state.commit=!1,this.state.redo=!1,this.state.undo=!1},a.getState=function(e){var t=null;return _.forEach(this._states,function(t){if(t.id==e)return t=t,!1}),t},a.getFirstState=function(){return this._states.length?this._states[0]:null},a.getLastState=function(){var e=this._states.length;return e?this._states[e-1]:null},a.getCurrentState=function(){var e=this,t=null;return this._current&&this._states.length&&_.forEach(this._states,function(i){if(e._current==i.id)return t=i,!1}),t},a.getCurrentStateIndex=function(){var e=this,t=null;return this._current&&this._states.length&&_.forEach(this._states,function(i,n){if(e._current==i.id)return t=n,!1}),t},a.canCommit=function(){var e=!1,t=[],i=this._getStatesToCommit();return _.forEach(i,function(i){if(_.forEach(i.items,function(i){if(_.isArray(i)&&(i=i[1]),i.feature.isNew()&&i.feature.isDeleted())t.push(i.feature.getPk());else if(!i.feature.isNew()||t.indexOf(i.feature.getPk())==-1||!t.length)return e=!0,!1}),e)return!1}),this.state.commit=e,this.state.commit},a.canUndo=function(){var e=this._states.length-1-this.getCurrentStateIndex();return this.state.undo=!_.isNull(this._current)&&this._maxSteps>e,this.state.undo},a.canRedo=function(){return this.state.redo=this.getLastState()&&this.getLastState().id!=this._current||_.isNull(this._current)&&this._states.length>0,this.state.redo},a._getStatesToCommit=function(){var e=this,t=this._current?_.clone(this._states):[];return _.forEach(t.reverse(),function(i,n){if(e.getCurrentState()==i)return t=t.slice(n,t.length),!1}),t},a.commit=function(){var e,t,i={},n=!0,r=this._getStatesToCommit();return _.forEach(r,function(r){_.forEach(r.items,function(r){_.isArray(r)&&(r=r[1]),_.forEach(i[r.layerId],function(e,t){if(e.getId()==r.feature.getId())return r.feature.isNew()&&!e.isDeleted()&&r.feature.isAdded()&&e.add(),n=!1,!1}),n&&(e=r.feature,t=r.layerId,!e.isNew()&&e.isAdded()||(i[t]||(i[t]=[]),i[t].push(e))),n=!0})}),i},t.exports=n},{"core/g3wobject":30,"core/layers/features/feature":34,"core/utils//utils":77,"core/utils/utils":77}],28:[function(e,t,i){function n(e){e=e||{},this.setters={start:function(e){return this._start(e)},getFeatures:function(e){return this._getFeatures(e)},stop:function(){this._stop()}},o(this,e),this.state={id:e.id,started:!1},this._editor=e.editor||null,this._featuresstore=e.featuresstore||new l,this._history=new a({id:this.state.id}),this._temporarychanges=[];
}var r=e("core/utils/utils").inherit,o=e("core/utils//utils").base,s=e("core/g3wobject"),a=e("./history"),l=e("core/layers/features/featuresstore"),c=e("./changesmanager"),u=e("./sessionsregistry");r(n,s);var h=n.prototype;h.getId=function(){return this.state.id},h._start=function(e){var t=this,i=$.Deferred();return u.register(this),this._editor.start(e).then(function(e){e=t._cloneFeatures(e),t._featuresstore.addFeatures(e),t.state.started=!0,i.resolve(e)}).fail(function(e){t.state.started=!0,i.reject(e)}),i.promise()},h._getFeatures=function(e){var t=this,i=$.Deferred();return this._editor.getFeatures(e).then(function(e){e.then(function(e){e=t._cloneFeatures(e),t._featuresstore.addFeatures(e),i.resolve(e)}).fail(function(e){i.reject(e)})}),i.promise()},h._cloneFeatures=function(e){var t=[];return _.forEach(e,function(e){t.push(e.clone())}),t},h.isStarted=function(){return this.state.started},h.getEditor=function(){return this._editor},h.setEditor=function(e){this._editor=e},h.getFeaturesStore=function(){return this._featuresstore},h.save=function(e){console.log("Session Saving .... ");var t=this,i=$.Deferred();if(this._temporarychanges.length){e=e||{};var n=e.id||Date.now();this._history.add(n,this._temporarychanges).then(function(){t._temporarychanges=[],i.resolve(n)})}else i.resolve(null);return i.promise()},h.pushAdd=function(e,t){this.push({layerId:e,feature:t.add()})},h.pushDelete=function(e,t){this.push({layerId:e,feature:t["delete"]()})},h.pushUpdate=function(e,t,i){this.push({layerId:e,feature:t.update()},{layerId:e,feature:i.update()})},h.push=function(e,t){var i=t?[t,e]:e;this._temporarychanges.push(i)},h._applyChanges=function(e,t){t=t||!0,c.execute(this._featuresstore,e,t)},h.revert=function(){var e=$.Deferred(),t=this;return this._editor.getFeatures().then(function(i){i.then(function(i){i=t._cloneFeatures(i),t.getFeaturesStore().setFeatures(i),t._history.clear(),e.resolve()}).fail(function(t){e.reject(t)})}),e.promise()},h._filterChanges=function(){var e,t=this.getId(),i={own:[],dependencies:{}};return _.forEach(this._temporarychanges,function(n){e=_.isArray(n)?n[0]:n,e.layerId==t?i.own.push(e):(i.dependencies[e.layerId]||(i.dependencies[e.layerId]=[]),i.dependencies[e.layerId].unshift(e))}),i},h.rollback=function(e){console.log("Session Rollback.....",e);var t=$.Deferred();return e?(this._applyChanges(e,!0),t.resolve()):(e=this._filterChanges(),this._applyChanges(e.own,!0),this._temporarychanges=[],t.resolve(e.dependencies)),t.promise()},h.undo=function(e){var e=e||this._history.undo();return this._applyChanges(e.own,!0),e.dependencies},h.redo=function(e){var e=e||this._history.redo().own;return this._applyChanges(e,!0),e.dependencies},h._serializeCommit=function(e){var t,i,n=this.getId(),r={add:[],update:[],"delete":[],relations:{}};return _.forEach(e,function(e,o){if(o!=n){var s=u.getSession(o).getEditor().getLayer().getFeaturesStore().getLockIds();r.relations[o]={lockids:s,add:[],update:[],"delete":[]},i=r.relations[o]}else i=r;_.forEach(e,function(e){t=e.getState();var n=new ol.format.GeoJSON;switch(t){case"delete":e.isNew()||i["delete"].push(e.getId());break;default:i[e.getState()].push(n.writeFeatureObject(e))}})}),r},h.getCommitItems=function(){return this._history.commit()},h.commit=function(e){e=e||{};var t,i=this,n=$.Deferred();console.log("Sessione Committing...");var r=e.ids||null;return r?(t=this._history.commit(r),this._history.clear(r)):(t=this._history.commit(),t=this._serializeCommit(t),this._editor.commit(t,this._featuresstore).then(function(e){i._history.clear(),n.resolve(e)}).fail(function(e){n.reject(e)})),n.promise()},h._stop=function(){var e=this,t=$.Deferred();return u.unregister(this.getId()),console.log("Sessione stopping .."),this._editor.stop().then(function(){e.state.started=!1,e.clear(),t.resolve()}).fail(function(e){console.log(e),t.reject(e)}),t.promise()},h.clear=function(){this._editor.clear(),this._clearHistory(),this._featuresstore.clear()},h.getHistory=function(){return this._history},h._clearHistory=function(){this._history.clear()},t.exports=n},{"./changesmanager":25,"./history":27,"./sessionsregistry":29,"core/g3wobject":30,"core/layers/features/featuresstore":35,"core/utils//utils":77,"core/utils/utils":77}],29:[function(e,t,i){var n=function(){this._sessions={},this.register=function(e){var t=e.getId();this._sessions[t]=e},this.unregister=function(e){delete this._sessions[e]},this.getSession=function(e){return this._sessions[e]},this.setSession=function(e,t){this._sessions[e]=t}};t.exports=new n},{}],30:[function(e,t,i){var n=e("core/utils/utils").inherit,r=e("core/utils/utils").noop,o=function(){this.setters&&this._setupListenersChain(this.setters)};n(o,EventEmitter);var s=o.prototype;s.onafter=function(e,t,i){return this._onsetter("after",e,t,!1,i)},s.onbefore=function(e,t,i){return this._onsetter("before",e,t,!1,i)},s.onbeforeasync=function(e,t,i){return this._onsetter("before",e,t,!0,i)},s.un=function(e,t){_.forEach(this.settersListeners,function(i){_.forEach(i[e],function(n,r){n.key==t&&i[e].slice(r,1)})})},s._onsetter=function(e,t,i,n,r){var o=this.settersListeners[e],s=""+Math.floor(1e6*Math.random())+Date.now();r=r||0;var a=o[t];return a.push({key:s,fnc:i,async:n,priority:r}),o[t]=_.sortBy(a,function(e){return e.priority}),s},s._setupListenersChain=function(e){var t=this;this.settersListeners={after:{},before:{}},_.forEach(e,function(e,i){var n=r,o=r;_.isFunction(e)?n=e:(n=e.fnc,o=e.fallback||r),t.settersListeners.after[i]=[],t.settersListeners.before[i]=[],t[i]=function(){function e(){c=n.apply(t,a),l.resolve(c);var e=t.settersListeners.after[i];_.forEach(e,function(e){e.fnc.apply(t,a)})}function r(){o.apply(t,a),l.reject()}function s(n){var o=!0;_.isBoolean(n)&&(o=n);var l=Array.prototype.slice.call(a);if(o===!1||u==h.length)o===!1?r.apply(t,a):(completed=e.apply(t,a),(_.isUndefined(completed)||completed===!0)&&t.emitEvent("set:"+i,a));else if(o){var c=h[u].fnc;if(h[u].async)l.push(s),u+=1,c.apply(t,l);else{var p=c.apply(t,l);u+=1,s(p)}}}var a=arguments,l=$.Deferred(),c=null,u=0,h=t.settersListeners.before[i];return u=0,s(),l.promise()}})},s.un=function(e){_.forEach(this.settersListeners,function(t){_.forEach(t,function(i,n){i.key==e&&t.splice(n,1)})})},s.get=function(e){var t=!this[e]||this[e]instanceof Function?null:this[e];return t},s.set=function(e,t){this[e]=t},t.exports=o},{"core/utils/utils":77}],31:[function(e,t,i){var n={distance:function(e,t){return Math.sqrt(n.squaredDistance(e,t))},squaredDistance:function(e,t){var i=e[0],n=e[1],r=t[0],o=t[1],s=r-i,a=o-n;return s*s+a*a},closestOnSegment:function(e,t){var i,n,r=e[0],o=e[1],s=t[0],a=t[1],l=s[0],c=s[1],u=a[0],h=a[1],p=u-l,d=h-c,f=0===p&&0===d?0:(p*(r-l)+d*(o-c))/(p*p+d*d||0);return f<=0?(i=l,n=c):f>=1?(i=u,n=h):(i=l+f*p,n=c+f*d),[i,n]}};t.exports=n},{}],32:[function(e,t,i){var n={};n.GeometryTypes={POINT:"Point",MULTIPOINT:"MultiPoint",LINESTRING:"Line",MULTILINESTRING:"MultiLine",POLYGON:"Polygon",MULTIPOLYGON:"MultiPolygon",GEOMETRYCOLLECTION:"GeometryCollection"},n.SupportedGeometryTypes=[n.GeometryTypes.POINT,n.GeometryTypes.MULTIPOINT,n.GeometryTypes.LINESTRING,n.GeometryTypes.MULTILINESTRING,n.GeometryTypes.POLYGON,n.GeometryTypes.MULTIPOLYGON],t.exports=n},{}],33:[function(e,t,i){function n(e){i18next.use(i18nextXHRBackend).init({lng:"it",ns:"app",fallbackLng:"it",resources:e.resources}),jqueryI18next.init(i18next,$,{tName:"t",i18nName:"i18n",handleName:"localize",selectorAttr:"data-i18n",targetAttr:"data-i18n-target",optionsAttr:"data-i18n-options",useOptionsAttr:!1,parseDefaultValueFromContent:!0})}var r=function(e){var t=i18next.t(e);return t};t.exports={init:n,t:r}},{}],34:[function(e,t,i){var n=function(e){ol.Feature.call(this),e=e||{},this._newPrefix="_new_",this._pk=e.pk||"id";var t=e.feature;if(t){this.setProperties(t.getProperties()),this.setId(t.getId()),this.setGeometryName(t.getGeometryName());var i=t.getGeometry();i&&this.setGeometry(i);var n=this.getStyle();n&&this.setStyle(n)}this.state={"new":!1,state:null}};ol.inherits(n,ol.Feature),proto=n.prototype,proto.constructor="Feature",proto.clone=function(){var e=ol.Feature.prototype.clone.call(this);e.setId(this.getId());var t=new n({feature:e,pk:this._pk});return t.setState(this.getState()),t},proto.setTemporaryId=function(){var e=this._newPrefix+Date.now();this.setId(e),this.setNew()},proto.setNew=function(){this.state["new"]=!0},proto.getPk=function(){return this._pk},proto["delete"]=function(){return this.state.state="delete",this},proto.update=function(){return this.state.state="update",this},proto.add=function(){return this.state.state="add",this},proto.isNew=function(){return this.state["new"]},proto.isAdded=function(){return"add"==this.state.state},proto.isUpdated=function(){return"update"==this.state.state},proto.isDeleted=function(){return"delete"==this.state.state},proto.getState=function(){return this.state.state},proto.setState=function(e){this.state.state=e},proto.clearState=function(){this.state.state=null,this.state["new"]=!1},t.exports=n},{}],35:[function(e,t,i){function n(e){var t=this;e=e||{},this._features=[],this._provider=e.provider||null,this._loadedPks=[],this._lockIds=[],this.setters={addFeatures:function(e){_.forEach(e,function(e){t._addFeature(e)})},addFeature:function(e){this._addFeature(e)},removeFeature:function(e){this._removeFeature(e)},updateFeature:function(e){this._updateFeature(e)},clear:function(){this._clearFeatures(),this._lockIds=[],this._loadedPks=[]},getFeatures:function(e){return this._getFeatures(e)},commit:function(e,t){return this._commit(e,t)}},o(this)}var r=e("core/utils/utils").inherit,o=e("core/utils//utils").base,s=e("core/g3wobject");r(n,s),proto=n.prototype,proto.unlock=function(){return this._provider.unlock()},proto._getFeatures=function(e){var t,i=this,n=$.Deferred();return this._provider&&e?this._provider.getFeatures(e).then(function(e){t=i._filterFeaturesResponse(e),i.addFeatures(t),n.resolve(t)}).fail(function(e){n.reject(e)}):n.resolve(this._readFeatures()),n.promise()},proto._filterFeaturesResponse=function(e){var t=this,i=!1;e=e||{};var n=e.features||[],r=e.featurelocks||[],o=_.filter(n,function(e){return i=_.includes(t._loadedPks,e.getId()),i||t._loadedPks.push(e.getId()),!i});return t._filterLockIds(r),o},proto._filterLockIds=function(e){var t=_.differenceBy(e,this._lockIds,"featureid");this._lockIds=_.union(this._lockIds,t)},proto.getLockIds=function(){return this._lockIds},proto.addLockIds=function(e){this._lockIds=_.union(this._lockIds,e)},proto._readFeatures=function(){return this._features},proto._commit=function(e,t){var i=$.Deferred();return e&&this._provider?(e.lockids=this._lockIds,this._provider.commit(e).then(function(e){i.resolve(e)}).fail(function(e){i.reject(e)})):i.reject(),i.promise()},proto.getFeatureById=function(e){var t;return _.forEach(this._features,function(i){if(i.getId()==e)return t=i,!1}),t},proto._addFeature=function(e){this._features.push(e)},proto._updateFeature=function(e){var t=this;_.forEach(this._features,function(i,n){if(i.getId()==e.getId())return t._features[n]=e,!1})},proto.updatePkFeature=function(e,t){},proto.setFeatures=function(e){this._features=e},proto._removeFeature=function(e){var t=this;_.forEach(this._features.getArray(),function(i,n){if(e.getId()==i.getId())return t._features.removeAt(n),!1})},proto._clearFeatures=function(){this._features.splice(0,this._features.length)},proto.getDataProvider=function(){return this._dataprovider},proto.readFeatures=function(){return this._features},t.exports=n},{"core/g3wobject":30,"core/utils//utils":77,"core/utils/utils":77}],36:[function(e,t,i){function n(e){o(this,e),this._features=new ol.Collection}var r=e("core/utils/utils").inherit,o=e("core/utils//utils").base,s=e("./featuresstore");r(n,s),proto=n.prototype,proto.setFeatures=function(e){var t=this;this._features.clear(),_.forEach(e,function(e){t._features.push(e)})},proto.readFeatures=function(){return this._features.getArray()},proto.getFeaturesCollection=function(){return this._features},proto.getFeatureById=function(e){var t;return _.forEach(this._features.getArray(),function(i){if(i.getId()==e)return t=i,!1}),t},proto._updateFeature=function(e){this._features.forEach(function(t,i,n){if(t.getId()==e.getId())return this.setAt(i,e),!1},this._features)},proto._removeFeature=function(e){this._features.forEach(function(t,i,n){if(e.getId()==t.getId())return this.removeAt(i),!1},this._features)},proto._clearFeatures=function(){this._features.clear()},t.exports=n},{"./featuresstore":35,"core/utils//utils":77,"core/utils/utils":77}],37:[function(e,t,i){function n(){this._expression=""}var r=n.prototype;r.and=function(e,t){return this._expression=this._expression?this._expression+" AND ":this._expression,e&&t&&this.eq(e,t),this},r.or=function(){return field&&value&&(this._expression=this._expression?this._expression+" OR ":this._expression,this.eq(field,value)),this},r.eq=function(e,t){return this._expression=this._expression+this._build("eq",e,t),this},r.like=function(e,t){return this._expression=this._expression+this._build("LIKE",e,t),this},r.ilike=function(e,t){return this._expression=this._expression+this._build("ILIKE",e,t),this},r.not=function(e,t){return this._expression=this._expression+this._build("NOT",e,t),this},r.gt=function(e,t){return this._expression=this._expression+this._build("gt",e,t),this},r.gte=function(e,t){return this._expression=this._expression+this._build("gte",e,t),this},r.lt=function(e,t){return this._expression=this._expression+this._build("lt",e,t),this},r.lte=function(e,t){return this._expression=this._expression+this._build("lte",e,t),this},r.clear=function(){return this._expression="",this},r.get=function(){return this._expression},r._build=function(e,t,i){return[t,n.OPERATORS[e],i].join(" ")},r.createExpressionFromFilter=function(e,t){function i(e){var t,r=[],o="",s="",a="'";return _.forEach(e,function(e,l,c){t=n.OPERATORS[l],_.forEach(e,function(e){s="",_.forEach(e,function(t,l,c){if(_.isArray(t))o=i(c);else{"LIKE"!=l&&"ILIKE"!=l||(s="%"),filterOp=n.OPERATORS[l];_.forEach(e,function(e,t,i){_.forEach(e,function(e,t,i){_.isNull(e)||_.isNaN(e)||""==_.trim(e)||(o='"'+t+'" '+filterOp+" "+a+s+e+s+a,r.push(o))})})}})}),t=r.length>0&&r.join(" "+t+" ")}),t}return i(e)?(this._expression=t+":"+i(e),this):this},n.OPERATORS={eq:"=",gt:">",gte:">=",lt:"<",lte:"=<",LIKE:"LIKE",ILIKE:"ILIKE",AND:"AND",OR:"OR",NOT:"!="},t.exports=n},{}],38:[function(e,t,i){function n(){this._filter=null,this._type=null}var r=(e("./expression"),n.prototype);r.setExpression=function(e){this._type=n.TYPES.expression,this._filter=e},r.setGeometry=function(e){return this._type=n.TYPES.geometry,this._filter=e,this},r.setBBOX=function(e){return this._type=n.TYPES.bbox,this._filter=e,this},r.setFids=function(e){return this._type=n.TYPES.fids,this._filter=e,this},r.serialize=function(){return JSON.stringify(this)},r.get=function(){return this._filter},r.getType=function(){return this._type},r.clear=function(){this._filter=null},n.TYPES={bbox:"bbox",geometry:"geometry",expression:"expression",fids:"fids"},t.exports=n},{"./expression":37}],39:[function(e,t,i){function n(e){}var r=(e("core/layers/layer"),e("g3w-ol3/src/projection/projections")),o=n.prototype;o.setup=function(e){return this.config?(this.config.multilayerid=e.multilayer,_.extend(this.state,{geolayer:!0,bbox:e.bbox||null}),void(e.projection?this.config.projection=e.projection:e.crs&&e.project&&(e.project.getProjection().getCode()!=e.crs?r.get(e.crs,e.proj4):this.config.projection=e.project.getProjection()))):void console.log("GeoLayerMixin must be used from a valid (geo) Layer instance")},o.getConfig=function(){return this.config},o.getState=function(){return this.state},o.getMultiLayerId=function(){return this.config.multilayerid},o.getGeometryType=function(){return this.config.geometrytype},o.getMultiLayerId=function(){return this.config.multilayerid},o.setProjection=function(e,t){this.config.projection=r.get(e,t)},o.getProjection=function(){return this.config.projection},o.getCrs=function(){if(this.config.projection)return this.config.projection.getCode()},o.isCached=function(){return this.config.cache_url&&""!=this.config.cache_url},o.getCacheUrl=function(){if(this.isCached())return this.config.cache_url},t.exports=n},{"core/layers/layer":41,"g3w-ol3/src/projection/projections":109}],40:[function(e,t,i){function n(e){e=e||{},o(this,e),this.config.baselayer=e.baselayer||!1,this.type=a.LayerTypes.IMAGE,this.setup(e)}var r=e("core/utils/utils").inherit,o=e("core/utils//utils").base,s=e("core/utils/utils").mixin,a=e("core/layers/layer"),l=e("./vectorlayer"),c=e("./geolayermixin");r(n,a),s(n,c);var u=n.prototype;u.getLayerForEditing=function(){if(this.isEditable()){var e=_.cloneDeep(this.config);return e.capabilities=null,new l(e)}return null},u.isBaseLayer=function(){return this.config.baselayer},u.isWMS=function(){return n.WMSServerTypes.indexOf(this.config.servertype)>-1},u.isExternalWMS=function(){return this.config.source&&this.config.source.url},u.getWMSLayerName=function(){var e=this.config.name;return this.config.source&&this.config.source.layers&&(e=this.config.source.layers),e},u.getWmsUrl=function(){var e;return e=this.config.source&&"wms"==this.config.source.type&&this.config.source.url?this.config.source.url:this.config.wmsUrl},u.getQueryUrl=function(){var e=o(this,"getQueryUrl");return"QGIS"==this.getServerType()&&this.config.source&&"wms"==this.config.source.type&&this.config.source.external&&(e+="SOURCE=wms"),e},u.getLegendUrl=function(){var e=this.getWmsUrl();return sep=e.indexOf("?")>-1?"&":"?",e+sep+"SERVICE=WMS&VERSION=1.3.0&REQUEST=GetLegendGraphic&SLD_VERSION=1.1.0&FORMAT=image/png&TRANSPARENT=true&ITEMFONTCOLOR=white&LAYERTITLE=True&ITEMFONTSIZE=10&WIDTH=300&LAYER="+this.getWMSLayerName()},u.getWFSLayerName=function(){var e=this.config.origname;return this.config.source&&this.config.source.layers&&(e=this.config.source.layers),e},u.getWfsCapabilities=function(){return this.config.wfscapabilities||1==this.config.capabilities},n.WMSServerTypes=[a.ServerTypes.QGIS,a.ServerTypes.Mapserver,a.ServerTypes.Geoserver,a.ServerTypes.OGC],t.exports=n},{"./geolayermixin":39,"./vectorlayer":54,"core/layers/layer":41,"core/utils//utils":77,"core/utils/utils":77}],41:[function(e,t,i){function n(e){e=e||{},this.config=_.merge({id:e.id||"Layer",title:e.title||null,name:e.name||null,origname:e.origname||null,capabilities:e.capabilities||null,editops:e.editops||null,infoformat:e.infoformat||null,servertype:e.servertype||null,source:e.source||null,geolayer:!1,fields:e.fields||{},urls:{query:e.infourl&&""!=e.infour||e.wmsUrl}},e),this.state={id:e.id,title:e.name,visible:e.visible,selected:e.selected|!1,disabled:e.disabled|!1,hidden:e.hidden||!1},this.type=null;var t=this.config.servertype,i=this.config.source.type;this._layersstore=e.layersstore||null,this.providers={query:a.build("query",t,i,{layer:this}),filter:a.build("filter",t,i,{layer:this}),search:a.build("search",t,i,{layer:this}),data:a.build("data",t,i,{layer:this})},o(this)}var r=e("core/utils/utils").inherit,o=e("core/utils//utils").base,s=e("core/g3wobject"),a=e("core/layers/providers/providersfactory");r(n,s);var l=n.prototype;l.search=function(e){e=e||{};var t=$.Deferred(),i=this.getProvider("search");return i?i.query(e).done(function(e){t.resolve(e)}).fail(function(e){t.reject(e)}):t.reject("Il layer non è searchable"),t.promise()},l.query=function(e){e=e||{};var t=$.Deferred(),i=this.getProvider("query");return e.filter&&(i=this.providers.filter),i?i.query(e).done(function(e){t.resolve(e)}).fail(function(e){t.reject(e)}):t.reject("Il layer non è interrogabile"),t.promise()},l.getProject=function(){return this.config.project},l.getConfig=function(){return this.config},l.getState=function(){return this.state},l.getEditingLayer=function(){return self},l.isHidden=function(){return this.state.hidden},l.setHidden=function(e){this.state.hidden=!_.isBoolean(e)||e},l.isModified=function(){return this.state.modified},l.getId=function(){return this.config.id},l.getTitle=function(){return this.config.title},l.getName=function(){return this.config.name},l.getOrigName=function(){return this.config.origname},l.getServerType=function(){return this.config.servertype&&""!=this.config.servertype?this.config.servertype:ServerTypes.QGIS},l.getType=function(){return this.type},l.isSelected=function(){return this.state.selected},l.isDisabled=function(){return this.state.disabled},l.isVisible=function(){return this.state.visible},l.isQueryable=function(){var e=!1,t=!!(this.config.capabilities&&this.config.capabilities&n.CAPABILITIES.QUERYABLE);return t&&(e=this.isVisible()&&!this.isDisabled(),_.isUndefined(this.config.infowhennotvisible)||this.config.infowhennotvisible!==!0||(e=!0)),e},l.isFilterable=function(){return!!(this.config.capabilities&&this.config.capabilities&n.CAPABILITIES.FILTERABLE)},l.isEditable=function(){return!!(this.config.capabilities&&this.config.capabilities&n.CAPABILITIES.EDITABLE)},l.isBaseLayer=function(){return this.config.baselayer},l.getUrl=function(e){return this.config.urls[e]},l.getUrls=function(){return this.config.urls},l.getQueryUrl=function(){return this.config.urls.query},l.setQueryUrl=function(e){this.config.urls.query=e},l.getQueryLayerName=function(){var e;return e=this.config.infolayer&&""!=this.config.infolayer?this.config.infolayer:this.config.name},l.getQueryLayerOrigName=function(){var e;return e=this.state.infolayer&&""!=this.config.infolayer?this.config.infolayer:this.config.origname},l.getInfoFormat=function(e){return this.config.infoformat&&""!=this.config.infoformat&&"wfs"!=e?this.config.infoformat:"application/vnd.ogc.gml"},l.setInfoFormat=function(e){this.state.infoformat=e},l.getAttributes=function(){return this.fields},l.changeAttribute=function(e,t,i){_.forEach(this.fields,function(n){n.name==e&&(n.type=t,n.options=i)})},l.getAttributeLabel=function(e){var t;return _.forEach(this.getAttributes(),function(i){i.name==e&&(t=i.label)}),t},l.getProvider=function(e){return this.providers[e]},l.getProviders=function(){return this.providers},l.getLayersStore=function(){return this._layersstore},l.setLayersStore=function(e){this._layersstore=e},n.LayerTypes={TABLE:"table",IMAGE:"image",VECTOR:"vector"},n.ServerTypes={OGC:"OGC",QGIS:"QGIS",Mapserver:"Mapserver",Geoserver:"Geoserver",ArcGIS:"ArcGIS",OSM:"OSM",Bing:"Bing",Local:"Local"},n.SourceTypes={POSTGIS:"postgres",SPATIALITE:"spatialite",CSV:"delimitedtext",WMS:"wms"},n.CAPABILITIES={QUERYABLE:1,FILTERABLE:2,EDITABLE:4},n.EDITOPS={INSERT:1,UPDATE:2,DELETE:4},t.exports=n},{"core/g3wobject":30,"core/layers/providers/providersfactory":48,"core/utils//utils":77,"core/utils/utils":77}],42:[function(e,t,i){function n(){this.build=function(e){var t=this.get(e);return t?new t(e):null},this.get=function(e){var t,i=e.servertype;if("QGIS"==i)t=a,e.source&&e.geometrytype&&[r.SourceTypes.POSTGIS,r.SourceTypes.SPATIALITE,r.SourceTypes.CSV].indexOf(e.source.type)>-1&&e.geometrytype&&void 0==e.geometrytype&&(t=o);else if("OGC"==i){if(e.source){var n=e.source.type;switch(n){case"WMS":t=a;break;case"WFS":t=s}}}else"Local"==i&&(t=s);return t}}var r=e("./layer"),o=e("./tablelayer"),s=e("./vectorlayer"),a=e("./imagelayer");t.exports=new n},{"./imagelayer":40,"./layer":41,"./tablelayer":53,"./vectorlayer":54}],43:[function(e,t,i){function n(e){e=e||{},this.config={id:e.id||Date.now(),projection:e.projection,extent:e.extent,initextent:e.initextent,wmsUrl:e.wmsUrl,catalog:!_.isBoolean(e.catalog)||e.catalog},this.state={layerstree:[],relations:null},this._layers=this.config.layers||{},this.setters={setLayersVisible:function(e,t){var i=this;_.forEach(e,function(e){i.getLayerById(e).state.visible=t})},setLayerSelected:function(e,t){var i=this.getLayers();_.forEach(i,function(i){i.state.selected=e==i.getId()&&t||!1})},addLayer:function(e){this._addLayer(e)},removeLayer:function(e){this._removeLayer(e)}},o(this)}var r=e("core/utils/utils").inherit,o=e("core/utils//utils").base,s=e("core/g3wobject");r(n,s),proto=n.prototype,proto.showOnCatalog=function(){return this.config.catalog},proto.setOptions=function(e){this.config=e},proto.getId=function(){return this.config.id},proto._addLayer=function(e){this._layers[e.getId()]=e},proto.addLayers=function(e){var t=this;_.forEach(e,function(e){t.addLayer(e)})},proto._removeLayer=function(e){delete this._layers[e]},proto.removeLayers=function(e){_.forEach(e,function(e){self.removeLayer(layer)})},proto.getLayersDict=function(e){if(!e)return this._layers;var e=e||{},t=e.ACTIVE,i=e.QUERYABLE,n=e.FILTERABLE,r=e.EDITABLE,o=e.VISIBLE,s=e.SELECTED,a=e.CACHED,l=e.SELECTEDORALL,c=e.ALLNOTSELECTED,u=e.SERVERTYPE,h=e.BASELAYER,p=e.GEOLAYER,d=e.HIDDEN;e.WFS;if(l&&(s=null),_.isUndefined(i)&&_.isUndefined(n)&&_.isUndefined(r)&&_.isUndefined(o)&&_.isUndefined(t)&&_.isUndefined(s)&&_.isUndefined(a)&&_.isUndefined(l)&&_.isUndefined(u)&&_.isUndefined(p)&&_.isUndefined(d)&&_.isUndefined(h))return this._layers;var f=[];if(_.forEach(this._layers,function(e,t){f.push(e)}),"boolean"==typeof t&&(f=_.filter(f,function(e){return t==!e.isDisabled()})),"boolean"==typeof i&&(f=_.filter(f,function(e){return i==e.isQueryable()})),"boolean"==typeof n&&(f=_.filter(f,function(e){return n==e.isFilterable()})),"boolean"==typeof r&&(f=_.filter(f,function(e){return r==e.isEditable()})),"boolean"==typeof o&&(f=_.filter(f,function(e){return o==e.isVisible()})),"boolean"==typeof a&&(f=_.filter(f,function(e){return a==e.isCached()})),"boolean"==typeof s&&(f=_.filter(f,function(e){return s==e.isSelected()})),"boolean"==typeof h&&(f=_.filter(f,function(e){return h==e.isBaseLayer()})),"boolean"==typeof p&&(f=_.filter(f,function(e){return p==e.state.geolayer})),"boolean"==typeof d&&(f=_.filter(f,function(e){return d==e.isHidden()})),"string"==typeof u&&""!=u&&(f=_.filter(f,function(e){return u=e.getServerType()})),l){var g=f;f=_.filter(f,function(e){return e.isSelected()}),f=f.length?f:g}if(c){var g=f;f=_.filter(f,function(e){return!e.isSelected()}),f=f.length?f:g}return f},proto.getLayers=function(e){var t=this.getLayersDict(e);return _.values(t)},proto.getBaseLayers=function(){return this.getLayersDict({BASELAYER:!0})},proto.getLayerById=function(e){return this.getLayersDict()[e]},proto.getLayerByName=function(e){var t=null;return _.forEach(this.getLayersDict(),function(t){t.getName()==e&&(t=_layer)}),t},proto.getLayerAttributes=function(e){return this.getLayerById(e).getAttributes()},proto.getLayerAttributeLabel=function(e,t){return this.getLayerById(e).getAttributeLabel(t)},proto.getGeoLayers=function(){return this.getLayers({GEOLAYER:!0})},proto.toggleLayer=function(e,t){var i=this.getLayerById(e),t=t||!i.state.visible;this.setLayersVisible([e],t)},proto.toggleLayers=function(e,t){this.setLayersVisible(e,t)},proto.selectLayer=function(e){this.setLayerSelected(e,!0)},proto.unselectLayer=function(e){this.setLayerSelected(e,!1)},proto.getProjection=function(){return this.config.projection},proto.getExtent=function(){return this.config.extent},proto.getInitExtent=function(){return this.config.initextent},proto.getWmsUrl=function(){return this.config.wmsUrl},proto.setLayersTree=function(e,t){function i(e){_.forIn(e,function(t,r){_.isNil(t.id)||(e[r]=n.getLayerById(t.id).getState()),_.isNil(t.nodes)||i(t.nodes)})}var n=this;i(e),this.state.layerstree.splice(0,0,{title:t||this.config.id,expanded:!0,nodes:e})},proto.createLayersTree=function(e,t){function i(e,t){_.forIn(e,function(e){var n={};_.isNil(e.id)||(n.id=e.id),_.isNil(e.nodes)||(n.title=e.name,n.expanded=e.expanded,n.nodes=[],i(e.nodes,n.nodes)),t.push(n)})}var t=t||{},n=t.full||!1,r=t.layerstree||null,o=[];if(r){if(n===!0)return this.state.layerstree;i(r,o)}else _.forEach(this.getGeoLayers(),function(e){o.push({id:e.getId(),name:e.getName(),title:e.getTitle(),visible:e.isVisible()||!1})});this.setLayersTree(o,e)},proto.removeLayersTree=function(e){this.state.layerstree.splice(0,this.state.layerstree.length)},proto.getLayersTree=function(){return this.state.layerstree},t.exports=n},{"core/g3wobject":30,"core/utils//utils":77,"core/utils/utils":77}],44:[function(e,t,i){function n(){this.stores={},this.storesArray=[],this.setters={addLayersStore:function(e,t){this._addLayersStore(e,t)},removeLayersStore:function(e){this._removeLayersStore(e)},removeLayersStores:function(){this._removeLayersStores()}},o(this)}var r=e("core/utils/utils").inherit,o=e("core/utils//utils").base,s=e("core/g3wobject");r(n,s),proto=n.prototype,proto.getLayers=function(e){var t=[];return _.forEach(this.stores,function(i,n){t=t.concat(i.getLayers(e))}),t},proto.getLayersStore=function(e){return this.stores[e]},proto.getLayersStores=function(){var e=this,t=[];return _.forEach(this.storesArray,function(i){t.push(e.stores[i])}),t},proto._addLayersStore=function(e,t){var i=e.getId();this.stores[i]=e,_.isNil(t)?this.storesArray.push(i):this.storesArray.splice(t,0,i)},proto._removeLayersStore=function(e){if(e){var t=e.getId(),i=this.storesArray.indexOf(t);delete this.stores[t],this.storesArray.splice(i,1)}},proto._removeLayersStores=function(){var e=this.storesArray.length;this.storesArray.splice(0,e),this.stores={}},t.exports=n},{"core/g3wobject":30,"core/utils//utils":77,"core/utils/utils":77}],45:[function(e,t,i){function n(e){e=e||{},o(this),this._name="geojson"}var r=e("core/utils/utils").inherit,o=e("core/utils/utils").base,s=e("core/layers/providers/provider");r(n,s);var a=n.prototype;a.getFearures=function(){var e=$.Deferred();return e.promise()},a._getVectorLayerConfig=function(e){var t=$.Deferred();return $.get(this._baseUrl+e+"/?config"+this._customUrlParameters).done(function(e){t.resolve(e)}).fail(function(){t.reject()}),t.promise()},a._getVectorLayerData=function(e,t){var i,n=$.Deferred(),r="w"==this.getMode();return i=r?this._baseUrl+e[this._editingApiField]+"/?editing":this._baseUrl+e[this._editingApiField]+"/?",$.get(i+this._customUrlParameters+"&in_bbox="+t[0]+","+t[1]+","+t[2]+","+t[3]).done(function(e){n.resolve(e)}).fail(function(){n.reject()}),n.promise()},t.exports=n},{"core/layers/providers/provider":47,"core/utils/utils":77}],46:[function(e,t,i){function n(e){e=e||{},o(this),this._name="kml"}var r=e("core/utils/utils").inherit,o=e("core/utils/utils").base,s=e("core/layers/providers/provider");r(n,s);var a=n.prototype;a.getData=function(){var e=$.Deferred();return e.promise()},t.exports=n},{"core/layers/providers/provider":47,"core/utils/utils":77}],47:[function(e,t,i){function n(e){e=e||{},this._isReady=!1,this._name="provider",this._layer=e.layer,o(this)}var r=e("core/utils/utils").inherit,o=e("core/utils/utils").base,s=e("core/g3wobject");e("core/layers/features/feature");r(n,s);var a=n.prototype;a.getFeatures=function(){console.log("da sovrascrivere")},a.query=function(e){console.log("metodo da sovrascrivere")},a.setReady=function(e){this._isReady=e},a.isReady=function(){return this._isReady},a.error=function(){},a.isValid=function(){console.log("deve essere implementatato dai singoli provider")},a.getName=function(){return this._name},a.extractGML=function(e){if("--"!=e.substr(0,2))return e;for(var t=new RegExp("<([^ ]*)FeatureCollection"),i=new RegExp("<([^ ]*)msGMLOutput"),n="\r\n--",r=e.split(new RegExp(n)),o=0;o<r.length;o++){var s=r[o],a=!1;if(a=s.search(t)>-1||s.search(i)>-1){var l=s.substr(s.indexOf("<?xml"));return l}}},a.handleQueryResponseFromServer=function(e,t){var i=new ol.format.WMSGetFeatureInfo({layers:[this._layer.getId()]}),n=i.readFeatures(e);return[{layer:this._layer,features:n}];var i},a._parseLayerFeatureCollection=function(e,t){var i="wfs"==t?this._layer.getWMSLayerName().replace(/ /g,"_"):this._layer.getWMSLayerName().replace(/ /g,""),n=_.cloneDeep(e);n.FeatureCollection.featureMember=[];var r=e.FeatureCollection.featureMember;r=_.isArray(r)?r:[r],_.forEach(r,function(e){var t=_.get(e,i);t&&n.FeatureCollection.featureMember.push(e)});var o=new X2JS,s=o.json2xml_str(n),a=new ol.format.WMSGetFeatureInfo;return a.readFeatures(s)},a._parseLayermsGMLOutput=function(e){
var t=this._layer.getQueryLayerOrigName(),i=new ol.format.WMSGetFeatureInfo({layers:t});return i.readFeatures(e)},a._parseLayerGeoJSON=function(e){var t=new ol.format.GeoJSON({defaultDataProjection:this.crs,geometryName:"geometry"});return t.readFeatures(e)},t.exports=n},{"core/g3wobject":30,"core/layers/features/feature":34,"core/utils/utils":77}],48:[function(e,t,i){function n(){this.build=function(e,t,i,n){var r=this.get(e,t,i);return r?new r(n):null},this.get=function(e,t,i){return o[t][i][e]}}var r={geojson:e("./geojsonprovider"),kml:e("./kmlprovider"),xml:e("./xmlprovider"),qgis:e("./qgisprovider"),wms:e("./wmsprovider"),wfs:e("./wfsprovider")},o={QGIS:{postgres:{query:r.wms,filter:r.wfs,data:r.qgis,search:r.qgis},spatialite:{query:r.wms,filter:r.wfs,data:r.qgis,search:r.qgis},ogr:{query:r.wms,filter:r.wfs,data:null,search:r.qgis},delimitedtext:{query:r.wms,filter:r.wfs,data:null,search:null},wms:{query:r.wms,filter:r.wfs,data:null,search:null},wfs:{query:r.wms,filter:r.wfs,data:r.wfs,search:r.qgis},gdal:{query:r.wms,filter:null,data:null,search:null}},OGC:{wms:{query:r.wms,filter:null,data:null,search:null}}};t.exports=new n},{"./geojsonprovider":45,"./kmlprovider":46,"./qgisprovider":49,"./wfsprovider":50,"./wmsprovider":51,"./xmlprovider":52}],49:[function(e,t,i){function n(e){e=e||{},o(this),this._name="qgis",this._layer=e.layer||null,this._unlockUrl=this._layer.getUrl("unlock"),this._queryUrl=this._layer.getUrl("query"),this._editingUrl=this._layer.getUrl("editing"),this._commitUrl=this._layer.getUrl("commit"),this._dataUrl=this._layer.getUrls("data"),this._configUrl=this._layer.getUrl("config"),this._layerName=this._layer.getName()||null,this._infoFormat=this._layer.getInfoFormat()||"application/vnd.ogc.gml"}var r=e("core/utils/utils").inherit,o=e("core/utils/utils").base,s=e("core/layers/providers/provider"),a=e("core/layers/features/feature");r(n,s);var l=n.prototype;l.query=function(e){var t=this,i=$.Deferred();e=e||{};var n=e.filter||null;if(n){var r=(n.getType(),this._queryUrl);$.get(r,{SERVICE:"WMS",VERSION:"1.3.0",REQUEST:"GetFeatureInfo",LAYERS:this._layerName,QUERY_LAYERS:this._layerName,INFO_FORMAT:this._infoFormat,FEATURE_COUNT:200,FILTER:n.get()}).done(function(e){var n=t.handleQueryResponseFromServer(e,t._infoFormat,t._layerName),e={data:n,query:null};i.resolve(e)}).fail(function(){i.reject()})}return i.promise()},l.getConfig=function(e){e=e||{};var t=$.Deferred(),i=this._configUrl;return i?($.get(i).then(function(e){t.resolve(e)}).fail(function(e){t.reject(e)}),t.promise()):void t.reject("Url non valido")},l.unlock=function(){var e=$.Deferred();return $.post(this._unlockUrl).then(function(t){e.resolve(t)}).fail(function(t){e.reject(t)}),e.promise()},l.commit=function(e){var t=$.Deferred(),i=this._commitUrl,n=JSON.stringify(e);return $.post({url:i,data:n,contentType:"application/json"}).then(function(e){t.resolve(e)}).fail(function(e){t.reject(e)}),t.promise()},l.getFeatures=function(e){var t=this,i=$.Deferred();e=e||{};var n=e.editing?this._editingUrl:this._dataUrl,r=e.filter.bbox,o={in_bbox:r[0]+","+r[1]+","+r[2]+","+r[3]},s=this._layer.getPk();if(!n)return void i.reject("Url non valido");var l=[],c=JSON.stringify(o);return $.post({url:n,data:c,contentType:"application/json"}).then(function(e){var n=e.vector,r=e.featurelocks,o=n.data;_.forEach(t._parseLayerGeoJSON(o),function(e){l.push(new a({feature:e,pk:s}))}),i.resolve({features:l,featurelocks:r})}).fail(function(e){i.reject(e)}),i.promise()},l._loadLayerData=function(e,t){var i=this,n=$.Deferred();_.forEach(this._layers,function(e,t){_.isNull(e.vector)&&noVectorlayerCodes.push(t)});var r=_.map(noVectorlayerCodes,function(e){return i._setupVectorLayer(e)});return i.emit("loadingvectorlayersstart"),$.when.apply(this,r).then(function(){var e=Array.prototype.slice.call(arguments);i.emit("loadingvectolayersdatastart"),i.loadAllVectorsData(e).then(function(){i._vectorLayersCodes=e,n.resolve(e),i.emit("loadingvectorlayersend"),i.setReady(!0)}).fail(function(){_.forEach(i._layers,function(e){e.vector=null}),n.reject(),i.emit("errorloadingvectorlayersend"),i.setReady(!1)})}).fail(function(){i.setReady(!1),i.emit("errorloadingvectorlayersend"),n.reject()}),n.promise()},l.setVectorLayersCodes=function(e){this._vectorLayersCodes=e},l.getVectorLayersCodes=function(){return this._vectorLayersCodes},l.getLayers=function(){return this._layers},l.reloadVectorData=function(e){var t=this,i=$.Deferred(),n=this._mapService.state.bbox;return t._createVectorLayerFromConfig(e).then(function(e){t._getVectorLayerData(e,n).then(function(n){t.setVectorLayerData(e[t._editingApiField],n),e.setData(n.vector.data),i.resolve(e)})}),i.promise()},l.loadAllVectorsData=function(e){var t=this,i=$.Deferred(),n=this._layers,r=this._mapService.state.bbox,o=this._loadedExtent;if(o&&ol.extent.containsExtent(o,r))return resolvedValue();o?this._loadedExtent=ol.extent.extend(o,r):this._loadedExtent=r,e&&(n=[],_.forEach(e,function(e){n.push(t._layers[e])}));var s=_.map(n,function(e){return t._loadVectorData(e.vector,r)});return $.when.apply(this,s).then(function(){i.resolve(e)}).fail(function(){i.reject()}),i.promise()},l._setCustomUrlParameters=function(e){this._customUrlParameters=e},l._checkVectorGeometryTypeFromConfig=function(e){switch(e.geometrytype){case"Line":e.geometrytype="LineString";break;case"MultiLine":e.geometrytype="MultiLineString"}return e},l._createVectorLayerFromConfig=function(e){var t=this,i=this._layers[e],n=$.Deferred();return this._getVectorLayerConfig(i[this._editingApiField]).then(function(e){var r=e.vector;r=t._checkVectorGeometryTypeFromConfig(r);var o=i.crs||t._mapService.getProjection().getCode(),s=t._createVectorLayer({geometrytype:r.geometrytype,format:r.format,crs:t._mapService.getProjection().getCode(),crsLayer:o,id:i.id,name:i.name,pk:r.pk,editing:t._editingMode});s.setFields(r.fields),s.setCrs(o);var a=r.relations;a&&(s.lazyRelations=!0,s.setRelations(a)),i.style&&s.setStyle(i.style),n.resolve(s)}).fail(function(){n.reject()}),n.promise()},l._setupVectorLayer=function(e){var t=this,i=$.Deferred();return this._createVectorLayerFromConfig(e).then(function(n){var r=t._layers[e];r.vector=n,i.resolve(e)}).fail(function(){i.reject()}),i.promise()},l._loadVectorData=function(e,t){var i=this;return i._getVectorLayerData(e,t).then(function(t){if(i.setVectorLayerData(e[i._editingApiField],t),i._editingMode&&t.featurelocks&&i.setVectorFeaturesLock(e,t.featurelocks),e.setData(t.vector.data),i._)return t}).fail(function(){return!1})},l.getVectorLayerData=function(e){return this._vectorLayersData[e]},l.getVectorLayersData=function(){return this._vectorLayersData},l.setVectorLayerData=function(e,t){this._vectorLayersData[e]=t},l.setVectorFeaturesLock=function(e,t){var i=_.differenceBy(t,e.getFeatureLocks(),"featureid");_.forEach(i,function(t){e.addLockId(t)})},l.cleanVectorFeaturesLock=function(e){e.cleanFeatureLocks()},l.lockFeatures=function(e){var t=this,i=$.Deferred(),n=this._mapService.state.bbox,r=this._layers[e].vector;return $.get(this._baseUrl+e+"/?lock"+this._customUrlParameters+"&in_bbox="+n[0]+","+n[1]+","+n[2]+","+n[3]).done(function(e){t.setVectorFeaturesLock(r,e.featurelocks),i.resolve(e)}).fail(function(){i.reject()}),i.promise()},l._getVectorLayerConfig=function(e){var t=$.Deferred();return $.get(this._baseUrl+e+"/?config"+this._customUrlParameters).done(function(e){t.resolve(e)}).fail(function(){t.reject()}),t.promise()},l._getVectorLayerData=function(e,t){var i,n=$.Deferred(),r="w"==this.getMode();return i=r?this._baseUrl+e[this._editingApiField]+"/?editing":this._baseUrl+e[this._editingApiField]+"/?",$.get(i+this._customUrlParameters+"&in_bbox="+t[0]+","+t[1]+","+t[2]+","+t[3]).done(function(e){n.resolve(e)}).fail(function(){n.reject()}),n.promise()},l._createVectorLayer=function(e){var t=new VectorLayer(e);return t},l.cleanUpLayers=function(){this._loadedExtent=null},t.exports=n},{"core/layers/features/feature":34,"core/layers/providers/provider":47,"core/utils/utils":77}],50:[function(e,t,i){function n(e){e=e||{},s(this,e),this._name="wfs"}var r=e("core/utils/utils").inherit,o=e("core/utils/utils").resolve,s=e("core/utils/utils").base,a=e("core/layers/providers/provider"),l=e("core/layers/filter/filter");r(n,a);var c=n.prototype;c.getData=function(){var e=$.Deferred();return e.promise()},c.query=function(e){var t=this,i=e.filter,n=$.Deferred();return this._doRequest(i).done(function(e){var i=t.handleQueryResponseFromServer(e,"wfs");n.resolve({data:i})}).fail(function(e){n.reject(e)}),n.promise()},c._post=function(e,t){return e+="/",$.post(e,t)},c._get=function(e,t){var i=$.param(t);return e=e+"?"+i,$.get(e)},c._doRequest=function(e){if(e=e||null,!(e instanceof l))return o();var t=this._layer,i=t.getQueryUrl(),n=t.getProjection().getCode(),r=t.getInfoFormat(),s={SERVICE:"WFS",VERSION:"1.3.0",REQUEST:"GetFeature",TYPENAME:t.getQueryLayerName().replace(/ /g,"_"),OUTPUTFORMAT:r,SRSNAME:n},a=e.getType(),e=e.get();if(e){var c=ol.format.filter;switch(a){case"bbox":var u=(new ol.format.WFS).writeGetFeature({featureTypes:[t],filter:c.bbox("the_geom",e)});break;case"geometry":var u=(new ol.format.WFS).writeGetFeature({featureTypes:[t],filter:c.intersects("the_geom",e)});break;case"expression":var u=(new ol.format.WFS).writeGetFeature({featureTypes:[t],filter:null})}return s.FILTER=u.children[0].innerHTML,request=this._post(i,s),request}},t.exports=n},{"core/layers/filter/filter":38,"core/layers/providers/provider":47,"core/utils/utils":77}],51:[function(e,t,i){function n(e){e=e||{},o(this,e),this._name="wms",this._url=this._layer.getQueryUrl(),this._layerName=this._layer.getName()||null,this._infoFormat=this._layer.getInfoFormat()||"application/vnd.ogc.gml"}var r=e("core/utils/utils").inherit,o=e("core/utils/utils").base,s=e("core/utils/utils"),a=e("g3w-ol3/src/utils/utils"),l=e("core/layers/providers/provider"),c=10,u=[101,101];r(n,l);var h=n.prototype;h._getRequestUrl=function(e,t,i,n,r,o){o.CRS=r.getCode(),"STYLES"in o||(o.STYLES=""),o.DPI=90*n,o.WIDTH=i[0],o.HEIGHT=i[1];var a,l=r.getAxisOrientation();return a="ne"==l.substr(0,2)?[t[1],t[0],t[3],t[2]]:t,o.BBOX=a.join(","),s.appendParams(e,o)},h._getGetFeatureInfoUrlForLayer=function(e,t,i,n){var r=a.getExtentForViewAndSize(t,i,0,u),o={SERVICE:"WMS",VERSION:"1.3.0",REQUEST:"GetFeatureInfo",FORMAT:"image/png",TRANSPARENT:!0,QUERY_LAYERS:this._layer.getName()};_.merge(o,n);var s=Math.floor((t[0]-r[0])/i),l=Math.floor((r[3]-t[1])/i);return o.I=s,o.J=l,this._getRequestUrl(e,r,u,1,this._layer.getProjection(),o)},h.query=function(e){var t=$.Deferred(),i=e.coordinates||[],n=e.resolution||null,r=this._url,o=r.split("SOURCE");o.length&&(r=o[0],o=o.length>1?"&SOURCE"+o[1]:"");var s={LAYERS:this._layerName,QUERY_LAYERS:this._layerName,INFO_FORMAT:this._infoFormat,FEATURE_COUNT:10,FI_POINT_TOLERANCE:c,FI_LINE_TOLERANCE:c,FI_POLYGON_TOLERANCE:c,G3W_TOLERANCE:c*n},a=this._getGetFeatureInfoUrlForLayer(r,i,n,s),l=a.split("?")[1];return r+="?"+l+o,this.makeQueryForLayer(r,i,n).then(function(e){t.resolve(e)}).fail(function(e){t.reject(e)}),t.promise()},h.makeQueryForLayer=function(e,t,i){var n=$.Deferred(),r={coordinates:t,resolution:i};return this.doRequestAndParse(e).then(function(e){n.resolve({data:e,query:r})}).fail(function(e){n.reject(e)}),n.promise()},h.doRequestAndParse=function(e){var t=this,i=$.Deferred();return $.get(e).done(function(e){var n=t.handleQueryResponseFromServer(e,t._infoFormat,t._layerName);i.resolve(n)}).fail(function(){i.reject()}),i},t.exports=n},{"core/layers/providers/provider":47,"core/utils/utils":77,"g3w-ol3/src/utils/utils":111}],52:[function(e,t,i){function n(e){e=e||{},o(this),this._name="xml"}var r=e("core/utils/utils").inherit,o=e("core/utils/utils").base,s=e("core/layers/providers/provider");r(n,s);var a=n.prototype;a.getData=function(){var e=$.Deferred();return e.promise()},t.exports=n},{"core/layers/providers/provider":47,"core/utils/utils":77}],53:[function(e,t,i){function n(t){var i=this,n=e("core/project/projectsregistry"),r=n.getCurrentProject();this.setters={clearFeatures:function(){this._clearFeatures()},addFeature:function(e){this._addFeature(e)},deleteFeature:function(e){this._deleteFeature(e)},updateFeature:function(e){this._updateFeature(e)},setFeatures:function(e){this._setFeatures(e)},getFeatures:function(e){var t=this,i=$.Deferred();return this._featuresStore.getFeatures(e).then(function(e){e.then(function(e){return t.emit("getFeatures",e),i.resolve(e)}).fail(function(e){return i.reject(e)})}).fail(function(e){i.reject(e)}),i.promise()},commit:function(e,t){var n=$.Deferred();return this._featuresStore.commit(e,t).then(function(e){e.then(function(e){if(t)var r=_.clone(t.readFeatures());return _.forEach(r,function(e){e.clearState()}),i._featuresStore.setFeatures(r),i._applyCommitResponse(e),n.resolve(e)}).fail(function(e){return n.reject(e)})}).fail(function(e){n.reject(e)}),n.promise()}},this.type=s.LayerTypes.TABLE,this._editor=new a({layer:this});var c=r.getRelations();this._relations=null;var u=r.getType(),h=r.getId(),p=initConfig.vectorurl,d=u+"/"+h+"/"+t.id+"/";t.urls={editing:p+"editing/"+d,commit:p+"commit/"+d,data:p+"data/"+d,config:p+"config/"+d,unlock:p+"unlock/"+d},t.editing={pk:null,fields:[]},o(this,t),this.state=_.merge({editing:{started:!1,modified:!1,ready:!1,ispkeditable:!1}},this.state),this._createRelations(c),this.getEditingConfig().then(function(e){i.config.editing.pk=e.vector.pk,i.config.editing.fields=e.vector.fields,i.config.editing.format=e.vector.format,i._setOtherConfigParameters(e),i._setPkEditable(i.config.editing.fields),i.setReady(!0)}).fail(function(e){i.setReady(!1)}),this._featuresStore=new l({provider:this.providers.data})}var r=e("core/utils/utils").inherit,o=e("core/utils//utils").base,s=e("./layer"),a=e("core/editing/editor"),l=e("./features/featuresstore"),c=e("./features/feature"),u=e("core/relations/relations");r(n,s);var h=n.prototype;h._applyCommitResponse=function(e){var t=this,i=e.vector?e.vector.data:null;if(i){var n,r=i.response["new"],o=i.response.new_lockids;_.forEach(r,function(e){n=t._featuresStore.getFeatureById(e.clientid),n.setId(e.id)}),this._featuresStore.addLockIds(o)}},h.unlock=function(){var e=$.Deferred();return this._featuresStore.unlock().then(function(){e.resolve()}).fail(function(t){e.reject(t)}),e.promise()},h._setOtherConfigParameters=function(e){},h.getFields=function(){return this.config.editing.fields},h.getDataFormat=function(){return this.config.editing.format},h.getPk=function(){return this.config.editing.pk},h._setPkEditable=function(e){var t=this;_.forEach(e,function(e){if(e.name==t.getPk())return t.state.editing.ispkeditable=e.editable,!1})},h.getEditingFields=function(){return this.config.editing.fields},h.getEditingFormat=function(){return this.config.editing.format},h.isReady=function(){return this.state.editing.ready},h.setReady=function(e){this.state.editing.ready=!!_.isBoolean(e)&&e},h.isPkEditable=function(){return this.state.editing.ispkeditable},h.getEditingConfig=function(e){var t=$.Deferred();e=e||{};var i=this.getProvider("data");return i.getConfig(e).then(function(e){t.resolve(e)}).fail(function(e){t.reject()}),t.promise()},h.getCommitUrl=function(){return this.config.urls.commit},h.setCommitUrl=function(e){this.config.urls.commit=e},h.getEditingUrl=function(){return this.config.urls.editing},h.setEditingUrl=function(e){this.config.urls.editing=e},h.getUnlockUrl=function(){this.config.url.unlock},h.setUnlockUrl=function(e){this.config.urls.unlock=e},h.setDataUrl=function(e){this.config.urls.data=e},h.getDataUrl=function(){return this.config.urls.data},h.getConfigUrl=function(){return this.config.urls.config},h.setConfigUrl=function(e){this.config.urls.config=e},h.getEditor=function(){return this._editor},h.setEditor=function(e){this._editor=e},h.getFeaturesStore=function(){return this._featuresStore},h.setFeaturesStore=function(e){this._featuresStore=e},h.setSource=function(e){this.setFeaturesStore(e)},h._setFeatures=function(e){this._featuresStore.setFeatures(e)},h.addFeatures=function(e){var t=this;_.forEach(e,function(e){t.addFeature(e)})},h._addFeature=function(e){this._featuresStore.addFeature(e)},h._deleteFeature=function(e){e.getId()},h._updateFeature=function(e){},h._clearFeatures=function(){this._featuresStore.clearFeatures()},h.addLockIds=function(e){this._featuresStore.addLockIds(e)},h.setFieldsWithValues=function(e,t){var i,n={};_.forEach(t,function(t){e.getPk()==t.name&&t.editable?(i="integer"==t.type?1*t.value:t.value,e.setId(i)):("null"==t.value&&(t.value=null),n[t.name]=t.value)}),e.setProperties(n)},h.getFieldsWithValues=function(e,t){var i=this;t=t||{};var n,r,o=t.exclude||[],s=_.cloneDeep(this.getFields());return e instanceof c?n=e:e&&(n=this.getFeatureById(e)),n&&(r=n.getProperties()),s=_.filter(s,function(e){return o.indexOf(e.name)==-1}),_.forEach(s,function(e){n?e.name==i.config.editing.pk?n.getId()&&i.isPkEditable()?e.value=n.getId():e.value=null:e.value=r[e.name]:e.value=null}),s},h._createRelations=function(e){var t=[],i=this.getId();_.forEach(e,function(e){[e.referencedLayer,e.referencingLayer].indexOf(i)!=-1&&t.push(e)}),t.length&&(this._relations=new u({relations:t}))},h.getRelations=function(){return this._relations},h.getRelationAttributes=function(e){var t=[];return _.forEach(this._relations,function(i){if(i.name==e)return t=i.fields,!1}),t},h.getRelationsAttributes=function(){var e={};return _.forEach(this.state.relations,function(t){e[t.name]=t.fields}),e},h.isChild=function(){return!!this.getRelations()&&this._relations.isChild(this.getId())},h.isFather=function(){return!!this.getRelations()&&this._relations.isFather(this.getId())},h.getChildren=function(){return this.isFather()?this._relations.getChildren(this.getId()):[]},h.getFathers=function(){return this.isChild()?this._relations.getFathers(this.getId()):[]},h.hasChildren=function(){return!!this.hasRelations()&&this._relations.hasChildren(this.getId())},h.hasFathers=function(){return!!this.hasRelations()&&this._relations.hasFathers(this.getId())},h.hasRelations=function(){return!!this._relations},t.exports=n},{"./features/feature":34,"./features/featuresstore":35,"./layer":41,"core/editing/editor":26,"core/project/projectsregistry":71,"core/relations/relations":74,"core/utils//utils":77,"core/utils/utils":77}],54:[function(e,t,i){function n(e){o(this,e),this.type=a.LayerTypes.VECTOR,this._color=null,this.setup(e)}var r=e("core/utils/utils").inherit,o=e("core/utils//utils").base,s=e("core/utils/utils").mixin,a=e("./layer"),l=e("./tablelayer"),c=e("./geolayermixin");r(n,l),s(n,c);var u=n.prototype;u._setOtherConfigParameters=function(e){this.config.editing.geometrytype=e.vector.geometrytype},u.getEditingGeometryType=function(){return this.config.editing.geometrytype},u.getLayerForEditing=function(){var e=_.cloneDeep(this);return e},u.setColor=function(e){this._color=e},u.getColor=function(){return this._color},t.exports=n},{"./geolayermixin":39,"./layer":41,"./tablelayer":53,"core/utils//utils":77,"core/utils/utils":77}],55:[function(e,t,i){function n(e,t){o(this,e),this.layer=null}var r=e("core/utils/utils").inherit,o=e("core/utils/utils").base,s=(e("core/utils/geo"),e("core/map/layer/maplayer"));e("g3w-ol3/src/layers/bases");r(n,s);var a=n.prototype;a.getOLLayer=function(){var e=this._olLayer;return e||(e=this._olLayer=this._makeOlLayer()),e},a.getSource=function(){return this.getOLLayer().getSource()},a.getLayerConfigs=function(){return this.layer},a.addLayer=function(e){this.layer=e},a.toggleLayer=function(e){this._updateLayers()},a.update=function(e,t){this._updateLayer(e,t)},a.isVisible=function(){return layer.state.visible},a._makeOlLayer=function(){var e,t=this,i=this.layer.state.source?this.layer.state.source.subtype:null;switch(i){case"streets":e=BaseLayers.BING.Road;break;case"aerial":e=BaseLayers.BING.Aerial;break;case"aerialwithlabels":e=BaseLayers.BING.AerialWithLabels;break;default:e=BaseLayers.BING.Aerial}return e.getSource().on("imageloadstart",function(){t.emit("loadstart")}),e.getSource().on("imageloadend",function(){t.emit("loadend")}),e},a._updateLayer=function(e,t){this._olLayer.setVisible(this.layer.isVisible())},t.exports=n},{"core/map/layer/maplayer":58,"core/utils/geo":76,"core/utils/utils":77,"g3w-ol3/src/layers/bases":105}],56:[function(e,t,i){function n(){this._layers={},this._type="tipo di layers",this._isReady=!1,o(this)}var r=e("core/utils/utils").inherit,o=e("core/utils/utils").base,s=e("core/g3wobject");r(n,s);var a=n.prototype;a.getLoaderType=function(){return this._type},a.getLayers=function(){return this._layers},a.getLayer=function(e){return this._layers[e]},a.loadLayer=function(e,t){},a.loadLayers=function(){},a.cleanUpLayers=function(){},a.setReady=function(e){this._isReady=e},a.isReady=function(){return this._isReady},a.setMode=function(e){switch(e){case"w":this._editingMode=!0;break;case"r":this._editingMode=!1;break;default:e="w",this._editingMode=!0}this._mode=e,this.emit("setmode",e)},a.getMode=function(){return this._mode},t.exports=n},{"core/g3wobject":30,"core/utils/utils":77}],57:[function(e,t,i){function n(){this._layer={},this._type="vector",this._layerCodes=[],this._baseUrl="",this._mapService=null,this._loadedExtent=null,this._editingMode=!1,this._customUrlParameters="",this._vectorLayersCodes=[],this._vectorLayersData={},o(this),this.init=function(e){this._layers=e.layers||{},this._baseUrl=e.baseurl||"",this._mapService=e.mapService||null,this._layerCodes=_.keys(this._layers),this._editingApiField=e.editingApiField||"name"}}var r=e("core/utils/utils").inherit,o=e("core/utils/utils").base,s=e("core/utils/utils").resolve,a=e("core/map/layer/vectorlayer"),l=e("./loaderlayer");r(n,l);var c=n.prototype;c.loadLayers=function(e,t){var i=this,n=$.Deferred(),r=[];this.setMode(e),t&&this._setCustomUrlParameters(t),_.forEach(this._layers,function(e,t){_.isNull(e.vector)&&r.push(t)});var o=_.map(r,function(e){return i._setupVectorLayer(e)});return i.emit("loadingvectorlayersstart"),$.when.apply(this,o).then(function(){var e=Array.prototype.slice.call(arguments);i.emit("loadingvectolayersdatastart"),i.loadAllVectorsData(e).then(function(){i._vectorLayersCodes=e,n.resolve(e),i.emit("loadingvectorlayersend"),i.setReady(!0)}).fail(function(){_.forEach(i._layers,function(e){e.vector=null}),n.reject(),i.emit("errorloadingvectorlayersend"),i.setReady(!1)})}).fail(function(){i.setReady(!1),i.emit("errorloadingvectorlayersend"),n.reject()}),n.promise()},c.setVectorLayersCodes=function(e){this._vectorLayersCodes=e},c.getVectorLayersCodes=function(){return this._vectorLayersCodes},c.getLayers=function(){return this._layers},c.reloadVectorData=function(e){var t=this,i=$.Deferred(),n=this._mapService.state.bbox;return t._createVectorLayerFromConfig(e).then(function(e){t._getVectorLayerData(e,n).then(function(n){t.setVectorLayerData(e[t._editingApiField],n),e.setData(n.vector.data),i.resolve(e)})}),i.promise()},c.loadAllVectorsData=function(e){var t=this,i=$.Deferred(),n=this._layers,r=this._mapService.state.bbox,o=this._loadedExtent;if(o&&ol.extent.containsExtent(o,r))return s();o?this._loadedExtent=ol.extent.extend(o,r):this._loadedExtent=r,e&&(n=[],_.forEach(e,function(e){n.push(t._layers[e])}));var a=_.map(n,function(e){return t._loadVectorData(e.vector,r)});return $.when.apply(this,a).then(function(){i.resolve(e)}).fail(function(){i.reject()}),i.promise()},c._setCustomUrlParameters=function(e){this._customUrlParameters=e},c._checkVectorGeometryTypeFromConfig=function(e){switch(e.geometrytype){case"Line":e.geometrytype="LineString";break;case"MultiLine":e.geometrytype="MultiLineString"}return e},c._createVectorLayerFromConfig=function(e){var t=this,i=this._layers[e],n=$.Deferred();return this._getVectorLayerConfig(i[this._editingApiField]).then(function(e){var r=e.vector;r=t._checkVectorGeometryTypeFromConfig(r);var o=i.crs||t._mapService.getProjection().getCode(),s=t._createVectorLayer({geometrytype:r.geometrytype,format:r.format,crs:t._mapService.getProjection().getCode(),crsLayer:o,id:i.id,name:i.name,pk:r.pk,editing:t._editingMode});s.setFields(r.fields),s.setCrs(o);var a=r.relations;a&&(s.lazyRelations=!0,s.setRelations(a)),i.style&&s.setStyle(i.style),n.resolve(s)}).fail(function(){n.reject()}),n.promise()},c._setupVectorLayer=function(e){var t=this,i=$.Deferred();return this._createVectorLayerFromConfig(e).then(function(n){var r=t._layers[e];r.vector=n,i.resolve(e)}).fail(function(){i.reject()}),i.promise()},c._loadVectorData=function(e,t){var i=this;return i._getVectorLayerData(e,t).then(function(t){if(i.setVectorLayerData(e[i._editingApiField],t),i._editingMode&&t.featurelocks&&i.setVectorFeaturesLock(e,t.featurelocks),e.setData(t.vector.data),i._)return t}).fail(function(){return!1})},c.getVectorLayerData=function(e){return this._vectorLayersData[e]},c.getVectorLayersData=function(){return this._vectorLayersData},c.setVectorLayerData=function(e,t){this._vectorLayersData[e]=t},c.setVectorFeaturesLock=function(e,t){var i=_.differenceBy(t,e.getFeatureLocks(),"featureid");_.forEach(i,function(t){e.addLockId(t)})},c.cleanVectorFeaturesLock=function(e){e.cleanFeatureLocks()},c.lockFeatures=function(e){var t=this,i=$.Deferred(),n=this._mapService.state.bbox,r=this._layers[e].vector;return $.get(this._baseUrl+e+"/?lock"+this._customUrlParameters+"&in_bbox="+n[0]+","+n[1]+","+n[2]+","+n[3]).done(function(e){t.setVectorFeaturesLock(r,e.featurelocks),i.resolve(e)}).fail(function(){i.reject()}),i.promise()},c._getVectorLayerConfig=function(e){var t=$.Deferred();return $.get(this._baseUrl+e+"/?config"+this._customUrlParameters).done(function(e){t.resolve(e)}).fail(function(){t.reject()}),t.promise()},c._getVectorLayerData=function(e,t){var i,n=$.Deferred(),r="w"==this.getMode();return i=r?this._baseUrl+e[this._editingApiField]+"/?editing":this._baseUrl+e[this._editingApiField]+"/?",$.get(i+this._customUrlParameters+"&in_bbox="+t[0]+","+t[1]+","+t[2]+","+t[3]).done(function(e){n.resolve(e)}).fail(function(){n.reject()}),n.promise()},c._createVectorLayer=function(e){var t=new a(e);return t},c.cleanUpLayers=function(){this._loadedExtent=null},t.exports=n},{"./loaderlayer":56,"core/map/layer/vectorlayer":60,"core/utils/utils":77}],58:[function(e,t,i){function n(e){this.config=e||{},this.id=e.id,this.projection=e.projection,this._olLayer=null,o(this)}var r=e("core/utils/utils").inherit,o=e("core/utils/utils").base,s=e("core/g3wobject");r(n,s);var a=n.prototype;a.getId=function(){return this.id},t.exports=n},{"core/g3wobject":30,"core/utils/utils":77}],59:[function(e,t,i){function n(e,t){o(this,e),this.layer=null}var r=e("core/utils/utils").inherit,o=e("core/utils/utils").base,s=(e("core/utils/geo"),e("core/map/layer/maplayer")),a=e("g3w-ol3/src/layers/bases");r(n,s);var l=n.prototype;l.getOLLayer=function(){var e=this._olLayer;return e||(e=this._olLayer=this._makeOlLayer()),e},l.getSource=function(){return this.getOLLayer().getSource()},l.getLayerConfigs=function(){return this.layer},l.addLayer=function(e){this.layer=e},l.toggleLayer=function(e){this._updateLayers()},l.update=function(e,t){this._updateLayer(e,t)},l.isVisible=function(){return layer.state.visible},l._makeOlLayer=function(){var e=this,t=a.OSM;return t.getSource().on("imageloadstart",function(){e.emit("loadstart")}),t.getSource().on("imageloadend",function(){e.emit("loadend")}),t},l._updateLayer=function(e,t){this._olLayer.setVisible(this.layer.isVisible())},t.exports=n},{"core/map/layer/maplayer":58,"core/utils/geo":76,"core/utils/utils":77,"g3w-ol3/src/layers/bases":105}],60:[function(e,t,i){function n(e){var e=e||{};this.geometrytype=e.geometrytype||null,this.format=e.format||null,this.crs=e.crs||null,this.crsLayer=e.crsLayer||this.crs,this.id=e.id||null,this.name=e.name||"",this.pk=e.pk||"id",this._olSource=new ol.source.Vector({features:new ol.Collection}),this._olLayer=new ol.layer.Vector({name:this.name,source:this._olSource}),this._isReady=!1,this._PKinAttributes=!1,this._featuresFilter=null,this._fields=null,this._relationsDataLoaded={},this.lazyRelations=!0,this._relations=null,this._editingMode=e.editing||!1,this._loadedIds=[],this._featureLocks=[],this._crs=null}var r=e("core/utils/utils").inherit,o=(e("core/utils/utils").truefnc,e("core/utils/utils").resolve),s=(e("core/utils/utils").reject,e("core/g3wobject"));r(n,s),t.exports=n;var a=n.prototype;a.getPk=function(){return this.pk},a.setData=function(e){var t,i=this,n=[];if(this.format){switch(this.format){case"GeoJSON":var r=new ol.format.GeoJSON({geometryName:"geometry"});t=r.readFeatures(e,{dataProjection:i.crsLayer,featureProjection:i.crs})}if(this._editingMode&&this._featureLocks&&(t=_.filter(t,function(e){var t=!1;return _.forEach(i._featureLocks,function(i){i.featureid==e.getId()&&(t=!0,n.push(e.getId()))}),t})),t&&t.length){_.isNull(this._featuresFilter)||(t=_.map(t,function(e){return i._featuresFilter(e)}));var o=_.filter(t,function(e){return!_.includes(i._loadedIds,e.getId())});this._olSource.addFeatures(o);var s=this.getSource().getFeatures()[0].getProperties();this._PKinAttributes=!!_.get(s,this.pk),this._loadedIds=_.union(this._loadedIds,n)}}else console.log("VectorLayer format not defined")},a.cleanFeatureLocks=function(){this._featureLocks=[]},a.setFeatureLocks=function(e){this._featureLocks=e},a.getFeatureLocks=function(){return this._featureLocks},a.addLockId=function(e){this._featureLocks.push(e)},a.addFeature=function(e){this.getSource().addFeature(e)},a.addFeatures=function(e){this.getSource().addFeatures(e)},a.modifyFeatureGeometry=function(e,t){var i=this.getFeatures(),n=null;return _.forEach(i,function(n,r){if(n.getId()==e)return i[r].setGeometry(t),n=n[r]}),n},a.setFeaturesFilter=function(e){this._featuresFilter=e},a.setFields=function(e){this._fields=e},a.setCrs=function(e){this._crs=e},a.getCrs=function(){return this._crs},a.setPkField=function(){var e=this,t=!1;_.forEach(this._fields,function(i){i.name==e.pk&&(t=!0)}),t||this._fields},a.getFeatures=function(){return this.getSource().getFeatures()},a.getFeatureIds=function(){var e=_.map(this.getSource().getFeatures(),function(e){return e.getId()});return e},a.getIntersectedFeatures=function(e){var t=[];return _.forEach(this.getFeatures(),function(i){e.intersectsExtent(i.getGeometry().getExtent())&&t.push(i)}),t},a.getFields=function(){return _.cloneDeep(this._fields)},a.getAttributes=function(){return this._fields},a.getFieldsNames=function(){return _.map(this._fields,function(e){return e.name})},a.getFieldsWithValues=function(e){var t,i,n=this,r=_.cloneDeep(this._fields);return e instanceof ol.Feature?t=e:e&&(t=this.getFeatureById(e)),t&&(i=t.getProperties()),_.forEach(r,function(e){t?this._PKinAttributes||e.name!=n.pk?e.value=i[e.name]:n.isNewFeature(t.getId())?e.value=null:e.value=t.getId():e.value=null}),r},a.setRelations=function(e){this._relations=e,_.forEach(e,function(e){_.forEach(e.fields,function(t,i){t.name==e.pk&&(e.pkFieldIndex=i)})})},a.getRelations=function(){return this._relations},a.getRelationsAttributes=function(){var e={};return _.forEach(this._relations,function(t){e[t.name]=t.fields}),e},a.getRelation=function(e){var t;return _.forEach(this._relations,function(i){i.name==e&&(t=i)}),t},a.hasRelations=function(){return!_.isNull(this._relations)},a.getRelationPkFieldIndex=function(e){var t;return _.forEach(e.fields,function(i,n){i.name==e.pk&&(t=n)}),t},a.getRelationElementPkValue=function(e,t){var i=this.getRelationPkFieldIndex(e);return t.fields[i].value},a.getRelationsFksKeys=function(){var e=[];return _.forEach(this._relations,function(t){e.push(t.fk)}),e},a.getRelationFields=function(e){return e.fields},a.getRelationFieldsNames=function(e){return _.map(relationFields,function(e){return e.name})},a.getRelationsWithValues=function(e){var t=this;this._relations||o([]);var i=_.cloneDeep(this._relations);if(e||this.getFeatureById(e)){if(this.lazyRelations){if(t._relationsDataLoaded[e])return o(this._relationsDataLoaded[e]);var n=$.Deferred(),r=this.getFeatureById(e).getProperties(),s={};return _.forEach(i,function(i){
_.forEach(i.fk,function(i){i==t.pk?s[i]=e:s[i]=r[i]})}),this.getRelationsWithValuesFromFks(s).then(function(i){t._relationsDataLoaded[e]=i,n.resolve(i)}).fail(function(){n.reject()}),n.promise()}return o(this._relations)}return _.forEach(i,function(e){e.elements=[]}),o(i)},a.getRelationsWithValuesFromFks=function(e,t){var i=_.cloneDeep(this._relations),n=[];return _.forEach(i,function(i){i.elements=[];var r=i.url,o=[];_.forEach(i.fk,function(t){var i=e[t];o.push(t+"="+i)});var s=_.join(o,"&");r+="?"+s,n.push($.get(r).then(function(e){e.length&&_.forEach(e,function(e){var n={};n.fields=_.cloneDeep(i.fields),_.forEach(n.fields,function(r){if(r.value=e[r.name],r.name==i.pk){n.id=r.value;var o=t?"NEW":"OLD";n.state=o}}),i.elements.push(n)})}))}),$.when.apply(this,n).then(function(){return i})},a.getNewRelationsWithValuesFromFks=function(e){return this.getRelationsWithValuesFromFks(e,!0)},a.featureHasRelationsFksWithValues=function(e){var t=e.getProperties(),i=this.getRelationsFksKeys();return _.every(i,function(e){var i=t[e];return!_.isNil(i)&&""!=i})},a.getRelationsFksWithValuesForFeature=function(e){var t=e.getProperties(),i={},n=this.getRelationsFksKeys();return _.forEach(n,function(e){i[e]=t[e]}),i},a.setRelationsData=function(e,t){this._relationsDataLoaded[e]=t},a.setStyle=function(e){this._olLayer.setStyle(e)},a.getMapLayer=function(){return this._olLayer},a.getSource=function(){return this._olLayer.getSource()},a.getFeatureById=function(e){if(e)return this._olLayer.getSource().getFeatureById(e)},a.isVisible=function(){return this._olLayer.getVisible()},a.setVisible=function(e){this._olLayer.setVisible(e)},a.clear=function(){this.getSource().clear()},a.addToMap=function(e){e.addLayer(this._olLayer)},a.isNewFeature=function(e){return!e||0==e.toString().indexOf(this._newPrefix)}},{"core/g3wobject":30,"core/utils/utils":77}],61:[function(e,t,i){function n(e,t){this.LAYERTYPE={LAYER:"layer",MULTILAYER:"multilayer"},this.extraParams=t,this.layers=[],o(this,e)}var r=e("core/utils/utils").inherit,o=e("core/utils/utils").base,s=e("core/utils/geo"),a=e("core/map/layer/maplayer"),l=e("g3w-ol3/src/layers/rasters");r(n,a);var c=n.prototype;c.getOLLayer=function(e){var t=this._olLayer;return t||(t=this._olLayer=this._makeOlLayer(e)),t},c.getSource=function(){return this.getOLLayer().getSource()},c.getInfoFormat=function(){return"application/vnd.ogc.gml"},c.getGetFeatureInfoUrl=function(e,t,i,n){return this.getOLLayer().getSource().getGetFeatureInfoUrl(e,t,i,n)},c.getLayerConfigs=function(){return this.layers},c.addLayer=function(e){this.layers.push(e)},c.toggleLayer=function(e){_.forEach(this.layers,function(t){t.id==e.id&&(t.visible=e.visible)}),this._updateLayers()},c.update=function(e,t){this._updateLayers(e,t)},c.isVisible=function(){return this._getVisibleLayers().length>0},c.getQueryUrl=function(){var e=this.layers[0];return e.infourl&&""!=e.infourl?e.infourl:this.config.url},c.getQueryableLayers=function(){return _.filter(this.layers,function(e){return e.isQueryable()})},c._getVisibleLayers=function(e){var t=[];return _.forEach(this.layers,function(i){var n=!i.state.maxresolution||i.state.maxresolution&&i.state.maxresolution>e.resolution;i.state.visible&&n&&t.push(i)}),t},c._makeOlLayer=function(e){var t=this,i={url:this.config.url,id:this.config.id};e&&(i.layers=_.map(this.layers,function(e){return e.getWMSLayerName()}));var n=this.layers[0];n.state.source&&"wms"==n.state.source.type&&n.state.source.url&&(i.url=n.state.source.url);var r=new l.WMSLayer(i,this.extraParams);return r.getSource().on("imageloadstart",function(){t.emit("loadstart")}),r.getSource().on("imageloadend",function(){t.emit("loadend")}),r},c.checkLayerDisabled=function(e,t){var i=!0;if(e.config.scalebasedvisibility){var n=s.resToScale(t);e.config.maxresolution&&(i=i&&e.config.maxresolution>t),e.config.minresolution&&(i=i&&e.config.minresolution<t),e.config.minscale&&(i=i&&e.config.minscale>n),e.config.maxscale&&(i=i&&e.config.maxscale<n)}e.state.disabled=!i},c.checkLayersDisabled=function(e){var t=this;_.forEach(this.layers,function(i){t.checkLayerDisabled(i,e)})},c._updateLayers=function(e,t){this.checkLayersDisabled(e.resolution);var i=this._getVisibleLayers(e);if(i.length>0){var n={LAYERS:_.join(_.map(i,function(e){return e.getWMSLayerName()}),",")};t&&(n=_.assign(n,t)),this._olLayer.setVisible(!0),this._olLayer.getSource().updateParams(n)}else this._olLayer.setVisible(!1)},t.exports=n},{"core/map/layer/maplayer":58,"core/utils/geo":76,"core/utils/utils":77,"g3w-ol3/src/layers/rasters":106}],62:[function(e,t,i){function n(e,t){o(this,e),this.layer=null}var r=e("core/utils/utils").inherit,o=e("core/utils/utils").base,s=(e("core/utils/geo"),e("core/map/layer/maplayer")),a=e("g3w-ol3/src/layers/rasters");r(n,s);var l=n.prototype;l.getOLLayer=function(){var e=this._olLayer;return e||(e=this._olLayer=this._makeOlLayer()),e},l.getSource=function(){return this.getOLLayer().getSource()},l.getLayerConfigs=function(){return this.layer},l.addLayer=function(e){this.layer=e},l.toggleLayer=function(e){this._updateLayers()},l.update=function(e,t){this._updateLayer(e,t)},l.isVisible=function(){return layer.state.visible},l._makeOlLayer=function(){var e=this,t=this.projection?this.projection:this.layer.getProjection(),i={url:this.layer.getCacheUrl()+"/{z}/{x}/{y}.png",maxZoom:20};i.projection=t;var n=a.XYZLayer(i);return n.getSource().on("imageloadstart",function(){e.emit("loadstart")}),n.getSource().on("imageloadend",function(){e.emit("loadend")}),n},l._updateLayer=function(e,t){this._olLayer.setVisible(this.layer.isVisible())},t.exports=n},{"core/map/layer/maplayer":58,"core/utils/geo":76,"core/utils/utils":77,"g3w-ol3/src/layers/rasters":106}],63:[function(e,t,i){function n(){o(this)}var r=e("core/utils/utils").inherit,o=e("core/utils//utils").base,s=e("core/layers/layersstoresregistry");r(n,s),t.exports=new n},{"core/layers/layersstoresregistry":44,"core/utils//utils":77,"core/utils/utils":77}],64:[function(e,t,i){var n=e("core/utils/utils").inherit,r=e("core/utils/utils").base,o=e("core/g3wobject"),s=e("core/project/projectsregistry"),a=e("./pluginsregistry"),l=function(){r(this),this.name="(no name)",this.config=null,this.service=null};n(l,o);var c=l.prototype;c.getService=function(){return this.service},c.setService=function(e){this.service=e},c.getName=function(){return this.name},c.setName=function(e){this.name=e},c.getConfig=function(e){return e=e||this.name,a.getPluginConfig(e)},c.setConfig=function(e){this.config=e},c.isCurrentProjectCompatible=function(e){var t=s.getCurrentProject();return e==t.getGid()},c.registerPlugin=function(e){return!!this.isCurrentProjectCompatible(e)&&(a.registerPlugin(this),!0)},c.setupGui=function(){},c.unload=function(){},c.load=function(){},t.exports=l},{"./pluginsregistry":66,"core/g3wobject":30,"core/project/projectsregistry":71,"core/utils/utils":77}],65:[function(e,t,i){function n(e){var e=e||{};o(this,e),this.init=function(e){this.config=e}}var r=e("core/utils/utils").inherit,o=e("core/utils/utils").base,s=e("core/g3wobject");r(n,s);var a=n.prototype;a.getConfig=function(){return this.config},a.setConfig=function(e){this.config=e},t.exports=n},{"core/g3wobject":30,"core/utils/utils":77}],66:[function(e,t,i){function n(){var t=this;this.config=null,this._plugins={},this._loadedPluginUrls=[],this.setters={registerPlugin:function(e){t._plugins[e.name]||(t._plugins[e.name]=e)}},r(this),this.init=function(e){var t=this;this.pluginsBaseUrl=e.pluginsBaseUrl,this.pluginsConfigs=e.pluginsConfigs,this.otherPluginsConfig=e.otherPluginsConfig,this.setOtherPlugins(),_.forEach(this.pluginsConfigs,function(e,i){t._setup(i,e)})},this.setOtherPlugins=function(){this.otherPluginsConfig&&this.otherPluginsConfig.law&&this.otherPluginsConfig.law.length&&(this.pluginsConfigs.law=this.otherPluginsConfig.law)},this.reloadPlugins=function(t){var i=this,n=e("core/applicationservice");window.initConfig=null,n.obtainInitConfig().then(function(e){a.getComponent("tools").getService().removeTools(),i.setPluginsConfig(e.group.plugins),i.setOtherPlugins();var t=$("script");_.forEach(i.getPlugins(),function(e,n){_.keys(i.pluginsConfigs).indexOf(n)==-1?(e.unload(),delete i._plugins[n],_.forEach(t,function(e){_.forEach(i._loadedPluginUrls,function(t,r){if(e.getAttribute("src")==t&&t.indexOf(n)!=-1)return e.parentNode.removeChild(e),i._loadedPluginUrls.splice(r,1),!1})})):(e.load(),delete i.pluginsConfigs[n])}),_.forEach(i.pluginsConfigs,function(e,t){i._setup(t,e)})})},this.setPluginsConfig=function(e){this.pluginsConfigs=e},this._setup=function(e,t){if(!_.isNull(t)){var i=this.pluginsBaseUrl+e+"/js/plugin.js?"+Date.now();$script(i),this._loadedPluginUrls.push(i)}},this.getPluginConfig=function(e){return this.pluginsConfigs[e]},this.getPlugins=function(){return this._plugins},this.getPlugin=function(e){return this._plugins[e]}}var r=e("core/utils/utils").base,o=e("core/utils/utils").inherit,s=e("core/g3wobject"),a=e("gui/gui");o(n,s),t.exports=new n},{"core/applicationservice":22,"core/g3wobject":30,"core/utils/utils":77,"gui/gui":129}],67:[function(e,t,i){function n(){o(this),this.print=function(e){var e=e||{},t=e.type||"QGIS",i=new a(t),n=i.print(e);return $.get(n)}}var r=e("core/utils/utils").inherit,o=e("core/utils/utils").base,s=e("core/g3wobject"),a=e("./providers/printerprovider");r(n,s),t.exports=new n},{"./providers/printerprovider":68,"core/g3wobject":30,"core/utils/utils":77}],68:[function(e,t,i){function n(e){var e=e||{},t=e.serverType||"QGIS";this._provider=l[t],this.print=function(e){return this._provider.print(e)},o(this)}var r=e("core/utils/utils").inherit,o=e("core/utils/utils").base,s=e("core/g3wobject"),a=e("./qgis/printerQGISProvider"),l={QGIS:a};r(n,s),t.exports=n},{"./qgis/printerQGISProvider":69,"core/g3wobject":30,"core/utils/utils":77}],69:[function(e,t,i){function n(){o(this),this._getPrintUrl=function(e){var e=e||{},t=a.getCurrentProject().getLayersStore(),i=e.map||"map0",n=t.getWmsUrl(),r=_.reverse(t.getLayers({ACTIVE:!0,VISIBLE:!0,SERVERTYPE:"QGIS"}));r=_.map(r,function(e){return e.getQueryLayerName()});var o={SERVICE:"WMS",VERSION:"1.3.0",REQUEST:"GetPrint",TEMPLATE:e.template,DPI:e.dpi,FORMAT:"pdf",CRS:t.getProjection().getCode(),LAYERS:r.join()};return o[i+":SCALE"]=e.scale,o[i+":EXTENT"]=e.extent,o[i+":ROTATION"]=e.rotation,n=n+"?"+$.param(o)},this.print=function(e){var e=e||{};return this._getPrintUrl(e)}}var r=e("core/utils/utils").inherit,o=(e("core/utils/utils").resolve,e("core/utils/utils").base),s=e("core/g3wobject"),a=e("core/project/projectsregistry");r(n,s),t.exports=new n},{"core/g3wobject":30,"core/project/projectsregistry":71,"core/utils/utils":77}],70:[function(e,t,i){function n(e){var t=this;this.state=e,this._processLayers(),this._projection=c.get(this.state.crs,this.state.proj4),this._layersStore=this._buildLayersStore(),this.setters={setBaseLayer:function(e){_.forEach(t.state.baselayers,function(t){t.visible=t.id==e||t.fixed===!0})}},o(this)}var r=e("core/utils/utils").inherit,o=e("core/utils//utils").base,s=e("core/g3wobject"),a=e("core/layers/layerfactory"),l=(e("core/layers/imagelayer"),e("core/layers/layersstore")),c=e("g3w-ol3/src/projection/projections");r(n,s);var u=n.prototype;u.getRelations=function(){return this.state.relations},u._processLayers=function(){function e(i){_.forIn(i,function(n,r){if(!_.isNil(n.id)){var o;_.forEach(t.state.layers,function(e){if(n.id==e.id)return e.wmsUrl=t.getWmsUrl(),e.project=t,o=_.merge(e,n),!1}),i[parseInt(r)]=o}_.isNil(n.nodes)||(n.title=n.name,e(n.nodes))})}var t=this;e(this.state.layerstree),_.forEach(this.state.baselayers,function(e){var i=!1;t.state.initbaselayer&&(i=e.id==t.state.initbaselayer),e.fixed&&(i=e.fixed),e.visible=i,e.baselayer=!0})},u._buildLayersStore=function(){var e=this,t=new l,i=this.state.overviewprojectgid?this.state.overviewprojectgid.gid:null;return t.setOptions({id:this.state.gid,projection:this._projection,extent:this.state.extent,initextent:this.state.initextent,wmsUrl:this.state.WMSUrl,catalog:this.state.gid!=i}),_.forEach(this.getLayers(),function(i){i.projection=e._projection;var n=a.build(i);t.addLayer(n)}),t.createLayersTree(this.state.name,{layerstree:this.state.layerstree}),t},u.getLayers=function(){return _.concat(this.state.layers,this.state.baselayers)},u.getState=function(){return this.state},u.getId=function(){return this.state.id},u.getType=function(){return this.state.type},u.getGid=function(){return this.state.gid},u.getName=function(){return this.state.name},u.getOverviewProjectGid=function(){return this.state.overviewprojectgid?this.state.overviewprojectgid.gid:null},u.getCrs=function(){return this._projection.getCode()},u.getProjection=function(){return this._projection},u.getWmsUrl=function(){return this.state.WMSUrl},u.getInfoFormat=function(){return"application/vnd.ogc.gml"},u.getLayersStore=function(){return this._layersStore},t.exports=n},{"core/g3wobject":30,"core/layers/imagelayer":40,"core/layers/layerfactory":42,"core/layers/layersstore":43,"core/utils//utils":77,"core/utils/utils":77,"g3w-ol3/src/projection/projections":109}],71:[function(e,t,i){function n(){var e=this;this.config=null,this.initialized=!1,this.projectType=null,this.setters={setCurrentProject:function(t){this.state.currentProject&&(c.removeLayersStores(),u.removeLayersStores()),e.state.currentProject=t,e.setProjectType(t.state.type);var i=t.getLayersStore();c.addLayersStore(i,0),u.addLayersStore(i,0)}},this.state={baseLayers:{},minScale:null,maxscale:null,currentProject:null},this._pendingProjects=[],this._projects={},o(this)}var r=e("core/utils/utils").inherit,o=e("core/utils/utils").base,s=e("core/utils/utils").reject,a=e("core/g3wobject"),l=e("core/project/project"),c=e("core/catalog/cataloglayersstoresregistry"),u=e("core/map/maplayersstoresregistry");r(n,a);var h=n.prototype;h.init=function(e){var t=this,i=$.Deferred();return this.initialized||(this.initialized=!0,this.config=e,this.overviewproject=e.overviewproject,this.setupState(),this.getProject(e.initproject).then(function(e){t.setCurrentProject(e),i.resolve(e)}).fail(function(){i.reject()})),i.promise()},h.setProjectType=function(e){this.projectType=e},h.getConfig=function(){return this.config},h.getState=function(){return this.state},h.setupState=function(){var e=this;e.state.baseLayers=e.config.baselayers,e.state.minScale=e.config.minscale,e.state.maxScale=e.config.maxscale,e.state.crs=e.config.crs,e.state.proj4=e.config.proj4;var t=e.config.overviewproject&&e.config.overviewproject.gid?e.config.overviewproject:null;e.config.projects.forEach(function(i){i.baselayers=_.cloneDeep(e.config.baselayers),i.minscale=e.config.minscale,i.maxscale=e.config.maxscale,i.crs=e.config.crs,i.proj4=e.config.proj4,i.overviewprojectgid=t,e._pendingProjects.push(i)})},h.getProjectType=function(){return this.projectType},h.getPendingProjects=function(){return this._pendingProjects},h.getProjects=function(){return this._pendingProjects},h.getListableProjects=function(){var e=this.getCurrentProject().getId();return _.filter(this.getProjects(),function(t){return _.isNil(t.listable)?t.overviewprojectgid&&t.gid!=t.overviewprojectgid.gid&&t.id!=e||t.id!=e?t:void 0:t.listable})},h.getCurrentProject=function(){return this.state.currentProject},h.getProject=function(e){var t,i=this,n=$.Deferred(),r=null;return this._pendingProjects.forEach(function(n){n.gid==e&&(t=n,r=i._projects[e])}),t?r?n.resolve(r):this._getProjectFullConfig(t).then(function(e){var r=_.merge(t,e);r.WMSUrl=i.config.getWmsUrl(r);var o=new l(r);return i._projects[r.gid]=o,n.resolve(o)}).fail(function(){return n.reject()}):s("Project doesn't exist")},h._getProjectFullConfig=function(e){var t=$.Deferred(),i=this.config.getProjectConfigUrl(e);return $.get(i).done(function(e){t.resolve(e)}).fail(function(){t.reject()}),t.promise()},t.exports=new n},{"core/catalog/cataloglayersstoresregistry":23,"core/g3wobject":30,"core/map/maplayersstoresregistry":63,"core/project/project":70,"core/utils/utils":77}],72:[function(e,t,i){function n(){o(this)}var r=e("core/utils/utils").inherit,o=e("core/utils/utils").base,s=e("core/g3wobject");e("gui/gui");r(n,s);n.prototype;t.exports=new n},{"core/g3wobject":30,"core/utils/utils":77,"gui/gui":129}],73:[function(e,t,i){function n(e){e=e||{};var t=Date.now();this.state={id:e.id||"id_"+t,name:e.name||"name_"+t,father:e.referencedLayer,child:e.referencingLayer,fatherField:e.fieldRef.referencedField,childField:e.fieldRef.referencingField,type:e.type},o(this)}var r=e("core/utils/utils").inherit,o=e("core/utils//utils").base,s=e("core/g3wobject");r(n,s);var a=n.prototype;a.getId=function(){return this.state.id},a.setId=function(e){this.state.id=e},a.getName=function(){return this.state.name},a.setName=function(e){this.state.name=e},a.getChild=function(){return this.state.child},a.getFather=function(){return this.state.father},a.getState=function(){return this.state},a.getType=function(){return this.state.type},a.getFields=function(){var e={father:this.state.fatherField,child:this.state.childField};return e},a.getFatherField=function(){return this.state.fatherField},a.getChildField=function(){return this.state.childField},t.exports=n},{"core/g3wobject":30,"core/utils//utils":77,"core/utils/utils":77}],74:[function(e,t,i){function n(e){var t=this;e=e||{};var i=e.relations;this._relations={},this._length=i?i.length:0,this._relationsInfo={children:{},fathers:{},father_child:{}};var n;_.forEach(i,function(e){n=new a(e),t._relations[n.getId()]=n}),this._createRelationsInfo(),o(this)}var r=e("core/utils/utils").inherit,o=e("core/utils//utils").base,s=e("core/g3wobject"),a=e("./relation");r(n,s);var l=n.prototype;l._createRelationsInfo=function(){var e,t,i=this;_.forEach(this._relations,function(n,r){e=n.getFather(),t=n.getChild(),i._relationsInfo.father_child[e+t]=r,i._relationsInfo.fathers[e]||(i._relationsInfo.fathers[e]=[]),i._relationsInfo.children[t]||(i._relationsInfo.children[t]=[]),i._relationsInfo.fathers[e].push(t),i._relationsInfo.children[t].push(e)})},l._clearRelationsInfo=function(){this._relationsInfo={children:{},fathers:{},father_children:{}}},l._reloadRelationsInfo=function(){this._clearRelationsInfo(),this._createRelationsInfo()},l.getLength=function(){return this._length},l.getRelations=function(){return this._relations},l.getArray=function(){var e=[];return _.forEach(this._relations,function(t){e.push(t)}),e},l.setRelations=function(e){this._relations=_.isArray(e)?e:[]},l.getRelationById=function(e){return this._relations[e]},l.getRelationByFatherChildren=function(e,t){var i=this._relationsInfo.father_child[e+t];return this.getRelationById(i)},l.addRelation=function(e){e instanceof a&&(this._relations[e.getId()]=e,this._reloadRelationsInfo())},l.removeRelation=function(e){var t;e instanceof a&&(t=e.getId(),delete this._relations[t],this._reloadRelationsInfo())},l.hasChildren=function(e){var t=this.getChildren(e);return!!t&&!!t.length},l.hasFathers=function(e){var t=this.getFathers(e);return!!t&&!!t.length},l.getChildren=function(e){return this.isFather(e)?this._relationsInfo.fathers[e]:null},l.getFathers=function(e){return this.isChild(e)?this._relationsInfo.children[e]:null},l.isChild=function(e){return!!this._relationsInfo.children[e]},l.isFather=function(e){return!!this._relationsInfo.fathers[e]},t.exports=n},{"./relation":73,"core/g3wobject":30,"core/utils//utils":77,"core/utils/utils":77}],75:[function(e,t,i){var n=e("core/utils/utils").inherit,r=e("core/utils/utils").base,o=(e("core/utils/utils").Base64,e("core/g3wobject"));crossroads.ignoreState=!0,crossroads.greedy=!0;var s=function(){this._initialLocationQuery,this._routeQuery="",this.setters={setRouteQuery:function(e){this._routeQuery=e,crossroads.parse(e)}},r(this)};n(s,o);var a=s.prototype;a.init=function(){var e=window.location.search;this._setRouteQueryFromLocationQuery(e)},a.addRoute=function(e,t,i){return crossroads.addRoute(e,t,i)},a.removeRoute=function(e){return crossroads.removeRoute(e)},a.removeAllRoutes=function(){return crossroads.removeAllRoutes()},a.parse=function(e,t){return crossroads.parse(e,t)},a["goto"]=function(e){this._initialQuery||(this._initialLocationQuery=this._stripInitialQuery(location.search.substring(1))),e&&this.setRouteQuery(e)},a.makePermalink=function(e){this._initialQuery||(this._initialLocationQuery=this._stripInitialQuery(location.search.substring(1)));this._encodeRouteQuery(e);return"?"+this._initialLocationQuery+"&q="+this._encodeRouteQuery(e)},a.makeQueryString=function(e){},a.slicePath=function(e){return e.split("?")[0].split("/")},a.sliceFirst=function(e){var t=e.split("?"),i=t[1],n=t[0].split("/"),r=n[0];return e=n.slice(1).join("/"),e=[e,i].join("?"),[r,e]},a.getQueryParams=function(e){e=e.replace("?","");var t={},i=[];i=""!=e&&e.indexOf("&")==-1?[e]:e.split("&");try{_.forEach(i,function(e){var i=e.split("="),n=i[0],r=i[1];t[n]=r})}catch(n){}return t},a.getQueryString=function(e){return e.split("?")[1]},a._getQueryPortion=function(e,t){var i;try{var n=e.split("&");_.forEach(n,function(e){var n=e.split("="),r=n[0];r==t&&(i=e)})}catch(r){}return i},a._encodeRouteQuery=function(e){return e=e.replace("?","@"),e=e.replace("&","|"),e=e.replace("=","!")},a._decodeRouteQuery=function(e){return e=e.replace("@","?"),e=e.replace("|","&"),e=e.replace("!","=")},a._setRouteQueryFromLocationQuery=function(e){var t=this._getRouteQueryFromLocationQuery(e);if(t){var i=this._decodeRouteQuery(t);this.setRouteQuery(i)}},a._getRouteQueryFromLocationQuery=function(e){return this.getQueryParams(e).q},a._stripInitialQuery=function(e){var t=this._getQueryPortion(e,"q");if(t){var i=t.length,n=e.indexOf(t);queryPrefix=_.trimEnd(e.substring(0,n),"&"),querySuffix=e.substring(n+i),querySuffix=""!=queryPrefix?querySuffix:_.trimStart(querySuffix,"&"),e=queryPrefix+querySuffix}return e},t.exports=new s},{"core/g3wobject":30,"core/utils/utils":77}],76:[function(e,t,i){var n=.28;t.exports={resToScale:function(e,t){var i,t=t||"m";switch(t){case"m":var i=1e3*e/n}return i},scaleToRes:function(e,t){var i,t=t||"m";switch(t){case"m":var i=e*n/1e3}return i}}},{}],77:[function(e,t,i){function n(e,t,i){return"undefined"==typeof i||0===+i?Math[e](t):(t=+t,i=+i,isNaN(t)||"number"!=typeof i||i%1!==0?NaN:(t=t.toString().split("e"),t=Math[e](+(t[0]+"e"+(t[1]?+t[1]-i:-i))),t=t.toString().split("e"),+(t[0]+"e"+(t[1]?+t[1]+i:i))))}Math.round10||(Math.round10=function(e,t){return n("round",e,t)}),Math.floor10||(Math.floor10=function(e,t){return n("floor",e,t)}),Math.ceil10||(Math.ceil10=function(e,t){return n("ceil",e,t)}),String.prototype.hashCode=function(){var e,t,i,n=0;if(0===this.length)return n;for(e=0,i=this.length;e<i;e++)t=this.charCodeAt(e),n=(n<<5)-n+t,n|=0;return n};var r={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){var t,i,n,o,s,a,l,c="",u=0;for(e=r._utf8_encode(e);u<e.length;)t=e.charCodeAt(u++),i=e.charCodeAt(u++),n=e.charCodeAt(u++),o=t>>2,s=(3&t)<<4|i>>4,a=(15&i)<<2|n>>6,l=63&n,isNaN(i)?a=l=64:isNaN(n)&&(l=64),c=c+this._keyStr.charAt(o)+this._keyStr.charAt(s)+this._keyStr.charAt(a)+this._keyStr.charAt(l);return c},decode:function(e){var t,i,n,o,s,a,l,c="",u=0;for(e=e.replace(/[^A-Za-z0-9+\/=]/g,"");u<e.length;)o=this._keyStr.indexOf(e.charAt(u++)),s=this._keyStr.indexOf(e.charAt(u++)),a=this._keyStr.indexOf(e.charAt(u++)),l=this._keyStr.indexOf(e.charAt(u++)),t=o<<2|s>>4,i=(15&s)<<4|a>>2,n=(3&a)<<6|l,c+=String.fromCharCode(t),64!=a&&(c+=String.fromCharCode(i)),64!=l&&(c+=String.fromCharCode(n));return c=r._utf8_decode(c)},_utf8_encode:function(e){e=e.replace(/rn/g,"n");for(var t="",i=0;i<e.length;i++){var n=e.charCodeAt(i);n<128?t+=String.fromCharCode(n):n>127&&n<2048?(t+=String.fromCharCode(n>>6|192),t+=String.fromCharCode(63&n|128)):(t+=String.fromCharCode(n>>12|224),t+=String.fromCharCode(n>>6&63|128),t+=String.fromCharCode(63&n|128))}return t},_utf8_decode:function(e){for(var t="",i=0,n=c1=c2=0;i<e.length;)n=e.charCodeAt(i),n<128?(t+=String.fromCharCode(n),i++):n>191&&n<224?(c2=e.charCodeAt(i+1),t+=String.fromCharCode((31&n)<<6|63&c2),i+=2):(c2=e.charCodeAt(i+1),c3=e.charCodeAt(i+2),t+=String.fromCharCode((15&n)<<12|(63&c2)<<6|63&c3),i+=3);return t}},o={basemixin:function(e,t){return o.merge(e.prototype,t)},mixin:function(e,t){var i=new t;o.merge(e,i),o.merge(e.prototype,t.prototype)},merge:function(e,t){var i;for(i in t)o.hasOwn(t,i)&&(e[i]=t[i])},hasOwn:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},inherit:function(e,t){function i(){}i.prototype=t.prototype,e.superClass_=t.prototype,e.prototype=new i,e.prototype.constructor=e},base:function(e,t,i){var n=arguments.callee.caller;if(n.superClass_)return n.superClass_.constructor.apply(e,Array.prototype.slice.call(arguments,1));for(var r=Array.prototype.slice.call(arguments,2),o=!1,s=e.constructor;s;s=s.superClass_&&s.superClass_.constructor)if(s.prototype[t]===n)o=!0;else if(o)return s.prototype[t].apply(e,r);if(e[t]===n)return e.constructor.prototype[t].apply(e,r);throw Error("base called from a method of one name to a method of a different name")},noop:function(){},truefnc:function(){return!0},falsefnc:function(){return!0},resolve:function(e){var t=$.Deferred();return t.resolve(e),t.promise()},reject:function(e){var t=$.Deferred();return t.reject(e),t.promise()},appendParams:function(e,t){var i=[];Object.keys(t).forEach(function(e){null!==t[e]&&void 0!==t[e]&&i.push(e+"="+encodeURIComponent(t[e]))});var n=i.join("&");return e=e.replace(/[?&]$/,""),e=e.indexOf("?")===-1?e+"?":e+"&",e+n},Base64:r};t.exports=o},{}],78:[function(e,t,i){function n(){var e,t,i=this,n=[],r=0,s=null;this.start=function(i){return t=$.Deferred(),r>0&&console.log("reset workflow before restarting"),i=i,e=i.getInputs(),s=i.getContext(),n=i.getSteps(),n&&n.length&&this.runStep(n[0],e,s),t.promise()},this.runStep=function(e,t){e.run(t,s).then(function(e){i.onDone(e)}).fail(function(e){i.onError(e)})},this.onDone=function(e){return r++,r==n.length?(console.log("sono arrivato in fondo agli steps senza errori"),r=0,void t.resolve(e)):void this.runStep(n[r],e)},this.onError=function(e){console.log("step error: ",e),r=0,t.reject(e)},this.stop=function(){var e=$.Deferred();return console.log("Flow stopping ..."),n[r].isRunning()?n[r].stop():null,r>0?(r=0,e.reject()):e.resolve(),e.promise()},o(this)}var r=e("core/utils/utils").inherit,o=e("core/utils//utils").base,s=e("core/g3wobject");r(n,s),t.exports=n},{"core/g3wobject":30,"core/utils//utils":77,"core/utils/utils":77}],79:[function(e,t,i){function n(e){o(this),e=e||{},this._inputs=e.inputs||null,this._task=e.task||null,this._outputs=e.outputs||null,this.state={id:e.id||null,name:e.name||null,help:e.help||null,running:!1,error:null,message:e.message||null}}var r=e("core/utils/utils").inherit,o=e("core/utils//utils").base,s=e("core/g3wobject");r(n,s);var a=n.prototype;a.run=function(e,t){var i=this,n=$.Deferred();if(this._task)try{this.state.running=!0,this._task.run(e,t).then(function(e){i.stop(),n.resolve(e)}).fail(function(e){i.stop(),n.reject(e)})}catch(r){this.state.error=r,this.state.error="Si è verificato un problema ..",this.stop(),n.reject(r)}return n.promise()},a.stop=function(){this._task.stop(),this.state.running=!1},a.revert=function(){this._task&&this._task.revert&&this._task.revert()},a.panic=function(){this._task&&this._task.panic&&this._task.panic()},a.getId=function(){return this.state.id},a.getName=function(){return this.state.name},a.getHelp=function(){return this.state.help},a.getError=function(){return this.state.error},a.getMessage=function(){return this.state.message},a.isRunning=function(){return this.state.running},a.setInputs=function(e){this._inputs=e},a.getInputs=function(){return this._inputs},a.setTask=function(e){this._task=e},a.getTask=function(){return this._task},a.setOutputs=function(e){this._outputs=e},a.getOutputs=function(){return this._outputs},t.exports=n},{"core/g3wobject":30,"core/utils//utils":77,"core/utils/utils":77}],80:[function(e,t,i){function n(e){o(this,e),this.state={}}var r=e("core/utils/utils").inherit,o=e("core/utils//utils").base,s=e("core/g3wobject");r(n,s);var a=n.prototype;a.revert=function(){console.log("Revert da implementare ")},a.panic=function(){console.log("Panic da Implementare ..")},a.stop=function(){console.log("Task Stop da imlementare ..")},a.run=function(){console.log("Se appare quasto messaggio significa che non è stato sovrascritto il metodo run() dalla sottoclasse")},a.setRoot=function(e){this.state.root=e},t.exports=n},{"core/g3wobject":30,"core/utils//utils":77,"core/utils/utils":77}],81:[function(e,t,i){function n(e){s(this),e=e||{},this._inputs=e.inputs||null,this._context=e.context||null,this._flow=e.flow||new l,this._steps=e.steps||[],this._child=null,this._stackIndex=null}var r=e("core/utils/utils").resolve,o=e("core/utils/utils").inherit,s=e("core/utils//utils").base,a=e("core/g3wobject"),l=e("./flow"),c=e("./workflowsstack");o(n,a);var u=n.prototype;u.getStackIndex=function(){return this._stackIndex},u.addChild=function(e){this._child?this._child.addChild(e):this._child=e},u.removeChild=function(){if(this._child){var e=this._child.getStackIndex();c.removeAt(e)}this._child=null},u._setInputs=function(e){this._inputs=e},u.getInputs=function(){return this._inputs},u.setContext=function(e){this._context=e},u.getContext=function(){return this._context},u.getFlow=function(){return this._flow},u.setFlow=function(e){this._flow=e},u.addStep=function(e){this._steps.push(e)},u.setSteps=function(e){this._steps=e},u.getSteps=function(){return this._steps},u.getStep=function(e){return this._steps[e]},u.getLastStep=function(){var e=this._steps.length;return e?this._steps[e]:null},u.getRunningStep=function(){var e=null;return _.forEach(this._steps,function(t){t.isRunning()&&(e=t)}),e},u._stopChild=function(){return this._child?this._child.stop():r()},u.start=function(e){e=e||{};var t=$.Deferred();return this._inputs=e.inputs,this._context=e.context||{},c.getLength()&&c.getLast()!=this&&c.getLast().addChild(this),c.push(this),this._stackIndex=c.push(this),this._flow=e.flow||this._flow,this._steps=e.steps||this._steps,this._flow.start(this).then(function(e){t.resolve(e)}).fail(function(e){t.reject(e)}),t.promise()},u.stop=function(){var e=this,t=$.Deferred();return this._stopChild().always(function(){e.removeChild(),c.removeAt(e.getStackIndex()),e._flow.stop().then(function(){t.resolve()}).fail(function(e){t.reject(e)})}),t.promise()},t.exports=n},{"./flow":78,"./workflowsstack":82,"core/g3wobject":30,"core/utils//utils":77,"core/utils/utils":77}],82:[function(e,t,i){var n=function(){this._workflows=[],this.push=function(e){return this._workflows.indexOf(e)==-1?this._workflows.push(e):this._workflows.indexOf(e)},this.pop=function(){return this._workflows.pop()},this.getLength=function(){return this._workflows.length},this.getLast=function(){var e=this._workflows.length;return e?this._workflows[e-1]:null},this.getFirst=function(){return this._workflows[0]},this.removeAt=function(e){this._workflows.splice(e,1)},this.getAt=function(e){return this._workflows[e]},this.insertAt=function(e,t){this._workflows[e]=t}};t.exports=new n},{}],83:[function(e,t,i){function n(){var e={name:"addlayer",tipLabel:"AddLayer",label:""};r.call(this,e),this._layerstore=null}var r=e("./control");ol.inherits(n,r);var o=n.prototype;o.setMap=function(e){var t=this;r.prototype.setMap.call(this,e),$(this.element).on("click",function(){t.dispatchEvent("addlayer")})},o.layout=function(e){r.prototype.layout.call(this,e)},o.getLayersSore=function(){return this._layerstore},o.setLayersStore=function(e){this._layerstore=e},t.exports=n},{"./control":85}],84:[function(e,t,i){var n=e("../utils"),r=e("../interactions/areainteraction"),o=e("./measurecontrol"),s=function(e){var t={name:"Area",label:"",interactionClass:r};e=n.merge(e,t),o.call(this,e)};ol.inherits(s,o),t.exports=s},{"../interactions/areainteraction":99,"../utils":110,"./measurecontrol":89}],85:[function(e,t,i){var n=function(e){var t=e.name||"?";if(this.name=t.split(" ").join("-").toLowerCase(),
this.id=this.name+"_"+Math.floor(1e6*Math.random()),this.positionCode=e.position||"tl",this.priority=e.priority||0,!e.element){var i="ol-"+this.name.split(" ").join("-").toLowerCase(),r=e.tipLabel||this.name,o=e.label||"?";e.element=$('<div class="'+i+' ol-unselectable ol-control"><button type="button" title="'+r+'">'+o+"</button></div>")[0]}$(e.element).addClass("ol-control-"+this.positionCode);var s=e.buttonClickHandler||n.prototype._handleClick.bind(this);$(e.element).on("click",s),ol.control.Control.call(this,e),this._postRender()};ol.inherits(n,ol.control.Control);var r=n.prototype;r.getPosition=function(e){var e=e||this.positionCode,t={};return t.top=e.indexOf("t")>-1,t.left=e.indexOf("l")>-1,t},r._handleClick=function(e){e.preventDefault();var t=this,i=this.getMap(),n=null,r=i.getControls();r.forEach(function(e){e.id&&e.toggle&&e.id!=t.id&&(e.toggle(!1),"reset"==e.name&&(n=e))}),!t._toggled&&n&&n.toggle(!0),this.dispatchEvent("controlclick")},r.shiftPosition=function(e){$(this.element).css(hWhere,e+"px")},r.layout=function(e){if(e){var t=this.getPosition(),i=e.getViewport(),n=$(i).find(".ol-control-"+this.positionCode+":visible");if(n.length){previusControl=n.last();var r=t.left?previusControl.position().left:previusControl.position().top,o=t.left?"left":"top",s=previusControl[0].offsetWidth,a=$(this.element).position()[o]+r+s;$(this.element).css(o,a+"px")}}},r.setMap=function(e){e&&(this.layout(e),ol.control.Control.prototype.setMap.call(this,e))},r.hideControl=function(){var e=$(this.element).position().left,t=$(this.element).outerWidth(),i=e,n=$(this.element).siblings(".ol-control-tl");n.each(function(){$(this).position().left>e&&(i=$(this).position().left,t>$(this).outerWidth()&&(e+=t-$(this).outerWidth()),$(this).css("left",e+"px"),e=i,t=$(this).outerWidth())}),$(this.element).hide()},r._postRender=function(){},t.exports=n},{}],86:[function(e,t,i){function n(){var e={name:"geolocation",tipLabel:"Geolocation",label:""};r.call(this,e)}var r=e("./control");ol.inherits(n,r);var o=n.prototype;o.setMap=function(e){var t=this;r.prototype.setMap.call(this,e);var i=new ol.Geolocation({projection:e.getView().getProjection(),tracking:!0});i.once("change:position",function(e){this.getPosition()?($(t.element).removeClass("g3w-ol-disabled"),$(t.element).on("click",function(){var e=t.getMap(),n=e.getView();coordinates=i.getPosition(),n.setCenter(coordinates),t.dispatchEvent({type:"click",coordinates:coordinates})})):t.hideControl()}),i.once("error",function(e){t.hideControl(),1!=e.code&&t.dispatchEvent("error")})},o.layout=function(e){r.prototype.layout.call(this,e),$(this.element).addClass("g3w-ol-disabled")},t.exports=n},{"./control":85}],87:[function(e,t,i){var n=e("./control"),r=function(e){this._toggled=this._toggled||!1,this._interactionClass=e.interactionClass||null,this._interaction=null,this._autountoggle=e.autountoggle||!1,this._geometryTypes=e.geometryTypes||[],this._onSelectLayer=e.onselectlayer||!1,this._enabled=e.enabled!==!1,this._onhover=e.onhover||!1,this._help=e.help||null,this._modalHelp=this._help?e.modalHelp||toastr:null,e.buttonClickHandler=r.prototype._handleClick.bind(this),n.call(this,e),this._help&&this._createModalHelp()};ol.inherits(r,n);var o=r.prototype;o._clearModalHelp=function(e){var t=this;$("body").delegate("#"+e,"change",function(){t._modalHelp=null})},o._showModalHelp=function(){var e=toastr.options.positionClass,t=$("#g3w-view-content");if(this._modalHelp){toastr.options.positionClass="toast-top-right",this._modalHelp.clear();var i=this._modalHelp.info(this._help);if(t){var n=t.css("width");$(i).css("right",n)}toastr.options.positionClass=e}},o._createModalHelp=function(){var e=this,t="close_button"+Math.floor(1e6*Math.random())+Date.now();this._help+='<label for="'+t+'" style="float:right">Non mostrare più</label><input type="checkbox" id="'+t+'" class="pull-right"/>',this._onhover&&$(this.element).on("mouseenter",function(){e._enabled||e._showModalHelp()}),this._clearModalHelp(t)},o.getGeometryTypes=function(){return this._geometryTypes},o.getInteraction=function(){return this._interaction},o.isToggled=function(){return this._toggled},o.toggle=function(e){var e=void 0!==e?e:!this._toggled;this._toggled=e;var t=$(this.element).find("button").first();e?(this._showModalHelp(),this._interaction&&this._interaction.setActive(!0),t.addClass("g3w-ol-toggled")):(this._interaction&&this._interaction.setActive(!1),t.removeClass("g3w-ol-toggled"))},o.setEnable=function(e){var t=$(this.element).find("button").first();e?t.removeClass("g3w-ol-disabled"):(t.addClass("g3w-ol-disabled"),t.removeClass("g3w-ol-toggled"),this._interaction&&this._interaction.setActive(!1)),this._enabled=e},o.getEnable=function(){return this._enabled},o.getGeometryTypes=function(){return this._geometryTypes},o.setGeometryTypes=function(e){this._geometryTypes=e},o.onSelectLayer=function(){return this._onSelectLayer},o.setMap=function(e){!this._interaction&&this._interactionClass&&(this._interaction=new this._interactionClass,e.addInteraction(this._interaction),this._interaction.setActive(!1)),n.prototype.setMap.call(this,e)},o._handleClick=function(e){this._enabled&&(this.toggle(),n.prototype._handleClick.call(this,e))},o.getIteraction=function(){return this._interaction},t.exports=r},{"./control":85}],88:[function(e,t,i){var n=e("../utils"),r=e("../interactions/lengthinteraction"),o=e("./measurecontrol"),s=function(e){var t={name:"Lunghezza",label:"",interactionClass:r};e=n.merge(e,t),o.call(this,e)};ol.inherits(s,o),t.exports=s},{"../interactions/lengthinteraction":101,"../utils":110,"./measurecontrol":89}],89:[function(e,t,i){var n=e("./interactioncontrol"),r=function(e){this._map=null,this._projection=null,n.call(this,e)};ol.inherits(r,n);var o=r.prototype;o.setMap=function(e){n.prototype.setMap.call(this,e)},o.toggle=function(e){n.prototype.toggle.call(this,e),this.isToggled()||this.getIteraction().clear()},t.exports=r},{"./interactioncontrol":87}],90:[function(e,t,i){function n(){this.options={provider:"osm",placeholder:"Città, indirizzo ... ",targetType:"text-input",lang:"it-IT",limit:5,keepOpen:!0,preventDefault:!1,autoComplete:!1,autoCompleteMinLength:4,debug:!1};var e="gcd-input-query",t="gcd-input-reset",i={namespace:"ol-geocoder",spin:"gcd-pseudo-rotate",hidden:"gcd-hidden",country:"gcd-country",city:"gcd-city",road:"gcd-road",olControl:"ol-control",glass:{container:"gcd-gl-container",control:"gcd-gl-control",button:"gcd-gl-btn",input:"gcd-gl-input",expanded:"gcd-gl-expanded",reset:"gcd-gl-reset",result:"gcd-gl-result"},inputText:{container:"gcd-txt-container",control:"gcd-txt-control",input:"gcd-txt-input",reset:"gcd-txt-reset",icon:"gcd-txt-glass",result:"gcd-txt-result"}},n={GLASS:"glass-button",INPUT:"text-input"},o=Object.freeze({inputQueryId:e,inputResetId:t,cssClasses:i,"default":{inputQueryId:e,inputResetId:t,cssClasses:i}}),s={toQueryString:function(e){var t=this;return Object.keys(e).reduce(function(i,n){return i.push("object"==typeof e[n]?t.toQueryString(e[n]):encodeURIComponent(n)+"="+encodeURIComponent(e[n])),i},[]).join("&")},encodeUrlXhr:function(e,t){if(t&&"object"==typeof t){var i=this.toQueryString(t);e+=(/\?/.test(e)?"&":"?")+i}return e},json:function(e,t){return $.get(e,t)},jsonp:function(e,t,i){var n=document.head,r=document.createElement("script"),o="f"+Math.round(Math.random()*Date.now());r.setAttribute("src",e+(e.indexOf("?")>0?"&":"?")+t+"="+o),window[o]=function(e){window[o]=void 0,setTimeout(function(){n.removeChild(r)},0),i(e)},n.appendChild(r)},now:function(){if("performance"in window==!1&&(window.performance={}),Date.now=Date.now||function(){return(new Date).getTime()},"now"in window.performance==!1){var e=Date.now();performance.timing&&performance.timing.navigationStart&&(e=performance.timing.navigationStart),window.performance.now=function(){return Date.now()-e}}return window.performance.now()},flyTo:function(e,t,i,n){n=n||2.388657133911758,i=i||500;var r=e.getView();r.animate({duration:i,resolution:n},{duration:i,center:t})},randomId:function(e){var t=this.now().toString(36);return e?e+t:t},isNumeric:function(e){return/^\d+$/.test(e)},classRegex:function(e){return new RegExp("(^|\\s+) "+e+" (\\s+|$)")},addClass:function(e,t,i){var n=this;if(Array.isArray(e))return void e.forEach(function(e){n.addClass(e,t)});for(var r=Array.isArray(t)?t:t.split(/\s+/),o=r.length;o--;)n.hasClass(e,r[o])||n._addClass(e,r[o],i)},_addClass:function(e,t,i){var n=this;e.classList?e.classList.add(t):e.className=(e.className+" "+t).trim(),i&&this.isNumeric(i)&&window.setTimeout(function(){n._removeClass(e,t)},i)},removeClass:function(e,t,i){var n=this;if(Array.isArray(e))return void e.forEach(function(e){n.removeClass(e,t,i)});for(var r=Array.isArray(t)?t:t.split(/\s+/),o=r.length;o--;)n.hasClass(e,r[o])&&n._removeClass(e,r[o],i)},_removeClass:function(e,t,i){var n=this;e.classList?e.classList.remove(t):e.className=e.className.replace(this.classRegex(t)," ").trim(),i&&this.isNumeric(i)&&window.setTimeout(function(){n._addClass(e,t)},i)},hasClass:function(e,t){return e.classList?e.classList.contains(t):this.classRegex(t).test(e.className)},toggleClass:function(e,t){var i=this;return Array.isArray(e)?void e.forEach(function(e){i.toggleClass(e,t)}):void(e.classList?e.classList.toggle(t):this.hasClass(e,t)?this._removeClass(e,t):this._addClass(e,t))},find:function(e,t,i){void 0===t&&(t=window.document);var n=/^(#?[\w-]+|\.[\w-.]+)$/,r=/\./g,o=Array.prototype.slice,s=[];if(n.test(e))switch(e[0]){case"#":s=[this.$(e.substr(1))];break;case".":s=o.call(t.getElementsByClassName(e.substr(1).replace(r," ")));break;default:s=o.call(t.getElementsByTagName(e))}else s=o.call(t.querySelectorAll(e));return i?s:s[0]},$:function(e){return e="#"===e[0]?e.substr(1,e.length):e,document.getElementById(e)},isElement:function(e){return"HTMLElement"in window?!!e&&e instanceof HTMLElement:!!e&&"object"==typeof e&&1===e.nodeType&&!!e.nodeName},getAllChildren:function(e,t){return[].slice.call(e.getElementsByTagName(t))},isEmpty:function(e){return!e||0===e.length},emptyArray:function(e){for(;e.length;)e.pop()},anyMatchInArray:function(e,t){return e.some(function(e){return t.indexOf(e)>=0})},everyMatchInArray:function(e,t){return t.every(function(t){return e.indexOf(t)>=0})},anyItemHasValue:function(e,t){var i=this;void 0===t&&(t=!1);var n=Object.keys(e);return n.forEach(function(n){i.isEmpty(e[n])||(t=!0)}),t},removeAllChildren:function(e){for(;e.firstChild;)e.removeChild(e.firstChild)},removeAll:function(e){for(var t;t=e[0];)t.parentNode.removeChild(t)},getChildren:function(e,t){return[].filter.call(e.childNodes,function(e){return t?1===e.nodeType&&e.tagName.toLowerCase()===t:1===e.nodeType})},template:function(e,t){var i=this;return e.replace(/\{ *([\w_-]+) *\}/g,function(e,n){var r=void 0===t[n]?"":t[n];return i.htmlEscape(r)})},htmlEscape:function(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")},mergeOptions:function(e,t){var i={};for(var n in e)i[n]=e[n];for(var r in t)i[r]=t[r];return i},createElement:function(e,t){var i;if(Array.isArray(e)){if(i=document.createElement(e[0]),e[1].id&&(i.id=e[1].id),e[1].classname&&(i.className=e[1].classname),e[1].attr){var n=e[1].attr;if(Array.isArray(n))for(var r=-1;++r<n.length;)i.setAttribute(n[r].name,n[r].value);else i.setAttribute(n.name,n.value)}}else i=document.createElement(e);i.innerHTML=t;for(var o=document.createDocumentFragment();i.childNodes[0];)o.appendChild(i.childNodes[0]);return i.appendChild(o),i},assert:function(e,t){if(void 0===t&&(t="Assertion failed"),!e){if("undefined"!=typeof Error)throw new Error(t);throw t}}},a=o.cssClasses,l=o.cssClasses,c=function(e){this.options=e.options,this.els=this.createControl()};c.prototype.createControl=function(){var e,t,i;return this.options.targetType===n.INPUT?(t=a.namespace+" "+a.inputText.container,e=s.createElement(["div",{classname:t}],c.input),i={container:e,control:s.find("."+a.inputText.control,e),input:s.find("."+a.inputText.input,e),reset:s.find("."+a.inputText.reset,e),result:s.find("."+a.inputText.result,e)}):(t=a.namespace+" "+a.glass.container,e=s.createElement(["div",{classname:t}],c.glass),i={container:e,control:s.find("."+a.glass.control,e),button:s.find("."+a.glass.button,e),input:s.find("."+a.glass.input,e),reset:s.find("."+a.glass.reset,e),result:s.find("."+a.glass.result,e)}),i.input.placeholder=this.options.placeholder,i},c.glass=['<div class="',a.glass.control," ",a.olControl,'">','<button type="button" class="',a.glass.button,'"></button>','<input type="text"',' id="',o.inputQueryId,'"',' class="',a.glass.input,'"',' autocomplete="off" placeholder="Search ...">',"<a",' id="',o.inputResetId,'"',' class="',a.glass.reset," ",a.hidden,'"',"></a>","</div>",'<ul class="',a.glass.result,'"></ul>'].join(""),c.input=['<div class="',a.inputText.control,'">','<input type="text"',' id="',o.inputQueryId,'"',' class="',a.inputText.input,'"',' autocomplete="off" placeholder="Search ...">','<button type="button" class="btn btn-primary" id="search_nominatim"><i class="fa fa-search" aria-hidden="true"></i></button>','<button type="button"',' id="',o.inputResetId,'"',' class="',a.inputText.reset," ",a.hidden,'"',"></button>","</div>",'<ul class="',a.inputText.result,'"></ul>'].join("");var u=function(){this.settings={url:"//nominatim.openstreetmap.org/search/",params:{q:"",format:"json",addressdetails:1,limit:10,countrycodes:"IT","accept-language":"it-IT"}}};u.prototype.getParameters=function(e){return{url:this.settings.url,params:{q:e.query,format:"json",addressdetails:1,limit:e.limit||this.settings.params.limit,countrycodes:e.countrycodes||this.settings.params.countrycodes,"accept-language":e.lang||this.settings.params["accept-language"]}}},u.prototype.handleResponse=function(e){return e.map(function(e){return{lon:e.lon,lat:e.lat,address:{name:e.address.neighbourhood||"",road:e.address.road||"",postcode:e.address.postcode,city:e.address.city||e.address.town,state:e.address.state,country:e.address.country},original:{formatted:e.display_name,details:e.address}}})};var h=function(e,t){this.Base=e,this.options=e.options,this.options.provider=this.options.provider.toLowerCase(),this.els=t,this.lastQuery="",this.container=this.els.container,this.registeredListeners={mapClick:!1},this.setListeners(),this.OpenStreet=new u};h.prototype.setListeners=function(){var e,t,i=this,r=function(){s.hasClass(i.els.control,l.glass.expanded)?i.collapse():i.expand()},o=function(e){var t=e.target.value.trim(),n=e.key?"Enter"===e.key:e.which?13===e.which:!!e.keyCode&&13===e.keyCode;n&&(e.preventDefault(),i.query(t))},a=function(e){i.els.input.focus(),i.els.input.value="",i.lastQuery="",s.addClass(i.els.reset,l.hidden),i.clearResults()},c=function(n){var r=n.target.value.trim();r.length?s.removeClass(i.els.reset,l.hidden):s.addClass(i.els.reset,l.hidden),i.options.autoComplete&&r!==t&&(t=r,e&&clearTimeout(e),e=setTimeout(function(){r.length>=i.options.autoCompleteMinLength&&i.query(r)},200))};this.els.input.addEventListener("keyup",o,!1),this.els.input.addEventListener("input",c,!1),this.els.reset.addEventListener("click",a,!1),this.options.targetType===n.GLASS&&this.els.button.addEventListener("click",r,!1)},h.prototype.query=function(e){var t=this,i={},n=this.options,r=this.getProvider({query:e,provider:n.provider,key:n.key,lang:n.lang,countrycodes:n.countrycodes,limit:n.limit});this.lastQuery===e&&this.els.result.firstChild||(this.lastQuery=e,this.clearResults(),s.addClass(this.els.reset,l.spin),i.url=document.location.protocol+r.url,i.data=r.params,s.json(i).done(function(e){s.removeClass(t.els.reset,l.spin);var i=e.length?t.OpenStreet.handleResponse(e):void 0;t.createList(i),i&&t.listenMapClick()}).fail(function(e){s.removeClass(t.els.reset,l.spin);var i=s.createElement("li","<h5>  Il server non risponde</h5>");t.els.result.appendChild(i)}))},h.prototype.createList=function(e){var t=this,i=this.els.result;e?e.forEach(function(e){var n=t.addressTemplate(e.address),r=['<a href="#">',n,"</a>"].join(""),o=s.createElement("li",r);o.addEventListener("click",function(i){i.preventDefault(),t.chosen(e,n,e.address,e.original)},!1),i.appendChild(o)}):(li=s.createElement("li","Nessun Risultato"),i.appendChild(li))},h.prototype.chosen=function(e,t,i,n){var r=this.Base.getMap(),o=[parseFloat(e.lon),parseFloat(e.lat)],s=r.getView().getProjection(),a=ol.proj.transform(o,"EPSG:4326",s),l={formatted:t,details:i,original:n};this.options.keepOpen===!1&&this.clearResults(!0),this.Base.dispatchEvent({type:"addresschosen",address:l,coordinate:a})},h.prototype.addressTemplate=function(e){var t=[];return e.name&&t.push(['<div class="',l.road,'">{name}</div>'].join("")),(e.road||e.building||e.house_number)&&t.push(['<div class="',l.road,'">{building} {road} {house_number}</div>'].join("")),(e.city||e.town||e.village)&&t.push(['<div class="',l.city,'">{postcode} {city} {town} {village}</div>'].join("")),(e.state||e.country)&&t.push(['<div class="',l.country,'">{state} {country}</div>'].join("")),s.template(t.join("<br>"),e)},h.prototype.getProvider=function(e){return this.OpenStreet.getParameters(e)},h.prototype.expand=function(){var e=this;s.removeClass(this.els.input,l.spin),s.addClass(this.els.control,l.glass.expanded),window.setTimeout(function(){return e.els.input.focus()},100),this.listenMapClick()},h.prototype.collapse=function(){this.els.input.value="",this.els.input.blur(),s.addClass(this.els.reset,l.hidden),s.removeClass(this.els.control,l.glass.expanded),this.clearResults()},h.prototype.listenMapClick=function(){if(!this.registeredListeners.mapClick){var e=this,t=this.Base.getMap().getTargetElement();this.registeredListeners.mapClick=!0,t.addEventListener("click",{handleEvent:function(i){e.clearResults(!0),t.removeEventListener(i.type,this,!1),e.registeredListeners.mapClick=!1}},!1)}},h.prototype.clearResults=function(e){e&&this.options.targetType===n.GLASS?this.collapse():s.removeAllChildren(this.els.result)},h.prototype.getSource=function(){return this.layer.getSource()},h.prototype.addLayer=function(){var e=this,t=!1,i=this.Base.getMap();i.getLayers().forEach(function(i){i===e.layer&&(t=!0)}),t||i.addLayer(this.layer)};var p=new c(this);this.container=p.els.container,this.nominatim=new h(this,p.els),this.layer=this.nominatim.layer,r.call(this,{element:this.container,name:"nominatim"})}var r=e("./control");ol.inherits(n,r),proto=n.prototype,t.exports=n},{"./control":85}],91:[function(e,t,i){var n=function(e){switch(this._control=null,this.positionCode=e.position||"tl",e.type){case"zoom":this._control=new ol.control.Zoom(e);break;case"zoomtoextent":this._control=new ol.control.ZoomToExtent(e);break;case"scaleline":this._control=new ol.control.ScaleLine(e);break;case"overview":this._control=new ol.control.OverviewMap(e)}$(this._control.element).addClass("ol-control-"+this.positionCode),ol.control.Control.call(this,{element:this._control.element})};ol.inherits(n,ol.control.Control),t.exports=n;var r=n.prototype;r.getPosition=function(e){var e=e||this.positionCode,t={};return t.top=e.indexOf("t")>-1,t.left=e.indexOf("l")>-1,t},r.layout=function(e){if(e){var t=this.getPosition(),i=e.getViewport(),n=$(i).find(".ol-control-"+this.positionCode);if(n.length){previusControl=n.last();var r=t.left?previusControl.position().left:previusControl.position().right,o=t.left?"left":"right",s=previusControl[0].offsetWidth,a=$(this.element).position()[o]+r+s+2;$(this.element).css(o,a+"px")}}},r.setMap=function(e){this.layout(e),this._control.setMap(e)}},{}],92:[function(e,t,i){var n=e("../utils"),r=e("./interactioncontrol"),o=function(e){this._startCoordinate=null;var t={name:"querybbox",tipLabel:"Query BBox layer",label:"",interactionClass:ol.interaction.DragBox,help:"<h4>Guida - Query BBox layer</h4><ul><li>Disegna un rettangolo per interrogare gli strati evidenziati in giallo</li></ul>"};e=n.merge(e,t),r.call(this,e)};ol.inherits(o,r);var s=o.prototype;s.setMap=function(e){var t=this;r.prototype.setMap.call(this,e),this._interaction.on("boxstart",function(e){t._startCoordinate=e.coordinate}),this._interaction.on("boxend",function(e){var i=t._startCoordinate,n=e.coordinate,r=ol.extent.boundingExtent([i,n]);t.dispatchEvent({type:"bboxend",extent:r}),t._startCoordinate=null,t._autountoggle&&t.toggle()})},t.exports=o},{"../utils":110,"./interactioncontrol":87}],93:[function(e,t,i){var n=e("../utils"),r=e("./interactioncontrol"),o=e("../interactions/pickcoordinatesinteraction"),s=function(e){var t={name:"querybypolygon",tipLabel:"Query By Polygon",label:"",geometryTypes:["Polygon","MultiPolygon"],onselectlayer:!0,interactionClass:o,help:"<h4>Guida - Query By Polygon</h4><ul><li>Seleziona uno strato poligonale</li><li>Clicca su una feature dello strato selezionato per lanciare la selezione</li></ul>",onhover:!0};e=n.merge(e,t),r.call(this,e)};ol.inherits(s,r);var a=s.prototype;a.setMap=function(e){var t=this;r.prototype.setMap.call(this,e),this._interaction.on("boxstart",function(e){t._startCoordinate=e.coordinate}),this._interaction.on("picked",function(e){t.dispatchEvent({type:"picked",coordinates:e.coordinate}),t._autountoggle&&t.toggle()}),this.setEnable(!1)},t.exports=s},{"../interactions/pickcoordinatesinteraction":103,"../utils":110,"./interactioncontrol":87}],94:[function(e,t,i){var n=e("../utils"),r=e("./interactioncontrol"),o=e("../interactions/pickcoordinatesinteraction"),s=function(e){var t={name:"querylayer",tipLabel:"Query layer",label:"",interactionClass:o};e=n.merge(e,t),r.call(this,e)};ol.inherits(s,r);var a=s.prototype;a.setMap=function(e){var t=this;r.prototype.setMap.call(this,e),this._interaction.on("boxstart",function(e){t._startCoordinate=e.coordinate}),this._interaction.on("picked",function(e){t.dispatchEvent({type:"picked",coordinates:e.coordinate}),t._autountoggle&&t.toggle()})},t.exports=s},{"../interactions/pickcoordinatesinteraction":103,"../utils":110,"./interactioncontrol":87}],95:[function(e,t,i){var n=e("../utils"),r=e("./interactioncontrol"),o=function(e){this._toggled=!0,this._startCoordinate=null;var t={name:"reset",tipLabel:"Pan",label:""};e=n.merge(e,t),r.call(this,e)};ol.inherits(o,r),t.exports=o;var s=o.prototype;s._postRender=function(){this.toggle(!0)}},{"../utils":110,"./interactioncontrol":87}],96:[function(e,t,i){var n=e("../utils"),r=e("./interactioncontrol"),o=e("../interactions/pickcoordinatesinteraction"),s=function(e){var t={name:"streetview",tipLabel:"StreetView",label:"",interactionClass:o};this._sv=null,this._panorama=null,this._map=null,this._projection=null,this._streetViewFeature=new ol.Feature,this._streetViewFeature.setStyle(style=new ol.style.Style({text:new ol.style.Text({text:"",font:"bold 30px icomoon",textBaseline:"Bottom",fill:new ol.style.Fill({color:"#3c8dbc"})})}));var i=new ol.source.Vector({features:[]});this._layer=new ol.layer.Vector({source:i}),e=n.merge(e,t),r.call(this,e)};ol.inherits(s,r);var a=s.prototype;a.getLayer=function(){return this._layer},a.setProjection=function(e){this._projection=e},a.setPosition=function(e){var t,i,n=this;this._sv||(this._sv=new google.maps.StreetViewService),this._sv.getPanorama({location:e},function(e){n._panorama=new google.maps.StreetViewPanorama(document.getElementById("streetview")),n._panorama.addListener("position_changed",function(){n.isToggled()&&(t=ol.proj.transform([this.getPosition().lng(),this.getPosition().lat()],"EPSG:4326",n._projection.getCode()),n._layer.getSource().getFeatures()[0].setGeometry(new ol.geom.Point(t)),i=n._map.getPixelFromCoordinate(t),(i[0]+15>n._map.getSize()[0]||i[1]+15>n._map.getSize()[1]||i[0]<15||i[1]<15)&&n._map.getView().setCenter(t))}),e&&e.location&&(n._panorama.setPov({pitch:0,heading:0}),n._panorama.setPosition(e.location.latLng))})},a.setMap=function(e){var t=this;this._map=e,r.prototype.setMap.call(this,e),this._interaction.on("picked",function(e){t.dispatchEvent({type:"picked",coordinates:e.coordinate}),t._autountoggle&&t.toggle()})},a.clear=function(){this._layer.getSource().clear(),this._streetViewFeature.setGeometry(null)},a.toggle=function(e){r.prototype.toggle.call(this,e),this.isToggled()?this._layer.getSource().addFeatures([this._streetViewFeature]):this.clear()},t.exports=s},{"../interactions/pickcoordinatesinteraction":103,"../utils":110,"./interactioncontrol":87}],97:[function(e,t,i){var n=e("../utils"),r=e("./interactioncontrol"),o=function(e){this._startCoordinate=null;var t={name:"zoombox",tipLabel:"Zoom to box",label:"",interactionClass:ol.interaction.DragBox};e=n.merge(e,t),r.call(this,e)};ol.inherits(o,r),t.exports=o;var s=o.prototype;s.setMap=function(e){var t=this;r.prototype.setMap.call(this,e),this._interaction.on("boxstart",function(e){t._startCoordinate=e.coordinate}),this._interaction.on("boxend",function(e){var i=t._startCoordinate,n=e.coordinate,r=ol.extent.boundingExtent([i,n]);t.dispatchEvent({type:"zoomend",extent:r}),t._startCoordinate=null,t._autountoggle&&t.toggle()})}},{"../utils":110,"./interactioncontrol":87}],98:[function(e,t,i){var n=e("./utils"),r=e("./map/maphelpers");!function(e,n,r){"function"==typeof define&&define.amd?define(r):"object"==typeof i?t.exports=r():n[e]=r()}("g3wol3",this,function(){"use strict";var e=n.merge({},r);return{helpers:e}})},{"./map/maphelpers":107,"./utils":110}],99:[function(e,t,i){var n=e("./measureinteraction"),r=function(){var e={};e.geometryType="Polygon",n.call(this,e)};ol.inherits(r,n),t.exports=r},{"./measureinteraction":102}],100:[function(e,t,i){var n=function(e,t,i,n){this.type=e,this.features=i,this.coordinate=n},r=function(e){ol.interaction.Pointer.call(this,{handleDownEvent:r.handleDownEvent_,handleMoveEvent:r.handleMoveEvent_,handleUpEvent:r.handleUpEvent_,handleEvent:r.handleEvent_}),this.previousCursor_=void 0,this.startCursor_=void 0,this.lastCoordinate_=null,this.features_=void 0!==e.features?e.features:null,this.layer_=void 0!==e.layer?e.layer:null,this.map_=null};ol.inherits(r,ol.interaction.Pointer),r.handleEvent_=function(e){return"keydown"!=e.type?ol.interaction.Pointer.handleEvent.call(this,e):this.features_.getArray().length&&46==e.originalEvent.keyCode?(this.dispatchEvent(new n("deleteend",this.layer_,this.features_,event.coordinate)),!0):void 0},r.handleDownEvent_=function(e){return this.lastFeature_=this.featuresAtPixel_(e.pixel,e.map),!!this.lastFeature_&&(r.handleMoveEvent_.call(this,e),this.dispatchEvent(new n("deleteend",this.layer_,this.features_,e.coordinate)),!0)},r.handleMoveEvent_=function(e){var t=this;this.map_=e.map;var i=this.map_.getTargetElement();void 0===this.startCursor_&&(this.startCursor_=i.style.cursor);var n=this.map_.forEachFeatureAtPixel(e.pixel,function(e,i){return e=i==t.layer_?e:null});n?(this.previousCursor_=i.style.cursor,i.style.cursor="pointer"):(i.style.cursor=void 0!==this.previousCursor_?this.previousCursor_:"",this.previousCursor_=void 0)},r.prototype.featuresAtPixel_=function(e,t){var i=null,n=t.forEachFeatureAtPixel(e,function(e){return e});return this.features_&&_.includes(this.features_.getArray(),n)&&(i=n),i},r.prototype.clear=function(){var e;this.map_&&(e=this.map_.getTargetElement(),e.style.cursor=this.startCursor_)},t.exports=r},{}],101:[function(e,t,i){var n=e("./measureinteraction"),r=function(){var e={};e.geometryType="LineString",n.call(this,e)};ol.inherits(r,n),t.exports=r},{"./measureinteraction":102}],102:[function(e,t,i){var n=function(e){this._helpTooltip,this._measureTooltipElement,this._measureTooltip,this._featureGeometryChangelistener,this._poinOnMapMoveListener;var t=new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.2)"}),stroke:new ol.style.Stroke({color:"rgba(0, 0, 0, 0.5)",lineDash:[10,10],width:3}),image:new ol.style.Circle({radius:5,stroke:new ol.style.Stroke({color:"rgba(0, 0, 0, 0.7)"}),fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.2)"})})}),i=e.geometryType||"LineString";switch(this._formatMeasure=null,this._helpMsg=null,this._keyDownEventHandler=null,i){case"LineString":this._formatMeasure=function(e){var t;t=Math.round(100*e.getLength())/100;var i;return i=t>1e3?Math.round(t/1e3*1e3)/1e3+" km":Math.round(100*t)/100+" m"},this._helpMsg="Clicca sulla mappa per continuare a disegnare la linea.<br>CANC se si vuole cancellare l'ultimo vertice inserito";break;case"Polygon":this._formatMeasure=function(e){var t;t=Math.round(100*e.getArea())/100;var i;return i=t>1e3?Math.round(t/1e3*1e3)/1e3+" km<sup>2</sup>":Math.round(100*t)/100+" m<sup>2</sup>"},this._helpMsg="Click per continuare a disegnare il poligono.<br>CANC se si vuole cancellare l'ultimo vertice inserito"}var n=new ol.source.Vector;this._helpTooltipElement,this._map=null,this._feature=null,this._layer=new ol.layer.Vector({source:n,style:function(e){var t=[new ol.style.Style({stroke:new ol.style.Stroke({lineDash:[10,10],width:3}),fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.2)"})})];return t}}),ol.interaction.Draw.call(this,{source:n,type:i,style:t}),this.set("beforeRemove",this.clear),this.set("layer",this._layer),this.on("drawstart",this._drawStart),this.on("drawend",this._drawEnd)};ol.inherits(n,ol.interaction.Draw);var r=n.prototype;r.clear=function(){this._layer.getSource().clear(),this._clearMessagesAndListeners(),this._map&&(this._map.removeOverlay(this._measureTooltip),this._map.removeLayer(this._layer))},r._clearMessagesAndListeners=function(){this._feature=null,this._map&&(this._measureTooltipElement=null,this._helpTooltipElement.innerHTML="",this._helpTooltipElement.classList.add("hidden"),ol.Observable.unByKey(this._featureGeometryChangelistener),ol.Observable.unByKey(this._poinOnMapMoveListener),$(document).off("keydown",this._keyDownEventHandler))},r._removeLastPoint=function(e){var t=this._feature.getGeometry();46===e.keyCode&&(t instanceof ol.geom.Polygon&&t.getCoordinates()[0].length>2?this.removeLastPoint():t instanceof ol.geom.LineString&&t.getCoordinates().length>1&&this.removeLastPoint())},r._drawStart=function(e){var t=this;this._map=this.getMap(),this._createMeasureTooltip(),this._createHelpTooltip(),this._feature=e.feature,this._keyDownEventHandler=_.bind(this._removeLastPoint,this),$(document).on("keydown",this._keyDownEventHandler),this._layer.getSource().clear(),this._poinOnMapMoveListener=this._map.on("pointermove",function(e){e.dragging||(t._feature&&(helpMsg=t._helpMsg),t._helpTooltipElement.innerHTML=helpMsg,t._helpTooltip.setPosition(e.coordinate),t._helpTooltipElement.classList.remove("hidden"))});var i=e.coordinate;this._featureGeometryChangelistener=this._feature.getGeometry().on("change",function(e){var n,r=e.target;r instanceof ol.geom.Polygon?i=r.getInteriorPoint().getCoordinates():r instanceof ol.geom.LineString&&(i=r.getLastCoordinate()),n=t._formatMeasure(r),t._measureTooltipElement.innerHTML=n,t._measureTooltip.setPosition(i)})},r._drawEnd=function(){this._measureTooltipElement.className="mtooltip mtooltip-static",this._measureTooltip.setOffset([0,-7]),this._clearMessagesAndListeners(),this._map.addLayer(this._layer)},r._createHelpTooltip=function(){this._helpTooltipElement&&this._helpTooltipElement.parentNode.removeChild(this._helpTooltipElement),this._helpTooltip&&this._map.removeOverlay(this._helpTooltip),this._helpTooltipElement=document.createElement("div"),this._helpTooltipElement.className="mtooltip hidden",this._helpTooltip=new ol.Overlay({element:this._helpTooltipElement,offset:[15,0],positioning:"center-left"}),this._map.addOverlay(this._helpTooltip)},r._createMeasureTooltip=function(){this._measureTooltipElement&&this._measureTooltipElement.parentNode.removeChild(this._measureTooltipElement),this._measureTooltip&&this._map.removeOverlay(this._measureTooltip),this._measureTooltipElement=document.createElement("div"),this._measureTooltipElement.className="mtooltip mtooltip-measure",this._measureTooltip=new ol.Overlay({element:this._measureTooltipElement,offset:[0,-15],positioning:"bottom-center"}),this._map.addOverlay(this._measureTooltip)},t.exports=n},{}],103:[function(e,t,i){var n={PICKED:"picked"},r=function(e,t){
this.type=e,this.coordinate=t},o=function(e){this.previousCursor_=null,ol.interaction.Pointer.call(this,{handleDownEvent:o.handleDownEvent_,handleUpEvent:o.handleUpEvent_,handleMoveEvent:o.handleMoveEvent_})};ol.inherits(o,ol.interaction.Pointer),o.handleDownEvent_=function(e){return!0},o.handleUpEvent_=function(e){return this.dispatchEvent(new r(n.PICKED,e.coordinate)),!0},o.handleMoveEvent_=function(e){var t=e.map.getTargetElement();t.style.cursor="pointer"},o.prototype.shouldStopEvent=function(){return!1},o.prototype.setActive=function(e){var t=this.getMap();if(t){var i=t.getTargetElement();i.style.cursor=""}ol.interaction.Pointer.prototype.setActive.call(this,e)},o.prototype.setMap=function(e){if(!e){var t=this.getMap().getTargetElement();t.style.cursor=""}ol.interaction.Pointer.prototype.setMap.call(this,e)},t.exports=o},{}],104:[function(e,t,i){var n={PICKED:"picked"},r=function(e,t,i){this.type=e,this.feature=i,this.coordinate=t},o=function(e){var t=this;ol.interaction.Pointer.call(this,{handleDownEvent:o.handleDownEvent_,handleUpEvent:o.handleUpEvent_,handleMoveEvent:o.handleMoveEvent_}),this.features_=e.features||null,this.layers_=e.layers||null,this.pickedFeature_=null,this.layerFilter_=function(e){return _.includes(t.layers_,e)}};ol.inherits(o,ol.interaction.Pointer),o.handleDownEvent_=function(e){return this.pickedFeature_=this.featuresAtPixel_(e.pixel,e.map),!0},o.handleUpEvent_=function(e){return this.pickedFeature_&&this.dispatchEvent(new r(n.PICKED,e.coordinate,this.pickedFeature_)),!0},o.handleMoveEvent_=function(e){var t=e.map.getTargetElement(),i=this.featuresAtPixel_(e.pixel,e.map);i?t.style.cursor="pointer":t.style.cursor=""},o.prototype.featuresAtPixel_=function(e,t){var i=null,n=this,r=t.forEachFeatureAtPixel(e,function(e){return n.features_?n.features_.indexOf(e)>-1?e:null:e},{layerFilter:n.layerFilter_,hitTolerance:isMobile&&isMobile.any?10:0});return r&&(i=r),i},o.prototype.shouldStopEvent=function(){return!1},o.prototype.setMap=function(e){if(!e){var t=this.getMap().getTargetElement();t.style.cursor=""}ol.interaction.Pointer.prototype.setMap.call(this,e)},t.exports=o},{}],105:[function(e,t,i){var n={};n.OSM=new ol.layer.Tile({source:new ol.source.OSM({attributions:[new ol.Attribution({html:'All maps &copy; <a href="http://www.openstreetmap.org/">OpenStreetMap</a>'}),ol.source.OSM.ATTRIBUTION],url:"http://{a-c}.tile.openstreetmap.org/{z}/{x}/{y}.png",crossOrigin:null}),id:"osm",title:"OSM",basemap:!0}),n.BING={},n.BING.Road=new ol.layer.Tile({name:"Road",visible:!1,preload:1/0,source:new ol.source.BingMaps({key:"Am_mASnUA-jtW3O3MxIYmOOPLOvL39dwMvRnyoHxfKf_EPNYgfWM9imqGETWKGVn",imagerySet:"Road"}),basemap:!0}),n.BING.AerialWithLabels=new ol.layer.Tile({name:"AerialWithLabels",visible:!0,preload:1/0,source:new ol.source.BingMaps({key:"Am_mASnUA-jtW3O3MxIYmOOPLOvL39dwMvRnyoHxfKf_EPNYgfWM9imqGETWKGVn",imagerySet:"AerialWithLabels"}),basemap:!0}),n.BING.Aerial=new ol.layer.Tile({name:"Aerial",visible:!1,preload:1/0,source:new ol.source.BingMaps({key:"Am_mASnUA-jtW3O3MxIYmOOPLOvL39dwMvRnyoHxfKf_EPNYgfWM9imqGETWKGVn",imagerySet:"Aerial"}),basemap:!0}),t.exports=n},{}],106:[function(e,t,i){var n=e("../utils"),r={};r.TiledWMSLayer=function(e,t){var i={layerObj:e,extraParams:t||{},tiled:!0};return r._WMSLayer(i)},r.WMSLayer=function(e,t){var i={layerObj:e,extraParams:t||{}};return r._WMSLayer(i)},r._WMSLayer=function(e){var t=e.layerObj,i=e.extraParams,r=e.tiled||!1,o={LAYERS:t.layers||"",VERSION:"1.3.0",TRANSPARENT:!0,SLD_VERSION:"1.1.0"};o=n.merge(o,i);var s,a,l={url:t.url,params:o,ratio:1},c={id:t.id,name:t.name,opacity:t.opacity||1,visible:t.visible,maxResolution:t.maxResolution};return r?(a=new ol.source.TileWMS(l),s=ol.layer.Tile):(a=new ol.source.ImageWMS(l),s=ol.layer.Image),c.source=a,new s(c)},r.XYZLayer=function(e){if(e.url){var t={url:e.url};return e.projection&&(t.projection=e.projection),e.maxZoom&&(t.maxZoom=e.maxZoom),e.minZoom&&(t.minZoom=e.minZoom),new ol.layer.Tile({source:new ol.source.XYZ(t)})}},t.exports=r},{"../utils":110}],107:[function(e,t,i){BaseLayers=e("../layers/bases");var n={createViewer:function(e){return new r(e)}},r=function(e){var t=ol.control.defaults({attributionOptions:{collapsible:!1},zoom:!1,attribution:!1}),i=ol.interaction.defaults().extend([new ol.interaction.DragRotate]);i.removeAt(1);var n;n=e.view instanceof ol.View?e.view:new ol.View(e.view);var r={controls:t,interactions:i,ol3Logo:!1,view:n,keyboardEventTarget:document};e.id&&(r.target=e.id);var o=new ol.Map(r);this.map=o};r.prototype.destroy=function(){this.map&&(this.map.dispose(),this.map=null)},r.prototype.getView=function(){return this.map.getView()},r.prototype.updateMap=function(e){},r.prototype.updateView=function(){},r.prototype.getMap=function(){return this.map},r.prototype.setTarget=function(e){this.map.setTarget(e)},r.prototype.goTo=function(e,t){var t=t||{},i=t.animate||!0,n=t.zoom||!1,r=this.map.getView();if(i){var o={duration:500,center:e};if(n)var s={duration:500,zoom:n};else var s={duration:500,resolution:r.getResolution()};r.animate(o,s)}else r.setCenter(e),n&&r.setZoom(n)},r.prototype.goToRes=function(e,t){var t=t||{},i=t.animate||!0,n=this.map.getView(),r=t.resolution||n.getResolution();if(i){var o={duration:300,center:e},s={duration:300,resolution:r};n.animate(o,s)}else n.setCenter(e),n.setResolution(r)},r.prototype.fit=function(e,t){var i=this.map.getView(),t=t||{},n=t.animate||!0;if(n){i.animate({duration:300,center:i.getCenter()}),i.animate({duration:300,resolution:i.getResolution()})}t.animate&&delete t.animate,t.constrainResolution=t.constrainResolution||!0,i.fit(e,this.map.getSize(),t)},r.prototype.getZoom=function(){var e=this.map.getView();return e.getZoom()},r.prototype.getResolution=function(){var e=this.map.getView();return e.getResolution()},r.prototype.getCenter=function(){var e=this.map.getView();return e.getCenter()},r.prototype.getBBOX=function(){return this.map.getView().calculateExtent(this.map.getSize())},r.prototype.getLayerByName=function(e){for(var t=this.map.getLayers(),i=t.getLength(),n=0;n<i;n++)if(e===t.item(n).get("name"))return t.item(n);return null},r.prototype.removeLayerByName=function(e){var t=this.getLayerByName(e);t&&(this.map.removeLayer(t),delete t)},r.prototype.getActiveLayers=function(){var e=[];return this.map.getLayers().forEach(function(t){var i=t.getProperties();1!=i.basemap&&i.visible&&e.push(t)}),e},r.prototype.removeLayers=function(){this.map.getLayers().clear()},r.prototype.getLayersNoBase=function(){var e=[];return this.map.getLayers().forEach(function(t){var i=t.getProperties();1!=i.basemap&&e.push(t)}),e},r.prototype.addBaseLayer=function(e){var t;t=e?BaseLayers[e]:BaseLayers.BING.Aerial,this.map.addLayer(t)},r.prototype.changeBaseLayer=function(e){var t=this.getLayerByName(layername),i=this.map.getLayers();i.insertAt(0,t)},t.exports=n},{"../layers/bases":105}],108:[function(e,t,i){var n=[0,0,8388608,8388608],r=function(e){if(!e.crs)return null;if(e.proj4def&&proj4.defs(e.crs,e.proj4def),ol.proj.Projection.call(this,{code:e.crs,extent:e.extent?e.extent:n}),this._axisOrientation=e.axisOrientation?e.axisOrientation:"enu",e.proj4def){var t=proj4.defs(e.crs);void 0!=t.axis&&(this._axisOrientation=t.axis)}};ol.inherits(r,ol.proj.Projection);var o=r.prototype;o.getAxisOrientation=function(){return this._axisOrientation},t.exports=r},{}],109:[function(e,t,i){var n=e("./projection"),r={get:function(e,t,i){e=r.normalizeCrs(e);var o=ol.proj.projections?ol.proj.projections:ol.proj,s=o.get(e);if(s)return s;var a=new n({crs:e,proj4def:t,extent:i});return o.add?o.add(e,a):o.addProjection(a),a},normalizeCrs:function(e){return"number"==typeof e?"EPSG:"+e:(e=e.replace(/[^\d\.\-]/g,""),""!=e?"EPSG:"+parseInt(e):void 0)}};t.exports=r},{"./projection":108}],110:[function(e,t,i){var n={merge:function(e,t){var i={};for(var n in e)i[n]=e[n];for(var n in t)i[n]=t[n];return i}};t.exports=n},{}],111:[function(e,t,i){var n={getExtentForViewAndSize:function(e,t,i,n){var r=t*n[0]/2,o=t*n[1]/2,s=Math.cos(i),a=Math.sin(i),l=r*s,c=r*a,u=o*s,h=o*a,p=e[0],d=e[1],f=p-l+h,g=p-l-h,m=p+l-h,v=p+l+h,y=d-c-u,_=d-c+u,b=d+c+u,w=d+c-u;return[Math.min(f,g,m,v),Math.min(y,_,b,w),Math.max(f,g,m,v),Math.max(y,_,b,w)]}};t.exports=n},{}],112:[function(e,t,i){function n(){var e=this;this.state={prstate:a.state,highlightlayers:!1,externallayers:[],layerstrees:[]},this.setters={},this.addExternalLayer=function(e){this.state.externallayers.push(e)},this.removeExternalLayer=function(e){var t=this;_.forEach(this.state.externallayers,function(i,n){if(i.name==e)return t.state.externallayers.splice(n,1),!1})},this.addLayersStoreToLayersTrees=function(e){this.state.layerstrees.push({tree:e.getLayersTree(),storeid:e.getId()})},o(this);var t=l.getLayersStores();_.forEach(t,function(t){e.addLayersStoreToLayersTrees(t)}),l.onafter("addLayersStore",function(t){e.addLayersStoreToLayersTrees(t)}),l.onafter("removeLayersStore",function(t){_.forEach(e.state.layerstrees,function(i,n){if(i.storeid==t.getId())return e.state.layerstrees.splice(n,1),!1})}),l.onafter("removeLayersStores",function(){_.forEach(e.state.layerstrees,function(t,i){return e.state.layerstrees.splice(i,1),!1})})}var r=e("core/utils/utils").inherit,o=e("core/utils/utils").base,s=e("core/g3wobject"),a=e("core/project/projectsregistry"),l=e("core/catalog/cataloglayersstoresregistry");r(n,s),t.exports=n},{"core/catalog/cataloglayersstoresregistry":23,"core/g3wobject":30,"core/project/projectsregistry":71,"core/utils/utils":77}],113:[function(e,t,i){t.exports='<!-- item template -->\n<div id="catalog" @contextmenu.prevent.stop="" class="tabbable-panel catalog">\n  <!--<div class="title">{{ title }}</div>-->\n  <div class="tabbable-line">\n    <ul class="nav nav-tabs" role="tablist">\n      <li role="presentation" class="active" :style="{width: hasBaseLayers ? \'32%\' : \'48%\'}"><a href="#tree" aria-controls="tree" role="tab" data-toggle="tab" data-i18n="tree">Data</a></li>\n      <li v-if="hasBaseLayers" role="presentation" style="width: 32%"><a href="#baselayers" aria-controls="baselayers" role="tab" data-toggle="tab" data-i18n="baselayers">Layer Base</a></li>\n      <li role="presentation" :style="{width: hasBaseLayers ? \'32%\' : \'48%\'}"><a href="#legend" aria-controls="legend" role="tab" data-toggle="tab" data-i18n="legend">Legenda</a></li>\n    </ul>\n    <div  class="tab-content">\n      <div role="tabpanel" class="tab-pane active tree" id="tree">\n        <ul class="tree-root" v-for="_layerstree in state.layerstrees">\n          <tristate-tree  :highlightlayers="state.highlightlayers" :layerstree="layerstree" class="item" v-for="layerstree in _layerstree.tree" :storeid="_layerstree.storeid" :key="layerstree.id">\n          </tristate-tree>\n        </ul>\n        <!--<ul>\n          <tristate-tree  :externallayers="state.externallayers" :layerstree="layerstree" class="item" v-for="layerstree in state.externallayers" :key="layerstree.id">\n          </tristate-tree>\n        </ul>-->\n      </div>\n      <div v-if="hasBaseLayers" role="tabpanel" class="tab-pane baselayers" id="baselayers">\n        <form>\n          <ul>\n            <li v-if="!baselayer.fixed" v-for="baselayer in baselayers">\n              <div class="radio">\n                <label><input type="radio" name="baselayer" v-checked="baselayer.visible" @click="setBaseLayer(baselayer.id)">{{ baselayer.title }}</label>\n              </div>\n            </li>\n          </ul>\n        </form>\n      </div>\n      <layerslegend v-for="_layerstree in state.layerstrees" :layerstree="_layerstree" :key="_layerstree.id"></layerslegend>\n    </div>\n  </div>\n  <ul id="layer-menu" v-click-outside-layer-menu="closeLayerMenu"  tabindex="-1" v-if="layerMenu.show"  :style="{top: layerMenu.top + \'px\', left: layerMenu.left + \'px\' }">\n    <li @click.prevent.stop="zoomToLayer"><span class="glyphicon glyphicon-search"> </span> Zoom to Layer</li>\n    <li @click.prevent.stop="startEditing"><span class="glyphicon glyphicon-pencil"> </span> Start Editing</li>\n    <li @click.prevent.stop="" v-if="layerMenu.layer.external" @mouseleave.self="showColorMenu(false,$event)" @mouseover.self="showColorMenu(true,$event)"> Setta/Cambia Colore <i class="fa fa-chevron-right" style="padding-left:10px;" aria-hidden="true"></i>\n      <ul v-if="layerMenu.colorMenu.show" style="position:fixed" :style="{ top: layerMenu.colorMenu.top + \'px\', left: layerMenu.colorMenu.left +   \'px\' }">\n        <li style="padding:0;">\n          <chrome-picker @click.prevent.stop="" v-model="layerMenu.colorMenu.color" @change-color="onChangeColor" style="width: 100%"></chrome-picker>\n        </li>\n      </ul>\n    </li>\n  </ul>\n</div>\n'},{}],114:[function(e,t,i){function n(e){function t(e){var t=e.getService();i.state.visible=!t.state.hidden,t.onafter("setHidden",function(e){i.state.visible=!t.state.hidden,i.state.expanded=!0})}o(this);var i=this;this.id="catalog-component",this.title="catalog",this.mapComponentId=e.mapcomponentid;var n=e.service||new p;if(this.setService(n),this.setInternalComponent(new m({service:n})),this.internalComponent.state=this.getService().state,this.mapComponentId){var r=c.getComponent(this.mapComponentId);r?t(r):l.on("componentregistered",function(e){e.getId()==i.mapComponentId&&t(e)})}s(this,e)}var r=e("core/utils/utils").inherit,o=e("core/utils/utils").base,s=e("core/utils/utils").merge,a=e("gui/vue/component"),l=e("gui/componentsregistry"),c=e("gui/gui"),u=e("gui/map/control/registry"),h=e("core/catalog/cataloglayersstoresregistry"),p=e("../catalogservice"),d=VueColor.Chrome,f=new Vue,g={template:e("./catalog.html"),data:function(){return{state:null,layerMenu:{show:!1,top:0,left:0,name:"",layer:null,colorMenu:{show:!1,top:0,left:0,color:null}}}},directives:{"click-outside-layer-menu":{bind:function(e,t,i){this.event=function(n){e==n.target||e.contains(n.target)||i.context[t.expression](n)},document.body.addEventListener("click",this.event)},unbind:function(e){document.body.removeEventListener("click",this.event)}}},components:{"chrome-picker":d},computed:{project:function(){return this.state.prstate.currentProject},title:function(){return this.project.state.name},baselayers:function(){return this.project.state.baselayers},hasBaseLayers:function(){return this.project.state.baselayers.length>0}},methods:{setBaseLayer:function(e){this.project.setBaseLayer(e)},zoomToLayer:function(){var e;this.layerMenu.layer.bbox&&(e=[this.layerMenu.layer.bbox.minx,this.layerMenu.layer.bbox.miny,this.layerMenu.layer.bbox.maxx,this.layerMenu.layer.bbox.maxy]);var t=c.getComponent("map").getService();t.goToBBox(e),this.layerMenu.show=!1},startEditing:function(){var e,t=this;_.forEach(h.getLayersStores(),function(i){if(e=i.getLayerById(t.layerMenu.layer.id))return!1}),e.getLayerForEditing()},closeLayerMenu:function(){this.layerMenu.show=!1,this.showColorMenu(!1)},onChangeColor:function(e){var t=c.getComponent("map").getService();this.layerMenu.colorMenu.color=e;var i=t.getLayerByName(this.layerMenu.name);i.setStyle(t.setExternalLayerColor(e))},showColorMenu:function(e,t){if(e){var i=$(t.target);this.layerMenu.colorMenu.top=i.offset().top,this.layerMenu.colorMenu.left=i.offset().left+i.width()+(i.outerWidth()-i.width())/2}this.layerMenu.colorMenu.show=e}},mounted:function(){var e=this;f.$on("treenodetoogled",function(e,t){if(t.external){var i,n=c.getComponent("map").getService();i=n.getLayerByName(t.name),i.setVisible(!i.getVisible()),t.visible=!t.visible}else h.getLayersStore(e).toggleLayer(t.id)}),f.$on("treenodestoogled",function(e,t,i){function n(e){e.nodes?_.forEach(e.nodes,function(e){n(e)}):r.push(e.id)}var r=[];_.map(t,n),h.getLayersStore(e).toggleLayers(r,i)}),f.$on("treenodeselected",function(e,t){var i=c.getComponent("map").getService(),n=h.getLayersStore(e).getLayerById(t.id);n.isSelected()?(h.getLayersStore(e).unselectLayer(t.id),i.emit("cataloglayerunselected",n)):(h.getLayersStore(e).selectLayer(t.id),i.emit("cataloglayerselected",n))}),f.$on("showmenulayer",function(t,i){e.layerMenu.top=i.y,e.layerMenu.left=i.x,e.layerMenu.name=t.name,e.layerMenu.layer=t,e.layerMenu.show=!0,e.layerMenu.colorMenu.color=t.color}),u.onafter("registerControl",function(t,i){"querybbox"==t&&i.getInteraction().on("propertychange",function(t){"active"==t.key&&(e.state.highlightlayers=!t.oldValue)})}),$("input:file").filestyle({buttonText:"",input:!1,buttonName:"btn-primary",iconName:"glyphicon glyphicon-plus"})}},m=Vue.extend(g);Vue.component("g3w-catalog",g),Vue.component("tristate-tree",{template:e("./tristate-tree.html"),props:{layerstree:{},storeid:null,checked:!1,parentFolder:!1,externallayers:null},data:function(){return{expanded:this.layerstree.expanded,parentChecked:!this.checked,controltoggled:!1,n_childs:null}},watch:{checked:function(e){this.layerstree.visible=e}},computed:{isFolder:function(){var e=0,t=0;!function n(i){_.forEach(i.nodes,function(i){i.nodes||(t+=1),i.visible?e+=1:i.nodes&&n(i)})}(this.layerstree),this.n_childs=t;var i=!!this.n_childs;return i&&(this.n_parentChilds=this.n_childs-e),i},isHidden:function(){return this.layerstree.hidden&&this.layerstree.hidden===!0},selected:function(){var e=this.layerstree.selected?"SI":"NO";return e},isHighLight:function(){return this.layerstree.id,!1}},methods:{toggle:function(e){var t="true"==e;this.isFolder&&!t?this.layerstree.expanded=!this.layerstree.expanded:t?(this.parentChecked&&!this.n_parentChilds?this.parentChecked=!1:this.parentChecked&&this.n_parentChilds?this.parentChecked=!0:this.parentChecked=!this.parentChecked,f.$emit("treenodestoogled",this.storeid,this.layerstree.nodes,this.parentChecked)):f.$emit("treenodetoogled",this.storeid,this.layerstree)},select:function(){this.isFolder||this.layerstree.external||f.$emit("treenodeselected",this.storeid,this.layerstree)},triClass:function(){return this.n_parentChilds?this.n_parentChilds>0&&this.n_parentChilds<this.n_childs?"fa-square":"fa-square-o":"fa-check-square-o"},removeExternalLayer:function(e){var t=c.getComponent("map").getService();t.getLayerByName(e);t.removeExternalLayer(e)},showLayerMenu:function(e,t){this.isFolder||f.$emit("showmenulayer",e,t)}}}),Vue.component("layerslegend",{template:e("./legend.html"),props:["layerstree"],data:function(){return{}},computed:{visiblelayers:function(){function e(i){_.forIn(i,function(i,n){!_.isNil(i.id)&&i.visible&&t.push(i),_.isNil(i.nodes)||e(i.nodes)})}var t=[],i=this.layerstree.tree;return e(i),t}},watch:{layerstree:{handler:function(e,t){},deep:!0}},mounted:function(){Vue.nextTick(function(){$(".legend-item").perfectScrollbar()})}}),Vue.component("layerslegend-item",{template:e("./legend_item.html"),props:["layer"],computed:{legendurl:function(){var e,t=this;return _.forEach(h.getLayersStores(),function(i){if(i.getLayerById(t.layer.id))return e=i.getLayerById(t.layer.id).getLegendUrl(),!1}),e}},methods:{updateLegendScroll:function(e){$(e.target).perfectScrollbar("update")}}}),r(n,a),t.exports=n},{"../catalogservice":112,"./catalog.html":113,"./legend.html":115,"./legend_item.html":116,"./tristate-tree.html":117,"core/catalog/cataloglayersstoresregistry":23,"core/utils/utils":77,"gui/componentsregistry":119,"gui/gui":129,"gui/map/control/registry":145,"gui/vue/component":179}],115:[function(e,t,i){t.exports='<div role="tabpanel" class="tab-pane" id="legend">\n  <layerslegend-item :layer="layer" v-for="layer in visiblelayers" :key="layer.id"></layerslegend-item>\n</div>\n'},{}],116:[function(e,t,i){t.exports='  <div class="legend-item" @mouseenter="updateLegendScroll($event)">\n    <img :src="legendurl">\n    <span class="divider"></span>\n  </div>\n'},{}],117:[function(e,t,i){t.exports='<li class="tree-item" @contextmenu.prevent.stop="showLayerMenu(layerstree, $event)" @click="select()" :class="{selected: !isFolder ? layerstree.selected : false, itemmarginbottom: !isFolder }">\n  <span :class="{bold: isFolder, \'fa-chevron-down\': layerstree.expanded, \'fa-chevron-right\': !layerstree.expanded}" @click="toggle" v-if="isFolder" class="root fa"></span>\n  <span v-if="isFolder" @click.stop="toggle(\'true\')" :class="[triClass()]" class="fa"></span>\n  <span v-show="!layerstree.hidden" v-else @click.stop="toggle" :class="[layerstree.visible  ? \'fa-check-square-o\': \'fa-square-o\',layerstree.disabled  ? \'disabled\': \'\',  parentFolder ? \'child\' : \'root\' ]" class="fa checkbox-layer"></span>\n  <span v-show="!layerstree.hidden || isFolder" class="tree-node-title" :class="{bold: isFolder, disabled: layerstree.disabled, highlightlayer: isHighLight }">{{ layerstree.title }}</span><i v-if="layerstree.external" class="glyphicon glyphicon glyphicon-trash link trash pull-right" @click="removeExternalLayer(layerstree.name)"></i>\n  <ul v-show="layerstree.expanded" v-if="isFolder">\n    <tristate-tree :parentFolder="isFolder" :n_parent-childs="n_parentChilds" :layerstree="layerstree" :storeid="storeid" v-for="layerstree in layerstree.nodes" :key="layerstree.id">\n    </tristate-tree>\n  </ul>\n</li>'},{}],118:[function(e,t,i){var n=e("core/utils/utils").inherit,r=e("core/utils/utils").merge,o=e("core/utils/utils").base,s=e("core/g3wobject"),a=["methods","computed","data","components"],l=function(e){e=e||{},this.internalComponent=null,this._components=[],this.id=e.id||1e3*Math.random(),this.title=e.title||"",this.state={visible:e.visible||!0,open:e.open||!1},this.setters={setOpen:function(e){this.state.open=e,this._setOpen()},setVisible:function(e){this.state.visible=e,this._setVisible()},reload:function(){this._reload()}},this.init=function(e){e=e||{},this.vueComponent=this.createVueComponent(e.vueComponentObject),this._components=e.components||[],this.setService(e.service),this._service.init?this._service.init(e):null,this.setInternalComponentTemplate(e.template),this.setInternalComponent=function(){var e=Vue.extend(this.vueComponent);this.internalComponent=new e({service:this._service,template:this.getInternalTemplate()}),this.internalComponent.state=this.getService().state,this.internalComponent.state.components=this._components},this.setInternalComponent()},o(this)};n(l,s);var c=l.prototype;c.getId=function(){return this.id},c.setId=function(e){this.id=e},c.getOpen=function(){return this.state.open},c.getVisible=function(){return this.state.visible},c.getTitle=function(){return this.state.title},c.setTitle=function(e){this.state.title=e},c.getService=function(){return this._service},c.setService=function(e){this._service=e},c.insertComponentAt=function(e,t){this._components.splice(e,0,t)},c.removeCompomentAt=function(e){this._components.splice(e,1)},c.addComponent=function(e){this._components.push(e)},c.popComponent=function(){return this._components.pop()},c.removeComponent=function(e){var t=this;_.forEach(this._components,function(i,n){if(i==e)return t.splice(n,1),!1})},c.setComponents=function(e){this._components=_.isArray(e)?e:[]},c.exendComponents=function(e){_.merge(this._components,e)},c.getInternalComponent=function(){return this.internalComponent},c.setInternalComponent=function(e){!e&&this.internalComponentClass?this.internalComponent=new this.internalComponentClass:this.internalComponent=e},c.createVueComponent=function(e){return _.cloneDeep(e)},c.addInternalComponentData=function(e){_.merge(this.internalComponent,e)},c.overwriteServiceMethod=function(e,t){this._service[e]=t},c.overwriteServiceMethods=function(e){var t=this;_.forEach(e,function(e,i){t.overwriteServiceMethod(i,e)})},c.extendService=function(e){this._service&&r(this._service,e)},c.extendInternalComponent=function(e){var t=this;this.vueComponent?_.forEach(e,function(e,i){if(a.indexOf(i)>-1)switch(i){case"methods":t.extendInternalComponentMethods(e);break;case"components":t.extendInternalComponentComponents(e);break;default:r(t.vueComponent[i],e)}}):this.vueComponent=e},c.extendInternalComponentComponents=function(e){e&&r(this.vueComponent.components,e)},c.extendComponents=function(e){this.extendInternalComponentComponents(e)},c.addComponent=function(e){e&&(this.vueComponent.components[e.key]=e.value)},c.extendInternalComponentMethods=function(e){e&&(_.forEach(e,function(t,i){t instanceof Function||delete e[i]}),r(this.vueComponent.methods,e))},c.extendInternalComponentComputed=function(e){e&&(_.forEach(e,function(t,i){t instanceof Function||delete e[i]}),r(this.vueComponent.computed,e))},c.setInternalComponentTemplate=function(e){e&&(this.vueComponent.template=e)},c.getInternalTemplate=function(){return this.vueComponent.template},c.mount=function(e){},c.unmount=function(){},c.ismount=function(){return!0},c._setOpen=function(){},c._setVisible=function(){},c._reload=function(){},c.layout=function(e,t){},t.exports=l},{"core/g3wobject":30,"core/utils/utils":77}],119:[function(e,t,i){function n(){this.components={},this.registerComponent=function(e){var t=e.getId();this.components[t]||(this.components[t]=e,this.emit("componentregistered",e))},this.getComponent=function(e){return this.components[e]},this.getComponents=function(){return this.components},this.unregisterComponent=function(e){var t=this._components[e];t&&(_.isFunction(t.destroy)&&t.destroy(),delete t,this._components[e]=null)},s(this)}var r=e("core/g3wobject"),o=e("core/utils/utils").inherit,s=e("core/utils/utils").base;o(n,r),t.exports=new n},{"core/g3wobject":30,"core/utils/utils":77}],120:[function(e,t,i){t.exports='<div class="g3w-form-component_body nano">\n  <form class="form-horizontal g3w-form nano-content">\n    <div class="box box-primary">\n      <div class="box-body">\n        <template v-for="(field, index) in state.fields" v-if="reloadLayout(index)">\n          <component\n            @changeinput="changeInput"\n            @addinput="addToValidate"\n            :state="field"\n            :is="field.type+\'_input\'">\n          </component>\n        </template>\n      </div>\n    </div>\n  </form>\n</div>\n'},{}],121:[function(e,t,i){var n=e("./body.html"),r=e("gui/inputs/inputs"),o=Vue.extend({template:n,props:["state"],components:r,methods:{addToValidate:function(e){this.$emit("addtovalidate",e.validate)},changeInput:function(e){this.$emit("changeinput",e)},reloadLayout:function(e){return e==this.state.fields.length-1&&this.$emit("reloadlayout"),!0}}});t.exports=o},{"./body.html":120,"gui/inputs/inputs":133}],122:[function(e,t,i){t.exports='<div class="g3w-form-component_footer">\n  <div  style="margin: 0 auto; width: 100%">\n    <div class="form-group">\n      <div class="col-sm-offset-4 col-sm-8">\n        <div style="margin-bottom:10px">\n          <span>* Campi richiesti</span>\n        </div>\n        <button v-for="button in state.buttons" class="btn " :class="[button.class]" @click.stop.prevent="exec(button.cbk)" v-disabled="!btnEnabled(button)">{{ button.title }}</button>\n      </div>\n    </div>\n  </div>\n</div>'},{}],123:[function(e,t,i){var n=e("./footer.html"),r=Vue.extend({template:n,props:["state"],methods:{exec:function(e){_.isFunction(e)?e(this.state.fields):function(){return this.state.fields}()},btnEnabled:function(e){return"save"!=e.type||"save"==e.type&&this.isValid()},isValid:function(){return this.state.valid}}});t.exports=r},{"./footer.html":122}],124:[function(e,t,i){t.exports='<div class="box-header with-border g3w-form-component_header" style="background-color: #ffffff;">\n  <h3 class="box-title">{{ state.title }}</h3>\n  <div class="box-tools pull-right">\n  </div>\n</div>'},{}],125:[function(e,t,i){var n=Vue.extend({template:e("./header.html"),props:["state"]});t.exports=n},{"./header.html":124}],126:[function(e,t,i){function n(){this.state=null,this.eventBus=new Vue,this.setters={setInitForm:function(e){this._setInitForm(e)},setFormFields:function(e){this.state.fields=e},setupFields:function(){this._setupFields()},setFormData:function(e){this.setFormFields(e)},setField:function(e){},setState:function(e){this._setState(e)},addActionsForForm:function(e){},postRender:function(e){}},this._setInitForm=function(e){e=e||{},this.title=e.title||"Form",this.formId=e.formId,this.name=e.name,this.pk=e.pk||null,this.buttons=e.buttons||[],this._pickedPromise=null,this.state={title:this.title,fields:null,buttons:this.buttons,disabled:!1,valid:!0,tovalidate:[]},this.setFormFields(e.fields)},this.isValid=function(){var e=!0;_.forEach(this.state.tovalidate,function(t){if(!t.valid)return e=!1,!1}),this.state.valid=e},this.addToValidate=function(e){this.state.tovalidate.push(e)},this.getState=function(){return this.state},this._setState=function(e){this.state=e},this.getFields=function(){return this.state.fields},this._getField=function(e){var t=null;return _.forEach(this.state.fields,function(i){i.name==e&&(t=i)}),t},this.getEventBus=function(){return this.eventBus},this.init=function(e){this._setInitForm(e)},o(this)}var r=e("core/utils/utils").inherit,o=e("core/utils/utils").base,s=e("core/g3wobject");r(n,s),t.exports=n},{"core/g3wobject":30,"core/utils/utils":77}],127:[function(e,t,i){t.exports='<div>\n  <component\n    @reloadlayout="reloadLayout"\n    @addtovalidate="addToValidate"\n    @changeinput="changeInput"\n    :state="state"\n    :is="component" v-for="component in state.components">\n  </component>\n</div>'},{}],128:[function(e,t,i){function n(e){e=e||{},e.id=e.id||"form",l(this,e),e.service=e.service?new e.service:new a,e.vueComponentObject=e.vueComponentObject||d,e.template=e.template||c,e.components=e.components||[u,h,p],this.init(e),this.addComponentBeforeBody=function(e){this.insertComponentAt(1,e)},this.addComponentAfterBody=function(e){this.insertComponentAt(2,e)},this.addComponentBeforeFooter=function(){},this.addComponentAfterFooter=function(e){},this.mount=function(e,t){var i=this;return l(this,"mount",e,t).then(function(){o.setModal(!0),i.getService().isValid()})},this.layout=function(){this.internalComponent.reloadLayout()}}var r=e("core/utils/utils").inherit,o=e("gui/gui"),s=e("gui/vue/component"),a=e("../formservice"),l=e("core/utils/utils").base,c=e("./form.html"),u=e("../components/header/vue/header"),h=e("../components/body/vue/body"),p=e("../components/footer/vue/footer"),d={template:null,data:function(){return{state:null}},transitions:{addremovetransition:"showhide"},methods:{changeInput:function(e){return this.$options.service.eventBus.$emit("changeinput",e),this.$options.service.isValid()},addToValidate:function(e){this.$options.service.addToValidate(e)},reloadLayout:function(){var e=$(this.$el).height();$(this.$el).width();if(e){var t=!1,i=!1,n=$(this.$el).find('div[class*="g3w-form-component"]'),r=[],o=[],s=0,a=0;n.each(function(){i=$(this).hasClass("g3w-form-component_footer"),!t||i?(r.push($(this)),s+=$(this).height()):($(this).hasClass("g3w-form-component_body")||o.push($(this)),a+=1),t=!!t||$(this).hasClass("g3w-form-component_header")});var l=e-s,c=l/a-15,u=$(this.$el).find(".g3w-form-component_body .box-primary").outerHeight()+20;u=u>c?c:u,$(this.$el).find(".g3w-form-component_body").height(u),l-=u,a-=1,c=l/a-15,_.forEach(o,function(e){e.height(c)}),$(".nano").nanoScroller()}}},mounted:function(){var e=this;this.$options.service.getEventBus().$on("addtovalidate",this.addToValidate),this.$nextTick(function(){this.reloadLayout(),e.$options.service.postRender()})}};r(n,s),t.exports=n},{"../components/body/vue/body":121,"../components/footer/vue/footer":123,"../components/header/vue/header":125,"../formservice":126,"./form.html":127,"core/utils/utils":77,"gui/gui":129,"gui/vue/component":179}],129:[function(e,t,i){function n(){this.ready=!1,this.getResourcesUrl=r,this.showForm=r,this.closeForm=r,this.showListing=r,this.closeListing=r,this.hideListing=r,this.showQueryResults=function(e){},this.hideQueryResults=r,this.showPanel=r,this.hidePanel=r,this.addComponent=function(e,t){},this.removeComponent=function(e){},this.setComponent=function(e){l.registerComponent(e)},this.getComponent=function(e){return l.getComponent(e)},this.getComponents=function(){return l.getComponents()},this["goto"]=function(e){a["goto"](e)},this.ready=function(){this.emit("ready"),this.ready=!0},this.guiResized=function(){this.emit("guiresized");
},this.showSpinner=function(e){},this.hideSpinner=function(e){},this.notify=r,this.dialog=r}var r=e("core/utils/utils").noop,o=e("core/utils/utils").inherit,s=e("core/g3wobject"),a=e("core/router"),l=e("gui/componentsregistry");o(n,s),t.exports=new n},{"core/g3wobject":30,"core/router":75,"core/utils/utils":77,"gui/componentsregistry":119}],130:[function(e,t,i){t.exports='<div class="form-group has-feedback">\n  <slot name="inputlabel">\n    <label :for="state.name" class="col-sm-4 control-label">{{ state.label }}\n      <span v-if="state.validate && state.validate.required">*</span>\n    </label>\n  </slot>\n  <div class="col-sm-8">\n    <slot name="inputelement">\n      <input\n        @keyup="change()"\n        v-disabled="!isEditable()"\n        :field="state.name"\n        class="form-control"\n        v-model="state.value"\n        :class="{\'input-error-validation\' : !state.validate.valid}"\n        :id="state.name"\n        :placeholder="state.input.label">\n    </slot>\n    <p class="error-input-message">{{ state.validate.message }}</p>\n  </div>\n</div>'},{}],131:[function(e,t,i){var n=e("./service"),r={props:["state"],data:function(){return{service:new n({state:this.state})}},template:e("./baseinput.html"),methods:{change:function(){this.service.validate(),this.$emit("changeinput",this.state)},isEditable:function(){return this.service.isEditable()},isVisible:function(){}},mounted:function(){var e=this;Vue.set(this.state.validate,"valid",!0),Vue.set(this.state.validate,"message",null),this.change(),this.$nextTick(function(){e.$emit("addinput",this.state)})}},o=Vue.extend({mixins:[r]});t.exports={BaseInput:r,BaseInputComponent:o}},{"./baseinput.html":130,"./service":138}],132:[function(e,t,i){var n=e("./baseinput").BaseInput,r=e("./baseinput").BaseInputComponent,o={props:["state"],mixins:[n],components:{baseinput:r}};t.exports=o},{"./baseinput":131}],133:[function(e,t,i){var n={text_input:e("./text/vue/text"),textarea_input:e("./textarea/vue/textarea"),integer_input:e("./integer/vue/integer"),string_input:e("./text/vue/text"),float_input:e("./integer/vue/integer")};t.exports=n},{"./integer/vue/integer":137,"./text/vue/text":139,"./textarea/vue/textarea":140}],134:[function(e,t,i){function n(e){e=e||{},e.validator=a,o(this,e)}var r=e("core/utils/utils").inherit,o=e("core/utils/utils").base,s=e("gui/inputs/service"),a=e("./validator");r(n,s);n.prototype;t.exports=n},{"./validator":135,"core/utils/utils":77,"gui/inputs/service":138}],135:[function(e,t,i){function n(){o(this),this.validate=function(e){var t=1*e;return!_.isNaN(t)&&_.isNumber(1*e)}}var r=e("core/utils/utils").inherit,o=e("core/utils/utils").base,s=e("gui/inputs/validator");r(n,s),t.exports=new n},{"core/utils/utils":77,"gui/inputs/validator":141}],136:[function(e,t,i){t.exports='<baseinput :state="state">\n  <input\n    @change="change"\n    style="width:100%"\n    v-disabled="!isEditable()"\n    v-model="state.value"\n    slot="inputelement"\n    type="number"\n    min="0">\n</baseinput>\n'},{}],137:[function(e,t,i){var n=e("gui/inputs/input"),r=e("../service"),o=Vue.extend({mixins:[n],data:function(){return{service:new r({state:this.state})}},template:e("./integer.html")});t.exports=o},{"../service":134,"./integer.html":136,"gui/inputs/input":132}],138:[function(e,t,i){function n(e){e=e||{},this.state=e.state||{},this._validator=e.validator||new r}var r=e("./validator"),o=e("core/i18n/i18n.service").t,s=n.prototype;s.getState=function(){return this.state},s.setState=function(e){this.state=_.isObject(e)?e:{}},s.getValidator=function(){return this._validator},s.setValidator=function(e){this._validator=e},s.validate=function(){return _.isEmpty(_.trim(this.state.value))?this.state.validate.valid=!this.state.validate.required:this.state.validate.valid=this._validator.validate(this.state.value),this.state.validate.message=this.state.validate.valid?null:o("input_validation_error"),this.state.valid},s.isEditable=function(){return this.state.editable},t.exports=n},{"./validator":141,"core/i18n/i18n.service":33}],139:[function(e,t,i){var n=e("gui/inputs/input"),r=Vue.extend({mixins:[n]});t.exports=r},{"gui/inputs/input":132}],140:[function(e,t,i){var n=e("gui/inputs/input"),r=Vue.extend({mixins:[n]});t.exports=r},{"gui/inputs/input":132}],141:[function(e,t,i){function n(){this.validate=function(){return!0}}t.exports=n},{}],142:[function(e,t,i){t.exports="<div>\n  Lista di oggetti\n</div>\n"},{}],143:[function(e,t,i){function n(e){this.panelComponent=null,this.options=e||{},this.id=e.id||null,this.name=e.name||null,this.state={list:e.list||[]},this._listPanelComponent=e.listPanelComponent||s}var r=e("core/utils/utils").resolve,o=(e("core/utils/utils").reject,e("gui/gui")),s=Vue.extend({template:e("./listpanel.html"),methods:{exec:function(e){var t=this.state.relations||null;e(this.state.fields,t),o.closeForm()}}}),a=n.prototype;a.onShow=function(e){var t=this._setupPanel();return this._mountPanel(t,e),r(!0)},a.onClose=function(){return this.panelComponent.$destroy(!0),this.panelComponent=null,r(!0)},a._setupPanel=function(){var e=this.panelComponent=new this._listPanelComponent({panel:this});return e.state=this.state,e},a._mountPanel=function(e,t){e.$mount().$appendTo(t)},t.exports={ListPanelComponent:s,ListPanel:n}},{"./listpanel.html":142,"core/utils/utils":77,"gui/gui":129}],144:[function(e,t,i){var n=e("g3w-ol3/src/controls/resetcontrol"),r=e("g3w-ol3/src/controls/querycontrol"),o=e("g3w-ol3/src/controls/zoomboxcontrol"),s=e("g3w-ol3/src/controls/querybboxcontrol"),a=e("g3w-ol3/src/controls/querybypolygoncontrol"),l=e("g3w-ol3/src/controls/geolocationcontrol"),c=e("g3w-ol3/src/controls/streetviewcontrol"),u=e("g3w-ol3/src/controls/addlayers"),h=e("g3w-ol3/src/controls/lengthcontrol"),p=e("g3w-ol3/src/controls/areacontrol"),d=e("g3w-ol3/src/controls/control"),f=e("g3w-ol3/src/controls/olcontrol"),g=e("g3w-ol3/src/controls/nominatimcontrol"),m={create:function(e){var t,i=m.CONTROLS[e.type],n=e.layers;if(i&&(t=new i(e)),n&&t instanceof d){if(!n.length)return null;var r=t.getGeometryTypes(),o=!r.length;return _.forEach(n,function(e){if(r.indexOf(e.getGeometryType())>-1)return o=!0,!1}),o?t:null}return t}};m.CONTROLS={reset:n,zoombox:o,zoomtoextent:f,query:r,querybbox:s,querybypolygon:a,geolocation:l,streetview:c,zoom:f,scaleline:f,overview:f,nominatim:g,addlayers:u,length:h,area:p},t.exports=m},{"g3w-ol3/src/controls/addlayers":83,"g3w-ol3/src/controls/areacontrol":84,"g3w-ol3/src/controls/control":85,"g3w-ol3/src/controls/geolocationcontrol":86,"g3w-ol3/src/controls/lengthcontrol":88,"g3w-ol3/src/controls/nominatimcontrol":90,"g3w-ol3/src/controls/olcontrol":91,"g3w-ol3/src/controls/querybboxcontrol":92,"g3w-ol3/src/controls/querybypolygoncontrol":93,"g3w-ol3/src/controls/querycontrol":94,"g3w-ol3/src/controls/resetcontrol":95,"g3w-ol3/src/controls/streetviewcontrol":96,"g3w-ol3/src/controls/zoomboxcontrol":97}],145:[function(e,t,i){function n(){this._controls={},this.setters={registerControl:function(e,t){this._registerControl(e,t)}},this._registerControl=function(e,t){this._controls[e]=t},this.getControl=function(e){return this._controls[e]},this.getControls=function(){return this._controls},this.unregisterControl=function(e){var t=this.getControl(e),i=a.getComponet("map").getService(),n=i.getMap();return!!t&&(n.removeControl(t),delete this._controls[e],!0)},o(this)}var r=e("core/utils/utils").inherit,o=e("core/utils/utils").base,s=e("core/g3wobject"),a=e("gui/gui");r(n,s),t.exports=new n},{"core/g3wobject":30,"core/utils/utils":77,"gui/gui":129}],146:[function(e,t,i){function n(e){var t=this;this.viewer=null,this.target=null,this._layersStoresEventKeys={},this.project=null,this._mapControls=[],this._mapLayers=[],this.mapBaseLayers={},this.layersExtraParams={},this.state={bbox:[],resolution:null,center:null,loading:!1,hidden:!0},this._greyListenerKey=null,this._drawShadow={type:"coordinate",outer:[],inner:[],scale:null,rotation:null},this.config=e.config||l.getConfig(),this._howManyAreLoading=0,this._incrementLoaders=function(){0==this._howManyAreLoading&&(this.emit("loadstart"),a.showSpinner({container:$("#map-spinner"),id:"maploadspinner",style:"blue"})),this._howManyAreLoading+=1},this._decrementLoaders=function(){this._howManyAreLoading-=1,0==this._howManyAreLoading&&(this.emit("loadend"),a.hideSpinner("maploadspinner"))},_.isNil(e.project)?(this.project=c.getCurrentProject(),c.onafter("setCurrentProject",function(e){t._removeListeners(),t.project=e,t._setupLayers(),t._resetView()})):this.project=e.project,this._setupListeners(),this._marker=null,this.setters={setMapView:function(e,t,i){this.state.bbox=e,this.state.resolution=t,this.state.center=i,this.updateMapLayers(this._mapLayers)},setHidden:function(e){this.state.hidden=e},setupViewer:function(e,i){0!=e&&0!=i&&(t.viewer&&(t.viewer.destroy(),t.viewer=null),t._setupViewer(e,i),t.state.bbox=this.viewer.getBBOX(),t.state.resolution=this.viewer.getResolution(),t.state.center=this.viewer.getCenter(),t.setupControls(),t._setupLayers(),t.emit("viewerset"))},controlClick:function(){}},this.on("cataloglayerselected",function(e){e&&_.forEach(this._mapControls,function(t){_.indexOf(_.keysIn(t.control),"onSelectLayer")>-1&&t.control.onSelectLayer()&&(t.control.getGeometryTypes().indexOf(e.getGeometryType())>-1?t.control.setEnable(!0):t.control.setEnable(!1))})}),this.on("cataloglayerunselected",function(e){_.forEach(this._mapControls,function(e){_.indexOf(_.keysIn(e.control),"onSelectLayer")>-1&&e.control.onSelectLayer()&&e.control.setEnable(!1)})}),_.forEach(u.getLayersStores(),function(e){t._setUpEventsKeysToLayersStore(e)}),u.onafter("addLayersStore",function(e){t._setUpEventsKeysToLayersStore(e)}),u.onafter("removeLayersStore",function(e){t._removeEventsKeysToLayersStore(e)}),o(this)}var r=e("core/utils/utils").inherit,o=e("core/utils/utils").base,s=e("core/g3wobject"),a=e("gui/gui"),l=e("core/applicationservice"),c=e("core/project/projectsregistry"),u=(e("core/layers/layer"),e("core/geometry/geometry"),e("core/map/maplayersstoresregistry")),h=e("core/layers/layersstore"),p=e("core/layers/filter/filter"),d=e("core/layers/providers/wfsprovider"),f=e("g3w-ol3/src/g3w.ol3").helpers,g=e("core/map/layer/wmslayer"),m=e("core/map/layer/xyzlayer"),v=e("gui/map/control/factory"),y=e("gui/streetview/streetviewservice"),b=e("gui/map/control/registry");r(n,s);var w=n.prototype;w.createOlLayer=function(e){e=e||{};var t,i=e.id,n=e.geometryType,r=e.color;switch(n){case"Point":t=function(){return[new ol.style.Style({image:new ol.style.Circle({radius:5,fill:new ol.style.Fill({color:r})})})]};break;case"Line":t=new ol.style.Style({stroke:new ol.style.Stroke({width:3,color:r})});break;case"Polygon":t=new ol.style.Style({stroke:new ol.style.Stroke({color:r,width:3}),fill:new ol.style.Fill({color:r,opacity:.5})})}var o=new ol.source.Vector({features:new ol.Collection}),s=new ol.layer.Vector({id:i,source:o,style:t});return s},w.slaveOf=function(e,t){},w.setLayersExtraParams=function(e,t){this.layersExtraParams=_.assign(this.layersExtraParams,e),this.emit("extraParamsSet",e,t)},w.getProject=function(){return this.project},w.getMap=function(){return this.viewer.map},w.defineProjection=function(e){switch(e){case"3003":proj4.defs("EPSG:"+e,"+proj=tmerc +lat_0=0 +lon_0=9 +k=0.9996 +x_0=1500000 +y_0=0 +ellps=intl +units=m +no_defs")}},w.getProjection=function(){return this.project.getProjection()},w.getCrs=function(){return this.getProjection().getCode()},w.getViewerElement=function(){return this.viewer.map.getTargetElement()},w.getViewport=function(){return this.viewer.map.getViewport()},w.getResolution=function(){return this.viewer.map.getView().getResolution()},w.getEpsg=function(){return this.viewer.map.getView().getProjection().getCode()},w.getGetFeatureInfoUrlForLayer=function(e,t,i,n,r){var o=this.getMapLayerForLayer(e);return o.getGetFeatureInfoUrl(t,i,n,r)},w.showMarker=function(e,t){t=t||1e3;var i=this;this._marker.setPosition(e),setTimeout(function(){i._marker.setPosition()},t)},w.getLayerByName=function(e){var t=this.viewer.map,i=null;return t.getLayers().forEach(function(t){if(t.get("name")==e)return i=t,!1}),i},w.getLayerById=function(e){var t,i=this.viewer.map;return i.getLayers().forEach(function(i){if(i.get("id")==e)return t=i,!1}),t},w.setupControls=function(){var e=this;this.config&&this.config.mapcontrols&&_.forEach(this.config.mapcontrols,function(t){var i;switch(t){case"reset":isMobile.any||(i=v.create({type:t})),e.addControl(t,i);break;case"zoom":i=v.create({type:t,zoomInLabel:"",zoomOutLabel:""}),e.addControl(t,i);break;case"zoombox":isMobile.any||(i=v.create({type:t}),i.on("zoomend",function(t){e.viewer.fit(t.extent)}),e.addControl(t,i));break;case"zoomtoextent":isMobile.any||(i=v.create({type:t,label:"",extent:e.project.state.initextent}),e.addControl(t,i));break;case"query":i=v.create({type:t}),i.on("picked",function(t){var i=t.coordinates;e.showMarker(i);var n=a.showContentFactory("query"),r=e.getLayers({QUERYABLE:!0,SELECTEDORALL:!0}),o=[];_.forEach(r,function(t){o.push(t.query({coordinates:i,resolution:e.getResolution()}))});var s=n("interrogazione");$.when.apply(this,o).then(function(){layersResults=arguments;var t={query:layersResults[0].query,data:[]};_.forEach(layersResults,function(e){t.data.push(e.data[0])}),s.setQueryResponse(t,i,e.state.resolution)}).fail(function(){a.notify.error("Si è verificato un errore nella richiesta al server"),a.closeContent()})}),e.addControl(t,i);break;case"querybypolygon":var n=e.getLayers({QUERYABLE:!0,SELECTEDORALL:!0});if(i=v.create({type:t,layers:n})){var r=a.showContentFactory("query");i.on("picked",function(t){var i,n={},o=[],s=[],l=t.coordinates,c=e.getLayers({QUERYABLE:!0,SELECTED:!0});_.forEach(c,function(t){s.push(t.query({coordinates:l,resolution:e.getResolution()}))}),$.when.apply(this,s).then(function(){s=[],o=arguments,n={},n.query=o[0].query;var t=[];if(_.forEach(o,function(e){t.push(e.data[0])}),n.data=t,n&&n.data&&n.data.length){i=n.data[0].features[0].getGeometry();var l=new p;l.setGeometry(i);var c=e.getLayers({QUERYABLE:!0,ALLNOTSELECTED:!0,FILTERABLE:!0});_.forEach(c,function(e){s.push(e.query({filter:l}))}),e.highlightGeometry(i);var u=r("interrogazione");$.when.apply(this,s).then(function(){layersResults=arguments;var t={query:layersResults[0].query,data:[]};_.forEach(layersResults,function(e){t.data.push(e.data[0])}),u.setQueryResponse(t,i,e.state.resolution)}).fail(function(){a.notify.error("Si è verificato un errore nella richiesta al server"),a.closeContent()}).always(function(){e.clearHighlightGeometry()})}}).fail(function(){a.notify.error("Si è verificato un errore nella richiesta al server"),a.closeContent()})}),e.addControl(t,i)}break;case"querybbox":if(!isMobile.any&&e.filterableLayersAvailable()){var n=e.getLayers({QUERYABLE:!0,SELECTEDORALL:!0,WFS:!0});i=v.create({type:t,layers:n}),i&&(i.on("bboxend",function(t){var i=t.extent,n=e.getLayers({QUERYABLE:!0,SELECTEDORALL:!0,FILTERABLE:!0}),r=[];_.forEach(n,function(e){var t=new p;t.setBBOX(i),r.push(e.query({filter:t}))});var o=a.showContentFactory("query"),s=o("interrogazione");$.when.apply(this,r).then(function(){layersResults=arguments;var t={query:layersResults[0].query,data:[]};_.forEach(layersResults,function(e){t.data.push(e.data[0])}),s.setQueryResponse(t,i,e.state.resolution)}).fail(function(e){var t="Si è verificato un errore nella richiesta al server";e&&(t+=" "+e),a.notify.error(t),a.closeContent()})}),e.addControl(t,i))}break;case"streetview":isMobile.any||(i=v.create({type:t}),i.setProjection(e.getProjection()),e.addControl(t,i),e.on("viewerset",function(){e.viewer.map.addLayer(i.getLayer())}),$script("https://maps.googleapis.com/maps/api/js?key=AIzaSyBCHtKGx3yXWZZ7_gwtJKG8a_6hArEFefs",function(){var t={lat:null,lng:null},n=new y;n.onafter("postRender",function(e){i.setPosition(e)}),i&&(i.on("picked",function(i){var r=i.coordinates,o=ol.proj.transform(r,e.getProjection().getCode(),"EPSG:4326");t.lat=o[1],t.lng=o[0],n.showStreetView(t)}),i.on("disabled",function(){panorama&&(panorama=null)}))}));break;case"scaleline":i=v.create({type:t,position:"br"}),e.addControl(t,i);break;case"overview":if(!isMobile.any){if(!e.config.overviewproject)return;var o=e.config.overviewproject.gid;o&&c.getProject(o).then(function(n){var r=e.getOverviewMapLayers(n);i=v.create({type:t,position:"bl",className:"ol-overviewmap ol-custom-overviewmap",collapseLabel:$('<span class="glyphicon glyphicon-menu-left"></span>')[0],label:$('<span class="glyphicon glyphicon-menu-right"></span>')[0],collapsed:!1,layers:r,view:new ol.View({projection:e.getProjection()})}),e.addControl(t,i)})}break;case"nominatim":i=v.create({type:t}),i.on("addresschosen",function(t){var i=t.coordinate,n=new ol.geom.Point(i);e.highlightGeometry(n)}),e.addControl(t,i),$("#search_nominatim").click(function(){i.nominatim.query($("input.gcd-txt-input").val())}),$(".gcd-txt-result").perfectScrollbar();break;case"geolocation":isMobile.any||(i=v.create({type:t}),i.on("click",function(t){e.showMarker(t.coordinates)}),i.on("error",function(e){a.notify.error("Non è possibile calcolare la tua posizione. Si è verificato un errore di connessione al server")}),e.addControl(t,i));break;case"addlayers":isMobile.any||(i=v.create({type:t}),i.on("addlayer",function(){if(!i.getLayersStore()){new h}e.emit("addexternallayer")}),e.addControl(t,i));break;case"length":isMobile.any||(i=v.create({type:t}),e.addControl(t,i));break;case"area":isMobile.any||(i=v.create({type:t}),e.addControl(t,i))}})},w.getLayers=function(e){e=e||{};var t={GEOLAYER:!0,HIDDEN:!1};e=_.merge(e,t);var i=[];return _.forEach(u.getLayersStores(),function(t){_.merge(i,t.getLayers(e))}),i},w.filterableLayersAvailable=function(){var e=this,t=this.getLayers({QUERYABLE:!0,FILTERABLE:!0,SELECTEDORALL:!0});return _.some(t,function(t){return!(t.getProvider("filter")instanceof d)||t.getProjection().getCode()==e.project.getLayersStore().getProjection().getCode()})},w.addControl=function(e,t){var i=this;this.viewer.map.addControl(t),this._mapControls.push({type:e,control:t,visible:!0}),t.on("controlclick",function(){i.controlClick()}),b.registerControl(e,t)},w.showControl=function(e){this.showControls([e])},w.hideControl=function(e){this.hideControls([e])},w.showControls=function(e){this.toggleControls(!0,e)},w.hideControls=function(e){this.toggleControls(!1,e)},w.showAllControls=function(){this.toggleControls(!0)},w.hideAllControls=function(){this.toggleControls(!1)},w.toggleControls=function(e,t){this._removeControls(),_.forEach(this._mapControls,function(i){t?t.indexOf(i.type)>-1&&(i.visible=e):i.visible=e}),this._layoutControls()},w._layoutControls=function(){var e=this;_.forEach(this._mapControls,function(t){t.visible&&e.viewer.map.addControl(t.control)})},w.removeControl=function(e){var t=this;_.forEach(this._mapControls,function(i,n){if(e==i.type)return t._mapControls.splice(n,1),t.viewer.map.removeControl(i.control),!1})},w._removeControls=function(){var e=this;_.forEach(this._mapControls,function(t){e.viewer.map.removeControl(t.control)})},w._unToggleControls=function(){_.forEach(this._mapControls,function(e){e.control.isToggled&&e.control.isToggled()&&(e.control.toggle(!1),a.closeContent())})},w.addMapLayer=function(e){this._mapLayers.push(e)},w.getMapLayers=function(){return this._mapLayers},w.getMapLayerForLayer=function(e){var t,i="layer_"+e.getMultiLayerId();return _.forEach(this.getMapLayers(),function(e){if(e.getId()==i)return t=e,!1}),t},w.getProjectLayer=function(e){return this.layersstore.getLayerById(e)},w._resetView=function(){var e=this.viewer.map.getSize()[0],t=this.viewer.map.getSize()[1],i=this.project.state.extent,n=ol.extent.getWidth(i)/e,r=ol.extent.getHeight(i)/t,o=Math.max(n,r)>this.viewer.map.getView().getMaxResolution()?Math.max(n,r):this.viewer.map.getView().getMaxResolution(),s=new ol.View({extent:i,projection:this.viewer.map.getView().getProjection(),center:this.viewer.map.getView().getCenter(),resolution:this.viewer.map.getView().getResolution(),maxResolution:o});this.viewer.map.setView(s)},w._setupViewer=function(e,t){var i=this,n=this.getProjection(),r=i.project.state.initextent,o=i.project.state.extent,s=ol.extent.getWidth(o)/e,a=ol.extent.getHeight(o)/t,l=Math.max(s,a),c=ol.extent.getWidth(r)/e,u=ol.extent.getHeight(r)/t,h=Math.max(c,u);this.viewer=f.createViewer({id:this.target,view:{projection:n,center:ol.extent.getCenter(r),extent:o,maxResolution:l}}),this.config.background_color&&$("#"+this.target).css("background-color",this.config.background_color),$(this.viewer.map.getViewport()).prepend('<div id="map-spinner" style="position:absolute;right:0px;"></div>'),this.viewer.map.getInteractions().forEach(function(e){i._watchInteraction(e)}),this.viewer.map.getInteractions().on("add",function(e){i._watchInteraction(e.element)}),this.viewer.map.getInteractions().on("remove",function(e){}),this.viewer.map.getView().setResolution(h),this.viewer.map.on("moveend",function(e){i._setMapView()}),this._marker=new ol.Overlay({position:void 0,positioning:"center-center",element:document.getElementById("marker"),stopEvent:!1}),this.viewer.map.addOverlay(this._marker),this.emit("ready")},w._removeListeners=function(){this._setBaseLayerListenerKey&&this.project.un("setBaseLayer",this._setBaseLayerListenerKey)},w._removeEventsKeysToLayersStore=function(e){var t=this,i=e.getId();t._layersStoresEventKeys[i]&&_.forEach(t._layersStoresEventKeys[i],function(t){_.forEach(t,function(t,i){e.un(i,t)})})},w._setUpEventsKeysToLayersStore=function(e){var t=this,i=e.getId();if(!this._layersStoresEventKeys[i]){this._layersStoresEventKeys[i]=[];var n=e.onafter("setLayersVisible",function(i){var n=_.map(i,function(i){var n=e.getLayerById(i);return t.getMapLayerForLayer(n)});t.updateMapLayers(n)});this._layersStoresEventKeys[e.getId()].push({setLayersVisible:n});var r=e.onafter("addLayer",function(e){if("vector"==e.getType()){var i=t.createOlLayer({id:e.getId(),geometryType:e.getGeometryType(),color:e.getColor()});t.viewer.map.addLayer(i)}});this._layersStoresEventKeys[e.getId()].push({addLayer:r});var o=e.onafter("removeLayer",function(e){if("vector"==e.getType()){var i=e.getId(),n=t.getLayerById(i);t.viewer.map.removeLayer(n)}});this._layersStoresEventKeys[e.getId()].push({removeLayer:o})}},w._setupListeners=function(){this._setBaseLayerListenerKey=this.project.onafter("setBaseLayer",function(){self.updateMapLayers(self.mapBaseLayers)})},w._setupBaseLayers=function(){var t=this,i=t.getLayers({BASELAYER:!0});i.length&&(this.mapBaseLayers={},_.forEach(i,function(i){if(i.isWMS())var n={url:i.getWmsUrl(),id:i.state.id,tiled:i.state.tiled},r=new g(n);else switch(i.getServerType()){case"OSM":var o=e("core/map/layer/osmlayer"),r=new o({id:i.state.id});break;case"Bing":var s=e("core/map/layer/binglayer"),r=new s({id:i.state.id})}t.addMapLayer(r),t.registerListeners(r),r.addLayer(i),t.mapBaseLayers[i.getId()]=r}),_.forEach(_.values(this.mapBaseLayers).reverse(),function(e){t.viewer.map.addLayer(e.getOLLayer()),e.update(t.state)}))},w._setupLayers=function(){var e=this;this.viewer.removeLayers(),this._setupBaseLayers(),this._reset();var t=this.getLayers(),i=_.groupBy(t,function(e){return e.getMultiLayerId()});return _.forEach(i,function(t,i){var n,r="layer_"+i,o=t[0];1==t.length&&o.isCached()?(n=new m({id:r,projection:e.getProjection()}),e.addMapLayer(n),e.registerListeners(n),n.addLayer(o)):(n=new g({url:o.getWmsUrl(),id:r},e.layersExtraParams),e.addMapLayer(n),e.registerListeners(n),_.forEach(t.reverse(),function(e){n.addLayer(e)}))}),_.forEach(this.getMapLayers().reverse(),function(t){e.viewer.map.addLayer(t.getOLLayer()),t.update(e.state,e.layersExtraParams)}),this.mapLayers},w.getOverviewMapLayers=function(e){var t=e.getLayersStore().getLayers({VISIBLE:!0,GEOLAYER:!0,HIDDEN:!1}),i=_.groupBy(t,function(e){return e.getMultiLayerId()}),n=[];return _.forEach(i,function(t,i){var r="overview_layer_"+i,o=t[0].state.tiled,s={url:e.getWmsUrl(),id:r,tiled:o},a=new g(s);_.forEach(t.reverse(),function(e){a.addLayer(e)}),n.push(a.getOLLayer(!0))}),n.reverse()},w.updateMapLayers=function(e){var t=this;_.forEach(e,function(e){e.update(t.state,t.layersExtraParams)})},w.registerListeners=function(e){var t=this;e.on("loadstart",function(){t._incrementLoaders()}),e.on("loadend",function(){t._decrementLoaders(!1)}),this.on("extraParamsSet",function(t,i){i&&e.update(this.state,t)})},w.setTarget=function(e){this.target=e},w.addInteraction=function(e){this._unToggleControls(),this.viewer.map.addInteraction(e),e.setActive(!0)},w.removeInteraction=function(e){this.viewer.map.removeInteraction(e)},w._watchInteraction=function(e){var t=this;e.on("change:active",function(e){e.target instanceof ol.interaction.Pointer&&e.target.getActive()&&t.emit("mapcontrol:active",e.target)})},w.goTo=function(e,t){var i={zoom:t||6};this.viewer.goTo(e,i)},w.goToRes=function(e,t){var i={resolution:t};this.viewer.goToRes(e,i)},w.goToBBox=function(e){this.viewer.fit(e)},w.goToWGS84=function(e,t){var e=ol.proj.transform(e,"EPSG:4326","EPSG:"+this.project.state.crs);this.goTo(e,t)},w.extentToWGS84=function(e){return ol.proj.transformExtent(e,"EPSG:"+this.project.state.crs,"EPSG:4326")},w.getResolutionForMeters=function(e){var t=this.viewer.map.getViewport();return e/Math.max(t.clientWidth,t.clientHeight)};var C=null,L=!1;w.highlightGeometry=function(e,t){var i=this;this.clearHighlightGeometry();var n,t=t||{},r="boolean"!=typeof t.zoom||t.zoom,o="boolean"!=typeof t.highlight||t.highlight,s=t.duration||2e3;this.viewer.map.getView();if(e instanceof ol.geom.Geometry)n=e;else{var a=new ol.format.GeoJSON;n=a.readGeometry(e)}t.fromWGS84&&n.transform("EPSG:4326","EPSG:"+ProjectService.state.project.crs);var l=n.getType();if(r)if("Point"==l||"MultiPoint"==l&&1==n.getPoints().length){var c="Point"==l?n.getCoordinates():n.getPoint(0).getCoordinates();if(4326!=this.project.state.crs&&3857!=this.project.state.crs){var u=this.getResolutionForMeters(100);i.goToRes(c,u)}else r=i.viewer.map.getView().getZoom()>6?i.viewer.map.getView().getZoom():6,i.goTo(c,r)}else this.viewer.fit(n,t);if(o){var h=new ol.Feature({geometry:n});C||(C=new ol.layer.Vector({source:new ol.source.Vector,style:function(e){var t=[],i=e.getGeometry().getType();if("LineString"==i||"MultiLineString"==i){var n=new ol.style.Style({stroke:new ol.style.Stroke({color:"rgb(255,255,0)",width:4})});t.push(n)}else if("Point"==i||"MultiPoint"==i){var n=new ol.style.Style({image:new ol.style.Circle({radius:6,fill:new ol.style.Fill({color:"rgb(255,255,0)"})}),zIndex:1/0});t.push(n)}else if("MultiPolygon"==i||"Polygon"==i){var n=new ol.style.Style({stroke:new ol.style.Stroke({color:"rgb(255,255,0)",width:4}),fill:new ol.style.Fill({color:"rgba(255, 255, 0, 0.5)"})});t.push(n)}return t}}),C.setMap(this.viewer.map)),C.getSource().clear(),C.getSource().addFeature(h),s&&(L=!0,setTimeout(function(){C.getSource().clear(),L=!1},s))}},w.clearHighlightGeometry=function(){C&&!L&&C.getSource().clear()},w.refreshMap=function(){_.forEach(this._mapLayers,function(e){e.getOLLayer().getSource().updateParams({time:Date.now()})})},w.layout=function(e,t){this.viewer||this.setupViewer(e,t),this.viewer&&(this.setHidden(0==e||0==t),this.getMap().updateSize(),this._setMapView())},w._reset=function(){this._mapLayers=[]},w.getMapBBOX=function(){return this.viewer.getBBOX()},w._setMapView=function(){var e=this.viewer.getBBOX(),t=this.viewer.getResolution(),i=this.viewer.getCenter();this.setMapView(e,t,i)},w.getMapSize=function(){var e=this.viewer.map;return e.getSize()},w.setInnerGreyCoverScale=function(e){this._drawShadow.scale=e},w._resetDrawShadowInner=function(){this._drawShadow={type:"coordinate",outer:[],inner:[],scale:null,rotation:null}},w.setInnerGreyCoverBBox=function(e){var t,i,e=e||{},n=this.viewer.map,r=e.type||"coordinate",o=e.inner||null,s=e.rotation,a=e.scale;if(o){switch(r){case"coordinate":t=n.getPixelFromCoordinate([o[0],o[1]]),i=n.getPixelFromCoordinate([o[2],o[3]]);break;case"pixel":t=[o[0],o[1]],i=[o[2],o[3]]}var l=t[1]*ol.has.DEVICE_PIXEL_RATIO,c=t[0]*ol.has.DEVICE_PIXEL_RATIO,u=i[1]*ol.has.DEVICE_PIXEL_RATIO,h=i[0]*ol.has.DEVICE_PIXEL_RATIO;this._drawShadow.inner[0]=c,this._drawShadow.inner[1]=l,this._drawShadow.inner[2]=h,this._drawShadow.inner[3]=u}_.isNil(a)?this._drawShadow.scale=this._drawShadow.scale||1:this._drawShadow.scale=a,_.isNil(s)?this._drawShadow.rotation=this._drawShadow.rotation||0:this._drawShadow.rotation=s,this._drawShadow.outer&&n.render()},w.startDrawGreyCover=function(){function e(e){var l=e.context,c=this.getSize(),u=c[1]*ol.has.DEVICE_PIXEL_RATIO,h=c[0]*ol.has.DEVICE_PIXEL_RATIO;a._drawShadow.outer=[0,0,h,u],l.restore(),l.beginPath(),l.moveTo(0,0),l.lineTo(h,0),l.lineTo(h,u),l.lineTo(0,u),l.lineTo(0,0),l.closePath(),a._drawShadow.inner.length&&(l.save(),t=a._drawShadow.inner[0],n=a._drawShadow.inner[3],i=a._drawShadow.inner[2],r=a._drawShadow.inner[1],o=a._drawShadow.rotation,s=a._drawShadow.scale,l.translate((i+t)/2,(r+n)/2),l.rotate(o*Math.PI/180),l.moveTo(-((i-t)/2),(r-n)/2),l.lineTo((i-t)/2,(r-n)/2),l.lineTo((i-t)/2,-((r-n)/2)),l.lineTo(-((i-t)/2),-((r-n)/2)),l.lineTo(-((i-t)/2),(r-n)/2),l.closePath()),l.fillStyle="rgba(0, 5, 25, 0.40)",l.fill(),l.restore()}var t,i,n,r,o,s,a=this,l=this.viewer.map;this._greyListenerKey&&this.stopDrawGreyCover(),this._greyListenerKey=l.on("postcompose",e)},w.stopDrawGreyCover=function(){var e=this.viewer.map;ol.Observable.unByKey(this._greyListenerKey),this._greyListenerKey=null,this._drawShadow.inner.length&&this._resetDrawShadowInner(),e.render()},w.removeExternalLayer=function(e){var t=this.getLayerByName(e),i=a.getComponent("catalog").getService(),n=a.getComponent("queryresults").getService();n.unregisterVectorLayer(t),this.viewer.map.removeLayer(t),i.removeExternalLayer(e)},w.addExternalLayer=function(e){function t(t,i){n=t.readFeatures(i,{dataProjection:"EPSG:"+d,featureProjection:l.getEpsg()}),r=new ol.source.Vector({features:n}),o=new ol.layer.Vector({source:r,name:u}),o.setStyle(l.setExternalLayerColor(h)),s=o.getSource().getExtent(),e.bbox={minx:s[0],miny:s[1],maxx:s[2],maxy:s[3]},c.addLayer(o),m.registerVectorLayer(o),g.addExternalLayer(e),c.getView().fit(r.getExtent())}var i,n,r,o,s,l=this,c=this.viewer.map,u=e.name,h=e.color,p=e.type,d=e.crs,f=e.data,g=a.getComponent("catalog").getService(),m=a.getComponent("queryresults").getService(),v=this.getLayerByName(u);if(v)a.notify.info("Layer già aggiunto");else switch(d!=l.getCrs()&&l.defineProjection(d),p){case"geojson":i=new ol.format.GeoJSON,t(i,f);break;case"kml":i=new ol.format.KML({extractStyles:!1}),t(i,f);break;case"zip":var y;loadshp({url:f,encoding:"big5",EPSG:d},function(e){y||(y=e,d="4326",f=JSON.stringify(e),i=new ol.format.GeoJSON,t(i,f))})}},w.setExternalLayerColor=function(e){var e=e.rgba;e="rgba("+e.r+","+e.g+","+e.b+","+e.a+")";var t={Point:new ol.style.Style({image:new ol.style.Circle({fill:new ol.style.Fill({color:e}),radius:5,stroke:new ol.style.Stroke({color:e,width:1})})}),LineString:new ol.style.Style({stroke:new ol.style.Stroke({color:e,width:3})}),Polygon:new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255,255,255,0.5)"}),stroke:new ol.style.Stroke({color:e,width:3})}),MultiPoint:new ol.style.Style({image:new ol.style.Circle({fill:new ol.style.Fill({color:e}),radius:5,stroke:new ol.style.Stroke({color:e,width:1})})}),MultiLineString:new ol.style.Style({stroke:new ol.style.Stroke({color:e,width:3})}),MultiPolygon:new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255,255,255,0.5)"}),stroke:new ol.style.Stroke({color:e,width:3})})},i=function(e,i){var n=e.getStyleFunction();return n?n.call(e,i):t[e.getGeometry().getType()]};return i},t.exports=n},{"core/applicationservice":22,"core/g3wobject":30,"core/geometry/geometry":32,"core/layers/filter/filter":38,"core/layers/layer":41,"core/layers/layersstore":43,"core/layers/providers/wfsprovider":50,"core/map/layer/binglayer":55,"core/map/layer/osmlayer":59,"core/map/layer/wmslayer":61,"core/map/layer/xyzlayer":62,"core/map/maplayersstoresregistry":63,"core/project/projectsregistry":71,
"core/utils/utils":77,"g3w-ol3/src/g3w.ol3":98,"gui/gui":129,"gui/map/control/factory":144,"gui/map/control/registry":145,"gui/streetview/streetviewservice":173}],147:[function(e,t,i){t.exports='<!-- Modal -->\n<div class="modal fade" id="modal-addlayer" role="dialog">\n  <div class="modal-dialog">\n    <!-- Modal content-->\n    <div class="modal-content">\n      <div class="modal-header">\n        <button type="button" class="close" data-dismiss="modal">&times;</button>\n        <h4 class="modal-title">Aggiungi Layer</h4>\n      </div>\n      <div class="modal-body">\n        <div class="form-group">\n          <label for="proiezione-layer">Seleziona il sistema di proiezione del layer</label>\n          <select class="form-control" id="proiezione-layer" v-model="layer.crs">\n            <option value="3003">EPSG:3003</option>\n            <option value="3857">EPSG:3857</option>\n            <option value="4326">EPSG:4326</option>\n          </select>\n        </div>\n        <p style="font-weight: 700;">Seleziona il colore del layer</p>\n        <chrome-picker v-model="layer.color" @change-color="onChangeColor" style="width:90%;margin:auto"></chrome-picker>\n        <form id="addcustomlayer">\n          <input type="file" title=" " @change="onAddLayer($event)" accept=".kml,.geojson, .KML, .GEOJSON, .zip">\n          <h4>Trascina qui il file o clicca sull\'area</h4>\n          <h4 v-if="layer.name">{{ layer.name }}</h4>\n          <div>\n            <i class="fa fa-cloud-upload fa-5x" aria-hidden="true"></i>\n          </div>\n          <p>.geojson, .kml, .zip(shapefile)</p>\n        </form>\n      </div>\n      <div class="modal-footer">\n        <button type="button" class="btn btn-default pull-left" @click="addLayer" data-dismiss="modal">Aggiungi</button>\n        <button type="button" class="btn btn-default" data-dismiss="modal" @click="clearLayer">Chiudi</button>\n      </div>\n    </div>\n  </div>\n</div>'},{}],148:[function(e,t,i){t.exports='<div :id="target" style="width:100%;height:100%">\n  <div style="display: none;">\n    <div id="marker"></div>\n  </div>\n  <addlayer :service="service"></addlayer>\n</div>\n\n\n'},{}],149:[function(e,t,i){function n(e){o(this,e),this.id="map-component",this.title="Catalogo dati",this.target=e.target||"map",this.setService(new l(e)),s(this,e),this.internalComponent=new p({mapService:this._service}),this.internalComponent.target=this.target}var r=e("core/utils/utils").inherit,o=e("core/utils/utils").base,s=e("core/utils/utils").merge,a=e("gui/vue/component"),l=e("../mapservice"),c=VueColor.Chrome;c.mounted=function(){this.$nextTick(function(){$(".vue-color__chrome__toggle-btn").remove(),$(".vue-color__editable-input__label").remove(),$(".vue-color__chrome__saturation-wrap").css("padding-bottom","100px"),$(".vue-color__chrome").css({"box-shadow":"0 0 0 0",border:"1px solid #97A1A8"})})};var u={template:e("./addlayer.html"),props:["service"],data:function(){return{layer:{name:null,type:null,crs:null,color:{hex:"#194d33",rgba:{r:25,g:77,b:51,a:1},a:1},data:null,visible:!0,title:null,id:null,external:!0}}},components:{"chrome-picker":c},mounted:function(){this.layer.crs=this.service.getCrs(),this.service.on("addexternallayer",function(){$("#modal-addlayer").modal("show")})},methods:{onChangeColor:function(e){this.layer.color=e},onAddLayer:function(e){var t=this,i=new FileReader,n=e.target.files[0].name;this.layer.name=n,this.layer.title=n,this.layer.id=n;var r=e.target.files[0].name.split(".");this.layer.type=r[r.length-1].toLowerCase(),"zip"==this.layer.type?(t.layer.data=e.target.files[0],$("input:file").val(null)):(i.onload=function(e){t.layer.data=e.target.result,$("input:file").val(null)},i.readAsText(e.target.files[0]))},addLayer:function(){if(this.layer.name){var e=_.cloneDeep(this.layer);this.service.addExternalLayer(e),$("#modal-addlayer").modal("hide"),this.clearLayer()}},clearLayer:function(){this.layer.name=null,this.layer.title=null,this.layer.id=null,this.layer.type=null,this.layer.crs=this.service.getCrs(),this.layer.color={hex:"#194d33",rgba:{r:25,g:77,b:51,a:1},a:1},this.layer.data=null}}},h={template:e("./map.html"),data:function(){return{target:"map",service:this.$options.mapService}},components:{addlayer:u},mounted:function(){var e=this,t=this.$options.mapService;this.crs=t.getCrs(),this.$nextTick(function(){t.setTarget(e.$el.id)}),t.onafter("setupViewer",function(){t.setTarget(e.$el.id)})}},p=Vue.extend(h);Vue.component("g3w-map",h),r(n,a);var d=n.prototype;d.layout=function(e,t){$("#"+this.target).height(t),$("#"+this.target).width(e),this._service.layout(e,t)},t.exports=n},{"../mapservice":146,"./addlayer.html":147,"./map.html":148,"core/utils/utils":77,"gui/vue/component":179}],150:[function(e,t,i){var n=e("core/utils/utils").inherit,r=e("core/utils/utils").resolve,o=e("core/g3wobject"),s=function(e){this.internalPanel=null;var e=e||{};this.id=e.id||null,this.title=e.title||""};n(s,o);var a=s.prototype;a.getId=function(){return this.id},a.getTitle=function(){return this.title},a.getInternalPanel=function(){return this.internalPanel},a.setInternalPanel=function(e){this.internalPanel=e},a.mount=function(e){var t=this.internalPanel,i=t.$mount();return $(e).append(i.$el),i.$nextTick(function(){$(e).localize(),t.onShow&&t.onShow()}),r(!0)},a.unmount=function(){var e=this.internalPanel,t=$.Deferred();return e.$destroy(!0),$(e.$el).remove(),e.onClose&&e.onClose(),this.internalComponent=null,t.resolve(),t.promise()},a.onResize=function(e,t){},t.exports=s},{"core/g3wobject":30,"core/utils/utils":77}],151:[function(e,t,i){var n=[{value:500,label:"1:500"},{value:1e3,label:"1:1.000"},{value:2e3,label:"1:2.000"},{value:2500,label:"1:2.500"},{value:5e3,label:"1:5.000"},{value:1e4,label:"1:10.000"},{value:25e3,label:"1:25.000"},{value:5e4,label:"1:50.000"},{value:1e5,label:"1:100.000"},{value:25e4,label:"1:250.000"},{value:5e5,label:"1:500.000"},{value:1e6,label:"1:1.000.000"},{value:5e6,label:"1:5.000.000"}],r=[150,300];t.exports={scale:n,dpis:r}},{}],152:[function(e,t,i){function n(){o(this),this._initialized=!1,this.state={},this._moveMapKeyEvent=null,this._page=null,this._mapService=null,this._map=null,this._isOpen=!1,this._scalesResolutions={},this.init=function(){this._project=l.getCurrentProject(),this.state.print=this._project.state.print,this.state.visible=!(!this.state.print||!this.state.print.length),this.state.isShow=!1,this.state.loading=!1,this.state.url=null,this.state.visible&&(this.state.template=this.state.print[0].name,this.state.rotation=0,this.state.inner=null,this.state.center=null,this.state.size=null,this.state.scale=f,this.state.scala=null,this.state.dpis=g,this.state.dpi=g[0],this.state.map=null,this.state.width=null,this.state.height=null)},this.changeTemplate=function(){var e=this;if(this.state.template){var t=this.state.template;_.forEach(this.state.print,function(i){i.name==t&&(e.state.width=i.maps[0].w,e.state.height=i.maps[0].h,e.state.map=i.maps[0].name)}),this._setPrintArea()}},this.changeScale=function(){this.state.scala&&this._setPrintArea()},this.changeRotation=function(){this._mapService.setInnerGreyCoverBBox({rotation:this.state.rotation}),this._changePrintOutput()},this._getOptionsPrint=function(){var e={scale:this.state.scala,extent:this.state.inner.join(),rotation:this.state.rotation,dpi:this.state.dpi,template:this.state.template,map:this.state.map};return e},this.print=function(){var e=this;this._page=new d({service:e});var t=this._getOptionsPrint();s.setContent({content:e._page,title:"Stampa",perc:100}),c.print(t).then(function(t,i,n){e.state.url=this.url}).fail(function(){s.notify.error("Si è verificato un errore nella richiesta al server"),s.closeContent()})},this._calculateInternalPrintExtent=function(){var e=this._map.getView().getResolution(),t=parseFloat(this.state.scala),i=this.state.width/1e3*t/e*ol.has.DEVICE_PIXEL_RATIO,n=this.state.height/1e3*t/e*ol.has.DEVICE_PIXEL_RATIO,r=[this.state.size[0]*ol.has.DEVICE_PIXEL_RATIO/2,this.state.size[1]*ol.has.DEVICE_PIXEL_RATIO/2],o=r[0]-i/2,s=r[1]-n/2,a=r[0]+i/2,l=r[1]+n/2;x_min=this._map.getCoordinateFromPixel([o,l]),x_max=this._map.getCoordinateFromPixel([a,l]),y_min=this._map.getCoordinateFromPixel([o,s]),y_max=this._map.getCoordinateFromPixel([a,s]),this.state.inner=[x_min[0],x_min[1],y_max[0],y_max[1]]},this._setPrintArea=function(){this.state.size=this._map.getSize(),this.state.currentScala=u(this._map.getView().getResolution()),this.state.center=this._map.getView().getCenter(),this._calculateInternalPrintExtent(),this._mapService.setInnerGreyCoverBBox({inner:this.state.inner,rotation:this.state.rotation})},this._clearPrint=function(){ol.Observable.unByKey(this._moveMapKeyEvent),this._moveMapKeyEvent=null,this._mapService.stopDrawGreyCover()},this._changePrintOutput=function(){var e=this;if(this.state.isShow){this.state.loading=!0;var t=this._getOptionsPrint();c.print(t).then(function(t){e.state.url==t&&(e.state.loading=!1),e.state.url=t})}},this._setAllScalesBasedOnMaxResolution=function(e){var t=this,i=e,n=u(i),r=_.orderBy(this.state.scale,["value"],["desc"]),o=[];_.forEach(r,function(e){n>e.value&&(o.push(e),i=h(e.value),t._scalesResolutions[e.value]=i,i/=2)}),this.state.scale=_.orderBy(o,["value"],["asc"])},this._setInitialScalaSelect=function(){var e=this,t=this._map.getView().getResolution(),i=u(t),n=!1;_.forEach(this.state.scale,function(t,r){if(i<t.value&&!e.state.scala){var o=r?r-1:r;return e.state.scala=e.state.scale[o].value,$("#scala").val(e.state.scala),n=!0,!1}}),n||(this.state.scala=this.state.scale[this.state.scale.length-1].value)},this._setCurrentScala=function(e){var t=this;_.forEach(this._scalesResolutions,function(i,n){if(i==e)return t.state.scala=n,!1})},this._setMoveendMapEvent=function(){var e=this;this._moveMapKeyEvent=this._map.on("moveend",function(){e._setPrintArea()})},this._showPrintArea=function(){this._setPrintArea(),this._mapService.startDrawGreyCover()},this._initPrintConfig=function(){var e;if(this._initialized)e=this._map.getView().getResolution(),this._setCurrentScala(e);else{var t=this._map.getView().getMaxResolution();this._setAllScalesBasedOnMaxResolution(t),this._setInitialScalaSelect(),this._initialized=!0}},this._setMapInfo=function(){var e=this;_.forEach(this.state.print[0].maps,function(t){if("map0"==t.name)return e.state.map=t.name,e.state.width=t.w,e.state.height=t.h,!1})},this.showPrintArea=function(e){this._mapService=s.getComponent("map").getService(),this._map=this._mapService.viewer.map,e?(this._setMapInfo(),this._setMoveendMapEvent(),this._initPrintConfig(),this._showPrintArea()):this._clearPrint()},this.reload=function(){var e=this;this._project=l.getCurrentProject(),this._mapService=s.getComponent("map").getService(),this._map=this._mapService.viewer.map,this.state.print=this._project.state.print,this.state.visible=!(!this.state.print||!this.state.print.length),this.state.visible?(this.state.template=this.state.print[0].name,this._initialized||this.init(),this._initPrintConfig(),this._mapService.on("changeviewaftercurrentproject",function(){var t=e._map.getView().getMaxResolution();e.state.scale=f,e._setAllScalesBasedOnMaxResolution(t)})):this._clearPrint()}}var r=e("core/utils/utils").inherit,o=e("core/utils/utils").base,s=e("gui/gui"),a=e("core/g3wobject"),l=e("core/project/projectsregistry"),c=e("core/print/printservice"),u=e("core/utils/geo").resToScale,h=e("core/utils/geo").scaleToRes,p=e("./printconfig"),d=e("./vue/printpage"),f=p.scale,g=p.dpis;r(n,a),t.exports=n},{"./printconfig":151,"./vue/printpage":156,"core/g3wobject":30,"core/print/printservice":67,"core/project/projectsregistry":71,"core/utils/geo":76,"core/utils/utils":77,"gui/gui":129}],153:[function(e,t,i){t.exports='<ul id="print" class="treeview-menu">\n  <li>\n    <form id="g3w-search-form" class="form-horizonal">\n      <div class="box-body">\n        <label for="templates">Template</label>\n        <select class="form-control" @change="onChangeTemplate" v-model="state.template" id="templates" placeholder="Seleziona il template">\n          <option v-for="print in state.print">{{ print.name }}</option>\n        </select>\n        <label for="scala">Scala</label>\n        <select class="form-control" @change="onChangeScale" v-model="state.scala" id="scala" placeholder="Seleziona la scala">\n          <option v-for="scala in state.scale" :value="scala.value">{{ scala.label }}</option>\n        </select>\n        <label for="dpi">dpi</label>\n        <select class="form-control" @change="onChangeDpi"  v-model="state.dpi" id="dpi" placeholder="Seleziona i dpi">\n          <option v-for="dpi in state.dpis" >{{ dpi }}</option>\n        </select>\n        <label for="rotation">Rotazione</label>\n        <input min="-360" max="360"  @input="onChangeRotation" v-model="state.rotation" id="rotation" class="form-control" type="number">\n      </div>\n      <div class="box-footer" style="background-color: transparent">\n        <span>\n          <button style="width:100%; background-color: #3c8dbc" class="btn " @click.stop.prevent="exec(button.cbk)" v-disabled="btnEnabled(button)">{{ button.title }}</button>\n        </span>\n      </div>\n    </form>\n    <div id="message" style="text-align:center; padding:3px; color: yellow" class="message" v-show="btnEnabled(button)">\n      <div>\n        <span>Muovendoti all\'interno della mappa</span>\n      </div>\n      <div>\n        <span>o cambiando i parametri della stampa</span>\n      </div>\n      <div>\n        <span>il PDF si aggiornerà automaticamente</span>\n      </div>\n    </div>\n  </li>\n</ul>\n'},{}],154:[function(e,t,i){function n(e){a(this,e),this.title="print",this.vueComponent=c,this.internalComponent=null;var t=e.service||new s;this.setService(t),this._service.init(),this.setInternalComponent=function(){var e=Vue.extend(this.vueComponent);return this.internalComponent=new e({service:t}),this.state.visible=t.state.visible,this.internalComponent.state=t.state,this.internalComponent},this._reload=function(){var e=this.getService();e.reload(),this.state.visible=e.state.visible},this._setOpen=function(){this._service.showPrintArea(this.state.open)},l(this,e)}var r=e("core/utils/utils").inherit,o=e("gui/vue/component"),s=e("gui/print/printservice"),a=e("core/utils/utils").base,l=e("core/utils/utils").merge,c={template:e("./print.html"),data:function(){var e=this;return{state:null,button:{title:"Crea PDF","class":"btn-success",type:"stampa",disabled:!1,cbk:function(){e.print()}}}},methods:{exec:function(e){e()},btnEnabled:function(e){return e.disabled},isAnnullaButton:function(e){return"annulla"==e},onChangeTemplate:function(){this.$options.service.changeTemplate()},onChangeScale:function(){this.$options.service.changeScale()},onChangeDpi:function(){},onChangeRotation:function(e){this.state.rotation>=0&&!_.isNil(this.state.rotation)&&""!=this.state.rotation?(this.state.rotation=this.state.rotation>360?360:this.state.rotation,e.target.value=this.state.rotation):this.state.rotation<0?(this.state.rotation=this.state.rotation<-360?-360:this.state.rotation,e.target.value=this.state.rotation):this.state.rotation=0,this.$options.service.changeRotation()},print:function(){this.$options.service.print()}}};r(n,o),t.exports=n},{"./print.html":153,"core/utils/utils":77,"gui/print/printservice":152,"gui/vue/component":179}],155:[function(e,t,i){t.exports='<div id="pdf-output" style="height:100%">\n  <div v-show="state.loading" class="bar-loader"></div>\n  <iframe id="pdf" style="border:0px;width:100%;height:100%" :src="state.url"></iframe>\n</div>'},{}],156:[function(e,t,i){var n=e("core/utils/utils").inherit,r=e("core/utils/utils").base,o=e("gui/vue/component"),s=Vue.extend({template:e("./printpage.html"),data:function(){return{state:null}},mounted:function(){var e=this;this.state.loading=!0,this.$nextTick(function(){$("#pdf").load(function(){e.state.loading=!1})})}}),a=function(e){r(this);var e=e||{},t=e.service;this.setService(t);var i=new s;this.setInternalComponent(i),this.internalComponent.state=t.state};n(a,o),t.exports=a},{"./printpage.html":155,"core/utils/utils":77,"gui/vue/component":179}],157:[function(e,t,i){function n(e){this.state={},o(this)}var r=e("core/utils/utils").inherit,o=e("core/utils/utils").base,s=e("core/g3wobject");r(n,s),t.exports=n},{"core/g3wobject":30,"core/utils/utils":77}],158:[function(e,t,i){t.exports='<div id="photo" style="margin: 10px;">\n  <img :src="url" style="width: 100%;">\n</div>'},{}],159:[function(e,t,i){var n=e("core/utils/utils").inherit,r=e("core/utils/utils").base,o=e("gui/vue/component"),s=e("../photoservice"),a=Vue.extend({template:e("./photo.html"),data:function(){return{state:null,url:this.$options.url}}}),l=function(e){r(this);var e=e||{},t=e.service||new s({}),i=e.url||null;this.setService(t);var n=new a({service:t,url:i});this.setInternalComponent(n),this.internalComponent.state=t.state};n(l,o),t.exports=l},{"../photoservice":157,"./photo.html":158,"core/utils/utils":77,"gui/vue/component":179}],160:[function(e,t,i){function n(e){this.state={},this._project=s.getCurrentProject(),o(this),this.getRelations=function(e){var t=this._project.state.id;e=e||{};var i=e.value||null,n=e.id||null;return $.get("/qdjango/api/relations/"+t+"/"+n+"/"+i)},this.buildRelationTable=function(e){var t=_.keys(e[0]),i=[];return _.forEach(e,function(e){i.push(_.values(e))}),{columns:t,rows:i}}}var r=e("core/utils/utils").inherit,o=e("core/utils/utils").base,s=e("core/project/projectsregistry"),a=e("core/g3wobject");e("gui/gui");r(n,a),t.exports=n},{"core/g3wobject":30,"core/project/projectsregistry":71,"core/utils/utils":77,"gui/gui":129}],161:[function(e,t,i){t.exports='<div class="query-relation">\n  <div class="back-btn" @click="back">\n    <span class="back-link">\n      <span class="glyphicon glyphicon-chevron-left"></span>\n      Ritorna alle Relazioni\n    </span>\n  </div>\n  <div class="header">\n    <div>\n      Dati relativi alla relazione <b>{{ relation.name }}</b>\n    </div>\n  </div>\n  <div class="nano" v-if="table.rows.length">\n    <div class="nano-content">\n      <table class="table table-striped">\n        <thead>\n          <tr>\n            <th v-for="column in table.columns">{{ column }}</th>\n          </tr>\n        </thead>\n        <tbody>\n          <tr v-for="row in table.rows">\n            <td v-for="value in row">{{ value }}</td>\n          </tr>\n        </tbody>\n        </table>\n    </div>\n  </div>\n  <div v-else> Non ci sono relazioni </div>\n\n</div>\n'},{}],162:[function(e,t,i){t.exports='<div class="query-relations">\n  <div class="header">\n    <div>Elenco Relazioni della feature <span v-for="info in featureInfo()"><b>{{ info.key }}</b>: {{ info.value }} </span></div>\n  </div>\n  <div class="nano">\n    <div class="nano-content">\n      <table class="table table-bordered table-hover">\n        <thead>\n        </thead>\n        <tbody>\n          <tr @click="showRelation(relation)" v-for="relation in relations" style="cursor:pointer">\n            <td>\n              <span >{{ relation.name }}</span>\n              <span class="glyphicon glyphicon-chevron-right pull-right" aria-hidden="true"></span>\n            </td>\n          </tr>\n        </tbody>\n      </table>\n    </div>\n  </div>\n</div>\n'},{}],163:[function(e,t,i){t.exports='<div class="query-relations-page">\n    <component\n        :is="currentview"\n        :relations="relations"\n        :relation="relation"\n        :feature="feature"\n        :table="table">\n    </component>\n</div>'},{}],164:[function(e,t,i){var n=e("core/utils/utils").inherit,r=e("core/utils/utils").base,o=e("gui/vue/component"),s=e("../relationsservice"),a={template:e("./relations.html"),props:["relations","feature"],methods:{showRelation:function(e){this.$parent.showRelation(e)},featureInfo:function(){var e=[],t=0;return _.forEach(this.feature.attributes,function(i,n){return!(t>2)&&void(i&&_.isString(i)&&i.indexOf("/")==-1&&(e.push({key:n,value:i}),t+=1))}),e}}},l={template:e("./relation.html"),props:["table","relation"],methods:{back:function(){this.$parent.setRelationsList()}}},c=Vue.extend({template:e("./relationspage.html"),data:function(){return{state:null,table:null,relation:null,relations:this.$options.relations,feature:this.$options.feature,currentview:"relations"}},components:{relations:a,relation:l},methods:{showRelation:function(e){var t=this;this.relation=e;var i=e.fieldRef.referencedField,n=this.feature.attributes[i];this.$options.service.getRelations({id:e.id,value:n}).then(function(e){t.table=t.$options.service.buildRelationTable(e),t.currentview="relation",Vue.nextTick(function(){$(".nano").nanoScroller()})})},setRelationsList:function(){this.currentview="relations"}}}),u=function(e){r(this);var e=e||{},t=e.service||new s({}),i=e.relations||[],n=e.feature||null;this.setService(t);var o=new c({service:t,relations:i,feature:n});this.setInternalComponent(o),o.state=t.state};n(u,o),t.exports=u},{"../relationsservice":160,"./relation.html":161,"./relations.html":162,"./relationspage.html":163,"core/utils/utils":77,"gui/vue/component":179}],165:[function(e,t,i){function n(){var e=this;this._relations=s.getCurrentProject().state.relations?_.groupBy(s.getCurrentProject().state.relations,"referencedLayer"):null,this._actions={zoomto:n.zoomToElement,highlightgeometry:n.highlightGeometry,clearHighlightGeometry:n.clearHighlightGeometry},this.state={},this.init=function(e){this.clearState()},this._vectorLayers=[],this.setters={setQueryResponse:function(e,t,i){this.clearState(),this.state.query=e.query;var n=this._digestFeaturesForLayers(e.data);this.setLayersData(n)},setLayersData:function(e){this.state.loading=!1,this.state.layers=e,this.setActionsForLayers(e)},addActionsForLayers:function(e){},postRender:function(e){}},this.clearState=function(){this.state.layers=[],this.state.query={},this.state.querytitle="",this.state.loading=!0,this.state.layersactions={}},this.getState=function(){return this.state},this.setState=function(e){this.state=e},this.setTitle=function(e){this.state.querytitle=e||""},this.reset=function(){this.clearState()},this._digestFeaturesForLayers=function(e){var t,i,n,r,o=this,s=0,l=[];return _.forEach(e,function(e){e=e;var c=e.layer;c instanceof a?(t=c.getAttributes(),i=[],n=c.getTitle(),r=c.getId()):c instanceof ol.layer.Vector&&(t=c.getProperties(),i=[],n=c.get("name"),r=c.get("id"));var u={title:n,id:r,attributes:[],features:[],hasgeometry:!1,show:!0,expandable:!0,hasImageField:!1,relationsattributes:i,error:""};e.features&&e.features.length?(u.attributes=o._parseAttributes(t,e.features[0].getProperties()),_.forEach(u.attributes,function(e){"image"==e.type&&(u.hasImageField=!0)}),_.forEach(e.features,function(e){var t=e.getId()?e.getId():s,i=e.getGeometry();i&&(u.hasgeometry=!0);var n={id:t,attributes:e.getProperties(),geometry:e.getGeometry(),show:!0};u.features.push(n),s+=1}),l.push(u)):e.error&&(u.error=e.error,console.log(e.error))}),l},this._parseAttributes=function(e,t){var i=_.keys(t);if(i=_.filter(i,function(e){return["boundedBy","geom","the_geom","geometry","bbox","GEOMETRY"].indexOf(e)==-1}),e&&e.length){var i=_.keys(t);return _.filter(e,function(e){return i.indexOf(e.name)>-1})}return _.map(i,function(e){return{name:e,label:e}})},this.setActionsForLayers=function(e){var t=this;_.forEach(e,function(e){t.state.layersactions[e.id]||(t.state.layersactions[e.id]=[]),e.hasgeometry&&t.state.layersactions[e.id].push({id:"gotogeometry","class":"glyphicon glyphicon-map-marker",hint:"Visualizza sulla mappa",cbk:n.goToGeometry}),t._relations&&_.forEach(t._relations,function(i,r){return e.id==r&&t.state.layersactions[e.id].push({id:"show-query-relations","class":"fa fa-sitemap",hint:"Visualizza Relazioni",cbk:n.showQueryRelations,relations:i}),!1})}),this.addActionsForLayers(t.state.layersactions)},this.trigger=function(t,i,n){var r=this._actions[t];if(r&&r(i,n),i){var o=e.state.layersactions[i.id];if(o){var s;_.forEach(o,function(e){e.id==t&&(s=e)}),s&&this.triggerLayerAction(s,i,n)}}},this.triggerLayerAction=function(e,t,i){if(e.cbk&&e.cbk(t,i,e),e.route){var n,r=e.route;n=r.replace(/{(\w*)}/g,function(e,t){return i.attributes.hasOwnProperty(t)?i.attributes[t]:""}),n&&""!=n&&l["goto"](n)}},this.showFullPhoto=function(e){l.pushContent({content:new d({url:e}),backonclose:!0,closable:!1})},this.registerVectorLayer=function(e){this._vectorLayers.indexOf(e)==-1&&(e.state={},e.state.title=e.name,e.state.id=e.id,this._vectorLayers.push(e))},this.unregisterVectorLayer=function(e){var t=this._vectorLayers.indexOf(e);t!=-1&&this._vectorLayers.splice(t,1)},this._addVectorLayersDataToQueryResponse=function(){var e=this;this.onbefore("setQueryResponse",function(t,i,n){var r=h.getComponent("map").getService(),o=!1;_.forEach(e._vectorLayers,function(e){var n,s,a=[];switch(e.constructor){case u:o=!e.isVisible();break;case ol.layer.Vector:o=!e.getVisible()}if(t.data&&t.data.length&&t.data[0].layer==e||!i||o)return!0;if(_.isArray(i)){if(2==i.length){var l=r.viewer.map.getPixelFromCoordinate(i);n=r.viewer.map.forEachFeatureAtPixel(l,function(e,t){return e},{layerFilter:function(t){return t===e}}),n&&(p.convertG3wRelations(n),a.push(n))}else if(4==i.length)switch(s=ol.geom.Polygon.fromExtent(i),e.constructor){case u:a=e.getIntersectedFeatures(s);break;case ol.layer.Vector:_.forEach(e.getSource().getFeatures(),function(e){s.intersectsExtent(e.getGeometry().getExtent())&&a.push(e)})}}else if(i instanceof ol.geom.Polygon||i instanceof ol.geom.MultiPolygon)switch(s=i,e.constructor){case u:a=e.getIntersectedFeatures(s);break;case ol.layer.Vector:_.forEach(e.getSource().getFeatures(),function(e){s.intersectsExtent(e.getGeometry().getExtent())&&a.push(e)})}_.forEach(a,function(e){p.convertG3wRelations(e)}),t.data=t.data?t.data:[],t.data.push({features:a,layer:e})})})},o(this),this._addVectorLayersDataToQueryResponse()}var r=e("core/utils/utils").inherit,o=e("core/utils/utils").base,s=e("core/project/projectsregistry"),a=e("core/layers/layer"),l=e("gui/gui"),c=e("core/g3wobject"),u=e("core/map/layer/vectorlayer"),h=e("gui/componentsregistry"),p=e("core/query/queryservice"),d=e("./components/photo/vue/photo"),f=e("./components/relations/vue/relationspage");n.zoomToElement=function(e,t){},n.goToGeometry=function(e,t){if(t.geometry){var i=h.getComponent("map").getService();i.highlightGeometry(t.geometry,{duration:4e3})}},n.highlightGeometry=function(e,t){if(t.geometry){var i=h.getComponent("map").getService();i.highlightGeometry(t.geometry,{zoom:!1})}},n.clearHighlightGeometry=function(e,t){var i=h.getComponent("map").getService();i.clearHighlightGeometry()},n.showQueryRelations=function(e,t,i){l.pushContent({content:new f({relations:i.relations,feature:t}),backonclose:!0,closable:!1})},r(n,c),t.exports=n},{"./components/photo/vue/photo":159,"./components/relations/vue/relationspage":164,"core/g3wobject":30,"core/layers/layer":41,"core/map/layer/vectorlayer":60,"core/project/projectsregistry":71,"core/query/queryservice":72,"core/utils/utils":77,"gui/componentsregistry":119,"gui/gui":129}],166:[function(e,t,i){t.exports='<div id="search-results" class="queryresults-wrapper">\n  <h3 v-if="state.querytitle">Risultati {{state.querytitle.toLowerCase()}}</h3>\n  <div v-show="state.loading" class="bar-loader"></div>\n  <div class="queryresults-container">\n    <ul v-if="hasResults()" class="queryresults" id="queryresults">\n      <li v-if="layerHasFeatures(layer) && layer.show" v-for="layer in state.layers">\n        <div class="box box-primary">\n          <div class="box-header with-border" data-widget="collapse">\n            <h3 class="box-title">{{ layer.title }} ({{layer.features.length}})</h3>\n            <div class="box-tools pull-right">\n              <button class="btn btn-box-tool" data-widget="collapse"><i class="btn-collapser fa fa-minus"></i></button>\n            </div>\n          </div>\n          <div class="box-body">\n            <table class="table table-striped">\n              <thead>\n              <tr>\n                <th v-if="layer.hasgeometry"></th>\n                <th v-for="(attribute, index) in attributesSubset(layer.attributes)" :style="{ width:cellWidth(index,layer) + \'%\' }">{{attribute.label}}</th>\n                <th :style="{ width:headerExpandActionCellWidth + \'%\' }"></th>\n              </tr>\n              </thead>\n              <tbody>\n              <template v-if="feature.show" v-for="feature in layer.features">\n                <tr @click="toggleFeatureBoxAndZoom(layer,feature);" @mouseover="trigger(\'highlightgeometry\',layer,feature)" @mouseout="trigger(\'clearHighlightGeometry\')" class="featurebox-header">\n                  <td v-if="geometryAvailable(feature)" class="action-cell">\n                    <span @click.stop.prevent="trigger(\'gotogeometry\',layer,feature)" class="glyphicon glyphicon-map-marker action-button-icon"></span>\n                  </td>\n                  <td v-for="attribute in attributesSubset(layer.attributes)">\n                    <span>{{feature.attributes[attribute.name]}}</span>\n                  </td>\n                  <td class="action-cell">\n                    <span class="fa link morelink" :class="[collapsedFeatureBox(layer,feature) ? \'fa-plus\' : \'fa-minus\']"></span>\n                  </td>\n                </tr>\n                <tr v-show="!collapsedFeatureBox(layer,feature)" class="featurebox-body">\n                  <td :colspan="attributesSubsetLength(layer.attributes)+2">\n                    <div class="action-buttons-container">\n                      <template v-for="action in state.layersactions[layer.id]">\n                        <div @click="trigger(action.id,layer,feature)"  class="action-button hint--top-right" data-placement="auto bottom" data-toggle="tooltip" :title="action.hint">\n                          <span :class="\'action-button-icon \' + action.class"></span>\n                        </div>\n                      </template>\n                    </div>\n                    <table>\n                      <tr v-for="attribute in layer.attributes">\n                        <td class="attr-label">{{attribute.label}}</td>\n                        <!--<td class="attr-value">{{feature.attributes[attribute.name]}}</td>-->\n                        <td class="attr-value">\n                          <span v-if="is(\'simple\',layer,attribute.name,feature.attributes[attribute.name])">{{feature.attributes[attribute.name]}}</span>\n                          <img v-if="is(\'photo\',layer,attribute.name,feature.attributes[attribute.name])"  class="photo-preview img-responsive img-thumbnail" title="Clicca per allargare"  @click="showFullPhoto(isRelativePath(feature.attributes[attribute.name]))" :src="isRelativePath(feature.attributes[attribute.name])">\n                          <!--<span v-if="isRoute(layer,feature,attribute)" class="link dashboardlink" @click="goto(layer,feature.attributes[attribute.name])">{{ feature.attributes[attribute.name] }}</span>-->\n                          <!--<img v-if="isPhoto(layer,feature,attribute)" :data-url="getPhotoUrl(feature.attributes[attribute.name])" style="max-width:50px" :src="getPhotoUrl(feature.attributes[attribute.name],thumb)" />-->\n                          <img v-else-if="checkField(\'image\', attribute.label, layer.attributes)"  class="photo-preview img-responsive img-thumbnail" title="Clicca per allargare"  @click="showFullPhoto(isRelativePath(attribute.value))" :src="isRelativePath(attribute.value)">\n                          <a v-if="is(\'link\',layer,attribute.name,feature.attributes[attribute.name])" :href="feature.attributes[attribute.name]" target="_blank" class="glyphicon glyphicon-link"></a>\n                        </td>\n                      </tr>\n                    </table>\n                  </td>\n                </tr>\n                <tr v-show="collapsedFeatureBox(layer,feature) && feature.attributes.relations">\n                  <td :colspan="attributesSubsetLength(layer.attributes)+2">\n                    <!--Relazioni-->\n                    <div class="queryresults-container">\n                      <ul class="queryresults" id="relations">\n                        <template v-for="relation in feature.attributes.relations">\n                          <li>\n                            <div class="box box-solid box-default relationsbox collapsed-box">\n                              <div class="box-header with-border" data-widget="collapse">\n                                <h3 class="box-title">{{ relation.name }} ({{ relation.elements.length }})</h3>\n                                <div class="box-tools pull-right">\n                                  <button class="btn btn-box-tool" data-widget="collapse"><i class="btn-collapser fa fa-plus"></i></button>\n                                </div>\n                              </div>\n                              <div class="box-body">\n                                <template v-for="(element, index) in relation.elements">\n                                  <table class="table table-striped">\n                                    <thead>\n                                    <tr>\n                                      <th v-for="attribute in relationsAttributesSubset(element)">\n                                        {{attribute.label}}\n                                      </th>\n                                      <th></th>\n                                    </tr>\n                                    </thead>\n                                    <tbody>\n                                    <tr @click="toggleFeatureBox(layer, feature, relation.name+index)"  class="featurebox-header">\n                                      <td v-for="attribute in relationsAttributesSubset(element)">\n                                        <span>{{attribute.value}}</span>\n                                      </td>\n                                      <td class="action-cell text-center">\n                                        <span class="fa link morelink" :class="[collapsedFeatureBox(layer, feature, relation.name+index) ? \'fa-minus\' : \'fa-plus\']" style="text-align: right"></span>\n                                      </td>\n                                    </tr>\n                                    <tr v-show="collapsedFeatureBox(layer, feature, relation.name+index)" class="featurebox-body">\n                                      <td :colspan="relationsAttributesSubsetLength(element)+1">\n                                        <table>\n                                          <tr v-for="relattribute in relationsAttributes(element)">\n                                            <td class="attr-label">{{relattribute.label}}</td>\n                                            <!--<td class="attr-value">{{attribute.value}}</td>-->\n                                            <td class="attr-value">\n                                              <div v-if="isArray(relattribute.value)" v-for="value in relattribute.value">\n                                                <div v-for="value, label in value">\n                                                  <span>{{ label }}</span><span class="pull-right">{{ value }}</span>\n                                                </div>\n                                                <span class="divider"></span>\n                                              </div>\n                                              <span v-if="isSimple(layer,relattribute.name, relattribute.value)">{{relattribute.value}}</span>\n                                              <!--<img v-if="is(\'photo\',layer,relattribute.name,feature.attributes[attribute.name])"  class="photo-preview img-responsive img-thumbnail" title="Clicca per allargare"  @click="showFullPhoto(isRelativePath(feature.attributes[attribute.name]))" :src="isRelativePath(feature.attributes[attribute.name])">-->\n                                              <!--<img v-if="relattribute.label == \'image\'"  class="photo-preview img-responsive img-thumbnail" title="Clicca per allargare"  @click="showFullPhoto(isRelativePath(relattribute.value))" :src="isRelativePath(relattribute.value)">-->\n                                              <img v-else-if="checkField(\'image\', relattribute.label, layer.relationsattributes[relation.name])"  class="photo-preview img-responsive img-thumbnail" title="Clicca per allargare"  @click="showFullPhoto(isRelativePath(relattribute.value))" :src="isRelativePath(relattribute.value)">\n                                              <img v-else-if="is(\'photo\',layer, relattribute.name, relattribute.value)"  class="photo-preview img-responsive img-thumbnail" title="Clicca per allargare"  @click="showFullPhoto(isRelativePath(relattribute.value))" :src="isRelativePath(relattribute.value)">\n                                              <!--&lt;!&ndash;<span v-if="isRoute(layer,feature,attribute)" class="link dashboardlink" @click="goto(layer,feature.attributes[attribute.name])">{{ feature.attributes[attribute.name] }}</span>&ndash;&gt;-->\n                                              <!--<img v-if="isPhoto(layer,feature,attribute)" v-bind:data-url="getPhotoUrl(feature.attributes[attribute.name])" style="max-width:50px" :src="getPhotoUrl(feature.attributes[attribute.name],thumb)" />-->\n                                              <a v-if="isLink(layer,relattribute.name, relattribute.value)" :href="relattribute.value" target="_blank" class="glyphicon glyphicon-link"></a>\n                                            </td>\n                                          </tr>\n                                        </table>\n                                      </td>\n                                    </tr>\n                                    </tbody>\n                                  </table>\n                                </template>\n                              </div>\n                            </div>\n                          </li>\n                        </template>\n                      </ul>\n                    </div>\n                    <!--Fine Relazioni-->\n                  </td>\n                </tr>\n              </template>\n              </tbody>\n            </table>\n          </div>\n        </div>\n      </li>\n    </ul>\n  </div>\n  <span v-if="!hasResults() && !state.loading">Nessun risultato</span>\n</div>\n\n';
},{}],167:[function(e,t,i){function n(e,t,i){var n=/^(https?:\/\/[^\s]+)/g,r=/[^\s]+.(png|jpg|jpeg)$/g;if(_.isNil(i))return Fields.SIMPLE;i=i.toString();i.split(".").pop();return i.match(r)?Fields.PHOTO:i.match(n)?Fields.LINK:Fields.SIMPLE}function r(e,t,i,r){var o=n(t,i,r);return o===e}function o(e){a(this,e);var t=this;this.id="queryresults",this.title="Query Results",this._service=new u,this.setInternalComponent=function(){this.internalComponent=new m({queryResultsService:this._service}),this.createLayersFeaturesBoxes(),this.internalComponent.querytitle=this._service.state.querytitle},this.getElement=function(){if(this.internalComponent)return this.internalComponent.$el},this._service.onafter("setLayersData",function(){t.internalComponent||t.setInternalComponent(),t.createLayersFeaturesBoxes()}),l(this,e),this.createLayersFeaturesBoxes=function(){var e={},t=this._service.state.layers;_.forEach(t,function(t){t.attributes.length<=p&&!t.hasImageField&&(t.expandable=!1),_.forEach(t.features,function(i,n){var r=!0,o=t.id+"_"+i.id;e[o]={collapsed:r},i.attributes.relations&&(o="",_.forEach(i.attributes.relations,function(n){o=t.id+"_"+i.id+"_"+n.name,_.forEach(n.elements,function(t,i){e[o+i]={collapsed:!0}})}))})}),this.internalComponent.layersFeaturesBoxes=e},this.layout=function(e,t){}}var s=e("core/utils/utils").inherit,a=e("core/utils/utils").base,l=e("core/utils/utils").merge,c=e("gui/vue/component"),u=e("gui/queryresults/queryresultsservice"),h=e("core/project/projectsregistry");Fields={},Fields.SIMPLE="simple",Fields.LINK="link",Fields.PHOTO="photo",Fields.IMAGE="image",Fields.POINTLINK="pointlink",Fields.ROUTE="route";var p=3,d=10,f=10,g={template:e("./queryresults.html"),data:function(){return{state:this.$options.queryResultsService.state,layersFeaturesBoxes:{},headerExpandActionCellWidth:d,headerActionsCellWidth:f}},methods:{isArray:function(e){return _.isArray(e)},isSimple:function(e,t,i){return!this.isArray(i)&&r(Fields.SIMPLE,e,t,i)},isLink:function(e,t,i){return r(Fields.LINK,e,t,i)},is:function(e,t,i,n){return r(e,t,i,n)},checkField:function(e,t,i){var n=!1;return _.forEach(i,function(i){i.name==t&&(n=i.type==e)}),n},isRelativePath:function(e){return _.startsWith(e,"/")?e:h.getConfig().mediaurl+e},layerHasFeatures:function(e){return!!e.features&&e.features.length>0},hasResults:function(){return this.state.layers.length},layerHasActions:function(e){return this.state.layersactions[e.id].length>0},featureHasActions:function(e,t){return this.geometryAvailable(t)},geometryAvailable:function(e){return!!e.geometry},attributesSubset:function(e){var e=_.filter(e,function(e){return"image"!=e.type}),t=Math.min(p,e.length);return e.slice(0,t)},relationsAttributesSubset:function(e){var t=[];_.forEach(e,function(e,i){_.isArray(e)||t.push({label:i,value:e})});var i=Math.min(p,t.length);return t.slice(0,i)},relationsAttributes:function(e){var t=[];return _.forEach(e,function(e,i){t.push({label:i,value:e})}),t},attributesSubsetLength:function(e){return this.attributesSubset(e).length},cellWidth:function(e,t){var i=this.attributesSubsetLength(t.attributes),n=p-i;actionsCellWidth=t.hasgeometry?f:0;var r=100-d-actionsCellWidth,o=r/p;return e==i-1&&n>0?o*(n+1):o},featureBoxColspan:function(e){var t=this.attributesSubsetLength(e.attributes);return e.expandable&&(t+=1),e.hasgeometry&&(t+=1),t},relationsAttributesSubsetLength:function(e){return this.relationsAttributesSubset(e).length},collapsedFeatureBox:function(e,t,i){var n,r=!0;return n=_.isNil(i)?e.id+"_"+t.id:e.id+"_"+t.id+"_"+i,this.layersFeaturesBoxes[n]&&(r=this.layersFeaturesBoxes[n].collapsed),r},toggleFeatureBox:function(e,t,i){var n;n=_.isNil(i)?e.id+"_"+t.id:e.id+"_"+t.id+"_"+i,this.layersFeaturesBoxes[n].collapsed=!this.layersFeaturesBoxes[n].collapsed},toggleFeatureBoxAndZoom:function(e,t,i){this.toggleFeatureBox(e,t,i)},trigger:function(e,t,i){this.$options.queryResultsService.trigger(e,t,i)},showFullPhoto:function(e){this.$options.queryResultsService.showFullPhoto(e)}},watch:{"state.layers":function(e){var t=this;e.length&&this.$nextTick(function(){t.$options.queryResultsService.postRender(t.$el)})}},mounted:function(){Vue.nextTick(function(){$('[data-toggle="tooltip"]').tooltip()})}},m=Vue.extend(g);s(o,c),t.exports=o},{"./queryresults.html":166,"core/project/projectsregistry":71,"core/utils/utils":77,"gui/queryresults/queryresultsservice":165,"gui/vue/component":179}],168:[function(e,t,i){function n(){this.init=function(e){var t=e||s.getCurrentProject().state.search;this.state.searches=t},this.state={searches:[]},this.showSearchPanel=function(e){var t=new l;return t.init(e),o.showPanel(t),t},this.cleanSearchPanels=function(){this.state.panels={}},this.stop=function(){var e=$.Deferred();return e.resolve(),e.promise()},this.reload=function(){var e=s.getCurrentProject().state.search;Vue.set(this.state,"searches",e)}}var r=e("core/utils/utils").inherit,o=e("gui/gui"),s=e("core/project/projectsregistry"),a=e("core/g3wobject"),l=e("gui/search/vue/panel/searchpanel");r(n,a),t.exports=n},{"core/g3wobject":30,"core/project/projectsregistry":71,"core/utils/utils":77,"gui/gui":129,"gui/search/vue/panel/searchpanel":170}],169:[function(e,t,i){t.exports='<div class="g3w-search-panel form-group">\n  <h4><b>{{ title }}</b></h4>\n  <form id="g3w-search-form">\n    <template v-for="(forminput, index) in forminputs">\n      <div v-if="forminput.input.type == \'numberfield\'" class="form-group numeric">\n        <label :for="forminput.id + \' \'">{{ forminput.label }}</label>\n        <input type="number" v-model="formInputValues[index].value" class="form-control" :id="forminput.id">\n      </div>\n      <div v-if="forminput.input.type == \'textfield\' || forminput.input.type == \'textField\'" class="form-group text">\n        <label :for="forminput.id">{{ forminput.label }}</label>\n        <input type="text" v-model="formInputValues[index].value" class="form-control" :id="forminput.id">\n      </div>\n    </template>\n    <div class="form-group">\n      <button style="background-color:#3c8dbc" class="btn btn-block pull-right" @click="doSearch($event)" data-i18n="dosearch">Search</button>\n    </div>\n  </form>\n</div>\n'},{}],170:[function(e,t,i){function n(e){self=this;var e=e||{};this.config={},this.filter={},this.id=null,this.querylayerid=null,this.internalPanel=e.internalPanel||new u,this.init=function(e){this.config=e||{},this.name=this.config.name||this.name,this.id=this.config.id||this.id,this.filter=this.config.options.filter||this.filter,this.internalPanel.queryurl=this.config.options.queryurl||null;var t=this.config.options.querylayerid||this.querylayerid;this.queryLayer=a.getCurrentProject().getLayersStore().getLayerById(t),this.fillInputsFormFromFilter();var i=this.createQueryFilterFromConfig(this.filter);this.internalPanel.filterObject=this.createQueryFilterObject({queryLayer:this.queryLayer,filter:i}),this.internalPanel.filterObject=this.internalPanel.filterObject,this.internalPanel.queryLayer=this.queryLayer,this.internalPanel.fillFilterInputsWithValues=this.fillFilterInputsWithValues,this.internalPanel.title=this.name},this.fillInputsFormFromFilter=function(){var e,t=0;_.forEach(this.filter,function(i,n,r){_.forEach(i,function(i){e={},i.id=t,e.type=i.input.type,e.value=null,self.internalPanel.formInputValues.push(e),self.internalPanel.forminputs.push(i),t+=1})})},this.fillFilterInputsWithValues=function(e,t,i){function n(e,t){switch(e){case"numberfield":t=parseInt(t)}return t}return _.forEach(e.filter,function(e,r){_.forEach(e,function(e,r){_.forEach(e,function(o,s,a){_.isArray(o)?fillFilterInputsWithValues(e,t,r):_.forEach(o,function(e,o,s){index=i?i+r:r,s[o]=n(t[index].type,t[index].value)})})})}),e},this.createQueryFilterFromConfig=function(e){function t(e){return evalObject={},_.forEach(e,function(e,t){if(_.isArray(e))return i(t,e)}),r=e.attribute,n=e.op,evalObject[n]={},evalObject[n][r]=null,evalObject}function i(e,i){return s={},s[e]=[],_.forEach(i,function(i){s[e].push(t(i))}),s}var n,r,o={},s={};return _.forEach(e,function(e,t,n){o=i(t,e)}),o},this.createQueryFilterObject=function(e){var t,e=e||{},i=e.queryLayer||[],n=e.ogcService||"wms",r=e.filter||{},o=this.getInfoFromLayer(i,n);return t=_.merge(o,{ogcService:n,filter:r})},this.getInfoFromLayer=function(e,t){var i={};if("wfs"==t)var n=e.getProject().getWmsUrl();else var n=e.getQueryUrl();return urlsForLayer={url:n,layers:[],infoFormat:e.getInfoFormat(t),crs:e.getCrs(),serverType:e.getServerType()},i}}var r=e("core/utils/utils").inherit,o=(e("core/i18n/i18n.service").t,e("core/utils/utils").resolve,e("gui/gui")),s=(e("core/query/queryservice"),e("gui/listpanel").ListPanel,e("gui/panel")),a=e("core/project/projectsregistry"),l=e("core/layers/filter/filter"),c=e("core/layers/filter/expression"),u=Vue.extend({template:e("./searchpanel.html"),data:function(){return{title:"",forminputs:[],filterObject:{},formInputValues:[],queryurl:null}},methods:{doSearch:function(e){var t=this;e.preventDefault(),this.filterObject=this.fillFilterInputsWithValues(this.filterObject,this.formInputValues),this.queryurl&&(this.filterObject.url=this.queryurl);var i=o.showContentFactory("query"),n=i(t.title),r=new l,s=new c;s.createExpressionFromFilter(this.filterObject.filter,this.queryLayer.getName()),r.setExpression(s.get()),this.queryLayer.search({filter:r}).then(function(e){n.setQueryResponse(e)}).fail(function(){o.notify.error("Si è verificato un errore nella richiesta al server"),o.closeContent()})}}});r(n,s),t.exports=n},{"./searchpanel.html":169,"core/i18n/i18n.service":33,"core/layers/filter/expression":37,"core/layers/filter/filter":38,"core/project/projectsregistry":71,"core/query/queryservice":72,"core/utils/utils":77,"gui/gui":129,"gui/listpanel":143,"gui/panel":150}],171:[function(e,t,i){t.exports='<ul id="g3w-search" class="treeview-menu g3w-search g3w-tools menu-items">\n  <li v-for="search in state.searches" class="menu-item" @click="showSearchPanel(search)">\n    <i class="fa fa-circle-o"></i>\n    <span>{{ search.name }}</span>\n  </li>\n</ul>\n'},{}],172:[function(e,t,i){function n(e){o(this,e),this.id="search-component",this.title="search",this._service=new c,this.internalComponent=new h({searchesService:this._service}),this.internalComponent.state=this._service.state,this.state.visible=l.getCurrentProject().state.search.length>0,s(this,e),this.initService=function(){this._service.init()},this._reload=function(){this.state.visible=l.getCurrentProject().state.search.length>0,this._service.reload()}}var r=e("core/utils/utils").inherit,o=e("core/utils/utils").base,s=e("core/utils/utils").merge,a=e("gui/vue/component"),l=e("core/project/projectsregistry"),c=e("gui/search/searchesservice"),u={template:e("./search.html"),data:function(){return{state:null}},methods:{showSearchPanel:function(e){this.$options.searchesService.showSearchPanel(e)}}},h=Vue.extend(u);r(n,a),t.exports=n},{"./search.html":171,"core/project/projectsregistry":71,"core/utils/utils":77,"gui/search/searchesservice":168,"gui/vue/component":179}],173:[function(e,t,i){function n(){this._position=null,this.setters={postRender:function(e){}},this.getPosition=function(){return this._position},this.showStreetView=function(e){this._position=e,a.setContent({content:new l({service:this}),title:"StreetView"})},o(this)}var r=e("core/utils/utils").inherit,o=e("core/utils/utils").base,s=e("core/g3wobject"),a=e("gui/gui"),l=e("gui/streetview/vue/streetview");r(n,s),t.exports=n},{"core/g3wobject":30,"core/utils/utils":77,"gui/gui":129,"gui/streetview/vue/streetview":175}],174:[function(e,t,i){t.exports='<div id="streetview"></div>'},{}],175:[function(e,t,i){var n=e("core/utils/utils").inherit,r=e("core/utils/utils").base,o=e("gui/vue/component"),s=Vue.extend({template:e("./streetview.html"),data:function(){return{state:null}},mounted:function(){var e=this;this.$nextTick(function(){var t=e.$options.service.getPosition();e.$options.service.postRender(t)})}}),a=function(e){r(this);var e=e||{},t=e.service;this.setService(t);var i=new s({service:t});this.setInternalComponent(i),this.unmount=function(){return r(this,"unmount")}};n(a,o),t.exports=a},{"./streetview.html":174,"core/utils/utils":77,"gui/vue/component":179}],176:[function(e,t,i){function n(){var e=this;this.config=null,this._actions={},this.state={toolsGroups:[]},this.setters={addTools:function(t,i,n){e._addTools(t,i,n)},addToolGroup:function(t,i){e.state.toolsGroups.splice(t,0,i)},removeTools:function(){e._removeTools()}},this._addTools=function(e,t,i){var n=this,r=this._getToolsGroup(t);r||(r={name:t,tools:[]},this.addToolGroup(e,r)),_.forEach(i,function(e){r.tools.push(e),n._addAction(e)})},this._removeTool=function(e){this.state.toolsGroups=this.state.toolsGroups.splice(e,1)},this._removeTools=function(){var e=this;_.forEach(this.state.toolsGroups,function(t,i){e.state.toolsGroups.splice(0,1)})},this.updateToolsGroup=function(e,t){Vue.set(this.state.toolsGroups,e,t)},this.getState=function(){return this.state},this.fireAction=function(e){var t=this._actions[e];t()},this._getToolsGroup=function(e){var t=null;return _.forEach(this.state.toolsGroups,function(i){i.name==e&&(t=i)}),t},this._addAction=function(e){var t=Math.floor(1e6*Math.random())+1;e.actionId=t,this._actions[t]=e.action},o(this)}var r=e("core/utils/utils").inherit,o=e("core/utils/utils").base,s=e("core/g3wobject");r(n,s),t.exports=n},{"core/g3wobject":30,"core/utils/utils":77}],177:[function(e,t,i){t.exports='<ul class="g3w-tools treeview-menu">\n  <li v-for="group in state.toolsGroups">\n    <div class="tool-header">\n      <i class="fa fa-gear"></i>\n      <span style="">{{ group.name }}</span>\n    </div>\n    <div :id="group.name + \'-tools\'" class="tool-box">\n      <template v-for="tool in group.tools">\n        <div v-if="tool.type == \'checkbox\' " class="checkbox">\n          <label>\n            <input style="cursor:pointer" :id="tool.layerName" v-model="tool.isCheck" type="checkbox" :value="tool.layerName" @click="fireAction(tool.actionId)">{{ tool.name }}\n          </label>\n        </div>\n        <div v-else class="tool" @click="fireAction(tool.actionId)">\n          <i class="fa fa-caret-right"></i>\n          <span >{{ tool.name }}</span>\n        </div>\n      </template>\n    </div>\n  </li>\n</ul>\n\n'},{}],178:[function(e,t,i){function n(e){o(this,e);var t=this;this._service=new l,this.id="tools-component",this.title="tools",this.state.visible=!1,this._service.onafter("addTools",function(){t.state.visible=t._service.state.toolsGroups.length>0}),this._service.onafter("removeTools",function(){t.state.visible=t._service.state.toolsGroups.length>0}),s(this,e),this.internalComponent=new c({toolsService:this._service}),this.internalComponent.state=this._service.state}var r=(e("core/i18n/i18n.service").t,e("core/utils/utils").inherit),o=e("core/utils/utils").base,s=e("core/utils/utils").merge,a=e("gui/vue/component"),l=e("gui/tools/toolsservice"),c=Vue.extend({template:e("./tools.html"),data:function(){return{state:null}},methods:{fireAction:function(e){this.$options.toolsService.fireAction(e)}}});r(n,a);n.prototype;t.exports=n},{"./tools.html":177,"core/i18n/i18n.service":33,"core/utils/utils":77,"gui/tools/toolsservice":176,"gui/vue/component":179}],179:[function(e,t,i){var n=e("core/utils/utils").inherit,r=e("core/utils/utils").base,o=e("core/utils/utils").resolve,s=e("gui/component"),a=function(e){r(this,e)};n(a,s);var l=a.prototype;l.mount=function(e,t){var i=$.Deferred();if(this.internalComponent||this.setInternalComponent(),t){var n=this.internalComponent.$mount();$(e).append(n.$el)}else this.internalComponent.$mount(e);return Vue.nextTick(function(){$(e).localize(),i.resolve(!0)}),i.promise()},l.unmount=function(){if(_.isNil(this.internalComponent)){return o()}return this.internalComponent.$destroy(!0),$(this.internalComponent.$el).remove(),this.internalComponent=null,o()},l.ismount=function(){return this.internalComponent&&this.internalComponent.$el},l.layout=function(e,t){this.internalComponent},t.exports=a},{"core/utils/utils":77,"gui/component":118}],180:[function(e,t,i){var n=e("core/i18n/i18n.service").t;Vue.directive("disabled",function(e,t){t.value?e.setAttribute("disabled","disabled"):e.removeAttribute("disabled")}),Vue.directive("checked",function(e,t){t.value?e.setAttribute("checked","checked"):e.removeAttribute("checked")}),Vue.directive("selected-first",function(e,t){0==t.value?e.setAttribute("selected",""):e.removeAttribute("selected")}),Vue.directive("t",function(e,t){return n(t.value)})},{"core/i18n/i18n.service":33}],181:[function(e,t,i){var n=n||{};n.core={G3WObject:e("core/g3wobject"),utils:e("core/utils/utils"),ApplicationService:e("core/applicationservice"),ApiService:e("core/apiservice"),Router:e("core/router"),i18n:e("core/i18n/i18n.service"),editing:{Session:e("core/editing/session"),Editor:e("core/editing/editor"),ChangesManager:e("core/editing/changesmanager")},geometry:{Geom:e("core/geometry/geom"),Geometry:e("core/geometry/geometry")},project:{ProjectsRegistry:e("core/project/projectsregistry"),Project:e("core/project/project")},map:{MapLayersStoreRegistry:e("core/map/maplayersstoresregistry"),layer:{WmsLayer:e("core/map/layer/wmslayer"),VectorLayerLoader:e("core/map/layer/loader/vectorloaderlayer")}},catalog:{CatalogLayersStoresRegistry:e("core/catalog/cataloglayersstoresregistry")},layer:{LayersStoreRegistry:e("core/layers/layersstoresregistry"),LayersStore:e("core/layers/layersstore"),Layer:e("core/layers/layer"),LayerFactory:e("core/layers/layerfactory"),TableLayer:e("core/layers/tablelayer"),VectorLayer:e("core/layers/vectorlayer"),ImageLayer:e("core/layers/imagelayer"),geometry:{Geometry:e("core/geometry/geometry"),geom:e("core/geometry/geom")},features:{Feature:e("core/layers/features/feature"),FeaturesStore:e("core/layers/features/featuresstore"),OlFeaturesStore:e("core/layers/features/olfeaturesstore")},MapLayer:e("core/map/layer/maplayer")},query:{QueryService:e("core/query/queryservice")},interaction:{PickCoordinatesInteraction:e("g3w-ol3/src/interactions/pickcoordinatesinteraction"),PickFeatureInteraction:e("g3w-ol3/src/interactions/pickfeatureinteraction")},plugin:{Plugin:e("core/plugin/plugin"),PluginsRegistry:e("core/plugin/pluginsregistry"),PluginService:e("core/plugin/pluginservice")},workflow:{Task:e("core/workflow/task"),Step:e("core/workflow/step"),Flow:e("core/workflow/flow"),Workflow:e("core/workflow/workflow"),WorkflowsStack:e("core/workflow/workflowsstack")}},n.gui={GUI:e("gui/gui"),Panel:e("gui/panel"),ControlFactory:e("gui/map/control/factory"),vue:{Component:e("gui/vue/component"),SearchComponent:e("gui/search/vue/search"),SearchPanel:e("gui/search/vue/panel/searchpanel"),PrintComponent:e("gui/print/vue/print"),CatalogComponent:e("gui/catalog/vue/catalog"),MapComponent:e("gui/map/vue/map"),ToolsComponent:e("gui/tools/vue/tools"),QueryResultsComponent:e("gui/queryresults/vue/queryresults"),FormComponent:e("gui/form/vue/form"),FormComponents:{Body:e("gui/form/components/body/vue/body"),Footer:e("gui/form/components/footer/vue/footer")},inputs:{InputsComponents:e("gui/inputs/inputs")}}},n.ol3={interactions:{PickFeatureInteraction:e("g3w-ol3/src/interactions/pickfeatureinteraction"),PickCoordsInteraction:e("g3w-ol3/src/interactions/pickcoordinatesinteraction"),DeleteFeatureInteraction:e("g3w-ol3/src/interactions/deletefeatureinteraction")},controls:{}},t.exports={core:n.core,gui:n.gui,ol3:n.ol3}},{"core/apiservice":21,"core/applicationservice":22,"core/catalog/cataloglayersstoresregistry":23,"core/editing/changesmanager":25,"core/editing/editor":26,"core/editing/session":28,"core/g3wobject":30,"core/geometry/geom":31,"core/geometry/geometry":32,"core/i18n/i18n.service":33,"core/layers/features/feature":34,"core/layers/features/featuresstore":35,"core/layers/features/olfeaturesstore":36,"core/layers/imagelayer":40,"core/layers/layer":41,"core/layers/layerfactory":42,"core/layers/layersstore":43,"core/layers/layersstoresregistry":44,"core/layers/tablelayer":53,"core/layers/vectorlayer":54,"core/map/layer/loader/vectorloaderlayer":57,"core/map/layer/maplayer":58,"core/map/layer/wmslayer":61,"core/map/maplayersstoresregistry":63,"core/plugin/plugin":64,"core/plugin/pluginservice":65,"core/plugin/pluginsregistry":66,"core/project/project":70,"core/project/projectsregistry":71,"core/query/queryservice":72,"core/router":75,"core/utils/utils":77,"core/workflow/flow":78,"core/workflow/step":79,"core/workflow/task":80,"core/workflow/workflow":81,"core/workflow/workflowsstack":82,"g3w-ol3/src/interactions/deletefeatureinteraction":100,"g3w-ol3/src/interactions/pickcoordinatesinteraction":103,"g3w-ol3/src/interactions/pickfeatureinteraction":104,"gui/catalog/vue/catalog":114,"gui/form/components/body/vue/body":121,"gui/form/components/footer/vue/footer":123,"gui/form/vue/form":128,"gui/gui":129,"gui/inputs/inputs":133,"gui/map/control/factory":144,"gui/map/vue/map":149,"gui/panel":150,"gui/print/vue/print":154,"gui/queryresults/vue/queryresults":167,"gui/search/vue/panel/searchpanel":170,"gui/search/vue/search":172,"gui/tools/vue/tools":178,"gui/vue/component":179}]},{},[3]);