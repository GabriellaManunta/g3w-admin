!function(){function e(t,n,a){function i(s,o){if(!n[s]){if(!t[s]){var l="function"==typeof require&&require;if(!o&&l)return l(s,!0);if(r)return r(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var c=n[s]={exports:{}};t[s][0].call(c.exports,function(e){var n=t[s][1][e];return i(n||e)},c,c.exports,e,t,n,a)}return n[s].exports}for(var r="function"==typeof require&&require,s=0;s<a.length;s++)i(a[s]);return i}return e}()({1:[function(e,t,n){t.exports='<ul id="g3w_raster_timeseries_content" class="treeview-menu" style="position:relative; padding: 10px;color:#FFFFFF">\n  <li>\n    <div v-disabled="status !== 0" v-if="layer.type === \'raster\'" v-t-tooltip.create="\'plugins.qtimeseries.tooltips.showcharts\'" data-placement="top" data-toggle="tooltip" style="padding: 5px; border:1px solid" class="skin-border skin-tooltip-top">\n      <button  class="sidebar-button skin-button btn btn-block" :class="{toggled: showCharts}" style="margin: 2px;" @click.stop="showRasterLayerCharts">\n        <span :class="g3wtemplate.getFontClass(\'chart-line\')"></span>\n      </button>\n    </div>\n    <div v-disabled="showCharts">\n      <form v-disabled="formDisabled">\n        <label style="display: block">Layer</label>\n        <select class="form-control" id="timeseriesrasterlayer" v-select2="\'current_layer_index\'" :search="false">\n          <option v-for="(layer, index) in layers" :value="index" :key="layer.id">{{layer.name}}</option>\n        </select>\n        <div v-if="!changed_layer">\n          <datetime :label="\'plugins.qtimeseries.startdate\'" :enabledDates="layer.options.dates" :minDate="layerMinDate" :maxDate="layerMaxDate" :type="\'datetime\'" :value="layer.start_date" @change="changeStartDateTime"></datetime>\n          <datetime :label="\'plugins.qtimeseries.enddate\'" :enabledDates="layer.options.dates" :minDate="layerMinDate" :maxDate="layerMaxDate" :type="\'datetime\'" :value="layer.end_date" @change="changeEndDateTime"></datetime>\n          <label  v-if="!change_step_unit"  v-t-plugin:pre="\'qtimeseries.step\'">[<span v-t-plugin="`qtimeseries.stepsunit.${current_step_unit_label}`"></span> ]</label>\n          <input class="form-control" type="number" :min="range.min" :max="range.max" :step="layer.options.stepunitmultiplier" v-model="step">\n          <range v-disabled="range.max === range.min " label="plugins.qtimeseries.steps" :max="range.max" :value="range.value" :min="range.min" ref="rangecomponent" @change-range="changeRangeStep"></range>\n          <label style="display: block"></label>\n          <select class="form-control" id="g3w-timeseries-select-unit" v-select2="\'current_step_unit\'" :search="false">\n            <option v-for="step_unit in step_units" :value="step_unit.moment" :selected="current_step_unit == step_unit.moment"\n              :key="step_unit.moment" v-t-plugin="`qtimeseries.stepsunit.${step_unit.label}`"></option>\n          </select>\n        </div>\n      </form>\n      <div style="display: flex; justify-content: space-between; margin-top: 10px" >\n        <button class="sidebar-button skin-button btn btn-block" v-disabled="!validRangeDates || range.value === 0" style="margin: 2px;" @click.stop="fastBackwardForward(-1)">\n          <span :class="g3wtemplate.getFontClass(\'fast-backward\')"></span>\n        </button>\n        <button class="sidebar-button skin-button btn btn-block"  v-disabled="!validRangeDates || range.value <= 0" style="margin: 2px;" @click.stop="stepBackwardForward(-1)">\n          <span :class="g3wtemplate.getFontClass(\'step-backward\')"></span>\n        </button>\n        <button class="sidebar-button skin-button btn btn-block" :class="{toggled: status === -1}" v-disabled="!validRangeDates || range.value <= 0"  style="margin: 2px; transform: rotate(180deg)" @click.stop="run(-1)">\n          <span :class="g3wtemplate.getFontClass(\'run\')"></span>\n        </button>\n        <button class="sidebar-button skin-button btn btn-block" :class="{toggled: status === 0}" style="margin: 2px;" @click.stop="pause">\n          <span :class="g3wtemplate.getFontClass(\'pause\')"></span>\n        </button>\n        <button class="sidebar-button skin-button btn btn-block"  :class="{toggled: status === 1}" v-disabled="!validRangeDates || range.value >= range.max" style="margin: 2px;" @click.stop="run(1)">\n          <span :class="g3wtemplate.getFontClass(\'run\')"></span>\n        </button>\n        <button class="sidebar-button skin-button btn btn-block" v-disabled="!validRangeDates || range.value >= range.max" style="margin: 2px;" @click.stop="stepBackwardForward(1)">\n          <span :class="g3wtemplate.getFontClass(\'step-forward\')"></span>\n        </button>\n        <button class="sidebar-button skin-button btn btn-block" v-disabled="!validRangeDates || range.value === range.max" style="margin: 2px;" @click.stop="fastBackwardForward(1)">\n          <span :class="g3wtemplate.getFontClass(\'fast-forward\')"></span>\n        </button>\n      </div>\n    </div>\n  </li>\n</ul>\n\n'},{}],2:[function(e,t,n){function a(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){function a(i,r){try{var s=t[i](r),o=s.value}catch(l){return void n(l)}return s.done?void e(o):Promise.resolve(o).then(function(e){a("next",e)},function(e){a("throw",e)})}return a("next")})}}function i(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.service;e.options;return{name:"timeseries",template:s,data:function(){var e=t.state,n=e.layers,a=void 0===n?[]:n,i=e.panel;return{layers:a,panel:i,step:1,step_units:r.STEP_UNITS,current_step_unit:a[0].options.stepunit,change_step_unit:!1,current_step_unit_label:r.STEP_UNITS.find(function(e){return e.moment===a[0].options.stepunit}).label,range:{value:0,min:0,max:0},changed_layer:!1,current_layer_index:0,currentLayerDateTimeIndex:null,showCharts:!1,status:0}},computed:{formDisabled:function(){return 0!==this.status||this.showCharts},layer:function(){var e=this;return this.changed_layer=!0,setTimeout(function(){return e.changed_layer=!1}),this.layers[this.current_layer_index]},layerMinDate:function(){return this.layer.start_date?this.layer.start_date:this.layer.options.dates&&this.layer.options.dates[0]},layerMaxDate:function(){return this.layer.end_date?this.layer.end_date:this.layer.options.dates&&this.layer.options.dates[this.layer.options.dates.length-1]},disablerun:function(){return!(0!==this.status||this.layer.start_date&&this.layer.end_date)},validRangeDates:function(){var e=this.getMultiplierAndStepUnit(),t=e.multiplier,n=e.step_unit;return this.validateStartDateEndDate()&&moment(this.layer.end_date).diff(moment(this.layer.start_date),n)/t>=this.getStepValue()}},methods:{initLayerTimeseries:function(){this.status=0,this.currentLayerDateTimeIndex=this.layer.start_date,this.range.value=0,this.range.min=0,this.resetRangeInputData(),this.currentLayerDateTimeIndex&&this.getTimeLayer(),this.showCharts=!1},resetRangeInputData:function(){this.range.value=0;var e=this.getMultiplierAndStepUnit(),t=e.multiplier,n=e.step_unit;this.range.max=this.validateStartDateEndDate()?Number.parseInt(moment(this.layer.end_date).diff(moment(this.layer.start_date),n)/t*this.layer.options.stepunitmultiplier):0},changeRangeInputOnChangeStepUnit:function(){this.range.value=0;var e=this.getMultiplierAndStepUnit(),t=e.multiplier,n=e.step_unit;this.range.max=this.validateStartDateEndDate()?Number.parseInt(moment(this.layer.end_date).diff(moment(this.layer.start_date),n)/t*this.layer.options.stepunitmultiplier):0},getMultiplierAndStepUnit:function(){return t.getMultiplierAndStepUnit(this.layer)},resetTimeLayer:function(){function e(){return n.apply(this,arguments)}var n=a(regeneratorRuntime.mark(function i(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.layer;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return this.pause(),n.next=3,t.resetTimeLayer(e);case 3:e.timed=!1;case 4:case"end":return n.stop()}},i,this)}));return e}(),getTimeLayer:function(){function e(){return n.apply(this,arguments)}var n=a(regeneratorRuntime.mark(function i(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$nextTick();case 2:return e.prev=2,e.next=5,t.getTimeLayer({layer:this.layer,step:this.step,date:this.currentLayerDateTimeIndex});case 5:e.next=9;break;case 7:e.prev=7,e.t0=e["catch"](2);case 9:this.layer.timed=!0;case 10:case"end":return e.stop()}},i,this,[[2,7]])}));return e}(),changeRangeStep:function(){function e(e){return t.apply(this,arguments)}var t=a(regeneratorRuntime.mark(function n(e){var t,a,i,r=e.value;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.range.value=1*r,t=this.getMultiplierAndStepUnit(),a=t.mutltiplier,i=t.step_unit,this.currentLayerDateTimeIndex=moment(this.layer.start_date).add(this.range.value*a,i),e.next=5,this.getTimeLayer();case 5:case"end":return e.stop()}},n,this)}));return e}(),changeStartDateTime:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e=moment(e).isValid()?e:null,this.layer.start_date=e,this.currentLayerDateTimeIndex=e,this.resetRangeInputData(),moment(e).isValid()?this.getTimeLayer():this.resetTimeLayer()},changeEndDateTime:function(){function e(e){return t.apply(this,arguments)}var t=a(regeneratorRuntime.mark(function n(e){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:this.layer.end_date=e,this.resetRangeInputData();case 2:case"end":return t.stop()}},n,this)}));return e}(),validateStartDateEndDate:function(){var e=!1;return this.layer.start_date&&this.layer.end_date&&(e=moment(this.layer.start_date).isValid()&&moment(this.layer.end_date).isValid()),e},setStatus:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.status=e},setCurrentDateTime:function(e){var t=1*this.getStepValue(),n=this.getMultiplierAndStepUnit(),a=n.multiplier,i=n.step_unit;this.currentLayerDateTimeIndex=moment(this.currentLayerDateTimeIndex)[1===e?"add":"subtract"](t*a,i)},getStepValue:function(){return 1*this.step*this.layer.options.stepunitmultiplier},run:function(e){var t=this;if(this.status!==e){var n=!1;clearInterval(this.intervalEventHandler),this.intervalEventHandler=setInterval(a(regeneratorRuntime.mark(function i(){var a;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(n){i.next=27;break}if(i.prev=1,a=1*t.step,t.range.value=1===e?t.range.value+a:t.range.value-a,!(t.range.value>t.range.max||t.range.value<0)){i.next=11;break}t.resetRangeInputData(),t.pause(),t.fastBackwardForward(-1),i.next=22;break;case 11:return t.setCurrentDateTime(e),n=!0,i.prev=13,i.next=16,t.getTimeLayer();case 16:i.next=21;break;case 18:i.prev=18,i.t0=i["catch"](13);case 21:n=!1;case 22:i.next=27;break;case 24:i.prev=24,i.t1=i["catch"](1),t.pause();case 27:case"end":return i.stop()}},i,t,[[1,24],[13,18]])})),1e3),this.setStatus(e)}else this.pause()},pause:function(){clearInterval(this.intervalEventHandler),this.intervalEventHandler=null,this.setStatus()},stepBackwardForward:function(e){var t=this.getStepValue();this.range.value=1===e?this.range.value+t:this.range.value-t,this.setCurrentDateTime(e),this.getTimeLayer()},fastBackwardForward:function(e){1===e?(this.range.value=this.range.max,this.currentLayerDateTimeIndex=this.layer.end_date,this.getTimeLayer()):(this.range.value=this.range.min,this.currentLayerDateTimeIndex=this.layer.start_date,this.getTimeLayer())},showRasterLayerCharts:function(){this.showCharts=!this.showCharts,this.showCharts?this.resetTimeLayer():this.initLayerTimeseries(),t.chartsInteraction({active:this.showCharts,layer:this.layer})}},watch:{current_step_unit:{handler:function(){function e(e){return t.apply(this,arguments)}var t=a(regeneratorRuntime.mark(function n(e){var t=this;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return this.change_step_unit=!0,this.layer.options.stepunit=e,this.current_step_unit_label=r.STEP_UNITS.find(function(e){return e.moment===t.layer.options.stepunit}).label,this.initLayerTimeseries(),n.next=6,this.$nextTick();case 6:this.change_step_unit=!1;case 7:case"end":return n.stop()}},n,this)}));return e}(),immediate:!1},current_layer_index:function(e,t){var n=this.layers[t];n.timed&&(this.resetTimeLayer(n),n.timed=!1),this.initLayerTimeseries()},"panel.open":function(e){e?this.initLayerTimeseries():this.resetTimeLayer()},validRangeDates:function(e){!e&&this.changeStartDateTime(this.layer.start_date)}},created:function(){this.intervalEventHandler=null},mounted:function(){function e(){return t.apply(this,arguments)}var t=a(regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},n,this)}));return e}(),beforeDestroy:function(){t.clear()}}}Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=i;var r=e("../../constant"),s=e("./sidebaritem.html")},{"../../constant":5,"./sidebaritem.html":1}],3:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n["default"]={it:{title:"Serie Temporali",current_date:"Data Corrente",steps:"Passi",step:"Passo",startdate:"Data Inizio",enddate:"Data Fine",stepsunit:{label:"Unità di passo",centuries:"Secoli",decades:"Decadi",years:"Anni",months:"Mesi",weeks:"Settimane",days:"Giorni",hours:"Ore",minutes:"Minuti",seconds:"Secondi",milliseconds:"Millisecondi"},tooltips:{showcharts:"Visualizza Grafici"}},en:{title:"Time Series",current_date:"Current Date",steps:"Steps",step:"Step",startdate:"Start Date",enddate:"End Date",stepsunit:{label:"Step Unit",centuries:"Centuries",decades:"Decades",years:"Years",months:"Months",weeks:"Weeks",days:"Days",hours:"Hours",minutes:"Minutes",seconds:"Seconds",milliseconds:"Milliseconds"},tooltips:{showcharts:"Show Charts"}},fi:{title:"Time Series",current_date:"Current Date",steps:"Steps",step:"Step",startdate:"Start Date",enddate:"End Date",stepsunit:{label:"Step Unit",centuries:"Centuries",decades:"Decades",years:"Years",months:"Months",weeks:"Weeks",days:"Days",hours:"Hours",minutes:"Minutes",seconds:"Seconds",milliseconds:"Milliseconds"},tooltips:{showcharts:"Show Charts"}},se:{title:"Time Series",current_date:"Current Date",steps:"Steps",step:"Step",startdate:"Start Date",enddate:"End Date",stepsunit:{label:"Step Unit",centuries:"Centuries",decades:"Decades",years:"Years",months:"Months",weeks:"Weeks",days:"Days",hours:"Hours",minutes:"Minutes",seconds:"Seconds",milliseconds:"Milliseconds"},tooltips:{showcharts:"Show Charts"}},fr:{title:"Time Series",current_date:"Current Date",steps:"Steps",step:"Step",startdate:"Start Date",enddate:"End Date",stepsunit:{label:"Step Unit",centuries:"Centuries",decades:"Decades",years:"Years",months:"Months",weeks:"Weeks",days:"Days",hours:"Hours",minutes:"Minutes",seconds:"Seconds",milliseconds:"Milliseconds"},tooltips:{showcharts:"Show Charts"}},de:{title:"Zeitreihen",current_date:"Aktuelles Datum",steps:"Stufen",step:"Stufe",startdate:"Anfangsdatum",enddate:"Enddatum",stepsunit:{label:"Stufeneinheit",centuries:"Jahrhunderte",decades:"Jahrzehnte",years:"Jahre",months:"Monate",weeks:"Wochen",days:"Tage",hours:"Stunden",minutes:"Minuten",seconds:"Sekunden",milliseconds:"Millisekunden"},tooltips:{showcharts:"Diagramme zeigen"}},ro:{title:"Intervale de timp",current_date:"Data Curentă",steps:"Pași",step:"Pas",startdate:"Data Început",enddate:"Data Sfârșit",stepsunit:{label:"Unitatea de pas",centuries:"Secole",decades:"Decenii",years:"Ani",months:"Luni",weeks:"Săptămâni",days:"Zile",hours:"Ore",minutes:"Minute",seconds:"Secunde",milliseconds:"Milisecunde"},tooltips:{showcharts:"Arată Graficele"}}}},{}],4:[function(e,t,n){function a(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("./i18n"),r=a(i);n["default"]={i18n:r["default"],name:"qtimeseries"}},{"./i18n":3}],5:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});n.STEP_UNITS=[{moment:"100:years",label:"centuries",qgis:"c"},{moment:"10:years",label:"decades",qgis:"dec"},{moment:"years",label:"years",qgis:"y"},{moment:"months",label:"months",qgis:"mon"},{moment:"7:days",label:"weeks",qgis:"wk"},{moment:"days",label:"days",qgis:"d"},{moment:"hours",label:"hours",qgis:"h"},{moment:"minutes",label:"minutes",qgis:"min"},{moment:"seconds",label:"seconds",qgis:"s"},{moment:"milliseconds",label:"milliseconds",qgis:"ms"}]},{}],6:[function(e,t,n){function a(e){return e&&e.__esModule?e:{"default":e}}function i(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){function a(i,r){try{var s=t[i](r),o=s.value}catch(l){return void n(l)}return s.done?void e(o):Promise.resolve(o).then(function(e){a("next",e)},function(e){a("throw",e)})}return a("next")})}}var r=e("./config"),s=a(r),o=e("./service"),l=a(o),u=e("./components/sidebar/sidebaritem"),c=a(u),d=g3wsdk.core.utils,p=d.base,h=d.inherit,m=g3wsdk.core.plugin.Plugin,g=g3wsdk.gui.GUI,f=g3wsdk.core.i18n.addI18nPlugin,y=function(){p(this);({position:0,title:s["default"].title});this.name=s["default"].name,this.panel,this.setReady(!0),this.onAfterRegisterPluginKey,this.init=function(){var e=this;this.config=this.getConfig();var t=this.registerPlugin(this.config.gid);this.setService(l["default"]),f({name:this.name,config:s["default"].i18n}),this.service.loadPlugin()&&(this.service.once("ready",function(n){t&&n&&(g.isready?e.setupGui():g.on("ready",function(){return e.setupGui.bind(e)}))}),this.service.init(this.config))},this.setupGui=function(){var e=this,t=this.getService(),n=(0,c["default"])({service:t});this.createSideBarComponent(n,{id:s["default"].name,title:"plugins."+s["default"].name+".title",open:!1,collapsible:!0,closewhenshowviewportcontent:!1,iconConfig:{color:"#25bce9",icon:"time"},mobile:!0,sidebarOptions:{position:"catalog"},events:{open:{when:"before",cb:function(){function n(e){return a.apply(this,arguments)}var a=i(regeneratorRuntime.mark(function r(n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n?t.open():t.close();case 1:case"end":return e.stop()}},r,e)}));return n}()}}})},this.load=function(){this.init()},this.unload=function(){this.emit("unload"),this.service.clear()}};h(y,m),function(e){e.init()}(new y)},{"./components/sidebar/sidebaritem":2,"./config":4,"./service":7}],7:[function(e,t,n){function a(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){function a(i,r){try{var s=t[i](r),o=s.value}catch(l){return void n(l)}return s.done?void e(o):Promise.resolve(o).then(function(e){a("next",e)},function(e){a("throw",e)})}return a("next")})}}function s(){c(this),this.init=r(regeneratorRuntime.mark(function e(){var t,n,a,i,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.project=this.getCurrentProject(),this.config=r,this.mapService=f.getComponent("map").getService(),this.getChartConfig={interaction:null,keyListener:null,indexcolor:0,chart:null,layer:new ol.layer.Vector({source:new ol.source.Vector})},t=0;case 5:if(!(t<this.config.layers.length)){e.next=24;break}n=this.config.layers[t],n.timed=!1,a=this.project.getLayerById(n.id),n.wmsname=a.getWMSLayerName(),n.name=a.getName(),e.t0=n.type,e.next="raster"===e.t0?14:21;break;case 14:return e.next=16,p.get({url:""+_+this.project.getId()+"/"+n.id});case 16:return n.options=e.sent,n.options.stepunit="days",n.options.type="raster",n.options.stepunitmultiplier=1,e.abrupt("break",21);case 21:t++,e.next=5;break;case 24:this.addProjectLayerFromConfigProject(),i=this.config.layers.length>0,i&&(this.state={loading:!1,layers:this.config.layers,panel:{open:!1}}),this.emit("ready",i);case 28:case"end":return e.stop()}},e,this)})),this.activeChartInteraction=function(e){var t=this,n=this;this.mapService.disableClickMapControls(!0);var s=new b;this.getChartConfig.interaction=s,this.mapService.addInteraction(s),this.mapService.getMap().addLayer(this.getChartConfig.layer),s.setActive(!0),this.getChartConfig.keyListener=s.on("picked",function(){var s=r(regeneratorRuntime.mark(function l(r){var s,u,c,d,p,h,g,b,w;return regeneratorRuntime.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return s=r.coordinate,u=m(),c=new ol.style.Style({image:new ol.style.RegularShape({fill:new ol.style.Fill({color:u}),stroke:new ol.style.Stroke({color:u,width:3}),points:4,radius:10,radius2:0,angle:Math.PI/4})}),d=new ol.Feature(new ol.geom.Point(s)),d.setStyle(c),t.getChartConfig.layer.getSource().addFeature(d),l.next=8,v.getData("query:coordinates",{inputs:{layerIds:[e.id],coordinates:s,feature_count:1},outputs:!1});case 8:p=l.sent,h=p.data,g=void 0===h?[]:h,b=[],Object.entries(g[0].features[0].getProperties()).forEach(function(e){var t=o(e,2),n=t[0],a=t[1];"geometry"===n&&"g3w_fid"===n||b.push(a)}),t.getChartConfig.chart?t.getChartConfig.chart.load({columns:[[s.toString()].concat(b)],colors:i({},s.toString(),u)}):(w=y.build({vueComponentObject:S.build({type:"c3:lineXY",hooks:{created:function(){var t=this;this.setConfig({data:{x:"x",columns:[["x"].concat(a(e.options.dates)),[s.toString()].concat(b)],colors:i({},s.toString(),u)},axis:{x:{type:"timeseries",tick:{format:"%Y-%m-%d"}}}}),this.$once("chart-ready",function(e){n.getChartConfig.chart=e,setTimeout(function(){t.resize()})})}}})}),f.showContent({title:e.name,perc:50,split:"v",closable:!1,content:w}));case 14:case"end":return l.stop()}},l,t)}));return function(e){return s.apply(this,arguments)}}())},this.deactiveChartInteraction=function(){this.getChartConfig.interaction&&(this.mapService.disableClickMapControls(!1),this.getChartConfig.layer.getSource().clear(),this.mapService.getMap().removeLayer(this.getChartConfig.layer),this.getChartConfig.interaction.setActive(!1),ol.Observable.unByKey(this.getChartConfig.keyListener),this.mapService.removeInteraction(this.getChartConfig.interaction),this.getChartConfig.interaction=null,this.getChartConfig.keyListener=null,this.getChartConfig.chart=null,f.closeContent())},this.chartsInteraction=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.active,n=void 0!==t&&t,a=e.layer;n?this.activeChartInteraction(a):this.deactiveChartInteraction()},this.addProjectLayerFromConfigProject=function(){var e=this;this.project.getConfigLayers().forEach(function(t){if("Object"===h(t.qtimeseries)){var n="ogr"===t.source.type?"vector":"wmst",a=t.qtimeseries,i=a.field,r=(a.duration,a.units),s=void 0===r?"d":r,o=a.start_date,u=void 0===o?null:o,c=a.end_date,d=void 0===c?null:c,p=l.STEP_UNITS.find(function(e){return e.qgis===s}).moment.split(":"),m=p.length>1?p[1]:p[0];switch(n){case"vector":if(i){var g=e.project.getLayerById(t.id),f=g.getFieldByName(i).type,y=l.STEP_UNITS.find(function(e){return e.qgis===s}).moment.split(":"),v=y.length>1?1*y[0]:1,b=k[f],w={id:t.id,type:n,name:g.getName(),wmsname:g.getWMSLayerName(),start_date:u,end_date:d,options:{range_max:moment(d).diff(moment(u),m)-1,format:b,type:n,stepunit:m,stepunitmultiplier:v,field:i}};e.config.layers.push(w)}break;case"wmst":var S=e.project.getLayerById(t.id);m="days";var _={id:t.id,type:n,name:S.getName(),wmsname:S.getWMSLayerName(),start_date:u,end_date:d,options:{range_max:moment(d).diff(moment(u),m)-1,format:moment(u).creationData().format,stepunit:m,type:n,stepunitmultiplier:1}};e.config.layers.push(_)}}})},this.getTimeLayer=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.layer,a=t.date,r=t.step,s=void 0,o=void 0;return new Promise(function(t,l){var u=n.id,c=e.project.getLayerById(u);c.setChecked(!0);var d=e.mapService.getMapLayerByLayerId(u);d.once("loadend",function(){var n=o?s+" - "+o:s;e.mapService.showMapInfo({info:n,style:{fontSize:"1.2em",color:"grey",border:"1px solid grey",padding:"10px"}}),t()}),d.once("loaderror",function(){var t=o?s+" - "+o:s;e.mapService.showMapInfo({info:t,style:{fontSize:"1.2em",color:"red",border:"1px solid red",padding:"10px"}}),l()});var p=n.type;switch(p){case"raster":var h=n.options.dates.findIndex(function(e){return moment(a).isSame(e)});h!==-1?(s=n.options.dates[h],e.mapService.updateMapLayer(d,i({force:!0},x[n.type],n.wmsname+","+h),C)):(e.mapService.showMapInfo({info:a,style:{fontSize:"1.2em",color:"red"}}),t());break;case"wmst":s=moment(a).format(n.options.format),e.mapService.updateMapLayer(d,i({force:!0},x[n.type],s),C);break;case"vector":var m=e.getMultiplierAndStepUnit(n),g=m.multiplier,f=m.step_unit;s=moment(a).format(n.options.format),o=moment(a).add(r*g,f).format(n.options.format);var y=moment(o).isAfter(n.end_date);y&&(o=n.end_date);var v=n.wmsname+':"'+n.options.field+"\" >= '"+s+"' AND \""+n.options.field+"\" < '"+o+"'";e.mapService.updateMapLayer(d,i({force:!0},x[n.type],v),C)}})},this.getMultiplierAndStepUnit=function(e){var t=e.options.stepunit.split(":");return{multiplier:t.length>1?1*t[0]:1,step_unit:t.length>1?t[1]:e.options.stepunit}},this.resetTimeLayer=function(e){var t=this;return new Promise(function(n,a){if(e.timed){var r=t.mapService.getMapLayerByLayerId(e.id);r.once("loadend",function(){t.mapService.showMapInfo(),n()}),t.mapService.updateMapLayer(r,i({force:!0},x[e.type],void 0))}else n()})},this.open=function(){this.state.panel.open=!0},this.close=function(){var e=this.state.layers.find(function(e){return e.timed});e&&this.resetTimeLayer(e),this.state.panel.open=!1,this.deactiveChartInteraction()},this.clear=function(){this.close()}}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){var n=[],a=!0,i=!1,r=void 0;try{for(var s,o=e[Symbol.iterator]();!(a=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);a=!0);}catch(l){i=!0,r=l}finally{try{!a&&o["return"]&&o["return"]()}finally{if(i)throw r}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),l=e("./constant"),u=g3wsdk.core.utils,c=u.base,d=u.inherit,p=u.XHR,h=u.toRawType,m=u.getRandomColor,g=g3wsdk.gui,f=g.GUI,y=g.ComponentsFactory,v=g3wsdk.core.data.DataRouterService,b=g3wsdk.ol.interactions.PickCoordinatesInteraction,w=g3wsdk.core.plugin.PluginService,S=g3wsdk.gui.vue.Charts.ChartsFactory,_="/qtimeseries/api/raster/serie/",k={date:"YYYY-MM-DD",datetime:"YYYY-MM-DD mm:hh:ss"},x={raster:"RBAND",vector:"FILTER",wmst:"TIME"},C={showSpinner:!1};d(s,w),n["default"]=new s},{"./constant":5}]},{},[6]);