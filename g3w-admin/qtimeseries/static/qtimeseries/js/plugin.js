!function(){function e(t,n,a){function r(i,o){if(!n[i]){if(!t[i]){var u="function"==typeof require&&require;if(!o&&u)return u(i,!0);if(s)return s(i,!0);var l=new Error("Cannot find module '"+i+"'");throw l.code="MODULE_NOT_FOUND",l}var c=n[i]={exports:{}};t[i][0].call(c.exports,function(e){var n=t[i][1][e];return r(n||e)},c,c.exports,e,t,n,a)}return n[i].exports}for(var s="function"==typeof require&&require,i=0;i<a.length;i++)r(a[i]);return r}return e}()({1:[function(e,t,n){t.exports='<ul id="g3w_raster_timeseries_content" class="treeview-menu" style="position:relative; padding: 10px;color:#FFFFFF">\n  <li>\n    <div style="display: flex; justify-content: space-between;  font-weight: bold; align-items: baseline; border-bottom: 1px solid white;margin-bottom: 3px;">\n      <span v-t-plugin="\'qtimeseries.current_date\'"></span>\n      <div v-show="currentLayerDateTime" style="font-size: 1.2em; align-items: center">{{ currentLayerDateTime }}</div>\n    </div>\n    <form v-disabled="status !== 0">\n      <label style="display: block">Layer</label>\n      <select class="form-control" id="timeseriesrasterlayer" v-select2="\'current_layer_index\'" :search="false">\n        <option v-for="(layer, index) in layers" :value="index" :key="layer.id">{{layer.name}}</option>\n      </select>\n      <datetime :label="\'plugins.qtimeseries.startdate\'" :enabledDates="layer.options.dates" :minDate="layerMinDate" :maxDate="layerMaxDate" :type="\'datetime\'" :value="layer.start_date" @change="changeStartDateTime"></datetime>\n      <datetime :label="\'plugins.qtimeseries.enddate\'" :enabledDates="layer.options.dates" :minDate="layerMinDate" :maxDate="layerMaxDate" :type="\'datetime\'" :value="layer.end_date" @change="changeEndDateTime"></datetime>\n      <label v-t-plugin:pre="\'qtimeseries.step\'">[<span v-t-plugin="`qtimeseries.stepsunit.${layer.options.stepunit}`"></span> ]</label>\n      <input class="form-control" type="number" :min="range.min" :max="range.max" v-model="step">\n      <range label="plugins.qtimeseries.steps" :max="range.max" :value="range.value" :min="range.min" ref="rangecomponent" @change-range="changeRangeStep"></range>\n    </form>\n    <div style="display: flex; justify-content: space-between; margin-top: 10px" >\n      <button class="sidebar-button skin-button btn btn-block" style="margin: 2px;" @click.stop="fastBackwardForward(-1)">\n        <span :class="g3wtemplate.getFontClass(\'fast-backward\')"></span>\n      </button>\n      <button class="sidebar-button skin-button btn btn-block" style="margin: 2px;" @click.stop="stepBackwardForward(-1)">\n        <span :class="g3wtemplate.getFontClass(\'step-backward\')" style="color: #FFFFFF;"></span>\n      </button>\n      <button class="sidebar-button skin-button btn btn-block" :class="{toggled: status === -1}" style="margin: 2px;" @click.stop="run(-1)">\n        <span :class="g3wtemplate.getFontClass(\'run\')" style="color: #FFFFFF; transform: rotate(180deg)"></span>\n      </button>\n      <button class="sidebar-button skin-button btn btn-block" :class="{toggled: status === 0}" style="margin: 2px;" @click.stop="pause">\n        <span :class="g3wtemplate.getFontClass(\'pause\')" style="color: #FFFFFF"></span>\n      </button>\n      <button class="sidebar-button skin-button btn btn-block" :class="{toggled: status === 1}" style="margin: 2px;" @click.stop="run(1)">\n        <span :class="g3wtemplate.getFontClass(\'run\')" style="color: #FFFFFF"></span>\n      </button>\n      <button class="sidebar-button skin-button btn btn-block" style="margin: 2px;" @click.stop="stepBackwardForward(1)">\n        <span :class="g3wtemplate.getFontClass(\'step-forward\')" style="color: #FFFFFF"></span>\n      </button>\n      <button class="sidebar-button skin-button btn btn-block" style="margin: 2px;" @click.stop="fastBackwardForward(1)">\n        <span :class="g3wtemplate.getFontClass(\'fast-forward\')" style="color: #FFFFFF"></span>\n      </button>\n    </div>\n  </li>\n</ul>\n\n'},{}],2:[function(e,t,n){function a(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){function a(r,s){try{var i=t[r](s),o=i.value}catch(u){return void n(u)}return i.done?void e(o):Promise.resolve(o).then(function(e){a("next",e)},function(e){a("throw",e)})}return a("next")})}}function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.service;e.options;return{name:"timeseries",template:s,data:function(){var e=t.state,n=e.layers,a=void 0===n?[]:n,r=e.panel;return{layers:a,panel:r,step:1,range:{value:null,min:null,max:null},stepunit:"days",current_layer_index:0,currentLayerDateTime:null,status:0}},computed:{layer:function(){return this.layers[this.current_layer_index]},layerMinDate:function(){return this.layer.options.dates[0]},layerMaxDate:function(){return this.layer.options.dates[this.layer.options.dates.length-1]},disablerun:function(){return!(0!==this.status||this.layer.start_date&&this.layer.end_date)}},methods:{initLayerTimeseries:function(){this.status=0,this.range.min=0,this.range.max=this.layer.options.dates.length-1,this.range.value=0,this.layer.start_date=this.layer.start_date&&this.layerMinDate,this.layer.end_date=this.layer.end_date&&this.layerMaxDate,this.currentLayerDateTime=this.layer.start_date,this.layer.start_date&&this.getTimeLayer()},resetRangeData:function(){this.range.value=0,this.range.max=moment(this.layer.end_date,this.layer.format).diff(moment(this.layer.start_date,this.layer.format),this.stepunit)-1},resetTimeLayer:function(e){t.resetTimeLayer(e),e.timed=!1,this.currentLayerDateTime=null},handleRangeSteps:function(){},getTimeLayer:function(){function e(){return n.apply(this,arguments)}var n=a(regeneratorRuntime.mark(function r(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getTimeLayer({layer:this.layer,date:this.currentLayerDateTime});case 2:this.layer.timed=!0;case 3:case"end":return e.stop()}},r,this)}));return e}(),changeRangeStep:function(e){var t=e.value;this.range.value=1*t,this.currentLayerDateTime=this.layer.options.dates[this.range.value=1*t]},changeStartDateTime:function(e){this.layer.start_date=e,this.currentLayerDateTime=e,this.resetRangeData(),this.getTimeLayer()},changeEndDateTime:function(e){this.layer.end_date=e,this.resetRangeData()},setStatus:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.status=e},setCurrentDateTime:function(e){var t=1*this.step;this.currentLayerDateTime=moment(this.currentLayerDateTime,this.layer.options.format)[1===e?"add":"subtract"](t,this.layer.options.stepunit).format(this.layer.options.format)},run:function(e){var t=this;this.status!==e?(clearInterval(this.intervalEventHandler),this.intervalEventHandler=setInterval(a(regeneratorRuntime.mark(function n(){var a;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.getTimeLayer();case 2:a=1*t.step,t.range.value=1===e?t.range.value+a:t.range.value-a,t.range.value>t.range.max||t.range.value<0?(t.resetRangeData(),t.pause()):t.setCurrentDateTime(e);case 5:case"end":return n.stop()}},n,t)})),1e3),this.setStatus(e)):this.pause()},pause:function(){clearInterval(this.intervalEventHandler),this.intervalEventHandler=null,this.setStatus()},stepBackwardForward:function(e){var t=1*this.step;this.range.value=1===e?this.range.value+t:this.range.value-t,this.setCurrentDateTime(e),this.getTimeLayer()},fastBackwardForward:function(e){this.range.value=1===e?this.range.max:this.range.min}},watch:{current_layer_index:function(e,t){var n=this.layers[t];n.timed&&this.resetTimeLayer(n),this.initLayerTimeseries()},"panel.open":function(e){e?this.initLayerTimeseries():this.resetTimeLayer(this.layer)}},created:function(){this.intervalEventHandler=null,this.stepunits=i},mounted:function(){function e(){return t.apply(this,arguments)}var t=a(regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},n,this)}));return e}(),beforeDestroy:function(){t.clear()}}}Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=r;var s=e("./sidebaritem.html"),i=["years","months","weeks","days","hours","minutes"]},{"./sidebaritem.html":1}],3:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n["default"]={it:{title:"Serie Temporali",current_date:"Data Corrente",steps:"Passi",step:"Passo",startdate:"Data Inizio",enddate:"Data Fine",stepsunit:{label:"UnitÃ  di passo",days:"Giorni",weeks:"Settimane",months:"Mesi",years:"Anni",hours:"Ore",minutes:"Minuti"}},en:{title:"Time Series",current_date:"Current Date",steps:"Steps",step:"Step",startdate:"Start Date",enddate:"End Date",stepsunit:{label:"Step Unit",days:"Days",weeks:"Weeks",months:"Months",years:"Years",hours:"Hours",minutes:"Minutes"}},fi:{title:"Time Series",current_date:"Current Date",steps:"Steps",step:"Step",startdate:"Start Date",enddate:"End Date",stepsunit:{label:"Step Unit",days:"Days",weeks:"Weeks",months:"Months",years:"Years",hours:"Hours",minutes:"Minutes"}},se:{title:"Time Series",current_date:"Current Date",steps:"Steps",step:"Step",startdate:"Start Date",enddate:"End Date",stepsunit:{label:"Step Unit",days:"Days",weeks:"Weeks",months:"Months",years:"Years",hours:"Hours",minutes:"Minutes"}},fr:{title:"Time Series",current_date:"Current Date",steps:"Steps",step:"Step",startdate:"Start Date",enddate:"End Date",stepsunit:{label:"Step Unit",days:"Days",weeks:"Weeks",months:"Months",years:"Years",hours:"Hours",minutes:"Minutes"}}}},{}],4:[function(e,t,n){function a(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var r=e("./i18n"),s=a(r);n["default"]={i18n:s["default"],name:"qtimeseries"}},{"./i18n":3}],5:[function(e,t,n){function a(e){return e&&e.__esModule?e:{"default":e}}function r(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){function a(r,s){try{var i=t[r](s),o=i.value}catch(u){return void n(u)}return i.done?void e(o):Promise.resolve(o).then(function(e){a("next",e)},function(e){a("throw",e)})}return a("next")})}}var s=e("./config"),i=a(s),o=e("./service"),u=a(o),l=e("./components/sidebar/sidebaritem"),c=a(l),d=g3wsdk.core.utils,p=d.base,m=d.inherit,h=g3wsdk.core.plugin.Plugin,f=g3wsdk.gui.GUI,y=g3wsdk.core.i18n.addI18nPlugin,g=function(){p(this);({position:0,title:i["default"].title});this.name=i["default"].name,this.panel,this.setReady(!0),this.onAfterRegisterPluginKey,this.init=function(){var e=this;this.config=this.getConfig();var t=this.registerPlugin(this.config.gid);this.setService(u["default"]),y({name:this.name,config:i["default"].i18n}),this.service.loadPlugin()&&(this.service.once("ready",function(){t&&(f.isready?e.setupGui():f.on("ready",function(){return e.setupGui.bind(e)}))}),this.service.init(this.config))},this.setupGui=function(){var e=this,t=this.getService(),n=(0,c["default"])({service:t});this.createSideBarComponent(n,{id:i["default"].name,title:"plugins."+i["default"].name+".title",open:!1,collapsible:!0,iconConfig:{color:"#25bce9",icon:"time"},mobile:!0,sidebarOptions:{position:"catalog"},events:{open:{when:"before",cb:function(){function n(e){return a.apply(this,arguments)}var a=r(regeneratorRuntime.mark(function s(n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n?t.open():t.close();case 1:case"end":return e.stop()}},s,e)}));return n}()}}})},this.load=function(){this.init()},this.unload=function(){this.emit("unload"),this.service.clear()}};m(g,h),function(e){e.init()}(new g)},{"./components/sidebar/sidebaritem":2,"./config":4,"./service":6}],6:[function(e,t,n){function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){function a(r,s){try{var i=t[r](s),o=i.value}catch(u){return void n(u)}return i.done?void e(o):Promise.resolve(o).then(function(e){a("next",e)},function(e){a("throw",e)})}return a("next")})}}function s(){o(this),this.init=r(regeneratorRuntime.mark(function e(){var t,n,a,r,s,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.project=this.getCurrentProject(),this.config=i,this.mapService=c.getComponent("map").getService(),t=i.layers,n=void 0===t?[]:t,a=0;case 5:if(!(a<n.length)){e.next=20;break}if(r=n[a],s=this.project.getLayerById(r.id),r.wmsname=s.getWMSLayerName(),r.name=s.getName(),r.timed=!1,"raster"!==r.type){e.next=17;break}return e.next=14,l.get({url:"/qtimeseries/api/raster/serie/"+this.project.getId()+"/"+r.id});case 14:r.options=e.sent,r.options.format="YYYY-MM-DD",r.options.stepunit="days";case 17:a++,e.next=5;break;case 20:this.state={loading:!1,layers:n,panel:{open:!1}},this.emit("ready");case 22:case"end":return e.stop()}},e,this)})),this.getTimeLayer=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.layer,r=t.date;return new Promise(function(t,s){var i=n.id,o=e.project.getLayerById(i);o.setChecked(!0);var u=e.mapService.getMapLayerByLayerId(i);if(u.once("loadend",t),"raster"===n.type){var l=n.options.dates.findIndex(function(e){return r===e});l!==-1&&e.mapService.updateMapLayer(u,a({force:!1},p[n.type],n.wmsname+","+l))}else e.mapService.updateMapLayer(u,a({force:!1},p[n.type],n.wmsname+':"'+n.options.field+"\"  = '"+r+"'"))})},this.resetTimeLayer=function(e){if(e.timed){var t=this.mapService.getMapLayerByLayerId(e.id);this.mapService.updateMapLayer(t,a({force:!1},p[e.type],void 0))}},this.open=function(){this.state.panel.open=!0},this.close=function(){var e=this.state.layers.find(function(e){return e.timed});e&&this.resetTimeLayer(e),this.state.panel.open=!1},this.clear=function(){this.close()}}Object.defineProperty(n,"__esModule",{value:!0});var i=g3wsdk.core.utils,o=i.base,u=i.inherit,l=i.XHR,c=g3wsdk.gui.GUI,d=g3wsdk.core.plugin.PluginService,p={raster:"BAND",vector:"FILTER"};u(s,d),n["default"]=new s},{}]},{},[5]);